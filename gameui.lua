GameUI_OnShowMapSwtich=function(nmapid,nmapmax)
	local bInMap=false;
	local curmapid=GetCurMapId();								
	local btnwgt="UI.gameui.worldbar.mapswitch.switch"..nmapid;

	Win_SetText(btnwgt,"",value_channel_coverpic);								
	for i=0,nmapmax do
		local nstop=Win_GetValue(btnwgt..".mapbtn"..i,value_channel_tabstop);
		local btnrect=Win_GetRect(btnwgt..".mapbtn"..i,value_channel_winrect);
		if nstop==curmapid then
			Win_SetText(btnwgt,"res/uires/gameui/playericon.gsa",value_channel_coverpic);								
			local bworldbarrect = Win_GetRect("UI.gameui.worldbar", value_channel_winrect);
			local px=btnrect.x+btnrect.w*0.5-22-bworldbarrect.x;
			local py=btnrect.y+btnrect.h*0.5-27-bworldbarrect.y;								
			Win_SetValue(btnwgt,px,value_channel_coverpicpos,0);								
			Win_SetValue(btnwgt,py,value_channel_coverpicpos,1);
			bInMap=true;
			break;
		end;
	end;

	return bInMap;
end;


GameUI_GetGossipTopmost=function()
	local gossipdlg="";
	local path=Win_GetFirstTopMost();
	
	if path~="" then
		local dlgnum=Win_GetTemplatesNum("UI.gameui",0);
		for i=0,dlgnum-1 do				 
			local dlgname="UI.gameui.gossipdlg"..i;
			if dlgname==path then
				gossipdlg=path;
				break;
			end; 
		end;		
	end;
	return gossipdlg;
end;


global_data = {
	recycle_btn_chk = false;
	---[[ 时装 by haifenghe
	timelimited_btn_chk = false;
	--]]
};

g_number_input_callback = nil;
function safe_call_func(func,...)
	if func~=nil and type(func)=="function" then func(unpack(arg)); end;
end

function DoLuaStringGameUI(ss)
	loadstring(ss)();
end;

UI.children.gameui =
{
	type = "SCREEN",
	rect = { 0, 0, 800, 600 },
	bkcolor = { 0, 0, 0, 0 },
	dragtype=ui_drag_type_screen,
	template={"res/uires/gossipdlg.lua","res/uires/gtalkingdlg.lua"};
	infowidget="UI.gameui.SysInfotip",
	autoadjust=autoadjust_rect,
	style=wgtstyle_renderbuffer + wgtstyle_effect,
	custombuffer=custom_buffer_minimap,

	OnDebug=function()
		TestOpenPetFoster(0);
		end;
		
	OnQueryLock=function()
		local nResult=0;
		local capwgt=Win_GetCapturePath();
		if capwgt~="" then
		if (capwgt~="UI.gameui.sysconfigdlg") and (capwgt~="UI.gameui.sysoptiondlg") and (capwgt~="UI.gameui.revivedlg") and (capwgt~="UI.gameui.exrevivedlg") and  (capwgt~="UI.gameui.houserevivedlg")  and capwgt~="UI.newsecuverifydlg" and capwgt~="UI.newsafesecuverifydlg" and capwgt~="UI.newsetsecudlg" and capwgt~="UI.newresetsecudlg"then
		nResult=1;
		end;
		end;
		
		if Win_IsVisible("UI.keyboarddlg") then
			return 1;
		end;
		
		return nResult;
		end;
		
	OnFocusRelay=function()
		Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");		
		end;
		
	OnHotRelay=function()
		Win_SetHot("UI.gameui.chatbar.inputbar.contentedit");		
		end;
		
	OnAddItemLink=function(txt)
		-- 这个插入的有转义 字符串， 作为一个整体插入
		Win_OnInsert("UI.gameui.chatbar.inputbar.contentedit",txt);
		Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
	end;
	
	OpenChatItemTooltip=function(drgtyp,drgidx,hsttype,hstidx,rx,ry)
		UI.children.gameui.children.ScrnChatTooltip.OnParseTooltip(drgtyp,drgidx,hsttype,hstidx,rx,ry);
		Win_ShowWidget("UI.gameui.ScrnChatTooltip", true);
	end;	
	
	OnChar=function(wparam,lparam,bvirtual)
		local nResult=0;
		if bvirtual==0 then
		local hotwgt=Win_GetHotPath();
		if hotwgt=="" then
		hotwgt="UI.gameui.chatbar.inputbar.contentedit";
		Win_SetHot(hotwgt);
		end;
		Win_SendMessage(hotwgt,msgtype_char,wparam,lparam);
		nResult=1;
		end;
		return nResult;
		end;
		
	OnKeyDown=function(wparam,lparam,bvirtual)
		local nResult=0;
		if bvirtual==0 then	
			if ((wparam>34)and(wparam<41))or(wparam==46)or(wparam==8) then
				local hotwgt=Win_GetHotPath();
				if hotwgt=="" then
					hotwgt="UI.gameui.chatbar.inputbar.contentedit";
					Win_SetHot(hotwgt);
				end;
				Win_SendMessage(hotwgt,msgtype_keydown,wparam,lparam);
				nResult=1;
			end;
		end;
		return nResult;
	end;
	
		
	accel=
	{

		--特殊键盘
		{"UI.children.gameui.OnAccel_OnCtrlEnter",13,0,1},--ctrl+enter 编辑框输入
		{"UI.children.gameui.OnAccel_OnEnter",13},--enter 切换交谈栏			
		{"UI.children.gameui.OnAccel_OnEscape",27},--escape 退出游戏		
		{"UI.children.gameui.OnAccel_AccelSend",83,0,0,1,2},--Alt+s快捷发送
		{"UI.children.gameui.OnAccel_AccelFace",66,0,0,1,2},--Alt+b表情窗口
		--Alt+d现在改为打开组队设置窗口
		--{"UI.children.gameui.OnAccel_AccelAction",68,0,0,1,2},--Alt+d行动信息窗口
		{"UI.children.gameui.OnAccel_ExteamconfigDlg",68,0,0,1,2},--Alt+d组队设置窗口
		{"UI.children.gameui.OnAccel_AccelHistory",72,0,0,1,2},--Alt+h快捷发送	
		{"UI.children.gameui.OnAccel_AccelSit",82,0,0,1,2},--Alt+r坐下
		{"UI.children.gameui.OnAccel_AccelItemName",90,0,0,1,1},--Alt+z隐藏道具名称
		{"UI.children.gameui.OnAccel_AccelActorName",192,0,0,1,1},--隐藏玩家名称
		{"UI.children.gameui.OnAccel_AccelSetPkMode",65,0,0,1,1},--Alt+a切换pk模式
		
		--在有编辑焦点的时候使用的快捷键
		{"UI.children.gameui.OnOpenAncientCardDlg",69,0,0,1,1},--Alt+e显示典籍卡牌
		{"UI.children.gameui.OnAccel_FamilyDlg",70,0,0,1,1},--Alt+f显示家族对话框
		{"UI.children.gameui.OnAccel_PetDlg",80,0,0,1,1},--Alt+p显示宠物对话框
		{"UI.children.gameui.OnAccel_TeamDlg",81,0,0,1,1},--Alt+q显示组队对话框
		{"UI.children.gameui.OnAccel_RackDlg",71,0,0,1,1},--Alt+g显示神奇货架对话框
		{"UI.children.gameui.OnAccel_WareDlg",73,0,0,1,1},--Alt+i 显示物品对话框
		{"UI.children.gameui.OnAccel_SkillDlg",84,0,0,1,1},--Alt+t显示技能对话框
		{"UI.children.gameui.OnAccel_EquipDlg",67,0,0,1,1},--Alt+c 显示状态对话框
		{"UI.children.gameui.OnAccel_TaskDlg",78,0,0,1,1},--Alt+n显示任务对话
		{"UI.children.gameui.OnAccel_ChatBar",86,0,0,1,1},--Alt+v显示聊天条		
		{"UI.children.gameui.OnAccel_OptionDlg",79,0,0,1,1},--Alt+o显示系统选单
		{"UI.children.gameui.OnAccel_SketchMap",77,0,0,1,1},--Alt+m显示小地图
		{"UI.children.gameui.OnAccel_EMailDlg",76,0,0,1,1},--Alt+L显示邮件列表
		{"UI.children.gameui.OnAccel_AutoAttack",87,0,0,1,1},--Alt+w自动打怪
		{"UI.children.gameui.OnAccel_HistoryDlg",72,0,0,1,1},--Alt+h聊天面板
		{"UI.children.gameui.OnAccel_GodDlg",75,0,0,1,1},--Alt+k 幻神窗口
		{"UI.children.gameui.OnAccel_AchieveDlg",89,0,0,1,1},--Alt+y 成就窗口

		{"UI.children.gameui.OnAccel_GodAttackMode",81,0,1},--Alt+q 切换幻神主被动状态
		{"UI.children.gameui.OnAccel_GodAttack",49,0,1},--ctrl+1 使用幻神手动技能
		
		
		{"UI.children.gameui.OnAccelPlus",107,0,0,1,1},--Alt+'+'
		{"UI.children.gameui.OnAccelMinus",109,0,0,1,1},--Alt+'-'
		{"UI.children.gameui.OnAccelPlus",187,0,0,1,1},--Alt+'+'
		{"UI.children.gameui.OnAccelMinus",189,0,0,1,1},--Alt+'-'
		
		{"UI.children.gameui.OnAccelPrePage",49,0,0,1,1},--Alt+1				
		{"UI.children.gameui.OnAccelNextPage",50,0,0,1,1},--Alt+2
		
		--1#道具快捷键
		{"UI.children.gameui.OnAccelItemF1_F10",112,0,0,0,1},--F1
		{"UI.children.gameui.OnAccelItemF1_F10",113,0,0,0,1},--F2
		{"UI.children.gameui.OnAccelItemF1_F10",114,0,0,0,1},--F3
		{"UI.children.gameui.OnAccelItemF1_F10",115,0,0,0,1},--F4
		{"UI.children.gameui.OnAccelItemF1_F10",116,0,0,0,1},--F5
		{"UI.children.gameui.OnAccelItemF1_F10",117,0,0,0,1},--F6
		{"UI.children.gameui.OnAccelItemF1_F10",118,0,0,0,1},--F7
		{"UI.children.gameui.OnAccelItemF1_F10",119,0,0,0,1},--F8
		{"UI.children.gameui.OnAccelItemF1_F10",120,0,0,0,1},--F9
		{"UI.children.gameui.OnAccelItemF1_F10",121,0,0,0,1},--F10				
		
		{"UI.children.gameui.OnAccelItemF11",122,0,0,0,1},--F11
		{"UI.children.gameui.OnAccelItemF12",123,0,0,0,1},--F12
		
		--2#快捷栏
		{"UI.children.gameui.OnAccelItemAlt1_10",49,0,0,1,1},--Alt + 1
		{"UI.children.gameui.OnAccelItemAlt1_10",50,0,0,1,1},--Alt + 2
		{"UI.children.gameui.OnAccelItemAlt1_10",51,0,0,1,1},--Alt + 3
		{"UI.children.gameui.OnAccelItemAlt1_10",52,0,0,1,1},--Alt + 4
		{"UI.children.gameui.OnAccelItemAlt1_10",53,0,0,1,1},--Alt + 5
		{"UI.children.gameui.OnAccelItemAlt1_10",54,0,0,1,1},--Alt + 6
		{"UI.children.gameui.OnAccelItemAlt1_10",55,0,0,1,1},--Alt + 7
		{"UI.children.gameui.OnAccelItemAlt1_10",56,0,0,1,1},--Alt + 8
		{"UI.children.gameui.OnAccelItemAlt1_10",57,0,0,1,1},--Alt + 9
		{"UI.children.gameui.OnAccelItemAlt1_10",48,0,0,1,1},--Alt  + 0				
		
		--3#快捷栏
		{"UI.children.gameui.OnAccelItemAltF1_F10",112,0,0,1,1},--Alt + F1
		{"UI.children.gameui.OnAccelItemAltF1_F10",113,0,0,1,1},--Alt + F2
		{"UI.children.gameui.OnAccelItemAltF1_F10",114,0,0,1,1},--Alt + F3
		{"UI.children.gameui.OnAccelItemAltF1_F10",115,0,0,1,1},--Alt + F4
		{"UI.children.gameui.OnAccelItemAltF1_F10",116,0,0,1,1},--Alt + F5
		{"UI.children.gameui.OnAccelItemAltF1_F10",117,0,0,1,1},--Alt + F6
		{"UI.children.gameui.OnAccelItemAltF1_F10",118,0,0,1,1},--Alt + F7
		{"UI.children.gameui.OnAccelItemAltF1_F10",119,0,0,1,1},--Alt + F8
		{"UI.children.gameui.OnAccelItemAltF1_F10",120,0,0,1,1},--Alt + F9
		{"UI.children.gameui.OnAccelItemAltF1_F10",121,0,0,1,1},--Alt + F10	
		
		--一键换装
		{"UI.children.gameui.OnAccel_ChangeEquip",88,0,0,1,1},--Alt+x
		{"UI.children.gameui.OnAccel_ToggleTab",9},		 --TAB
		
		--home 切换界面介绍信息
		{"UI.children.gameui.OnAccel_ToggleNewbieHelp",36,0,0,0,1},		 --Home

		--Insert 切换显示怪物，玩家的血条
		{"UI.children.gameui.OnAccel_ToggleShowHPBar",45,0,0,0,1},		 --Insert
	},

	--打开排行榜
	OnOpenRankingDlg = function()
		Win_ShowWidget("UI.gameui.rankingsdlg", true);
	end;
	
	--打开pk排行榜
	OnOpenPKRankingslist = function()
		Win_ShowWidget("UI.gameui.rankingsdlg.PKrankingsdlg", true);
	end;
	
	--显示竞技称号
	OnShowArenaTitle = function(isshow)
		SetPlayerArenaTitle(isshow);
	end;
	
	--显示仙阶等级称号
	OnShowGodLevelTitle=function(isshow)
		--SetPlayerGodLevelTitle(isshow);
		--local IsChecked1 = Win_IsChecked("UI.gameui.equipdlg.arenatitlecheck");
		if isshow == 1 then
		Win_SetCheck("UI.gameui.equipdlg.showgodstepecheck",true);
		else
		Win_SetCheck("UI.gameui.equipdlg.showgodstepecheck",false);
		end;
		if isshow == 1 then
			Win_SetCheck("UI.gameui.equipdlg.arenatitlecheck",false);
		end;
			
	end;
	
	--打开自己的幻神界面
	OnShowGodUI = function(ctype)
		if ctype ==  0 then
			Win_ShowWidget("UI.gameui.goddlg", true);
		else
			Win_SetValue("UI.gameui.ctrlbar.petbtn",1,value_channel_framescheme);
		end;
	end;
	
	--打开他人的幻神界面
	OnOpenOtherGodUI = function()
		Win_ShowWidget("UI.gameui.othergoddlg", true);
	end;
	
	--显示唤醒幻神按钮
	OnShowAwakeGodBtn=function(bshow)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.statusbar.godbar.awakebtn", false);
		else
			Win_ShowWidget("UI.gameui.statusbar.godbar.awakebtn", true);
		end;
	end;
	
	OnOpenLabaDialog=function(type)
		if type == 1 then
				--Win_ShowWidget("UI.gameui.suomadlg",true);
			UI.children.gameui.children.suomadlg.OnShowDlg(type);
		elseif type == 2 or type==3 or type==4 or type==5 or type == 6 or type == 7 or type == 8 or type == 9 or type == 10 or type == 11 then
			-- 各种喇叭 eg 黄金龙,精灵仙子喇叭
			UI.children.gameui.children.suomadlg.OnShowDlg(type);
		end;
	end;
	
	--打开安全摆摊查询界面
	OnOpenSafeShopQueryDlg=function()
		Win_ShowWidget("UI.gameui.safeshopquerydlg", true);
	end;

	--打开摆摊查询界面
	OnOpenShopQueryDlg = function()
		Win_ShowWidget("UI.gameui.shopquerydlg", true);
		--Win_SetFocus("UI.gameui.shopquerydlg.notesdlg");
	end;
	
	--更新摆摊查询界面
	OnUpdateShopQueryDlg = function(curpage, shownum)
		if curpage == -1 and shownum == -1 then
			Win_SetText("UI.gameui.shopquerydlg.resultlist", "没有发现相关物品");
		elseif shownum == 0 then
			Win_EnableWidget("UI.gameui.shopquerydlg.moneybtn", false);
			Win_EnableWidget("UI.gameui.shopquerydlg.levelbtn", false);
			Win_EnableWidget("UI.gameui.shopquerydlg.serverbtn", false);
			Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", false);
			Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", false);
			Win_SetText("UI.gameui.shopquerydlg.pagelabel", "");
			Win_SetValue("UI.gameui.shopquerydlg.resultlist",0,value_channel_item_num);
		else
			Win_EnableWidget("UI.gameui.shopquerydlg.moneybtn", true);
			Win_EnableWidget("UI.gameui.shopquerydlg.levelbtn", true);
			Win_EnableWidget("UI.gameui.shopquerydlg.serverbtn", true);
			local pagenum = GetTotalPageNum();
			if pagenum <= 1 then
				Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", false);
				Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", false);
			elseif curpage == pagenum then
				Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", true);
				Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", false);
			elseif curpage == 1 then
				Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", false);
				Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", true);
			else 
				Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", true);
				Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", true);
			end;
			Win_SetText("UI.gameui.shopquerydlg.pageedit", curpage);
			Win_SetText("UI.gameui.shopquerydlg.pagelabel", "/"..pagenum);
			Win_SetValue("UI.gameui.shopquerydlg.resultlist",shownum,value_channel_item_num);
			Win_SetFocus("UI.gameui.shopquerydlg.queryedit");
			--Win_SetFocus("UI.gameui.shopquerydlg.notesdlg");
		end;
	end;
	
	OpenWarcityContrirankDlg=function(nType, nResult)
		Win_ShowWidget("UI.gameui.familyWCContriRankdlg",true);
	end;
	
	--更新大额交易查询界面
	OnUpdateSafeShopQueryDlg=function(curpage,shownum)
		if curpage == -1 and shownum == -1 then
			Win_SetText("UI.gameui.safeshopquerydlg.resultlist", "没有发现相关物品");
		elseif shownum == 0 then
			Win_EnableWidget("UI.gameui.safeshopquerydlg.moneybtn", false);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.levelbtn", false);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.serverbtn", false);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.pageupbtn", false);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.pagedownbtn", false);
			Win_SetText("UI.gameui.safeshopquerydlg.pagelabel", "");
			Win_SetValue("UI.gameui.safeshopquerydlg.resultlist",0,value_channel_item_num);
		else
			Win_EnableWidget("UI.gameui.safeshopquerydlg.moneybtn", true);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.levelbtn", true);
			Win_EnableWidget("UI.gameui.safeshopquerydlg.serverbtn", true);
			local pagenum = GetTotalPageNum();
			if pagenum <= 1 then
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pageupbtn", false);
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pagedownbtn", false);
			elseif curpage == pagenum then
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pageupbtn", true);
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pagedownbtn", false);
			elseif curpage == 1 then
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pageupbtn", false);
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pagedownbtn", true);
			else 
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pageupbtn", true);
				Win_EnableWidget("UI.gameui.safeshopquerydlg.pagedownbtn", true);
			end;
			Win_SetText("UI.gameui.safeshopquerydlg.pageedit", curpage);
			Win_SetText("UI.gameui.safeshopquerydlg.pagelabel", "/"..pagenum);
			Win_SetValue("UI.gameui.safeshopquerydlg.resultlist",shownum,value_channel_item_num);
			Win_SetFocus("UI.gameui.safeshopquerydlg.queryedit");
			
			local money = GetMoney();
			gold = math.floor(money / 1000000);
			silver = math.floor((money - (gold * 1000000)) / 1000);
			copper = money - gold * 1000000 - silver * 1000;
			Win_SetText("UI.gameui.safeshopquerydlg.goldlabel", gold);
			Win_SetText("UI.gameui.safeshopquerydlg.silverlabel", silver);
			Win_SetText("UI.gameui.safeshopquerydlg.copperlabel", copper);
		
			yuanbao = GetYuanbaoNumber();
			jindin = GetJindinNumber();
		
			Win_SetText("UI.gameui.safeshopquerydlg.yuanbaolabel",yuanbao);
			Win_SetText("UI.gameui.safeshopquerydlg.jindinglabel",jindin);
		end;
			
	end;
	
	OnOpenQQCrossAuthDlg=function()
		Win_ShowWidget("UI.gameui.qqcrossauth",true);
		end;
	
	--打开宠物变装界面
	OpenPetAvtChgDlg = function()
		Win_ShowWidget("UI.gameui.petavtchgdlg", true);
	end;
	
	--更新宠物变装界面
	UpdatePetAvtChgDlg = function(wparam--[[0:选中宠物列表中第一项 1: 选中当前项--]], lparam--[[播放刻印成功特效--]])
		--1."刻印"按钮是否灰化
		local isCanChange = IsCanPetAvtChange();
		if isCanChange == 1 then
			Win_EnableWidget("UI.gameui.petavtchgdlg.changebtn", true);
		elseif isCanChange == 0 then
			Win_EnableWidget("UI.gameui.petavtchgdlg.changebtn", false);
		end;
		--2.金币消耗
		local money;
		if isCanChange == 1 then
			money = 1000000*GetPetAvtChgMoney();
		elseif isCanChange == 0 then
			money = 0;
		end;
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.petavtchgdlg.goldedit",gold);
		Win_SetText("UI.gameui.petavtchgdlg.silveredit",silver);
		Win_SetText("UI.gameui.petavtchgdlg.copperedit",copper);
		--3.宠物列表更新
		local info, num = GetPetAvtChgList();
		local oldsel = Win_GetValue("UI.gameui.petavtchgdlg.petlist", value_channel_sel);
		Win_SetValue("UI.gameui.petavtchgdlg.petlist",num,value_channel_item_num);
		for i = 1, num do
			Win_SetText("UI.gameui.petavtchgdlg.petlist",info[i],value_channel_itemtext,i-1);
		end;
		if num > 0 then	
			if wparam == 0 then
				Win_SetValue("UI.gameui.petavtchgdlg.petlist",0,value_channel_sel);
			elseif wparam == 1 then
				if oldsel > num-1 then
					Win_SetValue("UI.gameui.petavtchgdlg.petlist",0,value_channel_sel);
				else 
					Win_SetValue("UI.gameui.petavtchgdlg.petlist",oldsel,value_channel_sel);
				end;
			end;
			local name, state, desc = GetPetDescInfo(0);
			Win_SetText("UI.gameui.petavtchgdlg.petname", name);
			Win_SetText("UI.gameui.petavtchgdlg.changestate", state);
			Win_SetText("UI.gameui.petavtchgdlg.changedesc", desc);
		elseif num == 0 then
			Win_SetText("UI.gameui.petavtchgdlg.petname", "");
			Win_SetText("UI.gameui.petavtchgdlg.changestate", "");
			Win_SetText("UI.gameui.petavtchgdlg.changedesc", "");
		end;
		--4.播放刻印特效
		if lparam == 1 then
			Win_ShowWidget("UI.gameui.petavtchgdlg.effect", true);
		end;
	end;
	
	--仙阶通用技能更新
	OnGodCommonSkillUpdate=function()
	
		local godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1",value_channel_customid);
		local godskillcommonpageinfo = GetPageSkillInfo(godskillpageid);
		
		for i=0,godskillcommonpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_common,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_common,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
		end;
	
	end;
	--仙阶职业技能更新
	OnGodProfessionSkillUpdate=function()
		local godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0",value_channel_customid);
		local godskillprofessionpageinfo = GetPageSkillInfo(godskillpageid);

		local swqid=GetPlayerProf();
		
		for i=0,godskillprofessionpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_profession,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_profession,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
			
		end;
	end;
	
	--仙阶仙法技能更新
	OnGodXianfaSkillUpdate=function()
		local godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customid);
		local godskillprofessionpageinfo = GetPageSkillInfo(godskillpageid);

		local swqid=GetPlayerProf();
		
		for i=0,godskillprofessionpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_xianfa,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_xianfa,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
			
		end;
	end;
	
	--轮回技能更新
	OnRecycleSkillUpdate=function()
		local swqid=GetPlayerProf();
		
		if swqid==0 or swqid>5 then 
			return; 
		end;
		local godskillpageid = misc_value_recycle_skillpage_begin + swqid - 1; --Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customid);
		local godskillprofessionpageinfo = GetPageSkillInfo(godskillpageid);

		local swqid=GetPlayerProf();
		
		for i=0,godskillprofessionpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			
			if i >= 0 and i < 4 then
				skillid = "UI.gameui.recycledlg.recycleskilldlg.allskills.skill"..(i+1);
			elseif i >= 4 and i < 7 then
				skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills1.skill"..(i-3);
			elseif i >= 7 and i < 10 then
				skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills2.skill"..(i-6);
			elseif i >= 10 and i < 13 then
				skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills3.skill"..(i-9);
			elseif i >= 13 and i < 16 then
				skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills4.skill"..(i-12);
			end;
			
			if IsInGameWorld() == true then
			
				Win_SetValue(skillid,ui_drag_type_recycle,value_channel_dragtype);
				Win_SetValue(skillid,id,value_channel_dragindex);
				
				local status;
				status=SkillGetStatus(ui_drag_type_recycle,id);
				
				if (status.blearned) then-- 是否已经学会
					Win_SetValue(skillid,1,value_channel_framescheme);
					if (status.level == status.maxlevel) then -- 是否已经满级
						Win_ShowWidget(skillid..".upgradebtn",false);
					else
						if (status.bcanupgrade) then
							Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
							Win_SetValue(skillid, 1, value_channel_customtype);
							Win_ShowWidget(skillid..".upgradebtn",true);
						else
							Win_ShowWidget(skillid..".upgradebtn",false);
						end;
					end;
				else
					if (status.bcanlearn) then
						Win_SetValue(skillid,1,value_channel_framescheme);
						Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
						Win_SetValue(skillid, 0, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else 
						Win_SetValue(skillid,0,value_channel_framescheme);
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
				
				if swqid > 0 then
					Win_ShowWidget(skillid, true);
				end;
			end;
		end;
	end;
	
	
	--仙阶面板更新
	OnGodPanelUpdate=function()
		local status;
		status = GetGodStepInfo();
		Win_SetText("UI.gameui.skilldlg.godstepdlg.reservepointlabel",status.reservepoint);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.currentgodsteplabel",status.leveldes);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.linqipointlabel",status.linqi);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.laojunpointlabel",status.dan);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.healthabel",status.vit);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.strengthlabel",status.str);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.intelligencelabel",status.inte);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.agilelabel",status.agi);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.spiritlabel",status.spi);
		Win_SetText("UI.gameui.skilldlg.godstepdlg.linqiaolabel",status.dex);
		
		if Win_IsChecked("UI.gameui.skilldlg.godstepdlg.tab0") then
			Win_SetText("UI.gameui.skilldlg.godstepdlg.setpointlabel",status.usepointprofession);
		elseif Win_IsChecked("UI.gameui.skilldlg.godstepdlg.tab1") then
			Win_SetText("UI.gameui.skilldlg.godstepdlg.setpointlabel",status.usepointcommon);
		elseif Win_IsChecked("UI.gameui.skilldlg.godstepdlg.tab2") then
			Win_SetText("UI.gameui.skilldlg.godstepdlg.setpointlabel",0); 
		end;
		
		for i=1,15 do
			Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.god"..i,false);
		end;
		
		if status.level <= 15 then
			for i=1,status.level do
				Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.god"..i,true);
			end;
		elseif status.level > 15 then
			for i=1,15 do
				Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.god"..i,true);
			end;
		end;
	end;
	
	--奇门技能更新
	OnFmTabQMSkillUpdate=function()
		local pageid = 40;
		local pageinfo = GetPageSkillInfo(pageid);
		local dgtype = ui_drag_type_skill_main;
		local skillitem= "";
		local upgradebutton = "";
		for i=0,pageinfo.skillnum-1 do
			local skill = GetPageSkill(pageid,i);
			local id = skill.id;
			local tabid = "UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills";
			skillitem = tabid..".skill"..(i+1);
			upgradebutton = skillitem..".upgradebtn";
			local status = SkillGetStatus(dgtype,id);
			Win_SetValue(skillitem,dgtype,value_channel_dragtype);
			Win_SetValue(skillitem,id,value_channel_dragindex);
	
			if(status.blearned) then
				Win_SetValue(skillitem,1,value_channel_framescheme);
				Win_SetValue(skillitem,1,value_channel_customtype);
				if (status.level == status.maxlevel or status.bcanupgrade == false) then --是否已经满级
					Win_ShowWidget(upgradebutton,false);
				else
					Win_ShowWidget(upgradebutton,true);
				end;
			else
								
				Win_SetValue(skillitem,0,value_channel_customtype);
				if (status.bcanlearn) then
					Win_SetValue(skillitem,1,value_channel_framescheme);
					Win_SetValue(skillitem,0,value_channel_customtype);
					Win_ShowWidget(upgradebutton,true);
				else
					Win_SetValue(skillitem,0,value_channel_framescheme);
					Win_ShowWidget(upgradebutton,false);
				end;								
			end;
			Win_ShowWidget(skillitem,true);
		end;
	end;	
        --打开接受求婚申请界面
	OnOpenAcceptProposeDlg = function(name, marriageid, tp)
		Win_SetText("UI.gameui.acceptproposedlg", name.."的求婚申请", value_channel_caption);
		Win_SetText("UI.gameui.acceptproposedlg.proposerlabel", name.."真诚的向你求婚", value_channel_caption);
		local txt = GetLovewords();
		Win_SetText("UI.gameui.acceptproposedlg.lovewordsedit", "他(她)想对你说的话：\n"..txt);
		Win_SetValue("UI.gameui.acceptproposedlg", marriageid, value_channel_customid);
		Win_SetText("UI.gameui.acceptproposedlg", name,value_channel_customname);
		Win_ShowWidget("UI.gameui.acceptproposedlg", true);
		OpenAcceptMarriage(marriageid, tp);
	end;


	--打开求婚申请界面
	OnOpenProposeMarriageDlg=function()
		if g_PlayerInfo.LEVEL<25  then
			MarriageLogInfo("您的等级不到25级，不能提出求婚申请！");
		elseif GetMarriageState() ~= 0 then --0未婚状态
			MarriageLogInfo("只有未婚状态才能提出求婚申请！");
		else
			Win_ShowWidget("UI.gameui.proposemarriagedlg", true);
		end;
	end;
	
	--刷新同时举行婚礼人数
	OnUpdateMarriageNum = function(num)
		--if num >= 20 then
			--Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl", "当前时段有20对新人进行婚礼,已达上限, 无法再选择此时段");
			--Win_SetText("UI.gameui.marriagePreparedlg_One.date_lbl", "");
			--Win_SetText("UI.gameui.marriagePreparedlg_One.hour_lbl", "");
			--Win_SetCheck("UI.gameui.marriagePreparedlg_One.ex_chk", false);
			--Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "0");
			--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.ex_chk", false);
			--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
		--else 		
			--Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl", "目前已有"..num.."对新人选择此日期举行婚礼");
			--if num == 0  then
				--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.ex_chk", true);
			--else	
				--Win_SetCheck("UI.gameui.marriagePreparedlg_One.ex_chk", false);
				--Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "0");
				--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.ex_chk", false);
			--end;
			--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", true);
		--end;
	end;
	
	--刷新更改婚礼日期提示信息
	OnUpdateMrgDateInfo = function()
		GameUILogInfo("这个时段已被他人独占,请选择其它时段!");
		--Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl", "这个时段已被他人独占");
		Win_SetText("UI.gameui.marriagePreparedlg_One.date_lbl", "");
		Win_SetText("UI.gameui.marriagePreparedlg_One.hour_lbl", "");
		--Win_SetCheck("UI.gameui.marriagePreparedlg_One.ex_chk", false);
		Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "0");
		Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",true);
		Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn",false);
		--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.ex_chk", false);
		--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
	end;
	
	--打开婚礼准备界面 1
	OnOpenPreMarriageDlg_One = function()
		Win_ShowWidget("UI.gameui.marriagePreparedlg_One", not Win_IsVisible("UI.gameui.marriagePreparedlg_One"));
	end;
	
	--打开婚礼准备界面 2
	OnOpenPreMarriageDlg_Two = function()
		--Win_ShowWidget("UI.gameui.marriagePreparedlg_Two",true);
	end;
	
	--打开婚礼信息确认界面
	OnOpenMrgInfoCfmDlg = function()
		Win_ShowWidget("UI.gameui.marriageInfoDlg_One",true);
	end;
	
	--打开婚礼嘉宾名单界面
	OnOpenMrgInviGuestDlg = function()
		Win_ShowWidget("UI.gameui.inviteguest_dlg", true);
	end;
	
	--打开婚礼信息察看界面
	OnOpenMrgInfoLookDlg = function()
		Win_ShowWidget("UI.gameui.marriageInfodlg_Two", true);
	end;
	
	--更新嘉宾名单
	OnUpdateGuestlist = function()
		local info, num = GetInvitedGuestlist();
			Win_SetValue("UI.gameui.guestlist_dlg.list",num,value_channel_item_num);
		for i = 1, num do
			Win_SetText("UI.gameui.guestlist_dlg.list",info[i],value_channel_itemtext,i-1);
		end;
		if num == 0 then
			Win_ShowWidget("UI.gameui.guestlist_dlg.delguest_btn", false);
		else 
			Win_ShowWidget("UI.gameui.guestlist_dlg.delguest_btn", true);
		end;
		Win_SetValue("UI.gameui.guestlist_dlg.list",-1,value_channel_sel);
	end;
	
	--打开受邀婚礼列表
	OnOpenBeInvitedlist = function()
		Win_ShowWidget("UI.gameui.invitationlistdlg", true);
	end;
	
	--打开婚礼进行界面
	OnOpenProcessMarriageDlg = function()
		if Win_IsVisible("UI.gameui.weddingdlg") then
			Win_ShowWidget("UI.gameui.weddingdlg", false);
		else
			Win_ShowWidget("UI.gameui.weddingdlg", true);
		end;
	end;
	
	--战斗计时显示器
	OnToggleFightTimer = function(starttime)
		if starttime > 0 then
			Win_ShowWidget("UI.gameui.fighttimerbar", true);
		else
			Win_ShowWidget("UI.gameui.fighttimerbar", false);
		end;
	end;	

	--雪地的大生存
	OnSnowScoreUpdate = function(score)
		UI.children.gameui.children.snowscorebar.OnSnowScoreUpdate(score);
	end;	
	
	-- 打开悬赏dlg
	OnOpenRewardDlg=function()
		Win_ShowWidget("UI.gameui.rewarddlg", true);
	end;

	--打开我的悬赏任务列表dlg
	OnOpenMyRewardDlg=function()
		Win_ShowWidget("UI.gameui.myrewarddlg", true);
	end;
	
	-- 更新悬赏dlg里面的任务list
	OnUpdateRewardlist=function()
		UI.children.gameui.children.rewarddlg.OnUpdateList();
	end;
	
	-- 更新我的悬赏dlg里面的任务list
	OnUpdateMyRewardlist=function()
		UI.children.gameui.children.myrewarddlg.OnUpdateList();
		UI.children.gameui.children.taskdlg.OnUpdateSel();
	end;
	
	--打开宠物资质鉴定dlg
	OnOpenPetIdentifyDlg=function()
		Win_ShowWidget("UI.gameui.petdlg", true);
		UI.children.gameui.children.petdlg.ShowSkillDlg(false);
		Win_ShowWidget("UI.gameui.petidentifydlg", true);
	end;
	
	-- 鉴定结果返回(或者鉴定信息更新，新拖一个宠物上去，更新）
	OnPetIdentifyMsg=function(mode)
		UI.children.gameui.children.petidentifydlg.OnMsg(mode);
	end;

	-- 打开抽奖dlg
	OnOpenLotteryDlg=function(IsFive)
		Win_ShowWidget("UI.gameui.lotterydlg", true);
		UI.children.gameui.children.lotterydlg.IsFive = IsFive;
		if IsFive == 1 then
			Win_ShowWidget("UI.gameui.lotterydlg.FiveTxt", true);
			Win_SetText("UI.gameui.lotterydlg.startbtn","每一次转动轮盘需要消耗25金币",value_channel_tiptext);
		else
			Win_ShowWidget("UI.gameui.lotterydlg.FiveTxt", false);
			Win_SetText("UI.gameui.lotterydlg.startbtn","每一次转动轮盘需要消耗5金币",value_channel_tiptext);
		end;
	end;

	--  抽奖结果返回
	OnResultLottery=function()
		Win_ShowWidget("UI.gameui.lotterydlg.stopbtn", false);
		Win_ShowWidget("UI.gameui.lotterydlg.startbtn", true);
		Win_ShowWidget("UI.gameui.lotterydlg.eff1", true);
		for i=1,12 do
			local desc=LotteryDraw_GetObjTip(i);
			if desc~=nil then
				Win_SetText("UI.gameui.lotterydlg.obj"..i,desc,value_channel_tiptext);
				Win_EnableWidget("UI.gameui.lotterydlg.obj"..i, true);
			end;				
		end;
	end;
	
	OnGlobalQuery=function(ntype,pname)
			local result=0;
			
			if ntype==GlobalQuery_Gossip then
				local path="UI.gameui.gossipdlg";
				local dlgnum=Win_GetTemplatesNum("UI.gameui",0);
				local dlgname="";
								 
				for i=0,dlgnum-1 do				 
				local dlgid=Win_GetText("UI.gameui.gossipdlg"..i,value_channel_customname);					 
				if dlgid==pname then
				dlgname="UI.gameui.gossipdlg"..i;
				break;
				end; 
				end;
				
				if dlgname~="" then
				if Win_IsVisible(dlgname) then
				result=1;
				end;									
				end;
			elseif  ntype == GlobalQuery_GroupTalking then
				local path="UI.gameui.gtalkdlg";
				local dlgnum=Win_GetTemplatesNum("UI.gameui",1);
				local dlgname="";
				
				for i=0,dlgnum-1 do				 
					local dlgid=Win_GetText("UI.gameui.gtalkdlg"..i,value_channel_customname);					 
					if dlgid==pname then
						dlgname="UI.gameui.gtalkdlg"..i;
						break;
					end; 
				end;
				
				if dlgname~="" then
					if Win_IsVisible(dlgname) then
						result=1;
					end;									
				end;
			end;
			
			return result;
	end;
	
	-- 这个函数是c中用来计算显示系统消息的高度的，现在顶部，换了状态条，不是快捷条，所以暂时考虑高度固定为3，内部c处理为115
	OnQueryAccelbarType=function()--高度类型
			return 3;
		end;
	
	OnAccel_ToggleShowHPBar=function(wparam,lparam)
		ToggleHPBar();
	end;
	
	--特殊键盘
	OnAccel_OnCtrlEnter=function(wparam,lparam)
		local result=0;
		if not Win_IsVisible("UI.SysConsole") then
			if not Win_IsAcceptInput() then

			local hotwgt=Win_GetHotPath();
				if hotwgt=="" then
					hotwgt="UI.gameui.chatbar.inputbar.contentedit";
					Win_SetHot(hotwgt);		
				end;
			Win_SendMessage(hotwgt,msgtype_keydown,wparam,lparam);
			end;
		end;
		
		return result;
	end;
	
	OnAccel_OnEnter=function(wparam,lparam)		
		local result=0;
		
		if not Win_IsVisible("UI.SysConsole") then
		if not Win_IsAcceptInput() then

		result=1;
		local path=Win_GetFirstTopMost();
	
		if (path~="") then	   
		if path~="UI.SysMsgbox" then
		Win_EndWidget(path,true);
		end;		
		else
		UI.children.gameui.OnAccel_AccelSend();
		end;
		
		end;
		end;

		return result;
			   
		end;		

	OnAccel_OnEscape=function()	
		--中断吟唱
		local iRet = 0;
		iRet = CancelSkillPrepare();
		if iRet ~= 0 then
			return 1;
		end;
		
		--中断物品吟唱
		local iRet = 0;
		iRet = CancelItemSing();
		if iRet ~= 0 then
			return 1;
		end;
		
		-- 停止自动魔法打怪
		local iRet = CancelAutoAttack();
		if iRet ~= 0 then
			return 1;
		end;
		
		--停止自动打怪
		--iRet = CancelAutoSearchAttack();
		--if iRet ~= 0 then
		--	return 1;
		--end;
		
		local status = GetRackPreviewStatus();
		if status ~= 0 then
			CancelRackPreviewStatus();
			return 1;
		end;
		
		if not CancelCurSkill() then
		local path=Win_GetFirstTopMost();
		if path=="" then
			if IsMapDiagramVis() then
			ToggleMapDiagram(false);
			elseif IsSystemMenuEnable() then
			if Win_IsVisible("UI.newsecuverifydlg") then
				Win_ShowWidget("UI.newsecuverifydlg",false);
			end;
			
			if Win_IsVisible("UI.newsafesecuverifydlg") then
				Win_ShowWidget("UI.newsafesecuverifydlg",false);
			end;
			
			if IsArenaInPrepare() == false then
				if IsInPKReliveMap() == 1 and IsPlayerLive() == false then
					Win_ShowWidget("UI.gameui.pvprevivedlg",true);
				else
					Win_ShowWidget("UI.gameui.sysoptiondlg",true);
				end;
			end;
			
			end;
		else
		Win_EndWidget(path,false);					 				
		end;
		end;
		return 1;
		end;
					 
	OnAccel_AccelSend=function()	
		local txt=Win_GetText("UI.gameui.chatbar.inputbar.contentedit");
		local goal=Win_GetText("UI.gameui.chatbar.inputbar.chateredit");		
		local num,tgts,descs,kwds1,kwds2=GetChatGoal();
							
		if txt~="" then
		
		local cursel=0;
		for i=1,num do
		if (txt==kwds1[i])or(txt==kwds2[i]) then
		cursel=i;
		break;
		end;
		end;
		
		if cursel~=0 then
		Win_SetText("UI.gameui.chatbar.inputbar.chateredit",tgts[cursel]);
		Win_SetText("UI.gameui.chatbar.inputbar.contentedit","");			
		else
		Chat(goal,txt);						    						    
		Win_SetText("UI.gameui.chatbar.inputbar.contentedit",txt,value_channel_edithistory);
		Win_SetText("UI.gameui.chatbar.inputbar.contentedit","");
		end;
		
		end;
			
		
		return 1;
		end;		   
	
	OnAccel_AccelAction=function()
		UI.children.gameui.children.chatbar.children.splitbtn.OnClick();
		end;
	
	OnExteamconfigDlg=function()
		if Win_IsVisible("UI.gameui.exteamconfigdlg") then
			Win_ShowWidget("UI.gameui.exteamconfigdlg", false);
		else 
			local ret = AccelTeam();
			if ret == 4 then
				Win_ShowWidget("UI.gameui.updateteamcfgdlg", not Win_IsVisible("UI.gameui.updateteamcfgdlg"));
			elseif ret == 5 then
				Win_ShowWidget("UI.gameui.exteamconfigdlg", true);
			else
				local curselname = GetCurSelName();
				if curselname ~= "" then
					if ret == 1 then
						local rst = TeamInvite(curselname,"邀请您加入队伍!");
						if rst ~= 0 then
							Win_ShowMsgBox("组队请求已经发送！");
						end;
					elseif ret == 2 then
						TeamJoin(curselname, "请求加入队伍!");
					elseif ret == 3 then
						Win_ShowWidget("UI.gameui.exteamconfigdlg", true);
						local rst = AddToStandbyMemberByName(curselname);
						if rst ~= 0 then
							UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList();
						end;
					end;
				end;
			end;
		end;
	end;
		
	OnAccel_ExteamconfigDlg=function()
		-- 大乱斗屏蔽组队设置快捷键
		if IsPlayerInBattlefield() == true then
			return ;
		end
		UI.children.gameui.OnExteamconfigDlg();
	end;
	
	OnAccel_AccelHistory=function()
		local nResult=0;
		local gossipdlg=GameUI_GetGossipTopmost();
		if gossipdlg~="" then
			nResult=1;
			if Win_IsVisible(gossipdlg..".historydlg") then
				Win_ShowWidget(gossipdlg..".historydlg",false);
				--Win_SetSize(gossipdlg,269,308);
			else
				Win_ShowWidget(gossipdlg..".historydlg",true);
				Win_SetCheck(gossipdlg..".minimizebtn",false);
			end;
		end;

		return nResult;
	end;
	
	
	OnAccel_AccelFace=function()
		if Win_IsVisible("UI.gameui.facedlg") then
		Win_ShowWidget("UI.gameui.facedlg",false);
		Win_SetFocus("UI.gameui");	
		else
		local hostwgt="";
		local alignstyle=0;				
		if Win_IsFocused("UI.gameui.sendbigpackdlg.contentedit") then
		hostwgt="UI.gameui.sendbigpackdlg";
		alignstyle=alignstyle_bottom_out+alignstyle_left_in;
		elseif Win_IsFocused("UI.gameui.sendsmallpackdlg.contentedit") then
		hostwgt="UI.gameui.sendsmallpackdlg";
		alignstyle=alignstyle_bottom_out+alignstyle_left_in;
		elseif Win_IsFocused("UI.gameui.sendmaildlg.contentedit") then
		hostwgt="UI.gameui.sendmaildlg";
		alignstyle=alignstyle_bottom_out+alignstyle_left_in;		
		else
		local gossipdlg=GameUI_GetGossipTopmost();
		if gossipdlg~="" then
		hostwgt=gossipdlg;
		alignstyle=alignstyle_top_out+alignstyle_left_in;		
		else
		hostwgt="UI.gameui.chatbar.inputbar";
		alignstyle=alignstyle_top_out+alignstyle_left_in;		
		end;
		end;
		
		if hostwgt~="" then		
		Win_SetText("UI.gameui.facedlg",hostwgt,value_channel_customname);
		Win_AlignWidget("UI.gameui.facedlg",hostwgt..".facebtn",aligntype_winrect,alignstyle);
		Win_ShowWidget("UI.gameui.facedlg",true);
		Win_SetFocus("UI.gameui.facedlg.facelist");	
		end;
		end;
		return 1;
		end;
	
	--在有编辑焦点的时候使用的快捷键
	OnAccel_TaskDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.taskdlg") then
		Win_ShowWidget("UI.gameui.taskdlg",false);
		else					  
		Win_ShowWidget("UI.gameui.taskdlg",true);
		Win_SetFocus("UI.gameui.taskdlg");
		end;		
		Win_SetValue("UI.gameui.ctrlbar.taskbtn",0,value_channel_framescheme);
		return 1;
		end;
				     
	OnAccel_FamilyDlg=function()	
		if not Win_IsVisible("UI.gameui.familydetaildlg") then
			if CheckSafeModeOp(2) == 1 then
				return 0;
			end;
		end;
		
		if FilterUIKeyOper(ui_keyoper_openfamily)  ~= 0 then
			return 0;
		end;
	
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.familydetaildlg") then
			Win_ShowWidget("UI.gameui.familydetaildlg",false);
		else
			Win_ShowWidget("UI.gameui.familydetaildlg",true);
			Win_SetFocus("UI.gameui.familydetaildlg");
		end;
		return 1;
		end;
		
	OnAccel_PetDlg=function()	
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
	
		if Win_IsVisible("UI.gameui.petdlg") then
		Win_ShowWidget("UI.gameui.petdlg",false);
		else
		Win_ShowWidget("UI.gameui.petdlg",true);
		UI.children.gameui.children.petdlg.ShowSkillDlg(true);
		Win_SetFocus("UI.gameui.petdlg");
		end;
		return 1;
		end;
		
	OnAccel_TeamDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		-- 大乱斗屏蔽组队快捷键
		if IsPlayerInBattlefield() == true then
			return 0;
		end
		if Win_IsVisible("UI.gameui.teamdlg") then
		Win_ShowWidget("UI.gameui.teamdlg",false);
		else
		Win_ShowWidget("UI.gameui.teamdlg",true);
		Win_SetFocus("UI.gameui.teamdlg");
		end;
		return 1;
		end;
				    
	
			
	OnAccel_EquipDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.equipdlg") then
		Win_ShowWidget("UI.gameui.equipdlg",false);
		Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
		Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
		
		else
		Win_ShowWidget("UI.gameui.equipdlg",true);
		--UI.children.gameui.UpdateAwakeEquipDlg();
		Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
		Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
		Win_SetFocus("UI.gameui.equipdlg");
		end;
		
		
		return 1;
		end;
		
	OnAccel_AchieveDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.achievedlg") then
		Win_ShowWidget("UI.gameui.achievedlg",false);
		else
		OpenAchieveDlg(0);
		Win_SetFocus("UI.gameui.achievedlg");
		end;
		
		
		return 1;
		end;
			

	OnAccel_ChatBar=function()
		PushNewbieTips(31);
		UI.children.gameui.children.chatbar.children.sizebtn.OnClick();
		return 1;
		end;
				  
					
	OnAccel_WareDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.waredlg") then
		Win_ShowWidget("UI.gameui.waredlg",false);
		else
		Win_ShowWidget("UI.gameui.waredlg",true);
		Win_SetFocus("UI.gameui.waredlg");
		end;
		return 1;
		
		end;
				  
	OnAccel_SkillDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.skilldlg") then
		Win_ShowWidget("UI.gameui.skilldlg",false);
		else				  
		Win_ShowWidget("UI.gameui.skilldlg",true);				  
		Win_SelectSelf("UI.gameui.skilldlg.tab0");
		Win_SetFocus("UI.gameui.skilldlg.tab0");
		end;
		
		return 1;

		end;
	
	
	OnOpenPetCircleDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if Win_IsVisible("UI.gameui.petcircledlg") then
		Win_ShowWidget("UI.gameui.petcircledlg",false);
		else	
		UpdateGameUIInfo();	
		Win_ShowWidget("UI.gameui.petcircledlg",true);		
		Win_SetFocus("UI.gameui.petcircledlg");
		end;
		
		return 1;

		end;
		
	OnAccel_OptionDlg=function()	
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		
		if not Win_IsVisible("UI.gameui.sysoptiondlg") then
			if Win_IsVisible("UI.newsecuverifydlg") then
				Win_ShowWidget("UI.newsecuverifydlg",false);
			end;
			
			if Win_IsVisible("UI.newsafesecuverifydlg") then
				Win_ShowWidget("UI.newsafesecuverifydlg",false);
			end;
			Win_ShowWidget("UI.gameui.sysoptiondlg",true);						    
		end;						    
		
		return 1;
		end;
		
	OnAccel_HistoryDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if not Win_IsVisible("UI.gameui.historybar") then
			Win_ShowWidget("UI.gameui.historybar",true);		
		else
			Win_ShowWidget("UI.gameui.historybar",false);			
		end;	
	end;
	
	OnAccel_GodDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;

		Win_ToggleWidget("UI.gameui.goddlg",0);		
	end;
	
	OnAccel_RackDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		if not Win_IsVisible("UI.gameui.shopdlg") then
			if CheckSafeModeOp(2) == 1 then
				return 0;
			end;
			
			Win_SetValue("UI.gameui.ctrlbar.rackbtn",0,value_channel_framescheme);
			
			--local t = Win_GetValue("UI.gameui.ctrlbar.rackbtn",value_channel_customtype);
			--if t == 0 then
				Win_ShowWidget("UI.gameui.shopdlg",true);
			--	Win_SetValue("UI.gameui.ctrlbar.rackbtn",1,value_channel_customtype);
			--	Win_SetValue("UI.gameui.ctrlbar.rackbtn",2,value_channel_customindex);
			--	Win_SetValue("UI.gameui.ctrlbar.rackbtn",5,value_channel_timerspace);
			--else
			--	GameUILogInfo("不能频繁操作神奇货架，请稍后再试！");
			--end;
		else
			Win_ShowWidget("UI.gameui.shopdlg",false);
			ClearRack();
		end;						    
		
		return 1;
		end;
				  
	OnAccel_SketchMap=function()		
		ToggleMapDiagram();
				
		return 1;
		end;
	
	OnAccel_EMailDlg=function()
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		Win_ToggleWidget("UI.gameui.maillistdlg",0);		
		return 1;
		end;
	
	--pipo 自动打怪
	OnAccel_AutoAttack=function()
		AutoAttack();
	end;
	
	--在没有编辑焦点的时候使用的快捷键
	On_TaskDlg=function()
			     result=0;
			     if not Win_IsAcceptInput() then
			     result=1;
			     if Win_IsVisible("UI.gameui.taskdlg") then
				  Win_ShowWidget("UI.gameui.taskdlg",false);
				  else					  
				  Win_ShowWidget("UI.gameui.taskdlg",true);
				  Win_SetFocus("UI.gameui.taskdlg");
				  end;
			    end;
			    return result;
			    end;
				     
	On_FamilyDlg=function()
		result=0;
		if not Win_IsAcceptInput() then
		result=1;	
		if Win_IsVisible("UI.gameui.familydetaildlg") then
		Win_ShowWidget("UI.gameui.familydetaildlg",false);
		else
		Win_ShowWidget("UI.gameui.familydetaildlg",true);
		Win_SetFocus("UI.gameui.familydetaildlg");
		end;
		end;
		return 1;
		end;
			    
	On_PetDlg=function()
		result=0;
		if not Win_IsAcceptInput() then
		result=1;	
		if Win_IsVisible("UI.gameui.petdlg") then
		Win_ShowWidget("UI.gameui.petdlg",false);
		else
		Win_ShowWidget("UI.gameui.petdlg",true);
		UI.children.gameui.children.petdlg.ShowSkillDlg(true);
		Win_SetFocus("UI.gameui.petdlg");
		end;
		end;
		return 1;
		end;
			    
	
	On_TeamDlg=function()
		result=0;
		if not Win_IsAcceptInput() then
		result=1;	
		if Win_IsVisible("UI.gameui.teamdlg") then
		Win_ShowWidget("UI.gameui.teamdlg",false);
		else
		Win_ShowWidget("UI.gameui.teamdlg",true);
		Win_SetFocus("UI.gameui.teamdlg");
		end;
		end;
		return 1;
		end;
				    
	
			
	On_EquipDlg=function()
				  result=0;
				  if not Win_IsAcceptInput() then
				  result=1;
				  if Win_IsVisible("UI.gameui.equipdlg") then
				  Win_ShowWidget("UI.gameui.equipdlg",false);
				  else
				  Win_ShowWidget("UI.gameui.equipdlg",true);
				  Win_SetFocus("UI.gameui.equipdlg");
				  end;
				  end;
				  return result;
				  end;			     

	On_ChatBar=function()
				  result=0;
				  if not Win_IsAcceptInput() then
				  result=1;
				  PushNewbieTips(31);
				  UI.children.gameui.children.chatbar.children.sizebtn.OnClick();
				  end;
				  return result;
				 end;
				  
	On_WareDlg=function()
				result=0;
				if not Win_IsAcceptInput() then
				result=1;	
				if Win_IsVisible("UI.gameui.waredlg") then
				Win_ShowWidget("UI.gameui.waredlg",false);
				else
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_SetFocus("UI.gameui.waredlg");
				end;
				end;
				return result;
				end;
				  
	On_SkillDlg=function()
			  
			  result=0;
			  
			  if not Win_IsAcceptInput() then
			  result=1;		
			  if Win_IsVisible("UI.gameui.skilldlg") then
			  Win_ShowWidget("UI.gameui.skilldlg",false);
			  else			  
			  Win_ShowWidget("UI.gameui.skilldlg",true);
			  Win_SelectSelf("UI.gameui.skilldlg.tab0");
			  Win_SetFocus("UI.gameui.skilldlg.tab0");
			  end;
			  end;
			  
			  return result;
			  
			  end;			          
	
	On_OptionDlg=function()
			     result=0;
			     
			     if not Win_IsAcceptInput() then
			     result=1;
			     if Win_IsVisible("UI.gameui.sysoptiondlg") then
			     Win_ShowWidget("UI.gameui.sysoptiondlg",false);
			     else
				if Win_IsVisible("UI.newsecuverifydlg") then
					Win_ShowWidget("UI.newsecuverifydlg",false);
				end;
				
				if Win_IsVisible("UI.newsafesecuverifydlg") then
					Win_ShowWidget("UI.newsafesecuverifydlg",false);
				end;
			     Win_ShowWidget("UI.gameui.sysoptiondlg",true);
			     end;
			     end;
			     
			     return result;				
			     end;
			     
	On_SketchMap=function()
				 result=0;
				 if not Win_IsAcceptInput() then
				 result=1;
				 ToggleMapDiagram();
				
				 end;
				 return result;
				 end;

	On_EMailDlg=function()
				 result=0;
				 if not Win_IsAcceptInput() then
				 result=1;
				 Win_ToggleWidget("UI.gameui.maillistdlg",0);		 
				 end;
				 return result;
				end;
		
	--道具快捷键
	OnAccelItemF1_F10=function(wparam, lparam)	
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		local key = wparam - 112;
		UseItem(ui_drag_type_accel,key);	
		return 1;				  
	end;
	
	OnAccelItemF11=function()
		ToggleOtherPlayer();
	end;
	
	OnAccelItemF12=function()
		PushNewbieTips(26);
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		local bvis = Win_IsVisible("UI.gameui.integdlg");
		if bvis then
			Win_ShowWidget("UI.gameui.integdlg",false);
		else
			Win_ShowWidget("UI.gameui.integdlg",true);
			UI.children.gameui.children.integdlg.opentab(5);
		end;
	end;

	--- 2#快捷条
	OnAccelItemAlt1_10=function(wparam, lparam)
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;
		
		local key = wparam - 49;
		if wparam == 48 then
			key = 9;
		end;
		
		UseItem(ui_drag_type_accel, key+ 10);	 
	end;
	
	--- 3#快捷条
	OnAccelItemAltF1_F10=function(wparam, lparam)
		local ret = CheckUIRight();
		if ret == 0 then
			return 0;
		end;

		local key = wparam - 112;
		UseItem(ui_drag_type_accel, key+ 20);	 
	end;
		
	OnAccel_ChangeEquip=function()
		UI.children.gameui.children.changeequipdlg.children.changebtn.OnClick();
		end;
	
	OnAccel_ToggleTab=function()
		--[[
		if Win_IsVisible("UI.gameui.equipdlg") 
			or Win_IsVisible("UI.gameui.waredlg") 
			or Win_IsVisible("UI.gameui.teamdlg") 
			or Win_IsVisible("UI.gameui.skilldlg") 
			or Win_IsVisible("UI.gameui.taskdlg") 
			or Win_IsVisible("UI.gameui.shopdlg") then
			
		else
			ToggleGoalByTab();
		end;
		]]
		
		if Win_IsFocused("UI.gameui") then
			ToggleGoalByTab();
			return 1;
		end;
	end;
	
	OnAccel_ToggleNewbieHelp=function()
		RequestNewbieHelp(help_detailintroduce, -1, 20);
		end;		
	
	OnUpdatePKMode=function()
		local var=GetGameVar("nopk");
		Win_SetSelect("UI.gameui.sysconfigdlg",0,var);
		if var == 0 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_nopk.gsa");
		elseif var == 2 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_team.gsa");
		elseif var == 3 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_family.gsa");
		elseif var == 4 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_color.gsa");
		elseif var == 5 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_jun.gsa");
		elseif var == 6 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_lin.gsa");
		end;
	end;
	
	OnAccel_AccelSetPkMode=function()
		SetNextPkMode();
		local var=GetGameVar("nopk");
		Win_SetSelect("UI.gameui.sysconfigdlg",0,var);
	end;
	
	OnAccel_AccelSit=function()
		MissionSit();
		end;
		
	OnAccel_AccelItemName=function()
		ToggleItemName();
		end;
		
	OnAccel_AccelActorName=function()
		ToggleActorName();
		end;
	
	OnAccelPlus=function()
		bufinfo=Win_GetCustomBuffer("UI.gameui.sketchbar.sketchmap");
		if bufinfo.scalelevel<=0 then
		bufinfo.scalelevel=1;
		
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.plusbtn",false);
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.minusbtn",true);
		
		end;
		Win_SetCustomBuffer("UI.gameui.sketchbar.sketchmap",bufinfo);
		return 1;
		end;

	OnAccelMinus=function()
		bufinfo=Win_GetCustomBuffer("UI.gameui.sketchbar.sketchmap");
		if bufinfo.scalelevel>=1 then
		bufinfo.scalelevel=0;
		
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.minusbtn",false);
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.plusbtn",true);
		
		end;
		Win_SetCustomBuffer("UI.gameui.sketchbar.sketchmap",bufinfo);
		return 1;
		end;
		
	OnAccelPrePage=function()
		--if Win_IsEnabled("UI.gameui.accelbar.accelbarup.prebtn") then
		--	UI.children.gameui.children.accelbar.children.accelbarup.children.prebtn.OnClick();
		--end;
		end;
		
	OnAccelNextPage=function()
		--if Win_IsEnabled("UI.gameui.accelbar.accelbarup.nextbtn") then
		--	UI.children.gameui.children.accelbar.children.accelbarup.children.nextbtn.OnClick();
		--end;
		end;
	
	OnTimer=function()
		local adverinfo=GetAdvertiseInfo();
		if adverinfo~="" then
		Win_SetText("UI.gameui.advertisedlg.advertiseedit",adverinfo);
		
		if not Win_IsVisible("UI.gameui.oweoptdlg") then
		Win_ShowWidget("UI.gameui.advertisedlg",true);
		else
		Win_SetValue("UI.gameui.oweoptdlg",1,value_channel_customtype);
		end;
		end;
		Win_SetValue("UI.gameui",-1,value_channel_timerspace);
		end;
	
	--清理工作	
	OnDenit=function()
		Win_SetCheck("UI.gameui.chatbar.qqbroadcastbtn",false);		
		Win_ClearTemplates("UI.gameui",0);
		Win_SetText("UI.gameui.teamdlg.nameedit","");
		
		local bqqradioopen = Win_GetValue("UI.gameui.qqradiodlg.voiceslider",value_channel_customindex);
		if bqqradioopen~=0 then
		local voice = Win_GetValue("UI.gameui.qqradiodlg.voiceslider",value_channel_customid);
		QQBroadcastStop();
		SetGameVar("music",voice);
		end;
		
		if Win_IsVisible("UI.keyboarddlg") then
			Win_ShowWidget("UI.keyboarddlg",false);
		end;
			  
		if Win_IsVisible("UI.newsetsecudlg") then
			Win_EndWidget("UI.newsetsecudlg",false);
		end;
		
		if Win_IsVisible("UI.newresetsecudlg") then
			Win_EndWidget("UI.newresetsecudlg",false);
		end;
		
		if Win_IsVisible("UI.newsecuverifydlg") then
			Win_EndWidget("UI.newsecuverifydlg",false);
		end;
		
		if Win_IsVisible("UI.newsafesecuverifydlg") then
			Win_EndWidget("UI.newsafesecuverifydlg",false);
		end;
		
		if Win_IsVisible("UI.gameui.newselseculeveldlg") then
			Win_EndWidget("UI.gameui.newselseculeveldlg",false);
		end;
		
		Win_ShowWidget("UI.gameui.changeequipdlg.statusbtn", false);
		
		end;
		
	--初始化
	OnInit=function()
		UpdateEquipStar();
		
		Win_SetValue("UI.gameui",10,value_channel_timerspace);
		
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.minusbtn",true);
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.plusbtn",false);
		
		local var=GetGameVar("chatfade");
		if var==1 then
		Win_SetText("UI.gameui.chatbar.lockbtn","关闭聊天背景",value_channel_tiptext);
		Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_increase,value_channel_alphastate);
		Win_EnableWidget("UI.gameui.chatbar.resizepanel", true);
		else
		Win_SetText("UI.gameui.chatbar.lockbtn","开启聊天背景",value_channel_tiptext);
		Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_decrease,value_channel_alphastate);
		Win_EnableWidget("UI.gameui.chatbar.resizepanel", false);
		end;

		-- 登陆近来默认聊天框是可见的，size按钮状态设置好，即使玩家小退，近来重置。因为缩进聊天框这个没有存变量记录。
		Win_SetValue("UI.gameui.chatbar.sizebtn",0,value_channel_framescheme);						
		Win_ShowWidget("UI.gameui.chatbar.chatpanel",true);						
		
		var=GetGameVar("actionmsg");
		Win_ShowWidget("UI.gameui.chatbar.actionpanel",(var==1));
						    
		g_PlayerInfo=GetMainPlayerInfo();		
		 
		--init sketchmap,sketchbar
		bufinfo=Win_GetCustomBuffer("UI.gameui.sketchbar.sketchmap");
		bufinfo.scalelevel=100;			   
		Win_SetCustomBuffer("UI.gameui.sketchbar.sketchmap",bufinfo);	 
		
		UI.children.gameui.children.sketchbar.children.sketchmap.children.performbtn.PerformInit();
		--UI.children.gameui.children.sketchbar.children.sketchmap.children.dailyplaybtn.PerformInit();
		--UI.children.gameui.children.sketchbar.children.sketchmap.children.offlineexpbtn.PerformInit();
		
		Win_SetValue("UI.gameui.statusbar.nameicon",0,value_channel_customtype);
		local pkmode = GetPkMode();
		if pkmode == 0 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_nopk.gsa");
		elseif pkmode == 2 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_team.gsa");
		elseif pkmode == 3 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_family.gsa");
		elseif pkmode == 4 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_color.gsa");
		elseif pkmode == 5 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_jun.gsa");
		elseif pkmode == 6 then
			Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_lin.gsa");
		end;
		Win_SetValue("UI.gameui.ministatusbar.nameicon",0,value_channel_customtype);
		
		Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
		Win_SetValue("UI.gameui.oweoptdlg",0,value_channel_customtype);
		Win_SetValue("UI.gameui.questiondlg.closebtn",1, value_channel_customtype);
		Win_SetValue("UI.gameui.finalquestiondlg.closebtn",1, value_channel_customtype);
								
		Win_SelectSelf("UI.gameui.waredlg.medicinetab");
		Win_SelectSelf("UI.gameui.teamdlg.teamtab");
		--Win_SelectSelf("UI.gameui.teamdlg.friendtab");
		Win_SelectSelf("UI.gameui.taskdlg.doingtab");
		Win_SelectSelf("UI.gameui.skilldlg.tab0");
		Win_SelectSelf("UI.gameui.storedlg.storetab1");
		
		
		Win_SetValue("UI.gameui.exequipdlg",0,value_channel_sort_state);
		Win_SetValue("UI.gameui.equipdlg",0,value_channel_sort_state);
		Win_SetValue("UI.gameui.waredlg",0,value_channel_sort_state);
		Win_SetValue("UI.gameui.teamdlg",0,value_channel_sort_state);
		Win_SetValue("UI.gameui.taskdlg",0,value_channel_sort_state);
		Win_SetValue("UI.gameui.storedlg",0,value_channel_sort_state);			 		
		
		Win_HideTopMost(); 
		
		Win_ClearPathPoint("UI.gameui.probeinfowin");
		
		if GetScreenType() ~= 0 then
			Win_SetPos("UI.gameui.probeinfowin",700,768);
			Win_RelativePos("UI.gameui.lefttoplocalizer",220,85);
			Win_SetPos("UI.gameui.aanoticedlg", 800, 468);
		else
			Win_SetPos("UI.gameui.probeinfowin",424,600);
			Win_RelativePos("UI.gameui.lefttoplocalizer",185,16);
			Win_SetPos("UI.gameui.aanoticedlg", 575, 300);
		end;
		Win_ShowWidget("UI.gameui.probeinfowin",false);
		
		Win_ClearPathPoint("UI.gameui.probeinfowin1");
		if GetScreenType() ~= 0 then
			Win_SetPos("UI.gameui.probeinfowin1",700,768);
		else
			Win_SetPos("UI.gameui.probeinfowin1",424,600);
		end;
		Win_ShowWidget("UI.gameui.probeinfowin1",false);
		
		Win_SetValue("UI.gameui.chatbar.chatpanel.chatlist",0,value_channel_item_num);		
		
		Win_SetFocus("UI.gameui");		

		Win_SetValue("UI.gameui.goodexceptlist",10,value_channel_item_num);
		Win_SetValue("UI.gameui.badexceptlist",10,value_channel_item_num);
		Win_SetValue("UI.gameui.thirdexceptlist",10,value_channel_item_num);
		Win_SetValue("UI.gameui.targetbar.targetlabellist",6,value_channel_item_num);	
		Win_SetValue("UI.gameui.selflabelbar.selflabellist",2,value_channel_item_num);	
		
		Win_SetValue("UI.gameui.statusbar.godbar.godlabellist",6,value_channel_item_num);	
		Win_SetValue("UI.gameui.targetbar.godbar.godlabellist",6,value_channel_item_num);	
		
		--队伍异常状态显示
		Win_SetValue("UI.gameui.teambar.teambtn1.list",6,value_channel_item_num);	
		Win_SetValue("UI.gameui.teambar.teambtn2.list",6,value_channel_item_num);	
		Win_SetValue("UI.gameui.teambar.teambtn3.list",6,value_channel_item_num);	
		Win_SetValue("UI.gameui.teambar.teambtn4.list",6,value_channel_item_num);	
		
		--pipo-6-26
		var = IsMapLabelOpen(1) ;
		if var ~= 0 then
			Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btn",true);
		else
			Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btn",false);
		end;
		
		var = IsMapLabelOpen(2);
		if var ~= 0 then
			Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btn",true);
		else
			Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btn",false);
		end;
		
		Win_ShowWidget("UI.gameui.accelbar",true);
		
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap",true);
		Win_ShowWidget("UI.gameui.clockbar",false);
		Win_ShowWidget("UI.gameui.questiondlg",false);
		Win_ShowWidget("UI.gameui.finalquestiondlg",false);
		
		Win_SetValue("UI.gameui.statusbar.progbarHP",100, value_channel_step);
		Win_SetValue("UI.gameui.ministatusbar.progbarHP",100, value_channel_step);
		
		Win_SetValue("UI.gameui.recycledlg.recycleskilldlg.skillexbar1",0, value_channel_step);
		Win_SetValue("UI.gameui.recycledlg.recycleskilldlg.skillexbar2",0, value_channel_step);
		Win_SetValue("UI.gameui.recycledlg.recycleskilldlg.skillexbar3",0, value_channel_step);
		Win_SetValue("UI.gameui.recycledlg.recycleskilldlg.skillexbar4",0, value_channel_step);
		Win_SetValue("UI.gameui.recycledlg.recycleskilldlg.recycleskillexbar",0, value_channel_step);
		
		Win_ShowWidget("UI.gameui.timebar", false);
		Win_ShowWidget("UI.gameui.intonatebar", true);
		Win_ShowWidget("UI.gameui.showgodbar", true);
		Win_ShowWidget("UI.gameui.showitembar", true);
	
		--免费版本
		local bfree = IsFreeGame();
		if bfree ~= false then
			Win_ShowWidget("UI.gameui.statusbar.tireicon",true);
			Win_ShowWidget("UI.gameui.statusbar.staminaicon",false);
			Win_ShowWidget("UI.gameui.statusbar.manaicon",false);
		else
			Win_ShowWidget("UI.gameui.statusbar.staminaicon",true);
			Win_ShowWidget("UI.gameui.statusbar.manaicon",true);
			Win_ShowWidget("UI.gameui.statusbar.tireicon",false);
		end;
		
		Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn1",0,value_channel_customtype);
		Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn2",0,value_channel_customtype);
		Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn3",0,value_channel_customtype);
		Win_SetText("UI.gameui.qqradiodlg","",value_channel_customtext);
		Win_SetValue("UI.gameui.qqradiodlg",0,value_channel_customid);
		--QQBroadcastShowEqualizer(0);
		Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","",value_channel_effectpic);
		
		local setpetnum = GetGameVar("SetPetNum");
		SetGameVar("SetPetNum",setpetnum);
		Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", var);
		Win_SetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_pos);
				
		local voice = GetGameVar("music");
		Win_SetValue("UI.gameui.qqradiodlg.voiceslider",voice,value_channel_customid);
		Win_SetValue("UI.gameui.qqradiodlg.voiceslider",0,value_channel_customindex);
		Win_SetText("UI.gameui.qqradiodlg.broadcastbtn1","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
		Win_SetText("UI.gameui.qqradiodlg.broadcastbtn2","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
		Win_SetText("UI.gameui.qqradiodlg.broadcastbtn3","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
		Win_SetValue("UI.gameui.qqradiodlg.voiceslider",100,value_channel_pos);
		
		Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk1",false);	
		Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk2",false);	
		Win_ShowWidget("UI.gameui.selflabelbar.selflabel1effct",false);
		Win_ShowWidget("UI.gameui.selflabelbar.selflabel2effct",false);
		
		local iRecordCheck = GetRecordCheck();
		Win_ShowWidget("UI.gameui.chatbar.stoprecord", (iRecordCheck ~= 0));
			
		local hasteamconvenant = HasTeamConvenant();
		UI.children.gameui.ShowBargainBtn(hasteamconvenant);
		
		Win_SetValue("UI.gameui.ctrlbar.rackbtn",1,value_channel_framescheme);
		Win_SetValue("UI.gameui.ctrlbar.rackbtn",0,value_channel_customtype);
		Win_SetValue("UI.gameui.shopdlg.buylist",0,value_channel_item_num);
		
		if GetScreenType()~=0 then
			local creatert = Win_GetCreateRect();
		
			--chatbar
			--Win_SetText("UI.gameui.chatbar.inputbar","res/uires/chatbar/exinputbar.gsa",value_channel_backpic);
			--Win_SetValue("UI.gameui.chatbar.inputbar",3,value_channel_backpicpos,1);
			--Win_SetValue("UI.gameui.chatbar",creatert.h-37,value_channel_winrect,1);
			
			--ctrlbar
			--Win_SetText("UI.gameui.ctrlbar","res/uires/ctrlbar/exctrlbarbk.gsa",value_channel_backpic);
			--Win_SetValue("UI.gameui.ctrlbar",4,value_channel_backpicpos,1);
			--Win_SetValue("UI.gameui.chatbar",creatert.h-37,value_channel_winrect,1);
			
			--experiencebar
			if 1 == GetScreenType() then 
				Win_SetValue("UI.gameui.experiencebar",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.experiencebar",1024,value_channel_winrect,2);
				Win_SetValue("UI.gameui.experiencebar",1024,value_channel_clientrect,2);
				Win_SetValue("UI.gameui.experiencebar.effect",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.experiencebar.effect",1024,value_channel_winrect,2);
				Win_SetValue("UI.gameui.experiencebar.effect",1024,value_channel_clientrect,2);	
								
				Win_SetValue("UI.gameui.lhexperiencebar",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.lhexperiencebar",1024,value_channel_winrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar",1024,value_channel_clientrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",1024,value_channel_winrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",1024,value_channel_clientrect,2);	
			elseif 2 == GetScreenType() then 
				Win_SetValue("UI.gameui.experiencebar",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.experiencebar",1280,value_channel_winrect,2);
				Win_SetValue("UI.gameui.experiencebar",1280,value_channel_clientrect,2);
				Win_SetValue("UI.gameui.experiencebar.effect",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.experiencebar.effect",1280,value_channel_winrect,2);
				Win_SetValue("UI.gameui.experiencebar.effect",1280,value_channel_clientrect,2);	
				
				Win_SetValue("UI.gameui.lhexperiencebar",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.lhexperiencebar",1280,value_channel_winrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar",1280,value_channel_clientrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",0,value_channel_winrect,0);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",1280,value_channel_winrect,2);
				Win_SetValue("UI.gameui.lhexperiencebar.effect",1280,value_channel_clientrect,2);	
			end;
		end;
		
		SetOnlineStatus(0);
		UI.children.gameui.children.sketchbar.children.sketchmap.children.playerstatusbtn.OnFlash();
		Win_ShowWidget("UI.gameui.petexpcardwgt", false);
		Win_EnableWidget("UI.gameui.sketchbar.sketchmap.fieldmgrbtn",false);
		Win_ShowWidget("UI.gameui.stoprecordwgt", false);
		

		if GetScreenType() == 0 then
			local buffer = string.format("buffervalue={drawtype=%d,offsetx=%d,offsety=%d,};",help_simpleintroduce,395,366);
			Win_SetBufferValue("UI.gameui.newbiecustom_simpleintroduce",buffer);
			
			local buffer = string.format("buffervalue={drawtype=%d,offsetx=%d,offsety=%d,};",help_newtask_keyintro,230,166);
			Win_SetBufferValue("UI.gameui.newbiecustom_keyintro",buffer);
			
			Win_SetPos("UI.gameui.intonatebar", 333, 476);
			Win_SetPos("UI.gameui.showgodbar", 333, 476);
			Win_SetPos("UI.gameui.showitembar", 333, 476);
		else
			local buffer = string.format("buffervalue={drawtype=%d,offsetx=%d,offsety=%d,};",help_simpleintroduce,521,536);
			Win_SetBufferValue("UI.gameui.newbiecustom_simpleintroduce",buffer);
			
			local buffer = string.format("buffervalue={drawtype=%d,offsetx=%d,offsety=%d,};",help_newtask_keyintro,372,228);
			Win_SetBufferValue("UI.gameui.newbiecustom_keyintro",buffer);
			Win_SetPos("UI.gameui.intonatebar", 442, 618);
			Win_SetPos("UI.gameui.showgodbar", 442, 618);
			Win_SetPos("UI.gameui.showitembar", 442, 618);
		end;
		
		local iShowHelpSprite, iDailyHelp, iLockPos = GetHelpVar();
		Win_ShowWidget("UI.gameui.helpspritedlg", (iShowHelpSprite~= 0));
		--Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn", (iShowHelpSprite== 0));

		SetGlobalQuery(GlobalQuery_SellJude, 0);
		SetGlobalQuery(GlobalQuery_BuyJude, 0);
		SetGlobalQuery(GlobalQuery_CancelSellJudeSellJude, 0);
		
		UI.children.gameui.children.ctrlbar.OnInitUpdate();
		UI.children.gameui.children.accelbar.OnInitUpdate();
		UI.children.gameui.children.chatbar.OnInitUpdate();
		UI.children.gameui.children.goddlg.OnInitUpdate();
		
		--added by qjb 防沉迷提示优化
		Win_ShowWidget("UI.gameui.aanoticedlg",false);
		Win_ShowWidget("UI.gameui.reviveopendlg", false);
		Win_ShowWidget("UI.gameui.reviveclosedlg", false);
		
		--add by Abrahamhu 离线经验
		Win_ShowWidget("UI.gameui.offlineexpdlg", false);
	
		local info = GetSecuInfo();
		
		if info.bshowsecutip==0 then

			if info.hasseculock==0 then
				if g_PlayerInfo.LEVEL >= 30 then
					-- 原来没有注册财产安全锁的， 30级以后，每次客户端提示一次
					CmdGetSecukeyMap(); --- add by Robinyang, 2009-02-13
					Win_ShowWidget("UI.newsetsecudlg", true);
				end;
			elseif (info.hasseculock ~= 0) and (info.level == 0)  then
				-- 验证级别是原来的0 的， 要用户确认设置一次，选择1，2
				Win_ShowWidget("UI.gameui.newselseculeveldlg", true);
			end;
			
			-- 每次启动客户端仅仅提示一次。			
			SetShowSecuTipFlg(1);
		end;
		
		Win_ShowWidget("UI.gameui.statusbar.godbar.awakebtn", false);
		
		Win_SetValue("UI.gameui.teamdlg.enemytab",  0, value_channel_customid);
		
		if GetScreenType()==0 then
			Win_AlignWidget("UI.gameui.unshowbigavatarbtn", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,353,0);
		else
			Win_AlignWidget("UI.gameui.unshowbigavatarbtn", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,465,0);
		end;
		
		local px,py = GetGroupTalkListBtnSetPos();
		
		if px ~= -1 and py ~= -1 then
			Win_SetPos("UI.gameui.showgrouplistbtn",px,py);
			Win_SetPos("UI.gameui.showgrouptalkingbtn",px,py);
			if px == 0 and py == 0 then
				Win_SetPos("UI.gameui.showgrouplistbtn",0,200);
				Win_SetPos("UI.gameui.showgrouptalkingbtn",0,200);
			end;
		end;
		
		Win_ShowWidget("UI.gameui.petchangebtn",CanPetSpriteBeChanged());
	end;
	

	OnEnterMap=function(mode)
		Win_ShowWidget("UI.gameui.worldbar",false);
		Win_ShowWidget("UI.gameui.oweoptdlg",false);
		Win_ShowWidget("UI.gameui.consignpointcarddlg",false);
				
		if mode==0 then
		local talklist="UI.gameui.chatbar.chatpanel.chatlist";		
		local actionlist="UI.gameui.chatbar.actionpanel.actionlist";		
				
		local systemlist="UI.gameui.historybar.systemtab.historylist";
		local gmlist="UI.gameui.historybar.gmtab.historylist";
		local citylist="UI.gameui.historybar.citytab.historylist";
		local teamlist="UI.gameui.historybar.teamtab.historylist";
		local masterlist="UI.gameui.historybar.mastertab.historylist";
		local unionlist="UI.gameui.historybar.uniontab.historylist";
		local whisperlist="UI.gameui.historybar.whispertab.historylist";
		local nearbylist="UI.gameui.historybar.nearbytab.historylist";
		local worldlist="UI.gameui.historybar.worldtab.historylist";		
		local broadlist="UI.gameui.historybar.broadtab.historylist";		
		
		Win_SetValue(talklist,0,value_channel_item_num);
		Win_SetValue(actionlist,0,value_channel_item_num);
		
		Win_SetValue(systemlist,0,value_channel_item_num);
		Win_SetValue(gmlist,0,value_channel_item_num);
		Win_SetValue(citylist,0,value_channel_item_num);
		Win_SetValue(teamlist,0,value_channel_item_num);
		Win_SetValue(masterlist,0,value_channel_item_num);
		Win_SetValue(unionlist,0,value_channel_item_num);
		Win_SetValue(whisperlist,0,value_channel_item_num);
		Win_SetValue(nearbylist,0,value_channel_item_num);
		Win_SetValue(worldlist,0,value_channel_item_num);
		Win_SetValue(broadlist,0,value_channel_item_num);
		
		-- 清理输入框的history.
		Win_SetText("UI.gameui.chatbar.inputbar.contentedit","",value_channel_edithistory);
		end;

		if Win_IsVisible("UI.gameui.tradedlg") then
			CancelShopSale();
			Win_ShowWidget("UI.gameui.tradedlg",false);
		end;
		
		if Win_IsVisible("UI.gameui.petfosterdlg") then
			Win_ShowWidget("UI.gameui.petfosterdlg",false);
		end;
		
		Win_ShowWidget("UI.gameui.autosearchmgrdlg", false);
		
		local curmapid=GetCurMapId();
		
		-- 雪地大生存的积分显示框
		if curmapid==33400 then
			Win_ShowWidget("UI.gameui.snowscorebar",true);
		else
			Win_ShowWidget("UI.gameui.snowscorebar",false);
		end;
		
	end;
		
	OnUpdateMASpd=function()
		g_PlayerInfo=GetMainPlayerInfo();
		Win_SetText("UI.gameui.equipdlg.attrtab.mspd",g_PlayerInfo.sec_mspd);
		Win_SetText("UI.gameui.equipdlg.attrtab.aspd",g_PlayerInfo.sec_aspd);
		end;
		
	OnUpdateValue=function(changetype,changenum)
			 	
			if changetype==0 then
			
			g_PlayerInfo=GetMainPlayerInfo();
						
			g_PetInfo=GetMainPetInfo();				
			
			if g_PetInfo~=nil then	
				
				Win_SetText("UI.gameui.petdlg.prename",g_PetInfo.prename);
				
				if not Win_IsEnabled("UI.gameui.petdlg.nickname") then
				Win_SetText("UI.gameui.petdlg.nickname",g_PetInfo.nickname);
				end;
				
				if g_PetInfo.IsNotHide == 1 then
					Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheckbk", true);
					Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheck", true);
					if g_PetInfo.IsNotHideOpen == 1 then 
						Win_SetCheck("UI.gameui.petdlg.OpenBeHidecheck", false);
					else
						Win_SetCheck("UI.gameui.petdlg.OpenBeHidecheck", true);
					end; 
				else
					Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheckbk", false);
					Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheck", false);			
				end;				
				
				Win_SetText("UI.gameui.petdlg.life", g_PetInfo.CURHP);
				Win_SetText("UI.gameui.petdlg.magic", g_PetInfo.CURSP);
				Win_SetText("UI.gameui.petdlg.starve", g_PetInfo.STARVE);
				Win_SetText("UI.gameui.petdlg.trust", g_PetInfo.TRUST);
				
				Win_ShowWidget("UI.gameui.petdlg.habit",true);
				Win_ShowWidget("UI.gameui.petdlg.gender",true);			
				Win_SetValue("UI.gameui.petdlg.habit",   g_PetInfo.HABIT-1,value_channel_framescheme);
				Win_SetValue("UI.gameui.petdlg.gender", g_PetInfo.gender,value_channel_framescheme);
				
				Win_SetText("UI.gameui.petdlg.STR",g_PetInfo.STR);	
				Win_SetText("UI.gameui.petdlg.AGI",g_PetInfo.AGI);
				Win_SetText("UI.gameui.petdlg.DEX",g_PetInfo.DEX);				
				Win_SetText("UI.gameui.petdlg.VIT",g_PetInfo.VIT);	
				Win_SetText("UI.gameui.petdlg.INT",g_PetInfo.INT);	
				Win_SetText("UI.gameui.petdlg.SPI",g_PetInfo.SPI);

				Win_SetText("UI.gameui.petdlg.MaxATK", g_PetInfo.MAXATK);
				Win_SetText("UI.gameui.petdlg.MinATK", g_PetInfo.MINATK);
				Win_SetText("UI.gameui.petdlg.Def", g_PetInfo.DEF);	
				Win_SetText("UI.gameui.petdlg.Matk",g_PetInfo.MATK);	
				Win_SetText("UI.gameui.petdlg.Mdef",g_PetInfo.MDEF);	
				Win_SetText("UI.gameui.petdlg.Hit", g_PetInfo.HITRATE);	
				
				Win_SetText("UI.gameui.petdlg.pppoint", g_PetInfo.ppPoint);
				Win_SetText("UI.gameui.petdlg.newpppoint", g_PetInfo.newppPoint);
				
				if g_PetInfo.bStrPer > 0 then
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.STR", string.format("/C25力量:/C00 %3d ( %-3d )", g_PetInfo.bStrPer*4, g_PetInfo.bStrMax*4));
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.AGI", string.format("/C25敏捷:/C00 %3d ( %-3d )", g_PetInfo.bAgiPer*4, g_PetInfo.bAgiMax*4));
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.DEX", string.format("/C25灵巧:/C00 %3d ( %-3d )", g_PetInfo.bDexPer*4, g_PetInfo.bDexMax*4));
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.VIT", string.format("/C25体质:/C00 %3d ( %-3d )", g_PetInfo.bVitPer*4, g_PetInfo.bVitMax*4));
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.INT", string.format("/C25智慧:/C00 %3d ( %-3d )", g_PetInfo.bIntPer*4, g_PetInfo.bIntMax*4));
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.SPI", string.format("/C25精神:/C00 %3d ( %-3d )", g_PetInfo.bSpiPer*4, g_PetInfo.bSpiMax*4));
				else
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.STR", "/C25力量:/C00   ");
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.AGI", "/C25敏捷:/C00   ");
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.DEX", "/C25灵巧:/C00   ");
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.VIT", "/C25体质:/C00   ");
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.INT", "/C25智慧:/C00   ");
					Win_SetText("UI.gameui.petdlg.petintelligencedlg.SPI", "/C25精神:/C00   ");
				end;
				Win_SetText("UI.gameui.petdlg.point",g_PetInfo.POINTS);
				Win_ShowWidget("UI.gameui.petdlg.pointfire",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.strspinup",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.agispinup",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.intspinup",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.vitspinup",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.dexspinup",(g_PetInfo.POINTS>0));
				Win_EnableWidget("UI.gameui.petdlg.spispinup",(g_PetInfo.POINTS>0));
				
				text=g_PetInfo.EXP.."/"..g_PetInfo.EXPUP;
				Win_SetText("UI.gameui.petdlg.experience",text);
				
				Win_SetText("UI.gameui.petdlg.level",g_PetInfo.LEVEL);			
				
				-- 宠物 statusbar
				text1="生命: "..g_PetInfo.CURHP.."/"..g_PetInfo.MAXHP;
				text2="法力: "..g_PetInfo.CURSP.."/"..g_PetInfo.MAXSP;
				text = text1.."\n"..text2;
				
				Win_SetText("UI.gameui.petstatusbar",text,value_channel_tiptext);
				
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", g_PetInfo.MAXHP,value_channel_maxvalue);
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", g_PetInfo.CURHP,value_channel_pos);
							
				scheme=math.floor(g_PetInfo.CURHP*3/g_PetInfo.MAXHP);
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", scheme,value_channel_framescheme);
				
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", g_PetInfo.MAXSP,value_channel_maxvalue);
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", g_PetInfo.CURSP,value_channel_pos);
				
				scheme=math.floor(g_PetInfo.CURSP*3/g_PetInfo.MAXSP);
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", scheme,value_channel_framescheme);
				
				if Win_IsVisible("UI.SysTooltip") then
					wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
					if (wgtpath=="UI.gameui.petstatusbar") then
						Win_SetText("UI.SysTooltip",text);
					end;
				end;			
				
				else
				--init petinfo
				Win_EnableWidget("UI.gameui.petdlg.nickname",false);
				
				Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheckbk", false);
				Win_ShowWidget("UI.gameui.petdlg.OpenBeHidecheck", false);			
				
				Win_SetText("UI.gameui.petdlg.prename","");
				Win_SetText("UI.gameui.petdlg.nickname","");				
				
				Win_SetText("UI.gameui.petdlg.life", "");
				Win_SetText("UI.gameui.petdlg.magic", "");
				Win_SetText("UI.gameui.petdlg.starve", "");
				Win_SetText("UI.gameui.petdlg.trust", "");
				
				Win_ShowWidget("UI.gameui.petdlg.habit",false);
				Win_ShowWidget("UI.gameui.petdlg.gender",false);
				Win_SetValue("UI.gameui.petdlg.habit",   0,value_channel_framescheme);
				Win_SetValue("UI.gameui.petdlg.gender", 0,value_channel_framescheme);
				
				Win_SetText("UI.gameui.petdlg.STR","");	
				Win_SetText("UI.gameui.petdlg.AGI","");	
				Win_SetText("UI.gameui.petdlg.DEX","");	
				Win_SetText("UI.gameui.petdlg.VIT","");	
				Win_SetText("UI.gameui.petdlg.INT","");	
				Win_SetText("UI.gameui.petdlg.SPI","");	

				Win_SetText("UI.gameui.petdlg.MaxATK", "");	
				Win_SetText("UI.gameui.petdlg.MinATK", "");	
				Win_SetText("UI.gameui.petdlg.Def", "");	
				Win_SetText("UI.gameui.petdlg.Matk","");	
				Win_SetText("UI.gameui.petdlg.Mdef","");	
				Win_SetText("UI.gameui.petdlg.Hit", "");	
								
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.STR", "/C25力量:/C00   ");
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.AGI", "/C25敏捷:/C00   ");
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.DEX", "/C25灵巧:/C00   ");
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.VIT", "/C25体质:/C00   ");
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.INT", "/C25智慧:/C00   ");
				Win_SetText("UI.gameui.petdlg.petintelligencedlg.SPI", "/C25精神:/C00   ");
								
				Win_SetText("UI.gameui.petdlg.point","");
				Win_ShowWidget("UI.gameui.petdlg.pointfire",false);
				Win_EnableWidget("UI.gameui.petdlg.strspinup",false);
				Win_EnableWidget("UI.gameui.petdlg.agispinup",false);
				Win_EnableWidget("UI.gameui.petdlg.intspinup",false);
				Win_EnableWidget("UI.gameui.petdlg.vitspinup",false);
				Win_EnableWidget("UI.gameui.petdlg.dexspinup",false);
				Win_EnableWidget("UI.gameui.petdlg.spispinup",false);
				
				Win_SetText("UI.gameui.petdlg.experience","0/0");
				
				Win_SetText("UI.gameui.petdlg.level","");		
				
				Win_SetText("UI.gameui.petdlg.pppoint", "");
				Win_SetText("UI.gameui.petdlg.newpppoint", "");			
				
				Win_SetText("UI.gameui.petstatusbar","",value_channel_tiptext);
				
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", 0,value_channel_maxvalue);
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", 0,value_channel_pos);
				Win_SetValue("UI.gameui.petstatusbar.petbarHP", 0,value_channel_framescheme);
				
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", 0,value_channel_maxvalue);
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", 0,value_channel_pos);
				Win_SetValue("UI.gameui.petstatusbar.petbarMP", 0,value_channel_framescheme);
			end;	
			
			Win_ShowWidget("UI.gameui.petchangebtn",CanPetSpriteBeChanged());
			
			--equipdlg
			bufinfo=Win_GetCustomBuffer("UI.gameui.equipdlg.equiptab.charactor");
			bufinfo.race=g_PlayerInfo.race;			   
			bufinfo.gender=g_PlayerInfo.gender;
			bufinfo.suitid=g_PlayerInfo.suitid;			   
			bufinfo.hair=g_PlayerInfo.HAIR;		   
			Win_SetCustomBuffer("UI.gameui.equipdlg.equiptab.charactor",bufinfo);
			Win_SetCustomBuffer("UI.gameui.timelimiteddlg.charactor",bufinfo);	-- haifenghe 时装角色
			Win_SetText("UI.gameui.equipdlg.contribute", g_PlayerInfo.CONTRIBUTION);
			
			--equipdlg
			Win_SetText("UI.gameui.equipdlg","等级 "..(g_PlayerInfo.LEVEL).." "..(g_PlayerInfo.racename)..":"..(g_PlayerInfo.name) );	
			Win_SetText("UI.gameui.equipdlg.title",g_PlayerInfo.title);
			Win_SetText("UI.gameui.equipdlg.reputation",g_PlayerInfo.HONOR);	
			Win_SetText("UI.gameui.equipdlg.goodness", g_PlayerInfo.pkvalue);			
			text=g_PlayerInfo.EXP.."/"..g_PlayerInfo.EXPUP;
			Win_SetText("UI.gameui.equipdlg.experience",text);
			--配偶，亲密度
			Win_SetText("UI.gameui.equipdlg.matename", g_PlayerInfo.matename);
			Win_SetText("UI.gameui.equipdlg.friendliness", g_PlayerInfo.friendliness);
			--个人威望
			Win_SetText("UI.gameui.equipdlg.prestige", g_PlayerInfo.SELFPRESTIG);
			--政绩
			Win_SetText("UI.gameui.equipdlg.officecarrerctr", g_PlayerInfo.officecarrerctr);
			--竞技称号
			Win_SetText("UI.gameui.equipdlg.arenatitle", g_PlayerInfo.arenatitle);
			--是否秀出竞技称号
			Win_SetCheck("UI.gameui.equipdlg.arenatitlecheck", g_PlayerInfo.isshowarenatitle);
			
			--左边
			Win_SetText("UI.gameui.equipdlg.point",g_PlayerInfo.POINTS);
			Win_ShowWidget("UI.gameui.equipdlg.pointfire",(g_PlayerInfo.POINTS>0));
						
			local pstr=0;
			local pagi=0;
			local pdex=0;
			local pvit=0;
			local pint=0;
			local pspi=0;
			
			if g_PetInfo~=nil then	
				pstr = math.floor(g_PetInfo.STR * g_PetInfo.bStrPer/255 + 0.5);
				pagi = math.floor(g_PetInfo.AGI * g_PetInfo.bAgiPer/255 + 0.5);
				pdex = math.floor(g_PetInfo.DEX * g_PetInfo.bDexPer/255 + 0.5);
				pvit = math.floor(g_PetInfo.VIT * g_PetInfo.bVitPer/255 + 0.5);
				pint = math.floor(g_PetInfo.INT * g_PetInfo.bIntPer/255 + 0.5);
				pspi = math.floor(g_PetInfo.SPI * g_PetInfo.bSpiPer/255 + 0.5);
			end;
			
					
			Win_SetText("UI.gameui.equipdlg.STR",g_PlayerInfo.STR);			
			Win_SetText("UI.gameui.equipdlg.STR",(g_PlayerInfo.STR-pstr).."+"..pstr,value_channel_tiptext);			
			Win_SetText("UI.gameui.equipdlg.AGI",g_PlayerInfo.AGI);	
			Win_SetText("UI.gameui.equipdlg.AGI",(g_PlayerInfo.AGI-pagi).."+"..pagi,value_channel_tiptext);			
			Win_SetText("UI.gameui.equipdlg.DEX",g_PlayerInfo.DEX);	
			Win_SetText("UI.gameui.equipdlg.DEX",(g_PlayerInfo.DEX-pdex).."+"..pdex,value_channel_tiptext);			
			Win_SetText("UI.gameui.equipdlg.VIT",g_PlayerInfo.VIT);	
			Win_SetText("UI.gameui.equipdlg.VIT",(g_PlayerInfo.VIT-pvit).."+"..pvit,value_channel_tiptext);			
			Win_SetText("UI.gameui.equipdlg.INT",g_PlayerInfo.INT);	
			Win_SetText("UI.gameui.equipdlg.INT",(g_PlayerInfo.INT-pint).."+"..pint,value_channel_tiptext);			
			Win_SetText("UI.gameui.equipdlg.SPI",g_PlayerInfo.SPI);	
			Win_SetText("UI.gameui.equipdlg.SPI",(g_PlayerInfo.SPI-pspi).."+"..pspi,value_channel_tiptext);			
			
			--右边
			Win_SetText("UI.gameui.equipdlg.MaxATK", g_PlayerInfo.MAXATK);
			Win_SetText("UI.gameui.equipdlg.MinATK", g_PlayerInfo.MINATK);			 
			Win_SetText("UI.gameui.equipdlg.Def", g_PlayerInfo.DEF);	
			Win_SetText("UI.gameui.equipdlg.Matk",g_PlayerInfo.MATK);	
			Win_SetText("UI.gameui.equipdlg.Mdef",g_PlayerInfo.MDEF);	
			Win_SetText("UI.gameui.equipdlg.Hit", g_PlayerInfo.HITRATE);	
			
			
			--二级属性
			local hurtabsorbbase = g_PlayerInfo.sec_hurtabsorb_add;
			local hurtabsorbadd = g_PlayerInfo.sec_hurtabsorb_mul;
			local txt = hurtabsorbbase.."+"..hurtabsorbadd.."%";
			Win_SetText("UI.gameui.equipdlg.attrtab.hurtabsorb",txt);
			
			local mhurtabsorbbase = g_PlayerInfo.sec_mhurtabsorb_add;
			local mhurtabsorbadd = g_PlayerInfo.sec_mhurtabsorb_mul;
			local txt = mhurtabsorbbase.."+"..mhurtabsorbadd.."%";
			Win_SetText("UI.gameui.equipdlg.attrtab.mhurtabsorb",txt);
			
			Win_SetText("UI.gameui.equipdlg.attrtab.critical",g_PlayerInfo.sec_critical.."%");
			Win_SetText("UI.gameui.equipdlg.attrtab.mcritical",g_PlayerInfo.sec_mcritical.."%");
			Win_SetText("UI.gameui.equipdlg.attrtab.finalhit",g_PlayerInfo.sec_finalhit.."%");
			Win_SetText("UI.gameui.equipdlg.attrtab.finalflee",g_PlayerInfo.sec_finalflee.."%");
			Win_SetText("UI.gameui.equipdlg.attrtab.mspd",g_PlayerInfo.sec_mspd);
			Win_SetText("UI.gameui.equipdlg.attrtab.aspd",g_PlayerInfo.sec_aspd);
			
			Win_SetText("UI.gameui.equipdlg.attrtab.firedamage",g_PlayerInfo.firehurt);
			Win_SetText("UI.gameui.equipdlg.attrtab.icedamage",g_PlayerInfo.icehurt);
			Win_SetText("UI.gameui.equipdlg.attrtab.thunderdamage",g_PlayerInfo.thunderhurt);
			Win_SetText("UI.gameui.equipdlg.attrtab.darkdamage",g_PlayerInfo.darkhurt);
			
			local percent;
			Win_SetText("UI.gameui.equipdlg.attrtab.refire",g_PlayerInfo.firedef);
			percent=math.ceil(g_PlayerInfo.firedef/(g_PlayerInfo.LEVEL*30+200)*100);
			Win_SetText("UI.gameui.equipdlg.attrtab.refire","可额外减免"..percent.."%受到的火焰攻击带来的魔法伤害", value_channel_tiptext);
			
			Win_SetText("UI.gameui.equipdlg.attrtab.reice",g_PlayerInfo.icedef);
			percent=math.ceil(g_PlayerInfo.icedef/(g_PlayerInfo.LEVEL*30+200)*100);
			Win_SetText("UI.gameui.equipdlg.attrtab.reice","可额外减免"..percent.."%受到的冰冻攻击带来的魔法伤害", value_channel_tiptext);
			
			Win_SetText("UI.gameui.equipdlg.attrtab.rethunder",g_PlayerInfo.thunderdef);
			percent=math.ceil(g_PlayerInfo.thunderdef/(g_PlayerInfo.LEVEL*30+200)*100);
			Win_SetText("UI.gameui.equipdlg.attrtab.rethunder","可额外减免"..percent.."%受到的雷电攻击带来的魔法伤害", value_channel_tiptext);
			
			Win_SetText("UI.gameui.equipdlg.attrtab.redark",g_PlayerInfo.darkdef);
			percent=math.ceil(g_PlayerInfo.darkdef/(g_PlayerInfo.LEVEL*30+200)*100);
			Win_SetText("UI.gameui.equipdlg.attrtab.redark","可额外减免"..percent.."%受到的黑暗攻击带来的魔法伤害", value_channel_tiptext);
			
			--timebar
			local iMinute, iExp, iNewType = GetWorldExp();
			if Win_IsVisible("UI.gameui.timebar") then
				if iExp < 0 then	-- 发布任务
					if iNewType == 0 then 
						text="修炼元神：已修炼"..(30-iMinute).."分钟".."，还需"..iMinute.."分钟。"
						Win_SetText("UI.gameui.timebar",text,value_channel_tiptext);
						
						if iMinute == 0 and Win_IsVisible("UI.gameui.timebar.effect") == false then
							Win_ShowWidget("UI.gameui.timebar.effect", true);
						end;
						
						Win_SetValue("UI.gameui.timebar.progbar", 30,value_channel_maxvalue);
						Win_SetValue("UI.gameui.timebar.progbar",30-iMinute,value_channel_pos);
					else
						text="修炼元神：已修炼"..(150-iMinute).."分钟".."，还需"..iMinute.."分钟。"
						Win_SetText("UI.gameui.timebar",text,value_channel_tiptext);
						
						if iMinute == 0 and Win_IsVisible("UI.gameui.timebar.effect") == false then
							Win_ShowWidget("UI.gameui.timebar.effect", true);
						end;
						
						Win_SetValue("UI.gameui.timebar.progbar", 150,value_channel_maxvalue);
						Win_SetValue("UI.gameui.timebar.progbar",150-iMinute,value_channel_pos);
					end;
				else			--接受任务
					text="元神之光：已储存"..iExp.."经验，元神之光效果还有"..iMinute.."分钟时间。"
					Win_SetText("UI.gameui.timebar", text,value_channel_tiptext);
				
					if iMinute == 0 and Win_IsVisible("UI.gameui.timebar.effect") == false then
						Win_ShowWidget("UI.gameui.timebar.effect", true);
					end;
					
					Win_SetValue("UI.gameui.timebar.progbar", 60, value_channel_maxvalue);
					Win_SetValue("UI.gameui.timebar.progbar", 60-iMinute, value_channel_pos);
				end;
			end;

			--statusbar
			text="生命: "..g_PlayerInfo.CURHP.."/"..g_PlayerInfo.MAXHP;
			Win_SetText("UI.gameui.statusbar.progbarHP",text,value_channel_tiptext);
			Win_SetText("UI.gameui.ministatusbar.progbarHP",text,value_channel_tiptext);
			
			Win_SetValue("UI.gameui.statusbar.progbarHP", g_PlayerInfo.MAXHP,value_channel_maxvalue);
			Win_SetValue("UI.gameui.ministatusbar.progbarHP", g_PlayerInfo.MAXHP,value_channel_maxvalue);
			
			Win_SetValue("UI.gameui.statusbar.progbarHP",g_PlayerInfo.CURHP,value_channel_pos);
			Win_SetValue("UI.gameui.ministatusbar.progbarHP",g_PlayerInfo.CURHP,value_channel_pos);
			
			scheme=math.floor(g_PlayerInfo.CURHP*3/g_PlayerInfo.MAXHP);
			Win_SetValue("UI.gameui.statusbar.progbarHP",scheme,value_channel_framescheme);
			Win_SetValue("UI.gameui.ministatusbar.progbarHP",scheme,value_channel_framescheme);
			
			text = GetLunHuiEquipExp();
			Win_SetText("UI.gameui.lunhuidlg.leveluptab.progbarEXP",text,value_channel_tiptext);
			Win_SetText("UI.gameui.lunhuidlg.tunshijinyantab.progbarEXP",text,value_channel_tiptext);
						
			if Win_IsVisible("UI.SysTooltip") then
			wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
			if (wgtpath=="UI.gameui.lunhuidlg.leveluptab.progbarEXP") or (wgtpath=="UI.gameui.lunhuidlg.tunshijinyantab.progbarEXP") then
			Win_SetText("UI.SysTooltip",text);
			end;
			end;
			
			 
			text="法力: "..g_PlayerInfo.CURSP.."/"..g_PlayerInfo.MAXSP;
			Win_SetText("UI.gameui.statusbar.progbarMP",text,value_channel_tiptext);
			Win_SetText("UI.gameui.ministatusbar.progbarMP",text,value_channel_tiptext);
						
			Win_SetValue("UI.gameui.statusbar.progbarMP", g_PlayerInfo.MAXSP,value_channel_maxvalue);
			Win_SetValue("UI.gameui.ministatusbar.progbarMP", g_PlayerInfo.MAXSP,value_channel_maxvalue);
			
			Win_SetValue("UI.gameui.statusbar.progbarMP",g_PlayerInfo.CURSP,value_channel_pos);
			Win_SetValue("UI.gameui.ministatusbar.progbarMP",g_PlayerInfo.CURSP,value_channel_pos);
			
			scheme=math.floor(g_PlayerInfo.CURSP*3/g_PlayerInfo.MAXSP);
			Win_SetValue("UI.gameui.statusbar.progbarMP",scheme,value_channel_framescheme);
			Win_SetValue("UI.gameui.ministatusbar.progbarMP",scheme,value_channel_framescheme);
			
			UI.children.gameui.UpdateRecycleBar();
			
			if Win_IsVisible("UI.SysTooltip") then
			wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
			if (wgtpath=="UI.gameui.statusbar.progbarMP") or (wgtpath=="UI.gameui.ministatusbar.progbarMP")then
			Win_SetText("UI.SysTooltip",text);
			end;
			end;
			
			local finishachievecount,achievecount = GetAchieveFinishBarInfo();

			text="已完成成就"..finishachievecount.."/"..achievecount;
			Win_SetText("UI.gameui.achievedlg.progbar",text,value_channel_tiptext);
			
			if Win_IsVisible("UI.SysTooltip") then
			wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
			if wgtpath=="UI.gameui.achievedlg.progbar" then
			Win_SetText("UI.SysTooltip",text);
			end;
			end;

			-- 阵营图标[joeyxiong 03/10/2011]
			camptip={"无阵营", "恶魔阵营", "天使阵营"};
			Win_SetValue("UI.gameui.statusbar.campicon", g_PlayerInfo.catcamp, value_channel_framescheme);
			Win_SetText("UI.gameui.statusbar.campicon", camptip[g_PlayerInfo.catcamp + 1], value_channel_tiptext);
		
			text="经验: "..g_PlayerInfo.EXP.."/"..g_PlayerInfo.EXPUP;
			Win_SetText("UI.gameui.experiencebar",text,value_channel_tiptext);
			Win_SetValue("UI.gameui.experiencebar", g_PlayerInfo.EXPUP,value_channel_maxvalue);			
			Win_SetValue("UI.gameui.experiencebar",g_PlayerInfo.EXP,value_channel_pos);
			Win_SetText("UI.gameui.experiencebar.effect",text,value_channel_tiptext);
			
			scheme=math.floor(g_PlayerInfo.EXP*3/g_PlayerInfo.EXPUP);
			Win_SetValue("UI.gameui.experiencebar",scheme,value_channel_framescheme);
			
			if Win_IsVisible("UI.SysTooltip") then
				wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
				if (wgtpath=="UI.gameui.experiencebar" or wgtpath=="UI.gameui.experiencebar.effect") then
					Win_SetText("UI.SysTooltip",text);
				end;
			end;
			
			text="轮回经验: "..g_PlayerInfo.LHEXP.."/"..g_PlayerInfo.LHEXPUP;
			Win_SetText("UI.gameui.lhexperiencebar",text,value_channel_tiptext);
			Win_SetValue("UI.gameui.lhexperiencebar", g_PlayerInfo.LHEXPUP,value_channel_maxvalue);			
			Win_SetValue("UI.gameui.lhexperiencebar",g_PlayerInfo.LHEXP,value_channel_pos);
			Win_SetText("UI.gameui.lhexperiencebar.effect",text,value_channel_tiptext);
			
			scheme=math.floor(g_PlayerInfo.LHEXP*3/g_PlayerInfo.LHEXPUP);
			Win_SetValue("UI.gameui.lhexperiencebar",scheme,value_channel_framescheme);
			
			if Win_IsVisible("UI.SysTooltip") then
				wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
				if (wgtpath=="UI.gameui.lhexperiencebar" or wgtpath=="UI.gameui.lhexperiencebar.effect") then
					Win_SetText("UI.SysTooltip",text);
				end;
			end;
			
			if IsFreeGame() == false then
			
				--耐力
				text="耐力: "..g_PlayerInfo.STAMINA.."/100";
				Win_SetText("UI.gameui.statusbar.staminaicon",text,value_channel_tiptext);
				
				if Win_IsVisible("UI.SysTooltip") then
				wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
				if (wgtpath=="UI.gameui.statusbar.staminaicon") then
				Win_SetText("UI.SysTooltip",text);
				end;
				end;
				
				--念力
				text="念力: "..g_PlayerInfo.MANA.."/100";
				Win_SetText("UI.gameui.statusbar.manaicon",text,value_channel_tiptext);
				
				if Win_IsVisible("UI.SysTooltip") then
				wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
				if (wgtpath=="UI.gameui.statusbar.manaicon") then
				Win_SetText("UI.SysTooltip",text);
				end;
				end;
			
			else
				
				--疲劳度
				text="疲劳度: "..g_PlayerInfo.TIRE.."/100";
				Win_SetText("UI.gameui.statusbar.tireicon",text,value_channel_tiptext);
				
				if Win_IsVisible("UI.SysTooltip") then
				wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
				if (wgtpath=="UI.gameui.statusbar.tireicon") then
				Win_SetText("UI.SysTooltip",text);
				end;
				end;
			
			end;
			
			--多倍经验
			local expstate = GetExpState();
			if expstate==1 then
				local pretip = "";
				if g_PlayerInfo.exptimes == 2 then
					pretip = "双倍经验(未开启): ";
				elseif g_PlayerInfo.exptimes == 3 then
					pretip = "三倍经验(未开启): ";
				elseif g_PlayerInfo.exptimes == 4 then
					pretip = "四倍经验(未开启): ";
				else
					pretip = "多倍经验(未开启): ";
				end;
				
				local tiptext;
				if g_PlayerInfo.expleftstore > 0 then
					tiptext = pretip..g_PlayerInfo.expleftstore.."/"..g_PlayerInfo.expleftstore;
				else
					tiptext = pretip..g_PlayerInfo.expleft.."/"..g_PlayerInfo.expleft;
				end;
				
				Win_SetText("UI.gameui.statusbar.nameicon",tiptext,value_channel_tiptext);
				
				if Win_IsVisible("UI.SysTooltip") then
					wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
					if (wgtpath=="UI.gameui.statusbar.nameicon") then
					Win_SetText("UI.SysTooltip",tiptext);
					end;
				end;
				
				local disptype = Win_GetValue("UI.gameui.statusbar.nameicon",value_channel_customtype);
				if disptype ~= 1 then
					UI.children.gameui.children.statusbar.children.nameicon.BeginEffect(0);
				end;
			elseif expstate==2 then
				local pretip = "";
				if g_PlayerInfo.exptimes == 2 then
					pretip = "双倍经验: ";
				elseif g_PlayerInfo.exptimes == 3 then
					pretip = "三倍经验: ";
				elseif g_PlayerInfo.exptimes == 4 then
					pretip = "四倍经验: ";
				else
					pretip = "多倍经验: ";
				end;
					
				local tiptext = pretip..g_PlayerInfo.expleft.."/"..g_PlayerInfo.exptotal;
				Win_SetText("UI.gameui.statusbar.nameicon",tiptext,value_channel_tiptext);
				
				if Win_IsVisible("UI.SysTooltip") then
					wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
					if (wgtpath=="UI.gameui.statusbar.nameicon") then
					Win_SetText("UI.SysTooltip",tiptext);
					end;
				end;
				
				local disptype = Win_GetValue("UI.gameui.statusbar.nameicon",value_channel_customtype);
				if disptype ~= 2 then
					UI.children.gameui.children.statusbar.children.nameicon.BeginEffect(1);
				end;
			else
				Win_SetText("UI.gameui.statusbar.nameicon","",value_channel_tiptext);
				UI.children.gameui.children.statusbar.children.nameicon.EndEffect();
				
				if Win_IsVisible("UI.SysTooltip") then
					wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
					if (wgtpath=="UI.gameui.statusbar.nameicon") then
					Win_ShowWidget("UI.SysTooltip",false);
					end;
				end;
			end;
			
			local name,other = string.gsub(g_PlayerInfo.name,'-','\0');
			Win_SetText("UI.gameui.statusbar.levelicon",g_PlayerInfo.LEVEL);
			Win_SetText("UI.gameui.statusbar.nameicon",name);	
			Win_SetText("UI.gameui.ministatusbar.nameicon",name);	
			
			if g_PlayerInfo.LHLEVEL > 0 then
				Win_ShowWidget("UI.gameui.statusbar.lhlevel",true); 
				Win_ShowWidget("UI.gameui.lhexperiencebar",true); 
				Win_SetText("UI.gameui.statusbar.lhlevel",g_PlayerInfo.LHLEVEL);
				
				Win_SetText("UI.gameui.statusbar.headlgithicon","res/uires/statusbar/lhheadlight.gsa",value_channel_backpic);
				Win_AlignWidget("UI.gameui.statusbar.headlgithicon", "UI.gameui.statusbar",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,0,-2);
			else 
				Win_ShowWidget("UI.gameui.statusbar.lhlevel",false); 
				Win_ShowWidget("UI.gameui.lhexperiencebar",false); 
				Win_SetText("UI.gameui.statusbar.lhlevel","0");
				
				Win_SetText("UI.gameui.statusbar.headlgithicon","res/uires/statusbar/headlight.gsa",value_channel_backpic);
				Win_AlignWidget("UI.gameui.statusbar.headlgithicon", "UI.gameui.statusbar",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,7,-5);
			end;
						
			--钱数目变化
			--负重变化
			elseif changetype==1 then
			
			local storemoney=GetMoney(0);
		        local gold=math.floor(storemoney/1000000);
     		        local silver=math.floor((storemoney-gold*1000000)/1000);
		        local copper=storemoney-gold*1000000-silver*1000;
		        Win_SetText("UI.gameui.storedlg.goldedit",gold);
		        Win_SetText("UI.gameui.storedlg.silveredit",silver);
		        Win_SetText("UI.gameui.storedlg.copperedit",copper);	
			
			Win_SetText("UI.gameui.storedlg0.goldedit",gold);
		        Win_SetText("UI.gameui.storedlg0.silveredit",silver);
		        Win_SetText("UI.gameui.storedlg0.copperedit",copper);	
			
			local bsell=Win_GetValue("UI.gameui.tradedlg",value_channel_customtype);
			local money=GetMoney();
			local goldbill=GetGoldBill();
			local price1, price2;
			if Win_IsVisible("UI.gameui.tradedlg") then
				local taxinfo = GetRevenueValue();
				if taxinfo.taxrate < 0 then
					price1, price2=GetTotalPrice(1);
				else
					price1, price2=GetTotalPrice(0);
				end;
			else
				price1, price2=GetTotalPrice(0);
			end;
			local packweight=GetPackWeight();
			local maxweight=GetMaxWeight();
			local afterweight=GetWeightAfterShop();	
			local bonus = GetBonus(0);
			local totalbonus = GetBonus(1);
			local bowlder = GetMyJude();
			
			gold=math.floor(money/1000000);
			silver=math.floor((money-gold*1000000)/1000);
			copper=money-gold*1000000-silver*1000;
			
			billgold=math.floor(goldbill/1000000);
			billsilver=math.floor((goldbill-billgold*1000000)/1000);
			billcopper=goldbill-billgold*1000000-billsilver*1000;
			
			Win_SetText("UI.gameui.waredlg.goldedit",gold);
			Win_SetText("UI.gameui.waredlg.silveredit",silver);
			Win_SetText("UI.gameui.waredlg.copperedit",copper);
			
			Win_SetText("UI.gameui.lotterydlg.goldedit",gold);
			Win_SetText("UI.gameui.lotterydlg.silveredit",silver);
			Win_SetText("UI.gameui.lotterydlg.copperedit",copper);
			
			Win_SetText("UI.gameui.waredlg.regoldedit",billgold);
			Win_SetText("UI.gameui.waredlg.resilveredit",billsilver);
			Win_SetText("UI.gameui.waredlg.recopperedit",billcopper);	
			Win_SetText("UI.gameui.waredlg.assetsedit",g_PlayerInfo.ASSETS);
			Win_SetText("UI.gameui.waredlg.activeedit",g_PlayerInfo.ACTIVE);
			
			Win_SetText("UI.gameui.shopquerydlg.goldlabel",gold);
			Win_SetText("UI.gameui.shopquerydlg.silverlabel",silver);
			Win_SetText("UI.gameui.shopquerydlg.copperlabel",copper);	
			
			Win_SetText("UI.gameui.repairdlg.goldedit",gold);
			Win_SetText("UI.gameui.repairdlg.silveredit",silver);
			Win_SetText("UI.gameui.repairdlg.copperedit",copper);

			Win_SetText("UI.gameui.repairdlg.regoldedit",billgold);
			Win_SetText("UI.gameui.repairdlg.resilveredit",billsilver);
			Win_SetText("UI.gameui.repairdlg.recopperedit",billcopper);

			Win_SetText("UI.gameui.tradedlg.goldedit",gold);
			Win_SetText("UI.gameui.tradedlg.silveredit",silver);
			Win_SetText("UI.gameui.tradedlg.copperedit",copper);

			Win_SetText("UI.gameui.tradedlg.regoldedit",billgold);
			Win_SetText("UI.gameui.tradedlg.resilveredit",billsilver);
			Win_SetText("UI.gameui.tradedlg.recopperedit",billcopper);
			
			Win_SetText("UI.gameui.exchangedlg.mybonuslabel",bonus);
			--Win_SetText("UI.gameui.exchangedlg.totalbonuslabel",totalbonus);
					
			if Win_IsVisible("UI.gameui.cancelselljudedlg") then
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.copperlabel",copper);
				Win_SetText("UI.gameui.cancelselljudedlg.mytotaljude",bowlder);
			end;
			
			if Win_IsVisible("UI.gameui.buyjudedlg") then
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.copperlabel",copper);
				Win_SetText("UI.gameui.buyjudedlg.mytotaljude",bowlder);
			end;
			
			if Win_IsVisible("UI.gameui.selljudedlg") then
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.copperlabel",copper);
				Win_SetText("UI.gameui.selljudedlg.mytotaljude",bowlder);
			end;
			
			Win_SetText("UI.gameui.waredlg.weightedit",packweight.."/"..maxweight);
			Win_SetText("UI.gameui.tradedlg.weightedit",packweight.."/"..maxweight);
			Win_SetText("UI.gameui.exchangedlg.weightedit",packweight.."/"..maxweight);
			Win_SetText("UI.gameui.shopquerydlg.weightlabel",packweight.."/"..maxweight);
			
			Win_SetText("UI.gameui.shopdlg.myweightlabel",packweight);
			
			--Win_SetText("UI.gameui.lotterydlg.bowlderlabel",bowlder);
			Win_SetText("UI.gameui.rewarddlg.bowlderedit",bowlder);
			Win_SetText("UI.gameui.waredlg.bowlderedit",bowlder);
			Win_SetText("UI.gameui.shopdlg.myjudelabel",bowlder);
			
			local color=GetColorIndex(255,255,255);			
			if (packweight>=(maxweight*0.7)) then
			color=GetColorIndex(255,0,0);		
			end;			
			Win_SetValue("UI.gameui.waredlg.weightedit",color,value_channel_color_draw);
			Win_SetValue("UI.gameui.tradedlg.weightedit",color,value_channel_color_draw);
			Win_SetValue("UI.gameui.exchangedlg.weightedit",color,value_channel_color_draw);
			Win_SetText("UI.gameui.shopquerydlg.weightlabel",color,value_channel_color_draw);
			
			color=GetColorIndex(255,255,255);			
			if ((afterweight>maxweight)and(bsell==0)) then
			color=GetColorIndex(255,0,0);		
			end;			
			Win_SetValue("UI.gameui.tradedlg.weightlabel",color,value_channel_color_draw);
			Win_SetValue("UI.gameui.exchangedlg.weightlabel",color,value_channel_color_draw);
			
			if Win_IsVisible("UI.gameui.tradedlg") then
				UI.children.gameui.ShowMakeMoneyAndGoldBill(20, price1, price2);
			else	
				color=GetColorIndex(255,255,255);			
				if ((price1>money)and(bsell==0)) then
				color=GetColorIndex(255,0,0);	
				end;			
				Win_SetValue("UI.gameui.tradedlg.goldlabel",color,value_channel_color_draw);
				Win_SetValue("UI.gameui.tradedlg.silverlabel",color,value_channel_color_draw);
				Win_SetValue("UI.gameui.tradedlg.copperlabel",color,value_channel_color_draw);
			end;
			
			Win_SetText("UI.gameui.waredlg.diamondedit", GetDiamond());
			
			--Win_SetValue("UI.gameui.exchangedlg.totalbonuslabel",color,value_channel_color_draw);
						
			if bsell==0 then
				if Win_IsVisible("UI.gameui.tradedlg")  and Win_IsChecked("UI.gameui.tradedlg.regoldbtn") then				
					Win_EnableWidget("UI.gameui.tradedlg.tradebtn",( (afterweight<=maxweight)and (price1<=money+GetGoldBill()) ));
				else
					Win_EnableWidget("UI.gameui.tradedlg.tradebtn",( (afterweight<=maxweight)and (price1<=money) ));
				end;
			else
				Win_EnableWidget("UI.gameui.tradedlg.tradebtn",true);
			end;
			
			local battlehonor = GetBattleHonor();
			Win_SetText("UI.gameui.fieldexchgdlg.honor",battlehonor);
			
			--幸运轮盘的活跃度
			local activeval = GetActiveVal();
			--Win_SetText("UI.gameui.lotterydlg.activelabel",activeval);
			
			--出售购买列表栏位数目变化
			elseif changetype==2 then				
			
			if Win_IsVisible("UI.gameui.tradedlg") then
				Win_SetValue("UI.gameui.tradedlg.rightlist",changenum,value_channel_item_num);
			elseif Win_IsVisible("UI.gameui.exchangedlg") then
				Win_SetValue("UI.gameui.exchangedlg.rightlist",changenum,value_channel_item_num);
			elseif Win_IsVisible("UI.gameui.fmvoteexchgdlg") then
				Win_SetValue("UI.gameui.fmvoteexchgdlg.rightlist",changenum,value_channel_item_num);
			elseif Win_IsVisible("UI.gameui.safetradedlg") then
				Win_SetValue("UI.gameui.safetradedlg.rightlist",changenum,value_channel_item_num);
			end;
			
			Win_EnableWidget("UI.gameui.tradedlg.clearbtn",(changenum>0));
			Win_EnableWidget("UI.gameui.exchangedlg.clearbtn",(changenum>0));
			
			local bsell=Win_GetValue("UI.gameui.tradedlg",value_channel_customtype);
			local money=GetMoney();			 
			local price1, price2;
			if Win_IsVisible("UI.gameui.tradedlg") then
				local taxinfo = GetRevenueValue();
				if taxinfo.taxrate < 0 then
					price1, price2=GetTotalPrice(1);
				else
					price1, price2=GetTotalPrice(0);
				end;
			else
				price1, price2=GetTotalPrice(0);
			end;
			local packweight=GetPackWeight();
			local maxweight=GetMaxWeight();
			local afterweight=GetWeightAfterShop();
			local bowlder = GetMyJude();
			
			local bonus = GetBonus(0);
			Win_SetText("UI.gameui.exchangedlg.mybonuslabel",bonus);
			
			Win_SetText("UI.gameui.exchangedlg.totalbonuslabel",price1);
			   			   
			Win_SetText("UI.gameui.tradedlg.weightlabel",afterweight-packweight);	
			Win_SetText("UI.gameui.exchangedlg.weightlabel",afterweight-packweight);
						
			local color=GetColorIndex(255,255,255);			
			if ((afterweight>maxweight)and(bsell==0)) then
			color=GetColorIndex(255,0,0);		
			end;			
			Win_SetValue("UI.gameui.tradedlg.weightlabel",color,value_channel_color_draw);
			Win_SetValue("UI.gameui.exchangedlg.weightlabel",color,value_channel_color_draw);
			
			if Win_IsVisible("UI.gameui.tradedlg") then
				UI.children.gameui.ShowMakeMoneyAndGoldBill(20, price1, price2);
			else	
				color=GetColorIndex(255,255,255);			
				if ((price1>money)and(bsell==0)) then
				color=GetColorIndex(255,0,0);		
				end;			
				Win_SetValue("UI.gameui.tradedlg.goldlabel",color,value_channel_color_draw);
				Win_SetValue("UI.gameui.tradedlg.silverlabel",color,value_channel_color_draw);
				Win_SetValue("UI.gameui.tradedlg.copperlabel",color,value_channel_color_draw);
				
				Win_SetValue("UI.gameui.exchangedlg.totalbonuslabel",color,value_channel_color_draw);
			end;
			
			if bsell==0 then
				if Win_IsVisible("UI.gameui.tradedlg")  and Win_IsChecked("UI.gameui.tradedlg.regoldbtn") then				
					Win_EnableWidget("UI.gameui.tradedlg.tradebtn",( (afterweight<=maxweight)and (price1<=money+GetGoldBill()) ));
				else
					Win_EnableWidget("UI.gameui.tradedlg.tradebtn",( (afterweight<=maxweight)and (price1<=money) ));
				end;
			else
				Win_EnableWidget("UI.gameui.tradedlg.tradebtn",true);
			end;
					   
						
			--对方输入交易的钱数变化
			elseif changetype==3 then		   	
				
			   money=changenum;
			   gold=math.floor(money/1000000);
			   silver=math.floor((money-gold*1000000)/1000);
			   copper=money-gold*1000000-silver*1000;
			   Win_SetText("UI.gameui.dealdlg.goldlabel",gold);
			   Win_SetText("UI.gameui.dealdlg.silverlabel",silver);
			   Win_SetText("UI.gameui.dealdlg.copperlabel",copper);			
			
			--地图名称变化			
			elseif changetype==5 then	
			   mapname=GetCurMapName();
			   Win_SetText("UI.gameui.sketchbar",mapname);
			   Win_SetText("UI.gameui.sketchbar",mapname,value_channel_tiptext);
			   
			--神奇货架出售列表发生变化
			elseif changetype==6 then
				UI.children.gameui.OnUpdateMagicRackDlg(0);
			
			--神奇货架购买列表发生变化
			elseif changetype==7 then
				if Win_IsVisible("UI.gameui.shopdlg") then
					Win_SetValue("UI.gameui.shopdlg.buylist",changenum,value_channel_item_num);
					local money=GetMyJude();			 
					local price=GetTotalJude();
					local packweight=GetRackPackWeight();
					local maxweight=GetMaxWeight();
					local afterweight=GetWeightAfterRackShop();
					   
					Win_SetText("UI.gameui.shopdlg.myjudelabel",money);
					Win_SetText("UI.gameui.shopdlg.needjudelabel",price);					
					Win_SetText("UI.gameui.shopdlg.myweightlabel",(afterweight-packweight));	
					Win_SetText("UI.gameui.shopdlg.goodsweigthlabel",packweight);	
					
					local color=GetColorIndex(255,255,255);			
					if (afterweight>maxweight) then
					color=GetColorIndex(255,0,0);		
					end;			
					Win_SetValue("UI.gameui.shopdlg.myweightlabel",color,value_channel_color_draw);
					
					color=GetColorIndex(255,255,255);			
					if (afterweight>maxweight) then
					color=GetColorIndex(255,0,0);		
					end;			
					Win_SetValue("UI.gameui.shopdlg.goodsweigthlabel",color,value_channel_color_draw);
					
					color=GetColorIndex(255,255,255);			
					if (price>money) then
					color=GetColorIndex(255,0,0);		
					end;			
					Win_SetValue("UI.gameui.shopdlg.needjudelabel",color,value_channel_color_draw);
					
					--Win_EnableWidget("UI.gameui.shopdlg.buybtn",( (afterweight<=maxweight)and (price<=money) ));
					Win_EnableWidget("UI.gameui.shopdlg.clearbtn",changenum>0);
				end;
			end;
			 
			UI.children.gameui.children.equipdlg.OnUpdateValue();
			UI.children.gameui.children.exequipdlg.OnUpdateValue();
			UI.children.gameui.children.goddlg.OnUpdateValue();
			UI.children.gameui.children.godpracticedlg.OnUpdateValue();
			UI.children.gameui.children.godpracticeagentdlg.OnUpdateValue();
			if Win_IsVisible("UI.gameui.pkskilldlg") then
				UI.children.gameui.children.pkskilldlg.OnUpdateValue();
			end
			
			local bFlag = CanArmorTransform()
			local bInBattle = IsPlayerInBattlefield()
			if bFlag == true and bInBattle == false then
				if Win_IsVisible("UI.gameui.taozhuangchangebtn") ~= true then
					Win_ShowWidget("UI.gameui.taozhuangchangebtn", true);
				end;
			else
				if Win_IsVisible("UI.gameui.taozhuangchangebtn") then
					Win_ShowWidget("UI.gameui.taozhuangchangebtn", false);
				end;
			end;
			
			end;	

	EnableSetTeamBtn=function()
		local info = TeamGetInfo();
		if info.nmember > 0 then
			if info.isleader ~= 0 then
				Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.setbtn",true);
			else
				Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.setbtn",false);
			end;
		else
			Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.setbtn",false);
		end;
		end;
		
	OnOpenOtherPet=function(bshow)
		if bshow then
			g_PetInfo=GetOtherPet();				
				
			if g_PetInfo~=nil then	
				Win_SetText("UI.gameui.targetbar.petbar.nameicon", g_PetInfo.nickname);
				Win_SetText("UI.gameui.targetbar.petbar.levelicon", g_PetInfo.LEVEL);
				 
				Win_SetValue("UI.gameui.targetbar.petbar.petcurskill", g_PetInfo.ActiveSkill, value_channel_dragindex);
			else
				Win_ShowWidget("UI.gameui.targetbar.petbar", false);
			end;
			
			goalgod = GetGoalGodInfo();
			if goalgod.hasgod ==  1 then
				Win_ShowWidget("UI.gameui.targetbar.petbar", false);
				if  g_PetInfo~=nil and g_PetInfo.LEVEL > 0 then 
					Win_SetText("UI.gameui.targetbar.godbar.petlevelicon", g_PetInfo.LEVEL);
					Win_ShowWidget("UI.gameui.targetbar.godbar.petlevelicon", true);
					Win_ShowWidget("UI.gameui.targetbar.godbar.peticon", true);
				else
					Win_ShowWidget("UI.gameui.targetbar.godbar.petlevelicon", false);
					Win_ShowWidget("UI.gameui.targetbar.godbar.peticon", false);	
					Win_SetText("UI.gameui.targetbar.godbar.petlevelicon", 0);					
				end;				
			else
				if  g_PetInfo~=nil and g_PetInfo.LEVEL > 0 then 
					Win_ShowWidget("UI.gameui.targetbar.petbar", true);			
				end;
			end;
			
			--查看其他玩家宠物信息，等服务器返回后再显示
			local b = UI.children.gameui.children.otherpetdlg._showinfo;
			if b and b==1 then
				g_PetInfo=GetOtherPet();
				if g_PetInfo~=nil and g_PetInfo.defidx~=0 then
					Win_ShowWidget("UI.gameui.otherpetdlg",true);
				else
					GameUILogInfo("该玩家目前没带宠不能查看宠物!");
				end;
				UI.children.gameui.children.otherpetdlg._showinfo = 0;
			end;
		else
			Win_ShowWidget("UI.gameui.targetbar.petbar", false);
		end;
		
		end;
		
	OnOpenStopRecordBtn=function(bshow)
		Win_ShowWidget("UI.gameui.chatbar.stoprecord",bshow~=0);
		end;
	
	OnCloseMsgBox=function()
		if Win_IsVisible("UI.SysMsgbox") then
			Win_ShowWidget("UI.SysMsgbox",false);
		end;
	end;
	
	OnOpenIntonateBar=function(bshow, bok, name)
	end;
		
	OnOpenTimeBar=function(bShow, iType)
		Win_ShowWidget("UI.gameui.timebar", bShow~=0);
		Win_ShowWidget("UI.gameui.timebar.effect", false);
		Win_SetValue("UI.gameui.timebar.progbar", iType, value_channel_framescheme);
	end;
	
	--宠物培育
	OnOpenPetFosterDlg=function(bshow, opentype)
		Win_SetValue("UI.gameui.petfosterdlg",opentype,value_channel_customtype);
		Win_ShowWidget("UI.gameui.petfosterdlg",bshow~=0);
		
		if bshow == 0 then
			if Win_IsVisible("UI.gameui.petdlg") then
				Win_ShowWidget("UI.gameui.petdlg",false);
			end;
		end;
		end;
		
	OnUpdatePetFosterDlg=function(otherpet, mypet, timelabel, money, canaffirm, canfoster)
		Win_ShowWidget("UI.gameui.petfosterdlg.otherpetinfo", otherpet~=0);
		Win_ShowWidget("UI.gameui.petfosterdlg.mypetinfo", mypet~=0);
		Win_SetText("UI.gameui.petfosterdlg.timelabel", timelabel);
		
		local gold=math.floor(money/1000000);
     		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		
		Win_SetText("UI.gameui.petfosterdlg.goldlabel",gold);
		Win_SetText("UI.gameui.petfosterdlg.silverlabel",silver);
		Win_SetText("UI.gameui.petfosterdlg.copperlabel",copper);
		
		Win_EnableWidget("UI.gameui.petfosterdlg.affirmbtn", canaffirm~=0);
		Win_EnableWidget("UI.gameui.petfosterdlg.fosterbtn", canfoster~=0);
		Win_EnableWidget("UI.gameui.petfosterdlg.singlefosterbtn", canfoster~=0);
		end;
		
	OnCloseDlgForBattle=function()
		if Win_IsVisible("UI.gameui.storedlg") then
			Win_ShowWidget("UI.gameui.storedlg",false);
			end;
		
		if Win_IsVisible("UI.gameui.storedlg0") then
			Win_ShowWidget("UI.gameui.storedlg0",false);
			end;
			
		if Win_IsVisible("UI.gameui.dealdlg") then
			Win_ShowWidget("UI.gameui.dealdlg",false);
			end;
			
		if Win_IsVisible("UI.gameui.composedlg") then
			Win_ShowWidget("UI.gameui.composedlg",false);
			end;
			
		if Win_IsVisible("UI.gameui.sculpdlg") then
			Win_ShowWidget("UI.gameui.sculpdlg",false);
			end;
			
		if Win_IsVisible("UI.gameui.composedlg") then
			Win_ShowWidget("UI.gameui.composedlg",false);
			end;
		
		if Win_IsVisible("UI.gameui.querycomposedlg") then
			Win_ShowWidget("UI.gameui.querycomposedlg",false);
			end;
			
		if Win_IsVisible("UI.gameui.studydlg") then
			Win_ShowWidget("UI.gameui.studydlg",false);
			end;
		
		end;
		
	OnOpenStashPswDlg=function(bshow)
		Win_ShowWidget("UI.gameui.inputstashpassdlg",bshow~=0);
		end;
		
	OnOpenFieldFinishDlg=function(flag, num)
		if flag == 1 then
			Win_ShowWidget("UI.gameui.fieldfinishdlg",true);
		else
			Win_ShowWidget("UI.gameui.fieldfinishdlg",false);
		end;
		
		Win_SetValue("UI.gameui.fieldfinishdlg.memlist",num,value_channel_item_num);
		end;
		
	OnUpdateFieldBtnStatus=function(benable)
		Win_EnableWidget("UI.gameui.sketchbar.sketchmap.fieldmgrbtn",benable~=0);
		UI.children.gameui.children.battlemgrdlg.OnUpdateStatus();
		if benable==0 and Win_IsVisible("UI.gameui.battlemgrdlg") then
			Win_ShowWidget("UI.gameui.battlemgrdlg",false);
		end;
		end;
	
	OnOpenFieldMgrDlg=function(bshow)
		Win_ShowWidget("UI.gameui.battlemgrdlg",bshow~=0);
		end;
		
	OnOpenFieldExchgDlg=function(num,title,name,honor)
		Win_ShowWidget("UI.gameui.fieldexchgdlg",true);
		Win_SetValue("UI.gameui.fieldexchgdlg.leftlist",num,value_channel_item_num);
		Win_SetValue("UI.gameui.fieldexchgdlg.leftlist",0,value_channel_sel);
		if num > 0 then
			UI.children.gameui.children.fieldexchgdlg.children.leftlist.children.exchgitem0.OnClick();
		end;
		
		Win_SetText("UI.gameui.fieldexchgdlg.title",title);
		Win_SetText("UI.gameui.fieldexchgdlg.name",name);
		Win_SetText("UI.gameui.fieldexchgdlg.honor",honor);
		
		end;
		
	SelectFieldExchgItem=function(idx)
		local num = Win_GetValue("UI.gameui.fieldexchgdlg.leftlist",value_channel_item_num);
		if idx >= 0 and idx < num then
			for i=0, num-1 do
				if idx == i then
					Win_SetText("UI.gameui.fieldexchgdlg.leftlist.exchgitem"..i,"res/uires/activity/battleexchgitembk.gsa",value_channel_adornpic);
				else
					Win_SetText("UI.gameui.fieldexchgdlg.leftlist.exchgitem"..i,"",value_channel_adornpic);
				end;
			end;
		end;
		end;
		
	--PVP装备系统
	OnPVPRefineStatus=function(bshow,equipinfo,materialinfo,resultinfo,costinfo,bcando)
		if bshow==0 then
			Win_ShowWidget("UI.gameui.pvprefinedlg",false);
		else
			if not Win_IsVisible("UI.gameui.pvprefinedlg") then
				Win_ShowWidget("UI.gameui.pvprefinedlg",true);
			end;
			
			Win_SetText("UI.gameui.pvprefinedlg.equiplabel",equipinfo);
			Win_SetText("UI.gameui.pvprefinedlg.materiallabel",materialinfo);
			Win_SetText("UI.gameui.pvprefinedlg.destequiplabel",resultinfo);
			Win_SetText("UI.gameui.pvprefinedlg.costlabel",costinfo);
			
			Win_EnableWidget("UI.gameui.pvprefinedlg.refinebtn",bcando~=0);
		end;
		end;
		
	OnPVPExRefineStatus=function(bshow,equiplabel,materiallabel,destequiplabel,costlabel,bcando)
		if bshow==0 then
			Win_ShowWidget("UI.gameui.pvpexrefinedlg",false);
		else
			if not Win_IsVisible("UI.gameui.pvpexrefinedlg") then
				Win_ShowWidget("UI.gameui.pvpexrefinedlg",true);
			end;
			
			Win_SetText("UI.gameui.pvpexrefinedlg.equiplabel",equiplabel);
			Win_SetText("UI.gameui.pvpexrefinedlg.materiallabel",materiallabel);
			Win_SetText("UI.gameui.pvpexrefinedlg.destequiplabel",destequiplabel);
			Win_SetText("UI.gameui.pvpexrefinedlg.costlabel",costlabel);
			
			Win_EnableWidget("UI.gameui.pvpexrefinedlg.exrefinebtn",bcando~=0);
		end;
		end;
		
	OnPVPFuseStatus=function(bshow,info1,info2,info3,info4,bcando)
		if bshow==0 then
			Win_ShowWidget("UI.gameui.pvpfusedlg",false);
		else
			if not Win_IsVisible("UI.gameui.pvpfusedlg") then
				Win_ShowWidget("UI.gameui.pvpfusedlg",true);
			end;
			
			Win_SetText("UI.gameui.pvpfusedlg.label1",info1);
			Win_SetText("UI.gameui.pvpfusedlg.label2",info2);
			Win_SetText("UI.gameui.pvpfusedlg.label3",info3);
			Win_SetText("UI.gameui.pvpfusedlg.label4",info4);
			
			Win_EnableWidget("UI.gameui.pvpfusedlg.fusebtn",bcando~=0);
		end;
		end;
		
	--家族领地
	OnOpenManorNpcBHXJDlg=function()
		Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",true);
	end;
	
	--打开参与战争家族列表
	OnOpenFMLandFamilyViewDlg=function()
		Win_ShowWidget("UI.gameui.fmlandfmviewdlg",true);
	end;
	
	--打开参与战争某个家族详细信息
	OnOpenFMLandFMViewDlg=function()
		Win_ShowWidget("UI.gameui.fmlandfmdetaildlg",true);
	end;
	
	OnOpenFMLandMoneyMgrDlg=function(bshow)
		Win_ShowWidget("UI.gameui.Revenue_MoneyMgrDlg", bshow~=0);
	end;
	
	--申请加入家族
	OnOpenReqJoinUnionDlg=function(name, leader, level, online, total)
		Win_ShowWidget("UI.gameui.reqjoinuniondlg", true);
		
		Win_SetText("UI.gameui.reqjoinuniondlg.namelabel", name);
		Win_SetText("UI.gameui.reqjoinuniondlg.leaderlabel", leader);
		Win_SetText("UI.gameui.reqjoinuniondlg.levellabel", level);
		Win_SetText("UI.gameui.reqjoinuniondlg.onlinelabel", online);
		Win_SetText("UI.gameui.reqjoinuniondlg.totallabel", total);
	end;
	
	--打开战争资料列表
	OnOpenFMLandHistDlg=function(icount)
		Win_ShowWidget("UI.gameui.fmlandhistorydlg", true);
		Win_SetValue("UI.gameui.fmlandhistorydlg.list",icount,value_channel_item_num);
	end;
	
	--打开某条详细战争资料
	OnOpenFMLandHistInfoDlg=function()
		Win_ShowWidget("UI.gameui.fmlandhistoryinfodlg", true);
		Win_SetFocus("UI.gameui.fmlandhistoryinfodlg");
	end;
	
	--打开设置工资窗口
	OnOpenSetWageRateDlg=function(bshow, inum, igold, isliver, icopper, iwagerate)
		if bshow ~=0 then
			Win_ShowWidget("UI.gameui.setwageratedlg", true);
			
			Win_SetText("UI.gameui.setwageratedlg.revenuegoldlabel", igold);
			Win_SetText("UI.gameui.setwageratedlg.revenuesliverlabel", isliver);
			Win_SetText("UI.gameui.setwageratedlg.revenuecopperlabel", icopper);

			Win_SetText("UI.gameui.setwageratedlg.wagelabel", math.floor(igold*iwagerate/100));
			Win_SetValue("UI.gameui.setwageratedlg.wageslider", iwagerate);
			Win_SetValue("UI.gameui.setwageratedlg.list",inum,value_channel_item_num);
			
			Win_SetText("UI.gameui.setwageratedlg.surpluslabel", 0);
			Win_SetText("UI.gameui.setwageratedlg.surpluspercentlabel", 0);
			
			UI.children.gameui.children.setwageratedlg.children.rateedit.OnUpdate();
		else
			Win_ShowWidget("UI.gameui.setwageratedlg", false);
		end;
	end;
		
	OnOpenManorViewLairdInfoDlg=function()
		Win_ShowWidget("UI.gameui.Manor_ViewLairdInfoDlg",true);
		end;
		
	OnOpenManorStartWarDlg=function()
		Win_ShowWidget("UI.gameui.Manor_StartWarDlg",true);
		end;
		
	OnOpenManorJoinWarDlg=function()
		Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",true);
		end;
		
	OnOpenRevenueSWGDlg=function(cityname, cansetrate, canviewincome, cangettax)
		Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",true);
		Win_SetText("UI.gameui.Revenue_ShuiWuGuanDlg.cityname",cityname);
		
		Win_EnableWidget("UI.gameui.Revenue_ShuiWuGuanDlg.changetaxratebtn",cansetrate~=0);
		
		Win_EnableWidget("UI.gameui.Revenue_ChangeTaxRateDlg.affirmbtn",cansetrate~=0);
		Win_EnableWidget("UI.gameui.Revenue_ChangeTaxRateDlg.rateslider",cansetrate~=0);
		Win_EnableWidget("UI.gameui.Revenue_ShuiWuGuanDlg.viewtatalincomebtn",canviewincome~=0);
		Win_EnableWidget("UI.gameui.Revenue_ShuiWuGuanDlg.gettaxbtn",cangettax~=0);
	end;
	--end家族领地		
	
	OnStartLandFmCounter=function(cnttime)
		UI.children.gameui.children.fmlandcounter.OnStartCounter(cnttime);
	end;
	
	OnCloseGameUIUnlockSecuDlg=function()
		Win_ShowWidget("UI.newsecuverifydlg",false);
		end;
		
	OnOpenFmFieldRank=function(bshow)
		Win_ShowWidget("UI.gameui.fmfieldrankdlg",bshow~=0);
		end;
		
	OnOpenLandVoteRank=function(bshow)
		Win_ShowWidget("UI.gameui.landvoterankdlg",bshow~=0);
		end;

	OnOpenLandFmmemMgrDlg=function(bshow)
		Win_ShowWidget("UI.gameui.landfmmemmgrdlg", bshow~=0);
	end;
	
	OnUpdateLandFmmemMgrDlg=function()
		local num1 = GetLandFmMemNum(1);
		local num2 = GetLandFmMemNum(2);
		Win_SetValue("UI.gameui.landfmmemmgrdlg.battlememlist", num1, value_channel_item_num);
		Win_SetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", num2, value_channel_item_num);
		local sel1 = Win_GetValue("UI.gameui.landfmmemmgrdlg.battlememlist", value_channel_sel);
		if sel1 >= num1 and num1 > 0 then
			Win_SetValue("UI.gameui.landfmmemmgrdlg.battlememlist", 0, value_channel_sel);
		elseif num1 == 0 then
			Win_SetValue("UI.gameui.landfmmemmgrdlg.battlememlist", -1, value_channel_sel);
			Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn1", false);
		end;
		local sel2 = Win_GetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", value_channel_sel);
		if sel2 >= num2 and num2 > 0 then
			Win_SetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", 0, value_channel_sel);
		elseif num2 == 0 then
			Win_SetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", -1, value_channel_sel);
			Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn2", false);
		end;
		for i=0, num1-1 do
			local info = GetLandFmMemInfo(1, i);
			if info.isonline == 1 then
				Win_SetText("UI.gameui.landfmmemmgrdlg.battlememlist", info.name.."     "..info.prof.."    "..info.level,value_channel_itemtext,i);
			else 
				Win_SetText("UI.gameui.landfmmemmgrdlg.battlememlist", "/C20"..info.name.."     "..info.prof.."    "..info.level,value_channel_itemtext,i);
			end;
		end;
		for i=0, num2-1 do
			local info = GetLandFmMemInfo(2, i);
			if info.isonline == 1 then
				Win_SetText("UI.gameui.landfmmemmgrdlg.supplymemlist", info.name.."     "..info.prof.."    "..info.level,value_channel_itemtext,i);
			else 
				Win_SetText("UI.gameui.landfmmemmgrdlg.supplymemlist", "/C20"..info.name.."     "..info.prof.."    "..info.level,value_channel_itemtext,i);
			end;
		end;
	end;

	OnOpenFPMemCfgDlg=function(bshow)
		Win_ShowWidget("UI.gameui.memcfgdlg", bshow~=0);
		end;
		
	OnUpdateFPMemCfg=function()
		local fpbonus = FPGetRegMemBonus();
		Win_SetText("UI.gameui.memcfgdlg.scorelabel", fpbonus);
		
		local maxnum = FPGetRegLimit();
		local curnum = FPGetStandbyMemNum();
		Win_SetValue("UI.gameui.memcfgdlg.addlist",curnum,value_channel_item_num);
		Win_SetText("UI.gameui.memcfgdlg.numlabel", curnum.."/"..maxnum);
		
		end;
		
	OnOpenFmMemBonusRankDlg=function(bshow,num)
		Win_ShowWidget("UI.gameui.fmmembonusrankdlg", bshow~=0);
		Win_SetValue("UI.gameui.fmmembonusrankdlg.memlist",num,value_channel_item_num);
		Win_SetValue("UI.gameui.fmmembonusrankdlg.memlist",0,value_channel_sel);
		end;
		
	OnOpenMyFmVoteNumDlg=function(myname, mynum, curnum, totalnum)
		Win_ShowWidget("UI.gameui.myfmvotenumdlg",true);
		Win_SetText("UI.gameui.myfmvotenumdlg.fmnamelabel",myname);	
		Win_SetText("UI.gameui.myfmvotenumdlg.votenumlabel",mynum);
		Win_SetText("UI.gameui.myfmvotenumdlg.fmnuminfolabel","已达票数家族/参战家族上限("..curnum.."/"..totalnum..")");
		end;
		
	OnOpenUnlockSecuDlg=function(bshow)
		Win_ShowWidget("UI.newsecuverifydlg", bshow~=0);
		if (bshow~=0) then
			Win_SetFocus("UI.newsecuverifydlg");
			UI.children.newsecuverifydlg.OnShowKeyBoard();
		end;
		end;
		
		
	--pipo320
	OnShowArrowBtn=function(iLeftPos, bshow)
		if iLeftPos == 0 then
			Win_ShowWidget("UI.gameui.downarrowbtn", bshow~=0);
		else
			Win_ShowWidget("UI.gameui.uparrowbtn", bshow~=0);
		end;
	end;
	
	OnOpenInviteBuddyDlg = function(name, gender, level, prof, szInfo)
		Win_ShowWidget("UI.gameui.invitebuddydlg", true);
		Win_SetText("UI.gameui.invitebuddydlg.titlenamelabel", name);
		Win_SetText("UI.gameui.invitebuddydlg.namelabel", name);
		Win_SetText("UI.gameui.invitebuddydlg.levellabel", level);
		Win_SetText("UI.gameui.invitebuddydlg.proflabel", prof);
		Win_SetText("UI.gameui.invitebuddydlg.infolabel", szInfo);
		SetUIHeadVar(0, gender);
	end;
	
	OnOpenReqjoinTeamDlg = function(name, gender, level, prof)
		Win_ShowWidget("UI.gameui.reqjointeamdlg", true);
		Win_SetText("UI.gameui.reqjointeamdlg.titlename", name);
		Win_SetText("UI.gameui.reqjointeamdlg.name", name);
		Win_SetText("UI.gameui.reqjointeamdlg.level",  level);		
		Win_SetText("UI.gameui.reqjointeamdlg.prof", prof);
		SetUIHeadVar(0, gender);
	end;
	
	OnOpenInviteTeam = function(operatorname, teamname, name1, gender1, level1, prof1, name2, gender2, level2, prof2, name3, gender3, level3, prof3, name4, gender4, level4, prof4)
		Win_ShowWidget("UI.gameui.inviteteamdlg", true);
		
		Win_SetText("UI.gameui.inviteteamdlg.titlename", operatorname);
		Win_SetText("UI.gameui.inviteteamdlg.teamname", teamname);
		
		if name1 ~= "" then
			Win_SetText("UI.gameui.inviteteamdlg.name1", name1);
			Win_SetText("UI.gameui.inviteteamdlg.level1", level1);
			Win_SetText("UI.gameui.inviteteamdlg.prof1", prof1);
			SetUIHeadVar(0, gender1);
		else
			Win_SetText("UI.gameui.inviteteamdlg.name1", "");
			Win_SetText("UI.gameui.inviteteamdlg.level1", "");
			Win_SetText("UI.gameui.inviteteamdlg.prof1", "");
			SetUIHeadVar(0, -1);
		end;
		
		if name2 ~= "" then
			Win_SetText("UI.gameui.inviteteamdlg.name2", name2);
			Win_SetText("UI.gameui.inviteteamdlg.level2", level2);
			Win_SetText("UI.gameui.inviteteamdlg.prof2", prof2);
			SetUIHeadVar(1, gender2);
		else
			Win_SetText("UI.gameui.inviteteamdlg.name2", "");
			Win_SetText("UI.gameui.inviteteamdlg.level2", "");
			Win_SetText("UI.gameui.inviteteamdlg.prof2", "");
			SetUIHeadVar(1, -1);
		end;

		if name3 ~= "" then
			Win_SetText("UI.gameui.inviteteamdlg.name3", name3);
			Win_SetText("UI.gameui.inviteteamdlg.level3", level3);
			Win_SetText("UI.gameui.inviteteamdlg.prof3", prof3);
			SetUIHeadVar(2, gender3);
		else
			Win_SetText("UI.gameui.inviteteamdlg.name3", "");
			Win_SetText("UI.gameui.inviteteamdlg.level3", "");
			Win_SetText("UI.gameui.inviteteamdlg.prof3", "");
			SetUIHeadVar(2, -1);
		end;

		if name4 ~= "" then
			Win_SetText("UI.gameui.inviteteamdlg.name4", name4);
			Win_SetText("UI.gameui.inviteteamdlg.level4", level4);
			Win_SetText("UI.gameui.inviteteamdlg.prof4", prof4);
			SetUIHeadVar(3, gender4);
		else
			Win_SetText("UI.gameui.inviteteamdlg.name4", "");
			Win_SetText("UI.gameui.inviteteamdlg.level4", "");
			Win_SetText("UI.gameui.inviteteamdlg.prof4", "");
			SetUIHeadVar(3, -1);
		end;
	end;	
	
	OnOpenReqjoinFamilyDlg = function(name, gender, level, prof, info)
		Win_ShowWidget("UI.gameui.reqjoinfamilydlg", true);
		Win_SetText("UI.gameui.reqjoinfamilydlg.title", name);
		Win_SetText("UI.gameui.reqjoinfamilydlg.name", name);
		Win_SetText("UI.gameui.reqjoinfamilydlg.level", level);
		Win_SetText("UI.gameui.reqjoinfamilydlg.prof", prof);	
		Win_SetText("UI.gameui.reqjoinfamilydlg.info", info);
		SetUIHeadVar(0, gender);		
	end;
	
	OnOpenReqMasterDlg=function(name, gender, level, prof, info)
		Win_ShowWidget("UI.gameui.reqmasterdlg",true);
		Win_SetText("UI.gameui.reqmasterdlg.title", name);
		Win_SetText("UI.gameui.reqmasterdlg.name", name);
		Win_SetText("UI.gameui.reqmasterdlg.level", level);
		Win_SetText("UI.gameui.reqmasterdlg.prof", prof);	
		Win_SetText("UI.gameui.reqmasterdlg.info", info);
		SetUIHeadVar(4, gender);
		end;
		
	OnOpenReqreqPrenticeDlg=function(name, gender, level, prof, info)
		Win_ShowWidget("UI.gameui.reqprenticedlg",true);
		Win_SetText("UI.gameui.reqprenticedlg.title", name);
		Win_SetText("UI.gameui.reqprenticedlg.name", name);
		Win_SetText("UI.gameui.reqprenticedlg.level", level);
		Win_SetText("UI.gameui.reqprenticedlg.prof", prof);	
		Win_SetText("UI.gameui.reqprenticedlg.info", info);
		SetUIHeadVar(4, gender);
		end;
	
	OnOpenInviteFamilyDlg = function(operatorname, familyname, shaikhname, level, credit, numinfo, szInfo)
		Win_ShowWidget("UI.gameui.invitefamilydlg", true);
		Win_SetText("UI.gameui.invitefamilydlg.operatorname", operatorname);
		Win_SetText("UI.gameui.invitefamilydlg.titlefmlname", familyname);
		Win_SetText("UI.gameui.invitefamilydlg.fmilyname", familyname);
		Win_SetText("UI.gameui.invitefamilydlg.shaikhname", shaikhname);
		Win_SetText("UI.gameui.invitefamilydlg.level", level);
		Win_SetText("UI.gameui.invitefamilydlg.credit", credit);
		Win_SetText("UI.gameui.invitefamilydlg.numinfo", numinfo);
		Win_SetText("UI.gameui.invitefamilydlg.info", szInfo);
	end;
	
	OnUpdateExtendSkillDlg = function()
		local nskillcount1, nskillcount2, nskillcount3 = GetExtendSkillNum();
		
		if nskillcount1 < 5 then
			for i=1,nskillcount1 do				
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
			for i= nskillcount1+1, 5 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
			end;
		else
			for i= 1, 5 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
		end;
		
		local tmp2 = nskillcount2+5;
		if nskillcount2 < 5 then
			for i=6,tmp2 do				
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
			for i= tmp2+1, 10 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
			end;
		else
			for i= 6, 10 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
		end;

		local tmp3 = nskillcount3+10;
		if nskillcount3 < 5 then
			for i=11,tmp3 do				
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
			for i= tmp3+1, 15 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
			end;
		else
			for i= 11, 15 do
				Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
			end;
		end;
		
		local ncount = nskillcount1 + nskillcount2 + nskillcount3;
		if ncount == 0 then
			Win_ShowWidget("UI.gameui.extendskilldlg", false);
		else 
			Win_ShowWidget("UI.gameui.extendskilldlg", true);
		end;
	end;
	
	OnOpenBigAvatar=function(type)
		if type == 1 then
			Win_ShowWidget("UI.gameui.unshowbigavatarbtn",true);
		else
			Win_ShowWidget("UI.gameui.unshowbigavatarbtn",false);
		end;
	end;
	
		
	--pipo424 打开飞鸽传书
	OnOpenInfoTranDlg = function(dlgtype, infotype, info)
		if dlgtype == 0 then
			if Win_IsVisible("UI.gameui.infotransenddlg") == true then
				return;
			end;
			Win_ShowWidget("UI.gameui.infotransenddlg", true);
			Win_SetText("UI.gameui.infotransenddlg.info", info);
			if infotype == 0 then
				Win_SetText("UI.gameui.infotransenddlg", "res/uires/gameui/traninfoall.gsa", value_channel_backpic);
			elseif infotype == 1 then
				Win_SetText("UI.gameui.infotransenddlg", "res/uires/gameui/traninfofri.gsa", value_channel_backpic);
			elseif infotype == 2 then
				Win_SetText("UI.gameui.infotransenddlg", "res/uires/gameui/traninfofml.gsa", value_channel_backpic);
			end;
			Win_SetValue("UI.gameui.infotransenddlg.info",0,value_channel_richflag);
		elseif dlgtype == 1 then
			Win_ShowWidget("UI.gameui.infotranrecvdlg", true);
			Win_SetText("UI.gameui.infotranrecvdlg.info", info);
			if infotype == 0 then
				Win_SetText("UI.gameui.infotranrecvdlg", "res/uires/gameui/traninfoall.gsa", value_channel_backpic);
			elseif infotype == 1 then
				Win_SetText("UI.gameui.infotranrecvdlg", "res/uires/gameui/traninfofri.gsa", value_channel_backpic);
			elseif infotype == 2 then
				Win_SetText("UI.gameui.infotranrecvdlg", "res/uires/gameui/traninfofml.gsa", value_channel_backpic);
			end;
			Win_SetValue("UI.gameui.infotransenddlg.info",1,value_channel_richflag);
		end;
	end;
	
	--dlgtype 0个人副本 1个人BOSS 2队伍副本 3队伍BOSS
	OnOpenTranDlg = function(dlgtype, icount)
		if Win_IsVisible("UI.gameui.playertranpdlg") == true then
			return;
		end;
	
		Win_ShowWidget("UI.gameui.playertranpdlg", true);
		Win_SetValue("UI.gameui.playertranpdlg", dlgtype, value_channel_customindex);
		Win_SetValue("UI.gameui.playertranpdlg.list", icount, value_channel_item_num);
		if dlgtype == 0 then
			--Win_SetText("UI.gameui.playertranpdlg", "res/uires/gameui/playertranpworld.gsa", value_channel_backpic);
			Win_SetText("UI.gameui.playertranpdlg", "传送", value_channel_caption);
			Win_SetText("UI.gameui.playertranpdlg.prof", "选择目标名字：", value_channel_caption);
		elseif dlgtype ==1 then
			--Win_SetText("UI.gameui.playertranpdlg", "res/uires/gameui/playertranboss.gsa", value_channel_backpic);
			Win_SetText("UI.gameui.playertranpdlg", "传送", value_channel_caption);
			Win_SetText("UI.gameui.playertranpdlg.prof", "选择目标BOSS名字：", value_channel_caption);
		elseif dlgtype == 2 then
			--Win_SetText("UI.gameui.playertranpdlg", "res/uires/gameui/teamtranpworld.gsa", value_channel_backpic);
			Win_SetText("UI.gameui.playertranpdlg", "多人传送", value_channel_caption);
			Win_SetText("UI.gameui.playertranpdlg.prof", "选择目标副本名字：", value_channel_caption);
		elseif dlgtype == 3 then
			--Win_SetText("UI.gameui.playertranpdlg", "res/uires/gameui/teamtranboss.gsa", value_channel_backpic);
			Win_SetText("UI.gameui.playertranpdlg", "多人传送", value_channel_caption);
			Win_SetText("UI.gameui.playertranpdlg.prof", "选择目标BOSS名字：", value_channel_caption);
		end;
	end;
	
	OnOpenCallNpc = function(npccount)
		Win_ShowWidget("UI.gameui.callnpcdlg", true);
		Win_SetValue("UI.gameui.callnpcdlg.npclist", npccount, value_channel_item_num);
		if npccount > 0 then
			Win_SetValue("UI.gameui.callnpcdlg.npclist", 0, value_channel_sel);
		end;
	end;
	
	OnOpenPetMaster = function(show)
		if show == 0 then
			Win_ShowWidget("UI.gameui.petdlg.petmaster", false);
		else
			Win_ShowWidget("UI.gameui.petdlg.petmaster", true);
		end;
	end;
	
	OnOpenChgWearOneKey = function(show)
		if show == 0 then
			Win_ShowWidget("UI.gameui.changeequipdlg.statusbtn", false);
		else
			Win_ShowWidget("UI.gameui.changeequipdlg.statusbtn", true);
		end;
	end;
	
	OnUpdatePlayerStatus = function()
		UI.children.gameui.children.sketchbar.children.sketchmap.children.playerstatusbtn.OnFlash();
	end;
	
	OnOpenExchgBowlderDlg=function(opentype, bshow, leftpoint, rate, qbleftpoint, qbrate)
		if (opentype == 0) then--
			Win_SetValue("UI.gameui.exchgbowlderdlg.leftpoint",leftpoint,value_channel_customindex);
			Win_SetValue("UI.gameui.exchgbowlderdlg.qbleftpoint",qbleftpoint,value_channel_customindex);
			
			Win_ShowWidget("UI.gameui.exchgbowlderdlg",bshow~=0);
			Win_SetText("UI.gameui.exchgbowlderdlg.leftpoint", leftpoint.."点");
			Win_SetText("UI.gameui.exchgbowlderdlg.qbleftpoint", qbleftpoint.."个");
			
			if leftpoint >= 100 and qbleftpoint >= 10 then
				Win_SetSelect("UI.gameui.exchgbowlderdlg",0,0);
			else
				if leftpoint >= qbleftpoint*10 then
					Win_SetSelect("UI.gameui.exchgbowlderdlg",0,0);
				else
					Win_SetSelect("UI.gameui.exchgbowlderdlg",0,1);
				end;
			end;
			
			Win_EnableWidget("UI.gameui.exchgbowlderdlg.okbtn",(leftpoint > 0 or qbleftpoint > 0));
				
			if Win_IsChecked("UI.gameui.exchgbowlderdlg.QPcheck") then
				--[[local maxval = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_maxvalue);
				if maxval > leftpoint then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",leftpoint,value_channel_maxvalue);
				end;
				
				if leftpoint > 10000 then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",10000,value_channel_maxvalue);
				end;]]
				
				if leftpoint > 10000 then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",10000,value_channel_maxvalue);
				else
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",leftpoint,value_channel_maxvalue);
				end;
				
			elseif Win_IsChecked("UI.gameui.exchgbowlderdlg.QBcheck") then
				--[[local maxval = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_maxvalue);
				if maxval > qbleftpoint then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",qbleftpoint,value_channel_maxvalue);
				end;
				
				if qbleftpoint > 240 then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",240,value_channel_maxvalue);
				end;]]
				
				if qbleftpoint > 240 then
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",240,value_channel_maxvalue);
				else
					Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",qbleftpoint,value_channel_maxvalue);
				end;
			end;
			
			local text = "1Q点="..rate.."彩玉";
			Win_SetText("UI.gameui.exchgbowlderdlg.rate", text);
			local text = "1Q币="..qbrate.."彩玉";
			Win_SetText("UI.gameui.exchgbowlderdlg.qbrate", text);
			
		elseif (opentype == 1) then
			Win_ShowWidget("UI.gameui.exchgbowlderdlg2",bshow~=0);
			Win_SetText("UI.gameui.exchgbowlderdlg2.leftpoint", leftpoint.."点");
			
			Win_EnableWidget("UI.gameui.exchgbowlderdlg2.okbtn",(leftpoint > 0));
					
			local maxval = Win_GetValue("UI.gameui.exchgbowlderdlg2.inputpoint",value_channel_maxvalue);
			if maxval > leftpoint*rate then
				Win_SetValue("UI.gameui.exchgbowlderdlg2.inputpoint",leftpoint*rate,value_channel_maxvalue);
			end;
			
			local text = "1点="..rate.."颗彩玉";
			Win_SetText("UI.gameui.exchgbowlderdlg2.rate", text);
		end;
		end;

		
	OnOpenExchangeDlg=function(bshow, mode)
		if bshow ~= 0 then
			if not Win_IsVisible("UI.gameui.exchangedlg") then
				Win_ShowWidget("UI.gameui.exchangedlg",true);
				Win_SetFocus("UI.gameui.exchangedlg");
			end;
		else
			Win_ShowWidget("UI.gameui.exchangedlg",false);
		end;
		
		Win_SetValue("UI.gameui.exchangedlg",mode,value_channel_customindex);
		end;
		
	OnOpenFPExchangeDlg=function(bshow)
		Win_ShowWidget("UI.gameui.fmvoteexchgdlg",bshow~=0);
		end;
	
	OnOpenViewExchangeDlg=function(bshow,mode)
		if bshow ~= 0 then
			if not Win_IsVisible("UI.gameui.viewexchangedlg") then
				Win_ShowWidget("UI.gameui.viewexchangedlg",true);
				Win_SetFocus("UI.gameui.viewexchangedlg");
			end;
		else
			Win_ShowWidget("UI.gameui.viewexchangedlg",false);
		end;
		
		Win_SetValue("UI.gameui.viewexchangedlg",mode,value_channel_customindex);
		end;
	
	OnShowPerformTip=function()
		UI.children.gameui.children.sketchbar.children.sketchmap.children.performbtn.PerformInit();
		end;
	
	OnShowRackPreviewDlg=function(bshow)
		if bshow ~= 0 then
			if not Win_IsVisible("UI.gameui.shopdlg.preview") then
				Win_ShowWidget("UI.gameui.shopdlg.preview",true);
				Win_SetFocus("UI.gameui.shopdlg.preview");
			end;
		else
			Win_ShowWidget("UI.gameui.shopdlg.preview",false);
		end;
		end;
	
	OnOpenFmVoteRankDlg=function()
		Win_ShowWidget("UI.gameui.fmvoterankdlg",true);
		end;
	
	OnOpenFmBonusRankDlg=function()
		Win_ShowWidget("UI.gameui.fmbonusrankdlg",true);
		end;
		
	OnOpenFPBonusRankDlg=function(bshow)
		Win_ShowWidget("UI.gameui.fpbonusrankdlg",bshow~=0);
		end;
	
	OnOpenFmMemListDlg=function()
		Win_ShowWidget("UI.gameui.fmmemlistdlg",true);
		end;
	
	OnUpdateFmRegMemList=function()
		local standbynum = GetActivityStandbyMemNum();
		Win_SetValue("UI.gameui.fmmemlistdlg.addlist",standbynum,value_channel_item_num);
		if standbynum >0 then
		Win_SetValue("UI.gameui.fmmemlistdlg.addlist",0,value_channel_sel);
		else
			Win_SetValue("UI.gameui.fmmemlistdlg.addlist",-1,value_channel_sel);
		end;
		
		local reglimit = GetRegLimit();
		Win_SetText("UI.gameui.fmmemlistdlg.numlabel", standbynum.."/"..reglimit);
		end;
		
	OnUpdateFpRegMemList=function()
		local standbynum = FPGetActivityStandbyMemNum();
		Win_SetValue("UI.gameui.memcfgdlg.addlist",standbynum,value_channel_item_num);
		if standbynum >0 then
		Win_SetValue("UI.gameui.memcfgdlg.addlist",0,value_channel_sel);
		else
			Win_SetValue("UI.gameui.memcfgdlg.addlist",-1,value_channel_sel);
		end;
		
		local reglimit = FPGetRegLimit();
		Win_SetText("UI.gameui.memcfgdlg.numlabel", standbynum.."/"..reglimit);
		end;
	
	OnOpenMagicFireDlg=function(bshow)
		if bshow ~= 0 then
			if not Win_IsVisible("UI.gameui.magicfiredlg") then
				Win_ShowWidget("UI.gameui.magicfiredlg",true);
			end;
		else
			Win_ShowWidget("UI.gameui.magicfiredlg",false);
		end;
		end;
	
	OnUpdateMagicRackDlg=function(param)
		if param == 0 then--服务器更新所有页
			local mainidx = GetRackIndex(0);
			local subidx = GetRackIndex(1);
			local paegidx = GetRackIndex(2);
			
			Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab"..(mainidx+1),value_channel_customname);
			local namelist, menunum=GetSubMenu(mainidx);
			Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".menulist",menunum,value_channel_item_num);
			
			for i=0,menunum-1 do				
				Win_SetText("UI.gameui.shopdlg.tab"..(mainidx+1)..".menulist.shoptabmenu"..i,namelist[i+1]);
			end;
			
			Win_SetSelect("UI.gameui.shopdlg.tab"..(mainidx+1)..".menulist",0,0);
			SetRackIndex(1,0);
			
			local num = GetPageNum(GetRackIndex(0),0);
			Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",num,value_channel_item_num);
			if num > 0 then
				local ox=Win_GetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl",value_channel_winrect,0);
				local ow=Win_GetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl",value_channel_winrect,2);
				local itemw=Win_GetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
				local startx = ox + (ow-(itemw+8)*num)/2;
				Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
				Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
				Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",startx,value_channel_winrect,0);
				Win_SetSelect("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",0,0);
				
				for i=0, num-1 do
					Win_SetText("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist.shopmenupage"..i, i+1);
				end;
				
			end;
			
			Win_SetValue("UI.gameui.shopdlg.tab"..(mainidx+1),1,value_channel_customindex);
						
			UI.children.gameui.children.shopdlg.children.hotgoods.SetHotGoods(GetHotGoodsNum());
		end;
		end;
	
	--选中货架中的某一页(不切换页)
	OnSelectMagicRack=function(mainidx, subidx, pageidx)
		pageidx = 0;
		Win_ShowWidget("UI.gameui.shopdlg",true);
		if mainidx >= 0  and Win_IsExist("UI.gameui.shopdlg.tab"..(mainidx+1)) then
			Win_SetSelect("UI.gameui.shopdlg",0,mainidx);
			local menunum= Win_GetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".menulist",value_channel_item_num);
			if subidx >= 0 and subidx < menunum then
				SetRackIndex(1,subidx);
				Win_SetSelect("UI.gameui.shopdlg.tab"..(mainidx+1)..".menulist",0,subidx);
				local pagenum = Win_GetValue("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",value_channel_item_num);
				if pageidx >= 0 and pageidx < pagenum then
					Win_SetSelect("UI.gameui.shopdlg.tab"..(mainidx+1)..".pagectrl.pagelist",0,pageidx);
				end;
			end;
		end;
	end;
		
	OnOpenExTeamConfigDlg=function(bshow)
		Win_ShowWidget("UI.gameui.exteamconfigdlg",bshow~=0);
		end;
	
	SetBargainInfo=function(id, bshow, frame)
		UI.children.gameui.children.bargaindlg.ShowStar(id, bshow, frame);
		end;
	
	ShowBargainBtn=function(bshow)
		Win_ShowWidget("UI.gameui.bargainbtn",bshow~=0);
		
		if (bshow ~= 0) then
			local bcondret, battrret = IsTeamCovValid(0);
			if bcondret ~= 0 then
				Win_SetValue("UI.gameui.bargainbtn",1,value_channel_framescheme);
			else
				Win_SetValue("UI.gameui.bargainbtn",0,value_channel_framescheme);
			end;
		end;
		
		end;
		
	ShowBargainDlg=function(bshow)
		Win_ShowWidget("UI.gameui.bargaindlg", bshow~=0);
		end;
	
	UpdateBargainDlg=function()
		local customtype = Win_GetValue("UI.gameui.bargaindlg",value_channel_customtype);
		UI.children.gameui.children.bargaindlg.UpdateDlg(customtype);
		end;
	
	OnOpenPWorldReviveDlg=function(bshow, op1, op2)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.pworldrevivedlg", false);
		else
			Win_ShowWidget("UI.gameui.pworldrevivedlg", true);
			Win_EnableWidget("UI.gameui.pworldrevivedlg.bowlderrevivebtn", (op1~=0));
			Win_EnableWidget("UI.gameui.pworldrevivedlg.exitrevivebtn", (op2~=0));	
		end;
	end;
	
	OnOpenDailyGather=function(bShow)
		Win_ShowWidget("UI.gameui.gatherdlg", (bShow~=0));
	end;	
	
	OnOpenLastIpDlg=function(bShow,lastip,lasttime,nowip,bsame)
		Win_ShowWidget("UI.gameui.lastipdlg", (bShow~=0));
		if bsame~=0 then
			Win_SetText("UI.gameui.lastipdlg.lastip",'/C20'..lastip..'/C00');
		else
			Win_SetText("UI.gameui.lastipdlg.lastip",lastip);
		end;
		Win_SetText("UI.gameui.lastipdlg.lasttime",lasttime);
		Win_SetText("UI.gameui.lastipdlg.nowip",nowip);
	end;
	
	OnOpenCreateFTeamdlg=function(bShow)
		Win_ShowWidget("UI.gameui.createfightteamdlg", (bShow~=0));
	end;

	OnEnableGatherOkBtn=function(bEnable)
		Win_EnableWidget("UI.gameui.gatherdlg.okbtn", (bEnable~=0));
	end;	
	
	OnShowArmNirvanaDlg=function(bShow, ntype, nindex, firsthole)
		Win_ShowWidget("UI.gameui.nirvanadlg", (bShow~=0));
		if bShow~=0 then
			for i=1, 7 do
				Win_ShowWidget("UI.gameui.nirvanadlg.armattrchk"..i, false);
				Win_SetCheck("UI.gameui.nirvanadlg.armattrchk"..i, false);
			end;
			local info = GetArmHoleDesc(ntype, nindex);
			Win_SetText("UI.gameui.nirvanadlg.holedesc", info.desc);
			for i=1,info.holenum do 
				Win_ShowWidget("UI.gameui.nirvanadlg.armattrchk"..i, true);
			end;
			--[[if firsthole == 0 then
				Win_ShowWidget("UI.gameui.nirvanadlg.armattrchk1", false);
			end;]]
		end;
	end;
		
	OnOpenReviveDlg=function(flag, itime)
		if flag==99 then --关闭
			Win_ShowWidget("UI.gameui.revivedlg",false);
		else 
			Win_EnableWidget("UI.gameui.revivedlg.revivebtn",true);
			Win_EnableWidget("UI.gameui.revivedlg.itemrevivebtn",(flag>2)or(flag==1));
			Win_EnableWidget("UI.gameui.revivedlg.skillrevivebtn",(flag>=2));
			
			if itime <= 0 then
				Win_SetValue("UI.gameui.revivedlg.newskillrevivebtn", 0, value_channel_customid);
				Win_SetText("UI.gameui.revivedlg.newskillrevivebtn.lefttimelabel", "");
				Win_SetValue("UI.gameui.revivedlg", -1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.revivedlg.newskillrevivebtn", false);
			else
				Win_EnableWidget("UI.gameui.revivedlg.newskillrevivebtn", true);
				Win_SetText("UI.gameui.revivedlg.newskillrevivebtn.lefttimelabel", itime);
				
				Win_SetValue("UI.gameui.revivedlg.newskillrevivebtn", itime, value_channel_customid);
				Win_SetValue("UI.gameui.revivedlg", 1, value_channel_timerspace);
			end;
			
			Win_SetSelect("UI.gameui.revivedlg",0,0);
			if not Win_IsVisible("UI.gameui.revivedlg") then
				Win_ShowWidget("UI.gameui.revivedlg",true);
			end;
		end;
	end;
	
	OnOpenExreviveDlg=function(flag,bhpww, itime)
		if flag==99 then
			Win_ShowWidget("UI.gameui.exrevivedlg",false);
		else
			Win_EnableWidget("UI.gameui.exrevivedlg.revivebtn",true);
			Win_EnableWidget("UI.gameui.exrevivedlg.itemrevivebtn",(flag>2)or(flag==1));
			Win_EnableWidget("UI.gameui.exrevivedlg.skillrevivebtn",(flag>=2));
			Win_EnableWidget("UI.gameui.exrevivedlg.hpwwrevivebtn",bhpww~=0);
			
			if itime <= 0 then
				Win_SetValue("UI.gameui.exrevivedlg.newskillrevivebtn", 0, value_channel_customid);
				Win_SetText("UI.gameui.exrevivedlg.newskillrevivebtn.lefttimelabel", "");
				Win_SetValue("UI.gameui.exrevivedlg", -1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.exrevivedlg.newskillrevivebtn", false);
			else
				Win_EnableWidget("UI.gameui.exrevivedlg.newskillrevivebtn", true);
				Win_SetText("UI.gameui.exrevivedlg.newskillrevivebtn.lefttimelabel", itime);
				
				Win_SetValue("UI.gameui.exrevivedlg.newskillrevivebtn", itime, value_channel_customid);
				Win_SetValue("UI.gameui.exrevivedlg", 1, value_channel_timerspace);
			end;
			
			Win_SetSelect("UI.gameui.exrevivedlg",0,0);
			if not Win_IsVisible("UI.gameui.exrevivedlg") then
				Win_ShowWidget("UI.gameui.exrevivedlg",true);
			end;
		end;
	end;
		
	OnOpenHouseReviveDlg=function(flag,bhpww, itime)
		if flag==99 then
			Win_ShowWidget("UI.gameui.houserevivedlg",false);
		else
			Win_EnableWidget("UI.gameui.houserevivedlg.revivebtn",true);
			Win_EnableWidget("UI.gameui.houserevivedlg.itemrevivebtn",(flag>2)or(flag==1));
			Win_EnableWidget("UI.gameui.houserevivedlg.skillrevivebtn",(flag>=2));
			Win_ShowWidget("UI.gameui.houserevivedlg.fmhousebtn",bhpww==1);
			Win_EnableWidget("UI.gameui.houserevivedlg.fmhousebtn",bhpww==1);
			Win_ShowWidget("UI.gameui.houserevivedlg.fmfronthousebtn",bhpww==2);
			Win_EnableWidget("UI.gameui.houserevivedlg.fmfronthousebtn",bhpww==2);
			Win_SetSelect("UI.gameui.houserevivedlg",0,0);
			if not Win_IsVisible("UI.gameui.houserevivedlg") then
				Win_ShowWidget("UI.gameui.houserevivedlg",true);
			end;
			
			if itime <= 0 then
				Win_SetValue("UI.gameui.houserevivedlg.newskillrevivebtn", 0, value_channel_customid);
				Win_SetText("UI.gameui.houserevivedlg.newskillrevivebtn.lefttimelabel", "");
				Win_SetValue("UI.gameui.houserevivedlg", -1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.houserevivedlg.newskillrevivebtn", false);
			else
				Win_EnableWidget("UI.gameui.houserevivedlg.newskillrevivebtn", true);
				Win_SetText("UI.gameui.houserevivedlg.newskillrevivebtn.lefttimelabel", itime);
				
				Win_SetValue("UI.gameui.houserevivedlg.newskillrevivebtn", itime, value_channel_customid);
				Win_SetValue("UI.gameui.houserevivedlg", 1, value_channel_timerspace);
			end;
		end;
	end;
	
	OnOpenQQLiveDlg=function(bshow)
		Win_ShowWidget("UI.gameui.qqlivedlg",bshow~=0);
		end;
		
	OnOpenQuestionDlg=function(title,question,num,bclose,rightnum,totalnum)
		Win_SetText("UI.gameui.questiondlg",title);
		Win_SetText("UI.gameui.questiondlg.questionedit",question);
		Win_SetText("UI.gameui.questiondlg.numlabel",rightnum);
		Win_SetText("UI.gameui.questiondlg.totalnumlabel",totalnum);
		Win_SetValue("UI.gameui.questiondlg.answerlist",num,value_channel_item_num);
		Win_SetValue("UI.gameui.questiondlg.answerlist",-1,value_channel_sel);
		Win_SetValue("UI.gameui.questiondlg.closebtn",bclose, value_channel_customtype);
		if not Win_IsVisible("UI.gameui.questiondlg") then
		Win_ShowWidget("UI.gameui.questiondlg",true);
		end;
		UI.children.gameui.children.questiondlg.OnPlayQuestionTextEffect();
		end;
	
	OnClearQuestionState=function()
		if Win_IsVisible("UI.gameui.questiondlg") then
			Win_ShowWidget("UI.gameui.questiondlg",false);
		elseif Win_IsVisible("UI.gameui.finalquestiondlg") then
			Win_ShowWidget("UI.gameui.finalquestiondlg",false);
		end;
		end;
	
	OnOpenFinalQuestionDlg=function(title,question,answernum,bclose,rightnum,wrongnum,giveupnum,timenum,totalscore)
		Win_SetText("UI.gameui.finalquestiondlg",title);
		Win_SetText("UI.gameui.finalquestiondlg.questionedit",question);
		Win_SetText("UI.gameui.finalquestiondlg.rightnumlabel",rightnum);
		Win_SetText("UI.gameui.finalquestiondlg.wrongnumlabel",wrongnum);
		Win_SetText("UI.gameui.finalquestiondlg.giveupnumlabel",giveupnum);
		Win_SetText("UI.gameui.finalquestiondlg.scorelabel",totalscore);
		Win_SetValue("UI.gameui.finalquestiondlg.answerlist",answernum,value_channel_item_num);
		Win_SetValue("UI.gameui.finalquestiondlg.answerlist",-1,value_channel_sel);
		Win_SetValue("UI.gameui.finalquestiondlg.closebtn",bclose, value_channel_customtype);
				
		if not Win_IsVisible("UI.gameui.finalquestiondlg") then
		Win_ShowWidget("UI.gameui.finalquestiondlg",true);
		Win_SetFocus("UI.gameui.finalquestiondlg");
		end;
		
		UI.children.gameui.children.finalquestiondlg.OnPlayQuestionTextEffect();
		UI.children.gameui.children.finalquestiondlg.OnSetTime(timenum);
		
		end;
		
	OnOpenAnswerHistoryDlg=function(content,nflag)
		if nflag==0 then
		Win_SetText("UI.gameui.answerhistorydlg.content",content,value_channel_caption);
		else
		Win_OnInsert("UI.gameui.answerhistorydlg.content",content,ui_textpos_end);
		end;
		
		if not Win_IsVisible("UI.gameui.answerhistorydlg") then
		Win_ShowWidget("UI.gameui.answerhistorydlg",true);
		Win_SetFocus("UI.gameui.answerhistorydlg");
		end;
		end;
	
	--OnOpenAnswerResultRankDlg=function(num,manifesto)
	OnOpenAnswerResultRankDlg=function(num,myrank)
		Win_SetValue("UI.gameui.answerresultrankdlg.list",num,value_channel_item_num);
		--Win_SetText("UI.gameui.answerresultrankdlg.manifestoedit",manifesto);
		Win_SetText("UI.gameui.answerresultrankdlg.myrank",myrank);
		if not Win_IsVisible("UI.gameui.answerresultrankdlg") then
		Win_ShowWidget("UI.gameui.answerresultrankdlg",true);
		end;
		end;
	
	OnOpenAllAnswerResultRankDlg=function(num)
		Win_SetValue("UI.gameui.allanswerresultrankdlg.list",num,value_channel_item_num);
		Win_ShowWidget("UI.gameui.allanswerresultrankdlg",true);
		end;
	
	OnOpenManifestoInfoDlg=function()
		if not Win_IsVisible("UI.gameui.manifestoinfodlg") then
		Win_ShowWidget("UI.gameui.manifestoinfodlg",true);
		end;
		end;
	
	OnOpenClockBar=function(bshow)
		if bshow~=0 then
			
			if not Win_IsVisible("UI.gameui.clockbar") then
			Win_ShowWidget("UI.gameui.clockbar",true);
			end;
			
		else
			Win_ShowWidget("UI.gameui.clockbar",false);
		end;
		end;
	
	OnSetAnswerTime=function(curtm, totaltm)
		if Win_IsVisible("UI.gameui.questiondlg.timelabel") then
			if curtm ~= "" then
			Win_SetText("UI.gameui.questiondlg.timelabel",curtm);
			else
			Win_SetText("UI.gameui.questiondlg.timelabel","00:00:00");
			end;
		end;
		
		if Win_IsVisible("UI.gameui.clockbar.timelabel") then
			if totaltm~="" then
			Win_SetText("UI.gameui.clockbar.timelabel",totaltm);
			else
			Win_SetText("UI.gameui.clockbar.timelabel","00:00:00");
			end;
		end;
		
		end;
		
	OnOpenBookWinDlg=function(bshow, num)
		Win_ShowWidget("UI.gameui.bookwindlg",bshow~=0);
		end;
		
	OnOpenEachBookDlg=function(title,author,server,desc)
		Win_SetText("UI.gameui.eachbookdlg.title",title);
		Win_SetText("UI.gameui.eachbookdlg.author",author);
		Win_SetText("UI.gameui.eachbookdlg.server",server);
		Win_SetText("UI.gameui.eachbookdlg.descedit",desc);
		Win_ShowWidget("UI.gameui.eachbookdlg",true);
		Win_SetValue("UI.gameui.eachbookdlg.descedit",0,value_channel_range_begin);
		Win_SetValue("UI.gameui.eachbookdlg.descedit",0,value_channel_range_end);
		end;
		
	OnOpenSelectArenaDlg=function(bshow,num)
		local pos = Win_GetValue("UI.gameui.selectarenadlg.arenascroll",value_channel_pos);
		Win_SetValue("UI.gameui.selectarenadlg.arenalist",num,value_channel_item_num);
		if num == 0 then
		Win_EnableWidget("UI.gameui.selectarenadlg.enterbtn",false);
		else
		UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
		end;
		if bshow~=0 then
		if not Win_IsVisible("UI.gameui.selectarenadlg") then
		Win_ShowWidget("UI.gameui.selectarenadlg",true);
		pos=0;
		end;
		else
		Win_ShowWidget("UI.gameui.selectarenadlg",false);
		end;
		Win_SetValue("UI.gameui.selectarenadlg.arenascroll",pos,value_channel_pos);
		end;
	
	OnOpenCreateArenaDlg=function(bshow)
		if bshow == 1 then
		if not Win_IsVisible("UI.gameui.createarenadlg") then
		Win_ShowWidget("UI.gameui.createarenadlg",true);
		end;
		else
		Win_ShowWidget("UI.gameui.createarenadlg",false);
		end;
		end;
		
	OnOpenArenaDlg=function(bshow)
		if bshow ~= 0 then
		if not Win_IsVisible("UI.gameui.arenadlg") then
		Win_ShowWidget("UI.gameui.arenadlg",true);
		end;
		else
		Win_ShowWidget("UI.gameui.arenadlg",false);
		end;
		end;
	
	OnUpdateArenaDlg=function(happyteamnum, fantasyteamnum, curwatchernum, totalwatchernum, watchobjectname,bhostbtn,bvisitingbtn,bobcantalk)
		local watchnumtxt = "("..curwatchernum.."/"..totalwatchernum..")";
		local watchobjecttxt = watchobjectname;
		Win_SetText("UI.gameui.arenadlg.audiencenumlabel",watchnumtxt);
		--Win_SetText("UI.gameui.arenadlg.watchobjectlabel",watchobjecttxt);
		Win_SetValue("UI.gameui.arenadlg.happyteammemlist",happyteamnum,value_channel_item_num);
		Win_SetValue("UI.gameui.arenadlg.fantasyteammemlist",fantasyteamnum,value_channel_item_num);
		Win_EnableWidget("UI.gameui.arenadlg.happyteamname",bhostbtn~=0);
		Win_EnableWidget("UI.gameui.arenadlg.fatasyteamname",bvisitingbtn~=0);
		Win_SetValue("UI.gameui.arenadlg",bobcantalk,value_channel_customtype);
		local bcanstart = CanStartArena();
		Win_EnableWidget("UI.gameui.arenadlg.startbtn",bcanstart~=0);
		Win_SetCheck("UI.gameui.arenadlg.toggleaudiencechatbtn",bobcantalk~=0);
		--Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", IsArenaOwner()~=0);
		Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", IsArenaOwner()~=0 and IsMatchArena()==0);
		
		--GM观战比赛用房间具有特殊权限
		if (ArenaGetMyActionType()~=0 and IsGm()~=0 and IsMatchArena()~=0) then
			Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", true);
		end;
		
		if (ArenaGetMyActionType()==0) then
			if IsMatchArena()~=0   then
				Win_EnableWidget("UI.gameui.arenadlg.happyteamname",false);
				Win_EnableWidget("UI.gameui.arenadlg.fatasyteamname",false);			
			end;
			
			Win_EnableWidget("UI.gameui.arenadlg.preparebtn",true);
		else
			Win_EnableWidget("UI.gameui.arenadlg.preparebtn",false);	
		end;
	end;
		
	OnPrepareArena=function(bReady)
		if bReady == 0 then
			Win_ShowWidget("UI.gameui.arenadlg.preparebtn", true);
			Win_ShowWidget("UI.gameui.arenadlg.cancelpreparebtn", false);
		else
			Win_ShowWidget("UI.gameui.arenadlg.preparebtn", false);
			Win_ShowWidget("UI.gameui.arenadlg.cancelpreparebtn", true);		
		end;
	end;
	
	OnArenaCloseOtherDlg=function()
		Win_ShowWidget("UI.gameui.petdlg",false);
		Win_ShowWidget("UI.gameui.equipdlg",false);
		Win_ShowWidget("UI.gameui.waredlg",false);
		Win_ShowWidget("UI.gameui.teamdlg",false);
		Win_ShowWidget("UI.gameui.familydetaildlg",false);
		Win_ShowWidget("UI.gameui.skilldlg",false);
		Win_ShowWidget("UI.gameui.taskdlg",false);
		Win_ShowWidget("UI.gameui.maillistdlg",false);
		Win_ShowWidget("UI.gameui.pkskilldlg",false);
		Win_ShowWidget("UI.gameui.integdlg",false);
		
		if Win_IsVisible("UI.gameui.chongzhidlg") == true then
			Win_ShowWidget("UI.gameui.chongzhidlg", false);
			CloseRequireExchgBowlder();
		end;
	
		if Win_IsVisible("UI.gameui.hotnewsdlg") == true then
			Win_ShowWidget("UI.gameui.hotnewsdlg", false);
			CloseRequireExchgBowlder2();
		end;
		end;
	
	OnShowScreenEffectBuffer=function(bshow)
		Win_ShowWidget("UI.gameui.ScreenEffectBuffer",bshow~=0);
		end;
		
	
	OnOpenVoteDlg=function(title,desc,num)
		if not Win_IsVisible("UI.gameui.votedlg") then
		Win_ShowWidget("UI.gameui.votedlg",true);
		end;
		if title~=nil then
			Win_SetText("UI.gameui.votedlg",title,value_channel_caption);
		end;
		if desc~=nil then
			Win_SetText("UI.gameui.votedlg.descedit",desc);
		end;
		Win_SetValue("UI.gameui.votedlg.votebtns",num,value_channel_item_num);
		end;
	
	OnShowQQBroadcastMsg=function(msg, len)
		UI.children.gameui.children.qqradiodlg.OnShowBulletin(msg, len*6);
		end;
	
	OnShowQQBroadcastEqualizer=function(ishow)
		QQBroadcastShowEqualizer(ishow);
		end;
	
	OnShowExitArenaBtn=function(bshow)
		Win_ShowWidget("UI.gameui.ExitArenaBtn",bshow~=0);
		local bobserver = ArenaGetMyActionType();
		if bobserver==1 then
		Win_SetText("UI.gameui.ExitArenaBtn","退出观战",value_channel_tiptext);
		else
		Win_SetText("UI.gameui.ExitArenaBtn","退出竞技场",value_channel_tiptext);
		end;
		end;
	
	OnShowHideWingBtn=function(nShow)
		if nShow == 0 then
			Win_EnableWidget("UI.gameui.ShowWingBtn",false);
			Win_EnableWidget("UI.gameui.HideWingBtn",false);
			Win_ShowWidget("UI.gameui.HideWingBtn",false);
			Win_ShowWidget("UI.gameui.ShowWingBtn",false);
		elseif nShow == 2 then
			Win_EnableWidget("UI.gameui.HideWingBtn",true);
			Win_ShowWidget("UI.gameui.HideWingBtn",true);
			Win_ShowWidget("UI.gameui.ShowWingBtn",false);
		elseif nShow == 1 then
			Win_EnableWidget("UI.gameui.ShowWingBtn",true);
			Win_ShowWidget("UI.gameui.ShowWingBtn",true);
			Win_ShowWidget("UI.gameui.HideWingBtn",false);
		end;
	end;
	
	OnShowExitHorseBtn=function(bshow)
		Win_ShowWidget("UI.gameui.ExitHorseBtn",bshow~=0);
	end;

	OnShowExitAvatarActBtn=function(bshow)
		Win_ShowWidget("UI.gameui.ExitAvatarActBtn",bshow~=0);
	end;
	
	OnShowArenaCountDownEffect=function(ntime)
		if ntime > 0 then
			if ntime > 9 then ntime = 9; end;
			Win_SetValue("UI.gameui.arenacountdowneffect",9-ntime,value_channel_customindex);
			Win_SetValue("UI.gameui.arenacountdowneffect",9-ntime,value_channel_effectframe);
			Win_SetValue("UI.gameui.arenacountdowneffect",0.1,value_channel_timerspace);
			Win_ShowWidget("UI.gameui.arenacountdowneffect",true);
		else
			Win_ShowWidget("UI.gameui.arenacountdowneffect",false);
		end;
		end;
	
	OnArenaScore=function(bShow, homeScore, awayScore)
		if bShow == 0 then
			Win_ShowWidget("UI.gameui.arenascoredlg", false);
		else
			Win_SetText("UI.gameui.arenascoredlg.homescore", homeScore);	
			Win_SetText("UI.gameui.arenascoredlg.awayscore", awayScore);
			
			if not Win_IsVisible("UI.gameui.arenascoredlg") then
				Win_ShowWidget("UI.gameui.arenascoredlg", true);
			end;
		end;
	end;
	
	--label=1,2 ui , 3,4 ui effect
	OnOpenMaplabelBtn=function(label, mode)
		if label==1 then
			if mode ~= 0 then
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btn",true);
			else
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btn",false);
			end;
		elseif label==2 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btn",false);
			else
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btn",true);
			end;	
		elseif label==3 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btneffct",false);
			else
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btneffct",true);
			end;	
		elseif label==4 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btneffct",false);
			else
				Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btneffct",true);
			end;	
		end;
	end;
	
	CloseMainLabelBK=function()
		Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk1",false);	
		Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk2",false);	
		Win_ShowWidget("UI.gameui.selflabelbar.selflabel1effct",false);
		Win_ShowWidget("UI.gameui.selflabelbar.selflabel2effct",false);
		end;
		
	--label=1,2 ui , 3,4 ui effect	
	OnOpenMainLabelBK=function(label, mode)
	        if label == 1 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk1",false);
			else
				Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk1",true);
			end;
		elseif label == 2 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk2",false);
			else
				Win_ShowWidget("UI.gameui.selflabelbar.selflabelbk2",true);	
			end;
		elseif label == 3 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.selflabelbar.selflabel1effct",false);
			else
				Win_ShowWidget("UI.gameui.selflabelbar.selflabel1effct",true);	
			end;
		elseif label == 4 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.selflabelbar.selflabel2effct",false);
			else
				Win_ShowWidget("UI.gameui.selflabelbar.selflabel2effct",true);	
			end;
		end;
	end;
	
	OnOpenBadExcept=function(label, mode)
	        if label <8 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,false);
			else
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,true);
			end;
		end;
	end;
		
	OnOpenTargetLabel=function(label)
	        if label <6 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,false);
			else
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,true);
			end;
		end;
	end;
	
	OnOpenSelfLabel=function(label)
	        if label <2 then
			if mode == 0 then
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,false);
			else
				Win_ShowWidget("UI.gameui.badexceptlist.badexceptlabel"..label,true);
			end;
		end;
	end;
	
	OnOpenAdvertise=function()
		local adverinfo=GetAdvertiseInfo();
		if adverinfo~="" then
		Win_ShowWidget("UI.gameui.advertisedlg",true);			
		end;
		end;

	OnOpenOweOpt=function(bshow)
		Win_ShowWidget("UI.gameui.oweoptdlg",(bshow~=0));
		end;
	
	OnOpenSecurityLock=function(bshow,nmode,npara,pcaption,pinfo)
		if nmode==0 then
			--Win_SetValue("UI.gameui.fortunepswsetdlg",npara,value_channel_customid);
			--Win_ShowWidget("UI.gameui.fortunepswsetdlg",(bshow~=0));
			Win_SetValue("UI.newsetsecudlg",npara,value_channel_customid);
			Win_ShowWidget("UI.newsetsecudlg",(bshow~=0));
		elseif nmode==1 then
			--Win_SetValue("UI.gameui.fortunepswchangedlg",npara,value_channel_customid);
			--Win_ShowWidget("UI.gameui.fortunepswchangedlg",(bshow~=0));		
			Win_SetValue("UI.newresetsecudlg",npara,value_channel_customid);
			Win_ShowWidget("UI.newresetsecudlg",(bshow~=0));

		elseif nmode==3 then
			Win_SetValue("UI.newresetsecudlg",npara,value_channel_customid);
			Win_ShowWidget("UI.newresetsecudlg",(bshow~=0));
		
		else
			--Win_SetText("UI.gameui.fortunepswinputdlg",pcaption);
			--Win_SetText("UI.gameui.fortunepswinputdlg.infolabel",pinfo);
		
			--Win_SetValue("UI.gameui.fortunepswinputdlg",npara,value_channel_customid);
			--Win_ShowWidget("UI.gameui.fortunepswinputdlg",(bshow~=0));		
			
			Win_ShowWidget("UI.newsecuverifydlg",(bshow~=0));		
			if (bshow~=0) then
				Win_SetFocus("UI.newsecuverifydlg");
				UI.children.newsecuverifydlg.OnShowKeyBoard();
			end;
			
		end;
		end;
	
	OnOpenSafeSecurityLock=function(nmode)
		if nmode==0 then
			Win_ShowWidget("UI.newsetsafesecudlg",false);
			Win_ShowWidget("UI.newsafesecuverifydlg",false);
		elseif nmode == 1 then
			Win_ShowWidget("UI.newsafesecuverifydlg",true);
		elseif nmode==2 then
			Win_ShowWidget("UI.newsetsafesecudlg",true);
		end;
	end;
		
	OnGameUISecuSuccess=function(mode)
		if mode == 1 then
			Win_ShowMsgBox("您已经成功设置财产安全锁，请牢记您的密码。","系统消息",ui_msgid_default,"UI.newsetsecudlg.completebtn");
		elseif (mode==2) then
			Win_ShowMsgBox("您已经成功设置财产安全锁，请牢记您的密码。","系统消息",ui_msgid_default,"UI.newresetsecudlg.completebtn");
		end;
		end;
		
	OnGameUIClearOldSecuLock=function(mode)
		if (mode == 1) then
			Win_ShowMsgBox("财产安全锁密码已经清除, 请您重新设置新的财产安全锁密码。","系统消息",ui_msgid_default,"UI.newresetsecudlg.completebtn");
		elseif (mode == 0) then
			Win_ShowMsgBox("财产安全锁密码清除失败, 请检查您的密码是否正确并且符合清除资格。","系统消息",ui_msgid_default);
		end;
	end;

		
	OnOpenCDKEYInquireDlg=function()
		if not Win_IsVisible("UI.gameui.cdkeyinquiredlg") then
		Win_ShowWidget("UI.gameui.cdkeyinquiredlg",true);
		end;
		end;
	
	OnOpenGarage=function(mode,num)
		if mode==0 then
		Win_ShowWidget("UI.gameui.passwdinputdlg",true);		
		elseif mode==1 then
		Win_ShowWidget("UI.gameui.passwdsetdlg",true);
		elseif mode==2 then
		Win_ShowWidget("UI.gameui.passwdmoddlg",true);
		else
		Win_SetValue("UI.gameui.garagedlg.list",num,value_channel_item_num);
		Win_SetValue("UI.gameui.garagedlg.list",0,value_channel_sel);
		Win_ShowWidget("UI.gameui.garagedlg",true);				
		Win_SetFocus("UI.gameui.garagedlg");
		end;
		end;
		
	OnRepairItem=function(mode,itemid,fee,info)
		if mode==0 then	--"普通修理"
			Win_SetValue("UI.gameui.repairdlg.title",0,value_channel_framescheme);
		elseif mode==1 then --"特殊修理"
			Win_SetValue("UI.gameui.repairdlg.title",2,value_channel_framescheme);
		elseif mode==2 then -- "全部修理"
			Win_SetValue("UI.gameui.repairdlg.title",1,value_channel_framescheme);
		elseif mode==3 then -- 全部特殊修理  无图片，使用特殊修理的
			Win_SetValue("UI.gameui.repairdlg.title",2,value_channel_framescheme);
		end;	
		
		UI.children.gameui.ShowMakeMoneyAndGoldBill(19, fee);		
		
		Win_SetValue("UI.gameui.repairdlg.itemrepair",itemid,value_channel_dragindex);
		Win_SetText("UI.gameui.repairdlg.labelrepair",info);
		
		Win_ShowWidget("UI.gameui.repairdlg",true);
		Win_SetFocus("UI.gameui.repairdlg");
		end;
	
	OnUpdateMasterPrentice=function(mode)
		if mode==1 then		
		Win_ShowWidget("UI.gameui.masterlistdlg",true);
		Win_SetFocus("UI.gameui.masterlistdlg");
		elseif mode==2 then
		UI.children.gameui.children.teamdlg.UpdateMasterTab();
		UI.children.gameui.children.teamdlg.UpdatePrenticeTab();
		elseif mode==3 then
		Win_ShowWidget("UI.gameui.masterinfodlg",true);		
		else
		Win_ShowWidget("UI.gameui.teamdlg",true);
		end;
		
		end;
		
	OnFamilyList=function()
		num=GetNumFamily();
		myright=GetMyRightInFamily();
		
		Win_EnableWidget("UI.gameui.familylistdlg.allybtn",(num>0)and(myright==1));
		Win_EnableWidget("UI.gameui.familylistdlg.enemybtn",(num>0)and(myright==1));
		Win_EnableWidget("UI.gameui.familylistdlg.cancelallybtn",(num>0)and(myright==1));
		Win_EnableWidget("UI.gameui.familylistdlg.cancelenemybtn",(num>0)and(myright==1));
		
		
		Win_EnableWidget("UI.gameui.familylistdlg.joinbtn",(num>0)and(myright<0));

		
		oldsel=Win_GetSelect("UI.gameui.familylistdlg.familylist",0);
		
		if oldsel>=num then
		oldsel=num-1;
		end;
		
		if oldsel<0 then
		oldsel=0;
		end;
		
		Win_SetValue("UI.gameui.familylistdlg.familylist",num,value_channel_item_num);
		Win_SetValue("UI.gameui.familylistdlg.familylist",oldsel,value_channel_sel);
		UI.children.gameui.children.familylistdlg.children.familylist.OnValueChange(oldsel);
		
		if not Win_IsVisible("UI.gameui.familylistdlg") then
		Win_ShowWidget("UI.gameui.familylistdlg",true);	
		end;
		
		end;	
		
	OnFamilyCreate=function()
		Win_ShowWidget("UI.gameui.familycreatedlg",true);		
		end;	
		
	OnFamilyDetail=function(itype)
		if itype==0 then
		UI.children.gameui.children.familydetaildlg.UpdateFamilyDetail();	
		elseif itype==1 then
		UI.children.gameui.children.familyrelationdlg.UpdateFamilyRelation();
		elseif itype==2 then
		UI.children.gameui.children.jobcustomdlg.UpdateJobCustom();
		elseif itype==9 then
			Win_ShowWidget("UI.gameui.familydetaildlg",true);
		else		
		Win_ShowWidget("UI.gameui.familydetaildlg",false);
		end;
		end;	
	
	OnQueryFmLogo=function()
		local fminfo = GetQueryFmLogoInfo();
		local fmname = Win_GetText("UI.gameui.familyproclaimdlg", value_channel_customstring);
		
		if (fminfo.fmname == fmname) then
			Win_SetText("UI.gameui.familyproclaimdlg.proclaimedit", fminfo.logo);
		end;
	end;
	
	OnFamilyQueryDlgUpdate=function(n)
		local fminfo = GetQueryFamilyInfo();
		
		-- n==1是仅仅更新relation关系, 必须保证family是窗口里面的同名family
		if ( n==1 and fminfo.fmname ~= Win_GetText("UI.gameui.familyquerydlg.namelabel")) then
			return;
		end;
		
		--n==0 更新所有的info
		if (n==0) then
			-- myright==1:族长, 2:长老, 3-10:其他, -1:表示我不在家族中
			local myright=GetMyRightInFamily();
			
			--join始终显示， 不在家族disable
			Win_EnableWidget("UI.gameui.familyquerydlg.joinbtn",(myright<0));
			Win_EnableWidget("UI.gameui.familyquerydlg.proclaimbtn",(fminfo.fmname ~= ""));
			
			--不在家族不显示， 在家族根据2个家族关系分别显示如下4按钮
			
	
			Win_SetText("UI.gameui.familyquerydlg.namelabel",fminfo.fmname);
			Win_SetText("UI.gameui.familyquerydlg.popularlabel",fminfo.fmmemnum);
			Win_SetText("UI.gameui.familyquerydlg.levellabel",fminfo.level);
			Win_SetText("UI.gameui.familyquerydlg.prestigelabel",fminfo.prestige);
			Win_SetText("UI.gameui.familyquerydlg.gradelabel",fminfo.grade);
		
			Win_SetText("UI.gameui.familyquerydlg.goldlabel",fminfo.gold);
			Win_SetText("UI.gameui.familyquerydlg.silverlabel",fminfo.silver);
			Win_SetText("UI.gameui.familyquerydlg.copperlabel",fminfo.copper);
			Win_SetText("UI.gameui.familyquerydlg.createtmabel",fminfo.createtime);
			Win_SetText("UI.gameui.familyquerydlg.newprestigelabel",fminfo.fmprestige);
			
			Win_SetText("UI.gameui.familyquerydlg.namelabel",fminfo.playername,value_channel_customstring);
			Win_SetText("UI.gameui.familyquerydlg",fminfo.logo,value_channel_customstring);
		end;
		
		Win_ShowWidget("UI.gameui.familyquerydlg.allybtn",false);
		Win_ShowWidget("UI.gameui.familyquerydlg.enemybtn",false);
		Win_ShowWidget("UI.gameui.familyquerydlg.cancelallybtn",false);
		Win_ShowWidget("UI.gameui.familyquerydlg.cancelenemybtn",false);
		
		--关系： 0 中、1友好、2敌对
		Win_ShowWidget("UI.gameui.familyquerydlg.realationlabel",(fminfo.relation >=0 and fminfo.relation <3));	
		
		if (fminfo.relation==0) then
			Win_SetValue("UI.gameui.familyquerydlg.realationlabel",2,value_channel_framescheme);
			Win_ShowWidget("UI.gameui.familyquerydlg.allybtn",true);	
			Win_ShowWidget("UI.gameui.familyquerydlg.enemybtn",true);	
		elseif  (fminfo.relation==1) then
			Win_SetValue("UI.gameui.familyquerydlg.realationlabel",0,value_channel_framescheme);
			Win_ShowWidget("UI.gameui.familyquerydlg.cancelallybtn",true);	
		elseif   (fminfo.relation==2) then
			Win_SetValue("UI.gameui.familyquerydlg.realationlabel",1,value_channel_framescheme);
			Win_ShowWidget("UI.gameui.familyquerydlg.cancelenemybtn",true);	
		end;

		
	end;	
		
	OnOpenWorkTip=function(bshow,btype)
		if bshow==1 then
		Win_ShowWidget("UI.gameui.worktipmenu.fishbtn",(btype==1));
		Win_ShowWidget("UI.gameui.worktipmenu.minebtn",(btype==2));
		Win_SetValue("UI.gameui.worktipmenu",1,value_channel_update_dirty);
		Win_ShowWidget("UI.gameui.worktipmenu",true);
		Win_SetFocus("UI.gameui.worktipmenu");
		else
		Win_ShowWidget("UI.gameui.worktipmenu",false);		
		end;
		end;
	
	OnTaskUpdate=function(idx,newsel)
		-- UPDATE 推荐任务
		UpdateCommendTask();     

		local num=TaskGetNumber( idx );
		
		if idx==1 then
		local myframe=0;
		
		if num>0 then 
		myframe=1;
		end;
		
		if Win_IsVisible("UI.gameui.taskdlg") then
		myframe=0;
		end;
		
		Win_SetValue("UI.gameui.ctrlbar.taskbtn",myframe,value_channel_framescheme);
		
		end;
		
		
		local tabname="";
		
		if idx==1 then
		tabname="UI.gameui.taskdlg.doingtab";
		Win_EnableWidget(tabname..".stopbtn",num>0);
		elseif idx==2 then
		tabname="UI.gameui.taskdlg.worldtab";
		end;
		
		if tabname=="" then
			return;
		end;
		
		--保存当前选择
		local sel=Win_GetValue(tabname..".tasklist",value_channel_sel);
		Win_SetValue(tabname..".tasklist",num,value_channel_item_num);
		
		if idx==1 then
			sel = GetCurSelTask();
		else
			if newsel >=0 then
			sel=newsel;
			end;
			
			if sel>=num then
			sel=num-1;
			end;
			
			if sel<0 then
			sel=0;
			end;
		end;
		
		Win_SetValue(tabname..".tasklist",sel,value_channel_sel);
		
		if idx==1 then
		UI.children.gameui.children.taskdlg.children.doingtab.children.tasklist.OnValueChange();
		elseif idx==2 then
		UI.children.gameui.children.taskdlg.children.worldtab.children.tasklist.OnValueChange();
		end;
		
		end;
			      
	OnOpenSkillWin=function(bshow,itype)
		if bshow==0  then
		Win_ShowWidget("UI.gameui.skilldlg",false);			   
		else 								  
		Win_ShowWidget("UI.gameui.skilldlg",true);				  
		Win_SelectSelf("UI.gameui.skilldlg.tab0");
		Win_SetFocus("UI.gameui.skilldlg.tab0");
		end;
		end;
		
	OnFmSkillUpdate=function()
		local swqid=GetPlayerProf();

		--飞升前技能界面
		if swqid >= 0 and swqid < 6 then
		Win_SetValue("UI.gameui.familydetaildlg.fmskilltab",ui_drag_type_skill_main,value_channel_customtype);
		Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab",true);
		end;
		
		--新手
		if (swqid >= 0 and swqid <=3) then
		local bskill1=IsSkillLearnt(13601,0);
		local bskill2=IsSkillLearnt(13602,0);
		Win_SetValue("UI.gameui.familydetaildlg.fmskilltab",skill_page_fmskill1,value_channel_customid);
		elseif (swqid >= 4 and swqid <=5) then
		Win_SetValue("UI.gameui.familydetaildlg.fmskilltab",skill_page_fmskill2,value_channel_customid);
		end;
	
		local num = GetUltimateNum();
		Win_SetText("UI.gameui.familydetaildlg.fmskilltab.remainnumlabel",num);
		
		local dgtype = Win_GetValue("UI.gameui.familydetaildlg",value_channel_customtype);
		local pageid = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab",value_channel_customid);

		if Win_IsVisible("UI.gameui.familydetaildlg") then
			--SetSkillTreePage(pageid);
		end;
		
		local skillid = "";
		local pageinfo = GetPageSkillInfo(pageid);
		local stop = Win_GetValue("UI.gameui.familydetaildlg",value_channel_customindex);
		
		for i=0,pageinfo.skillnum-1 do 
			local skill = GetPageSkill(pageid,i); 
			local id = skill.id;
			local tabid = "UI.gameui.familydetaildlg.fmskilltab";
			skillid = tabid..".skillcontain.allskills.skill"..(i+1);
			
			local ox = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,dgtype,value_channel_dragtype);
			
			local status;
			if dgtype==ui_drag_type_skill_life then
				Win_SetValue(skillid,i,value_channel_dragindex);
				status=SkillGetStatus(dgtype,i+1);
			else
			Win_SetValue(skillid,id,value_channel_dragindex);
			status=SkillGetStatus(dgtype,id);
			end;

			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else 
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
			end;
		
		end;
				
	OnSkillUpdate=function()
		for j=1, 25 do
			local wgt;

			wgt = "UI.gameui.skilldlg.tab0.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt= "UI.gameui.skilldlg.tab1.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt= "UI.gameui.skilldlg.tab2.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt = "UI.gameui.skilldlg.tab3.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		for j=1,20 do
			local wgt;
			wgt = "UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt = "UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		for j=1,5 do
			local wgt;
			wgt = "UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		local swqid=GetPlayerProf();
		
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab1",skill_page_comm,value_channel_customid);

		--飞升前技能界面
		if swqid >= 0 and swqid < 6 then
--		local oy = Win_GetValue("UI.gameui.skilldlg.tab0",value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab1.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab1.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab2.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab2.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab3.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab3.skillcontain",356,value_channel_winrect,3);
		
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/maintab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/othertab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_other,value_channel_customtype);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_ShowWidget("UI.gameui.skilldlg.tab3",false);
		
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",ui_drag_type_godstep_skill_profession,value_channel_customtype);
		Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.tab0",true);
		
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab1",ui_drag_type_godstep_skill_common,value_channel_customtype);
		Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.tab1",true);
		
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",ui_drag_type_godstep_skill_xianfa,value_channel_customtype);
		Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.tab2",true);
		
		else
--		local oy = Win_GetValue("UI.gameui.skilldlg.tab0",value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab1.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab1.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab2.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab2.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.skilldlg.tab3.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.skilldlg.tab3.skillcontain",331,value_channel_winrect,3);
		end;
		
		if swqid ~= 4 then
		Win_SetText("UI.gameui.skilldlg.tab0.skillcontain.allskills","",value_channel_backpic);
		end;
		
		
		

		
		--新手
		if swqid == 0 then
		local bskill1=IsSkillLearnt(13601,0);
		local bskill2=IsSkillLearnt(13602,0);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_newbie,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",-1,value_channel_customid);
		--战士
		elseif swqid == 1 then
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_main1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_other1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_equipskill1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa1,value_channel_customid);
		--剑客
		elseif swqid == 2 then
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_main2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_other2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_equipskill2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa2,value_channel_customid);
		--刺客
		elseif swqid == 3 then
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_main3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_other3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_equipskill3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa3,value_channel_customid);
		--药师
		elseif swqid == 4 then
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_main4,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_other4,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_equipskill4,value_channel_customid);
		Win_SetText("UI.gameui.skilldlg.tab0.skillcontain.allskills","res/uires/skilldlg/maintree4_2.gsa",value_channel_backpic);
		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills",7,value_channel_backpicpos,0);
		Win_SetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills",14,value_channel_backpicpos,1);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep4,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa4,value_channel_customid);
		--术士
		elseif swqid == 5 then
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_main5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_other5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_equipskill5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa5,value_channel_customid);
		
		--飞升后技能界面
		--天武者
		elseif swqid == 6 then
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/tabLONGHUN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_aohun,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/tabWUDOU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_wudou,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/tabLINGJUN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_lingjun,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_SetText("UI.gameui.skilldlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab3",true);
		
		--剑圣
		elseif swqid == 7 then
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/tabPANSHI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_panshi,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/tabJIANJI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_jianji,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/tabYINGYONG.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_yingyong,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_SetText("UI.gameui.skilldlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab3",true);
		
		--无双影者
		elseif swqid == 8 then
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/tabYINGREN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_yingren,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/tabANQI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_anqi,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/tabSHOULIE.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_shoulie,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_SetText("UI.gameui.skilldlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab3",true);
		
		--神术师
		elseif swqid == 9 then
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/tabZHOULI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_zhouli,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/tabWUDU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_wudu,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/tabXIANSHU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_xianshu,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_SetText("UI.gameui.skilldlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab3",true);
		
		--大策法师
		elseif swqid == 10 then
		Win_SetText("UI.gameui.skilldlg.tab0","res/uires/skilldlg/tabYAN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab0",skill_page_yan,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab0",true);
		
		Win_SetText("UI.gameui.skilldlg.tab1","res/uires/skilldlg/tabHAN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab1",skill_page_han,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab1",true);
		
		Win_SetText("UI.gameui.skilldlg.tab2","res/uires/skilldlg/tabLING.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab2",skill_page_ling,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab2",true);
		
		Win_SetText("UI.gameui.skilldlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.skilldlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.skilldlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.skilldlg.tab3",true);

		end;

		local dgtype = Win_GetValue("UI.gameui.skilldlg",value_channel_customtype);
		local pageid = Win_GetValue("UI.gameui.skilldlg",value_channel_customid);
		
		local skillpt=SkillGetPoints();
		Win_SetText("UI.gameui.skilldlg.pointlabel",skillpt);
		Win_ShowWidget("UI.gameui.skilldlg.skillfire",(skillpt>0));
		
		if Win_IsVisible("UI.gameui.skilldlg") then
		SetSkillTreePage(pageid);
		end;
		
		local skillid = "";
		local pageinfo = GetPageSkillInfo(pageid);
		local stop = Win_GetValue("UI.gameui.skilldlg",value_channel_customindex);
		
		local containid = "UI.gameui.skilldlg.tab"..stop..".skillcontain";
		local oldheight = Win_GetValue(containid..".allskills",value_channel_winrect,3);
		if oldheight ~= pageinfo.height then
		Win_SetValue(containid..".allskills",pageinfo.height,value_channel_winrect,3);		
		Win_SetValue(containid..".allskills",pageinfo.height,value_channel_clientrect,3);
		Win_AjustSelf(containid);
		end;
		
		local godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0",value_channel_customid);
		local godskillprofessionpageinfo = GetPageSkillInfo(godskillpageid);

		
		for i=0,godskillprofessionpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_profession,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_profession,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
		end;
		
		godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1",value_channel_customid);
		local godskillcommonpageinfo = GetPageSkillInfo(godskillpageid);
		
		for i=0,godskillcommonpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_common,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_common,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
		end;
		
		godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customid);
		local godskillxianfapageinfo = GetPageSkillInfo(godskillpageid);
		
		for i=0,godskillxianfapageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_xianfa,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_xianfa,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
		end;
		
		if swqid >=1 and swqid<=5 then --初行者跳过
			--轮回技能
			local recyclepage = misc_value_recycle_skillpage_begin + swqid - 1;
			local recyclepageinfo = GetPageSkillInfo(recyclepage);
			for i=0,recyclepageinfo.skillnum-1 do
				local skill = GetPageSkill(recyclepage,i);
				local id = skill.id;
				
				local skillid;
				
				if i >= 0 and i < 4 then
					skillid = "UI.gameui.recycledlg.recycleskilldlg.allskills.skill"..(i+1);
				elseif i >= 4 and i < 7 then
					skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills1.skill"..(i-3);
				elseif i >= 7 and i < 10 then
				    skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills2.skill"..(i-6);
				elseif i >= 10 and i < 13 then
				    skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills3.skill"..(i-9);
				elseif i >= 13 and i < 16 then
				    skillid = "UI.gameui.recycledlg.recycleskilldlg.fuwenskills4.skill"..(i-12);
				end;
				
				Win_SetValue(skillid,ui_drag_type_recycle,value_channel_dragtype);
				Win_SetValue(skillid,id,value_channel_dragindex);
				
				local status;
				status=SkillGetStatus(ui_drag_type_recycle,id);
				
				if (status.blearned) then-- 是否已经学会
					UI.children.gameui.Enableskillcheck(i);
					Win_SetValue(skillid,1,value_channel_framescheme);
					if (status.level == status.maxlevel) then -- 是否已经满级
						Win_ShowWidget(skillid..".upgradebtn",false);
					else
						if (status.bcanupgrade) then
							Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
							Win_SetValue(skillid, 1, value_channel_customtype);
							Win_ShowWidget(skillid..".upgradebtn",true);
						else
							Win_ShowWidget(skillid..".upgradebtn",false);
						end;
					end;
				else
					if (status.bcanlearn) then
						Win_SetValue(skillid,1,value_channel_framescheme);
						Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
						Win_SetValue(skillid, 0, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else 
						Win_SetValue(skillid,0,value_channel_framescheme);
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
				
				if swqid > 0 then
					Win_ShowWidget(skillid, true);
				end;
			end;
		end;
		
		
		for i=0,pageinfo.skillnum-1 do 
			local skill = GetPageSkill(pageid,i); 
			local id = skill.id;
			local tabid = "UI.gameui.skilldlg.tab"..stop;
			skillid = tabid..".skillcontain.allskills.skill"..(i+1);
			
			local ox = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,dgtype,value_channel_dragtype);
			
			local status;
		--	if dgtype==ui_drag_type_skill_life then
		--		Win_SetValue(skillid,i,value_channel_dragindex);
		--		status=SkillGetStatus(dgtype,i+1);
		--	else
			Win_SetValue(skillid,id,value_channel_dragindex);
			status=SkillGetStatus(dgtype,id);
		--	end;
			
			--[[local levelflag=((skillpt>0)and(status.level<status.maxlevel)and(status.bupgradelevel~=0));
			local rawflag=((status.blearned)and(status.bupgrade)and (status.bupgradepoint~=0));			
				
			if (status.bstudy and status.bcanlearn) then--学习按键的功能
			Win_SetValue(skillid,0,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",true);
			elseif (levelflag and rawflag) then--升级按键的功能
			Win_SetValue(skillid,1,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",true);
			else
			Win_SetValue(skillid,0,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",false);
			end;
			
			if status.blearned ~= false then
				Win_SetValue(skillid,1,value_channel_framescheme);
			else
				Win_SetValue(skillid,0,value_channel_framescheme);
			end;--]]
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else 
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
			end;
		
		local usedpoints;
		if swqid == 0 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_newbie);
		--战士
		elseif swqid == 1 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main1) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other1) ;		
		--剑客
		elseif swqid == 2 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main2) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other2) ;		
		--刺客
		elseif swqid == 3 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main3) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other3) ;		
		--药师
		elseif swqid == 4 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main4) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other4) ;		
		--术士
		elseif swqid == 5 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main5) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other5) ;		
		end;
		-- 主修， 辅助一共多少点
		Win_SetText("UI.gameui.skilldlg.usedpointslabel",usedpoints);		
		
		--新手技能界面特殊处理
		if swqid == 0 then
		local bskill1=IsSkillLearnt(13601,1);
		local bskill2=IsSkillLearnt(13602,1);
		Win_ShowWidget("UI.gameui.skilldlg.tab0.skillcontain.allskills.infolabel",(not(bskill1 or bskill2)));
		Win_ShowWidget("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill1",bskill1);
		Win_ShowWidget("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill2",bskill2);
		--这里请注意这个bug：新手技能若学会后“+“按钮不再显示，所以后面加上一个判断条件 add by Abrahamhu 2008-03-10
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1.upgradebtn",bskill1 and not IsSkillLearnt(13601,0));
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2.upgradebtn",bskill2 and not IsSkillLearnt(13602,0));

		Win_ShowWidget("UI.gameui.skilldlg.tab1.skillcontain.allskills.infolabel",true);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.suitskillbk",false);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.usesuitskillbk",false);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.skilllockcheck",false);		
		else
		Win_ShowWidget("UI.gameui.skilldlg.tab0.skillcontain.allskills.infolabel",false);
		Win_ShowWidget("UI.gameui.skilldlg.tab1.skillcontain.allskills.infolabel",false);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.suitskillbk",true);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.usesuitskillbk",true);
		Win_ShowWidget("UI.gameui.skilldlg.tab2.skillcontain.allskills.skilllockcheck",true);			
		end;
		
		end;
	      
	      
	OnSkillLearn=function(prof)
		Win_ShowWidget("UI.gameui.studydlg",true);
		if prof==0 then
		local swqid=GetPlayerProf();
			if swqid < 6 then
			Win_SelectSelf("UI.gameui.studydlg.tab2");
			Win_SetFocus("UI.gameui.studydlg.tab2");
			else
			Win_SelectSelf("UI.gameui.studydlg.tab3");
			Win_SetFocus("UI.gameui.studydlg.tab3");
			end;
		else
		Win_SelectSelf("UI.gameui.studydlg.tab0");
		Win_SetFocus("UI.gameui.studydlg.tab0");
		end;		
		end;
		
	OnLearnUpdate=function()
		for j=1, 25 do
			local wgt;
			wgt = "UI.gameui.studydlg.tab0.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt= "UI.gameui.studydlg.tab1.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt= "UI.gameui.studydlg.tab2.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt = "UI.gameui.studydlg.tab3.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		for j=1,20 do
			local wgt;
			wgt = "UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
			wgt = "UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		for j=1,5 do
			local wgt;
			wgt = "UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill"..j;
			Win_ShowWidget(wgt,false);
		end;
		
		local swqid=GetPlayerProf();
		
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab1",skill_page_comm,value_channel_customid);
		
		if swqid ~= 4 then
		Win_SetText("UI.gameui.studydlg.tab0.skillcontain.allskills","",value_channel_backpic);
		end;
		
		--飞升前技能界面
		if swqid >= 0 and swqid < 6 then
--		local oy = Win_GetValue("UI.gameui.studydlg.tab0",value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab1.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab1.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab2.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab2.skillcontain",356,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab3.skillcontain",oy,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab3.skillcontain",356,value_channel_winrect,3);
		
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/maintab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/othertab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_other,value_channel_customtype);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_ShowWidget("UI.gameui.studydlg.tab3",false);
		
		else
--		local oy = Win_GetValue("UI.gameui.studydlg.tab0",value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab1.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab1.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab2.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab2.skillcontain",331,value_channel_winrect,3);
--		Win_SetValue("UI.gameui.studydlg.tab3.skillcontain",oy+23,value_channel_winrect,1);
--		Win_SetValue("UI.gameui.studydlg.tab3.skillcontain",331,value_channel_winrect,3);
		end;
		
		--新手
		if swqid == 0 then
		local bskill1=IsSkillLearnt(13601,0);
		local bskill2=IsSkillLearnt(13602,0);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_newbie,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",-1,value_channel_customid);
		--战士
		elseif swqid == 1 then
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_main1,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_other1,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_equipskill1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep1,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa1,value_channel_customid);
		--剑客
		elseif swqid == 2 then
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_main2,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_other2,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_equipskill2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep2,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa2,value_channel_customid);
		--刺客
		elseif swqid == 3 then
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_main3,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_other3,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_equipskill3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep3,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa3,value_channel_customid);
		--药师
		elseif swqid == 4 then
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_main4,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_other4,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_equipskill4,value_channel_customid);
		Win_SetText("UI.gameui.studydlg.tab0.skillcontain.allskills","res/uires/skilldlg/maintree4_2.gsa",value_channel_backpic);
		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain.allskills",7,value_channel_backpicpos,0);
		Win_SetValue("UI.gameui.studydlg.tab0.skillcontain.allskills",14,value_channel_backpicpos,1);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep4,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa4,value_channel_customid);
		--术士
		elseif swqid == 5 then
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_main5,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_other5,value_channel_customid);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_equipskill5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab0",skill_page_godstep5,value_channel_customid);
		Win_SetValue("UI.gameui.skilldlg.godstepdlg.tab2",skill_page_xianfa5,value_channel_customid);
		
		--飞升后技能界面
		--天武者
		elseif swqid == 6 then
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/tabLONGHUN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_aohun,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/tabWUDOU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_wudou,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/tabLINGJUN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_lingjun,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_SetText("UI.gameui.studydlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab3",true);
		
		--剑圣
		elseif swqid == 7 then
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/tabPANSHI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_panshi,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/tabJIANJI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_jianji,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/tabYINGYONG.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_yingyong,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_SetText("UI.gameui.studydlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab3",true);
		
		--无双影者
		elseif swqid == 8 then
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/tabYINGREN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_yingren,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/tabANQI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_anqi,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/tabSHOULIE.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_shoulie,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_SetText("UI.gameui.studydlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab3",true);
		
		--神术师
		elseif swqid == 9 then
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/tabZHOULI.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_zhouli,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/tabWUDU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_wudu,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/tabXIANSHU.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_xianshu,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_SetText("UI.gameui.studydlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab3",true);
		
		Win_SetText("UI.gameui.studydlg.tab0.skillcontain.allskills","",value_channel_backpic);
		
		--大策法师
		elseif swqid == 10 then
		Win_SetText("UI.gameui.studydlg.tab0","res/uires/skilldlg/tabYAN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab0",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab0",skill_page_yan,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab0",true);
		
		Win_SetText("UI.gameui.studydlg.tab1","res/uires/skilldlg/tabHAN.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab1",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab1",skill_page_han,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab1",true);
		
		Win_SetText("UI.gameui.studydlg.tab2","res/uires/skilldlg/tabLING.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab2",ui_drag_type_skill_main,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab2",skill_page_ling,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab2",true);
		
		Win_SetText("UI.gameui.studydlg.tab3","res/uires/skilldlg/lifetab.gsa",value_channel_tabcover);
		Win_SetValue("UI.gameui.studydlg.tab3",ui_drag_type_skill_life,value_channel_customtype);
		Win_SetValue("UI.gameui.studydlg.tab3",skill_page_life,value_channel_customid);
		Win_ShowWidget("UI.gameui.studydlg.tab3",true);

		end;

		local dgtype = Win_GetValue("UI.gameui.studydlg",value_channel_customtype);
		local pageid = Win_GetValue("UI.gameui.studydlg",value_channel_customid);
		
		local skillpt=SkillGetPoints();
		Win_SetText("UI.gameui.studydlg.pointlabel",skillpt);
		Win_ShowWidget("UI.gameui.studydlg.skillfire",(skillpt>0));
		
		if Win_IsVisible("UI.gameui.studydlg") then
		SetSkillTreePage(pageid);
		end;
		
		local skillid = "";
		local pageinfo = GetPageSkillInfo(pageid);
		local stop = Win_GetValue("UI.gameui.studydlg",value_channel_customindex);
		
		local containid = "UI.gameui.studydlg.tab"..stop..".skillcontain";
		local oldheight = Win_GetValue(containid..".allskills",value_channel_winrect,3);
		if oldheight ~= pageinfo.height then
		Win_SetValue(containid..".allskills",pageinfo.height,value_channel_winrect,3);		
		Win_SetValue(containid..".allskills",pageinfo.height,value_channel_clientrect,3);
		Win_AjustSelf(containid);
		end;
		
		local godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0",value_channel_customid);
		local godskillprofessionpageinfo = GetPageSkillInfo(godskillpageid);

		
		for i=0,godskillprofessionpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_profession,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_profession,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
		end;
		
		godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1",value_channel_customid);
		local godskillcommonpageinfo = GetPageSkillInfo(godskillpageid);
		
		for i=0,godskillcommonpageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_common,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_common,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
		end;
		
		godskillpageid = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customid);
		local godskillxianfapageinfo = GetPageSkillInfo(godskillpageid);
		
		for i=0,godskillxianfapageinfo.skillnum-1 do
			local skill = GetPageSkill(godskillpageid,i);
			local id = skill.id;
			local skillid = "UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill"..(i+1);
			local ox = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,ui_drag_type_godstep_skill_xianfa,value_channel_dragtype);
			Win_SetValue(skillid,id,value_channel_dragindex);
			
			local status;
			status=SkillGetStatus(ui_drag_type_godstep_skill_xianfa,id);
			
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			if swqid > 0 then
				Win_ShowWidget(skillid, true);
			end;
		end;
		
		for i=0,pageinfo.skillnum-1 do 
			local skill = GetPageSkill(pageid,i); 
			local id = skill.id;
			local tabid = "UI.gameui.studydlg.tab"..stop;
			skillid = tabid..".skillcontain.allskills.skill"..(i+1);
			
			local ox = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,0);
			Win_SetValue(skillid,ox+skill.ox,value_channel_winrect,0);
			local oy = Win_GetValue(tabid..".skillcontain.allskills",value_channel_winrect,1);
			Win_SetValue(skillid,oy+skill.oy,value_channel_winrect,1);
			
			Win_SetValue(skillid,dgtype,value_channel_dragtype);
			
			local status;
		--	if dgtype==ui_drag_type_skill_life then
		--		Win_SetValue(skillid,i,value_channel_dragindex);
		--		status=SkillGetStatus(dgtype,i+1);
		--	else
			Win_SetValue(skillid,id,value_channel_dragindex);
			status=SkillGetStatus(dgtype,id);
		--	end;
			
			--Win_ShowWidget(skillid..".upgradebtn",status.bstudy and status.bcanlearn);
			
			--[[local levelflag=((skillpt>0)and(status.level<status.maxlevel)and(status.bupgradelevel~=0));
			local rawflag=((status.blearned)and(status.bupgrade)and (status.bupgradepoint~=0));			
				
			if (status.bstudy and status.bcanlearn) then--学习按键的功能
			Win_SetValue(skillid,0,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",true);
			elseif (levelflag and rawflag) then--升级按键的功能
			Win_SetValue(skillid,1,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",true);
			else
			Win_SetValue(skillid,0,value_channel_customtype);
			Win_SetText(skillid..".upgradebtn","",value_channel_tiptext);
			Win_ShowWidget(skillid..".upgradebtn",false);
			end;
			
			if status.blearned ~= false then
				Win_SetValue(skillid,1,value_channel_framescheme);
			else
				Win_SetValue(skillid,0,value_channel_framescheme);
			end;--]]
			if (status.blearned) then-- 是否已经学会
				Win_SetValue(skillid,1,value_channel_framescheme);
				if (status.level == status.maxlevel) then -- 是否已经满级
					Win_ShowWidget(skillid..".upgradebtn",false);
				else
					if (status.bcanupgrade) then
						Win_SetText(skillid..".upgradebtn","升级",value_channel_tiptext);
						Win_SetValue(skillid, 1, value_channel_customtype);
						Win_ShowWidget(skillid..".upgradebtn",true);
					else
						Win_ShowWidget(skillid..".upgradebtn",false);
					end;
				end;
			else 
				if (status.bcanlearn) then
					Win_SetValue(skillid,1,value_channel_framescheme);
					Win_SetText(skillid..".upgradebtn","学习",value_channel_tiptext);
					Win_SetValue(skillid, 0, value_channel_customtype);
					Win_ShowWidget(skillid..".upgradebtn",true);
				else 
					Win_SetValue(skillid,0,value_channel_framescheme);
					Win_ShowWidget(skillid..".upgradebtn",false);
				end;
			end;
			
			Win_ShowWidget(skillid, true);
			end;
			
		local usedpoints;
		if swqid == 0 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_newbie);
		--战士
		elseif swqid == 1 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main1) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other1) ;		
		--剑客
		elseif swqid == 2 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main2) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other2) ;		
		--刺客
		elseif swqid == 3 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main3) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other3) ;		
		--药师
		elseif swqid == 4 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main4) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other4) ;		
		--术士
		elseif swqid == 5 then
			usedpoints = GetUsedPoints(ui_drag_type_skill_main, skill_page_main5) + GetUsedPoints(ui_drag_type_skill_other, skill_page_other5) ;		
		end;
		-- 主修， 辅助一共多少点
		Win_SetText("UI.gameui.studydlg.usedpointslabel",usedpoints);
		
		--新手技能界面特殊处理
		if swqid == 0 then
		local bskill1=IsSkillLearnt(13601,1);
		local bskill2=IsSkillLearnt(13602,1);
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.infolabel",(not(bskill1 or bskill2)));
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1",bskill1);
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2",bskill2);
		--这里请注意这个bug：新手技能若学会后“+“按钮不再显示，所以后面加上一个判断条件 add by Abrahamhu 2008-03-10
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1.upgradebtn",bskill1 and not IsSkillLearnt(13601,0));
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2.upgradebtn",bskill2 and not IsSkillLearnt(13602,0));

		Win_ShowWidget("UI.gameui.studydlg.tab1.skillcontain.allskills.infolabel",true);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.suitskillbk",false);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.usesuitskillbk",false);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.skilllockcheck",false);			
		else
		Win_ShowWidget("UI.gameui.studydlg.tab0.skillcontain.allskills.infolabel",false);
		Win_ShowWidget("UI.gameui.studydlg.tab1.skillcontain.allskills.infolabel",false);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.suitskillbk",true);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.usesuitskillbk",true);
		Win_ShowWidget("UI.gameui.studydlg.tab2.skillcontain.allskills.skilllockcheck",true);			
		end;
		
		end;
	
	
	OnTeamUpdate=function(ntimer)
		local teaminfo=TeamGetInfo();
		
		--在队伍中
		if teaminfo.nmember>0 then
		
		--关闭语音系统
		--Win_ShowWidget("UI.gameui.statusbar.teambtn.voicesetbtn",teaminfo.isleader);
		
		if not Win_IsVisible("UI.gameui.teambtn") then		
		Win_SetCheck("UI.gameui.teambtn",true);
		Win_ShowWidget("UI.gameui.teambtn",true);
		end;
		if not Win_IsChecked("UI.gameui.teambtn") then
		Win_SetValue("UI.gameui.teambtn",ntimer,value_channel_timerspace);
		if ntimer>0 then
		Win_ShowWidget("UI.gameui.teambtn.noticelabel",true);		
		end;
		else
		Win_SetValue("UI.gameui.teambtn",-1,value_channel_timerspace);
		Win_ShowWidget("UI.gameui.teambtn.noticelabel",false);		
		end;
		else
		Win_SetCheck("UI.gameui.teambtn",false);
		Win_ShowWidget("UI.gameui.teambtn",false);		
		end;
				
		UI.children.gameui.children.teamdlg.UpdateTeamTab();
		UI.children.gameui.children.teambar.UpdateTeamBar();
		end;
	
	OnUpdateTaskList=function()		
		UI.children.gameui.children.titledlg.children.tasktitledlg.OnSelfShow();
		UI.children.gameui.children.titledlg.children.honortitledlg.OnSelfShow();
		end;
	
	OnOpenMailList=function()		
		if not Win_IsVisible("UI.gameui.maillistdlg") then 
		--Win_AlignWidget("UI.gameui.maillistdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
		Win_ShowWidget("UI.gameui.maillistdlg",true);
		Win_SetFocus("UI.gameui.maillistdlg");
		else
		UI.children.gameui.children.maillistdlg.UpdateMailList();		
		end;
		end;
				
	
	OnOpenMail=function(idx)			        
		--读邮件
		local pfrom,ptitle,pbody,money,bowlder,ntype,nitem,nmode=GetMailDetail(idx+1);
		
		local dlgname="";
		if ntype==0 then
		dlgname="UI.gameui.readmaildlg";
		--Win_SetText(dlgname,"普通邮件");		
		elseif ntype==1 then
		dlgname="UI.gameui.readsmallpackdlg";
		gold=math.floor(money/1000000);
		silver=math.floor((money-gold*1000000)/1000);
		copper=money-gold*1000000-silver*1000;
		Win_SetText(dlgname..".goldedit",gold);
		Win_SetText(dlgname..".silveredit",silver);
		Win_SetText(dlgname..".copperedit",copper);
		--Win_SetText(dlgname,"收取小包裹");
		elseif ntype==2 then
		dlgname="UI.gameui.readbigpackdlg";
		gold=math.floor(money/1000000);
		silver=math.floor((money-gold*1000000)/1000);
		copper=money-gold*1000000-silver*1000;
		Win_SetText(dlgname..".goldedit",gold);
		Win_SetText(dlgname..".silveredit",silver);
		Win_SetText(dlgname..".copperedit",copper);
		elseif ntype==6 then		
		dlgname="UI.gameui.readsmallpackdlg";
		gold=math.floor(money/1000000);
		silver=math.floor((money-gold*1000000)/1000);
		copper=money-gold*1000000-silver*1000;
		Win_SetText(dlgname..".goldedit",gold);
		Win_SetText(dlgname..".silveredit",silver);
		Win_SetText(dlgname..".copperedit",copper);	
		--Win_SetText(dlgname,"好友祝福");
		elseif ntype==7 then
		dlgname="UI.gameui.exreadmaildlg";
		--Win_SetText(dlgname,"普通邮件");	
		Win_SetText(dlgname..".bowlderedit", bowlder);
		elseif ntype==8 then
			dlgname="UI.gameui.invitationmaildlg";
			local marriageinfo ={};
			local info;
			local infoindex = 1;
			for info in string.gfind(pbody, "%S+") do
				marriageinfo[infoindex] = info;
				infoindex = infoindex + 1;
			end;
			
			Win_SetText(dlgname..".husbandlabel",marriageinfo[1] );
			Win_SetText(dlgname..".wifelabel",marriageinfo[2] );
			Win_SetText(dlgname..".marriagedate",marriageinfo[3] );	
		elseif ntype==9 then
			dlgname="UI.gameui.luxinvitationmaildlg";
			local marriageinfo ={};
			local info;
			local infoindex = 1;
			for info in string.gfind(pbody, "%S+") do
				marriageinfo[infoindex] = info;
				infoindex = infoindex + 1;
			end;
			
			Win_SetText(dlgname..".husbandlabel",marriageinfo[1] );
			Win_SetText(dlgname..".wifelabel",marriageinfo[2] );
			Win_SetText(dlgname..".marriagedate",marriageinfo[3] );	
		else
		dlgname="UI.gameui.readmaildlg";
		--Win_SetText(dlgname,"家族邮件");		
		end;
		
 		if ntype~=8 and ntype ~=9 then
		Win_SetText(dlgname..".manedit",pfrom);
		Win_SetText(dlgname..".titleedit",ptitle);
		Win_SetText(dlgname..".contentedit",pbody);
		
		if (nmode==0) then
		color=GetColorIndex(255,255,255,255);
		else
		color=GetColorIndex(255,0,0,255);
		end;
		Win_SetValue(dlgname..".titleedit",color,value_channel_color_draw);
		end;
		
		if not Win_IsVisible(dlgname) then
		Win_ShowWidget(dlgname,true);
		end;
		
		Win_SetFocus(dlgname);
		
		end;

	OnWriteMail=function(ntype,pto,ptitle)			        
		local dlgname="";
		if ntype==0 then
		dlgname="UI.gameui.sendmaildlg";
		Win_EnableWidget("UI.gameui.sendmaildlg.manedit",true);		
		Win_EnableWidget("UI.gameui.sendmaildlg.manbtn",true);		
		--Win_SetText("UI.gameui.sendmaildlg","发送邮件");
		elseif ntype==1 then
		dlgname="UI.gameui.sendsmallpackdlg";
		Win_SetValue(dlgname..".goldedit",0);
		Win_SetValue(dlgname..".silveredit",0);				
		Win_SetValue(dlgname..".copperedit",0);
		Win_ShowWidget("UI.gameui.waredlg",true);
		elseif ntype==2 then
		dlgname="UI.gameui.sendbigpackdlg";
		Win_SetValue(dlgname..".goldedit",0);
		Win_SetValue(dlgname..".silveredit",0);				
		Win_SetValue(dlgname..".copperedit",0);				
		Win_ShowWidget("UI.gameui.waredlg",true);
		elseif ntype==6 then
		dlgname="UI.gameui.sendmaildlg";
		Win_EnableWidget("UI.gameui.sendmaildlg.manedit",true);		
		Win_EnableWidget("UI.gameui.sendmaildlg.manbtn",true);	
		--Win_SetText("UI.gameui.sendmaildlg","发送祝福");
		else
		dlgname="UI.gameui.sendmaildlg";
		Win_EnableWidget("UI.gameui.sendmaildlg.manedit",false);
		Win_EnableWidget("UI.gameui.sendmaildlg.manbtn",false);		
		end;
		
		Win_SetText(dlgname..".manedit",pto);
		Win_SetText(dlgname..".titleedit",ptitle);
		
		Win_SetValue(dlgname,ntype,value_channel_customtype);			
		
		if not Win_IsVisible(dlgname) then
		Win_SetText(dlgname..".contentedit","");
		Win_ShowWidget(dlgname,true);
		end;
		
		if not ( Win_IsChildFocused(dlgname) or Win_IsFocused(dlgname) ) then
		Win_SetFocus(dlgname..".titleedit");
		end;
		

		end;
	
					
	OnOpenConsign=function(consigntype,consignflag)
		if consigntype==0 then
		Win_ShowWidget("UI.gameui.consignrealcarddlg",true);
		elseif consigntype==1 then
		Win_ShowWidget("UI.gameui.consignbindcarddlg",true);
		elseif consigntype==2 then
		if consignflag>=0 then
		Win_ShowWidget("UI.gameui.consignpointcarddlg",true);
		else
		UI.children.gameui.children.consignpointcarddlg.children.list.OnUpdate();
		end;
		end;
		end;
	
	OnOpenPlayerShop=function(bshow,shoptype)
		
		local shopname={"出售物品","购买物品","我的出售商店","我的收购商店"};		
		
		if bshow==0  then
			Win_ShowWidget("UI.gameui.groceryconfigdlg",false);
			Win_ShowWidget("UI.gameui.grocerystatusdlg",false);
		elseif shoptype>1 then
			if (shoptype==2) then
				Win_SetText("UI.gameui.grocerystatusdlg","res/uires/grocerydlg/grocerystatus.gsa", value_channel_backpic);	
			else
				Win_SetText("UI.gameui.grocerystatusdlg","res/uires/grocerydlg/grocerystatus2.gsa", value_channel_backpic);	
			end;

			local GroceryNum=GetNumShopItem();
			Win_SetValue("UI.gameui.grocerystatusdlg.grocerylist",GroceryNum,value_channel_item_num);	
			Win_ShowWidget("UI.gameui.grocerystatusdlg",true);
			Win_SetFocus("UI.gameui.grocerystatusdlg");
		else		
			if shoptype == 0 then
				Win_SetText("UI.gameui.groceryconfigdlg","res/uires/grocerydlg/groceryconfig.gsa", value_channel_backpic);	
				Win_ShowWidget("UI.gameui.groceryconfigdlg.shopquerychk", true);
			else
				Win_SetText("UI.gameui.groceryconfigdlg","res/uires/grocerydlg/groceryconfig2.gsa", value_channel_backpic);		
				Win_ShowWidget("UI.gameui.groceryconfigdlg.shopquerychk", false);
			end;
			
			local GroceryNum=GetNumShopItem();
			Win_SetValue("UI.gameui.groceryconfigdlg.grocerylist",GroceryNum,value_channel_item_num);	
			Win_SetText("UI.gameui.groceryconfigdlg.nameedit","");
			Win_ShowWidget("UI.gameui.groceryconfigdlg",true);
			Win_SetFocus("UI.gameui.groceryconfigdlg");				   
		end;		
		
	end;
	
	OnOpenPlayerSafeShop=function(bshow,shoptype)		
		if bshow==0  then
			Win_ShowWidget("UI.gameui.safegroceryconfigdlg",false);
			Win_ShowWidget("UI.gameui.safegrocerystatusdlg",false);
		elseif shoptype>1 then
			Win_SetText("UI.gameui.safegrocerystatusdlg","res/uires/safeshopquery/safegrocerystatus.gsa", value_channel_backpic);	
			local GroceryNum=GetNumSafeShopItem();
			Win_SetValue("UI.gameui.safegrocerystatusdlg.grocerylist",GroceryNum,value_channel_item_num);	
			Win_ShowWidget("UI.gameui.safegrocerystatusdlg",true);
			Win_SetFocus("UI.gameui.safegrocerystatusdlg");
		else		
			if shoptype == 0 then
				Win_ShowWidget("UI.gameui.safegroceryconfigdlg.shopquerychk", true);
			else	
				Win_ShowWidget("UI.gameui.safegroceryconfigdlg.shopquerychk", false);
			end;
			Win_SetText("UI.gameui.safegroceryconfigdlg","res/uires/safeshopquery/safegroceryconfig.gsa", value_channel_backpic);
			
			local GroceryNum=GetNumSafeShopItem();
			Win_SetValue("UI.gameui.safegroceryconfigdlg.grocerylist",GroceryNum,value_channel_item_num);	
			Win_SetText("UI.gameui.safegroceryconfigdlg.nameedit","");
			Win_ShowWidget("UI.gameui.safegroceryconfigdlg",true);
			Win_SetFocus("UI.gameui.safegroceryconfigdlg");				   
		end;
	end;
	
	OnOpenSafeShopItem=function(pname)
		Win_SetText("UI.gameui.safegrocerydetaildlg.nameedit",pname);
		Win_ShowWidget("UI.gameui.safegrocerydetaildlg",true);
		Win_SetFocus("UI.gameui.safegrocerydetaildlg.goldedit");
	end;
				    
	OnOpenShopItem=function(price,maxnum,pname)
	        local gold=math.floor(price/1000000);
     		local silver=math.floor((price-gold*1000000)/1000);
		local copper=price-gold*1000000-silver*1000;
		
		Win_SetText("UI.gameui.grocerydetaildlg.goldlabel",gold);
		Win_SetText("UI.gameui.grocerydetaildlg.silverlabel",silver);
		Win_SetText("UI.gameui.grocerydetaildlg.copperlabel",copper);
		
		Win_SetText("UI.gameui.grocerydetaildlg.goldedit",gold);
		Win_SetText("UI.gameui.grocerydetaildlg.silveredit",silver);
		Win_SetText("UI.gameui.grocerydetaildlg.copperedit",copper);
		
		Win_SetValue("UI.gameui.grocerydetaildlg.countedit",maxnum,value_channel_maxvalue);
		Win_SetValue("UI.gameui.grocerydetaildlg.countedit",maxnum);
		
		Win_SetText("UI.gameui.grocerydetaildlg.nameedit",pname);
		
		Win_ShowWidget("UI.gameui.grocerydetaildlg",true);
		Win_SetFocus("UI.gameui.grocerydetaildlg.copperedit");
		end;
	
	OnUpdatePlayerShop=function(tpe)
		--此处有问题
		if tpe<2 then
		GroceryNum=GetNumShopItem();
		Win_SetValue("UI.gameui.groceryconfigdlg.grocerylist",GroceryNum,value_channel_item_num);
		else
		GroceryNum=GetNumShopItem();
		Win_SetValue("UI.gameui.grocerystatusdlg.grocerylist",GroceryNum,value_channel_item_num);
		end;
		
		end;
		
	OnUpdatePlayerSafeShop=function(type)
		if type<2 then
		GroceryNum=GetNumSafeShopItem();
		Win_SetValue("UI.gameui.safegroceryconfigdlg.grocerylist",GroceryNum,value_channel_item_num);
		else
		GroceryNum=GetNumSafeShopItem();
		Win_SetValue("UI.gameui.safegrocerystatusdlg.grocerylist",GroceryNum,value_channel_item_num);
		end;
	end;
				       
	OnOpenStore=function(bshow,mode,num)
		if bshow==0  then
		Win_ShowWidget("UI.gameui.storedlg",false);
		else 			   			   
		Win_AlignWidget("UI.gameui.waredlg","UI.gameui.storedlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
		
		if mode==0 then
		Win_SetText("UI.gameui.storedlg","普通仓库");
		Win_EnableWidget("UI.gameui.storedlg.cashbtn",true);
		elseif mode==1 then
		Win_SetText("UI.gameui.storedlg","扩展仓库");
		Win_EnableWidget("UI.gameui.storedlg.cashbtn",true);
		else
		Win_SetText("UI.gameui.storedlg","家族仓库");
		Win_EnableWidget("UI.gameui.storedlg.cashbtn",false);
		end;
		
		for i=1,5 do
		Win_ShowWidget("UI.gameui.storedlg.storetab"..i,(i<=num));
		end;
		
		if not Win_IsVisible("UI.gameui.storedlg") then
		Win_SelectSelf("UI.gameui.storedlg.storetab1");
		end;
		
		Win_ShowWidget("UI.gameui.storedlg",true);
		Win_ShowWidget("UI.gameui.waredlg",true);
		Win_ActiveSelf("UI.gameui.waredlg");			   
		Win_SetFocus("UI.gameui.storedlg");
		end;
		end; 


	
	OnExOpenStore=function(bshow,mode,num,storenum)
		if bshow==0  then
			if mode==0 or mode==1 then
			Win_ShowWidget("UI.gameui.storedlg0",false);
			else
			Win_ShowWidget("UI.gameui.storedlg",false);
			end;
		else 			   			   
			if mode==0 or mode==1 then
				Win_AlignWidget("UI.gameui.waredlg","UI.gameui.storedlg0",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				Win_EnableWidget("UI.gameui.storedlg0.cashbtn",true);
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_AlignWidget("UI.gameui.waredlg","UI.gameui.rightbottomlocalizer",aligntype_winrect,alignstyle_right_in+alignstyle_bottom_in);
				--Win_ActiveSelf("UI.gameui.waredlg");
				Win_ShowWidget("UI.gameui.storedlg0",true);
				Win_SetFocus("UI.gameui.storedlg0");
				for i=1, 7 do
				Win_EnableWidget("UI.gameui.storedlg0.exstorebtn"..i,i<=storenum);
				end;
				
				--免费版本:需要付费开启的仓库从7个减少到5个
				Win_ShowWidget("UI.gameui.storedlg0.exstorebtn6",IsFreeGame() == false );
				Win_ShowWidget("UI.gameui.storedlg0.exstorebtn7",IsFreeGame() == false );
			else
				Win_AlignWidget("UI.gameui.waredlg","UI.gameui.storedlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				Win_SetText("UI.gameui.storedlg","家族仓库");
				Win_EnableWidget("UI.gameui.storedlg.cashbtn",false);
				
				for i=1,5 do
				Win_ShowWidget("UI.gameui.storedlg.storetab"..i,(i<=num));
				end;
				
				if not Win_IsVisible("UI.gameui.storedlg") then
				Win_SelectSelf("UI.gameui.storedlg.storetab1");
				end;
				
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_ActiveSelf("UI.gameui.waredlg");
				Win_ShowWidget("UI.gameui.storedlg",true);
				Win_SetFocus("UI.gameui.storedlg");
			end;		
		end;
		end; 
		
	OnShowShopTab=function(bshow)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.tradedlg.weaponbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.dressbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.othersbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.jewelrybtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.regoldbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.goldbtn", false);
		elseif bshow == 1 then
			Win_ShowWidget("UI.gameui.tradedlg.weaponbtn", true);
			Win_ShowWidget("UI.gameui.tradedlg.dressbtn", true);
			Win_ShowWidget("UI.gameui.tradedlg.othersbtn", true);
			Win_ShowWidget("UI.gameui.tradedlg.jewelrybtn", true);
			Win_ShowWidget("UI.gameui.tradedlg.regoldbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.goldbtn", false);
			Win_SetSelect("UI.gameui.tradedlg",0,0);
		elseif bshow == 2 then
			Win_ShowWidget("UI.gameui.tradedlg.weaponbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.dressbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.othersbtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.jewelrybtn", false);
			Win_ShowWidget("UI.gameui.tradedlg.regoldbtn", true);
			Win_ShowWidget("UI.gameui.tradedlg.goldbtn", true);
			Win_SetSelect("UI.gameui.tradedlg",0,4);
		end;
	end;
	
	OnUpdateShop=function(bshow, bsell, inum)
		if bshow==0  then
			if Win_IsVisible("UI.gameui.tradedlg") then
				Win_ShowWidget("UI.gameui.tradedlg",false);
			end;
		else
			Win_SetValue("UI.gameui.tradedlg.leftlist",inum,value_channel_item_num);
			-- 右侧不清0
		end;
	end;
	
	OnCloseSafeShop=function()
		if Win_IsVisible("UI.gameui.safetradedlg") then
			Win_ShowWidget("UI.gameui.safetradedlg",false);
		end;
	end;
	
	OnOpenSafeShop=function(bshow,bsell,inum,pname,brepair)
		if bshow==0  then
		if Win_IsVisible("UI.gameui.safetradedlg") then
		Win_ShowWidget("UI.gameui.safetradedlg",false);
		end;
		
		else
		
		Win_EnableWidget("UI.gameui.safetradedlg.repairbtn",(brepair==1));
		Win_EnableWidget("UI.gameui.safetradedlg.repairallbtn",(brepair==1));
		Win_EnableWidget("UI.gameui.safetradedlg.repairspecialbtn",(brepair==1));
		--Win_ShowWidget("UI.gameui.safetradedlg.buylabel",(brepair==0));
		
		
		--Win_EnableWidget("UI.gameui.safetradedlg.clearbtn",false);
		
		Win_SetValue("UI.gameui.safetradedlg.leftlist",inum,value_channel_item_num);
		Win_SetValue("UI.gameui.safetradedlg.rightlist",0,value_channel_item_num);	
		
		Win_SetText("UI.gameui.safetradedlg.yuanbaolabel",0);
		Win_SetText("UI.gameui.safetradedlg.jingdinlabel",0);
		Win_SetText("UI.gameui.safetradedlg.goldlable",0);
		Win_SetText("UI.gameui.safetradedlg.yuanbaonumberlabel",0);
		Win_SetText("UI.gameui.safetradedlg.jingdinnumberlabel",0);
		Win_SetText("UI.gameui.safetradedlg.regoldedit",0);
		Win_SetText("UI.gameui.safetradedlg.resilveredit",0);
		Win_SetText("UI.gameui.safetradedlg.recopperedit",0);
		
		if bsell == 1 then
			Win_SetValue("UI.gameui.safetradedlg",1,value_channel_customtype);
		else
			Win_SetValue("UI.gameui.safetradedlg",0,value_channel_customtype);
		end;
		
		if not Win_IsVisible("UI.gameui.safetradedlg") then
		Win_ShowWidget("UI.gameui.safetradedlg",true);
		Win_ActiveSelf("UI.gameui.safetradedlg");
		end;
		end;
	end;
		
	OnOpenShop=function(bshow,bsell,inum,pname,brepair)
		if bshow==0  then
		if Win_IsVisible("UI.gameui.tradedlg") then
		Win_ShowWidget("UI.gameui.tradedlg",false);
		end;
		else
		
		Win_EnableWidget("UI.gameui.tradedlg.repairbtn",(brepair==1));
		Win_EnableWidget("UI.gameui.tradedlg.repairallbtn",(brepair==1));
		Win_EnableWidget("UI.gameui.tradedlg.repairspecialbtn",(brepair==1));
		Win_ShowWidget("UI.gameui.tradedlg.buylabel",(brepair==0));
		
		Win_EnableWidget("UI.gameui.tradedlg.clearbtn",false);
		
		Win_SetValue("UI.gameui.tradedlg.leftlist",inum,value_channel_item_num);
		Win_SetValue("UI.gameui.tradedlg.rightlist",0,value_channel_item_num);	
		
		Win_SetText("UI.gameui.tradedlg.goldlabel",0);
		Win_SetText("UI.gameui.tradedlg.silverlabel",0);
		Win_SetText("UI.gameui.tradedlg.copperlabel",0);
		Win_SetText("UI.gameui.tradedlg.regoldlabel",0);
		Win_SetText("UI.gameui.tradedlg.resilverlabel",0);
		Win_SetText("UI.gameui.tradedlg.recopperlabel",0);
		Win_SetText("UI.gameui.tradedlg.weightlabel",0);
		
		--领地税收
		local taxinfo = GetRevenueValue();
		local mapname = GetCurMapName();
		local taxbuf;
		
		if taxinfo.taxrate <= 10 then
			taxbuf = "/C13"..taxinfo.taxrate.."％/C00";
		elseif taxinfo.taxrate <= 20 then
			taxbuf = "/C01"..taxinfo.taxrate.."％/C00";
		else
			taxbuf = "/C22"..taxinfo.taxrate.."％/C00";
		end;
		Win_SetText("UI.gameui.tradedlg.taxrate",taxbuf);
		Win_SetText("UI.gameui.tradedlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
		
		if taxinfo.taxrate < 0 then
			Win_ShowWidget("UI.gameui.tradedlg.taxrate", false);
		else
			Win_ShowWidget("UI.gameui.tradedlg.taxrate", true);
		end;				
		
		if bsell==1 then
		Win_SetText("UI.gameui.tradedlg.leftlabel","我的物品栏");
		Win_SetText("UI.gameui.tradedlg.rightlabel",pname);
		Win_SetValue("UI.gameui.tradedlg.buylabel",1,value_channel_framescheme);
		Win_SetValue("UI.gameui.tradedlg",1,value_channel_customtype);
		else
		Win_SetText("UI.gameui.tradedlg.rightlabel","购买商品列表");
		Win_SetText("UI.gameui.tradedlg.leftlabel",pname);
		Win_SetValue("UI.gameui.tradedlg.buylabel",2,value_channel_framescheme);
		Win_SetValue("UI.gameui.tradedlg",0,value_channel_customtype);
		end;
		
		if not Win_IsVisible("UI.gameui.tradedlg") then
		Win_ShowWidget("UI.gameui.tradedlg",true);
		Win_ActiveSelf("UI.gameui.tradedlg");
		end;			
		end;
		end;
	
	
	OnOpenDeal=function(bshow,partner)
		if bshow==0  then
		Win_ShowWidget("UI.gameui.dealdlg",false);			   
		else 
		Win_SetText("UI.gameui.dealdlg.chargelabel",partner);
		Win_SetText("UI.gameui.dealdlg.offerlabel",GetSelfName());
		Win_EnableWidget("UI.gameui.dealdlg.goldedit",true);
		Win_EnableWidget("UI.gameui.dealdlg.silveredit",true);
		Win_EnableWidget("UI.gameui.dealdlg.copperedit",true);
		Win_EnableWidget("UI.gameui.dealdlg.agreebtn",true);
		Win_EnableWidget("UI.gameui.dealdlg.dealbtn",false);
		
		Win_SetValue("UI.gameui.dealdlg.goldedit",0);
		Win_SetValue("UI.gameui.dealdlg.silveredit",0);
		Win_SetValue("UI.gameui.dealdlg.copperedit",0);	
		
		Win_SetText("UI.gameui.dealdlg.goldlabel",0);
		Win_SetText("UI.gameui.dealdlg.silverlabel",0);
		Win_SetText("UI.gameui.dealdlg.copperlabel",0);	
		
		Win_ShowWidget("UI.gameui.waredlg",true);			   
		Win_ShowWidget("UI.gameui.dealdlg",true);	
		Win_SetFocus("UI.gameui.dealdlg.goldedit");
		end;
		end;
	
	
	OnDealUpdate=function(self_agree,partner_agree,self_deal,partner_deal)
			        if self_agree==1 then
				Win_EnableWidget("UI.gameui.dealdlg.agreebtn",false);
				Win_EnableWidget("UI.gameui.dealdlg.goldedit",false);
				Win_EnableWidget("UI.gameui.dealdlg.silveredit",false);
				Win_EnableWidget("UI.gameui.dealdlg.copperedit",false);
				end;		
				
			       --双方都同意,可以成交了
				if (self_agree~=0)  and (partner_agree~=0) then				
				Win_EnableWidget("UI.gameui.dealdlg.dealbtn",(self_deal==0) );								
				end;
				
				--双方成交,可以关闭窗口了
				if (self_deal~=0) and  (partner_deal~=0) then
				Win_ShowWidget("UI.gameui.dealdlg",false);
				end;	
				  
			       
			       end;
	
	
	OnOpenNumInput=function(maxnum,defvalue,name)
		Win_SetValue("UI.gameui.numinputdlg",0,value_channel_customtype);
		Win_SetValue("UI.gameui.numinputdlg.numslider",maxnum,value_channel_maxvalue);
		Win_SetValue("UI.gameui.numinputdlg.numedit",maxnum,value_channel_maxvalue);
		Win_SetValue("UI.gameui.numinputdlg.numslider",defvalue);
		Win_SetValue("UI.gameui.numinputdlg.numedit",defvalue);						   
		Win_ShowWidget("UI.gameui.numinputdlg",true);	
		end;
	
	OnOpenMoneyInput=function()
		Win_SetValue("UI.gameui.moneyinputdlg",2,value_channel_customtype);		
		Win_ShowWidget("UI.gameui.moneyinputdlg",true);
		end;
		
	-- 帮助菜单
	OnOpenHelpMenu=function(bissprite)
		local iShowHelpSprite, iDailyHelp, iLockPos = GetHelpVar();
		
		--Win_ShowWidget("UI.gameui.helpmenu.openhelpwinbtn", true);
		Win_ShowWidget("UI.gameui.helpmenu.quicksearchbtn", true);
		
		if iShowHelpSprite == 0 then
			Win_ShowWidget("UI.gameui.helpmenu.openspritebtn", true);
			Win_ShowWidget("UI.gameui.helpmenu.closespritebtn", false);
		else
			Win_ShowWidget("UI.gameui.helpmenu.closespritebtn", true);
			Win_ShowWidget("UI.gameui.helpmenu.openspritebtn", false);
		end;
		
		if bissprite == true then
			if iDailyHelp == 0 then
				Win_ShowWidget("UI.gameui.helpmenu.opendailyhelpbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.closedailyhelpbtn", false);
			else
				Win_ShowWidget("UI.gameui.helpmenu.closedailyhelpbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.opendailyhelpbtn", false);
			end;
			
			if iLockPos == 0 then
				Win_ShowWidget("UI.gameui.helpmenu.lockposbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.unlockposbtn", false);
			else
				Win_ShowWidget("UI.gameui.helpmenu.unlockposbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.lockposbtn", false);
			end;
		else
			if iDailyHelp == 0 then
				Win_ShowWidget("UI.gameui.helpmenu.opendailyhelpbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.closedailyhelpbtn", false);
			else
				Win_ShowWidget("UI.gameui.helpmenu.closedailyhelpbtn", true);
				Win_ShowWidget("UI.gameui.helpmenu.opendailyhelpbtn", false);
			end;
			
			Win_ShowWidget("UI.gameui.helpmenu.unlockposbtn", false);
			Win_ShowWidget("UI.gameui.helpmenu.lockposbtn", false);
		end;
		
		Win_ShowWidget("UI.gameui.helpmenu", true);
		Win_SetFocus("UI.gameui.helpmenu");
	end;
	
	-- 收回帮助精灵
	OnCallbackSprite=function()
		ChangeHelpAction(-1);
		Win_ShowWidget("UI.gameui.helpspritedlg", false);
		Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn", true);
	end;
	
	OnOpenPlayerMenu=function(name)
		-- 大乱斗屏蔽玩家右键菜单
		--if IsPlayerInBattlefield() == true then
		--	return;
		--end
			Win_SetText("UI.gameui.playermenu",name,value_channel_customname);
			
			if name == "ui_drag_type_memberlist" then
				Win_ShowWidget("UI.gameui.playermenu.whisperbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.gossipbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.dealbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.jointeam",false);
				Win_ShowWidget("UI.gameui.playermenu.followplayer",false);
				Win_ShowWidget("UI.gameui.playermenu.invitefriend",false);
				Win_ShowWidget("UI.gameui.playermenu.inviteQQ",false);
				Win_ShowWidget("UI.gameui.playermenu.queryequipbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.queryfamilybtn",false);
				Win_ShowWidget("UI.gameui.playermenu.filterbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.peekpet",false);
				Win_ShowWidget("UI.gameui.playermenu.peekgod",false);
				Win_ShowWidget("UI.gameui.playermenu.reportwgbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.achievelistbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.baowwubtn",false);
				Win_ShowWidget("UI.gameui.playermenu.legionbtn",false);
				
				
				
				Win_ShowWidget("UI.gameui.playermenu.maketeam",false);
				Win_ShowWidget("UI.gameui.playermenu.jointeam",false);
				Win_ShowWidget("UI.gameui.playermenu.inviteteam",false);
				Win_ShowWidget("UI.gameui.playermenu.kickteam",false); 
				Win_ShowWidget("UI.gameui.playermenu.changepos",false);
				Win_ShowWidget("UI.gameui.playermenu.followteam",false); 
				Win_ShowWidget("UI.gameui.playermenu.changesight",false);
				Win_ShowWidget("UI.gameui.playermenu.makemaster",false);
				Win_ShowWidget("UI.gameui.playermenu.makeprentice",false);
				Win_ShowWidget("UI.gameui.playermenu.kickprentice",false);	
				Win_ShowWidget("UI.gameui.playermenu.kickmaster",false);
				Win_ShowWidget("UI.gameui.playermenu.betraymaster",false);
				Win_ShowWidget("UI.gameui.playermenu.querybtn",false);
				Win_ShowWidget("UI.gameui.playermenu.invitefamilybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.applyfamilybtn",false);
				Win_ShowWidget("UI.gameui.playermenu.cancelallybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.cancelenemybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.allybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.enemybtn",false);
				Win_ShowWidget("UI.gameui.playermenu.invitehousebtn",false);
				Win_ShowWidget("UI.gameui.playermenu.filterbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.kickbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.changeownerbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.reportbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.reportwgbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.avataractinvite", false);
				Win_ShowWidget("UI.gameui.playermenu.revengelistbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.achievelistbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.pkteaminvite",false);
				Win_ShowWidget("UI.gameui.playermenu.kickvote",false);
				Win_ShowWidget("UI.gameui.playermenu.horseinvite",false);
				Win_ShowWidget("UI.gameui.playermenu.sendflowerbtn",false);
				
				local groupname,name = GetSaveName();
				
				local number,maingroup = GetGroupInfo(groupname);
				
				if maingroup == 1 then
					Win_ShowWidget("UI.gameui.playermenu.leavegroupbtn",true);
					Win_ShowWidget("UI.gameui.playermenu.addfriendbtn",false);
				else
					Win_ShowWidget("UI.gameui.playermenu.leavegroupbtn",false);
					Win_ShowWidget("UI.gameui.playermenu.addfriendbtn",true);
				end;
				
				Win_ShowWidget("UI.gameui.playermenu",true);	
				Win_SetFocus("UI.gameui.playermenu");
				return;
			end;
			Win_ShowWidget("UI.gameui.playermenu.leavegroupbtn",false);
			Win_ShowWidget("UI.gameui.playermenu.addfriendbtn",false);
			Win_ShowWidget("UI.gameui.playermenu.whisperbtn",true);
			Win_ShowWidget("UI.gameui.playermenu.gossipbtn",true);
			Win_ShowWidget("UI.gameui.playermenu.makeprentice",true);
			Win_ShowWidget("UI.gameui.playermenu.queryequipbtn",true);
			Win_ShowWidget("UI.gameui.playermenu.sendflowerbtn",true);
			if (name~="") and (name~=g_PlayerInfo.name) then
			menutype=GetTeamMenuType(name);
			Win_ShowWidget("UI.gameui.playermenu.maketeam",(menutype==0));
			Win_ShowWidget("UI.gameui.playermenu.jointeam",(menutype==1 or menutype==8 or menutype==9));
			Win_ShowWidget("UI.gameui.playermenu.inviteteam",(menutype==2 or menutype==6));
			
			-- local ts = GetPlayerTeamStatus();
			-- Win_ShowWidget("UI.gameui.playermenu.jointeam",ts==0);
			-- Win_ShowWidget("UI.gameui.playermenu.inviteteam",ts==2);
			
			Win_ShowWidget("UI.gameui.playermenu.kickteam",(menutype==3)); 
			Win_ShowWidget("UI.gameui.playermenu.changepos",(menutype==3));
			Win_ShowWidget("UI.gameui.playermenu.followteam",(menutype==4)); 
			Win_ShowWidget("UI.gameui.playermenu.changesight",(menutype==5));
			
			menutype=GetMasterMenuType(name);
			if menutype == 5 then
				Win_ShowWidget("UI.gameui.playermenu.makemaster",true);
				Win_ShowWidget("UI.gameui.playermenu.makeprentice",true);
			else
				Win_ShowWidget("UI.gameui.playermenu.makemaster",(menutype==0));
				Win_ShowWidget("UI.gameui.playermenu.makeprentice",(menutype==1));
			end;
				  
			
			Win_ShowWidget("UI.gameui.playermenu.kickprentice",(menutype==3));	
			Win_ShowWidget("UI.gameui.playermenu.kickmaster",(menutype==2));
			Win_ShowWidget("UI.gameui.playermenu.betraymaster",((menutype==2) or (menutype==4)));
			
			local bBuddy=IsGMBuddy(name);
			Win_ShowWidget("UI.gameui.playermenu.querybtn",bBuddy);
			Win_ShowWidget("UI.gameui.playermenu.invitefriend",(not bBuddy));
			
			--local bQQ=IsQQBuddy(name);
			--Win_ShowWidget("UI.gameui.playermenu.inviteQQ",(not bQQ));			
			Win_ShowWidget("UI.gameui.playermenu.inviteQQ",false);			

			menutype=GetFamilyMenuType(name);
			Win_ShowWidget("UI.gameui.playermenu.invitefamilybtn",(menutype==1));	
			Win_ShowWidget("UI.gameui.playermenu.applyfamilybtn",(menutype==2));
			Win_ShowWidget("UI.gameui.playermenu.cancelallybtn",(menutype==3));	
			Win_ShowWidget("UI.gameui.playermenu.cancelenemybtn",(menutype==4));	
			Win_ShowWidget("UI.gameui.playermenu.allybtn",(menutype==5));	
			Win_ShowWidget("UI.gameui.playermenu.enemybtn",(menutype==5));	
			
			menutype = ReqFmHouse(name);
			Win_ShowWidget("UI.gameui.playermenu.invitehousebtn",(menutype~=0));
			
			menutype=IsPlayerFiltered(name);
			Win_ShowWidget("UI.gameui.playermenu.filterbtn",menutype~=1);
			
			menutype=GetArenaMenuType(name);
			if menutype == 0 then
				Win_ShowWidget("UI.gameui.playermenu.kickbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.changeownerbtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.dealbtn", true);	
				Win_ShowWidget("UI.gameui.playermenu.followplayer", true);				
				Win_ShowWidget("UI.gameui.playermenu.filterbtn", true);	
				Win_ShowWidget("UI.gameui.playermenu.queryfamilybtn", true);	
				Win_ShowWidget("UI.gameui.playermenu.peekgod", true);	
				Win_ShowWidget("UI.gameui.playermenu.peekpet", true);					
			elseif menutype == 1 then
				Win_ShowWidget("UI.gameui.playermenu.kickbtn",false);
				Win_ShowWidget("UI.gameui.playermenu.changeownerbtn", false);
				Win_ShowWidget("UI.gameui.playermenu.dealbtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.followplayer", false);	
				Win_ShowWidget("UI.gameui.playermenu.filterbtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.queryfamilybtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.peekgod", false);	
				Win_ShowWidget("UI.gameui.playermenu.peekpet", false);	
			elseif menutype == 2 then
				Win_ShowWidget("UI.gameui.playermenu.kickbtn",true);
				Win_ShowWidget("UI.gameui.playermenu.changeownerbtn", true);
				Win_ShowWidget("UI.gameui.playermenu.dealbtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.followplayer", false);				
				Win_ShowWidget("UI.gameui.playermenu.filterbtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.queryfamilybtn", false);	
				Win_ShowWidget("UI.gameui.playermenu.peekgod", false);	
				Win_ShowWidget("UI.gameui.playermenu.peekpet", false);	
			end;
			
			-- 领地战屏蔽家族联盟入口
			if IsInLandBattle() == true then
				Win_ShowWidget("UI.gameui.playermenu.queryfamilybtn", false);
				Win_ShowWidget("UI.gameui.playermenu.invitefamilybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.applyfamilybtn",false);
				Win_ShowWidget("UI.gameui.playermenu.cancelallybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.cancelenemybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.allybtn",false);	
				Win_ShowWidget("UI.gameui.playermenu.enemybtn",false);	
			end
			
			Win_ShowWidget("UI.gameui.playermenu.reportbtn",CanReport());
			Win_ShowWidget("UI.gameui.playermenu.reportwgbtn",true);
			local canInvite = CanInviteHorse();
			if canInvite == 1 then
				Win_ShowWidget("UI.gameui.playermenu.horseinvite",true);
			else 
				Win_ShowWidget("UI.gameui.playermenu.horseinvite",false);
			end;
			
			local iCanAvatarAct, szAction = CanAvatarAct(1, name);
			if iCanAvatarAct == 2 then
				Win_ShowWidget("UI.gameui.playermenu.avataractinvite", true);
				Win_SetText("UI.gameui.playermenu.avataractinvite", szAction);
			else
				Win_ShowWidget("UI.gameui.playermenu.avataractinvite", false);
			end;
			
			if CanShowRevengeShareList(name) == 1 then
				Win_ShowWidget("UI.gameui.playermenu.revengelistbtn", true);
			else
				Win_ShowWidget("UI.gameui.playermenu.revengelistbtn", false);
			end;
			
			Win_ShowWidget("UI.gameui.playermenu.achievelistbtn", true);
			Win_ShowWidget("UI.gameui.playermenu.baowwubtn",true);
			Win_ShowWidget("UI.gameui.playermenu.pkteaminvite",CanInvitePKTeam());
			
			Win_ShowWidget("UI.gameui.playermenu.kickvote",InBallBattle());
			Win_ShowWidget("UI.gameui.playermenu.legionbtn",Legion_CanInvite(name));

			Win_ShowWidget("UI.gameui.playermenu",true);	
			Win_SetFocus("UI.gameui.playermenu");
			
			end;
			   
			end;
			
	OnOpenMainPlayerMenu=function()
		menutype = GetMainTeamMenuType();
		Win_ShowWidget("UI.gameui.mainplayermenu.createteambtn", (menutype==0));
		Win_ShowWidget("UI.gameui.mainplayermenu.dismissteambtn", (menutype==1));
		Win_ShowWidget("UI.gameui.mainplayermenu.leaderleaveteambtn", (menutype==1));
		Win_ShowWidget("UI.gameui.mainplayermenu.memberleaveteambtn", (menutype==2));
		Win_ShowWidget("UI.gameui.mainplayermenu.leaderqueryhelpbtn", (menutype==1));
		Win_ShowWidget("UI.gameui.mainplayermenu.memberqueryhelpbtn", (menutype==2) or (menutype==0));
		
		local iCanAvatarAct, szAction = CanAvatarAct(0, "");
		if iCanAvatarAct == 1 then
			Win_ShowWidget("UI.gameui.mainplayermenu.avataractbtn", true);
			Win_SetText("UI.gameui.mainplayermenu.avataractbtn", szAction);
		else
			Win_ShowWidget("UI.gameui.mainplayermenu.avataractbtn", false);
		end;
			
		Win_ShowWidget("UI.gameui.mainplayermenu",true);	
		Win_SetFocus("UI.gameui.mainplayermenu");			   
	end;	
			   
	OnShowDialog=function(bshow)
		if bshow==0 then
		Win_ShowWidget("UI.gameui.npcdlg",false);
		else				 
		Win_ShowWidget("UI.gameui.npcdlg",true); 				
		end;
		end;
		
	OnOpenTransport=function(iport)
		if IsFreeGame() == false then
			if iport<0 then
			Win_ShowWidget("UI.gameui.transportdlg",false);
			else
			Win_SetValue("UI.gameui.transportdlg.list",iport,value_channel_item_num);
			Win_SetValue("UI.gameui.transportdlg.list",0,value_channel_sel);
			if not Win_IsVisible("UI.gameui.transportdlg")  then
			Win_ShowWidget("UI.gameui.transportdlg",true);
			end;		
			end;
		else
			if iport<0 then
			Win_ShowWidget("UI.gameui.extransportdlg",false);
			else
			Win_SetValue("UI.gameui.extransportdlg.list",iport,value_channel_item_num);
			Win_SetValue("UI.gameui.extransportdlg.list",0,value_channel_sel);
			if not Win_IsVisible("UI.gameui.extransportdlg")  then
			Win_ShowWidget("UI.gameui.extransportdlg",true);
			end;		
			end;
		end;
		end;
				  
	OnOpenWareWin=function(bshow,ntab)
		if bshow==0 then
			Win_ShowWidget("UI.gameui.waredlg",false);
		else				 

			
			Win_ShowWidget("UI.gameui.waredlg",true);
			Win_SetFocus("UI.gameui.waredlg");
			
			if ntab==0 then
				Win_SetFocus("UI.gameui.waredlg.medicinetab");
			elseif ntab==1 then
				Win_SetFocus("UI.gameui.waredlg.waretab");
			elseif ntab==2 then
				Win_SetCheck("UI.gameui.waredlg.equiptab", true);
				Win_SetFocus("UI.gameui.waredlg.equiptab");
			end;
			
			if Win_IsVisible("UI.gameui.equipdlg") then
				Win_SetFocus("UI.gameui.equipdlg");
			end;
		end;
	end;
				  
				  
	OnOpenEquipWin=function(bshow)
		if bshow==0 then
		Win_ShowWidget("UI.gameui.equipdlg",false);
		else
		Win_ShowWidget("UI.gameui.equipdlg",true);
		Win_SetFocus("UI.gameui.equipdlg"); 				
		end;
		end;			  
	
	OnOpenEquipOther=function(bshow)
		if bshow==0 then
		Win_ShowWidget("UI.gameui.exequipdlg",false);
		else
		Win_ShowWidget("UI.gameui.exequipdlg",true);
		Win_SetFocus("UI.gameui.exequipdlg"); 				
		end;
		end;	

	OnArenaTalkInfo=function(msg,title,buffer,bsys)
		local linedata=
		{
			caption=msg,
			color=GetColorIndex(255,255,255),
			strdata=title,
			intdata=0,
		};
		
		if bsys~=0 then
		Win_SetTable("UI.gameui.arenadlg.chatbar.syschatpanel.chatlist",value_channel_itemdata,linedata);
		else
		Win_SetTable("UI.gameui.arenadlg.chatbar.chatpanel.chatlist",value_channel_itemdata,linedata);
		end;
		end;
	
	OnTalkInfo=function(channel,mode,msg,title,buffer,moodid)
				
		local talklist="UI.gameui.chatbar.chatpanel.chatlist";		
		local actionlist="UI.gameui.chatbar.actionpanel.actionlist";		
		
		local txtchannel=value_channel_itemtext;
		local datachannel=value_channel_itemdata;
		local whitecolor=GetColorIndex(255,255,255);
		
		--GameUILogInfo(msg);
		
		local fonts = 0;
		
		if not(moodid == 0) then
			fonts = 1;
		end;
		
		local linedata=
		{
			caption=msg,
			color=whitecolor,
			strdata=title,
			intdata=0,
			fonttext=fonts,
		};
		
		local creatert = Win_GetCreateRect();
		local ratex = creatert.w/800;
		local ratey = creatert.h/600;
		
		if mode==0 then
			
			if not (channel==8192 or channel== 16384 or channel== 32768 or channel == 36864 or channel == 65536 or channel == 69632 or channel == 69633 or channel == 69634
				or channel == 69635 or channel == 69636 or channel == 69637 or channel == 69638 or channel == 69639 or channel == 69640) then
				Win_SetTable(talklist,datachannel,linedata);
				if not Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
				Win_SetValue("UI.gameui.chatbar.sizebtn",2,value_channel_framescheme);		
				end;
				
				local msgnum=Win_GetValue(talklist,value_channel_item_num);
				if msgnum>=100 then
					if 0==GetGameVar("actionfilter") then
					SetGameVar("actionfilter",1);
					Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22启动聊天信息过滤/C00功能，去除无需关注信息。");
					Win_SetText("UI.gameui.ScrnTutortip","actionfilter",value_channel_customname);
					Win_ShowWidget("UI.gameui.ScrnTutortip",true);
					Win_AlignWidget("UI.gameui.ScrnTutortip","UI.gameui.chatbar.filterbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,15);
					end;
				elseif msgnum>=50 then
					if 0==GetGameVar("actionview") then
					SetGameVar("actionview",1);
					Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22打开聊天信息查看/C00面板，轻松查阅各频道历史记录。");
					Win_SetText("UI.gameui.ScrnTutortip","actionview",value_channel_customname);
					Win_ShowWidget("UI.gameui.ScrnTutortip",true);
					Win_AlignWidget("UI.gameui.ScrnTutortip","UI.gameui.chatbar.viewbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,15);
					end;
				elseif msgnum>=15 then
					if 0==GetGameVar("actionsize") then
					SetGameVar("actionsize",1);
					Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22关闭聊天显示/C00,拥有更加简洁的操作界面。快捷键Alt+V");
					Win_SetText("UI.gameui.ScrnTutortip","actionsize",value_channel_customname);
					Win_ShowWidget("UI.gameui.ScrnTutortip",true);
					Win_AlignWidget("UI.gameui.ScrnTutortip","UI.gameui.chatbar.lockbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,15);
					end;
				elseif msgnum>=8 then
					if 0==GetGameVar("actionclear") then
					SetGameVar("actionclear",1);
					Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22清空聊天窗口/C00内所有聊天信息。");
					Win_SetText("UI.gameui.ScrnTutortip","actionclear",value_channel_customname);
					Win_ShowWidget("UI.gameui.ScrnTutortip",true);
					Win_AlignWidget("UI.gameui.ScrnTutortip","UI.gameui.chatbar.clearbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,15);
					end;
				end;
			end;
		elseif mode==1 then		
			Win_SetTable(actionlist,datachannel,linedata);
			if not Win_IsVisible("UI.gameui.chatbar.actionpanel") then
			Win_SetValue("UI.gameui.chatbar.splitbtn",1,value_channel_framescheme);	
			end;
			
			local var=GetGameVar("actionopen");
			if var==0 then
				SetGameVar("actionopen",1);
				if not Win_IsVisible("UI.gameui.chatbar.actionpanel")  then				
				Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22打开行为信息窗口/C00查看。快捷键Alt+D");
				else				
				--Win_SetText("UI.gameui.ScrnTutortip","点击这里/C22关闭行为信息窗口/C00查看。快捷键Alt+D");
				return;
				end;
				Win_SetText("UI.gameui.ScrnTutortip","actionopen",value_channel_customname);
				Win_ShowWidget("UI.gameui.ScrnTutortip",true);
				Win_AlignWidget("UI.gameui.ScrnTutortip","UI.gameui.chatbar.splitbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,15);
			end;	
		end;
		
		local currentlist="";
		
		if channel==1 then
			currentlist = "UI.gameui.historybar.systemtab.historylist";
			
		elseif channel==2 then
			currentlist = "UI.gameui.historybar.gmtab.historylist";
			
		--elseif channel==4 then
		--Win_SetTable(newbielist,datachannel,linedata);
		elseif channel==8 then
			currentlist = "UI.gameui.historybar.teamtab.historylist";
			
		elseif channel==16 then
			currentlist = "UI.gameui.historybar.mastertab.historylist";
			
		elseif channel==32 then
			currentlist = "UI.gameui.historybar.uniontab.historylist";
			
		elseif channel==64 then
			currentlist = "UI.gameui.historybar.whispertab.historylist";
			
		elseif channel==128 then
			currentlist = "UI.gameui.historybar.nearbytab.historylist";
			
		elseif channel==256 then
			currentlist = "UI.gameui.historybar.worldtab.historylist";
			
		elseif channel==512 then
			currentlist = "UI.gameui.historybar.citytab.historylist";
			
		elseif channel==2048 then
			currentlist = "UI.gameui.historybar.citytab.historylist";
			
		elseif channel==4096 then	
			currentlist = "UI.gameui.historybar.matchtab.historylist";

		elseif channel==8192 or channel== 16384 or channel== 32768 or channel == 36864 or channel == 65536 or channel == 69632 or channel == 69633 or channel == 69634
			or channel == 69635 or channel == 69636 or channel == 69637 or channel == 69638 or channel == 69639 or channel == 69640 then
			currentlist = "UI.gameui.historybar.broadtab.historylist";
			
		elseif channel==4 then
			currentlist = "UI.gameui.integdlg.msgboxpanel.systippanel";		
		end;	
		
		
		
		-- 这里做调整，2种滚动方式，1种是不自动滚动，新插入一行，不滚动原来的pos， 2种是插入一条记录，向上滚动该纪录高度，
		-- 下面的逻辑主要是 获取新增记录的高度, p2-p1是 插入的变化，setpos（pos）触发插入后的更新计算。
		if ( currentlist ~="" ) then
			local pos = Win_GetValue(currentlist, value_channel_pos);
			local p1 = Win_GetValue(currentlist, value_channel_scrollspace);
			Win_SetTable(currentlist,datachannel,linedata);
			Win_SetValue(currentlist, pos, value_channel_pos);
			local p2 = Win_GetValue(currentlist, value_channel_scrollspace);
			if Win_IsChecked("UI.gameui.historybar.scrollcheck") and (p2-p1) > 0 then
				Win_SetValue(currentlist, pos-(p2-p1), value_channel_pos);
			end;
		end;

		-- 广播大喇叭，天使大喇叭，恶魔大喇叭
		if (channel==8192 or channel== 16384 or channel== 32768 or channel == 36864 
			or channel == 65536 or channel == 69632 or channel == 69633 or channel == 69634
			or channel == 69635 or channel == 69636 or channel == 69637 or channel == 69638 or channel == 69639 or channel == 69640) then
			UI.children.gameui.children.chatbar.children.broadcastwidget.OnTelRadio(channel, datachannel, linedata);
		end;
				
	end;
	
	
	
	--pipo新装备强化系统
	OnOpenMakeDlg=function(bshow, modtype, num)
		--领地税收
		local taxinfo = GetRevenueValue();
		local mapname = GetCurMapName();
		local taxbuf;
		
		if taxinfo.taxrate <= 10 then
			taxbuf = "/C13"..taxinfo.taxrate.."％/C00";
		elseif taxinfo.taxrate <= 20 then
			taxbuf = "/C01"..taxinfo.taxrate.."％/C00";
		else
			taxbuf = "/C22"..taxinfo.taxrate.."％/C00";
		end;	
		
		if modtype == 0 then --合成
			Win_ShowWidget("UI.gameui.newcomposedlg", bshow~=0);
			Win_AlignWidget("UI.gameui.newcomposedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);

			Win_SetValue("UI.gameui.newcomposedlg.list",num,value_channel_item_num);
			
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0,value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numedit", 0, value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numedit",0);
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0);
			
			Win_SetText("UI.gameui.newcomposedlg.taxrate",taxbuf);
			Win_SetText("UI.gameui.newcomposedlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
			
			if taxinfo.taxrate < 0 then
				Win_ShowWidget("UI.gameui.newcomposedlg.taxrate", false);
			else
				Win_ShowWidget("UI.gameui.newcomposedlg.taxrate", true);
			end;
		elseif modtype == 1 then --加工
			Win_ShowWidget("UI.gameui.newforgedlg", bshow~=0);
			Win_AlignWidget("UI.gameui.newforgedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
			
			Win_ShowWidget("UI.gameui.newforgedlg.list.returnbtn", false);
			Win_SetValue("UI.gameui.newforgedlg.list",num,value_channel_item_num);
			
			Win_SetText("UI.gameui.newforgedlg.maxlevellabel", "");
			Win_SetText("UI.gameui.newforgedlg.rebatlabel", "");
			Win_SetText("UI.gameui.newforgedlg.nextlevellabel", "");
			
			Win_SetText("UI.gameui.newforgedlg.taxrate",taxbuf);
			Win_SetText("UI.gameui.newforgedlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
			
			if taxinfo.taxrate < 0 then
				Win_ShowWidget("UI.gameui.newforgedlg.taxrate", false);
			else
				Win_ShowWidget("UI.gameui.newforgedlg.taxrate", true);
			end;				
			
			g_PlayerInfo=GetMainPlayerInfo();
			if g_PlayerInfo.LEVEL >= 15 then
				local status2=SkillGetStatus(ui_drag_type_skill_life,2);	--防具加工
				local status3=SkillGetStatus(ui_drag_type_skill_life,3);	--武器加工
				if (status2.blearned == false or status3.blearned == false) then
					local str="";
					if status2.blearned == false and status3.blearned == false then
						str="请打开技能面板的通用页签，学习“武器加工”和“防具加工”技能";
					elseif status2.blearned == false then
						str="请打开技能面板的通用页签，学习“武器加工”技能";
					elseif status3.blearned == false then
						str="请打开技能面板的通用页签，学习“防具加工”技能";
					end;
					
					UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.skillbtn","passwdmoddlg",str,5,2);
					Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.skillbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,5,30);
				end;
			end;			
			
		elseif modtype == 2 then --打孔
			Win_ShowWidget("UI.gameui.newburrowdlg", bshow~=0);
			Win_AlignWidget("UI.gameui.newburrowdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);

			Win_ShowWidget("UI.gameui.newburrowdlg.list.returnbtn", false);
			Win_SetValue("UI.gameui.newburrowdlg.list",num,value_channel_item_num);
			
			Win_SetText("UI.gameui.newburrowdlg.succlabel", "");
			Win_SetText("UI.gameui.newburrowdlg.nextlevellabel", "");
			Win_SetText("UI.gameui.newburrowdlg.maxlevellabel", "");

			Win_SetText("UI.gameui.newburrowdlg.taxrate",taxbuf);
			Win_SetText("UI.gameui.newburrowdlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
			
			if taxinfo.taxrate < 0 then
				Win_ShowWidget("UI.gameui.newburrowdlg.taxrate", false);
			else
				Win_ShowWidget("UI.gameui.newburrowdlg.taxrate", true);
			end;				
			
			g_PlayerInfo=GetMainPlayerInfo();
			if g_PlayerInfo.LEVEL >= 15 then
				local status2=SkillGetStatus(ui_drag_type_skill_life,2);	--防具加工
				local status3=SkillGetStatus(ui_drag_type_skill_life,3);	--武器加工
				if (status2.blearned == false or status3.blearned == false) then
					local str="";
					if status2.blearned == false and status3.blearned == false then
						str="请打开技能面板的通用页签，学习“武器加工”和“防具加工”技能";
					elseif status2.blearned == false then
						str="请打开技能面板的通用页签，学习“武器加工”技能";
					elseif status3.blearned == false then
						str="请打开技能面板的通用页签，学习“防具加工”技能";
					end;
					
					UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.skillbtn","passwdmoddlg",str,5,2);
					Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.skillbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,5,30);
				end;
			end;
			
		elseif modtype == 3 then --镶嵌
			Win_SetText("UI.gameui.newsculpdlg.goldedit","0");
			Win_SetText("UI.gameui.newsculpdlg.silveredit","0");
			Win_SetText("UI.gameui.newsculpdlg.copperedit","0");
			Win_SetText("UI.gameui.newsculpdlg.regoldedit","0");
			Win_SetText("UI.gameui.newsculpdlg.resilveredit","0");
			Win_SetText("UI.gameui.newsculpdlg.recopperedit","0");
			Win_ShowWidget("UI.gameui.newsculpdlg", bshow~=0);
			Win_AlignWidget("UI.gameui.newsculpdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
			
			Win_SetText("UI.gameui.newsculpdlg.taxrate",taxbuf);
			Win_SetText("UI.gameui.newsculpdlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
			
			if taxinfo.taxrate < 0 then
				Win_ShowWidget("UI.gameui.newsculpdlg.taxrate", false);
			else
				Win_ShowWidget("UI.gameui.newsculpdlg.taxrate", true);
			end;			
			
			--Win_SetValue("UI.gameui.newsculpdlg.infolist",num,value_channel_item_num);	
		elseif modtype == 15 then --镶嵌查询
			Win_ShowWidget("UI.gameui.querysculpdlg", bshow~=0);
		elseif modtype == 4 then
			Win_ShowWidget("UI.gameui.changecarddlg", bshow~=0);
		elseif modtype==10 then
			if not Win_IsVisible("UI.gameui.querycomposedlg") then
				Win_ShowWidget("UI.gameui.querycomposedlg",true);	
			end;
			Win_SetFocus("UI.gameui.querycomposedlg");
		elseif modtype==11 then
			if not Win_IsVisible("UI.gameui.queryrefinedlg") then
				Win_ShowWidget("UI.gameui.queryrefinedlg",true);	
			end;
		elseif modtype == 12 then
			if not Win_IsVisible("UI.gameui.queryburrowdlg") then
				Win_ShowWidget("UI.gameui.queryburrowdlg",true);	
			end;
		--added by qjb 装备强化
		elseif modtype==16 then
			if not Win_IsVisible("UI.gameui.newarmupddlg") then
				Win_ShowWidget("UI.gameui.newarmupddlg",true);	
				Win_SetText("UI.gameui.newarmupddlg.taxrate",taxbuf);
				Win_SetText("UI.gameui.newarmupddlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
				
				if taxinfo.taxrate < 0 then
					Win_ShowWidget("UI.gameui.newarmupddlg.taxrate", false);
				else
					Win_ShowWidget("UI.gameui.newarmupddlg.taxrate", true);
				end;					
			end;
		elseif modtype==17 then --added by qjb 装备强化
			if not Win_IsVisible("UI.gameui.armspiritdlg") then
				Win_ShowWidget("UI.gameui.armspiritdlg",true);	
				Win_SetText("UI.gameui.armspiritdlg.taxrate",taxbuf);
				Win_SetText("UI.gameui.armspiritdlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
				
				if taxinfo.taxrate < 0 then
					Win_ShowWidget("UI.gameui.armspiritdlg.taxrate", false);
				else
					Win_ShowWidget("UI.gameui.armspiritdlg.taxrate", true);
				end;				
			end;
		elseif modtype==18 then
			Win_ShowWidget("UI.gameui.armenhancedlg", bshow~=0);
			if bshow then
				Win_SetText("UI.gameui.armenhancedlg.taxrate",taxbuf);
				Win_SetText("UI.gameui.armenhancedlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
				
				if taxinfo.taxrate < 0 then
					Win_ShowWidget("UI.gameui.armenhancedlg.taxrate", false);
				else
					Win_ShowWidget("UI.gameui.armenhancedlg.taxrate", true);
				end;				
			end;
		elseif modtype == 21 then
			Win_ShowWidget("UI.gameui.ArmUpdlg",bshow~=0);	
		end;
	end;
	
	OnUpdateRingSoulRelieve=function(num)
		Win_ShowWidget("UI.gameui.RingSoulRelieveDlg",true);
	end;
	
	OnUpdateRingSoulProcess=function(num)
		Win_ShowWidget("UI.gameui.RingSoulProcessDlg",true);
	end;
	
	OnUpdateRingSoulReset=function(num)
		Win_ShowWidget("UI.gameui.RingSoulResetDlg",true);
	end;
	
	OnShowRingSoulInfo=function(type,bRecv,Process)
		local pStringInfo = GetRingSoulInfo();
		local iLevel = GetRingSoulLevel();
		if type == 0 then
			Win_SetText("UI.gameui.RingSoulRelieveDlg.Showlabel",pStringInfo);
			if iLevel > 0 then
				Win_EnableWidget("UI.gameui.RingSoulRelieveDlg.affirmbtn",false);
			elseif iLevel == 0 then
				Win_EnableWidget("UI.gameui.RingSoulRelieveDlg.affirmbtn",true);
			end;
		elseif type == 1 then 
			Win_SetText("UI.gameui.RingSoulProcessDlg.Showlabel",pStringInfo);
			if bRecv == 1 then
				Win_ShowWidget("UI.gameui.RingSoulProcessDlg.Processlabel",true);
			elseif bRecv == 0 then
				if Process == 2 then
					Win_ShowMsgBox("你的戒灵获得了一次完美加工！每项属性永久增加了10点！","系统消息",ui_msgid_default,"UI.gameui.RingSoulProcessDlg");
				elseif Process == 1 then 
					Win_ShowMsgBox("你的戒灵获得了一次优秀加工！每项属性增加8点以上！","系统消息",ui_msgid_default,"UI.gameui.RingSoulProcessDlg");
				end;
				Win_ShowWidget("UI.gameui.RingSoulProcessDlg.Processlabel",false);
			end;
			
			if iLevel == 0 then
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.backbtn",false);
			else
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.backbtn",true);
			end;
			
			if iLevel == 15 then
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.processbtn",false);
			else
				if bRecv == 1 or iLevel == 0 then
					Win_EnableWidget("UI.gameui.RingSoulProcessDlg.processbtn",true);
				else 
					Win_SetValue("UI.gameui.RingSoulProcessDlg.processbtn",2,value_channel_timerspace);
					Win_EnableWidget("UI.gameui.RingSoulProcessDlg.processbtn", false);
				end;
			end;
			
		elseif type == 2 then 
			Win_SetText("UI.gameui.RingSoulProcessDlg.Showlabel",pStringInfo);
			if bRecv == 1 then
				Win_ShowWidget("UI.gameui.RingSoulProcessDlg.Processlabel",true);
			elseif bRecv == 0 then
				if Process == 2 then
					Win_ShowMsgBox("你的戒灵获得了一次完美加工！每项属性永久增加了10点！","系统消息",ui_msgid_default,"UI.gameui.RingSoulProcessDlg");
				elseif Process == 1 then 
					Win_ShowMsgBox("你的戒灵获得了一次优秀加工！每项属性增加8点以上！","系统消息",ui_msgid_default,"UI.gameui.RingSoulProcessDlg");
				end;
				Win_ShowWidget("UI.gameui.RingSoulProcessDlg.Processlabel",false);
			end;
			
			if iLevel == 0 then
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.backbtn",false);
			else
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.backbtn",true);
			end;
			
			if iLevel == 15 then
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.processbtn",false);
			else
				Win_EnableWidget("UI.gameui.RingSoulProcessDlg.processbtn",true);
			end;
		elseif type == 3 then 
			Win_SetText("UI.gameui.RingSoulResetDlg.Showlabel",pStringInfo);
			if bRecv == 1 then
				Win_ShowWidget("UI.gameui.RingSoulResetDlg.Resetlabel",true);
			elseif bRecv == 0 then
				Win_ShowWidget("UI.gameui.RingSoulResetDlg.Resetlabel",false);
			end;
		end;
		
	end;
	
	OnShowXieRingRelieve=function()
		Win_ShowWidget("UI.gameui.jiefundlg",true);
	end;
	
	OnShowXieRingMake=function()
		Win_ShowWidget("UI.gameui.processdlg",true);
	end;
	
	OnShowXieRingCombine=function()
		Win_ShowWidget("UI.gameui.mixdlg",true);
	end;
	
	OnShowXieRingAVAMake=function()
		Win_ShowWidget("UI.gameui.rongliandlg",true);
	end;
	
	OnShowXieRingInfo=function(type)
		if type == 6 then
			local attr = HandleXieRingRecieveResult();
			Win_SetText("UI.gameui.jiefundlg.resulttext",attr);
		elseif type == 9 then
			local res = HandleXieRingAVAMakeResult();
			Win_SetText("UI.gameui.rongliandlg.resulttext",res);
		end;
	end;
	
	OnUpdateXieRingAttrubuteNumber=function(num)
		Win_SetValue("UI.gameui.mixdlg.propertylist",num,value_channel_item_num);
	end;
	
	OnOpenBBZRschDlg=function(num)
		Win_SetValue("UI.gameui.Babaozhairesearchdlg.ItemResearchList",num,value_channel_item_num);
		Win_ShowWidget("UI.gameui.Babaozhairesearchdlg",true);
	end;
	
	OnOpenBBZBuyDlg=function(num)
		Win_SetValue("UI.gameui.BabaozhaiBuydlg.list",num,value_channel_item_num);
		Win_ShowWidget("UI.gameui.BabaozhaiBuydlg",true);
	end;
	
	OnUpdateBBZRschDlg=function(FmAssets,FmMoney)
		Win_SetText("UI.gameui.Babaozhairesearchdlg.Resourse",FmAssets);
		
		local money=FmMoney;
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.Babaozhairesearchdlg.goldedit",gold);
		Win_SetText("UI.gameui.Babaozhairesearchdlg.silveredit",silver);
		Win_SetText("UI.gameui.Babaozhairesearchdlg.copperedit",copper);

	end;
	
	OnUpdateBBZBuyDlg=function(Asset)
		Win_SetText("UI.gameui.BabaozhaiBuydlg.selfassetlabel",Asset);
		
		local money=GetMoney();
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.BabaozhaiBuydlg.selfgoldedit",gold);
		Win_SetText("UI.gameui.BabaozhaiBuydlg.selfsilveredit",silver);
		Win_SetText("UI.gameui.BabaozhaiBuydlg.selfcopperedit",copper);
		
		local value = Win_GetValue("UI.gameui.BabaozhaiBuydlg.numslider",value_channel_pos);
		Win_SetValue("UI.gameui.BabaozhaiBuydlg.numslider", value);
	end;
	
	OnUpdateCombineList=function(num)
		if Win_IsVisible("UI.gameui.newcomposedlg") then
			Win_SetValue("UI.gameui.newcomposedlg.list",num,value_channel_item_num);
			
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0,value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numedit", 0, value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numedit",0);
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0);
		end;
	end;
	
	OnUpdateSafeShop=function(yuanbao,jinding,gold)
		Win_SetText("UI.gameui.safetradedlg.yuanbaolabel",yuanbao);
		Win_SetText("UI.gameui.safetradedlg.jingdinlabel",jinding);
		Win_SetText("UI.gameui.safetradedlg.goldlable",gold);
	end;
	
	OnUpdateBBZRschList=function(num)
		if Win_IsVisible("UI.gameui.Babaozhairesearchdlg") then
			Win_SetValue("UI.gameui.Babaozhairesearchdlg.ItemResearchList",num,value_channel_item_num);
		end;
	end;
	
	OnUpdateBBZBuyList=function(num)
		if Win_IsVisible("UI.gameui.BabaozhaiBuydlg") then
			Win_SetValue("UI.gameui.BabaozhaiBuydlg.list",num,value_channel_item_num);
		end;
	end;
	
	
	OnUpdateForgeList=function(num)
		if Win_IsVisible("UI.gameui.newforgedlg") then
			Win_ShowWidget("UI.gameui.newforgedlg.list.returnbtn", false);
			Win_SetValue("UI.gameui.newforgedlg.list",num,value_channel_item_num);
			
			Win_SetText("UI.gameui.newforgedlg.maxlevellabel", "");
			Win_SetText("UI.gameui.newforgedlg.rebatlabel", "");
			Win_SetText("UI.gameui.newforgedlg.nextlevellabel", "");
			Win_SetText("UI.gameui.newforgedlg.goldedit", "");
			Win_SetText("UI.gameui.newforgedlg.silveredit", "");
			Win_SetText("UI.gameui.newforgedlg.copperedit", "");
			Win_SetText("UI.gameui.newforgedlg.regoldedit", "");
			Win_SetText("UI.gameui.newforgedlg.resilveredit", "");
			Win_SetText("UI.gameui.newforgedlg.recopperedit", "");
		end;
	end;


	
	--added by qjb 防沉迷提示优化
	OnOpenAANoticeDlg=function(bshow, tiptext, bhide)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.aanoticedlg",false);
		else
			if bhide == 1 then
				Win_SetValue("UI.gameui.aanoticedlg",75,value_channel_timerspace);
			else
				Win_SetValue("UI.gameui.aanoticedlg",-1,value_channel_timerspace);
			end;
			Win_ShowWidget("UI.gameui.aanoticedlg",true);
			Win_SetText("UI.gameui.aanoticedlg.tiplabel",tiptext);
		end;
	end;
	
	--add by Abrahamhu, 显示装备强化时的金币和金票
	-- 买模式 mone 花费, money2 没意义
	-- 卖模式 mone 金子, money2 金票
	ShowMakeMoneyAndGoldBill = function(modtype--[[强化类型--]], money, money2)
		local mymoney = GetMoney();
		local mygoldbill = GetGoldBill();
		if modtype == 20 and not Win_IsChecked("UI.gameui.tradedlg.regoldbtn") then --npc交易使用金票
			mygoldbill = 0;
		end;
		local showmoney = GetMoney(); --金币显示数目
		local showbill = mygoldbill; --金票显示数目
		local moneycolor = '/C00'; -- 金币颜色
		local billcolor = '/C00'; -- 金票颜色
		
		local bsell=Win_GetValue("UI.gameui.tradedlg",value_channel_customtype);
		if bsell == 0 then --商店为买模式
			if mygoldbill >= money then
				showmoney = 0;
				showbill = money;
			else 
				showmoney = money - mygoldbill;
				if mygoldbill + mymoney < money then
					moneycolor = '/C20';
					billcolor = '/C20';
				end;
			end
		else  -- 商店为卖模式
			showmoney = money;
			showbill = money2;
		end
		
		local gold=math.floor(showmoney/1000000);
		local silver=math.floor((showmoney-gold*1000000)/1000);
		local copper=showmoney-gold*1000000-silver*1000;
		local billgold=math.floor(showbill/1000000);
		local billsilver=math.floor((showbill-billgold*1000000)/1000);
		local billcopper=showbill-billgold*1000000-billsilver*1000;
		
		if modtype == 0 then -- 合成
			Win_SetText("UI.gameui.newcomposedlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.newcomposedlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.newcomposedlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.newcomposedlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.newcomposedlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.newcomposedlg.recopperedit",billcolor..billcopper);
		elseif modtype == 1 then -- 加工 
			Win_SetText("UI.gameui.newforgedlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.newforgedlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.newforgedlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.newforgedlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.newforgedlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.newforgedlg.recopperedit",billcolor..billcopper);
		elseif modtype == 2 then -- 打孔
			Win_SetText("UI.gameui.newburrowdlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.newburrowdlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.newburrowdlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.newburrowdlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.newburrowdlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.newburrowdlg.recopperedit",billcolor..billcopper);
		elseif modtype == 3 or modtype == 13 then -- 镶嵌
			Win_SetText("UI.gameui.newsculpdlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.newsculpdlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.newsculpdlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.newsculpdlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.newsculpdlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.newsculpdlg.recopperedit",billcolor..billcopper);
		elseif modtype == 16 then -- 升级
			Win_SetText("UI.gameui.newarmupddlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.newarmupddlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.newarmupddlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.newarmupddlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.newarmupddlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.newarmupddlg.recopperedit",billcolor..billcopper);
		elseif modtype == 17 then -- 附魂
			Win_SetText("UI.gameui.armspiritdlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.armspiritdlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.armspiritdlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.armspiritdlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.armspiritdlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.armspiritdlg.recopperedit",billcolor..billcopper);
		elseif modtype == 18 then -- 强化
			Win_SetText("UI.gameui.armenhancedlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.armenhancedlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.armenhancedlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.armenhancedlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.armenhancedlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.armenhancedlg.recopperedit",billcolor..billcopper);
		elseif modtype == 19 then -- 修理装备
			Win_SetText("UI.gameui.repairdlg.goldfee",moneycolor..gold);
			Win_SetText("UI.gameui.repairdlg.silverfee",moneycolor..silver);
			Win_SetText("UI.gameui.repairdlg.copperfee",moneycolor..copper);
			Win_SetText("UI.gameui.repairdlg.regoldfee",billcolor..billgold);
			Win_SetText("UI.gameui.repairdlg.resilverfee",billcolor..billsilver);
			Win_SetText("UI.gameui.repairdlg.recopperfee",billcolor..billcopper);
			gold=math.floor(mymoney/1000000);
			silver=math.floor((mymoney-gold*1000000)/1000);
			copper=mymoney-gold*1000000-silver*1000;
			billgold=math.floor(mygoldbill/1000000);
			billsilver=math.floor((mygoldbill-billgold*1000000)/1000);
			billcopper=mygoldbill-billgold*1000000-billsilver*1000;
			Win_SetText("UI.gameui.repairdlg.goldedit",gold);
			Win_SetText("UI.gameui.repairdlg.silveredit",silver);
			Win_SetText("UI.gameui.repairdlg.copperedit",copper);
			Win_SetText("UI.gameui.repairdlg.regoldedit",billgold);
			Win_SetText("UI.gameui.repairdlg.resilveredit",billsilver);
			Win_SetText("UI.gameui.repairdlg.recopperedit",billcopper);
		elseif modtype == 20 then -- npc交易			
			Win_SetText("UI.gameui.tradedlg.goldlabel",moneycolor..gold);
			Win_SetText("UI.gameui.tradedlg.silverlabel",moneycolor..silver);
			Win_SetText("UI.gameui.tradedlg.copperlabel",moneycolor..copper);
			Win_SetText("UI.gameui.tradedlg.regoldlabel",billcolor..billgold);
			Win_SetText("UI.gameui.tradedlg.resilverlabel",billcolor..billsilver);
			Win_SetText("UI.gameui.tradedlg.recopperlabel",billcolor..billcopper);
		end;
	end;
	--参数1, 2, 3, 4, 5
	--合成时: 强化类型, 最大合成次数, 费用, 成功率
	--加工时: 强化类型, 加工上限, 费用, 折扣率, 下一加工等级 
	--打孔时: 强化类型, 打孔上限, 费用, 成功率, 下一打孔等级
	--加工查询:强化类型, 0, 费用, 
	--打孔查询:强化类型, 0, 费用,
	--装备品质提升：强化类型，0，费用，当前品质，下一品质
	OnUpdateMakeDlg=function(modtype, maxmakecount, money, succrate, level)
		local rate = GetRevenueValue();
		money = math.floor(money * (100 + rate.taxrate) / 100);
		
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		
		if modtype == 0 then			
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			
			Win_SetValue("UI.gameui.newcomposedlg.numslider",maxmakecount-1,value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numedit",maxmakecount,value_channel_maxvalue);
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0);
			Win_SetValue("UI.gameui.newcomposedlg.numedit",1);
			local succratehigh = math.floor(succrate/100);
			local succratelower = succrate - succratehigh*100;
			local newsuccrate = succratehigh.."."..succratelower;
			Win_SetText("UI.gameui.newcomposedlg.succlabel",newsuccrate.."%");
		elseif modtype == 1 then
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			
			Win_SetText("UI.gameui.newforgedlg.maxlevellabel", maxmakecount);
			local succratehigh = math.floor(succrate/100);
			local succratelower = succrate - succratehigh*100;
			local newsuccrate = succratehigh.."."..succratelower;
			Win_SetText("UI.gameui.newforgedlg.rebatlabel", succrate.."%");
			Win_SetText("UI.gameui.newforgedlg.nextlevellabel", level);
			
		elseif modtype == 2 then
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			
			local succratehigh = math.floor(succrate/100);
			local succratelower = succrate - succratehigh*100;
			local newsuccrate = succratehigh.."."..succratelower;
			Win_SetText("UI.gameui.newburrowdlg.succlabel", newsuccrate.."%");
			Win_SetText("UI.gameui.newburrowdlg.nextlevellabel", level);
			Win_SetText("UI.gameui.newburrowdlg.maxlevellabel", maxmakecount);
		elseif modtype==3 then --update镶嵌界面
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			for i=0,6 do
				Win_ShowWidget("UI.gameui.newsculpdlg.itemwgt"..i,(i<maxmakecount));
			end;			
			local info=GetInfotip(ui_drag_type_syn_list,0,-1,-1);
			Win_SetText("UI.gameui.newsculpdlg.labelsculp",info.name);
			--Win_SetText("UI.gameui.newsculpdlg.infolist.infolabel",info.desc);	
		elseif modtype==13 then --update镶嵌价格
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
		elseif modtype==14 then --移动装备到镶嵌面板
			local srcType = maxmakecount;
			local srcIndex = money;
			MoveItem(srcType,srcIndex, ui_drag_type_syn_list, 0);
		elseif modtype == 11 then
			Win_SetText("UI.gameui.queryrefinedlg.goldedit",gold);
			Win_SetText("UI.gameui.queryrefinedlg.silveredit",silver);
			Win_SetText("UI.gameui.queryrefinedlg.copperedit",copper);
		elseif modtype == 12 then
			Win_SetText("UI.gameui.queryburrowdlg.goldedit",gold);
			Win_SetText("UI.gameui.queryburrowdlg.silveredit",silver);
			Win_SetText("UI.gameui.queryburrowdlg.copperedit",copper);
		--added by qjb 装备强化
		elseif modtype == 16 then
			local iscanmake = maxmakecount
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			if iscanmake <= 0 then
				Win_EnableWidget("UI.gameui.newarmupddlg.affirmbtn",false);
			else
				Win_EnableWidget("UI.gameui.newarmupddlg.affirmbtn",true);
			end
		elseif modtype == 17 then
			local iscanmake = maxmakecount
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			if iscanmake <= 0 then
				Win_EnableWidget("UI.gameui.armspiritdlg.affirmbtn",false);
			else
				Win_EnableWidget("UI.gameui.armspiritdlg.affirmbtn",true);
			end
			
			typetxt, leveltxt,level = GetCurArmSpiritTypeLevelName();
			Win_SetText("UI.gameui.armspiritdlg.typelabel",typetxt);
			Win_SetText("UI.gameui.armspiritdlg.levellabel",leveltxt);
			Win_SetText("UI.gameui.armspiritdlg.levellabel2",level);
		elseif modtype == 18 then
			local canmake = maxmakecount;
			local curqua = succrate;
			local nextqua = level;
			local mymoney = GetMoney();
			Win_EnableWidget("UI.gameui.armenhancedlg.affirmbtn", canmake~=0);
			
			if mymoney < money then
				Win_EnableWidget("UI.gameui.armenhancedlg.affirmbtn", false);
			end
			
			UI.children.gameui.ShowMakeMoneyAndGoldBill(modtype, money);
			
			Win_SetText("UI.gameui.armenhancedlg.curqualabel", curqua);
			Win_SetText("UI.gameui.armenhancedlg.nextqualabel", nextqua);
		end;
		--added by qjb 装备强化 end...

	end;
	
	OnUpdateForgeItem=function(isel)
		Win_SetValue("UI.gameui.newforgedlg.list", isel, value_channel_sel);
		ItemModSelect(isel+1);
	end;



       	--打开装备拆解界面,add by Abrahamhu
	OnOpenReduceDlg=function(param)
		if param == 1 then
			--领地税收
			local taxinfo = GetRevenueValue();
			local mapname = GetCurMapName();
			local taxbuf;
			
			if taxinfo.taxrate <= 10 then
				taxbuf = "/C13"..taxinfo.taxrate.."％/C00";
			elseif taxinfo.taxrate <= 20 then
				taxbuf = "/C01"..taxinfo.taxrate.."％/C00";
			else
				taxbuf = "/C22"..taxinfo.taxrate.."％/C00";
			end;
			
			Win_ShowWidget("UI.gameui.reducedlg", true);
			
			Win_SetText("UI.gameui.reducedlg.taxrate",taxbuf);
			Win_SetText("UI.gameui.reducedlg.taxrate", mapname.."今日税率："..taxinfo.taxrate.."%",value_channel_tiptext);
			
			if taxinfo.taxrate < 0 then
				Win_ShowWidget("UI.gameui.reducedlg.taxrate", false);
			else
				Win_ShowWidget("UI.gameui.reducedlg.taxrate", true);
			end;				
		elseif param == 0 then
			Win_ShowWidget("UI.gameui.reducedlg", false);
		end;
	end;
	
	--刷新装备拆解界面,add by Abrahamhu
	OnUpdateReduceDlg = function(maketype, cardnum, materialnum, needmoney, iscanmake, isshowmsg1, isshowmsg2)
		local rate = GetRevenueValue();
		needmoney = needmoney * (100 + rate.taxrate) / 100;
		
		if maketype == 14 then
			for i=0,7 do
				if i < cardnum then
					Win_EnableWidget("UI.gameui.reducedlg.cardwgt"..i,true);
					Win_ShowWidget("UI.gameui.reducedlg.cardwgt"..i,true);
				else
					Win_EnableWidget("UI.gameui.reducedlg.cardwgt"..i,false);
					Win_ShowWidget("UI.gameui.reducedlg.cardwgt"..i,false);
				end;
			end;
				
			for i=0,4 do
				if i < materialnum then
					Win_EnableWidget("UI.gameui.reducedlg.materialwgt"..i,true);
					Win_ShowWidget("UI.gameui.reducedlg.materialwgt"..i,true);
				else
					Win_EnableWidget("UI.gameui.reducedlg.materialwgt"..i,false);
					Win_ShowWidget("UI.gameui.reducedlg.materialwgt"..i,false);
				end;
			end;
			
			local mymoney = GetMoney();
			local mygoldbill = GetGoldBill();
			local showmoney = GetMoney(); --金币显示数目
			local showbill = GetGoldBill(); --金票显示数目
			local moneycolor = '/C00'; -- 金币颜色
			local billcolor = '/C00'; -- 金票颜色
			
			if mygoldbill >= needmoney then
				showmoney = 0;
				showbill = needmoney;
			else 
				showmoney = needmoney - mygoldbill;
				if mygoldbill + mymoney < needmoney then
					moneycolor = '/C20';
					billcolor = '/C20';
				end;
			end		
			local gold=math.floor(showmoney/1000000);
			local silver=math.floor((showmoney-gold*1000000)/1000);
			local copper=showmoney-gold*1000000-silver*1000;
			local billgold=math.floor(showbill/1000000);
			local billsilver=math.floor((showbill-billgold*1000000)/1000);
			local billcopper=showbill-billgold*1000000-billsilver*1000;
			
			Win_SetText("UI.gameui.reducedlg.goldedit",moneycolor..gold);
			Win_SetText("UI.gameui.reducedlg.silveredit",moneycolor..silver);
			Win_SetText("UI.gameui.reducedlg.copperedit",moneycolor..copper);
			Win_SetText("UI.gameui.reducedlg.regoldedit",billcolor..billgold);
			Win_SetText("UI.gameui.reducedlg.resilveredit",billcolor..billsilver);
			Win_SetText("UI.gameui.reducedlg.recopperedit",billcolor..billcopper);
		
			if iscanmake == 1 then
				Win_EnableWidget("UI.gameui.reducedlg.reducebtn", true);
			elseif iscanmake == 0 then
				Win_EnableWidget("UI.gameui.reducedlg.reducebtn", false);
			end;
			
			if isshowmsg1 == 1 then
				Win_SetText("UI.gameui.reducedlg.msglbl", "选择需要拆解的一张卡片");
			elseif isshowmsg2 == 1 then
				Win_SetText("UI.gameui.reducedlg.msglbl", "有附加属性的装备才能拆解");
			else 
				Win_SetText("UI.gameui.reducedlg.msglbl", "");
			end;
		end;
	end;
	
	OnUpdateComposeRate=function(succrate)
		local succratehigh = math.floor(succrate/100);
		local succratelower = succrate - succratehigh*100;
		local newsuccrate = succratehigh.."."..succratelower;
		
		if Win_IsVisible("UI.gameui.newcomposedlg") then
			Win_SetText("UI.gameui.newcomposedlg.succlabel", newsuccrate.."%");
			Win_SetValue("UI.gameui.newcomposedlg.numslider",0);
			Win_SetValue("UI.gameui.newcomposedlg.numedit",1);
		elseif Win_IsVisible("UI.gameui.newburrowdlg") then
			Win_SetText("UI.gameui.newburrowdlg.succlabel", newsuccrate.."%");
		end;
	end;
	
	OnUpdateMakeButton=function(modtype, showmakebtn, showretbtn)
		if modtype == 1 then
			Win_EnableWidget("UI.gameui.newforgedlg.affirmbtn", showmakebtn~=0);
			Win_EnableWidget("UI.gameui.newforgedlg.autoforgebtn", showmakebtn~=0);
			Win_ShowWidget("UI.gameui.newforgedlg.list.returnbtn", showretbtn~=0);
			Win_SetValue("UI.gameui.newforgedlg.list", 0, value_channel_sel);
			ItemModSelect(0+1);
			Win_SetText("UI.gameui.newforgedlg.tiplabel", "当前处理查询模式, 无法进行加工操作");
		elseif modtype == 2 then
			Win_EnableWidget("UI.gameui.newburrowdlg.affirmbtn", showmakebtn~=0);
			Win_ShowWidget("UI.gameui.newburrowdlg.list.returnbtn", showretbtn~=0);
			Win_SetValue("UI.gameui.newburrowdlg.list", 0, value_channel_sel);
			ItemModSelect(0+1);
			Win_SetText("UI.gameui.newburrowdlg.tiplabel", "当前处于查询模式, 无法进行打孔操作");
		end;
	end;
		
	OnOpenItemMod=function(bshow,modtype,num)
	end;
	
	OnOpenEquipFlyDlg=function(bshow)
		Win_ShowWidget("UI.gameui.equipflydlg", bshow~=0);
		end;
		
	OnUpdateEquipFlyStatus=function(bclear,bok,oldname,newname)
		Win_EnableWidget("UI.gameui.equipflydlg.clearbtn",bclear~=0);
		Win_SetValue("UI.gameui.equipflydlg.affirmbtn",bok,value_channel_framescheme);
		Win_SetText("UI.gameui.equipflydlg.preequipname",oldname);
		Win_SetText("UI.gameui.equipflydlg.flyequipname",newname);
		end;
		
	OnOpenRefineDlg=function(bshow)
		if bshow == 1 then
		if not Win_IsVisible("UI.gameui.refinedlg") then
		Win_ShowWidget("UI.gameui.refinedlg", true);
		end;
		else
		if Win_IsVisible("UI.gameui.refinedlg") then
		Win_ShowWidget("UI.gameui.refinedlg", false);
		end;
		end;
		end;
	
	OnUpdateRefineStatus=function(bclear,brefine,money,soilnum)
		Win_EnableWidget("UI.gameui.refinedlg.clearbtn",bclear~=0);
		Win_SetValue("UI.gameui.refinedlg.refinebtn",brefine,value_channel_framescheme);
		
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.refinedlg.goldlabel",gold);
		Win_SetText("UI.gameui.refinedlg.silverlabel",silver);
		Win_SetText("UI.gameui.refinedlg.copperlabel",copper);
		
		Win_SetText("UI.gameui.refinedlg.soilnum",soilnum);
		end;
	
	OnOpenRefineProcessDlg=function(name,benableclosebtn)
		if not Win_IsVisible("UI.gameui.refineprocessdlg") then
		Win_ShowWidget("UI.gameui.refineprocessdlg",true);
		end;
		Win_SetText("UI.gameui.refineprocessdlg.equipmentname",name);
		Win_EnableWidget("UI.gameui.refineprocessdlg.closebtn",benableclosebtn~=0);
		end;
		
	OnOpenEvolveDlg=function(bshow)
		if bshow == 1 then
		if not Win_IsVisible("UI.gameui.evolvedlg") then
		Win_ShowWidget("UI.gameui.evolvedlg", true);
		end;
		else
		if Win_IsVisible("UI.gameui.evolvedlg") then
		Win_ShowWidget("UI.gameui.evolvedlg", false);
		end;
		end;
		end;
		
	OnUpdateEvolveStatus=function(bclear,bevolve,equipname,evolveequipname,money,probability)
		Win_EnableWidget("UI.gameui.evolvedlg.clearbtn",bclear~=0);
		Win_SetValue("UI.gameui.evolvedlg.evolvebtn",bevolve,value_channel_framescheme);
		
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.evolvedlg.goldlabel",gold);
		Win_SetText("UI.gameui.evolvedlg.silverlabel",silver);
		Win_SetText("UI.gameui.evolvedlg.copperlabel",copper);
		
		Win_SetText("UI.gameui.evolvedlg.probability",probability);
		Win_SetText("UI.gameui.evolvedlg.equipname",equipname);
		Win_SetText("UI.gameui.evolvedlg.evolveequipname",evolveequipname);
		end;
		
	OnOpenReplenishDlg=function(bshow)
		if bshow == 1 then
		if not Win_IsVisible("UI.gameui.replenishdlg") then
		Win_ShowWidget("UI.gameui.replenishdlg", true);
		end;
		else
		if Win_IsVisible("UI.gameui.replenishdlg") then
		Win_ShowWidget("UI.gameui.replenishdlg", false);
		end;
		end;
		end;
		
	OnUpdateReplenishStatus=function(bclear,baffirm,bbeataway,equipname,money,num)
		Win_EnableWidget("UI.gameui.replenishdlg.clearbtn",bclear~=0);
		Win_SetValue("UI.gameui.replenishdlg.affirmbtn",baffirm,value_channel_framescheme);
		Win_EnableWidget("UI.gameui.replenishdlg.beatawaybtn",bbeataway~=0);
		if (bbeataway~=1) then
		Win_SetCheck("UI.gameui.replenishdlg.beatawaybtn",false);
		end;
		Win_SetText("UI.gameui.replenishdlg.equipname",equipname);
		
		local gold=math.floor(money/1000000);
		local silver=math.floor((money-gold*1000000)/1000);
		local copper=money-gold*1000000-silver*1000;
		Win_SetText("UI.gameui.replenishdlg.goldlabel",gold);
		Win_SetText("UI.gameui.replenishdlg.silverlabel",silver);
		Win_SetText("UI.gameui.replenishdlg.copperlabel",copper);
		
		for i=0,2 do
		Win_ShowWidget("UI.gameui.replenishdlg.itemwgt"..i,(i<num));
		end;
		end;
		
	OnPlayBeatAwayEffect=function(index)
		local wgtpath = "UI.gameui.replenishdlg.itemwgt"..index;
		if Win_IsVisible(wgtpath) then
		if index == 0 then
			UI.children.gameui.children.replenishdlg.children.itemwgt0.PlayEffect();
		elseif index == 1 then
			UI.children.gameui.children.replenishdlg.children.itemwgt1.PlayEffect();
		elseif index == 2 then
			UI.children.gameui.children.replenishdlg.children.itemwgt2.PlayEffect();
		end;
		end;
		end;

	OnUpdateItemMod=function(modtype,num,money)
	end;
	
	
	OnShowBallBattleDlg=function()
		local winnerscore=GetWinnerScore();
		local loserscore=GetLoserScore();
		Win_SetText("UI.gameui.ballbattledlg.winnerScore",winnerscore);
		Win_SetText("UI.gameui.ballbattledlg.loserScore",loserscore);
		Win_ShowWidget("UI.gameui.ballbattledlg",true);	
	end;
	
	-- 修罗场结果对话框[joeyxiong 08/03/2011]
	OnShowSuraBattleDlg=function()
		local winnerscore=GetWinnerScore();
		local loserscore=GetLoserScore();
		Win_SetText("UI.gameui.surabattledlg.winnerScore",winnerscore);
		Win_SetText("UI.gameui.surabattledlg.loserScore",loserscore);
		Win_ShowWidget("UI.gameui.surabattledlg",true);	
	end;
	-- 修罗排行榜
	OnShowSuraToplistDlg=function()
		Win_ShowWidget("UI.gameui.suratoplistdlg",true);	
	end;
	
	--joeyxiong 03/04/2011
	OnShowCatBattleDlg=function()
		Win_ShowWidget("UI.gameui.catbattledlg",true);	
	end;
	
	OnUpdateCatCamp=function()
		Win_SetText("UI.gameui.statusbar.campicon", "res/uires/statusbar/camphi.gsa", value_channel_effectpic);
		Win_SetValue("UI.gameui.statusbar.campicon", 5.0, value_channel_timerspace);
	end;
	
	-- 更新修行信息
	OnUpdateXiuxingInfo = function(opentab)
		if not Win_IsVisible("UI.gameui.integdlg") then
			Win_ShowWidget("UI.gameui.integdlg", true);
		end;
		
		UI.children.gameui.children.integdlg.updateXiuxing();

		if opentab==1 then
			UI.children.gameui.children.integdlg.opentab(2);
		end;
	end;
	
	OnEnterCatBattle=function()
		-- 猫狗战场中将PKMODE置灰
		Win_EnableWidget("UI.gameui.statusbar.pkmodeicon", false);
	end;
	
	OnLeaveCatBattle=function()
		Win_EnableWidget("UI.gameui.statusbar.pkmodeicon", true);
	end;
	
	OnShowFamilyWarDlg=function()	
		local iCount = GetWarFamilyCount();
		local index = GetWarFamilyPage();
		local iPageCount = math.floor(iCount / 20);
		local iLastPage = iCount  - iPageCount * 20;
						
		if iLastPage ~= 0 then
			iPageCount = iPageCount + 1;
		end
		
		SetWarFamilyPage(index);
		
		if ((index + 1) == iPageCount)  and  (iLastPage~=0) then
			Win_SetValue("UI.gameui.familyfightdlg.ProclaimWarTab.WarRelationshipList",iLastPage,value_channel_item_num);
		else
			Win_SetValue("UI.gameui.familyfightdlg.ProclaimWarTab.WarRelationshipList",20,value_channel_item_num);
		end
		
		local WarState = GetFamilyWarState();
		
		if WarState ==1 then
			Win_SetCheck("UI.gameui.familyfightdlg.ProclaimWarTab",false);
			Win_SetCheck("UI.gameui.familyfightdlg.WeekWarTab",true);
		elseif WarState == 0 then
			Win_SetCheck("UI.gameui.familyfightdlg.ProclaimWarTab",true);
			Win_SetCheck("UI.gameui.familyfightdlg.WeekWarTab",false);
		end
				
		Win_ShowWidget("UI.gameui.familyfightdlg",true);	
	end;
	
	
	OnUpdateItemInfo=function()
		if Win_IsVisible("UI.gameui.SysInfotip") then
		UI.children.gameui.children.SysInfotip.OnSelfShow();
		end;
		end;
				    
				    
	OnChangeFigure=function(mode,num)
		if mode==0 then				
		Win_SetText("UI.gameui.figuredlg","改变发色");				
		else
		Win_SetText("UI.gameui.figuredlg","改变发型");
		end;
		Win_SetValue("UI.gameui.figuredlg",mode,value_channel_customtype);
		Win_SetValue("UI.gameui.figuredlg.list",num,value_channel_item_num);
		Win_ShowWidget("UI.gameui.figuredlg",true);
		Win_SetFocus("UI.gameui.figuredlg",true);
		end;
	
	OnUpdateEnemyTab=function()
		local bEnabled = IsDisableEnemyList();
		Win_SetCheck("UI.gameui.teamdlg.enemytab.check",  bEnabled);
							
		local num = GetNumOfEnemy();
		Win_SetValue("UI.gameui.teamdlg.enemytab.enemylist", num, value_channel_item_num);
		Win_SetValue("UI.gameui.revengedlg.enemylist", num, value_channel_item_num);--更新复仇列表
		
		for i=0, num-1 do
			Win_SetCheck("UI.gameui.teamdlg.enemytab.enemylist.enemy"..i..".check",  false);
		end;
	end;
					
	OnGMBuddyUpdate=function(num)
		UI.children.gameui.children.teamdlg.UpdateFriendTab();
		UI.children.gameui.children.teamdlg.UpdateFilterTab();
		UI.children.gameui.children.mandlg.OnSelfShow();
		UI.children.gameui.children.mailresistdlg.OnSelfShow();
		UI.children.gameui.children.maillistdlg.UpdateMailList();		
	end;
		
	OnLastChatUpdate=function(num)
		UI.children.gameui.children.teamdlg.UpdateLastChatTab();
	end;		
		
	OnOpenYesNoDialog=function(stext)
		Win_ShowWidget("UI.gameui.yesnodialog", true);
		Win_SetText("UI.gameui.yesnodialog.textlabel", stext);
	end;
	
	
	OnOpenProbe=function(bshow)
		local probeinfo=GetProbeInfo();
		--AUTH_DEFAULT = 0
		--AUTH_SERVER  = 1
		--AUTH_CLIENT  = 2
		if GetAuthState() == 1 then
			for i=0,3 do
				wgtpath="UI.gameui.probeinfowin.radiobtn"..i;
				Win_ShowWidget(wgtpath,(i<probeinfo.num));
				Win_SetCheck(wgtpath,false);
				if i<probeinfo.num then
					Win_SetText(wgtpath,probeinfo.desc[i+1]);		
				end;
			end;
					
			if probeinfo.num==1 then
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn0","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,73);
			elseif probeinfo.num==2 then
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn0","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,58);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn1","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,92);
			elseif probeinfo.num==3 then
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn0","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,50);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn1","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,77);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn2","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,104);
			else
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn0","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,47);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn1","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,67);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn2","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,87);
				Win_AlignWidget("UI.gameui.probeinfowin.radiobtn3","UI.gameui.probeinfowin",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,107);
			end;
			
			Win_ShowWidget("UI.gameui.newbieinfowin",false);
			
			Win_SetText("UI.gameui.probeinfowin.infolabel1",probeinfo.info1);
			Win_SetText("UI.gameui.probeinfowin.infolabel2",probeinfo.info2);
			
			Win_ShowWidget("UI.gameui.probeinfowin1",false);   --关闭主动验证窗口
			Win_ShowWidget("UI.gameui.probeinfowin",true);
			Win_SetFocus("UI.gameui.probeinfowin");
		
		elseif GetAuthState() == 2 then
			for i=0,3 do
				wgtpath="UI.gameui.probeinfowin1.radiobtn"..i;
				Win_ShowWidget(wgtpath,(i<probeinfo.num));
				Win_SetCheck(wgtpath,false);
				if i<probeinfo.num then
					Win_SetText(wgtpath,probeinfo.desc[i+1]);		
				end;
			end;
					
			if probeinfo.num==1 then
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn0","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,73);
			elseif probeinfo.num==2 then
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn0","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,58);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn1","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,92);
			elseif probeinfo.num==3 then
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn0","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,50);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn1","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,77);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn2","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,104);
			else
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn0","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,47);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn1","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,67);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn2","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,87);
				Win_AlignWidget("UI.gameui.probeinfowin1.radiobtn3","UI.gameui.probeinfowin1",aligntype_winrect,alignstyle_left_in+alignstyle_top_in,182,107);
			end;
			
			Win_ShowWidget("UI.gameui.newbieinfowin",false);
			
			Win_SetText("UI.gameui.probeinfowin1.infolabel1",probeinfo.info1);
			Win_SetText("UI.gameui.probeinfowin1.infolabel2",probeinfo.info2);
			
			Win_ShowWidget("UI.gameui.probeinfowin1",true);
			Win_SetFocus("UI.gameui.probeinfowin1");
		end;
		end;
		
	OnNewbieTips=function(nmsg)			
			local msginfo=PopNewbieTips();			     
			if msginfo~="" then
			--[[
			Win_SetText("UI.gameui.newbieinfowin",msginfo);
			Win_SetValue("UI.gameui.newbieinfowin",15,value_channel_timerspace);
			Win_AjustSelf("UI.gameui.newbieinfowin");
			Win_AlignWidget("UI.gameui.newbieinfowin","UI.gameui.ctrlbar",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,0,-28);
			Win_ShowWidget("UI.gameui.newbieinfowin",(nmsg>0));
			]]
			
			local path="UI.gameui.newbieinfowin";
			local dlgnum=Win_GetTemplatesNum("UI.gameui.newbieinfowin",0);
			local dlgname="";
							 
			for i=0,dlgnum-1 do				 
			local dlgid=Win_GetText("UI.gameui.newbieinfowin.newbietip"..i);					 
			if dlgid==msginfo then
			break;
			end; 
			end;
			
			if dlgname=="" then
				local num = Win_GetValue("UI.gameui.newbieinfowin",value_channel_item_num);
--~ 				if num >= 3 then
--~ 					if Win_IsVisible("UI.gameui.newbieinfowin.newbietip"..(dlgnum-3)) then
--~ 						Win_ShowWidget("UI.gameui.newbieinfowin.newbietip"..(dlgnum-3),false);
--~ 					elseif Win_IsVisible("UI.gameui.newbieinfowin.newbietip"..(dlgnum-2)) then
--~ 						Win_ShowWidget("UI.gameui.newbieinfowin.newbietip"..(dlgnum-2),false);
--~ 					elseif Win_IsVisible("UI.gameui.newbieinfowin.newbietip"..(dlgnum-1)) then
--~ 						Win_ShowWidget("UI.gameui.newbieinfowin.newbietip"..(dlgnum-1),false);
--~ 					end;
--~ 				end;
				
				if num >= 2 then
					if Win_IsVisible("UI.gameui.newbieinfowin.newbietip"..(dlgnum-2)) then
						Win_ShowWidget("UI.gameui.newbieinfowin.newbietip"..(dlgnum-2),false);
					elseif Win_IsVisible("UI.gameui.newbieinfowin.newbietip"..(dlgnum-1)) then
						Win_ShowWidget("UI.gameui.newbieinfowin.newbietip"..(dlgnum-1),false);
					end;
				end;
				
				dlgname=Win_AddTemplate("UI.gameui.newbieinfowin",0);
			end;
			
			if dlgname~="" then
				Win_ShowWidget(dlgname,true);
				Win_SetText(dlgname,msginfo);
				Win_SetValue(dlgname,15,value_channel_timerspace);
				Win_AjustSelf(dlgname);
				Win_AjustSelf("UI.gameui.newbieinfowin");
				Win_ShowWidget("UI.gameui.newbieinfowin",true);
				Win_AlignWidget("UI.gameui.newbieinfowin","UI.gameui",aligntype_winrect,alignstyle_right_in+alignstyle_bottom_in,0,-115);
				--Win_AlignWidget("UI.gameui.newbieinfowin","UI.gameui",aligntype_winrect,alignstyle_right_in+alignstyle_bottom_in,0,0);
			end;
			
			
			end;
			end;
	
	OnGossipReply=function(name,fromname,msg)
				 
		local path="UI.gameui.gossipdlg";
		local dlgnum=Win_GetTemplatesNum("UI.gameui",0);
		local dlgname="";
						 
		for i=0,dlgnum-1 do				 
		local dlgid=Win_GetText("UI.gameui.gossipdlg"..i,value_channel_customname);					 
		if dlgid==name then
		dlgname="UI.gameui.gossipdlg"..i;
		break;
		end; 
		end;
		
		if dlgname=="" then
		dlgname=Win_AddTemplate("UI.gameui",0);
		end;
		
		if dlgname~="" then
						 
		if not Win_IsVisible(dlgname) then				 
		Win_ShowWidget(dlgname,true);
		Win_SetFocus(dlgname..".contentedit");		
		end;
		
		Win_SetText(dlgname,"玩家"..name.."对话:");
		Win_SetText(dlgname,name,value_channel_customname);
		
		
		if msg~="" then
		
		local contentcolor=GetColorIndex(160,235,145,255);
		local wholetxt=[[/C01]]..fromname..[[/C02]]..":"..[[/C00]]..msg;
		
		local myinfo = GetMainPlayerInfo();
		if fromname ~= myinfo.name  then
			if not IsGMBuddy(name) then
				wholetxt=[[/C01]].."(陌生人)"..[[/C26]]..fromname..[[/C02]]..":"..[[/C00]]..msg;
			else
				wholetxt=[[/C17]]..fromname..[[/C02]]..":"..[[/C00]]..msg;
			end;
		end;
		
		if fromname=="系统" then
		contentcolor=GetColorIndex(255,0,0,255);
		wholetxt=msg;				 
		elseif fromname~=name then
		contentcolor=GetColorIndex(255,255,255,255);
		end;
		
		Win_SetText(dlgname..".msglist",wholetxt,value_channel_itemtext,contentcolor);
		Win_SetText(dlgname..".historydlg.list",wholetxt,value_channel_itemtext,contentcolor);
		
		-- minize的时候有2帧的背景图，展开的时候只有1帧，当检测透明的时候2帧图就会出错
		if Win_IsChecked(dlgname..".minimizebtn") then
			Win_SetValue(dlgname,1,value_channel_framescheme);
		else
			Win_SetValue(dlgname,0,value_channel_framescheme);
		end;
		end;
		
		end;

		end;
		
	OnBeginWhisper=function(tgtname)
		if (tgtname~="") and (tgtname~=g_PlayerInfo.name) then
		Win_SetText("UI.gameui.teamdlg.nameedit",tgtname);
		Win_SetText("UI.gameui.chatbar.inputbar.chateredit",tgtname);
		Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
		end;
		end;
	
	OnGossipMsgUpdate=function(nMsg)
		if nMsg>0 then
		Win_SetValue("UI.gameui.ctrlbar.msgbtn",1,value_channel_framescheme);
		else
		Win_SetValue("UI.gameui.ctrlbar.msgbtn",0,value_channel_framescheme);
		end;
		end;
	
	OnSysMsgUpdate=function(nMsg)
			if nMsg>6 then 
			nMsg=6;
			elseif nMsg<0 then
			nMsg=0;
			end;
			
			local visPosx={};
			local visNum=0;
			
			for i=0,5 do
			visPosx[i]=447+26*i;
			if Win_IsVisible("UI.gameui.systeminfobtn"..i) then
			Win_ShowWidget("UI.gameui.systeminfobtn"..i,false);
			local px,py=Win_GetPos("UI.gameui.systeminfobtn"..i);
			visPosx[visNum]=px;
			visNum=visNum+1;
			end;				
			Win_ClearPathPoint("UI.gameui.systeminfobtn"..i);		
			end;
			
			local msgType = GetMsgType();
			for i=0,5 do			
			Win_ShowWidget("UI.gameui.systeminfobtn"..i,(i<nMsg));
			if msgType[i] == 1446 then 
				--求婚信息
				Win_SetText("UI.gameui.systeminfobtn"..i, "res/uires/marriagesys/heartinfobtn.gsa",value_channel_backpic);
			else
				Win_SetText("UI.gameui.systeminfobtn"..i, "res/uires/gameui/systeminfobtn.gsa",value_channel_backpic);
			end;
			Win_SetPos("UI.gameui.systeminfobtn"..i,visPosx[i],70);
			if i<nMsg then						
			Win_PushPathPoint("UI.gameui.systeminfobtn"..i,204+26*i,70);
			end;			
			end;		
			
			UI.children.gameui.OnUpdateSysMsgPos();
			
			end;
			
	--pipo626 宠物经验卡
	OnOpenPetExpCardWgt=function(bshow, status)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.petexpcardwgt", false);
		else
			Win_ShowWidget("UI.gameui.petexpcardwgt", true);
			--更换背景图片
			if status == 150 then
				Win_SetText("UI.gameui.petexpcardwgt", "res/uires/gameui/petexpbk150.gsa",value_channel_backpic);
			elseif status == 200 then
				Win_SetText("UI.gameui.petexpcardwgt", "res/uires/gameui/petexpbk200.gsa",value_channel_backpic);
			end;
		end;
	end;
	
	OnOpenStopRecordWgt=function(bshow)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.stoprecordwgt", false);
		else
			Win_ShowWidget("UI.gameui.stoprecordwgt", true);
		end;
	end;
	
	OnOpenInputSecuCardDlg=function(sceentype, bshow, icount, szbuf)
		if sceentype == 0 then
			if bshow ~= 0 then
				Win_ShowWidget("UI.actorsel.inputsecucarddlg", true);
				for i=1, 8 do
					Win_SetText("UI.actorsel.inputsecucarddlg.label"..i, "");
				end;
				for i=1, icount do
					Win_SetText("UI.actorsel.inputsecucarddlg.label"..i, string.sub(szbuf, i*2-1, i*2));
				end;
			else
				Win_ShowWidget("UI.actorsel.inputsecucarddlg", false);
			end;
		else
			if bshow ~= 0 then
				Win_ShowWidget("UI.gameui.inputsecucarddlg", true);
				for i=1, icount do
					Win_SetText("UI.gameui.inputsecucarddlg.label"..i, string.sub(szbuf, i*2-1, i*2));
				end;
			else
				Win_ShowWidget("UI.gameui.inputsecucarddlg", false);
			end;
		end;
	end;
	
	OnResetSecuCardDlg=function(sceentype, bshow, icount, szbuf)
		if sceentype == 0 then
			if bshow ~= 0 then
				Win_ShowWidget("UI.actorsel.resetsecucarddlg", true);
				for i=1, 8 do
					Win_SetText("UI.actorsel.resetsecucarddlg.label"..i, "");
				end;
				for i=1, icount do
					Win_SetText("UI.actorsel.resetsecucarddlg.label"..i, string.sub(szbuf, i*2-1, i*2));
				end;
			else
				Win_ShowWidget("UI.actorsel.resetsecucarddlg", false);
			end;
		else
			if bshow ~= 0 then
				Win_ShowWidget("UI.gameui.resetsecucarddlg", true);
				for i=1, 8 do
					Win_SetText("UI.gameui.resetsecucarddlg.label"..i, "");
				end;
				for i=1, icount do
					Win_SetText("UI.gameui.resetsecucarddlg.label"..i, string.sub(szbuf, i*2-1, i*2));
				end;
			else
				Win_ShowWidget("UI.gameui.resetsecucarddlg", false);
			end;
		end;
	end;
	
	OnUpdateSysMsgPos=function()
		local visPosx={};
		local visNum=0;
			
		for i=0,5 do
		visPosx[i]=447+26*i;
		if Win_IsVisible("UI.gameui.systeminfobtn"..i) then
		local px,py=Win_GetPos("UI.gameui.systeminfobtn"..i);
		visPosx[visNum]=px;
		visNum=visNum+1;
		end;				
		Win_ClearPathPoint("UI.gameui.systeminfobtn"..i);		
		end;
		
		for i=0,visNum-1 do			
		Win_SetPos("UI.gameui.systeminfobtn"..i,visPosx[i],GetSysMsgPosOffset());
		Win_PushPathPoint("UI.gameui.systeminfobtn"..i,204+26*i,GetSysMsgPosOffset());
		end;		
		end;

	OnMailMsgUpdate=function(nMsg)
			if nMsg>0 then
				UI.children.gameui.children.sketchbar.children.sketchmap.children.emailbtn.PerformInit();
				--Win_SetValue("UI.gameui.ctrlbar.emailbtn",1,value_channel_framescheme);
				-- 察看最新的mail的标题，带有彩玉的， 作tooltip提示
				local pfrom,ptitle,money,bowlder,ntype,nmode=GetMailBrief(nMsg);
				
				-- CS_MAIL_BOWLDER == 7
				if ntype==7 then
					local tch = "新彩玉邮件到达，点击打开邮箱领取\n标题：“"..ptitle.."”";
					UI.children.gameui.children.MailInfoSysTip.OnOpenInputTip("UI.gameui.sketchbar.sketchmap","newmail",tch,15,2);
					Win_AlignWidget("UI.gameui.MailInfoSysTip","UI.gameui.sketchbar.sketchmap.emailbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,30);
				end;
			else
				--Win_SetValue("UI.gameui.ctrlbar.emailbtn",0,value_channel_framescheme);
			end;	
			end;
			
	--新手帮助系统
	OnCloseNewbieTask=function(nstep)
		if nstep == 8 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep803");
			UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep803");
		end;
		end;
		
	OnNewbieHelpSysMsg=function(nStep)
		if nStep ==  1 then
			RequestNewbieHelp(help_simpleintroduce, 1, 30);
			Win_SetValue("UI.gameui.ctrlbar.warebtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.taskbtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.skillbtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.teambtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.familybtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.emailbtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.rackbtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.optionbtn",1,value_channel_framescheme);
			Win_ShowWidget("UI.gameui.experiencebar.effect",true);
			
		elseif nStep == 2 then--关闭step1
			RequestNewbieHelp(help_simpleintroduce, 0);
			Win_SetValue("UI.gameui.ctrlbar.warebtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.taskbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.skillbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.teambtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.familybtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.emailbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.rackbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.optionbtn",0,value_channel_framescheme);
			Win_ShowWidget("UI.gameui.experiencebar.effect",false);

		elseif nStep == 3 or nStep == 300 then
			Win_SetValue("UI.gameui.ctrlbar.warebtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.warebtn","SysHelpStep"..nStep,"点击这里打开物品栏",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.warebtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,10,0);
			
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",1,value_channel_framescheme);
			UI.children.gameui.children.ExSysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.statusbtn","SysHelpStep"..nStep,"点击这里打开角色属性面板",newtask_showtime,2);
			Win_AlignWidget("UI.gameui.ExSysInputTip","UI.gameui.ctrlbar.statusbtn",aligntype_winrect,alignstyle_right_in+alignstyle_top_out,-40,25);
			
		elseif nStep == 301 then
			--关闭step3
			Win_SetValue("UI.gameui.ctrlbar.warebtn",0,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep3");
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",0,value_channel_framescheme);
			UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep3");
		
			if Win_IsVisible("UI.gameui.waredlg") and Win_IsChecked("UI.gameui.waredlg.equiptab") then
				UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.waredlg.equiptab","SysHelpStep"..nStep,"双击武器、防具即可将其装备上",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.waredlg.equiptab",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,40);
			end;
			
		elseif nStep == 4 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep301");
			UI.children.gameui.children.sketchbar.children.sketchmap.children.filterbtn.PerformInit();
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.sketchbar.sketchmap","SysHelpStep"..nStep,"点击这里可打开小地图设置按钮",newtask_showtime,2);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.sketchbar.sketchmap.filterbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,30);
			
		elseif nStep == 5 then
			UI.children.gameui.children.sketchbar.children.sketchmap.children.filterbtn.CloseEffect();
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep4");
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.sketchbar.sketchmap","SysHelpStep4","左键单击小地图可以打开所在地图的缩略图",newtask_showtime, 2);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.sketchbar.sketchmap.worldbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,30);
			
		elseif nStep == 6 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep5");
			UI.children.gameui.children.sketchbar.children.sketchmap.children.autosearchbtn.PerformInit();
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.sketchbar.sketchmap","SysHelpStep"..nStep,"点击这里可以打开关键目标的自动寻路列表",newtask_showtime,2);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.sketchbar.sketchmap.autosearchbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,30);
			
		elseif nStep == 7 then
			UI.children.gameui.children.sketchbar.children.sketchmap.children.autosearchbtn.CloseEffect();
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep6");
			Win_SetValue("UI.gameui.ctrlbar.taskbtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.taskbtn","SysHelpStep"..nStep,"点击这里查看任务信息",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.taskbtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,5,0);
			
		elseif nStep == 8 or nStep == 800 then
			--关闭step8
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep7");
			Win_SetValue("UI.gameui.ctrlbar.taskbtn",0,value_channel_framescheme);
			
		elseif nStep == 801 then
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.waredlg.equiptab","SysHelpStep"..nStep,"点击图标左下角的加号\n按钮即可学习该技能",newtask_showtime,2);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.studydlg.tab0.skillcontain",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,60);
			
		elseif nStep == 802 then
			--关闭801
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep801");
			Win_SetValue("UI.gameui.ctrlbar.skillbtn",0,value_channel_framescheme);
			
			Win_SetValue("UI.gameui.ctrlbar.skillbtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.skillbtn","SysHelpStep"..nStep,"点击这里打开技能信息面板",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.skillbtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,5,0);
			
		elseif nStep == 803 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep802");
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.skilldlg","SysHelpStep"..nStep,"用鼠标左键将技能图标拖到快捷栏的空格上",newtask_showtime,2);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.studydlg.tab0.skillcontain",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,10,40);
			
			UI.children.gameui.children.ExSysInputTip.OnOpenInputTip("UI.gameui.accelbar_main","SysHelpStep"..nStep,"快捷栏",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.ExSysInputTip","UI.gameui.accelbar_main",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,-300,-5);
		
		elseif nStep == 9 then
			--关闭803
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep803");
			UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep803");
				
		elseif nStep == 10 or nStep == 1000 then
			Win_ShowWidget("UI.gameui.experiencebar.effect",false);
			Win_SetValue("UI.gameui.ctrlbar.taskbtn",0,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.warebtn",1,value_channel_framescheme);
			Win_SetValue("UI.gameui.ctrlbar.optionbtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.warebtn","SysHelpStep"..nStep,"点击这里打开物品栏",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.warebtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,5,0);
			
		elseif nStep == 1001 then
			--关闭10
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep10");
			Win_SetValue("UI.gameui.ctrlbar.warebtn",0,value_channel_framescheme);
			
			if Win_IsVisible("UI.gameui.waredlg") and Win_IsChecked("UI.gameui.waredlg.medicinetab") then
				UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.waredlg.medicinetab","SysHelpStep"..nStep,"双击道具即可使用了",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.waredlg.medicinetab",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,0,40);
			end;
			
		elseif nStep == 11 or nStep ==  1100 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1001");
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.statusbtn","SysHelpStep"..nStep,"点击这里打开角色属性面板",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.statusbtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,5,0);
			
		elseif nStep == 1101 then
			--关闭11
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep11");
			Win_SetValue("UI.gameui.ctrlbar.statusbtn",0,value_channel_framescheme);
			
			if Win_IsVisible("UI.gameui.equipdlg") then
				UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.equipdlg.assignbtn","SysHelpStep"..nStep,"点击这里进行属性点分配",newtask_showtime,1);
				Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.equipdlg.assignbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,20);
			end;
			
		elseif nStep == 1102 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1101");
			if Win_IsVisible("UI.gameui.equipdlg") then
				UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.equipdlg.restorebtn","SysHelpStep"..nStep,"点击这里取消刚才分配的内容",newtask_showtime,1);
				Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.equipdlg.restorebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_out,10,20);
				UI.children.gameui.children.ExSysInputTip.OnOpenInputTip("UI.gameui.equipdlg.affirmbtn","SysHelpStep"..nStep,"点击则分配成功",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.ExSysInputTip", "UI.gameui.equipdlg.restorebtn", aligntype_winrect,alignstyle_left_out+alignstyle_top_out,-50, 26);
			end;
			
		elseif nStep == 13 or nStep == 1300 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1102");
			UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep1102");
			Win_SetValue("UI.gameui.ctrlbar.petbtn",1,value_channel_framescheme);
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.ctrlbar.petbtn","SysHelpStep"..nStep,"点击这里打开宠物面板",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.ctrlbar.petbtn",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,20,0);
			
		elseif nStep == 1301 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep13");
			UI.children.gameui.children.petstatusbar.children.peteffect.OnCloseEffect();
			if Win_IsVisible("UI.gameui.petdlg") then
				UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.petdlg.pet1","SysHelpStep"..nStep,"双击宠物的魂之精可以释放出宠物",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.petdlg.pet1",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,-5,30);				
			end;
			
		elseif nStep == 1302 then
			UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1301");
			if Win_IsVisible("UI.gameui.petdlg") then
				UI.children.gameui.children.ExSysInputTip.OnOpenInputTip("UI.gameui.petdlg.petskillbox.itempetskill0","SysHelpStep"..nStep,"双击主动技能即可使其生效",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.ExSysInputTip","UI.gameui.petdlg.petskillbox.itempetskill0",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,-175,20);
			end;
			
		elseif nStep == 14 then
			UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep1302");
			RequestNewbieHelp(help_detailintroduce, 1, 10);
			
		elseif nStep == 10001 then--经验条闪烁,客户端自定义值
			Win_ShowWidget("UI.gameui.experiencebar.effect",true)
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.experiencebar","SysHelpStep10001","当这条槽充满时便升级啦",newtask_showtime,4);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.experiencebar",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,100,-10);
			
		elseif nStep == 10002 then
			if Win_IsVisible("UI.gameui.petdlg") then
				UI.children.gameui.children.ExSysInputTip.OnOpenInputTip("UI.gameui.petdlg.petskillbox.itempetskill0","SysHelpStep"..nStep,"双击主动技能即可使其生效",newtask_showtime,2);
				Win_AlignWidget("UI.gameui.ExSysInputTip","UI.gameui.petdlg.petskillbox.itempetskill0",aligntype_winrect,alignstyle_left_in+alignstyle_top_out,-175,20);
			end;
			
		elseif nStep == 10003 then
			UI.children.gameui.children.petstatusbar.children.peteffect.OnShowEffect();
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.petstatusbar","SysHelpStep"..nStep,"点击这里打开宠物面板",newtask_showtime,3);
			Win_AlignWidget("UI.gameui.SysInputTip","UI.gameui.petstatusbar",aligntype_winrect,alignstyle_right_out+alignstyle_bottom_out,-45,10);
			
		elseif nStep == 10004 then
			UI.children.gameui.children.SysInputTip.OnOpenInputTip("UI.gameui.accelbar.hideshowbtn","accelbar","按此键扩展快捷栏!", 5, 2);
			Win_AlignWidget("UI.gameui.SysInputTip", "UI.gameui.accelbar.hideshowbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_out,-10,15);			

		end;
	end;
				   
	OnTargetState=function(bshow,pname,ptext,nhp,nlevel,ntype,color,bflag,capturelevel, bnoupdate, bchangetarget, nviplevel, nLhLvl)
		if ( pname=="") then
			bshow=0;
		end;
	      
	      if (bshow==1) then
			Win_SetValue("UI.gameui.targetbar",ntype,value_channel_customtype);
		      
			if (ntype==0) then
				Win_SetText("UI.gameui.teamdlg.nameedit",pname);
				Win_SetText("UI.gameui.targetbar.nameicon","鼠标左键密语\n右键弹出菜单",value_channel_tiptext);
				
				goalgod = GetGoalGodInfo();
				if goalgod.hasgod ==  1 then
					Win_SetText("UI.gameui.targetbar.godbar.nameicon",goalgod.name);
					Win_SetText("UI.gameui.targetbar.godbar.levelicon",goalgod.LEVEL);
					Win_SetValue("UI.gameui.targetbar.godbar.godbarHP",goalgod.MAXHP, value_channel_maxvalue);
					Win_SetValue("UI.gameui.targetbar.godbar.godbarHP",goalgod.CURHP, value_channel_pos);
					
					local godframe = math.floor(goalgod.CURHP*3/goalgod.MAXHP);
					Win_SetValue("UI.gameui.targetbar.godbar.godbarHP",godframe,value_channel_framescheme);	 
					
					Win_ShowWidget("UI.gameui.targetbar.godbar", true);
					Win_ShowWidget("UI.gameui.targetbar.petbar", false);
					g_PetInfo=GetOtherPet();
					if  g_PetInfo~=nil and g_PetInfo.LEVEL > 0 then 
						Win_ShowWidget("UI.gameui.targetbar.godbar.petlevelicon", true);
						Win_ShowWidget("UI.gameui.targetbar.godbar.peticon", true);
					else
						Win_ShowWidget("UI.gameui.targetbar.godbar.petlevelicon", false);
						Win_ShowWidget("UI.gameui.targetbar.godbar.peticon", false);						
					end;						
				else
					g_PetInfo=GetOtherPet();				
					if g_PetInfo~=nil and g_PetInfo.LEVEL > 0 then	
						Win_ShowWidget("UI.gameui.targetbar.petbar", true);
					else
						Win_ShowWidget("UI.gameui.targetbar.petbar", false);
					end;
					Win_ShowWidget("UI.gameui.targetbar.godbar", false);
				end;
			else
				Win_SetText("UI.gameui.targetbar.nameicon","",value_channel_tiptext);
				Win_ShowWidget("UI.gameui.targetbar.petbar", false);
				Win_ShowWidget("UI.gameui.targetbar.godbar", false);
			end;
		      
			if (ntype==0) or (ntype==2) then
				Win_SetValue("UI.gameui.targetbar.progbarHP",nhp,value_channel_pos);
			else
				Win_SetValue("UI.gameui.targetbar.progbarHP",nhp);
			end;
		      
			local scheme=math.floor(nhp*3/100);
			Win_SetValue("UI.gameui.targetbar.progbarHP",scheme,value_channel_framescheme);	      
		      
			Win_SetValue("UI.gameui.targetbar.nameicon",color,value_channel_color_draw);
			Win_SetText("UI.gameui.targetbar.nameicon",pname,value_channel_customname);
			if capturelevel ~= 0 then
			Win_SetText("UI.gameui.targetbar.nameicon",ptext.." /C20"..capturelevel);
			else
			Win_SetText("UI.gameui.targetbar.nameicon",ptext);
			end;
			
			Win_SetValue("UI.gameui.targetbar.levelicon",color,value_channel_color_draw);
			Win_SetText("UI.gameui.targetbar.levelicon",nlevel);
			
			if nLhLvl > 0 then
				Win_ShowWidget("UI.gameui.targetbar.lhlevel",true);    
				Win_SetText("UI.gameui.targetbar.lhlevel",nLhLvl);
			else
				Win_ShowWidget("UI.gameui.targetbar.lhlevel",false);    
				Win_SetText("UI.gameui.targetbar.lhlevel","0");
			end;
			
			Win_SetValue("UI.gameui.targetbar",bflag,value_channel_framescheme);
			Win_SetValue("UI.gameui.targetbar.viplevel", nviplevel, value_channel_dragindex);
		else
		
			local menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
			local showname=Win_GetText("UI.gameui.targetbar.nameicon",value_channel_customname);
			if menuname==showname then
				Win_ShowWidget("UI.gameui.playermenu",false);      
			end;
			Win_SetValue("UI.gameui.targetbar.viplevel", 0, value_channel_dragindex);
		end;
			
		if capturelevel~=0 and IsShowCaptureLevelTip()~=0 then
			Win_SetText("UI.gameui.targetbar.SysInputTip", "宠物捕捉等级");
			Win_ShowWidget("UI.gameui.targetbar.SysInputTip",true);
			Win_SetValue("UI.gameui.targetbar.SysInputTip",5,value_channel_timerspace);
		end;
		
		if bnoupdate == 0 then	-- 需要重新SHOW界面, 默认是0 必须重SHOW
			Win_ShowWidget("UI.gameui.targetbar", (bshow~=0));
		end;
		
		Win_ShowWidget("UI.gameui.targetbar.petbar", false);
		
		if (ntype == 0 and bshow==1 and bchangetarget==1) then
			PeekOtherPet(pname);
		end;
	end;
			      
	OnOpenWakePetDlg=function(mode,num)
		if num<0 then
			num=0;
		end;

		if mode==0 then 
			Win_SetValue("UI.gameui.petwakedlg.petlist",num,value_channel_item_num);
			
			if not Win_IsVisible("UI.gameui.petwakedlg") then
				Win_ShowWidget("UI.gameui.petwakedlg",true);
			end;
			Win_SetFocus("UI.gameui.petwakedlg");
		elseif mode==1 then
			if Win_IsVisible("UI.gameui.petwakedlg") then
				Win_SetValue("UI.gameui.petwakedlg.petlist",num,value_channel_item_num);
				Win_SetFocus("UI.gameui.petwakedlg");
			end;
		end;
		end;
	
	OnQueryPetRegInfo=function()
		if Win_IsVisible("UI.gameui.petfosterinfodlg") then
			Win_SetSelect("UI.gameui.petfosterinfodlg",0,0);
			Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.prepagebtn", false);
			local pagecount=GetPageCount();
			if pagecount==0 then
			Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.nextpagebtn", false);
			elseif pagecount==1 then
			local itemcount = GetPetRegInfoCount(0);
			Win_SetValue("UI.gameui.petfosterinfodlg.allinfotab.fosterinfolist", itemcount, value_channel_item_num);
			Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.nextpagebtn", false);
			else
			Win_SetValue("UI.gameui.petfosterinfodlg.allinfotab.fosterinfolist", 30, value_channel_item_num);
			Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.nextpagebtn", true);
			end;
			SetCurPageNum(1);
			local myregpetcount = GetPetRegInfoCount(1);
			local allregpetcount = GetPetRegInfoCount(0);
			if myregpetcount >= 5 or allregpetcount >= 300 then
				Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.registerpetbtn", false);
			else
				Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.registerpetbtn", true);
			end;	
		else
			local queryinterval = GetQueryInterval();
			if queryinterval > 0 then
				Win_ShowMsgBox("请您"..queryinterval.."秒后再来查询。", "系统消息", ui_msgid_affirm);
			else
				CmdQueryPetRegInfo();
				Win_ShowWidget("UI.gameui.petfosterinfodlg", true);
			end;
		end;
	end;
 	
	OnOpenSellJudeDlg=function(price)
		if Win_IsVisible("UI.gameui.selljudedlg") then
			local gold=math.floor(price/1000000);
			local silver=math.floor((price-gold*1000000)/1000);
			local copper=price-gold*1000000-silver*1000;
			Win_SetText("UI.gameui.selljudedlg.suggestedprice.goldlabel", gold);
			Win_SetText("UI.gameui.selljudedlg.suggestedprice.silverlabel", silver);
			Win_SetText("UI.gameui.selljudedlg.suggestedprice.copperlabel", copper);
		else
			QueryBowlderInfo();
			Win_ShowWidget("UI.gameui.selljudedlg", true);
		end;
	end;
	
	OnOpenBuyJudeDlg=function(count)
		if Win_IsVisible("UI.gameui.buyjudedlg") then
			Win_SetValue("UI.gameui.buyjudedlg.buyjudeinfolist", count, value_channel_item_num);
		else
			Win_SetValue("UI.gameui.buyjudedlg.buyjudeinfolist", 0, value_channel_item_num);
			QueryBowlderInfo();
			Win_ShowWidget("UI.gameui.buyjudedlg", true);
		end;
	end;
	
	OnOpenCancelSellJudeDlg=function(count)
		if Win_IsVisible("UI.gameui.cancelselljudedlg") then
			Win_SetValue("UI.gameui.cancelselljudedlg.cancelselljudeinfolist", count, value_channel_item_num);
		else
			Win_SetValue("UI.gameui.cancelselljudedlg.cancelselljudeinfolist", 0, value_channel_item_num);
			QueryMyBowlderInfo();
			Win_ShowWidget("UI.gameui.cancelselljudedlg", true);
		end;
	end;
	
	OnCloseBowlderDlg=function(i)
		if i==1 then --关闭寄售彩玉dlg
			Win_ShowWidget("UI.gameui.selljudedlg", false);
		elseif i==2 then --关闭购买彩玉dlg
			Win_ShowWidget("UI.gameui.buyjudedlg", false);
		elseif i==3 then --关闭撤消寄售彩玉dlg
			Win_ShowWidget("UI.gameui.cancelselljudedlg", false);
		end;
	end;
	
	-- 切换地图后，显示当前地图的提示，n秒后自动隐藏， info图片名，即地图名
	ShowMapInfoTextLabel=function(info)
		Win_SetText("UI.gameui.mapinfotextlabel", "res/map/"..info..".gsa",value_channel_backpic);
		Win_ShowWidget("UI.gameui.mapinfotextlabel",true);
	end;	
	
	--左键单击超链接
	OnLClickHLink = function(linktype, data)
		if linktype == "helppage" then
			local preselid = Win_GetValue("UI.gameui.helpwindlg.treelist", value_channel_sel);
			Win_SetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", preselid, value_channel_customid);
			Win_SetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", 1, value_channel_customstate);
			Win_SetValue("UI.gameui.helpwindlg.treelist", data, value_channel_sel);
			Win_ShowWidget("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", true);
		elseif linktype == "taskpage" then
			local preindex;
			local preid;
			if Win_IsChecked("UI.gameui.taskdlg.doingtab") then
				preindex = 0;
				preid = Win_GetValue("UI.gameui.taskdlg.doingtab.tasklist", value_channel_sel);
			elseif Win_IsChecked("UI.gameui.taskdlg.worldtab") then
				preindex = 1;
				preid = Win_GetValue("UI.gameui.taskdlg.worldtab.tasklist", value_channel_sel);
			elseif Win_IsChecked("UI.gameui.taskdlg.storytab") then
				preindex = 2;
				preid = Win_GetValue("UI.gameui.taskdlg.storytab.tasktree", value_channel_sel);
			elseif Win_IsChecked("UI.gameui.taskdlg.recommendtab") then
				preindex = 3;
				preid = Win_GetValue("UI.gameui.taskdlg.recommendtab.tasktree", value_channel_sel);
			elseif Win_IsChecked("UI.gameui.taskdlg.indextab") then
				preindex = 4;
				if Win_IsVisible("UI.gameui.taskdlg.indextab.tasktree") then
					preid = Win_GetValue("UI.gameui.taskdlg.indextab.tasktree", value_channel_sel);
				else
					preid = Win_GetValue("UI.gameui.taskdlg.indextab.tasktreelevel", value_channel_sel);
				end;
			end;
			Win_SetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", 1, value_channel_customstate);
			Win_SetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", preindex, value_channel_customindex);
			Win_SetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", preid, value_channel_customid);
			Win_SelectSelf("UI.gameui.taskdlg.indextab");
			if GetTaskIndexType() == 4 then
				Win_SetValue("UI.gameui.taskdlg.indextab.tasktree", data, value_channel_sel);
			else
				Win_SetValue("UI.gameui.taskdlg.indextab.tasktreelevel", data, value_channel_sel);
			end;
			Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", true);
		end;
	end;
	
	--pipo 防守型副本
	OnOpenDefenseRankingDlg=function(bshow)
		if bshow then
			Win_ShowWidget("UI.gameui.defenserankingdlg", true);
		else
			Win_ShowWidget("UI.gameui.defenserankingdlg", false);
		end;
	end;
	
	OnUpdateDefenseRankingDlg=function(num)
		if Win_IsVisible("UI.gameui.defenserankingdlg") then
			Win_SetValue("UI.gameui.defenserankingdlg.detailcontain.listcontain.detaillist", num, value_channel_item_num);
		end;
	end;
	
	OnOpenDefenseReviveDlg=function(show)
		if show == 0 then
			Win_ShowWidget("UI.gameui.reviveclosedlg", false);
			Win_ShowWidget("UI.gameui.reviveopendlg", false);
		elseif show == 1 then
			Win_ShowWidget("UI.gameui.reviveclosedlg", false);
			Win_ShowWidget("UI.gameui.reviveopendlg", true);
		elseif show == 2 then
			Win_ShowWidget("UI.gameui.reviveclosedlg", true);
			Win_ShowWidget("UI.gameui.reviveopendlg", false);
		end;
	end;
	
	--游戏QQSHOW截图
	OnOpenQQShowDlg = function(itype, bshow)
		if itype == 1 then
			if bshow ~= 0 then
				Win_ShowWidget("UI.gameui.qqshowcutdlg", true);
			else
				Win_ShowWidget("UI.gameui.qqshowcutdlg", false);
			end;
		elseif itype == 2 then
			if bshow ~= 0 then
				Win_ShowWidget("UI.gameui.qqshowpreviewdlg", true);
			else
				Win_ShowWidget("UI.gameui.qqshowpreviewdlg", false);
			end;		
		end;
	end;
	
	--打开离线经验兑换对话框
	OnOpenExpExchangeDlg = function(bshow)
		if bshow == 0 then
			Win_ShowWidget("UI.gameui.offlineexpdlg", false);
		elseif bshow == 1 then
			local total, expper, jewelper, offlineExpTips = GetOfflineExp();
			Win_SetText("UI.gameui.offlineexpdlg.expExchangeNum", tostring(total));
			if total > 0 then
				if total == 1 then
					Win_EnableWidget("UI.gameui.offlineexpdlg.oneExpExchangeChk", true);
					Win_EnableWidget("UI.gameui.offlineexpdlg.twoExpExchangeChk", false);
					Win_EnableWidget("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
					Win_SetText("UI.gameui.offlineexpdlg.oneExp", expper);
					Win_SetText("UI.gameui.offlineexpdlg.oneJewel", jewelper);
					Win_SetText("UI.gameui.offlineexpdlg.twoExp", 0);
					Win_SetText("UI.gameui.offlineexpdlg.twoJewel", 0);
					Win_SetText("UI.gameui.offlineexpdlg.threeExp", 0);
					Win_SetText("UI.gameui.offlineexpdlg.threeJewel", 0);
					Win_SetCheck("UI.gameui.offlineexpdlg.oneExpExchangeChk", true);
					Win_SetCheck("UI.gameui.offlineexpdlg.twoExpExchangeChk", false);
					Win_SetCheck("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
				elseif total == 2 then
					Win_EnableWidget("UI.gameui.offlineexpdlg.oneExpExchangeChk", true);
					Win_EnableWidget("UI.gameui.offlineexpdlg.twoExpExchangeChk", true);
					Win_EnableWidget("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
					Win_SetText("UI.gameui.offlineexpdlg.oneExp", expper);
					Win_SetText("UI.gameui.offlineexpdlg.oneJewel", jewelper);
					Win_SetText("UI.gameui.offlineexpdlg.twoExp", expper*2);
					Win_SetText("UI.gameui.offlineexpdlg.twoJewel", jewelper*2);
					Win_SetText("UI.gameui.offlineexpdlg.threeExp", 0);
					Win_SetText("UI.gameui.offlineexpdlg.threeJewel", 0);
					Win_SetCheck("UI.gameui.offlineexpdlg.oneExpExchangeChk", false);
					Win_SetCheck("UI.gameui.offlineexpdlg.twoExpExchangeChk", true);
					Win_SetCheck("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
				elseif total == 3 then
					Win_EnableWidget("UI.gameui.offlineexpdlg.oneExpExchangeChk", true);
					Win_EnableWidget("UI.gameui.offlineexpdlg.twoExpExchangeChk", true);
					Win_EnableWidget("UI.gameui.offlineexpdlg.threeExpExchangeChk", true);
					Win_SetText("UI.gameui.offlineexpdlg.oneExp", expper);
					Win_SetText("UI.gameui.offlineexpdlg.oneJewel", jewelper);
					Win_SetText("UI.gameui.offlineexpdlg.twoExp", expper*2);
					Win_SetText("UI.gameui.offlineexpdlg.twoJewel", jewelper*2);
					Win_SetText("UI.gameui.offlineexpdlg.threeExp", expper*3);
					Win_SetText("UI.gameui.offlineexpdlg.threeJewel", jewelper*3);
					Win_SetCheck("UI.gameui.offlineexpdlg.oneExpExchangeChk", false);
					Win_SetCheck("UI.gameui.offlineexpdlg.twoExpExchangeChk", false);
					Win_SetCheck("UI.gameui.offlineexpdlg.threeExpExchangeChk", true);
				end;
				Win_EnableWidget("UI.gameui.offlineexpdlg.confirmbtn", true);
			else 
				Win_EnableWidget("UI.gameui.offlineexpdlg.oneExpExchangeChk", false);
				Win_EnableWidget("UI.gameui.offlineexpdlg.twoExpExchangeChk", false);
				Win_EnableWidget("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
				Win_SetText("UI.gameui.offlineexpdlg.oneExp", 0);
				Win_SetText("UI.gameui.offlineexpdlg.oneJewel", 0);
				Win_SetText("UI.gameui.offlineexpdlg.twoExp", 0);
				Win_SetText("UI.gameui.offlineexpdlg.twoJewel", 0);
				Win_SetText("UI.gameui.offlineexpdlg.threeExp", 0);
				Win_SetText("UI.gameui.offlineexpdlg.threeJewel", 0);
				Win_SetCheck("UI.gameui.offlineexpdlg.oneExpExchangeChk", false);
				Win_SetCheck("UI.gameui.offlineexpdlg.twoExpExchangeChk", false);
				Win_SetCheck("UI.gameui.offlineexpdlg.threeExpExchangeChk", false);
				Win_EnableWidget("UI.gameui.offlineexpdlg.confirmbtn", false);
			end;
			if offlineExpTips == 1 then
				Win_SetCheck("UI.gameui.offlineexpdlg.nexttipsChk", true);
			elseif offlineExpTips == 0 then
				Win_SetCheck("UI.gameui.offlineexpdlg.nexttipsChk", false);
			end;
			Win_SetValue("UI.gameui.offlineexpdlg.confirmbtn", 0, value_channel_customindex);
			Win_ShowWidget("UI.gameui.offlineexpdlg", true);
			Win_SetFocus("UI.gameui.offlineexpdlg");
		end;
	end;
	
	-- 打开幻神代修炼界面
	OnOpenPracticeAgentDlg=function()
		Win_ShowWidget("UI.gameui.godpracticeagentdlg", true);
	end;
	
	-- 更新登录限时保护信息
	OnUpdateLoginProtect=function()
		UI.children.gameui.children.waredlg.OnUpdateProtect();
	end;
	
	--打开仇人列表，revengetype 0 - 复仇, 1 - 仇人传送
	OnOpenRevengeDlg=function(revengetype, haverevenge)
		QryEnemy();
		local num = GetNumOfEnemy();

		if revengetype == 0 then
			Win_SetText("UI.gameui.revengedlg.titlelabel", "复仇列表");
			Win_SetBackPic("UI.gameui.revengedlg.okbtn", "res/uires/sysdlg/affirmbtn.gsa");
		else
			Win_SetText("UI.gameui.revengedlg.titlelabel", "仇人传送列表");
			Win_SetBackPic("UI.gameui.revengedlg.okbtn", "res/uires/revenge/transport.gsa");
		end;
		
		Win_SetValue("UI.gameui.revengedlg", revengetype, value_channel_customtype);
		Win_SetValue("UI.gameui.revengedlg", haverevenge, value_channel_customid);
		Win_SetValue("UI.gameui.revengedlg.enemylist", num, value_channel_item_num);
		Win_SetValue("UI.gameui.revengedlg.enemylist", 0, value_channel_sel);		
		Win_ShowWidget("UI.gameui.revengedlg", true);
	end; --end for openrevengedlg
		
	--打开仇人共享列表
	OnOpenRevengeShareDlg=function(playerId, enemyCount, showMsgBox)

		if showMsgBox == 1 then
			Win_ShowWidget("UI.gameui.revengesharedlg", true);
			local strmsg = "本次结仇会消耗一定数量的结仇符，是否使用结仇符与此人强制结仇？";
			Win_ShowMsgBox(strmsg, "系统消息", ui_msgid_yesno, "UI.gameui.revengesharedlg");
		elseif showMsgBox==2 then
			local strmsg = "您没有足够的结仇符与此人结仇，若需要强制结仇，请在货架购买结仇符。";
			Win_ShowMsgBox(strmsg);
		else
			Win_SetValue("UI.gameui.revengesharedlg", playerId, value_channel_customid);
			Win_SetValue("UI.gameui.revengesharedlg.enemylist", enemyCount, value_channel_item_num);
			Win_SetValue("UI.gameui.revengesharedlg.enemylist", 0, value_channel_sel);		
			Win_ShowWidget("UI.gameui.revengesharedlg", true);
		end;
	end;
	
	children = 
	{
		newbiecustom_simpleintroduce=
		{
			type="WIDGET",
			rect={0,0,1,1},
			style=wgtstyle_renderbuffer,
			initlayer=msgbox_layer-1,
			custombuffer=custom_buffer_newbiehelp,
			buffervalue =
			{
				drawtype=help_simpleintroduce,
				offsetx=0,
				offsety=0,
			},
			
		};
		
		newbiecustom_keyintro=
		{
			type="WIDGET",
			rect={0,0,1,1},
			style=wgtstyle_renderbuffer,
			initlayer=msgbox_layer-1,
			custombuffer=custom_buffer_newbiehelp,
			buffervalue =
			{
				drawtype=help_newtask_keyintro,
				offsetx=0,
				offsety=0,
			},
			
		};
		
		newbiecustom_detailintroduce=
		{
			type="WIDGET",
			rect={0,0,1,1},
			style=wgtstyle_renderbuffer,
			initlayer=msgbox_layer-1,
			custombuffer=custom_buffer_newbiehelp,
			buffervalue =
			{
				drawtype=help_detailintroduce,
				offsetx=0,
				offsety=0,
			},
			
		};
		

				
		--公用对话
		ScrnTutortip=
		{
			type = "LABEL",
			rect={100,100,24,33},
			coverpic="res/uires/gameui/ballarrow.gsa",
			coverpicpos={-13,35},
			drawcolor={0,0,0,255},
			visible=0,			
			maxwidth=200,
			minheight=41,
			sizeable=1,								
			marginh=12,
			marginv=6,
			textsize=12,
			alphas=0.1,	
			richmode=ui_richmode_all,
			initlayer=systooltip_layer,
			edgecheck=edge_check_show+edge_check_auto,	

			patchdrawtype=patch_draw_type_scale,			
			
			patchupleft="res/uires/gameui/ballupleft.gsa",
			patchupright="res/uires/gameui/ballupright.gsa",
			patchdownleft="res/uires/gameui/balldownleft.gsa",
			patchdownright="res/uires/gameui/balldownright.gsa",
			
			patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
			patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
			patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
			patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
			
			patchmiddle="res/uires/gameui/ballmiddle.gsa",
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.ScrnTutortip",false);
				end;
				
			OnSelfShow=function()
				Win_SetValue("UI.gameui.ScrnTutortip",8,value_channel_timerspace);
				end;			
			
			OnClick=function()
				Win_ShowWidget("UI.gameui.ScrnTutortip",false);
				end;
		};

		ScrnChatTooltip=
		{
			type = "WIDGETLIST",
			rect={300,150,28,16},		
			drawcolor = { 255, 255, 255, 255 },
			sizeable=1,
			visible=0,
			style=wgtstyle_topmost,
			edgecheck=edge_check_show+edge_check_auto,
			updatemute=1,
			moveable=1;
			itemmarginh=0,
			itemmarginv=0,	
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.ScrnChatTooltip",false);
				end;
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.ScrnChatTooltip");
			end;	

			OnParseTooltip=function(drgtyp,drgidx,hsttype,hstidx,rx,ry)
				local result=0;
				if (drgtyp>=0) and (drgidx>=0) then
					local info=GetTooltip(drgtyp,drgidx,hsttype,hstidx,rx,ry);
					if info.desc~="" then
						local cmpinfo="";
						local cmpTaoinfo="";
						local Taoinfo="";
						local varyDressinfo = "";
						local tempString = "";
						local tempString1 = "";
						local mainvaryDressinfo="";
						local cmpringsoulinfo="";
						local cmpwingsoulinfo="";
						local ringsoulinfo="";
						local cmpxieringinfo="";
						local xieringinfo = "";
						local wingsoulinfo = "";
						local diaohuainfo = "";
						local neckringinfo = "";
						local capsoulinfo = "";
						local facesoulinfo = "";
						local clothsoulinfo = "";
						local honorsoulinfo = "";
						local cmpneckringinfo = "";
						local cmpcapsoulinfo = "";
						local cmpfacesoulinfo = "";
						local cmpclothsoulinfo = "";
						local cmphonorsoulinfo = "";
						local petAttrinfo = "";
						
						if(drgtyp == ui_drag_type_chatitem or drgtyp == ui_drag_type_pets) then 							
							petAttrinfo = GetChatPetAttr(drgtyp,drgidx);
							
							if(petAttrinfo ~= nil) then 
								for i=0, petAttrinfo.AttrNum - 1 do								
									if petAttrinfo[i].value < 0 then
										tempString = tempString.."/C21"..petAttrinfo[i].Attr.." + "..(-petAttrinfo[i].value).." "..petAttrinfo[i].Quality.."(已失效)\n";
									elseif petAttrinfo[i].value > 0 then  
										tempString = tempString.."/C17"..petAttrinfo[i].Attr.." + "..petAttrinfo[i].value.." "..petAttrinfo[i].Quality.."\n";
									end;
								end;
								
								if(petAttrinfo.shenweiAttrValue > 0) then
									tempString = tempString.."/C20神威属性已激活:"..petAttrinfo.shenweiAttrName.." +"..petAttrinfo.shenweiAttrValue.."\n";
								end;								
							end;
						end;	
							
						if drgtyp==ui_drag_type_ware_equip or drgtyp==ui_drag_type_chatitem then
							cmpinfo = GetCompareTip(drgtyp,drgidx);
							if cmpinfo~="" then
								cmpinfo = "/C01已装备\n\n/C00"..cmpinfo;
								info.desc = "/C16未装备\n\n/C00"..info.desc;
								
								Win_SetText("UI.gameui.ScrnChatTooltip.tipLeft",cmpinfo);
								Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipLeft",true);
								cmpTaoinfo = GetTaoZhuangDesc(drgtyp,drgidx,1);
								varyDressinfo = GetVaryDressDesc(drgtyp,drgidx,1);
								cmpringsoulinfo = GetRingInfo(drgtyp,drgidx,1);
								cmpwingsoulinfo = GetWingInfo(drgtyp,drgidx,1);
								cmpxieringinfo = GetXieRingInfo(drgtyp,drgidx,1);
								diaohuainfo = GetDiaoHuaInfo(drgtyp,drgidx,1);
								cmpneckringinfo = GetNeckRingInfo(drgtyp,drgidx,1);
								cmpcapsoulinfo = GetCapSoulInfo(drgtyp,drgidx,1);
								cmpfacesoulinfo = GetFaceSoulInfo(drgtyp,drgidx,1);
								cmpclothsoulinfo = GetClothSoulInfo(drgtyp,drgidx,1);
								cmphonorsoulinfo = GetHonorSoulInfo(drgtyp,drgidx,1);
								
								if varyDressinfo == "" then
									tempString1 = cmpTaoinfo;
								else
									tempString1 = varyDressinfo..cmpTaoinfo;
								end;
							
								tempString1 = tempString1..cmpringsoulinfo..cmpxieringinfo..cmpwingsoulinfo..cmpneckringinfo..cmpcapsoulinfo..cmpfacesoulinfo..cmpclothsoulinfo..cmphonorsoulinfo;
								
								if tempString1 ~= "" then
									tempString1 = tempString1.."\n\n"..diaohuainfo;
								else
									tempString1 = tempString1..diaohuainfo;
								end;
								
								if tempString1 ~= "" then
									Win_SetText("UI.gameui.ScrnChatTooltip.tipLeft2",tempString1);
									Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipLeft2",true);
								else
									Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipLeft2",false);
								end;
							end;
						end;

						if cmpinfo=="" then
							info.desc = "\n"..info.desc;	-- for miniclose btn
							Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipLeft",false);
							Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipLeft2",false);
						end;

						Win_SetText("UI.gameui.ScrnChatTooltip.tipRight",info.desc);
						--if drgtyp==ui_drag_type_equiped or drgtyp==ui_drag_type_ware_equip or drgtyp==ui_drag_type_chatitem then
							Taoinfo = GetTaoZhuangDesc(drgtyp,drgidx,0);
							mainvaryDressinfo = GetVaryDressDesc(drgtyp,drgidx,0);
							ringsoulinfo = GetRingInfo(drgtyp,drgidx,0);
							wingsoulinfo = GetWingInfo(drgtyp,drgidx,0);
							xieringinfo = GetXieRingInfo(drgtyp,drgidx,0);
							diaohuainfo = GetDiaoHuaInfo(drgtyp,drgidx,0);
							neckringinfo = GetNeckRingInfo(drgtyp,drgidx,0);
							capsoulinfo = GetCapSoulInfo(drgtyp,drgidx,0);
							facesoulinfo = GetFaceSoulInfo(drgtyp,drgidx,0);
							clothsoulinfo = GetClothSoulInfo(drgtyp,drgidx,0);
							honorsoulinfo = GetHonorSoulInfo(drgtyp,drgidx,0);
							
						if (drgtyp == ui_drag_type_chatitem or drgtyp == ui_drag_type_pets)and tempString ~= "" then
							tempString = tempString;
						else
							if mainvaryDressinfo == "" then
								tempString = Taoinfo;
							else
								tempString = mainvaryDressinfo..Taoinfo;
							end;
						
							local soulinfo = ringsoulinfo~=''and ringsoulinfo or wingsoulinfo~=''and wingsoulinfo or xieringinfo~=''and xieringinfo or neckringinfo ~='' and neckringinfo or capsoulinfo ~= '' and capsoulinfo or facesoulinfo ~= '' and facesoulinfo or clothsoulinfo ~= '' and clothsoulinfo or honorsoulinfo ~= '' and honorsoulinfo or "";
							tempString = tempString..soulinfo;
							
							if tempString ~= "" then
									tempString = tempString.."\n\n"..diaohuainfo;
							else
									tempString = diaohuainfo;
							end;
						end;
							if tempString ~= "" then
								Win_SetText("UI.gameui.ScrnChatTooltip.tipRight2",tempString);
								Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipRight2",true);
							else
								Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipRight2",false);
							end;
						--else 
							--Win_ShowWidget("UI.gameui.ScrnChatTooltip.tipRight2",false);
						--end;
						
						Win_AjustSelf("UI.gameui.ScrnChatTooltip");

						local rwidth, rheight = Win_GetSize("UI.gameui.ScrnChatTooltip.tipRight");
						
						local lwidth, lheight = Win_GetSize("UI.gameui.ScrnChatTooltip.tipLeft");
						local tipwidth = rwidth+lwidth;
						local tipheight = rheight;
						tipwidth = tipwidth * 2;
						if tipheight < lheight then
							tipheight = lheight;
						end;
						
						-- winrect 设置成1,1, 靠2个子widget的wgtstyle_static将鼠标事件传递给自己, 但是dragrect要放大，
						-- 否则 不能move， 最后得到结果，是所有的child widget的rect和dragrect的集合为move区域
						if Win_IsVisible("UI.gameui.ScrnChatTooltip.tipLeft") then
							Win_SetValue("UI.gameui.ScrnChatTooltip",tipwidth,value_channel_dragrect,2);
							Win_SetValue("UI.gameui.ScrnChatTooltip",tipheight,value_channel_dragrect,3);
							Win_SetValue("UI.gameui.ScrnChatTooltip",1,value_channel_winrect,2);
							Win_SetValue("UI.gameui.ScrnChatTooltip",1,value_channel_winrect,3);
						else
							Win_SetValue("UI.gameui.ScrnChatTooltip",rwidth,value_channel_dragrect,2);
							Win_SetValue("UI.gameui.ScrnChatTooltip",rheight,value_channel_dragrect,3);
							Win_SetValue("UI.gameui.ScrnChatTooltip",1,value_channel_winrect,2);
							Win_SetValue("UI.gameui.ScrnChatTooltip",1,value_channel_winrect,3);
						end;
		
						
						Win_AlignWidget("UI.gameui.ScrnChatTooltip.closebtn","UI.gameui.ScrnChatTooltip.tipRight",aligntype_winrect,alignstyle_right_in+alignstyle_top_in, -2, 2);
						
						result=1;
					end;
				end;
				return result;
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={0,0,20,19};
					defaultcancel=1,
					groupstop=2,
					updatemute=1,
				};

				tipRight=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },	
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,						
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=1,
					style=wgtstyle_static,
					
					patchrect={3,3,3,2},	
					
					patchdrawtype=patch_draw_type_scale,					
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
				
				tipRight2=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },	
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,						
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=1,
					style=wgtstyle_static,
					
					patchrect={3,3,3,2},	
					
					patchdrawtype=patch_draw_type_scale,					
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
				tipLeft=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=0,
					style=wgtstyle_static,
					
					patchrect={3,3,3,2},
					
					patchdrawtype=patch_draw_type_scale,					
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};

				tipLeft2=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=0,
					style=wgtstyle_static,
					
					patchrect={3,3,3,2},
					
					patchdrawtype=patch_draw_type_scale,					
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};				
			};
			
			
		};	
		
		--双TIPS显示
		ScrnTooltip=
		{
			type = "WIDGETLIST",
			rect={0,0,28,16},		
			drawcolor = { 255, 255, 255, 255 },
			sizeable=1,
			visible=0,
			initlayer=systooltip_layer,
			style=wgtstyle_customclose+wgtstyle_topmost,		
			edgecheck=edge_check_show+edge_check_auto,
			updatemute=1,
			itemmarginh=0,
			itemmarginv=0,	
			
			OnParseTooltip=function(drgtyp,drgidx,hsttype,hstidx,rx,ry)
				local result=0;
				if (drgtyp>=0) and (drgidx>=0) then
					local info=GetTooltip(drgtyp,drgidx,hsttype,hstidx,rx,ry);
					--[[if(drgtyp == ui_drag_type_equiped and TheEquipIsAwake(drgidx)) then 
						 local info1 = GetAwakeEquipAttr(drgidx);
						 local awakeEquipinfo="";
						
						--显示属性
						if(info1 ~= nil and info1.Num ~= 0) then
							for i = 0,info1.Num - 1 do 
								awakeEquipinfo = awakeEquipinfo..info1[i].Attr .." +"..info1[i].value1.."\n";
							end;
							
							info.desc = info.desc.."\n/C20觉醒属性:\n"..awakeEquipinfo.."/C17\n";
						 end;																
					end;--]]
									
					if(drgtyp == ui_drag_type_awakeequiped) then 
						if(GetAwakeEquipDesc(drgtyp,drgidx) ~= nil) then 
							local name,level,weight,sdec=GetAwakeEquipDesc(drgtyp,drgidx);
							info.desc = name .. "\n\n物品等级: "..level.."\n重量: " ..weight.."\n说明: " ..sdec;
						end;
					end;
					
					if info.desc~="" then
						Win_SetText("UI.gameui.ScrnTooltip.tipRight",info.desc);
							
						local rwidth, rheight = Win_GetSize("UI.gameui.ScrnTooltip.tipRight");
						local lwidth, lheight = Win_GetSize("UI.gameui.ScrnTooltip.tipLeft");
						local tipwidth = rwidth+lwidth;
						local tipheight = rheight;
						if tipheight < lheight then
							tipheight = lheight;
						end;						

						local cmpinfo="";
						local cmpTaoinfo="";
						local cmpringsoulinfo="";
						local cmpwingsoulinfo="";
						local varyDressinfo = "";
						local Taoinfo="";
						local mainvaryDressinfo="";
						local tempString = "";
						local tempString1 = "";
						local ringsoulinfo = "";
						local wingsoulinfo = "";
						local xieringinfo = "";
						local soulinfo = "";
						local diaohuaInfo = "";
						local neckringsoulinfo = "";
						local capsoulinfo = "";
						local facesoulinfo = "";
						local clothsoulinfo = "";
						local honorsoulinfo = "";
						local cmpneckringsoulinfo = "";
						local cmpcapsoulinfo = "";
						local cmpfacesoulinfo = "";
						local cmpclothsoulinfo = "";
						local cmphonorsoulinfo = "";
						local petAttrinfo = "";
						local shenweiAttr="";
						local petAttrinfo1 = "";
						local tempString2 = "";
						
						if drgtyp == ui_drag_type_safeshop or drgtyp == ui_drag_type_shopqueryshowlist or drgtyp == ui_drag_type_safeshopqueryshowlist or drgtyp == ui_drag_type_buylist  or drgtyp == ui_drag_type_selbuylist or drgtyp == ui_drag_type_shop or  drgtyp == ui_drag_type_safebuylist or drgtyp == ui_drag_type_deal_mine or drgtyp == ui_drag_type_deal_other or drgtyp == ui_drag_type_store or drgtyp == ui_drag_type_safeselbuylist then 							
							petAttrinfo1 = GetChatPetAttr(drgtyp,drgidx);
					
							if(petAttrinfo1 ~= nil) then 
								for i=0, petAttrinfo1.AttrNum - 1 do								
									if petAttrinfo1[i].value < 0 then
										tempString2 = tempString2.."/C21"..petAttrinfo1[i].Attr.." + "..(-petAttrinfo1[i].value).." "..petAttrinfo1[i].Quality.."(已失效)\n";
									elseif petAttrinfo1[i].value > 0 then  
										tempString2 = tempString2.."/C17"..petAttrinfo1[i].Attr.." + "..petAttrinfo1[i].value.." "..petAttrinfo1[i].Quality.."\n";
									end;
								end;

								if(petAttrinfo1.shenweiAttrValue > 0) then
									tempString2 = tempString2.."/C20神威属性已激活:"..petAttrinfo1.shenweiAttrName.." +"..petAttrinfo1.shenweiAttrValue.."\n";
								end;								
							end;
						end;			

						--if drgtyp==ui_drag_type_equiped or drgtyp == ui_drag_type_ware_equip or drgtyp == ui_drag_type_equipother then
							
							Taoinfo = GetTaoZhuangDesc(drgtyp,drgidx,0);
							mainvaryDressinfo = GetVaryDressDesc(drgtyp,drgidx,0);
							ringsoulinfo = GetRingInfo(drgtyp,drgidx,0);
							wingsoulinfo = GetWingInfo(drgtyp,drgidx,0);
							xieringinfo = GetXieRingInfo(drgtyp,drgidx,0);
							diaohuainfo = GetDiaoHuaInfo(drgtyp,drgidx,0);
							neckringsoulinfo = GetNeckRingInfo(drgtyp,drgidx,0);							
							capsoulinfo = GetCapSoulInfo(drgtyp,drgidx,0);
							facesoulinfo = GetFaceSoulInfo(drgtyp,drgidx,0);
							clothsoulinfo = GetClothSoulInfo(drgtyp,drgidx,0);
							honorsoulinfo = GetHonorSoulInfo(drgtyp,drgidx,0);
							
							if(drgtyp == ui_drag_type_pets) then 
							
								petAttrinfo = GetPetAttr(drgtyp,drgidx,0);
						
								if(petAttrinfo ~= nil) then 
									for i=0, petAttrinfo.AttrNum - 1 do								
										if petAttrinfo[i].value < 0 then
											tempString = tempString.."/C21"..petAttrinfo[i].Attr.." + "..(-petAttrinfo[i].value).." "..petAttrinfo[i].Quality.."(已失效)\n";
										elseif petAttrinfo[i].value > 0 then  
											tempString = tempString.."/C17"..petAttrinfo[i].Attr.." + "..petAttrinfo[i].value.." "..petAttrinfo[i].Quality.."\n";
										end;
									end;	
									
									if(petAttrinfo.shenweiAttrValue > 0) then
										tempString = tempString.."/C20神威属性已激活:"..petAttrinfo.shenweiAttrName.." +"..petAttrinfo.shenweiAttrValue.."\n";
									end;									
								end;							
							end;
							
							

							
							if drgtyp == ui_drag_type_pets then
								tempString = tempString;
							elseif (drgtyp == ui_drag_type_safeshop or drgtyp == ui_drag_type_safeshopqueryshowlist  or drgtyp == ui_drag_type_shopqueryshowlist or drgtyp == ui_drag_type_selbuylist or  drgtyp == ui_drag_type_buylist or drgtyp == ui_drag_type_shop or drgtyp == ui_drag_type_safebuylist or drgtyp == ui_drag_type_deal_mine or drgtyp == ui_drag_type_deal_other  or drgtyp == ui_drag_type_store or drgtyp == ui_drag_type_safeselbuylist ) and tempString2 ~="" then
								tempString = tempString2;
							else
								if mainvaryDressinfo == "" then
									tempString = Taoinfo;
								else
									tempString = mainvaryDressinfo..Taoinfo;
								end;
							

							soulinfo =ringsoulinfo~=''and ringsoulinfo or wingsoulinfo~=''and wingsoulinfo or xieringinfo~=''and xieringinfo or neckringsoulinfo ~= '' and neckringsoulinfo or capsoulinfo ~='' and capsoulinfo or facesoulinfo ~= '' and facesoulinfo or clothsoulinfo ~= '' and clothsoulinfo or honorsoulinfo ~= '' and honorsoulinfo or "";

							if tempString == "" then
								tempString = soulinfo;
							else
								tempString = tempString..soulinfo;
							end;
							
							
							if tempString ~= "" then
									tempString = tempString.."\n\n"..diaohuainfo;
								else
									tempString = diaohuainfo;
							end;
						end;			
						
						
							if tempString ~= "" then
								Win_SetText("UI.gameui.ScrnTooltip.tipRight2",tempString);
								Win_ShowWidget("UI.gameui.ScrnTooltip.tipRight2",true);
							else
								Win_ShowWidget("UI.gameui.ScrnTooltip.tipRight2",false);
							end;
						
						
						--end;
						if drgtyp==ui_drag_type_ware_equip then
							
							cmpinfo = GetCompareTip(drgtyp,drgidx);
							if cmpinfo~="" then
								if info.desc~="" then
								info.desc = "/C16未装备\n\n"..info.desc;
								Win_SetText("UI.gameui.ScrnTooltip.tipRight",info.desc);

									if tempString ~= "" then
										Win_SetText("UI.gameui.ScrnTooltip.tipRight2",tempString);
										Win_ShowWidget("UI.gameui.ScrnTooltip.tipRight2",true);
									else
										Win_ShowWidget("UI.gameui.ScrnTooltip.tipRight2",false);
									end;
								end;
							
								cmpinfo = "/C01已装备\n\n"..cmpinfo;
								Win_SetText("UI.gameui.ScrnTooltip.tipLeft",cmpinfo);
								Win_SetValue("UI.gameui.ScrnTooltip",tipwidth,value_channel_clientrect,2);
								Win_SetValue("UI.gameui.ScrnTooltip",tipheight,value_channel_clientrect,3);
								Win_ShowWidget("UI.gameui.ScrnTooltip.tipLeft",true);
								
								cmpTaoinfo = GetTaoZhuangDesc(drgtyp,drgidx,1);
								varyDressinfo = GetVaryDressDesc(drgtyp,drgidx,1);
								cmpringsoulinfo = GetRingInfo(drgtyp,drgidx,1);
								cmpwingsoulinfo = GetWingInfo(drgtyp,drgidx,1);
								cmpxieringinfo = GetXieRingInfo(drgtyp,drgidx,1);
								diaohuainfo = GetDiaoHuaInfo(drgtyp,drgidx,1);
								cmpneckringsoulinfo = GetNeckRingInfo(drgtyp,drgidx,1);
								cmpcapsoulinfo = GetCapSoulInfo(drgtyp,drgidx,1);
								cmpfacesoulinfo = GetFaceSoulInfo(drgtyp,drgidx,1);
								cmpclothsoulinfo = GetClothSoulInfo(drgtyp,drgidx,1);
								cmphonorsoulinfo = GetHonorSoulInfo(drgtyp,drgidx,1);
								if varyDressinfo == "" then
									tempString1 = cmpTaoinfo;
								else
									tempString1 = varyDressinfo..cmpTaoinfo;
								end;
								
								soulinfo = cmpringsoulinfo~=''and cmpringsoulinfo or cmpwingsoulinfo~=''and cmpwingsoulinfo or cmpxieringinfo~=''and cmpxieringinfo or cmpneckringsoulinfo ~= '' and cmpneckringsoulinfo or cmpcapsoulinfo ~='' and cmpcapsoulinfo or cmpfacesoulinfo ~= '' and cmpfacesoulinfo or cmpclothsoulinfo ~= '' and cmpclothsoulinfo or cmphonorsoulinfo ~= '' and cmphonorsoulinfo or "";
								if tempString1 == "" then
									tempString1 = soulinfo;
								else
									tempString1 = tempString1..soulinfo;
								end;

								if tempString1 ~= "" then
										tempString1 = tempString1.."\n\n"..diaohuainfo;
									else
										tempString1 = tempString1..diaohuainfo;
								end;								
								
								if tempString1 ~= "" then
									Win_SetText("UI.gameui.ScrnTooltip.tipLeft2",tempString1);
									Win_ShowWidget("UI.gameui.ScrnTooltip.tipLeft2",true);									
								else
								   Win_ShowWidget("UI.gameui.ScrnTooltip.tipLeft2",false);
								end;

							end;
						end;
					
						--if drgtyp~=ui_drag_type_equiped and drgtyp~=ui_drag_type_ware_equip and drgtyp ~= ui_drag_type_equipother then 
							--Win_ShowWidget("UI.gameui.ScrnTooltip.tipRight2",false);
						--end;
						
						if drgtyp~=ui_drag_type_ware_equip or cmpinfo=="" then
							Win_ShowWidget("UI.gameui.ScrnTooltip.tipLeft",false);
							Win_ShowWidget("UI.gameui.ScrnTooltip.tipLeft2",false);
							--
							Win_SetSize("UI.gameui.ScrnTooltip",rwidth,rheight);
							Win_SetValue("UI.gameui.ScrnTooltip",rwidth,value_channel_clientrect,2);
							Win_SetValue("UI.gameui.ScrnTooltip",rheight,value_channel_clientrect,3);
						end;
												
						Win_AjustSelf("UI.gameui.ScrnTooltip");
						result=1;
					end;
				end;
				return result;
			end;
				
			children=
			{
				tipRight=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },	
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,						
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=1,
					stype = wgtstyle_cleanwin,
					
					patchrect={3,3,3,2},
					
					patchdrawtype=patch_draw_type_scale,						
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
				
				tipRight2=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },	
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,						
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=1,
					stype = wgtstyle_cleanwin,
					
					patchrect={3,3,3,2},
					
					patchdrawtype=patch_draw_type_scale,						
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
				
				tipLeft=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=0,
					stype = wgtstyle_cleanwin,
					
					patchrect={3,3,3,2},	
					
					patchdrawtype=patch_draw_type_scale,						
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
				
				tipLeft2=
				{
					type = "LABEL",
					rect={0,0,28,16},		
					drawcolor = { 255, 255, 255, 255 },
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,
					marginh=12,
					marginv=6,
					maxwidth=200,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					groupstop=0,
					stype = wgtstyle_cleanwin,
					
					patchrect={3,3,3,2},	
					
					patchdrawtype=patch_draw_type_scale,						
			
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
				};
			
			};
		};	
		
	
		SysInfotip=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/infodlgbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_alphawin,
			richmode=ui_richmode_all,
			moveable=1,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
				
			OnParseInfotip=function(drgtyp,drgidx,hsttype,hstidx)
					   
				if (drgtyp>=0) and (drgidx>=0) then
					if drgtyp == ui_drag_type_magicstore then
						PutInPropertyGrid(drgidx);
					else
						local info=GetInfotip(drgtyp,drgidx,hsttype,hstidx);
						local sealinfo = GetSealInfo(drgtyp, drgidx);						
					
						Win_SetText("UI.gameui.SysInfotip.titlelabel",info.name);	
						Win_SetText("UI.gameui.SysInfotip.infolist.infolabel",info.desc);				
						Win_SetValue("UI.gameui.SysInfotip.infolist",1,value_channel_update_dirty);					   
								   
						Win_SetValue("UI.gameui.SysInfotip.itempic",drgtyp,value_channel_dragtype);					   
						Win_SetValue("UI.gameui.SysInfotip.itempic",drgidx,value_channel_dragindex);					   
						Win_SetValue("UI.gameui.lockontimedlg", info.cansoulbind, value_channel_customid);
					
						Win_ShowWidget("UI.gameui.SysInfotip.lockbtn", (info.lock>-1));
						Win_ShowWidget("UI.gameui.SysInfotip.sealbtn", (sealinfo.canseal>0)); --封印
						Win_ShowWidget("UI.gameui.SysInfotip.saddlebtn", (info.isSaddle>0)); --万能鞍橱
						
						--保存item的按时锁定状态
						if  info.lockontime==-1 then		--只有装备和宠物可以按时加锁
							Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", false);
							Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "");
							
							if info.uniqueID == 13507 then
								locktext = "/C01金额: "..info.storemoney.."金";
								Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", false);
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", locktext);
							end;
						elseif info.lockontime==0 then	--未被按时锁定
							Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", true);
							Win_EnableWidget("UI.gameui.SysInfotip.lockontimebtn", true);
						
							local locktext = "/C01该物品未被按时锁定。";
							if info.avtlocked1 == 1 and info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."未被按时锁定。";
							end;
							if info.avtlocked2 == 1 and info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 1 then
								locktext = locktext.."戒灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 1 then
								locktext = locktext.."戒灵未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 2 then
								locktext = locktext.."鞋灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 2 then
								locktext = locktext.."鞋灵未被按时锁定。";
							end;
							if info.uniqueID == 13507 then
								locktext = "/C01金额: "..info.storemoney.."金";
								Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", false);
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", locktext);
							end;
							Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", locktext);
							--[[if info.avtlocked == 1 then
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品未被按时锁定。变装被按时锁定 "..info.unlockavtTime.."自动解锁。/C00");
							else
								if info.hasavt ~= 0 then
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品未被按时锁定。变装未被按时锁定。/C00");
								else 
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品未被按时锁定。/C00");
							end;]]
						
						elseif info.lockontime==1 then	--被按时锁定
							Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", true);
							Win_EnableWidget("UI.gameui.SysInfotip.lockontimebtn", true);
							
							local locktext = "/C01该物品被按时锁定，"..info.unlocktime.."自动解锁。";
							if info.avtlocked1 == 1 and info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."未被按时锁定。";
							end;
							if info.avtlocked2 == 1 and info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 1 then
								locktext = locktext.."戒灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 1 then
								locktext = locktext.."戒灵未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 2 then
								locktext = locktext.."鞋灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 2 then
								locktext = locktext.."鞋灵未被按时锁定。";
							end;
							if info.uniqueID == 13507 then
								locktext = "/C01该物品被安全锁定,"..info.unlocktime.."自动解锁。";
								locktext = locktext.."\n流水号: "..info.flowID.."\n金额: "..info.storemoney.."金";
								Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", false);
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "");
							end;
							
							if info.flowID ~= 0 and info.uniqueID ~= 13507 then
								locktext = "/C01该物品被安全锁定,"..info.unlocktime.."自动解锁。";
								locktext = locktext.."\n流水号: "..info.flowID;
								Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", false);
								Win_ShowWidget("UI.gameui.SysInfotip.lockbtn", false);
								Win_ShowWidget("UI.gameui.SysInfotip.desclabel", false);
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "");
							end;
							Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", locktext);
							--[[if info.avtlocked == 1 then
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品被按时锁定，"..info.unlocktime.."自动解锁。变装被按时锁定 "..info.unlockavtTime.."自动解锁。/C00");
							else
								if info.hasavt ~= 0 then
									Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品被按时锁定，"..info.unlocktime.."自动解锁。变装未被按时锁定。/C00");
								else
									Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品被按时锁定，"..info.unlocktime.."自动解锁。/C00");
								end;
							end;]]
						elseif info.lockontime==2 then	--被灵魂锁定
							Win_ShowWidget("UI.gameui.SysInfotip.lockontimebtn", true);
							Win_EnableWidget("UI.gameui.SysInfotip.lockontimebtn", true);
							
							local locktext = "/C01该物品已被灵魂锁定，锁定期间加工等级+"..info.forgelvladd.."，"..info.unlocktime.."自动解锁。";
							if info.avtlocked1 == 1 and info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt1 > 0 then
								locktext = locktext.."变装"..info.avt1name.."未被按时锁定。";
							end;
							if info.avtlocked2 == 1 and info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."被按时锁定 "..info.unlockavtTime.."自动解锁。";
							elseif info.hasavt2 > 0 then
								locktext = locktext.."变装"..info.avt2name.."未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 1 then
								locktext = locktext.."戒灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 1 then
								locktext = locktext.."戒灵未被按时锁定。";
							end;
							if info.avtlockedring == 1 and info.hasavtring == 2 then
								locktext = locktext.."鞋灵被按时锁定 "..info.unlockavtTime.."自动解锁。/C00";
							elseif info.hasavtring == 2 then
								locktext = locktext.."鞋灵未被按时锁定。";
							end;
							Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", locktext);
							
							--[[if info.avtlocked == 1 then
								Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品已被灵魂锁定，锁定期间加工等级+"..info.forgelvladd.."，"..info.unlocktime.."自动解锁。变装被按时锁定"..info.unlockavtTime.."自动解锁。/C00");
							else
								if info.hasavt ~= 0 then
									Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品已被灵魂锁定，锁定期间加工等级+"..info.forgelvladd.."，"..info.unlocktime.."自动解锁。变装未被按时锁定。/C00");
								else
									Win_SetText("UI.gameui.SysInfotip.infolist.lockontimelabel", "/C01该物品已被灵魂锁定，锁定期间加工等级+"..info.forgelvladd.."，"..info.unlocktime.."自动解锁。/C00");
								end;
							end;]]
						end;
					
					
						if (Win_IsVisible("UI.gameui.SysInfotip.lockbtn") and Win_IsVisible("UI.gameui.SysInfotip.lockontimebtn")) then
							local	descText = "请通过设置道具/C01加锁/C00或者/C01按时锁定/C00保护您的虚拟财产安全"
							Win_SetText("UI.gameui.SysInfotip.desclabel",descText);
							Win_SetCheck("UI.gameui.SysInfotip.lockbtn",(info.lock>0));
						
							if Win_IsVisible("UI.gameui.SysInfotip.affirmdlg") then
								Win_ShowWidget("UI.gameui.SysInfotip.affirmdlg",false);
							end;
						elseif Win_IsVisible("UI.gameui.SysInfotip.lockbtn") then
							local	descText = "请通过设置道具/C01加锁/C00保护您的虚拟财产安全"
							Win_SetText("UI.gameui.SysInfotip.desclabel",descText);
							Win_SetCheck("UI.gameui.SysInfotip.lockbtn",(info.lock>0));
						
							if Win_IsVisible("UI.gameui.SysInfotip.affirmdlg") then
								Win_ShowWidget("UI.gameui.SysInfotip.affirmdlg",false);
							end;
						elseif Win_IsVisible("UI.gameui.SysInfotip.lockontimebtn") then
							local	descText = "请通过设置道具/C01按时锁定/C00保护您的虚拟财产安全"
							Win_SetText("UI.gameui.SysInfotip.desclabel",descText);
						end;
						
						--[[
						for i=0,4 do
						if i<info.nholes then					   
						Win_SetValue("UI.gameui.SysInfotip.infohole"..i,hsttype,value_channel_hosttype);
						Win_SetValue("UI.gameui.SysInfotip.infohole"..i,hstidx,value_channel_hostindex);
						Win_ShowWidget("UI.gameui.SysInfotip.infohole"..i,true);
						else
						Win_ShowWidget("UI.gameui.SysInfotip.infohole"..i,false);
						end;					   
						end;
						]]
						
						if info.nholes>0 then
							Win_RemoveStyle("UI.gameui.SysInfotip",wgtstyle_popup);
						else 
							Win_AddStyle("UI.gameui.SysInfotip",wgtstyle_popup);
						end;
			
						Win_SetFocus("UI.gameui.SysInfotip");
					end;
				
				end;			
															   
			end;
			
			OnSelfHide=function()
				Win_SetText("UI.gameui.SysInfotip.desclabel","");
				end;
			
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={54,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
			
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={235,21,20,19};
					defaultcancel=1,
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 213,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				lockbtn=
				{
					type="CHECK";
					bkimage="res/uires/sysinfotip/locksecubtn.gsa";
					rect={170,103,50,22};
					framescheme={{0,1,2,3},{4,5,6,7}},
					tiptext="切换道具锁定状态";
					updatemute=1,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.SysInfotip.lockbtn") then
							Win_ShowWidget("UI.gameui.SysInfotip.affirmdlg",true);
						else
							local drgtyp = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragtype);					   
							local drgidx = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragindex);	
							ToggleSecuLock(drgtyp, drgidx);
							Win_ShowWidget("UI.gameui.SysInfotip",false);
						end;
					end;
				};
				
				--万能鞍橱
				saddlebtn=
				{
					type="BUTTON";
					bkimage="res/uires/supersaddle/saddlebtn.gsa";
					rect={148,99,86,22};
					tiptext="万能鞍橱";
					updatemute=1,
					
					OnClick=function()	
						Win_ShowWidget("UI.gameui.SysInfotip", false);				
						Win_ShowWidget("UI.gameui.supersaddledlg", true);
					end;				
				};
				
				lockontimebtn=
				{
					--type="CHECK";
					type="BUTTON";
					bkimage="res/uires/sysinfotip/lockontimebtn.gsa";
					rect={148,123,86,22};
					tiptext="按时锁定物品";
					updatemute=1,
					
					OnClick=function()
						local info=Win_GetText("UI.gameui.SysInfotip.titlelabel");
						Win_SetText("UI.gameui.lockontimedlg",  info, value_channel_customtext);
						
						local drgtyp = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragtype);					   
						local drgidx = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragindex);	
						Win_SetValue("UI.gameui.lockontimedlg", drgtyp, value_channel_customtype);
						Win_SetValue("UI.gameui.lockontimedlg", drgidx, value_channel_customindex);
						
						Win_ShowWidget("UI.gameui.SysInfotip", false);
						Win_ShowWidget("UI.gameui.lockontimedlg", true);	
					end;				
				};
				
				sealbtn=
				{
					--防盗封印
					type="BUTTON";
					bkimage="res/uires/sysinfotip/sealbtn.gsa";
					rect={147,146,86,22};
					tiptext="防盗封印";
					updatemute=1,
					
					OnClick=function()					
						local drgtyp = Win_GetValue("UI.gameui.SysInfotip.itempic", value_channel_dragtype);					   
						local drgidx = Win_GetValue("UI.gameui.SysInfotip.itempic", value_channel_dragindex);	
						Win_SetValue("UI.gameui.sealmaindlg", drgtyp, value_channel_customtype);
						Win_SetValue("UI.gameui.sealmaindlg", drgidx, value_channel_customindex);
						
						Win_ShowWidget("UI.gameui.SysInfotip", false);
						Win_ShowWidget("UI.gameui.sealmaindlg", true);
					end;				
				};
				
				itempic=
				{
					type="WIDGET",
					rect={39,52,91,120},		
					dragtype=0,
					dragindex=0,
					style=wgtstyle_static+wgtstyle_renderitem,
					customstate=ui_custom_state_large,
					updatemute=1,
				},				
								
				--[[
				infohole0=
				{
					type="WIDGET",					
					rect={4,296,36,36};
					bkimage="res/uires/common/infohole.gsa",	
					dragtype=ui_drag_type_itemhole,
					dragindex=0,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				};
				infohole1=
				{
					type="WIDGET",
					rect={40,296,36,36};
					bkimage="res/uires/common/infohole.gsa",
					dragtype=ui_drag_type_itemhole,
					dragindex=1,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",					
					updatemute=1,
				};
				infohole2=
				{
					type="WIDGET",
					rect={76,296,36,36};
					bkimage="res/uires/common/infohole.gsa",	
					dragtype=ui_drag_type_itemhole,
					dragindex=2,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",					
					updatemute=1,
				};
				infohole3=
				{
					type="WIDGET",
					rect={112,296,36,36};
					bkimage="res/uires/common/infohole.gsa",					
					dragtype=ui_drag_type_itemhole,
					dragindex=3,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				};
				infohole4=
				{
					type="WIDGET",
					rect={148,296,36,36};
					bkimage="res/uires/common/infohole.gsa",					
					dragtype=ui_drag_type_itemhole,
					dragindex=4,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				};
				]]
				
				desclabel=
				{
					type="LABEL",
					rect={135,52,114,55},					
					textsize=12,
					rowspace=6,
					marginh=3,
					textstyle=dt_left,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},

				infolist=
				{
					type="WIDGETLIST",
					rect={52,185,181,114},
					
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static,
					updatemute=1,
					
					primaryscroll="UI.gameui.SysInfotip.vscroll",
										
					children=
					{
						--说明
						infolabel=
						{
							type="LABEL",
							rect={0,0,181,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=0,
							marginv=6,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
						
						lockontimelabel=
						{
							type="LABEL",
							rect={20,0,181,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=0,
							marginv=3,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
					},-- children
					
				},

				vscroll=
				{
			
					type="SCROLLBAR",
					rect={232,203,20,77},			
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",						
					
					buddywidget="UI.gameui.SysInfotip.infolist",

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",									
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				affirmdlg=
				{
					type="DIALOG";
					rect={0,0,346,128};
					bkimage="res/uires/common/msgboxbk.gsa";
					aligntype=aligntype_father+aligntype_clientrect,
					alignstyle=alignstyle_vcenter+alignstyle_hcenter,
					style=wgtstyle_topmost,
					initlayer=msgbox_layer,
					visible=0,
					updatemute=1,
				
					OnOk=function()
						local drgtyp = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragtype);					   
						local drgidx = Win_GetValue("UI.gameui.SysInfotip.itempic",value_channel_dragindex);	
						ToggleSecuLock(drgtyp, drgidx);
						Win_ShowWidget("UI.gameui.SysInfotip",false);
						Win_ShowWidget("UI.gameui.SysInfotip.affirmdlg",false);
						end;
						
					OnCancel=function()
						Win_ShowWidget("UI.gameui.SysInfotip",false);
						Win_ShowWidget("UI.gameui.SysInfotip.affirmdlg",false);
						end;
					
					OnSelfShow=function()
						Win_SetValue("UI.gameui.SysInfotip",0,value_channel_moveable,0);
						Win_SetValue("UI.gameui.SysInfotip",0,value_channel_moveable,1);
						end;
						
					OnSelfHide=function()
						Win_SetValue("UI.gameui.SysInfotip",1,value_channel_moveable,0);
						Win_SetValue("UI.gameui.SysInfotip",1,value_channel_moveable,1);
						end;
			
					children=
					{
						affirmbtn=
						{
							type="BUTTON",
							rect={73,97,70,22},
							bkimage="res/uires/common/affirmbtn.gsa",
							defaultok=1,
							soundid={1005},			
						},
				
						cancelbtn=
						{
							
							type="BUTTON",
							rect={206,97,70,22},
							bkimage="res/uires/common/cancelbtn.gsa",	
							defaultcancel=1,
							soundid={1007},
						},
				
						pswlabel=
						{
							type="LABEL",
							captionrect={38,24,276,32};
							caption="锁定物品需要扣除20银币，您确定要执行操作吗？",
							textsize=12,
						},
					};
				};
			};
		};
		
		-- 按时锁定
		lockontimedlg=
		{
			type = "DIALOG",	
			rect={0,0,400,363},
			bkimage="res/uires/sysinfotip/locktimedlgbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			richmode=ui_richmode_all,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,

			OnSelfShow=function()
				Win_SetCheck("UI.gameui.lockontimedlg.lockmode0", true);
				Win_SetCheck("UI.gameui.lockontimedlg.lockmode1", false);
				Win_SetCheck("UI.gameui.lockontimedlg.lockmode2", false);
				Win_SetCheck("UI.gameui.lockontimedlg.lockmode3", false);
				--Win_SetCheck("UI.gameui.lockontimedlg.lockmode4", false);
				Win_SetCapture("UI.gameui.lockontimedlg");
				local cansoulbind = Win_GetValue("UI.gameui.lockontimedlg", value_channel_customid);
				if cansoulbind == 0 then
					Win_SetText("UI.gameui.lockontimedlg.infolbl", "(当前道具可以被灵魂锁定)");
					Win_EnableWidget("UI.gameui.lockontimedlg.lockmode3", true);
					--Win_EnableWidget("UI.gameui.lockontimedlg.lockmode4", true);
				elseif cansoulbind == 1 then
					Win_SetText("UI.gameui.lockontimedlg.infolbl", "(当前道具不能被灵魂锁定)");
					Win_EnableWidget("UI.gameui.lockontimedlg.lockmode3", false);
					--Win_EnableWidget("UI.gameui.lockontimedlg.lockmode4", false);
				end;
			end;
			
			children=
			{
				infolbl=
				{
					type="LABEL",
					rect={211,41,175,16};
					drawcolor = { 255, 0, 0, 255 },							
					textsize=12;
					textstyle=dt_center+dt_vcenter;
					enable=1;
				},
				lockmode0= 
				{
					type = "CHECK",
					rect={26,75,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				lockmode1= 
				{
					type = "CHECK",
					rect={26,104,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
	
				lockmode2= 
				{
					type = "CHECK",
					rect={26,133,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				lockmode3= 
				{
					type = "CHECK",
					rect={26,162,310,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=3,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				--[[lockmode4= 
				{
					type = "CHECK",
					rect={53,159,310,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=4,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},--]]
				lockbtn=
				{
					type="BUTTON",
					rect={89,329,69,24},
					bkimage="res/uires/sysinfotip/locktimebtn.gsa",
					soundid={1005},		
	
					OnClick=function()
						local info=Win_GetText("UI.gameui.lockontimedlg", value_channel_customtext);
						info="您要锁定 /C01"..info.."/C00 ";
						local needMoney;
						if Win_IsChecked("UI.gameui.lockontimedlg.lockmode0") then
							info=info.."7天吗？";
							needMoney=200*1000;
							Win_SetValue("UI.gameui.lockontimedlg.lockbtn", 0, value_channel_customid);
						elseif Win_IsChecked("UI.gameui.lockontimedlg.lockmode1") then
							info=info.."30天吗？";
							needMoney=500*1000;
							Win_SetValue("UI.gameui.lockontimedlg.lockbtn", 1, value_channel_customid);
						elseif Win_IsChecked("UI.gameui.lockontimedlg.lockmode2") then
							info=info.."90天吗？";
							needMoney=1*1000*1000;
							Win_SetValue("UI.gameui.lockontimedlg.lockbtn", 2, value_channel_customid);
						elseif Win_IsChecked("UI.gameui.lockontimedlg.lockmode3") then
							info=info.."180天吗？";
							Win_SetValue("UI.gameui.lockontimedlg.lockbtn", 3, value_channel_customid);
						elseif Win_IsChecked("UI.gameui.lockontimedlg.lockmode4") then
							info=info.."360天吗？";
							Win_SetValue("UI.gameui.lockontimedlg.lockbtn", 4, value_channel_customid);
						end;
						
					--	if needMoney>GetMoney() then
					--		Win_ShowMsgBox("您的金币不足，无法按时锁定！","系统消息",ui_msgid_affirm,"UI.gameui.lockontimedlg.lockbtn");
					--	else
							Win_ShowMsgBox(info,"系统消息",ui_msgid_yesno,"UI.gameui.lockontimedlg.lockbtn");
					--	end;
					end;
					
					OnMsgBoxOk=function()
						local drgtyp=Win_GetValue("UI.gameui.lockontimedlg", value_channel_customtype);
						local drgidx=Win_GetValue("UI.gameui.lockontimedlg", value_channel_customindex);
						local locktype=Win_GetValue("UI.gameui.lockontimedlg.lockbtn", value_channel_customid);
						--请求按时锁定
						LockItemOnTime(drgtyp, drgidx, locktype);
						
						Win_ShowWidget("UI.gameui.lockontimedlg", false);
					end;
					
					OnMsgBoxCancel=function()
						Win_SetCapture("UI.gameui.lockontimedlg");
					end;
				};
		
				cancelbtn=
				{
					type="BUTTON",
					rect={252,330,69,24},
					bkimage="res/uires/sysinfotip/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				};
			};
		};
		
		
		-- 封印主框
		sealmaindlg=
		{
			type = "DIALOG",	
			rect={0,0,400,363},
			bkimage="res/uires/sysinfotip/sealmainbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,

			OnSelfShow=function()
				Win_SetText("UI.gameui.sealmaindlg.titlelabel", "防盗封印");
				Win_SetFocus("UI.gameui.sealmaindlg");
				Win_SetCapture("UI.gameui.sealmaindlg");
				--封印
				local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
				local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
				local info = GetSealInfo(drgtyp, drgidx);
				local strdesc = "";
				local unsealdays = 3;
				local remaindays = math.floor(info.unsealremain / 86400);
				local remainhours = math.floor( (info.unsealremain - remaindays * 86400) / 3600 );
				local remainminutes = math.floor( (info.unsealremain - remaindays * 86400 - remainhours * 3600) / 60 );
				
				if info.unsealtimetype == 1 then
					unsealdays = 3;
				elseif info.unsealtimetype == 2 then
					unsealdays = 10;
				elseif info.unsealtimetype == 3 then
					unsealdays = 30;
				end;
				
				if info.seallevel == 0 then
					strdesc = "/C01该物品目前未封印。";
					
					Win_EnableWidget("UI.gameui.sealmaindlg.locksealbtn", true);
					Win_EnableWidget("UI.gameui.sealmaindlg.unlocksealbtn", false);
					Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", false);
					Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", false);
					Win_EnableWidget("UI.gameui.sealmaindlg.cancelunlocksealbtn", false);
				elseif info.seallevel == 1 then
					if info.inunseal == 0 then
						strdesc = "/C01该物品目前为一级封印，解封期为" .. unsealdays .. "天，目前不在解封期内。";
						
						Win_EnableWidget("UI.gameui.sealmaindlg.locksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.unlocksealbtn", true);
						Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", true);

						Win_EnableWidget("UI.gameui.sealmaindlg.cancelunlocksealbtn", false);						
						if info.unsealtimetype == 3 then
							Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", false);
						else
							Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", true);
						end;						
					else
						strdesc = "/C01该物品目前为一级封印，解封期为" .. unsealdays .. "天，目前在解封期内，剩余时间为" .. remaindays .. "天" .. remainhours .. "小时" .. remainminutes .. "分。";
						
						Win_EnableWidget("UI.gameui.sealmaindlg.locksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.unlocksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.cancelunlocksealbtn", true);
						Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", true);
					end;
				elseif info.seallevel == 2 then
					if info.inunseal == 0 then
						strdesc = "/C01该物品目前为二级封印，解封期为" .. unsealdays .. "天，目前不在解封期内。";
						
						Win_EnableWidget("UI.gameui.sealmaindlg.locksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.unlocksealbtn", true);
						Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", false);

						Win_EnableWidget("UI.gameui.sealmaindlg.cancelunlocksealbtn", false);
						if info.unsealtimetype == 3 then
							Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", false);
						else
							Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", true);
						end;						
					else
						if info.inunsealtoone == 1 then
							strdesc = "/C01该物品目前为二级封印，解封期为" .. unsealdays .. "天，目前在解封至一级中，剩余时间为" .. remaindays .. "天" .. remainhours .. "小时" .. remainminutes .. "分。";
						else
							strdesc = "/C01该物品目前为二级封印，解封期为" .. unsealdays .. "天，目前在解封期内，剩余时间为" .. remaindays .. "天" .. remainhours .. "小时" .. remainminutes .. "分。";
						end;
						
						Win_EnableWidget("UI.gameui.sealmaindlg.locksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.unlocksealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", false);
						Win_EnableWidget("UI.gameui.sealmaindlg.cancelunlocksealbtn", true);						
						Win_EnableWidget("UI.gameui.sealmaindlg.delaysealbtn", true);
					end;
				end;
				
				--变装只有一级封印，不能升级
				if info.sealitemtype == 0 then
					Win_EnableWidget("UI.gameui.sealmaindlg.upsealbtn", false);
				end;
							
				Win_SetText("UI.gameui.sealmaindlg.desclabel", strdesc);
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={54,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={233,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 211,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				desclabel=
				{
					type="LABEL",
					rect={45,57,195,55},					
					textsize=12,
					rowspace=6,
					marginh=3,
					textstyle=dt_left,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},

				locksealbtn=
				{
					-- 封印
					type="BUTTON",
					rect={95,107,88,24},
					bkimage="res/uires/sysinfotip/locksealbtn.gsa",	
					
					OnClick=function()					
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
						
						if info.sealitemtype == 0 then
							Win_SetValue("UI.gameui.SelectLevelAvatarDlg", drgtyp, value_channel_customtype);
							Win_SetValue("UI.gameui.SelectLevelAvatarDlg", drgidx, value_channel_customindex);
							Win_ShowWidget("UI.gameui.SelectLevelAvatarDlg", true);	
						elseif info.sealitemtype == 1 then
							Win_SetValue("UI.gameui.SelectLevelPetDlg", drgtyp, value_channel_customtype);
							Win_SetValue("UI.gameui.SelectLevelPetDlg", drgidx, value_channel_customindex);
							Win_ShowWidget("UI.gameui.SelectLevelPetDlg", true);							
						else
							Win_SetValue("UI.gameui.SelectLevelEquipDlg", drgtyp, value_channel_customtype);
							Win_SetValue("UI.gameui.SelectLevelEquipDlg", drgidx, value_channel_customindex);
							Win_ShowWidget("UI.gameui.SelectLevelEquipDlg", true);							
						end;
						
						Win_ShowWidget("UI.gameui.sealmaindlg", false);
					end;					
				};
				
				unlocksealbtn=
				{
					-- 解除封印
					type="BUTTON",
					rect={95,137,88,24},
					bkimage="res/uires/sysinfotip/unlocksealbtn.gsa",	
					
					OnClick=function()
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						
						Win_SetValue("UI.gameui.UnlockSealDlg", drgtyp, value_channel_customtype);
						Win_SetValue("UI.gameui.UnlockSealDlg", drgidx, value_channel_customindex);

						Win_ShowWidget("UI.gameui.UnlockSealDlg", true);
						Win_ShowWidget("UI.gameui.sealmaindlg", false);
					end;					
				};

				upsealbtn=
				{
					-- 封印升级
					type="BUTTON",
					rect={95,167,88,24},
					bkimage="res/uires/sysinfotip/upsealbtn.gsa",	
					
					OnClick=function()	
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
						local strmsg = "";

						if info.sealitemtype == 1 then -- 宠物
							strmsg = "是否要将该物品升级为二级封印？二级封印不可交易、丢弃、摆摊、安全摆摊、邮寄、卖NPC、放入家族仓库、培养、使用可改变宠物的道具。封印升级后立即生效。";
						elseif info.sealitemtype == 2 then -- 装备
							strmsg = "是否要将该物品升级为二级封印？二级封印不可交易、丢弃、摆摊、安全摆摊、邮寄、卖NPC、放入家族仓库、提取变装、加工、升级、打孔、提升品质、镶嵌、合成、印刻、兑换、附魂、拆解。封印升级后立即生效。";
						end;
						
						Win_ShowMsgBox(strmsg, "系统消息", ui_msgid_yesno, "UI.gameui.sealmaindlg.upsealbtn");
					end;
					
					OnMsgBoxOk=function()
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
						
						--请求升级
						LockItemSeal(drgtyp, drgidx, 2, 2, info.unsealtimetype);
						
						Win_ShowWidget("UI.gameui.sealmaindlg", false);
					end;
					
					OnMsgBoxCancel=function()
					end;					
				};
				
				delaysealbtn=
				{
					-- 延长解封期
					type="BUTTON",
					rect={95,197,88,24},
					bkimage="res/uires/sysinfotip/delaysealbtn.gsa",	
					
					OnClick=function()
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
						
						if info.inunseal > 0 then -- 在解封期
							Win_SetText("UI.gameui.DelayUnlockDlg1.titlelabel", "延长解封期 - 解封中");
							Win_SetValue("UI.gameui.DelayUnlockDlg1", drgtyp, value_channel_customtype);
							Win_SetValue("UI.gameui.DelayUnlockDlg1", drgidx, value_channel_customindex);
												
							Win_ShowWidget("UI.gameui.DelayUnlockDlg1", true);							
						else -- 在封印状态
							Win_SetText("UI.gameui.DelayUnlockDlg2.titlelabel", "延长解封期 - 封印状态");
								
							Win_SetValue("UI.gameui.DelayUnlockDlg2", drgtyp, value_channel_customtype);
							Win_SetValue("UI.gameui.DelayUnlockDlg2", drgidx, value_channel_customindex);
												
							if info.unsealtimetype == 1 then
								Win_EnableWidget("UI.gameui.DelayUnlockDlg2.delaymode1", true);
								Win_EnableWidget("UI.gameui.DelayUnlockDlg2.delaymode2", true);
								Win_SetCheck("UI.gameui.DelayUnlockDlg2.delaymode1", true);
								Win_SetCheck("UI.gameui.DelayUnlockDlg2.delaymode2", false);								
							elseif info.unsealtimetype == 2 then
								Win_EnableWidget("UI.gameui.DelayUnlockDlg2.delaymode1", false);
								Win_EnableWidget("UI.gameui.DelayUnlockDlg2.delaymode2", true);		
								Win_SetCheck("UI.gameui.DelayUnlockDlg2.delaymode1", false);
								Win_SetCheck("UI.gameui.DelayUnlockDlg2.delaymode2", true);								
							end;
							
							Win_ShowWidget("UI.gameui.DelayUnlockDlg2", true);
						end;

						Win_ShowWidget("UI.gameui.sealmaindlg", false);	
					end;					
				};					
				
				cancelunlocksealbtn=
				{
					-- 取消解封
					type="BUTTON",
					rect={95,227,88,24},
					bkimage="res/uires/sysinfotip/cancelunlocksealbtn.gsa",	
					
					OnClick=function()	
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
						local strmsg = "该物品目前在解封期内，解封结束时间为" .. info.unsealtime .. "，是否要取消解封？取消后该物品恢复为封印状态，再次解封则解封时间重新计算。";
						
						Win_ShowMsgBox(strmsg, "系统消息", ui_msgid_yesno, "UI.gameui.sealmaindlg.cancelunlocksealbtn");
					end;
					
					OnMsgBoxOk=function()
						local drgtyp = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customtype);
						local drgidx = Win_GetValue("UI.gameui.sealmaindlg", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
											
						
						--请求取消解封
						LockItemSeal(drgtyp, drgidx, 4, info.seallevel, info.unsealtimetype);
						
						Win_ShowWidget("UI.gameui.sealmaindlg", false);
					end;
					
					OnMsgBoxCancel=function()
					end;
					
				};					
			};
		};
		
		-- 选择封印等级[for 变装]
		SelectLevelAvatarDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/selectlevelavatarbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.SelectLevelAvatarDlg");
				Win_SetCapture("UI.gameui.SelectLevelAvatarDlg");
				Win_SetCheck("UI.gameui.SelectLevelAvatarDlg.levelcheck", true);
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={74,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={273,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 250,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				levelcheck= 
				{
					type = "CHECK",
					rect={34,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
							
				nextbtn=
				{
					type="BUTTON",
					rect={117,140,88,24},
					bkimage="res/uires/sysinfotip/nextbtn.gsa",	
					
					OnClick=function()	
						local drgtyp = Win_GetValue("UI.gameui.SelectLevelAvatarDlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.SelectLevelAvatarDlg", value_channel_customindex);
						
						nottodo = "交易、丢弃、摆摊、邮寄、卖NPC、放入家族仓库、兑换合成";
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgtyp, value_channel_customtype);				   
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgidx, value_channel_customindex);
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", 1, value_channel_customid);
						Win_SetText("UI.gameui.SelectUnlockTypeDlg", nottodo, value_channel_customtext);
						
						Win_ShowWidget("UI.gameui.SelectUnlockTypeDlg", true);
						Win_ShowWidget("UI.gameui.SelectLevelAvatarDlg", false);
					end;					
				};				
			};
		};
		
		-- 选择封印等级[for 宠物]
		SelectLevelPetDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/selectlevelpetbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.SelectLevelPetDlg");
				Win_SetCapture("UI.gameui.SelectLevelPetDlg");
				Win_SetCheck("UI.gameui.SelectLevelPetDlg.levelcheck1", true);
				Win_SetCheck("UI.gameui.SelectLevelPetDlg.levelcheck2", false);
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={54,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={273,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 250,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				levelcheck1= 
				{
					type = "CHECK",
					rect={34,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				levelcheck2= 
				{
					type = "CHECK",
					rect={34,200,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				nextbtn=
				{
					type="BUTTON",
					rect={120,272,88,24},
					bkimage="res/uires/sysinfotip/nextbtn.gsa",	
					
					OnClick=function()
						local drgtyp = Win_GetValue("UI.gameui.SelectLevelPetDlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.SelectLevelPetDlg", value_channel_customindex);
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgtyp, value_channel_customtype);				   
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgidx, value_channel_customindex);
						
						local nottodo = "";
						local unlocktype = 1;
						if Win_IsChecked("UI.gameui.SelectLevelPetDlg.levelcheck1") then
							nottodo = "交易、丢弃、摆摊、邮寄、卖NPC、放入家族仓库";
							unlocktype = 1;
						else
							nottodo = "交易、丢弃、摆摊、安全摆摊、邮寄、卖NPC、放入家族仓库、培养、使用可改变宠物的道具";
							--nottodo = nottodo .. "(易筋洗髓丸、高级易筋洗髓丸、七巧玲珑心、希瞳的爱、宝宝经验珠、宝宝初元丹、宠爱PP果、宠物书、宠物丸子、乾坤盘)";
							unlocktype = 2;
						end;
							
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", unlocktype, value_channel_customid);
						Win_SetText("UI.gameui.SelectUnlockTypeDlg", nottodo, value_channel_customtext);
					
						Win_ShowWidget("UI.gameui.SelectUnlockTypeDlg", true);
						Win_ShowWidget("UI.gameui.SelectLevelPetDlg", false);
					end;					
				};				
			};
		};
		
		-- 选择封印等级[for 装备]
		SelectLevelEquipDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/selectlevelequipbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.SelectLevelEquipDlg");
				Win_SetCapture("UI.gameui.SelectLevelEquipDlg");
				Win_SetCheck("UI.gameui.SelectLevelEquipDlg.levelcheck1", true);
				Win_SetCheck("UI.gameui.SelectLevelEquipDlg.levelcheck2", false);
			end;
			
			children=
			{			
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={273,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 250,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				levelcheck1= 
				{
					type = "CHECK",
					rect={34,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				levelcheck2= 
				{
					type = "CHECK",
					rect={34,200,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				nextbtn=
				{
					type="BUTTON",
					rect={120,272,88,24},
					bkimage="res/uires/sysinfotip/nextbtn.gsa",	
					
					OnClick=function()	
						local drgtyp = Win_GetValue("UI.gameui.SelectLevelEquipDlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.SelectLevelEquipDlg", value_channel_customindex);
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgtyp, value_channel_customtype);				   
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", drgidx, value_channel_customindex);
						
						local nottodo = "";
						local unlocktype = 1;
						if Win_IsChecked("UI.gameui.SelectLevelEquipDlg.levelcheck1") then
							nottodo = "交易、丢弃、摆摊、邮寄、卖NPC、放入家族仓库、提取变装、拆解";
							unlocktype = 1;
						else
							nottodo = "交易、丢弃、摆摊、安全摆摊、邮寄、卖NPC、放入家族仓库、提取变装、加工、升级、打孔、提升品质、镶嵌、合成、印刻、兑换、附魂、拆解";
							unlocktype = 2;
						end;
							
						Win_SetValue("UI.gameui.SelectUnlockTypeDlg", unlocktype, value_channel_customid);
						Win_SetText("UI.gameui.SelectUnlockTypeDlg", nottodo, value_channel_customtext);
					
						Win_ShowWidget("UI.gameui.SelectUnlockTypeDlg", true);
						Win_ShowWidget("UI.gameui.SelectLevelEquipDlg", false);
					end;					
				};				
			};
		};
		
		-- 选择解封期
		SelectUnlockTypeDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/selectunlockbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.SelectUnlockTypeDlg");
				Win_SetCapture("UI.gameui.SelectUnlockTypeDlg");
				Win_SetCheck("UI.gameui.SelectUnlockTypeDlg.checkmode1", true);
				Win_SetCheck("UI.gameui.SelectUnlockTypeDlg.checkmode2", false);
				Win_SetCheck("UI.gameui.SelectUnlockTypeDlg.checkmode3", false);
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={94,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={275,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				checkmode1= 
				{
					type = "CHECK",
					rect={32,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				checkmode2= 
				{
					type = "CHECK",
					rect={32,156,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				checkmode3= 
				{
					type = "CHECK",
					rect={32,222,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={130,275,75,26},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()
						local drgtyp = Win_GetValue("UI.gameui.SelectUnlockTypeDlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.SelectUnlockTypeDlg", value_channel_customindex);
						local seallevel = Win_GetValue("UI.gameui.SelectUnlockTypeDlg", value_channel_customid);
						local nottodo = Win_GetText("UI.gameui.SelectUnlockTypeDlg", value_channel_customtext);
						
						local strunlocktype = "一";
						if seallevel == 2 then
							strunlocktype = "二";
						end;
					
						local unlockday = 3;
						if Win_IsChecked("UI.gameui.SelectUnlockTypeDlg.checkmode2") then
							unlockday = 10;
						elseif Win_IsChecked("UI.gameui.SelectUnlockTypeDlg.checkmode3") then
							unlockday = 30;
						end;
						
						local unsealtimetype = 1;
						if Win_IsChecked("UI.gameui.SelectUnlockTypeDlg.checkmode2") then
							unsealtimetype = 2;
						elseif Win_IsChecked("UI.gameui.SelectUnlockTypeDlg.checkmode3") then
							unsealtimetype = 3;
						end;
						
						local strmsg = "已选择对该物品进行" .. strunlocktype .. "级封印，解封期" .. unlockday .. "天。封印期间该道具不可" .. nottodo .. "。是否确认进行防盗封印？";
						
						Win_SetText("UI.gameui.SealAffirmDlg.desclabel", strmsg);
						Win_SetValue("UI.gameui.SealAffirmDlg", drgtyp, value_channel_customtype);				   
						Win_SetValue("UI.gameui.SealAffirmDlg", drgidx, value_channel_customindex);
						Win_SetValue("UI.gameui.SealAffirmDlg", seallevel, value_channel_customid);
						Win_SetValue("UI.gameui.SealAffirmDlg", unsealtimetype, value_channel_customstate);
						
						Win_ShowWidget("UI.gameui.SealAffirmDlg", true);
						Win_ShowWidget("UI.gameui.SelectUnlockTypeDlg", false);

					end; 
				},	
			};
		};
		
		-- 封印确认
		SealAffirmDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/sealconfirmbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.SealAffirmDlg");
				Win_SetCapture("UI.gameui.SealAffirmDlg");
			end;
			
			OnSelfHide=function()
			end;
			
			children=
			{
				desclabel=
				{
					type="LABEL",
					rect={30,30,297,142},					
					textsize=12,
					rowspace=6,
					marginh=3,
					textstyle=dt_left,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				okbtn=
				{
					type="BUTTON";
					bkimage="res/uires/sysinfotip/confirmbtn.gsa";
					rect={90,183,75,26},
					defaultok=1,
					
					OnClick=function()
						local drgtyp=Win_GetValue("UI.gameui.SealAffirmDlg", value_channel_customtype);
						local drgidx=Win_GetValue("UI.gameui.SealAffirmDlg", value_channel_customindex);
						local seallevel = Win_GetValue("UI.gameui.SealAffirmDlg", value_channel_customid);	
						local unsealtimetype = Win_GetValue("UI.gameui.SealAffirmDlg", value_channel_customstate);	

						--请求封印
						LockItemSeal(drgtyp, drgidx, 0, seallevel, unsealtimetype);						
					end;
				},
				
				cancelbtn=
				{
					type="BUTTON";
					bkimage="res/uires/sysinfotip/cancelbtn.gsa";
					rect={200,183,75,26},
					defaultcancel=1,
					
					OnClick=function()
					end;					
				},				
			};
		};
		
		-- 解除封印
		UnlockSealDlg=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/unlocksealbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.UnlockSealDlg");
				Win_SetCapture("UI.gameui.UnlockSealDlg");
				Win_SetText("UI.gameui.UnlockSealDlg.titlelabel", "解除封印");
				local drgtyp = Win_GetValue("UI.gameui.UnlockSealDlg", value_channel_customtype);
				local drgidx = Win_GetValue("UI.gameui.UnlockSealDlg", value_channel_customindex);	
				local info = GetSealInfo(drgtyp, drgidx);
				
				if info.seallevel == 1 then -- 一级
					Win_EnableWidget("UI.gameui.UnlockSealDlg.unlockcomplete", true);
					Win_EnableWidget("UI.gameui.UnlockSealDlg.unlocktoone", false);
					Win_SetCheck("UI.gameui.UnlockSealDlg.unlockcomplete", true);
					Win_SetCheck("UI.gameui.UnlockSealDlg.unlocktoone", false);					
				elseif info.seallevel == 2 then --二级
					Win_EnableWidget("UI.gameui.UnlockSealDlg.unlockcomplete", true);
					Win_EnableWidget("UI.gameui.UnlockSealDlg.unlocktoone", true);				
					Win_SetCheck("UI.gameui.UnlockSealDlg.unlockcomplete", true);
					Win_SetCheck("UI.gameui.UnlockSealDlg.unlocktoone", false);					
				end;

			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={94,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={273,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 251,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				unlockcomplete= 
				{
					type = "CHECK",
					rect={32,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				unlocktoone= 
				{
					type = "CHECK",
					rect={32,180,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={118,233,88,26},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					
						local strmsg = "是否确认解封？确定后该物品进入解封期，解封期结束后自动解除封印，解封期内可随时取消解封或延长解封期。";
						Win_ShowMsgBox(strmsg, "系统消息", ui_msgid_yesno, "UI.gameui.UnlockSealDlg.affirmbtn");
					end;
					
					OnMsgBoxOk=function()
						local drgtyp = Win_GetValue("UI.gameui.UnlockSealDlg", value_channel_customtype);				   
						local drgidx = Win_GetValue("UI.gameui.UnlockSealDlg", value_channel_customindex);
						
						local sealoper = 1;
						local seallevel = 0;
						if Win_IsChecked("UI.gameui.UnlockSealDlg.unlockcomplete") then
							sealoper = 1; -- 完全解封
							seallevel = 0;
						elseif Win_IsChecked("UI.gameui.UnlockSealDlg.unlocktoone") then
							sealoper = 5; -- 解封至一级
							seallevel = 1;
						end;
						
						--请求解封
						LockItemSeal(drgtyp, drgidx, sealoper, seallevel, 0);
						
						Win_ShowWidget("UI.gameui.UnlockSealDlg", false);
					end;
					
					OnMsgBoxCancel=function()
						
					end;					
				},					
		
			};
		};
		
		-- 延长解封期[三个选项]
		DelayUnlockDlg1=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/delayunsealbk1.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.DelayUnlockDlg1");
				Win_SetCapture("UI.gameui.DelayUnlockDlg1");
				Win_SetCheck("UI.gameui.DelayUnlockDlg1.delaymode1", true);
				Win_SetCheck("UI.gameui.DelayUnlockDlg1.delaymode2", false);
				Win_SetCheck("UI.gameui.DelayUnlockDlg1.delaymode3", false);

			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={80,24,150,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={275,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				delaymode1= 
				{
					type = "CHECK",
					rect={32,90,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				delaymode2= 
				{
					type = "CHECK",
					rect={32,137,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				delaymode3= 
				{
					type = "CHECK",
					rect={32,181,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={125,235,88,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					
						local drgtyp = Win_GetValue("UI.gameui.DelayUnlockDlg1", value_channel_customtype);
						local drgidx = Win_GetValue("UI.gameui.DelayUnlockDlg1", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
											
						local unsealtimetype = 1;
						if Win_IsChecked("UI.gameui.DelayUnlockDlg1.delaymode1") then











							unsealtimetype = 1;
						elseif Win_IsChecked("UI.gameui.DelayUnlockDlg1.delaymode2") then
							unsealtimetype = 2;
						elseif Win_IsChecked("UI.gameui.DelayUnlockDlg1.delaymode3") then
							unsealtimetype = 3;							
						end;
						
						--请求延长解封期
						LockItemSeal(drgtyp, drgidx, 3, info.seallevel, unsealtimetype);
						
						Win_ShowWidget("UI.gameui.DelayUnlockDlg1", false);
					end;			
				},					
			};
		};
		
		-- 延长解封期[两个个选项]
		DelayUnlockDlg2=
		{
			type = "DIALOG",	
			rect={0,0,265,311},
			bkimage="res/uires/sysinfotip/delayunsealbk2.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.DelayUnlockDlg2");
				Win_SetCapture("UI.gameui.DelayUnlockDlg2");
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={70,24,180,14},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={275,21,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("物品说明");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				delaymode1= 
				{
					type = "CHECK",
					rect={32,104,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				delaymode2= 
				{
					type = "CHECK",
					rect={32,165,175,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
							
				affirmbtn=
				{
					type="BUTTON",
					rect={125,230,88,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					
						local drgtyp = Win_GetValue("UI.gameui.DelayUnlockDlg2", value_channel_customtype);
						local drgidx = Win_GetValue("UI.gameui.DelayUnlockDlg2", value_channel_customindex);
						local info = GetSealInfo(drgtyp, drgidx);
											
						local unsealtimetype = 2;
						if Win_IsChecked("UI.gameui.DelayUnlockDlg2.delaymode1") then
							unsealtimetype = 2;
						elseif Win_IsChecked("UI.gameui.DelayUnlockDlg2.delaymode2") then
							unsealtimetype = 3;				
						end;
						
						--请求延长解封期
						LockItemSeal(drgtyp, drgidx, 7, info.seallevel, unsealtimetype);
						
						Win_ShowWidget("UI.gameui.DelayUnlockDlg2", false);
					end;			
				},					
			};
		};
		
		SysInputTip=
		{
			type = "LABEL",
			rect={100,100,24,33},
			coverpic="res/uires/gameui/ballarrow.gsa",
			coverpicpos={-13,35},
			drawcolor={0,0,0,255},
			visible=0,			
			maxwidth=200,
			minheight=41,
			sizeable=1,								
			marginh=12,
			marginv=6,
			textsize=12,
			alphaspeed=0.1,	
			richmode=ui_richmode_all,
			initlayer=systooltip_layer,
			edgecheck=edge_check_show+edge_check_auto,	
			
			patchdrawtype=patch_draw_type_scale,				
			
			patchupleft="res/uires/gameui/ballupleft.gsa",
			patchupright="res/uires/gameui/ballupright.gsa",
			patchdownleft="res/uires/gameui/balldownleft.gsa",
			patchdownright="res/uires/gameui/balldownright.gsa",
			
			patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
			patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
			patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
			patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
			
			patchmiddle="res/uires/gameui/ballmiddle.gsa",
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.SysInputTip",false);
				end;
				
			OnSelfShow=function()
				Win_SetValue("UI.gameui.SysInputTip",-1,value_channel_timerspace);
				end;			
			
			OnClick=function()
				Win_ShowWidget("UI.gameui.SysInputTip",false);
				end;
				
			OnCloseByName=function(customname)
				if customname ~= "" and Win_IsVisible("UI.gameui.SysInputTip") then
					local host = Win_GetText("UI.gameui.SysInputTip",value_channel_customname);
					if host == customname then
						Win_ShowWidget("UI.gameui.SysInputTip",false);
						end;
					end;
				end;
			
			OnOpenInputTip=function(widgetpath, customname, tiptext, timespace,dirtype)
				if widgetpath ~= "" then
					local selbegin = Win_GetValue(widgetpath,value_channel_range_begin);
					local selend = Win_GetValue(widgetpath,value_channel_range_end);
					if selbegin == selend then
						local x = Win_GetValue(widgetpath, value_channel_winrect, 0);
						local y = Win_GetValue(widgetpath, value_channel_winrect, 1);
						local w = Win_GetValue(widgetpath, value_channel_winrect, 2);
						local h = Win_GetValue(widgetpath, value_channel_winrect, 3);
						local len = Win_GetValue(widgetpath,value_channel_captionsize);
						local txtsize = Win_GetValue(widgetpath, value_channel_textsize);
						
						local xpos = x+len*txtsize/2+24;
						local ypos = y+h-53;
						if xpos > x+w+24 then
							xpos = x+w+24;
							end;
						
						Win_SetText("UI.gameui.SysInputTip",customname,value_channel_customname);
						Win_SetText("UI.gameui.SysInputTip",tiptext);
						Win_SetPos("UI.gameui.SysInputTip",xpos,ypos);
						Win_ShowWidget("UI.gameui.SysInputTip",true);
						Win_SetValue("UI.gameui.SysInputTip",timespace,value_channel_timerspace);
						end;
					end;
					
					if (dirtype == 1 or dirtype == nil) then--箭头向左
						Win_SetText("UI.gameui.SysInputTip","res/uires/gameui/ballarrow.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.SysInputTip",-13,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.SysInputTip",35,value_channel_coverpicpos,1);
					elseif (dirtype == 2) then--箭头向右
						Win_SetText("UI.gameui.SysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
						local w = Win_GetValue("UI.gameui.SysInputTip",value_channel_winrect,2);
						Win_SetValue("UI.gameui.SysInputTip",w-9,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.SysInputTip",22,value_channel_coverpicpos,1);
					elseif (dirtype == 3) then--箭头向上
						Win_SetText("UI.gameui.SysInputTip","res/uires/gameui/ballarrowup.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.SysInputTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.SysInputTip",-13,value_channel_coverpicpos,1);
					elseif (dirtype == 4) then--箭头向下
						Win_SetText("UI.gameui.SysInputTip","res/uires/gameui/ballarrowdown.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.SysInputTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.SysInputTip",46,value_channel_coverpicpos,1);
					end;
				end;
		};		
		
		
		ExSysInputTip=
		{
			type = "LABEL",
			rect={100,100,24,33},
			coverpic="res/uires/gameui/ballarrow.gsa",
			coverpicpos={-13,35},
			drawcolor={0,0,0,255},
			visible=0,			
			maxwidth=200,
			minheight=41,
			sizeable=1,								
			marginh=12,
			marginv=6,
			textsize=12,
			alphaspeed=0.1,	
			richmode=ui_richmode_all,
			initlayer=systooltip_layer,
			edgecheck=edge_check_show+edge_check_auto,	
			
			patchdrawtype=patch_draw_type_scale,				
			
			patchupleft="res/uires/gameui/ballupleft.gsa",
			patchupright="res/uires/gameui/ballupright.gsa",
			patchdownleft="res/uires/gameui/balldownleft.gsa",
			patchdownright="res/uires/gameui/balldownright.gsa",
			
			patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
			patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
			patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
			patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
			
			patchmiddle="res/uires/gameui/ballmiddle.gsa",
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.ExSysInputTip",false);
				end;
				
			OnSelfShow=function()
				Win_SetValue("UI.gameui.ExSysInputTip",-1,value_channel_timerspace);
				end;			
			
			OnClick=function()
				Win_ShowWidget("UI.gameui.ExSysInputTip",false);
				end;
				
			OnCloseByName=function(customname)
				if customname ~= "" and Win_IsVisible("UI.gameui.ExSysInputTip") then
					local host = Win_GetText("UI.gameui.ExSysInputTip",value_channel_customname);
					if host == customname then
						Win_ShowWidget("UI.gameui.ExSysInputTip",false);
						end;
					end;
				end;
			
			OnOpenInputTip=function(widgetpath, customname, tiptext, timespace,dirtype)
				if widgetpath ~= "" then
					local selbegin = Win_GetValue(widgetpath,value_channel_range_begin);
					local selend = Win_GetValue(widgetpath,value_channel_range_end);
					if selbegin == selend then
						local x = Win_GetValue(widgetpath, value_channel_winrect, 0);
						local y = Win_GetValue(widgetpath, value_channel_winrect, 1);
						local w = Win_GetValue(widgetpath, value_channel_winrect, 2);
						local h = Win_GetValue(widgetpath, value_channel_winrect, 3);
						local len = Win_GetValue(widgetpath,value_channel_captionsize);
						local txtsize = Win_GetValue(widgetpath, value_channel_textsize);
						
						local xpos = x+len*txtsize/2+24;
						local ypos = y+h-53;
						if xpos > x+w+24 then
							xpos = x+w+24;
							end;
						
						Win_SetText("UI.gameui.ExSysInputTip",customname,value_channel_customname);
						Win_SetText("UI.gameui.ExSysInputTip",tiptext);
						Win_SetPos("UI.gameui.ExSysInputTip",xpos,ypos);
						Win_ShowWidget("UI.gameui.ExSysInputTip",true);
						Win_SetValue("UI.gameui.ExSysInputTip",timespace,value_channel_timerspace);
						end;
					end;
					
					if (dirtype == 1 or dirtype == nil) then--箭头向左
						Win_SetText("UI.gameui.ExSysInputTip","res/uires/gameui/ballarrow.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.ExSysInputTip",-13,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.ExSysInputTip",35,value_channel_coverpicpos,1);
					elseif (dirtype == 2) then--箭头向右
						Win_SetText("UI.gameui.ExSysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
						local w = Win_GetValue("UI.gameui.ExSysInputTip",value_channel_winrect,2);
						Win_SetValue("UI.gameui.ExSysInputTip",w-9,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.ExSysInputTip",22,value_channel_coverpicpos,1);
					elseif (dirtype == 3) then--箭头向上
						Win_SetText("UI.gameui.ExSysInputTip","res/uires/gameui/ballarrowup.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.ExSysInputTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.ExSysInputTip",-13,value_channel_coverpicpos,1);
					elseif (dirtype == 4) then--箭头向下
						Win_SetText("UI.gameui.ExSysInputTip","res/uires/gameui/ballarrowdown.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.ExSysInputTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.ExSysInputTip",46,value_channel_coverpicpos,1);
					end;
				end;
		};		
		
		
		MailInfoSysTip=
		{
			type = "LABEL",
			rect={100,100,24,33},
			coverpic="res/uires/gameui/ballarrow.gsa",
			coverpicpos={-13,35},
			drawcolor={0,0,0,255},
			visible=0,			
			maxwidth=200,
			minheight=41,
			sizeable=1,								
			marginh=12,
			marginv=6,
			textsize=12,
			rowspace=6;
			alphaspeed=0.1,	
			richmode=ui_richmode_all,
			initlayer=systooltip_layer,
			edgecheck=edge_check_show+edge_check_auto,	

			patchdrawtype=patch_draw_type_scale,				
			
			patchupleft="res/uires/gameui/ballupleft.gsa",
			patchupright="res/uires/gameui/ballupright.gsa",
			patchdownleft="res/uires/gameui/balldownleft.gsa",
			patchdownright="res/uires/gameui/balldownright.gsa",
			
			patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
			patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
			patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
			patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
			
			patchmiddle="res/uires/gameui/ballmiddle.gsa",
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.MailInfoSysTip",false);
				end;
				
			OnSelfShow=function()
				Win_SetValue("UI.gameui.MailInfoSysTip",-1,value_channel_timerspace);
				end;			
			
			OnClick=function()
				Win_ShowWidget("UI.gameui.MailInfoSysTip",false);
				UI.children.gameui.OnOpenMailList();
				end;
				
			OnCloseByName=function(customname)
				if customname ~= "" and Win_IsVisible("UI.gameui.MailInfoSysTip") then
					local host = Win_GetText("UI.gameui.MailInfoSysTip",value_channel_customname);
					if host == customname then
						Win_ShowWidget("UI.gameui.MailInfoSysTip",false);
						end;
					end;
				end;
			
			OnOpenInputTip=function(widgetpath, customname, tiptext, timespace,dirtype)
				if widgetpath ~= "" then
					local selbegin = Win_GetValue(widgetpath,value_channel_range_begin);
					local selend = Win_GetValue(widgetpath,value_channel_range_end);
					if selbegin == selend then
						local x = Win_GetValue(widgetpath, value_channel_winrect, 0);
						local y = Win_GetValue(widgetpath, value_channel_winrect, 1);
						local w = Win_GetValue(widgetpath, value_channel_winrect, 2);
						local h = Win_GetValue(widgetpath, value_channel_winrect, 3);
						local len = Win_GetValue(widgetpath,value_channel_captionsize);
						local txtsize = Win_GetValue(widgetpath, value_channel_textsize);
						
						local xpos = x+len*txtsize/2+24;
						local ypos = y+h-53;
						if xpos > x+w+24 then
							xpos = x+w+24;
							end;
						
						Win_SetText("UI.gameui.MailInfoSysTip",customname,value_channel_customname);
						Win_SetText("UI.gameui.MailInfoSysTip",tiptext);
						Win_SetPos("UI.gameui.MailInfoSysTip",xpos,ypos);
						Win_ShowWidget("UI.gameui.MailInfoSysTip",true);
						Win_SetValue("UI.gameui.MailInfoSysTip",timespace,value_channel_timerspace);
						end;
					end;
					
					if (dirtype == 1 or dirtype == nil) then--箭头向左
						Win_SetText("UI.gameui.MailInfoSysTip","res/uires/gameui/ballarrow.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.MailInfoSysTip",-13,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.MailInfoSysTip",35,value_channel_coverpicpos,1);
					elseif (dirtype == 2) then--箭头向右
						Win_SetText("UI.gameui.MailInfoSysTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
						local w = Win_GetValue("UI.gameui.MailInfoSysTip",value_channel_winrect,2);
						Win_SetValue("UI.gameui.MailInfoSysTip",w-9,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.MailInfoSysTip",22,value_channel_coverpicpos,1);
					elseif (dirtype == 3) then--箭头向上
						Win_SetText("UI.gameui.MailInfoSysTip","res/uires/gameui/ballarrowup.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.MailInfoSysTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.MailInfoSysTip",-13,value_channel_coverpicpos,1);
					elseif (dirtype == 4) then--箭头向下
						Win_SetText("UI.gameui.MailInfoSysTip","res/uires/gameui/ballarrowdown.gsa",value_channel_coverpic);
						Win_SetValue("UI.gameui.MailInfoSysTip",5,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.MailInfoSysTip",46,value_channel_coverpicpos,1);
					end;
				end;
		};		
		
		numinputdlg=
		{
			type="DIALOG",
			rect={0,0,154,48},
			dragrect={0,0,154,48},			
			moveable=1,
			style=wgtstyle_popup+wgtstyle_topmost,
			bkimage="res/uires/newcommon/numinput.gsa",
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()					   
				cursorinfo=Win_GetCursorInfo();					   
				Win_SetPos("UI.gameui.numinputdlg",cursorinfo.x-141,cursorinfo.y-35);					   
				Win_SetValue("UI.gameui.numinputdlg.numedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.numinputdlg.numedit",100000,value_channel_range_end);	
				Win_SetFocus("UI.gameui.numinputdlg.numedit");					   
				Win_ShowWidget("UI.gameui.numinputdlg.numedit", true);
				end;
			
			OnOk=function()	
				 num=Win_GetValue("UI.gameui.numinputdlg.numedit");
				 SetInputNumber(num);
				 
				 safe_call_func(g_number_input_callback,num);
			end;
			
			
			OnEnter=function()
				     Win_EndWidget("UI.gameui.numinputdlg",true);				     
				     end;
				     
			children=
			{					
				numedit=
				{
					type="EDIT",
					rect={25,10,54,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					maxchar=10,
					drawcolor={255,255,255,255},
					textsize=12,
					minvalue=1,
					visible=0,
					
					mornitor={value_channel_value},
						

					OnUpdate=function()
						local editpos=Win_GetValue("UI.gameui.numinputdlg.numedit");
						local sliderpos=Win_GetValue("UI.gameui.numinputdlg.numslider");
						if editpos~=sliderpos then
						Win_SetValue("UI.gameui.numinputdlg.numslider",editpos);
						end;
						end;
						
					children=
					{
						spinleft=
						{
							type="SPIN",
							rect={-19,-2,14,14},
							bkimage="res/uires/newcommon/spinleft.gsa",
							updatemute=1,
						},
						
						spinright=
						{
							type="SPIN",
							rect={67,-2,14,14},
							bkimage="res/uires/newcommon/spinright.gsa",
						        style=wgtstyle_primary,
							updatemute=1,
						},
						
					},		
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={108,4,42,20},
					bkimage="res/uires/newcommon/inputbtn.gsa",
					defaultok=1,
					updatemute=1,
				},
				
				minbtn=
				{
					type="BUTTON",
					rect={9,30,18,10},
					bkimage="res/uires/common/minbtn.gsa",
					updatemute=1,
					
					OnClick=function()						
						Win_SetValue("UI.gameui.numinputdlg.numedit",1);						
						end;
					
				},
				
				maxbtn=
				{
					type="BUTTON",
					rect={132,32,18,10},
					bkimage="res/uires/common/maxbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						local maxnum=Win_GetValue("UI.gameui.numinputdlg.numedit",value_channel_maxvalue);
						Win_SetValue("UI.gameui.numinputdlg.numedit",maxnum);						
						end;		
						
				},
				
				numslider=
				{
			
					type="SCROLLBAR",
					rect={27,27,102,14};									
					range={1,100},					
					pagesize=2,	
					updatemute=1,					
					
					OnValueChange=function(pos)
						Win_SetValue("UI.gameui.numinputdlg.numedit",pos);
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,24,14},	
							bkimage="res/uires/newcommon/hblock.gsa",
							bkimagepos={0,0},
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
							
						};--blockbtn
										
						
					};--children
					
				};--scroll		
				
			},
			
		};
		
		
		moneyinputdlg=
		{
			type="DIALOG",
			rect={0,0,180,26},
			moveable=1,
			style=wgtstyle_popup+wgtstyle_topmost,
			bkimage="res/uires/gameui/moneyinput.gsa",
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			updatemute=1,
			
			OnSelfShow=function()					   
				cursorinfo=Win_GetCursorInfo();					   
				Win_SetPos("UI.gameui.moneyinputdlg",cursorinfo.x-131,cursorinfo.y-37);
					   
				Win_SetValue("UI.gameui.moneyinputdlg.goldedit",0,value_channel_pos);
				Win_SetValue("UI.gameui.moneyinputdlg.silveredit",0,value_channel_pos);
				Win_SetValue("UI.gameui.moneyinputdlg.copperedit",0,value_channel_pos);
			
				Win_SetFocus("UI.gameui.moneyinputdlg.goldedit");					   
				end;
					   
					   
			OnOk=function()	
				local gold=Win_GetValue("UI.gameui.moneyinputdlg.goldedit");
				local silver=Win_GetValue("UI.gameui.moneyinputdlg.silveredit");
				local copper=Win_GetValue("UI.gameui.moneyinputdlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				local inputtype=Win_GetValue("UI.gameui.moneyinputdlg",value_channel_customtype);
				SaveMoney(inputtype,money);
				end;
			
			
			OnEnter=function()
				Win_EndWidget("UI.gameui.moneyinputdlg",true);				     
				end;
				     
			children=
			{					
				goldedit=
				{
					type="EDIT",
					rect={21,8,24,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=9999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.moneyinputdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.moneyinputdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.moneyinputdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=0;
						local inputtype=Win_GetValue("UI.gameui.moneyinputdlg",value_channel_customtype);
						if inputtype==1 then
						money=GetMoney(0);
						elseif inputtype == 3 then
						money=GetGoldBill();
						else
						money=GetMoney();
						end;
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.moneyinputdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.moneyinputdlg.silveredit");
						   end;
					
					
				},
				
				silveredit=
				{
					type="EDIT",
					rect={67,8,20,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.moneyinputdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.moneyinputdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.moneyinputdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=0;
						local inputtype=Win_GetValue("UI.gameui.moneyinputdlg",value_channel_customtype);
						if inputtype==1 then
						money=GetMoney(0);
						elseif inputtype == 3 then
						money=GetGoldBill();
						else
						money=GetMoney();
						end;
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.moneyinputdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.moneyinputdlg.copperedit");
						   end;					
					
				},
				
				copperedit=
				{
					type="EDIT",
					rect={108,8,20,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.moneyinputdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.moneyinputdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.moneyinputdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=0;
						inputtype=Win_GetValue("UI.gameui.moneyinputdlg",value_channel_customtype);
						if inputtype==1 then
						money=GetMoney(0);
						elseif inputtype == 3 then
						money=GetGoldBill();
						else
						money=GetMoney();
						end;
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.moneyinputdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.moneyinputdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.moneyinputdlg.goldedit");
						   end;
										
				},
				
				
				
				affirmbtn=
				{
					type="BUTTON",
					rect={133,3,44,22},
					bkimage="res/uires/gameui/inputbtn.gsa",
					defaultok=1,			
				},
				
			},
			
		};
		
		
		--离线经验兑换对话框 add by Abrahamhu 2008-10-15
		offlineexpdlg=
		{
			type="DIALOG",
			rect={400, 300, 343, 162},
			bkimage="res/uires/offlineexpdlg/offlineexpdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin;
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=1,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.offlineexpdlg",false);
				local offlineExpTips;
				if Win_IsChecked("UI.gameui.offlineexpdlg.nexttipsChk") then
					SetOfflineExpTips(1);
				else 
					SetOfflineExpTips(0);
				end;
			end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={317,6,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				};
				
				expExchangeNum=
				{
					type="LABEL",
					rect={ 69,38,12,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				--一次经验兑换
				oneExpExchangeChk=
				{
					type = "CHECK",
					rect={20,54,303,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				};
				
				oneExp=
				{
					type="LABEL",
					rect={ 154,57,47,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				oneJewel=
				{
					type="LABEL",
					rect={ 263,57,28,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				--二次经验兑换
				twoExpExchangeChk=
				{
					type = "CHECK",
					rect={20,77,303,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				};
				
				twoExp=
				{
					type="LABEL",
					rect={ 154,80,47,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				twoJewel=
				{
					type="LABEL",
					rect={ 263,80,28,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				--三次经验兑换
				threeExpExchangeChk=
				{
					type = "CHECK",
					rect={20,99,303,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				};
				
				threeExp=
				{
					type="LABEL",
					rect={ 154,102,47,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				threeJewel=
				{
					type="LABEL",
					rect={ 263,102,28,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				};
				
				--下次不再提示
				nexttipsChk=
				{
					type = "CHECK",
					rect={18,131,100,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					updatemute=1,
				};
				
				--确认兑换
				confirmbtn=
				{
					type="BUTTON",
					rect={135,128,86,24},
					bkimage="res/uires/offlineexpdlg/confirm.gsa",
					
					OnClick=function()
						local jewel = GetMyJude();
						local needjewel, awardexp;
						local total, expper, jewelper, offlineExpTips = GetOfflineExp();
						if Win_IsChecked("UI.gameui.offlineexpdlg.oneExpExchangeChk") then
							needjewel = jewelper;
							awardexp = expper;
						elseif Win_IsChecked("UI.gameui.offlineexpdlg.twoExpExchangeChk") then
							needjewel = jewelper*2;
							awardexp = expper*2;
						elseif Win_IsChecked("UI.gameui.offlineexpdlg.threeExpExchangeChk") then
							needjewel = jewelper*3;
							awardexp = expper*3;
						end;
						if jewel < needjewel then
							--彩玉不足
							Win_ShowMsgBox("您的彩玉余额不足，请确认数量后再进行操作!", "提示", ui_msgid_default, "UI.gameui.offlineexpdlg.confirmbtn");
							Win_SetValue("UI.gameui.offlineexpdlg.confirmbtn", 1, value_channel_customindex);
						else 
							Win_ShowMsgBox("兑换1次需要消耗彩玉数"..needjewel.."，给予角色"..awardexp.."经验。本次兑换后，您剩余的兑换次数将被重置。确认兑换吗？", "提示", ui_msgid_okcancel, "UI.gameui.offlineexpdlg.confirmbtn");
							Win_SetValue("UI.gameui.offlineexpdlg.confirmbtn", 2, value_channel_customindex);
						end;
					end;
					
					OnMsgBoxOk=function()
						local value = Win_GetValue("UI.gameui.offlineexpdlg.confirmbtn", value_channel_customindex);
						if value == 2 then
							if Win_IsChecked("UI.gameui.offlineexpdlg.oneExpExchangeChk") then
								OfflineExpExchange(1);
							elseif Win_IsChecked("UI.gameui.offlineexpdlg.twoExpExchangeChk") then
								OfflineExpExchange(2);
							elseif Win_IsChecked("UI.gameui.offlineexpdlg.threeExpExchangeChk") then
								OfflineExpExchange(3);
							end;
						elseif value ==1 then
							Win_ShowWidget("UI.gameui.offlineexpdlg", false);
						end;
					end;
				};
				
				--关闭
				shundownbtn=
				{
					type="BUTTON",
					rect={256,128,69,24},
					bkimage="res/uires/newcommon/closebtn.gsa",
					defaultcancel=1,
				};
			};
		};
		

		
		--排行榜
		rankingsdlg=
		{				
			type="DIALOG";
			bkimage="res/uires/rankingsdlg/rankingsdlg_leftbk.gsa";
			style=wgtstyle_customclose+wgtstyle_topmost,
			rect={213,179,277,373};
			moveable=1,
			visible=0,
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.rankingsdlg",false);
			       Win_ShowWidget("UI.gameui.rankingsdlg.PKrankingsdlg", false);
			end;
				
			
			OnSelfShow=function()
				local num = GetRankingsData();
				Win_SetValue("UI.gameui.rankingsdlg.list" ,num, value_channel_item_num);
				Win_SetValue("UI.gameui.rankingsdlg.list" , 1, value_channel_customid);
			end;
			
			OnSelfHide=function()				
			end;
			
			children=
			{			
				closebtn=
				{
					type="BUTTON",
					rect={205,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 182,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				list=
				{
					type="LISTBOX";
					rect={37,48,184,308};
					itemnum=0,
					dragtype=ui_drag_type_rankingslist,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix,
					itemdragflag=-1,
					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					
					itemdrawback="res/uires/rankingsdlg/shortsplit.gsa",
					itemdrawpos={0, 20, 0, 0},
					itemselback="res/uires/rankingsdlg/rankings_sel.gsa",
					itemselpos={0,-3,0,0},	
					updatemute=1,			

					OnClick=function()
						local idx = Win_GetValue("UI.gameui.rankingsdlg.list" , value_channel_sel);
						OpenRankings(idx);
					end;
						       
					children=
					{
						vscroll=
						{					
							type="SCROLLBAR",
							rect={165,19,20,86},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};
				
				--PK排行榜
				PKrankingsdlg=
				{				
					type="DIALOG";
					bkimage="res/uires/rankingsdlg/rankingsdlg_rightbk.gsa";
					style=wgtstyle_topmost+wgtstyle_customclose,
					rect={230,44,369,329};
					moveable=0,
					visible=0,
					
					OnSelfShow=function()
						local num = GetPKRankingslistSize();
						Win_SetValue("UI.gameui.rankingsdlg.PKrankingsdlg.list", num, value_channel_item_num);
						for i=0, num-1 do
							local info = GetPKRankingslistData(i);
							Win_SetText("UI.gameui.rankingsdlg.PKrankingsdlg.list.pkrankingslist"..i..".NO_lbl", i+1);
							Win_SetText("UI.gameui.rankingsdlg.PKrankingsdlg.list.pkrankingslist"..i..".title_lbl", info.title);
							Win_SetText("UI.gameui.rankingsdlg.PKrankingsdlg.list.pkrankingslist"..i..".name_lbl", info.name);
							Win_SetText("UI.gameui.rankingsdlg.PKrankingsdlg.list.pkrankingslist"..i..".prof_lbl", info.prof);
							Win_SetText("UI.gameui.rankingsdlg.PKrankingsdlg.list.pkrankingslist"..i..".exp_lbl", info.exp);
						end;
					end;
					
					OnSelfHide=function()				
					end;
					
					children=
					{			
						list=
						{
							type="WIDGETLIST";
							rect={5,26,338,299};
							style=wgtstyle_clipchild_window+wgtstyle_vertical,	
							primaryscroll="UI.gameui.rankingsdlg.PKrankingsdlg.scroll",
							itemmarginh=2,
							itemmarginv=2,
							
							template={"res/uires/pkrankingslist.lua"};
							
							children={},
							
						},--list
						
						scroll=
						{			
							type="SCROLLBAR",
							rect={347,46,15,258},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.rankingsdlg.PKrankingsdlg.list",
		
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={-518,0,15,99},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,																
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={-4,-25,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={-4,177,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,													
								};--spindown
				
							};--children
							
						};--scroll
					};
				};
			};
		};

		
		toggletaskinfobtn=
		{
			type="CHECK",
			rect={0,0,20,20},
			bkimage="res/uires/common/minize_rightleft_btn.gsa",
			framescheme={{0,0,1,1,2,2,3,3},{4,4,5,5,6,6,7,7},},
			updatemute=1,
			visible = 1,
			tiptext="隐藏任务提示",
			--初始任务提示是显示的。应该是隐藏按钮 ，uncheck
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,	
			marginv = 200;
			
			OnClick=function()
				if Win_IsChecked("UI.gameui.toggletaskinfobtn") then
					ShowInfoChannel(false);
					Win_SetText("UI.gameui.toggletaskinfobtn","显示任务提示",value_channel_tiptext);
				else
					ShowInfoChannel(true);
					Win_SetText("UI.gameui.toggletaskinfobtn","隐藏任务提示",value_channel_tiptext);
				end;
			end;
		};
		
		unshowbigavatarbtn=
		{
			type="BUTTON",
			rect={0,0,114,30},
			bkimage = "res/uires/common/unshowbigavatarbtn.gsa",
			updatemute=1,
			visible = 0,

			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_top_in,	
			marginv = 0;
			marginh = 0;
			

			
			OnClick=function()
				SetShowBigAvatar();
				Win_ShowWidget("UI.gameui.unshowbigavatarbtn",false);
			end;
		};
		
	
		showtaskhintbtn=
		{
			type="BUTTON",
			rect={0,0,20,20},
			bkimage = "res/uires/common/minize_rightleft_btn.gsa",
			updatemute=1,
			visible = 1,
			tiptext="打开任务提示",

			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,	
			marginv = 220;
			marginh = 0;
			
			OnClick=function()
				if Win_IsVisible("UI.gameui.taskremindhintdlg") == false then
					Win_ShowWidget("UI.gameui.taskremindhintdlg",true);
				else
					Win_ShowWidget("UI.gameui.taskremindhintdlg",false);
				end;
			end;
		};		
		 uparrowbtn=
		{
			type="BUTTON",
			rect={286,0,20,20},
			style=wgtstyle_alphawin,
			bkimage="res/uires/common/rightleft_btn.gsa",
			visible = 0,
			framescheme={{4,5,6,7}},
			tiptext="上一页状态",

			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in,
			marginh = -495;

			OnClick=function()
				ClickExceptList(-1);
			end;
		},
		
		downarrowbtn=
		{
			type="BUTTON",
			rect={306,0,20, 20},
			bkimage="res/uires/common/rightleft_btn.gsa",
			visible = 0,
			framescheme={{0,1,2,3}},
			tiptext="下一页状态",
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in,
			marginh = -475;

			OnClick=function()
				ClickExceptList(1);
			end;
		},

		goodexceptlist=
		{
			type="WIDGETLIST",
			rect={400,9,320,30},--325,9,320,30
			--style=wgtstyle_vertical,
			style=wgtstyle_none,
			itemmarginv=0,
			itemmarginh=3,
			initlayer=0,
			pluslayer=0,
			--autoadjust=autoadjust_center,
			template={"res/uires/goodexcept.lua"};
			children={},
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in,
			marginh = -175;
		},--list

		badexceptlist=
		{
			type="WIDGETLIST",
			rect={400,40,320,30},--325,40,320,30
			--style=wgtstyle_vertical,
			style=wgtstyle_none,
			itemmarginv=0,
			itemmarginh=3,
			initlayer=0,
			pluslayer=0,
			--autoadjust=autoadjust_center,
	
			template={"res/uires/badexcept.lua"};
			children={},

			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in,
			marginh = -175;
		},--list
		
		thirdexceptlist=
		{
			type="WIDGETLIST",
			rect={400,71,320,30},--325,40,320,30
			--style=wgtstyle_vertical,
			style=wgtstyle_none,
			itemmarginv=0,
			itemmarginh=3,
			initlayer=0,
			pluslayer=0,
			--autoadjust=autoadjust_center,
	
			template={"res/uires/thirdexcept.lua"};
			children={},

			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in,
			marginh = -175;
		},--list	
		
		helpspritedlg=
		{
			type="WIDGET";
			rect={0,  0, 80, 80},
			style=wgtstyle_renderbuffer,
			moveable=1,
			custombuffer=custom_buffer_helpsprite,
			
			RandomTip=function()
				local info, size = GetRandomTip();
				
				if size == 0 then
					Win_SetValue("UI.gameui.helpspritedlg", -1, value_channel_timerspace);
					return;
				end;

				Win_SetText("UI.gameui.helpspritedlg.SysInputTip", info);
				Win_ShowWidget("UI.gameui.helpspritedlg.SysInputTip",true);
				
				local x, y = Win_GetPos("UI.gameui.helpspritedlg");
				if x >= 0 and x <= 500 then  --箭头向左
					Win_SetText("UI.gameui.helpspritedlg.SysInputTip","res/uires/gameui/ballarrow.gsa",value_channel_coverpic);
					Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",-13,value_channel_coverpicpos,0);
					Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",35,value_channel_coverpicpos,1);
					
					Win_SetPos("UI.gameui.helpspritedlg.SysInputTip", x+61,  y-60);
				else -- 向右
					Win_SetText("UI.gameui.helpspritedlg.SysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
					local w = Win_GetValue("UI.gameui.helpspritedlg.SysInputTip",value_channel_winrect,2);
					Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",w-9,value_channel_coverpicpos,0);
					Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",22,value_channel_coverpicpos,1);
					
					Win_SetPos("UI.gameui.helpspritedlg.SysInputTip", x-208,  y-60);
				end;
					
				Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",10,value_channel_timerspace);
				Win_SetValue("UI.gameui.helpspritedlg", 600, value_channel_timerspace);
			end;
			
			OnSelfShow=function()
				local iShowHelpSprite, iDailyHelp, iLockPos = GetHelpVar();
				
				if iDailyHelp > 0 then
					UI.children.gameui.children.helpspritedlg.RandomTip();
				end;
				
				ChangeHelpAction(0);
			end;
			
			OnTimer=function()
				UI.children.gameui.children.helpspritedlg.RandomTip();
			end;
			
			OnRClick=function()
				UI.children.gameui.OnOpenHelpMenu(true);
			end;
			
			children=
			{
				SysInputTip=
				{
					type = "LABEL",
					rect={61,-60,24,33},
					coverpic="res/uires/gameui/ballarrow.gsa",
					coverpicpos={-13,35},
					drawcolor={0,0,0,255},
					visible=0,			
					maxwidth=200,
					minheight=41,
					sizeable=1,								
					marginh=12,
					marginv=6,
					textsize=12,
					alphaspeed=0.1,	
					richmode=ui_richmode_all,
					initlayer=systooltip_layer,
					edgecheck=edge_check_show+edge_check_auto,
					
					patchdrawtype=patch_draw_type_scale,	
			
					patchupleft="res/uires/gameui/ballupleft.gsa",
					patchupright="res/uires/gameui/ballupright.gsa",
					patchdownleft="res/uires/gameui/balldownleft.gsa",
					patchdownright="res/uires/gameui/balldownright.gsa",
					
					patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
					patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
					patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
					patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
					
					patchmiddle="res/uires/gameui/ballmiddle.gsa",
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.helpspritedlg.SysInputTip",false);
					end;
					
					OnSelfShow=function()
						Win_SetValue("UI.gameui.helpspritedlg.SysInputTip",-1,value_channel_timerspace);
					end;	
						
					OnClick=function()
						Win_ShowWidget("UI.gameui.helpspritedlg.SysInputTip",false);
					end;
				};
			};
		};
		
		--pipo
		inputcontentdlg=
		{
			type="WIDGET",
			rect={200, 200, 290, 194},
			style=wgtstyle_topmost,
			moveable=1,
			visible=0,
			bkimage="res/uires/gameui/inputcontentdlg.gsa",
			OnSelfShow=function()
				Win_SetText("UI.gameui.inputcontentdlg.inputbox", "");
				Win_SetFocus("UI.gameui.inputcontentdlg.inputbox");
			end;
			
			OnOK=function()
				Win_ShowWidget("UI.gameui.inputcontentdlg", false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.inputcontentdlg", false);
			end;
		
			children=
			{
				-- 对话框ID
				dlgtype=
				{
					type = "LABEL",
					rect={0,0,0,0},
					visible=0,
				},
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 263,11,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},
				
				title=
				{
					type = "LABEL",
					rect={77, 10, 120, 20},
					textsize=12,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 243,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("输入请求内容");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				},
				
				inputbox=
				{
					type="MULTIEDIT",
					rect = {27, 66, 240 ,50},
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=64,	
					editable=1,
					richflag=1,
				},
				
				sendbtn=
				{
					type = "BUTTON",
					rect = {52, 164, 70, 20},
					bkimage="res/uires/gameui/sendbtn.gsa",
					OnClick=function()
						local menuname = Win_GetText("UI.gameui.inputcontentdlg", value_channel_customname);
						local commenttxt = Win_GetText("UI.gameui.inputcontentdlg.inputbox");
						local dlgtype = Win_GetText("UI.gameui.inputcontentdlg.dlgtype");
						if dlgtype == "0" then --申请加为好友
							GmBuddyReqAdd(menuname, commenttxt);
						elseif dlgtype == "1" then --邀请加入家族
							InviteJoinFamily(menuname, commenttxt);
						elseif dlgtype == "2" then --申请加入家族
							ApplyJoinFamily("",menuname, commenttxt);
						elseif dlgtype == "3" then
							ApplyJoinFamily(menuname, "", commenttxt);							
						elseif dlgtype == "4" then
							MasterRequest(menuname, commenttxt);
						elseif dlgtype == "5" then
							ApprRequest(menuname, commenttxt);
						end;
						Win_ShowWidget("UI.gameui.inputcontentdlg", false);
					end;
				},
				
				cancelbtn=
				{	
					type = "BUTTON",
					rect = {172, 164, 70, 20},
					bkimage="res/uires/gameui/cancelbtn.gsa",
					defaultcancel=1,
				};
			},
		},
		
		--加为好友
		invitebuddydlg=
		{
			type = "DIALOG",
			rect = {200, 200,314, 272}, 
			visible = 0,
			bkimage="res/uires/gameui/invitebuddy.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.invitebuddydlg");
			end;
			
			OnOk=function()
				AcceptGmBuddyReq(true);
				Win_ShowWidget("UI.gameui.invitebuddydlg", false);
			end;
			
			OnCancel=function()
				AcceptGmBuddyReq(false);
				Win_ShowWidget("UI.gameui.invitebuddydlg", false);
			end;

			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 289,11,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 268,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("请求加为好友");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				},
				
				titlenamelabel= 
				{
					type = "LABEL",
					rect = { 66, 39,96,19 },
					textsize=12,
				};
				namelabel= 
				{
					type = "LABEL",
					rect = { 80,105,72,19 },
					textsize=12,
				};	
				levellabel=
				{
					type = "LABEL",
					rect = { 163,105, 33,19 },
					textsize=12,
				};
				proflabel=
				{
					type="LABEL",
					rect = {210, 105, 70, 19},
					textsize=12,
				};
				infolabel=
				{
					type="LABEL",
					rect={36, 174, 250, 42},
					textsize=12,
				};
				
				genderlabel=
				{
					type="WIDGET";
					rect={37, 76, 30, 30},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_invitebuddygender,
				};
				
				agreebtn=
				{
					type = "BUTTON",
					rect={56, 243, 70, 22},
					bkimage="res/uires/gameui/agreebtn.gsa",
					defaultok=1,
				};
				
				refusebtn=
				{
					type = "BUTTON",
					rect={200, 243, 70, 22},
					bkimage="res/uires/gameui/refusebtn.gsa",
					defaultcancel=1,
				};
			};
		};
		
		
		--pipo320
		--请求入队
		reqjointeamdlg=
		{
			type="DIALOG",
			rect={0,0,314,180},
			captionrect={53,12,193,17},
			bkimage="res/uires/teamdlg/reqjointeamdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.reqjointeamdlg");
			end;
			
			OnOk=function()
				TeamAcceptJoin(true);
				Win_ShowWidget("UI.gameui.reqjointeamdlg",false);
			end;
			
			OnCancel=function()
				TeamAcceptJoin(false);
				Win_ShowWidget("UI.gameui.reqjointeamdlg",false);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={289,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignpointcarddlg");
						end;
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={269,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				head=
				{
					type="WIDGET",
					rect={36,75,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_jointeamhead,
				};
				
				titlename=
				{
					type="LABEL",
					rect={49, 38, 100, 20},
				};
				
				name=
				{
					type="LABEL",
					rect={78,103,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level=
				{
					type="LABEL",
					rect={159,104,41,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof=
				{
					type="LABEL",
					rect={207,104,74,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={61,152,70,22},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={193,152,70,22},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
			};
		};
		
		--邀请入队
		inviteteamdlg=
		{
			type="DIALOG",
			rect={0,0,321,314},
			bkimage="res/uires/teamdlg/inviteteamdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.inviteteamdlg");
			end;
			
			OnOk=function()
				if IsInBattleDeque() ~= 0 then
					Win_ShowMsgBox("组队后将自动退出战场排队队列，您确定要同意被邀请入队吗?","系统消息",ui_msgid_yesno,"UI.gameui.inviteteamdlg");
				else
					TeamAcceptInvite(true);
					Win_ShowWidget("UI.gameui.inviteteamdlg", false);
				end;
				end;
			
			OnCancel=function()
				TeamAcceptInvite(false);
				Win_ShowWidget("UI.gameui.inviteteamdlg", false);
				end;
			
			OnMsgBoxOk=function()
				ClearBattleStatus();
				TeamAcceptInvite(true);
				Win_ShowWidget("UI.gameui.inviteteamdlg", false);
				end;
			
			OnMsgBoxCancel=function()
				TeamAcceptInvite(false);
				Win_ShowWidget("UI.gameui.inviteteamdlg", false);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={291,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignpointcarddlg");
						end;
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={269,19,23,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				titlename=
				{
					type = "LABEL",
					rect= {43, 50, 86 ,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				teamname=
				{
					type="LABEL",
					rect={211,50, 100, 20},
					textsize=12,
				};
				
				head1=
				{
					type="WIDGET",
					rect={58,105,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqteamhead1,
				};
				
				name1=
				{
					type="LABEL",
					rect={104,106,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level1=
				{
					type="LABEL",
					rect={189,109,35,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof1=
				{
					type="LABEL",
					rect={225,109,60,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				head2=
				{
					type="WIDGET",
					rect={58,146,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqteamhead2,
				};
				
				name2=
				{
					type="LABEL",
					rect={104,150,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level2=
				{
					type="LABEL",
					rect={189,150,35,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof2=
				{
					type="LABEL",
					rect={225,150,60,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				head3=
				{
					type="WIDGET",
					rect={58,187,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqteamhead3,
				};
				
				name3=
				{
					type="LABEL",
					rect={104,191,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level3=
				{
					type="LABEL",
					rect={189,191,35,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof3=
				{
					type="LABEL",
					rect={225,191,60,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				head4=
				{
					type="WIDGET",
					rect={58,228,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqteamhead4,
				};
				
				name4=
				{
					type="LABEL",
					rect={104,232,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level4=
				{
					type="LABEL",
					rect={189,232,335,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof4=
				{
					type="LABEL",
					rect={225,232,60,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				
				agreebtn=
				{
					type="BUTTON",
					rect={63,275,86,24},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={194,275,86,24},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
			};
		};
		
		--pipo424 传送
		playertranpdlg=
		{
			type="DIALOG",
			rect={225,160,233,316},
			captionrect={76,21,74,20},
			caption="传送";
			textsize=16,
			textstyle=dt_center+dt_vcenter,
			textfont=1,
			drawcolor={230,194,60,255},
			
			bkimage="res/uires/transportdlg/playertranpdlg.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			textstyle=dt_center+dt_vcenter,
			visible=1;
			
			OnOk=function()
				local index = Win_GetValue("UI.gameui.playertranpdlg.list", value_channel_sel);
				SendTranPkg(index);
				Win_ShowWidget("UI.gameui.playertranpdlg",false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.playertranpdlg",false);
			end;
			
			OnSelfShow=function()
				SetGlobalQuery(GlobalQuery_TranDlg, 1);
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_TranDlg, 0);
			end;
			
			children=
			{
				prof=
				{
					type="LABEL",
					rect={41,51,174,20},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={228,183,90,255},
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={203,19,22,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={181,19,22,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
							Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
							local helpid=GetHelpID("帮助界面");
							Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
							Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={31, 280, 69, 24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},			
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={150,280,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				list=
				{
					type="LISTBOX",
					rect={41,76,151,188},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,	
					dragtype=ui_drag_type_playertran,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=21,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/transportdlg/itembk.gsa",
					itemselback="res/uires/transportdlg/itemsel.gsa",
					itemdrawpos={0,20,1,1},
					itemselpos={1, 1,1,1};
					
					primaryscroll="UI.gameui.playertranpdlg.listscroll",
					
					OnDBClick=function(idx,wparam,lparam)
						if idx>=0 then
							SendTranPkg(idx);
							Win_ShowWidget("UI.gameui.playertranpdlg",false);
						end;
					end;
				};
				
				listscroll=
				{
			
					type="SCROLLBAR",
					rect={192, 94,20, 152},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size;--+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.playertranpdlg.list",

					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		--飞鸽传书发送
		infotransenddlg=
		{
			type="DIALOG",
			rect={225,160,346,273},
			bkimage="res/uires/gameui/traninfoall.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			textstyle=dt_center+dt_vcenter,
			visible=1;
			
			OnOk=function()
				Win_ShowWidget("UI.gameui.infotransenddlg",false);
				local szInfo = Win_GetText("UI.gameui.infotransenddlg.info");
				SendTranInfoPkg(szInfo);
			end;

			OnSelfShow=function()
				SetGlobalQuery(GlobalQuery_TranInfoDlg, 1);
				Win_SetFocus("UI.gameui.infotransenddlg.info");
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_TranInfoDlg, 0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.infotransenddlg",false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={301,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={43, 233, 70, 22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},			
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={219,233,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				info=
				{
					type="MULTIEDIT",
					rect={35,55,255, 165},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=1024,	
					richflag=1,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={269,10,15,150},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};	
				};
			};
		};
		
		--飞鸽传书接收
		infotranrecvdlg=
		{
			type="DIALOG",
			rect={225,160,346,273},
			bkimage="res/uires/gameui/infotrandlg.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			textstyle=dt_center+dt_vcenter,
			visible=1;
			
			OnOk=function()
				Win_ShowWidget("UI.gameui.infotranrecvdlg",false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.infotranrecvdlg",false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={301,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={43, 233, 70, 22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},			
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={219,233,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				info=
				{
					type="MULTIEDIT",
					rect={35,55,255, 165},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=2048,	
					richflag=1,
					editable=0,

					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={269,10,15,150},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
								
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};	
				};
			};
		};
		
		--召唤NPC
		callnpcdlg=
		{
			type="DIALOG",
			rect={225,160,233,316},
			captionrect={76,21,74,20},
			caption="召唤";
			textsize=16,
			textstyle=dt_center+dt_vcenter,
			textfont=1,
			drawcolor={230,194,60,255},
			bkimage="res/uires/transportdlg/playertranpdlg.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			textstyle=dt_center+dt_vcenter,
			visible=1;
			
			OnOk=function()
				local index = Win_GetValue("UI.gameui.callnpcdlg.npclist", value_channel_sel);
				SendCallNpcPkg(index);
				Win_ShowWidget("UI.gameui.callnpcdlg",false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.callnpcdlg",false);
			end;
			
			children=
			{
				prof=
				{
					type="LABEL",
					rect={41,51,174,20},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={228,183,90,255},
					caption="选择召唤NPC名称";
				};
			
				closebtn=
				{
					type="BUTTON",
					rect={203,19,22,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={181,19,22,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={31, 280, 69, 24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},			
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={150,280,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				npclist=
				{
					type="LISTBOX",
					rect={41,76,151,188},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,	
					dragtype=ui_drag_type_callnpc,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=21,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/transportdlg/itembk.gsa",
					itemselback="res/uires/transportdlg/itemsel.gsa",
					itemdrawpos={0,20,1,1},
					itemselpos={1, 1,1,1};
					
					primaryscroll="UI.gameui.callnpcdlg.npclistscroll",
					
					OnDBClick=function(idx,wparam,lparam)
						if idx>=0 then
							local index = Win_GetValue("UI.gameui.callnpcdlg.npclist", value_channel_sel);
							SendCallNpcPkg(index);
							Win_ShowWidget("UI.gameui.callnpcdlg",false);
						end;
					end;
				};
				
				npclistscroll=
				{
			
					type="SCROLLBAR",
					rect={192, 94,20, 152},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size;--+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.callnpcdlg.npclist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll	
			};
		};
		
		--请求加入家族
		reqjoinfamilydlg=
		{
			type="DIALOG",
			rect={0,0,314,272},
			captionrect={53,12,193,17},
			bkimage="res/uires/teamdlg/reqjoinfamilydlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.reqjoinfamilydlg");
			end;
			
			OnOk=function()
				AcceptFamilyInvite(true);
				Win_ShowWidget("UI.gameui.reqjoinfamilydlg",false);
			end;
			
			OnCancel=function()
				AcceptFamilyInvite(false);
				Win_ShowWidget("UI.gameui.reqjoinfamilydlg",false);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={289,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={269,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				title=
				{
					type = "LABEL",
					rect = {58, 35, 100, 22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				},
				
				head=
				{
					type="WIDGET",
					rect={36,75,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqjoinfamilyhead,
				};
				
				name=
				{
					type="LABEL",
					rect={78,103,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level=
				{
					type="LABEL",
					rect={159,104,41,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof=
				{
					type="LABEL",
					rect={207,104,74,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={61,244,70,22},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={193,244,70,22},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
				
				info=
				{
					type="LABEL",
					rect={35,171,250,47},
					textsize=12,
				};
			};
		};
		
		
		--邀请加入家族
		invitefamilydlg=
		{
			type="DIALOG",
			rect={0,0,405,268},
			captionrect={53,12,263,17},
			bkimage="res/uires/teamdlg/invitefamilydlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.invitefamilydlg");
			end;
			
			OnOK=function()
				Win_ShowWidget("UI.gameui.invitefamilydlg",false);
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.invitefamilydlg", false);
				AcceptJoinFamily(false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={378,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignpointcarddlg");
						end;
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={354,20,22,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				operatorname=
				{
					type="LABEL",
					rect={74,46,96,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				titlefmlname=
				{
					type="LABEL",
					rect={252,46,96,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				fmilyname=
				{
					type="LABEL",
					rect={46,103,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				shaikhname=
				{
					type="LABEL",
					rect={134,105,75,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level=
				{
					type="LABEL",
					rect={221,105,50,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				credit=
				{
					type="LABEL",
					rect={275,105,65,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				numinfo=
				{
					type="LABEL",
					rect={341,105,40,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={63,235,86,24},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.invitefamilydlg", false);
						AcceptJoinFamily(true);
						end;
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={273,236,86,24},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
				
				info=
				{
					type="MULTIEDIT",
					rect={33,165,360,60},
					textsize=12,
					textstyle=dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_copydisable,	
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					enable=0,
				};
			};
		};
		
		reqmasterdlg=
		{
			type="DIALOG",
			rect={0,0,314,272},
			captionrect={53,12,193,17},
			bkimage="res/uires/master/reqmasterdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.reqmasterdlg");
			end;
			
			OnOk=function()
				OnReqMaster(1);
				Win_ShowWidget("UI.gameui.reqmasterdlg",false);
			end;
			
			OnCancel=function()
				OnReqMaster(0);
				Win_ShowWidget("UI.gameui.reqmasterdlg",false);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={289,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.reqmasterdlg");
						end;
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={269,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				head=
				{
					type="WIDGET",
					rect={39,77,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqmasterhead,
				};
				
				title=
				{
					type="LABEL",
					rect={64,40,96,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
				};
				
				name=
				{
					type="LABEL",
					rect={78,103,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level=
				{
					type="LABEL",
					rect={159,104,41,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof=
				{
					type="LABEL",
					rect={207,104,74,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={61,244,70,22},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={193,244,70,22},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
				
				info=
				{
					type="LABEL",
					rect={34,173,252,44},
					textsize=12,
				};
			};
		};
		
		reqprenticedlg=
		{
			type="DIALOG",
			rect={0,0,314,272},
			captionrect={53,12,193,17},
			bkimage="res/uires/master/reqprenticedlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			textstyle=dt_center+dt_vcenter,
			visible=0;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.reqprenticedlg");
			end;
			
			OnOk=function()
				OnReqPrentice(1);
				Win_ShowWidget("UI.gameui.reqprenticedlg",false);
			end;
			
			OnCancel=function()
				OnReqPrentice(0);
				Win_ShowWidget("UI.gameui.reqprenticedlg",false);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={289,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.reqprenticedlg");
						end;
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={269,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				head=
				{
					type="WIDGET",
					rect={39,77,31,31},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_reqprenticehead,
				};
				
				title=
				{
					type="LABEL",
					rect={64,40,96,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
				};
				
				name=
				{
					type="LABEL",
					rect={78,103,75,22},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				level=
				{
					type="LABEL",
					rect={159,104,41,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				prof=
				{
					type="LABEL",
					rect={207,104,74,20},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={61,244,70,22},
					bkimage="res/uires/teamdlg/agreebtn.gsa",
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					defaultok=1,					
				};
				
				rejuctbtn=
				{
					type="BUTTON",
					rect={193,244,70,22},
					bkimage="res/uires/teamdlg/rejuctbtn.gsa",
					defaultcancel=1,
				};
				
				info=
				{
					type="LABEL",
					rect={34,173,252,44},
					textsize=12,
				};
			};
		};
		
		selflabelbar=
		{
			type="WIDGET",
			rect = {115,113, 70, 21},
			
			OnTimer=function()
				label = Win_GetValue("UI.gameui.selflabelbar",value_channel_customindex);
				if label == 1 then
					Win_ShowWidget("UI.gameui.selflabelbar.selflabel1effct",false);	
				elseif label == 2 then
					Win_ShowWidget("UI.gameui.selflabelbar.selflabel2effct",false);	
				end;
			end;
					
			children=
			{
				selflabel1effct=
				{
					type="BUTTON",
					rect={33,-2,26,26},
					style=wgtstyle_alphawin,
					bkimage="res/uires/gameui/btneffct.gsa",
					framescheme={{0,13,0,13,0,13,0,13}};
					framespeed=0.01;
					initlayer = msgbox_layer;
					visible=0;
					senable=0;
					updatemute=1,
									
					OnSelfShow=function()
						Win_SetValue("UI.gameui.selflabelbar",0.56,value_channel_timerspace);
						Win_SetValue("UI.gameui.selflabelbar",1,value_channel_customindex);
					end;
				};
				selflabelbk1=
				{
					type="WIDGET",
					rect={35,0,35,21},
					style=wgtstyle_none,
					bkimage="res/uires/gameui/selflabelbkimage.gsa",
					visible = 0;
					updatemute=1,
				};
		
				selflabelbk2=
				{
					type="WIDGET",
					rect={0,0,35,21},
					style=wgtstyle_none,
					bkimage="res/uires/gameui/selflabelbkimage.gsa",
					visible = 0;
					updatemute=1,
				};
		
				selflabel2effct=
				{
					type="BUTTON",
					rect={-3,-2,26,26},
					style=wgtstyle_alphawin,
					bkimage="res/uires/gameui/btneffct.gsa",
					framescheme={{0,13,0,13,0,13,0,13}};
					framespeed=0.01;
					initlayer = msgbox_layer;
					visible=0;
					senable=0;
					updatemute=1,
									
					OnSelfShow=function()
						Win_SetValue("UI.gameui.selflabelbar",0.56,value_channel_timerspace);
						Win_SetValue("UI.gameui.selflabelbar",2,value_channel_customindex);
					end;
				};
		
				selflabellist=
				{
					type="WIDGETLIST",
					rect={-8,4,70,12},
					style=wgtstyle_none,
					itemmarginv=0,
					itemmarginh=12,
					updatemute=1,
			
					template={"res/uires/selflabel.lua"};
					children={},
				};
				

			};
		};
		
		--pipo913 菜单 caption="游戏设置",
		sysconfigdlg=
		{
			type="DIALOG",
			rect = { 0, 0, 479, 267},
			bkimage="res/uires/sysoption/sysoptionbk.gsa",
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			visible=0,
			moveable=1,
			style=wgtstyle_topmost,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				Win_SetCheck("UI.gameui.sysconfigdlg.gamesettab",true);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab",false);
				Win_SetCheck("UI.gameui.sysconfigdlg.autoreplytab",false);
				Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab",false);
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab",false);
				Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab",false);
				
				local var=GetGameVar("nopk");
				Win_SetSelect("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg",0,var);
				
				var=GetGameVar("mouseattack");
				Win_SetSelect("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg",1,var);
				
				var=GetGameVar("intellskill");
				Win_SetCheck("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg.Skillcheck",(var==1));
				
				var=GetGameVar("chatfade");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.ChatFadecheck",(var==1));
				
				var=GetGameVar("playername");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PlayerNamecheck",(var==1));
				
				var=GetGameVar("monstername");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.MonsterNamecheck",(var==1));
				
				var=GetGameVar("shadow");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Shadowcheck",(var==1));
				
				var=GetGameVar("weather");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Weathercheck",(var==1));
				
				var=GetGameVar("autopop");
				Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Autopopcheck",(var==1));
				
				var=GetGameVar("music");
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusicslider",var,value_channel_pos);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusiccheck",(var>0));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusicslider",(var>0));
				
				var=GetGameVar("SetPetNum");
				SetGameVar("SetPetNum",var);
				Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", var);
				Win_SetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",var,value_channel_pos);
				
				var=GetGameVar("envsound");
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusicslider",var,value_channel_pos);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusiccheck",(var>0));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusicslider",(var>0));
				
				var=GetGameVar("sound");
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusicslider",var,value_channel_pos);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusiccheck",(var>0));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusicslider",(var>0));
				
				var=GetGameVar("autochgstatus");
				Win_SetCheck("UI.gameui.sysconfigdlg.autoreplytab.autoreplydlg.autogotoleavecheck",(var>0));
				
				var=GetGameVar("szinfo");
				Win_SetText("UI.gameui.sysconfigdlg.autoreplytab.autoreplydlg.autogotoleavetext", var);
				
				local isInitOk = IsP2PTalkInit();
				
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumecheck",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceTonecheck",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECcheck",isInitOk~=0);
				
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider.blockbtn",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider.blockbtn",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECslider.blockbtn",false);
								
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider",isInitOk~=0);
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECslider",false);
				
				if isInitOk~=0 then
				
				minvol,maxvol=GetMicRecVolumeRange();
				var=GetMicRecVolume();
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",maxvol,value_channel_maxvalue);
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",minvol,value_channel_minvalue);
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",var);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumecheck",(not IsMicMute()));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",(var>minvol));
				
				var=GetGameVar("tone");
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider",var,value_channel_pos);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceTonecheck",(var>0));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider",(var>0));
				
				var=GetGameVar("aec");
				Win_SetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECslider",100,value_channel_pos);
				Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECcheck",(var>0));
				Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECslider",false);
				end;
				
				--913 自动补给
				var = GetGameVar("autosupplyvalue");
				Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.validcheck", (var>0));
				var = GetGameVar("hpitem1");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel1", var);
				var = GetGameVar("hpitem2");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel2", var);
				var = GetGameVar("spitem1");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel1", var);
				var = GetGameVar("spitem2");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel2", var);
				var = GetGameVar("hppercent1");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel1", var.."%");
				var = GetGameVar("hppercent2");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel2", var.."%");
				var = GetGameVar("sppercent1");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel1", var.."%");
				var = GetGameVar("sppercent2");
				Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel2", var.."%");
	
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,600);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;
				--}}add by finnwang [2007-09-04]
				
				Win_SetFocus("UI.gameui.sysconfigdlg");

				local sel = Win_GetSelect("UI.gameui.sysconfigdlg",0);
				if sel == 1 then
					--游戏画面设置
				elseif sel == 2 then
					RequestNewbieHelp(help_syscfg_music);
				elseif sel == 3 then
					--RequestNewbieHelp(help_syscfg_autortn);
				elseif sel == 4 then
					RequestNewbieHelp(help_syscfg_autohp);
				else
					RequestNewbieHelp(help_sysconfigdlg);
				end;
				
				local nskillcount1, nskillcount2, nskillcount3 = GetExtendSkillStr();
				Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel1", nskillcount1);
				Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel2", nskillcount2);
				Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel3", nskillcount3);
			end;
			
			OnSelfHide=function()
				if Win_IsVisible("UI.gameui.sysoptiondlg") then
				Win_SetCapture("UI.gameui.sysoptiondlg");
				Win_SetFocus("UI.gameui.sysoptiondlg");				
				end;
				    
				Win_ClearPathPoint("UI.gameui.probeinfowin");				
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				--}}add by finnwang [2007-09-04]
				
				local sel = Win_GetSelect("UI.gameui.sysconfigdlg",0);
				if sel == 1 then
					--游戏画面设置
				elseif sel == 2 then
					RequestNewbieHelp(help_syscfg_music, 0);
				elseif sel == 3 then
					--自动回复
				elseif sel == 4 then
					RequestNewbieHelp(help_syscfg_autohp, 0);
				else
					RequestNewbieHelp(help_sysconfigdlg, 0);
				end;
				
				end;
			
			OnOk=function()
				local var=Win_GetSelect("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg",0);
				SetGameVar("nopk",var);
--~ 				if var == 0 then
--~ 					Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_nopk.gsa");
--~ 				elseif var == 2 then
--~ 					Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_team.gsa");
--~ 				elseif var == 3 then
--~ 					Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_family.gsa");
--~ 				elseif var == 4 then
--~ 					Win_SetCoverPic("UI.gameui.statusbar.pkmodeicon", "res/uires/gameui/pkmode_color.gsa");
--~ 				end;
				
				var=Win_GetSelect("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg",1);
				SetGameVar("mouseattack",var);
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.gamesettab.gamesetdlg.Skillcheck") then
					SetGameVar("intellskill",1);
				else
					SetGameVar("intellskill",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.ChatFadecheck") then
					SetGameVar("chatfade",1);
					Win_SetText("UI.gameui.chatbar.lockbtn","关闭聊天背景",value_channel_tiptext);
					if Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
						Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_increase,value_channel_alphastate);
					end;
				else
					SetGameVar("chatfade",0);				
					Win_SetText("UI.gameui.chatbar.lockbtn","开启聊天背景",value_channel_tiptext);				
					if Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
						Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_decrease,value_channel_alphastate);
					end;
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PlayerNamecheck") then
				SetGameVar("playername",1);
				else
				SetGameVar("playername",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.MonsterNamecheck") then
				SetGameVar("monstername",1);
				else
				SetGameVar("monstername",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Shadowcheck") then
				SetGameVar("shadow",1);
				else
				SetGameVar("shadow",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Weathercheck") then
				SetGameVar("weather",1);
				else
				SetGameVar("weather",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.Autopopcheck") then
				SetGameVar("autopop",1);
				else
				SetGameVar("autopop",0);
				end;
				
				if Win_IsChecked("UI.gameui.sysconfigdlg.autoreplytab.autoreplydlg.autogotoleavecheck") then
				SetGameVar("autochgstatus", 1);
				else
				SetGameVar("autochgstatus", 0);
				end;
				
				local szInfo = Win_GetText("UI.gameui.sysconfigdlg.autoreplytab.autoreplydlg.autogotoleavetext");
				SetGameVar("szinfo", szInfo);
				
				--913 自动补给
				if Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.validcheck") then
					SetGameVar("autosupplyvalue", 1);
				else
					SetGameVar("autosupplyvalue", 0);
				end;
	
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel1");
				SetGameVar("hpitem1", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel2");
				SetGameVar("hpitem2", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel1");
				SetGameVar("spitem1", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel2");
				SetGameVar("spitem2", szInfo);
				
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel1");
				SetGameVar("hppercent1", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel2");
				SetGameVar("hppercent2", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel1");
				SetGameVar("sppercent1", szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel2");
				SetGameVar("sppercent2", szInfo);
				LoadAutoItemAccount();
				
				--扩展技能栏
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel1");
				OpenExtendSkill(1, szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel2");
				OpenExtendSkill(2, szInfo);
				szInfo = Win_GetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel3");
				OpenExtendSkill(3, szInfo);
			end;
			
			children=
			{			
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={454,19,22,23};
					defaultcancel=1,		
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 431,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetSelect("UI.gameui.sysconfigdlg",0);
						if sel == 1 then
							GameUILogInfo("此功能暂时没有开放！");
						elseif sel == 2 then
							RequestNewbieHelp(help_syscfg_music,-1);
						elseif sel == 3 then
							--RequestNewbieHelp(help_syscfg_autortn,-1);
							GameUILogInfo("此功能暂时没有开放！");
						elseif sel == 4 then
							RequestNewbieHelp(help_syscfg_autohp,-1);
						else
							RequestNewbieHelp(help_sysconfigdlg,-1);
						end;
						end;
				};
				
				applybtn=
				{
					type="BUTTON",
					rect={110,230,90,28};
					bkimage="res/uires/newcommon/applybtn.gsa",					
					defaultok=1,
					updatemute=1,
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={294,231,90,28};
					bkimage="res/uires/newcommon/cancelbtn.gsa",
					defaultcancel=1,
					updatemute=1,
				},

				gamesettab=
				{
					type="TABWIN",
					rect={30,65,439,156},				
					bkimage="res/uires/sysoption/gamesetbk.gsa",
					tabrect={1,3,72,22},
					tabcover="res/uires/sysoption/gamesettab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_sysconfigdlg);
							RequestNewbieHelp(help_syscfg_music,0);
							RequestNewbieHelp(help_syscfg_autohp,0);
						end;
						end;
									
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_sysconfigdlg,
								offsetx=-91,
								offsety=-19,
							},
						};
						
						gamesetdlg=
						{
							type="DIALOG",
							rect = { 0, 0, 430, 156},
							visible=1,
							children=
							{
								--攻击方式
								MouseAttack0= 
								{
									type = "CHECK",
									rect={22,42,165,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=1,
									groupstop=0,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
								MouseAttack1= 
								{
									type = "CHECK",
									rect={22,60,235,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=1,
									groupstop=1,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
																
								--智能施法设置
								Skillcheck= 
								{
									type = "CHECK",
									rect={267,43,118,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",		
									bkimagepos={0,-4};
									caption="是否开启智能施法";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								
								
								--PK
								NoPKcheck= 
								{
									type = "CHECK",
									rect={22,112,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=0,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
								--[[FreePKcheck= 
								{
									type = "CHECK",
									rect={179,94,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=1,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};--]]
								
								TeamPKcheck= 
								{
									type = "CHECK",
									rect={22,131,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=2,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
								FamilyPKcheck= 
								{
									type = "CHECK",
									rect={179,131,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=3,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
								ColorPKcheck= 
								{
									type = "CHECK",
									rect={179,112,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=4,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
								
								JunTuanPKcheck= 
								{
									type = "CHECK",
									rect={345,112,75,16};
									bkimage = "res/uires/newcommon/radiobtn.gsa",	
									bkimagepos={0,-2};
									groupid=0,
									groupstop=5,
									extendstyle=ui_btn_style_radio,
									updatemute=1,
								};
							};
						};
					};
				};
				
				displaysettab=
				{
					type="TABWIN",
					rect={30,65,439,158},					
					--bkimage="res/uires/sysoption/displaysetbk.gsa",
					tabrect={75,3,72,22},
					tabcover="res/uires/sysoption/displaysettab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_sysconfigdlg, 0);
							RequestNewbieHelp(help_syscfg_music,0);
							RequestNewbieHelp(help_syscfg_autohp,0);
						end;
						end;
									
					children=
					{
						displaysetdlg=
						{
							type="DIALOG",
							rect = { 35,0,370,156},
							visible=1,
							children=
							{
								--选项设置
								ChatFadecheck= 
								{
									type = "CHECK",
									rect={20,22,118,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",		
									bkimagepos={0,-4};
									caption="聊天窗口淡出效果";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								PlayerNamecheck= 
								{
									type = "CHECK",
									rect={20,46,118,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-4};
									caption="总是显示玩家名称";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								MonsterNamecheck= 
								{
									type = "CHECK",
									rect={20,73,118,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-4};
									caption="总是显示怪物名称";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								Shadowcheck= 
								{
									type = "CHECK",
									rect={200,73,96,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-4};
									caption="开启影子效果";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								Weathercheck= 
								{
									type = "CHECK",
									rect={200,22,96,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",
									bkimagepos={0,-4};
									caption="开启天气效果";
									updatemute=1,					
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};
								
								Autopopcheck= 
								{
									type = "CHECK",
									rect={200,46,96,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-4};
									caption="自动淡出效果";
									updatemute=1,
									textsize=12,
									textstyle=dt_left;
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},
								};	
								
							    -- 宠物视野数量限制				
								petNumCheck=
								{
									type="LABEL",
									rect={0,109,96,16},
									bkimagepos={0,-2};
									updatemute=1,
									caption="视野宠物数量",
									textstyle=dt_left;
									textsize=12,	
									captionrect={22, 1, 100, 16};
									bkcolor={0,0,0,0},
									drawcolor={221,198,149,255},								
								};
																
								PetNumslider=
								{				
									type="SCROLLBAR",
									rect={99,109,209,16};									
									bkimage="res/uires/sysoption/scrbarbk.gsa",
									bkimagepos={0,5},
									range={0,100},
									pos=1,
									pagesize=20,
									visible=1,	
									updatemute=1,
									
									OnValueChange=function(pos)
										SetGameVar("SetPetNum",pos);
										local ctrname= "UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.";
										Win_SetText(ctrname.."petNumtxt", pos);
										SetPetMaxNumInView(pos);
									end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,26,16},	
											bkimage="res/uires/newcommon/hblock.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,																																
										};--blockbtn														
								
									};--children
									
								};--scroll	

								petNumtxt = 
								{
									type = "LABEL",
									rect = { 308,109,30,16},
									drawcolor = { 255, 255, 0, 255 },						
									textsize=12;
									textstyle=dt_center;
									enable=1;
									
								};								
							};
						};
					};
				};

				musicsettab=
				{
					type="TABWIN",
					rect={30,65,439,158},					
					bkimage="res/uires/sysoption/musicsetbk.gsa",
					tabrect={149,3,72,22},
					tabcover="res/uires/sysoption/musicsettab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_syscfg_music);
							RequestNewbieHelp(help_sysconfigdlg,0);
							RequestNewbieHelp(help_syscfg_autohp,0);
						end;
						end;
						
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_syscfg_music,
								offsetx=-68,
								offsety=-20,
							},
						};
				
						musicsetdlg=
						{
							type="DIALOG",
							rect = { 39,1,370,156},
							visible=1,
							children=
							{
								-- 背景音效
								BackMusiccheck= 
								{
									type = "CHECK",
									rect={20, 26,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										var=Win_GetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusicslider",value_channel_pos);
										SetGameVar("music",var);
										else
										SetGameVar("music",0);
										end;
										Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusicslider",(bcheck==1));
										end;
								};
								
								BackMusicslider=
								{
							
									type="SCROLLBAR",
									rect={124,27,209,16};									
									bkimage="res/uires/sysoption/scrbarbk.gsa",
									bkimagepos={0,5},
									range={1,100},
									pos=1,
									pagesize=20,
									visible=1,	
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.BackMusiccheck") then
										SetGameVar("music",pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,26,16},	
											bkimage="res/uires/newcommon/hblock.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
														
										
									};--children
									
								};--scroll		
							
								-- 环境音效
								EnvMusiccheck= 
								{
									type = "CHECK",
									rect={20,70,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										var=Win_GetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusicslider",value_channel_pos);
										SetGameVar("envsound",var);
										else
										SetGameVar("envsound",0);
										end;
										Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusicslider",(bcheck==1));
										end;
								};
								
								EnvMusicslider=
								{
							
									type="SCROLLBAR",
									rect={124,72,209,16};									
									bkimage="res/uires/sysoption/scrbarbk.gsa",
									bkimagepos={0,5},
									range={1,100},
									pos=1,
									pagesize=20,
									visible=1,	
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.EnvMusiccheck") then
										SetGameVar("envsound",pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,26,16},	
											bkimage="res/uires/newcommon/hblock.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
														
										
									};--children
									
								};--scroll	
								
								-- 一般音效
								NormalMusiccheck= 
								{
									type = "CHECK",
									rect={20,115,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										var=Win_GetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusicslider",value_channel_pos);
										SetGameVar("sound",var);
										else
										SetGameVar("sound",0);
										end;
										Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusicslider",(bcheck==1));
										end;
								};
								
								NormalMusicslider=
								{
							
									type="SCROLLBAR",
									rect={124,116,209,16};									
									bkimage="res/uires/sysoption/scrbarbk.gsa",
									bkimagepos={0,5},
									range={1,100},
									pos=1,
									pagesize=20,
									visible=1,	
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.NormalMusiccheck") then
										SetGameVar("sound",pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,26,16},	
											bkimage="res/uires/newcommon/hblock.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
														
										
									};--children
									
								};--scroll
								
								--话筒音量
								VoiceVolumecheck= 
								{
									type = "CHECK",
									rect={18,84,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									visible=0;
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										SetMicMute(false);
										else
										SetMicMute(true);
										end;
										Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumeslider",(bcheck==1));
										end;
								};
								
								VoiceVolumeslider=
								{
							
									type="SCROLLBAR",
									rect={124,76,190,14};									
									range={1,100},
									pos=1,
									pagesize=20,
									visible=0;
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceVolumecheck") then
										SetMicRecVolume(pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,31,16},	
											bkimage="res/uires/sysoption/blockbtn.gsa",
											bkimagepos={0,2},
											framescheme={{0,0,0,1},{0,0,0,1}};
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
														
										
									};--children
									
								};--scroll
											
								--语音变调
								VoiceTonecheck= 
								{
									type = "CHECK",
									rect={18,108,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									visible=0;
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										var=Win_GetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider",value_channel_pos);
										SetGameVar("tone",var);
										else
										SetGameVar("tone",0);
										end;
										Win_EnableWidget("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceToneslider",(bcheck==1));
										end;
								};
								
								VoiceToneslider=
								{
							
									type="SCROLLBAR",
									rect={124,96,190,14};									
									range={1,100},
									pos=1,
									pagesize=20,
									visible=0;
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceTonecheck") then
										SetGameVar("tone",pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,31,16},	
											bkimage="res/uires/sysoption/blockbtn.gsa",
											bkimagepos={0,2},
											framescheme={{0,0,0,1},{0,0,0,1}};
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
														
										
									};--children
									
								};--scroll
								
								--回音消除
								VoiceAECcheck= 
								{
									type = "CHECK",
									rect={18,131,73,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2};
									updatemute=1,
									visible=0;
									
									OnCheck=function(bcheck)
										if bcheck==1 then
										var=Win_GetValue("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECslider",value_channel_pos);
										SetGameVar("aec",var);
										else
										SetGameVar("aec",0);
										end;
										--Win_EnableWidget("UI.gameui.sysconfigdlg.VoiceAECslider",(bcheck==1));
										end;
								};
								
								VoiceAECslider=
								{
							
									type="SCROLLBAR",
									rect={124,116,190,14};									
									range={1,100},
									pos=1,
									pagesize=20,
									visible=0;
									updatemute=1,
									
									OnValueChange=function(pos)
										if Win_IsChecked("UI.gameui.sysconfigdlg.musicsettab.musicsetdlg.VoiceAECcheck") then
										SetGameVar("aec",pos);
										end;
										end;
										
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,31,16},	
											bkimage="res/uires/sysoption/blockbtn.gsa",
											bkimagepos={0,2},
											framescheme={{0,0,0,1},{0,0,0,1}};
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																				
											
										};--blockbtn
									};--children
								};--scroll
							};
						};
					};
				};
				
				autoreplytab=
				{
					type="TABWIN",
					rect={30,65,439,158},					
					bkimage="res/uires/sysoption/autoreplybk.gsa",
					tabrect={223,3,72,22},
					tabcover="res/uires/sysoption/autoreplytab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_sysconfigdlg,0);
							RequestNewbieHelp(help_syscfg_music,0);
							RequestNewbieHelp(help_syscfg_autohp,0);
						end;
						end;
									
					children=
					{
						autoreplydlg=
						{
							type="DIALOG",
							rect = {2,-1,370,156},
							visible=1,
							children=
							{
								autogotoleavecheck=
								{
									type="CHECK",
									rect={-3,10,240,16},
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0, -2};
								};
								
								autogotoleavetext=
								{
									type="MULTIEDIT",
									rect = {9, 36, 355 ,114},
									extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
									textsize=12,
									rowspace=4,
									bkcolor={0,0,0,0},
									drawcolor={255,255,255,255},
									maxchar=64,	
									editable=1,
									richflag=1,
								};
							};
						};
					};
				};
				
				autosupplytab=
				{
					type="TABWIN",
					rect={30,65,439,158},					
					bkimage="res/uires/sysoption/autosupplybk.gsa",
					tabrect={297,3,72,22},
					tabcover="res/uires/sysoption/autosupplytab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_syscfg_autohp);
							RequestNewbieHelp(help_sysconfigdlg,0);
							RequestNewbieHelp(help_syscfg_music,0);
							LoadAutoItemAccount();
						end;
					end;
									
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_syscfg_autohp,
								offsetx=-93,
								offsety=5,
							},
						};
						
						autosupplydlg=
						{
							type="DIALOG",
							rect = { 24,2,400,156},
							visible=1,
							
							children=
							{
								hpitemlabel1=
								{
									type = "LABEL",
									rect = {57, 33, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								hpitemlistbtn1= 
								{
									type = "CHECK",
									rect = {57,33,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									bkimagepos={124 ,0};
									framescheme={{2,1,2,2},{0,0,0,0}},
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn1")  then
											Win_SetValue("UI.gameui.listdlg",101,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								hpitemlabel2=
								{
									type = "LABEL",
									rect = {57, 50, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								hpitemlistbtn2= 
								{
									type = "CHECK",
									rect = {57,51,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn2")  then
											Win_SetValue("UI.gameui.listdlg",102,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								hpentrylabel1=
								{
									type = "LABEL",
									rect = {217, 34, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								hpentrybtn1= 
								{
									type = "CHECK",
									rect = {217,34,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn1")  then
											Win_SetValue("UI.gameui.listdlg",103,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								hpentrylabel2=
								{
									type = "LABEL",
									rect = {217, 51, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								hpentrybtn2= 
								{
									type = "CHECK",
									rect = {217,51,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn2")  then
											Win_SetValue("UI.gameui.listdlg",104,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								spitemlabel1=
								{
									type = "LABEL",
									rect = {57, 88, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								spitemlistbtn1= 
								{
									type = "CHECK",
									rect = {57,88,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn1")  then
											Win_SetValue("UI.gameui.listdlg",105,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								spitemlabel2=
								{
									type = "LABEL",
									rect = {57, 106, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								spitemlistbtn2= 
								{
									type = "CHECK",
									rect = {57,106,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn2")  then
											Win_SetValue("UI.gameui.listdlg",106,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								spentrylabel1=
								{
									type = "LABEL",
									rect = {217, 88, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								spentrybtn1= 
								{
									type = "CHECK",
									rect = {217,88,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn1")  then
											Win_SetValue("UI.gameui.listdlg",107,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								spentrylabel2=
								{
									type = "LABEL",
									rect = {217, 107, 124, 16},
									textsize=12,
									richmode=ui_richmode_color+ui_richmode_font,
									visible=1,
									initlayer=0;
									enable=0;
								};
								spentrybtn2= 
								{
									type = "CHECK",
									rect = {217,107,140,16 },
									bkimage = "res/uires/newcommon/dropbtn.gsa",	
									framescheme={{2,1,2,2},{0,0,0,0}},
									bkimagepos={124 ,0};
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										if  Win_IsChecked("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn2")  then
											Win_SetValue("UI.gameui.listdlg",108,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",true);
										else 
											Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
											Win_ShowWidget("UI.gameui.listdlg",false);
										end;						     
									end;						
								},
								
								validcheck= 
								{
									type = "CHECK",
									rect={313,132,94,16};
									bkimage = "res/uires/newcommon/checkbox.gsa",	
									bkimagepos={0,-2},
									updatemute=1,
									checked=1,
						
									OnCheck=function(bcheck)
									end;
								};
							};
						};
					};
				};
				
				extendskilltab=
				{
					type="TABWIN",
					rect={30,65,439,158},					
					bkimage="res/uires/sysoption/extendskilltabbk.gsa",
					tabrect={369,3,72,22},
					tabcover="res/uires/sysoption/extendskilltab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=5,
					tabstop=5,
					soundid={1003},
					
					OnCheck=function(bchecked)

					end;
									
					children=
					{
						extendlabel1=
						{
							type = "LABEL",
							rect = {177,24, 124, 16},
							textsize=12,
							richmode=ui_richmode_color+ui_richmode_font,
							visible=1,
							initlayer=0;
							enable=0;
						};
						extendbtn1= 
						{
							type = "CHECK",
							rect = {177,24,140,16 },
							bkimage = "res/uires/newcommon/dropbtn.gsa",	
							framescheme={{2,1,2,2},{0,0,0,0}},
							bkimagepos={124 ,0};
							extendstyle=ui_btn_style_none,
							
							OnClick=function()
								if  Win_IsChecked("UI.gameui.sysconfigdlg.extendskilltab.extendbtn1")  then
									Win_SetValue("UI.gameui.listdlg",121,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",true);
								else 
									Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",false);
								end;						     
							end;			
						},
						
						extendlabel2=
						{
							type = "LABEL",
							rect = {177,63, 124, 16},
							textsize=12,
							richmode=ui_richmode_color+ui_richmode_font,
							visible=1,
							initlayer=0;
							enable=0;
						};
						extendbtn2= 
						{
							type = "CHECK",
							rect = {177,63,140,16 },
							bkimage = "res/uires/newcommon/dropbtn.gsa",	
							framescheme={{2,1,2,2},{0,0,0,0}},
							bkimagepos={124 ,0};
							extendstyle=ui_btn_style_none,
							
							OnClick=function()
								if  Win_IsChecked("UI.gameui.sysconfigdlg.extendskilltab.extendbtn2")  then
									Win_SetValue("UI.gameui.listdlg",122,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",true);
								else 
									Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",false);
								end;						     
							end;			
						},
						
						extendlabel3=
						{
							type = "LABEL",
							rect = {177,99, 124, 16},
							textsize=12,
							richmode=ui_richmode_color+ui_richmode_font,
							visible=1,
							initlayer=0;
							enable=0;
						};
						extendbtn3= 
						{
							type = "CHECK",
							rect = {177,99,140,16 },
							bkimage = "res/uires/newcommon/dropbtn.gsa",	
							framescheme={{2,1,2,2},{0,0,0,0}},
							bkimagepos={124 ,0};
							extendstyle=ui_btn_style_none,
							
							OnClick=function()
								if  Win_IsChecked("UI.gameui.sysconfigdlg.extendskilltab.extendbtn3")  then
									Win_SetValue("UI.gameui.listdlg",123,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",true);
								else 
									Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
									Win_ShowWidget("UI.gameui.listdlg",false);
								end;						     
							end;			
						},
						
						validcheck= 
						{
							type = "CHECK",
							rect={325,130,104,16};
							bkimage = "res/uires/newcommon/checkbox.gsa",	
							bkimagepos={0,-2},
							updatemute=1,
							checked=1,
							visible=0,
				
							OnCheck=function(bcheck)
							end;
						};					
					};
				};
			},					
		};

		
		extendskilldlg=
		{
			type="WIDGET",
			rect={300,311,222,173},
			aligntype=aligntype_father+aligntype_clientrect,
			alignstyle=alignstyle_right_in,
			style=wgtstyle_cleanwin;
			
			marginh = -10;	
			bkimage="res/uires/teamplat/extendsklldlgbk.gsa",
			
			itemmarginv=0,
			itemmarginh=0,
			initlayer=0;
			pluslayer=0;
			moveable=1,
			visible=1,
			updatemute=1,
			
			-- add by nanne for Ext Skill widget pos
			OnDenit = function()
				local posx, posy = Win_GetPos("UI.gameui.extendskilldlg");
				local scrtype = GetScreenType();
				SetExtendSkillDlgInfo(scrtype, posx, posy);
			end;
			-- add by nanne for Ext Skill widget pos
			OnInit = function()
				local oldscrtype, posx, posy = GetExtendSkillDlgInfo();
				local scrtype = GetScreenType();
				local delta = 30
				if scrtype ~= oldscrtype then	
					if scrtype == 0 then  		--当前屏幕分辨率为800x600
						posx = 580;
						posy = 350;
					elseif scrtype == 1 then   	-- 当前屏幕为1024x768
						posx = 800;
						posy = 500;
					elseif scrtype == 2 then   	-- 当前屏幕为1280*800
						posx = 1050;
						posy = 550;
					end;
				end;
				Win_SetPos("UI.gameui.extendskilldlg", posx, posy);
			end;
			
			OnSelfShow = function()
				local nskillcount1, nskillcount2, nskillcount3 = GetExtendSkillNum();
				local nmaxskillcount = nskillcount1;
				if nskillcount2 > nmaxskillcount then
					nmaxskillcount = nskillcount2;
				end;
				if nskillcount3 > nmaxskillcount then
					nmaxskillcount = nskillcount3;
				end; 
				
				if nskillcount1 < 5 then
					for i=1,nskillcount1 do				
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
					for i= nskillcount1+1, 5 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
					end;
				else
					for i= 1, 5 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
				end;
				
				local tmp2 = nskillcount2+5;
				if nskillcount2 < 5 then
					for i=6,tmp2 do				
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
					for i= tmp2+1, 10 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
					end;
				else
					for i= 6, 10 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
				end;

				local tmp3 = nskillcount3+10;
				if nskillcount3 < 5 then
					for i=11,tmp3 do				
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
					for i= tmp3+1, 15 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, false);
					end;
				else
					for i= 11, 15 do
						Win_ShowWidget("UI.gameui.extendskilldlg.skill"..i, true);
					end;
				end;
				local bLock = GetExtendSkillLock();
				if bLock == 1 then
					UI.children.gameui.children.ExtendSkillMenu.children.lockbtn.OnClick();
				else
					UI.children.gameui.children.ExtendSkillMenu.children.movebtn.OnClick();
				end;				
				--local nTmp = 10 + (5-nmaxskillcount)*40;
				--Win_AlignWidget("UI.gameui.extendskilldlg", "UI.gameui", aligntype_winrect, alignstyle_right_in, nTmp);
			end;

			children=
			{
				menubtn=
				{
					type="BUTTON",
					rect={196,5,22,23};
					bkimage="res/uires/newcommon/miniclose.gsa",
					tiptext="扩展技能栏菜单",
					visible=1,
						
					OnClick=function()
						Win_ShowWidget("UI.gameui.ExtendSkillMenu.movebtn", false);
						Win_ShowWidget("UI.gameui.ExtendSkillMenu.lockbtn", true);
						Win_ShowWidget("UI.gameui.ExtendSkillMenu.setupbtn", false);
						Win_ShowWidget("UI.gameui.ExtendSkillMenu.closebtn", true);
						Win_ShowWidget("UI.gameui.ExtendSkillMenu", true);
						Win_SetFocus("UI.gameui.ExtendSkillMenu");
					end;
				};
				
				skill1=
				{
					type = "WIDGET",
					rect = { 11,38,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=0,
					visible=1,
					updatemute=1,
					
					OnRClick=function()
						SetDefaultSkill(0, 1);
					end;					
				};
				skill2=
				{
					type = "WIDGET",
					rect = { 51,38,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=1,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(1, 1);
					end;					
				};
				skill3=
				{
					type = "WIDGET",
					rect = { 92,38,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=2,
					visible=1,
					updatemute=1,	

					OnRClick=function()
						SetDefaultSkill(2, 1);
					end;					
				};
				skill4=
				{
					type = "WIDGET",
					rect = { 133,38,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=3,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(3, 1);
					end;					
				};	
				skill5=
				{
					type = "WIDGET",
					rect = { 174,38,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=4,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(4, 1);
					end;					
				};	
				skill6=
				{
					type = "WIDGET",
					rect = { 11,79,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=5,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(5, 1);
					end;					
				};	
				skill7=
				{
					type = "WIDGET",
					rect = { 51,79,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=6,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(6, 1);
					end;					
				};	
				skill8=
				{
					type = "WIDGET",
					rect = { 92,79,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=7,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(7, 1);
					end;					
				};	
				skill9=
				{
					type = "WIDGET",
					rect = { 133,79,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=8,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(8, 1);
					end;					
				};	
				skill10=
				{
					type = "WIDGET",
					rect = { 174,79,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=9,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(9, 1);
					end;					
				};	
				skill11=
				{
					type = "WIDGET",
					rect = { 11,121,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=10,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(10, 1);
					end;					
				};	
				skill12=
				{
					type = "WIDGET",
					rect = { 51,121,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=11,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(11, 1);
					end;					
				};	
				skill13=
				{
					type = "WIDGET",
					rect = { 92,121,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=12,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(12, 1);
					end;					
				};	
				skill14=
				{
					type = "WIDGET",
					rect = { 133,120,36,36},
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=13,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(13, 1);
					end;					
				};	
				skill15=
				{
					type = "WIDGET",
					rect = { 174,120,36,36 },
					bkimage="res/uires/sysoption/skillitemrect.gsa";
					bkimagepos={-3,-3},
					framescheme={{0},{1}},
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					dragtype=ui_drag_type_extendskilllist,
					dragmode=1,	-- 延迟拖拉
					dragindex=14,
					visible=1,
					updatemute=1,	
					
					OnRClick=function()
						SetDefaultSkill(14, 1);
					end;					
				};	
			};			
		};
		
		sysoptiondlg=
		{
			type="DIALOG",
			rect = { 0, 0, 192, 236},	
			bkimage="res/uires/sysoption/sysoptiondlg.gsa",	
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_topmost,
			
			accel=
			{
				{"UI.children.gameui.children.sysoptiondlg.OnAccel_OnUp",38},--up选项上
				{"UI.children.gameui.children.sysoptiondlg.OnAccel_OnDown",40},--down选项下			
			};
						
			OnAccel_OnUp=function()
					      stop=Win_GetSelect("UI.gameui.sysoptiondlg",0);
					      
					      if stop<2 then
					      stop=5;
					      elseif stop>2 then
					      stop=stop-1;
					      else					      
					      if Win_IsVisible("UI.gameui.sysoptiondlg.returngamebtn") then
					      stop=0;
					      else
					      stop=1;
					      end;
					      end;
					      
					      Win_SetSelect("UI.gameui.sysoptiondlg",0,stop);
					      end;
			
			OnAccel_OnDown=function()
					      stop=Win_GetSelect("UI.gameui.sysoptiondlg",0);
					      
					      if stop<2 then
					      stop=2;
					      elseif stop<5 then
					      stop=stop+1;
					      else					      
					      if Win_IsVisible("UI.gameui.sysoptiondlg.returngamebtn") then
					      stop=0;
					      else
					      stop=1;
					      end;
					      end;
					      
					      Win_SetSelect("UI.gameui.sysoptiondlg",0,stop);
					      end;
			
			
			
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.sysoptiondlg",false);
				end;
						
			OnSelfShow=function()
				if Win_IsVisible("UI.newsecuverifydlg") then
					Win_ShowWidget("UI.newsecuverifydlg",false);
				end;
				
				if Win_IsVisible("UI.newsafesecuverifydlg") then
					Win_ShowWidget("UI.newsafesecuverifydlg",false);
				end;
				
				if IsPlayerLive() then
				Win_ShowWidget("UI.gameui.sysoptiondlg.returngamebtn",true);
				Win_ShowWidget("UI.gameui.sysoptiondlg.reliveplayerbtn",false);
				else
					if IsInBattle() ~= 0 then
						Win_ShowWidget("UI.gameui.sysoptiondlg.returngamebtn",true);
						Win_ShowWidget("UI.gameui.sysoptiondlg.reliveplayerbtn",false);
					else
						Win_ShowWidget("UI.gameui.sysoptiondlg.returngamebtn",false);
						Win_ShowWidget("UI.gameui.sysoptiondlg.reliveplayerbtn",true);
					end;
				end;
				
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,600);
				end;					
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;		
				--}}add by finnwang [2007-09-04]
				
				Win_SetCapture("UI.gameui.sysoptiondlg");
				Win_SetFocus("UI.gameui.sysoptiondlg");
				
				if IsArenaInFighting() == true then
					Win_EnableWidget("UI.gameui.sysoptiondlg.selplayerbtn", false);
				else
					Win_EnableWidget("UI.gameui.sysoptiondlg.selplayerbtn", true);
				end;
			end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				--}}add by finnwang [2007-09-04]
				
				end;
			
			OnOk=function()
				  local stop=Win_GetSelect("UI.gameui.sysoptiondlg",0);
				  
				  if stop==1 then
					if IsInPKReliveMap() == 1 and IsPlayerLive() == false then
						Win_ShowWidget("UI.gameui.pvprevivedlg",true);
					else
						Revive();
					end;	
				 
				  elseif stop==2 then
					Win_ShowWidget("UI.gameui.sysconfigdlg",true);
				  elseif stop==3 then
					Quit(3);
				  elseif stop==4 then
					Quit(2);
				  elseif stop==5 then
					QueryQuit();
				  end;
				  
			end;
			
			children=
			{			
				
				returngamebtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/returngame.gsa";
					rect={20,40,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=0,
					checked=1,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.sysoptiondlg.returngamebtn");							 
							 end;
					
				};
		
				reliveplayerbtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/reliveplayer.gsa";
					rect={20,40,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultok=0,
					groupid=0,
					groupstop=1,
					visible=0,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.sysoptiondlg.reliveplayerbtn");							 
							 end;					
					
				};
				
				
				sysconfigbtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/sysconfig.gsa";
					rect={20,71,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultok=1,
					groupid=0,
					groupstop=2,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.sysoptiondlg.sysconfigbtn");							 
							 end;
					
						    
				};			
				
				selplayerbtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/selplayer.gsa";
					rect={20,102,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultok=1,
					groupid=0,
					groupstop=3,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.sysoptiondlg.selplayerbtn");							 
					 end;
								
				};
		
		
				selserverbtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/selserver.gsa";
					rect={20,134,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultok=1,
					groupid=0,
					groupstop=4,
					updatemute=1,					
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.sysoptiondlg.selserverbtn");							 
							 end;					
					
				};
		
		
				quitgamebtn=
				{
					type="CHECK";
					bkimage="res/uires/sysoption/quitgame.gsa";
					rect={20,165,149,29};
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultok=1,
					groupid=0,
					groupstop=5,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.sysoptiondlg.quitgamebtn");							 
							 end;					
					
				};
			},					
			
		};
		
		--pipo 防守型副本 复活选项
		pworldrevivedlg=
		{
			type="DIALOG",
			rect={0,0,192,108},
			bkimage="res/uires/revivedlg/pworldrevivebk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0;
			
			OnSelfShow=function()
			end;
			
			OnSelfHide=function()
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.pworldrevivedlg",false);
			end;
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.pworldrevivedlg",false);				     
			end;
			
			children=
			{
				bowlderrevivebtn=
				{
					type="CHECK",
					rect={19,35,152,33},
					bkimage="res/uires/revivedlg/bowlderrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					checked=1,
					groupid=0,
					groupstop=0,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.pworldrevivedlg.bowlderrevivebtn");							 
					end;	
					
					OnClick=function()
						ReviveOption(6);
					end;
				};
				
				exitrevivebtn=
				{
					type="CHECK",
					rect={19,70,152,33},
					bkimage="res/uires/revivedlg/pworldexitbtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=1,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.pworldrevivedlg.exitrevivebtn");							 
					end;	
					
					OnMsgBoxOk=function()
						ReviveOption(0);						
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定退出战场?","提示",ui_msgid_yesno,"UI.gameui.pworldrevivedlg.exitrevivebtn");
					end;
				};
			};
		};
		
		revivedlg=
		{
			type="DIALOG",
			rect={0,0,192,189},
			bkimage="res/uires/revivedlg/revivedlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_top_in,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0;
				
			OnSelfShow=function()
				if Win_IsVisible("UI.newsecuverifydlg") then
					Win_ShowWidget("UI.newsecuverifydlg",false);
				end;
				
				if Win_IsVisible("UI.newsafesecuverifydlg") then
					Win_ShowWidget("UI.newsafesecuverifydlg",false);
				end;
				
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,600);
				end;		
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;		
				--}}add by finnwang [2007-09-04]
				
				Win_SetCapture("UI.gameui.revivedlg");
				Win_SetFocus("UI.gameui.revivedlg");
				end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				--}}add by finnwang [2007-09-04]
				
				end;
				
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.revivedlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;

			OnCancel=function()
				Win_ShowWidget("UI.gameui.revivedlg",false);
				end;
				
			OnTimer=function()
				local iSecond = Win_GetValue("UI.gameui.revivedlg.newskillrevivebtn", value_channel_customid);
				iSecond = iSecond-1;

				Win_SetValue("UI.gameui.revivedlg.newskillrevivebtn", iSecond, value_channel_customid);
				Win_SetText("UI.gameui.revivedlg.newskillrevivebtn.lefttimelabel", iSecond);
				
				if iSecond <= 0 then
					Win_SetText("UI.gameui.revivedlg.newskillrevivebtn.lefttimelabel", "");
					Win_SetValue("UI.gameui.revivedlg", -1,value_channel_timerspace);
					Win_EnableWidget("UI.gameui.revivedlg.newskillrevivebtn", false);
				else
					Win_SetValue("UI.gameui.revivedlg", 1, value_channel_timerspace);
				end;
			end;
				  
			children=
			{
				revivebtn=
				{
					type="CHECK",
					rect={19,35,152,33},
					bkimage="res/uires/revivedlg/revivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					checked=1,
					groupid=0,
					groupstop=0,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.revivedlg.revivebtn");							 
					end;	
					
					OnMsgBoxOk=function()
						ReviveOption(0);
						Win_ShowWidget("UI.gameui.revivedlg",false);						
					end;
					
					OnClick=function()
						Win_ShowMsgBox("您是否确定重生?","提示",ui_msgid_yesno,"UI.gameui.revivedlg.revivebtn");
					end;
				};
				
				itemrevivebtn=
				{
					type="CHECK",
					rect={19,70,152,33},
					bkimage="res/uires/revivedlg/itemrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=1,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.revivedlg.itemrevivebtn");							 
							 end;	
					 
					OnClick=function()
						ReviveOption(1);
						end;
				};
				
				skillrevivebtn=
				{
					type="CHECK",
					rect={19,105,152,33},
					bkimage="res/uires/revivedlg/skillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					groupid=0,
					groupstop=2,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.revivedlg.skillrevivebtn");							 
					end;	
					
					OnMsgBoxOk=function()
						ReviveOption(2);
						Win_ShowWidget("UI.gameui.revivedlg",false);						
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定使用回魂娃娃重生?","提示",ui_msgid_yesno,"UI.gameui.revivedlg.skillrevivebtn");
					end;
				};
				
				newskillrevivebtn=
				{
					type="CHECK",
					rect={19,140,152,33},
					bkimage="res/uires/revivedlg/newskillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=3,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.revivedlg.newskillrevivebtn");							 
					end;	
					
					OnClick=function()
						ReviveOption(5);
					end;
					
					children=
					{
						lefttimelabel= 
						{
							type = "LABEL",
							rect = { 77, 6, 42, 20 },
							caption="99",
						};
					};
				};
			};
		};
		
		exrevivedlg=
		{
			type="DIALOG",
			rect={0,0,192,190},
			bkimage="res/uires/revivedlg/exrevivebk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0;
				
			OnSelfShow=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;	
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;	
				--}}add by finnwang [2007-09-04]
				
				Win_SetCapture("UI.gameui.exrevivedlg");
				Win_SetFocus("UI.gameui.exrevivedlg");
				end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				--}}add by finnwang [2007-09-04]
				
				end;
				
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.exrevivedlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;

			OnCancel=function()
				Win_ShowWidget("UI.gameui.exrevivedlg",false);
			end;
				
			OnTimer=function()
				local iSecond = Win_GetValue("UI.gameui.exrevivedlg.newskillrevivebtn", value_channel_customid);
				iSecond = iSecond-1;

				Win_SetValue("UI.gameui.exrevivedlg.newskillrevivebtn", iSecond, value_channel_customid);
				Win_SetText("UI.gameui.exrevivedlg.newskillrevivebtn.lefttimelabel", iSecond);
				
				if iSecond <= 0 then
					Win_SetText("UI.gameui.exrevivedlg.newskillrevivebtn.lefttimelabel", "");
					Win_SetValue("UI.gameui.exrevivedlg", -1,value_channel_timerspace);
					Win_EnableWidget("UI.gameui.exrevivedlg.newskillrevivebtn", false);
				else
					Win_SetValue("UI.gameui.exrevivedlg", 1, value_channel_timerspace);
				end;
			end;
				  
			children=
			{
				revivebtn=
				{
					type="CHECK",
					rect={19,35,152,33},
					bkimage="res/uires/revivedlg/revivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					checked=1,
					groupid=0,
					groupstop=0,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.exrevivedlg.revivebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(0);	
						Win_ShowWidget("UI.gameui.exrevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定重生?","提示",ui_msgid_yesno,"UI.gameui.exrevivedlg.revivebtn");
					end;
				};
				
				itemrevivebtn=
				{
					type="CHECK",
					rect={19,70,152,33},
					bkimage="res/uires/revivedlg/itemrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=1,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.exrevivedlg.itemrevivebtn");							 
							 end;	
					 
					OnClick=function()
						ReviveOption(1);
						end;
				};
				
				skillrevivebtn=
				{
					type="CHECK",
					rect={19,105,152,33},
					bkimage="res/uires/revivedlg/skillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					groupid=0,
					groupstop=2,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.exrevivedlg.skillrevivebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(2);	
						Win_ShowWidget("UI.gameui.exrevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定使用回魂娃娃重生?","提示",ui_msgid_yesno,"UI.gameui.exrevivedlg.skillrevivebtn");
					end;
				};
				
				hpwwrevivebtn=
				{
					type="CHECK",
					rect={19,140,152,33},
					bkimage="res/uires/revivedlg/hpwwbtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=3,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.exrevivedlg.hpwwrevivebtn");							 
							 end;	
					
					OnClick=function()
						ReviveOption(3);
						end;
				};
				
				newskillrevivebtn=
				{
					type="CHECK",
					rect={19,174,152,33},
					bkimage="res/uires/revivedlg/newskillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=3,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.exrevivedlg.newskillrevivebtn");							 
					end;	
					
					OnClick=function()
						ReviveOption(5);
					end;
					
					children=
					{
						lefttimelabel= 
						{
							type = "LABEL",
							rect = { 89, 6, 30, 20 },
							caption="99",
						};
					};
				};
			};
		};
		
		houserevivedlg=
		{
			type="DIALOG",
			rect={0,0,192,197},
			bkimage="res/uires/revivedlg/revivedlgbk2.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0;
				
			OnSelfShow=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,600);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;
				--}}add by finnwang [2007-09-04]
				
				Win_SetCapture("UI.gameui.houserevivedlg");
				Win_SetFocus("UI.gameui.houserevivedlg");
				end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				
				--{{add by finnwang [2007-09-04]
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				--}}add by finnwang [2007-09-04]

				end;
				
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.houserevivedlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;

			OnCancel=function()
				Win_ShowWidget("UI.gameui.houserevivedlg",false);
				end;
				
			OnTimer=function()
				local iSecond = Win_GetValue("UI.gameui.houserevivedlg.newskillrevivebtn", value_channel_customid);
				iSecond = iSecond-1;

				Win_SetValue("UI.gameui.houserevivedlg.newskillrevivebtn", iSecond, value_channel_customid);
				Win_SetText("UI.gameui.houserevivedlg.newskillrevivebtn.lefttimelabel", iSecond);
				
				if iSecond <= 0 then
					Win_SetText("UI.gameui.houserevivedlg.newskillrevivebtn.lefttimelabel", "");
					Win_SetValue("UI.gameui.houserevivedlg", -1,value_channel_timerspace);
					Win_EnableWidget("UI.gameui.houserevivedlg.newskillrevivebtn", false);
				else
					Win_SetValue("UI.gameui.houserevivedlg", 1, value_channel_timerspace);
				end;
			end;
				  
			children=
			{
				revivebtn=
				{
					type="CHECK",
					rect={19,23,152,33},
					bkimage="res/uires/revivedlg/revivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					checked=1,
					groupid=0,
					groupstop=0,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.houserevivedlg.revivebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(0);
						Win_ShowWidget("UI.gameui.houserevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定重生?","提示",ui_msgid_yesno,"UI.gameui.houserevivedlg.revivebtn");
					end;
				};
				
				itemrevivebtn=
				{
					type="CHECK",
					rect={19,58,152,33},
					bkimage="res/uires/revivedlg/itemrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=1,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.houserevivedlg.itemrevivebtn");							 
							 end;	
					 
					OnClick=function()
						ReviveOption(1);
						end;
				};
				
				skillrevivebtn=
				{
					type="CHECK",
					rect={19,93,152,33},
					bkimage="res/uires/revivedlg/skillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					groupid=0,
					groupstop=2,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.houserevivedlg.skillrevivebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(2);
						Win_ShowWidget("UI.gameui.houserevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定使用回魂娃娃重生?","提示",ui_msgid_yesno,"UI.gameui.houserevivedlg.skillrevivebtn");
					end;
				};
				
				fmhousebtn=
				{
					type="CHECK",
					rect={19,128,152,33},
					bkimage="res/uires/revivedlg/fmhousebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					--defaultcancel=1,
					groupid=0,
					groupstop=3,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.houserevivedlg.fmhousebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(4);
						Win_ShowWidget("UI.gameui.houserevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定回家族屋重生?","提示",ui_msgid_yesno,"UI.gameui.houserevivedlg.fmhousebtn");
					end;
				};
				
				fmfronthousebtn=
				{
					
					type="CHECK",
					rect={19,128,152,33},
					bkimage="res/uires/sysoption/backfmhouse.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					visible=0,
					groupid=0,
					groupstop=4,
					updatemute=1,
					
					OnMouseIn=function()
							 Win_SelectSelf("UI.gameui.houserevivedlg.fmfronthousebtn");							 
							 end;	
					
					OnMsgBoxOk=function()
						ReviveOption(4);
						Win_ShowWidget("UI.gameui.houserevivedlg",false);
					end;
					
					OnClick=function()					
						Win_ShowMsgBox("您是否确定回家前院重生?","提示",ui_msgid_yesno,"UI.gameui.houserevivedlg.fmfronthousebtn");
					end;

				};
				newskillrevivebtn=
				{
					type="CHECK",
					rect={19,163,152,33},
					bkimage="res/uires/revivedlg/newskillrevivebtn.gsa",
					framescheme={{0,2,2,3},{0,1,1,3}},
					extendstyle=ui_btn_style_radio,
					defaultcancel=1,
					groupid=0,
					groupstop=5,
					updatemute=1,
					
					OnMouseIn=function()
						Win_SelectSelf("UI.gameui.revivedlg.newskillrevivebtn");							 
					end;	
					
					OnClick=function()
						ReviveOption(5);
					end;
					
					children=
					{
						lefttimelabel= 
						{
							type = "LABEL",
							rect = { 71, 6, 30, 20 },
							caption="99",
						};
					};
				};

			};
		};
		
		
		advertisedlg=
		{
			type = "DIALOG",
			rect = { 0,0,471,507},
			bkimage="res/uires/titleui/treaty.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			alphaspeed=0.1,
			alphafactor=0.0,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.advertisedlg",0,value_channel_alphafactor);
				Win_SetValue( "UI.gameui.advertisedlg.advertiseedit",0,value_channel_range_begin);
				Win_SetValue( "UI.gameui.advertisedlg.advertiseedit",0,value_channel_range_end);
				Win_SetFocus("UI.gameui.advertisedlg.advertiseedit");
				end;

			children=
			{
								
				captionlabel= 
				{
					type = "LABEL",
					rect = { 104,22,101,19 },
					bkimage = "res/uires/titleui/update.gsa",
					enable=0,
				};	
				
				affirmbtn= 
				{
					type = "BUTTON",
					rect = { 361,466,70,22 },
					bkimage = "res/uires/common/affirmbtn.gsa",
					soundid={1006},
					defaultok=1,					
				};		
				
		
				advertiseedit= 
				{
					type = "MULTIEDIT",
					rect = { 68,50,338,408 },
					textsize=12,
					textfont=0,
					rowspace=4,
					maxchar=170000,
					editable=0,
					linkcolor={255,255,0,255},
					
					children=
					{	
						captionlabel=
						{
							type="LABEL",
							rect={40,-27,101,19},
							bkimage="res/uires/titleui/update.gsa",
							enable=0,
							visible=0,
						};
						
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={353,13,15,380},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};
				
			};
		
		};
		
		worktipmenu=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;			
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			visible=0,
			updatemute=1,
				
			
			OnSelfShow=function()
				cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.worktipmenu",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.worktipmenu");
				end;

			children=
			{
				fishbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="钓 鱼",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.worktipmenu",false);
						BeginWork(1);
						end;
				};
				
				minebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="挖 矿",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.worktipmenu",false);
						BeginWork(2);								
						end;
				};
				
			};
		};
		
		ExtendSkillMenu2=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;
			visible=0,	
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
			
			OnSelfShow=function()
				local cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.ExtendSkillMenu2",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.ExtendSkillMenu2");
			end;
			
			children=
			{
				movebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="幻想宝典",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function() 					
						Win_ShowWidget("UI.gameui.ExtendSkillMenu2", false);
						local ret = CheckUIRight();
						if ret ~= 0 then
							Win_ShowWidget("UI.gameui.integdlg",true);
						end;
					end;
				};
				lockbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="近期热点",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.ExtendSkillMenu2", false);
						
						if Win_IsVisible("UI.gameui.chongzhidlg") == true then
							Win_ShowWidget("UI.gameui.chongzhidlg", false);
							CloseRequireExchgBowlder();
						end;
						
						if Win_IsVisible("UI.gameui.hotnewsdlg") == false then
							Win_ShowWidget("UI.gameui.hotnewsdlg", true);
						end;
					end;
				};
			};
		};
	
		ExtendSkillMenu=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;
			visible=0,	
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
			
			OnSelfShow=function()
				local cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.ExtendSkillMenu",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.ExtendSkillMenu");
			end;
			
			children=
			{
				movebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="扩展技能栏移动",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_SetValue("UI.gameui.extendskilldlg", 1, value_channel_moveable, 0); 
						Win_SetValue("UI.gameui.extendskilldlg", 1, value_channel_moveable, 1); 					
						Win_ShowWidget("UI.gameui.ExtendSkillMenu", false);
						Win_SetText("UI.gameui.sketchbar.sketchmap.extendskillbtn","res/uires/sketchmap/kuo_yellow.gsa",value_channel_backpic);
						Win_SetText("UI.gameui.extendskilldlg","res/uires/teamplat/extendsklldlgbk.gsa",value_channel_backpic);
						Win_ShowWidget("UI.gameui.extendskilldlg.menubtn", true);
						SetExtendSkillLock(0);
					end;
				};
				lockbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="扩展技能栏锁定",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_SetValue("UI.gameui.extendskilldlg", 0, value_channel_moveable, 0); 
						Win_SetValue("UI.gameui.extendskilldlg", 0, value_channel_moveable, 1); 
						Win_ShowWidget("UI.gameui.ExtendSkillMenu", false);
						Win_SetText("UI.gameui.sketchbar.sketchmap.extendskillbtn","res/uires/sketchmap/kuo_red.gsa",value_channel_backpic);
						Win_SetText("UI.gameui.extendskilldlg","",value_channel_backpic);
						Win_ShowWidget("UI.gameui.extendskilldlg.menubtn", false);
						SetExtendSkillLock(1);
					end;
				};
				setupbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="扩展技能栏设置",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ToggleWidget("UI.gameui.sysconfigdlg");
						Win_SetCheck("UI.gameui.sysconfigdlg.gamesettab",false);
						Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab",false);
						Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab",false);
						Win_SetCheck("UI.gameui.sysconfigdlg.autoreplytab",false);
						Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab",false);
						Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab",true);
						Win_ShowWidget("UI.gameui.ExtendSkillMenu", false);
					end;
				};
				closebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="扩展技能栏关闭",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						OpenExtendSkill(1, "关闭");
						OpenExtendSkill(2, "关闭");
						OpenExtendSkill(3, "关闭");
						Win_ShowWidget("UI.gameui.ExtendSkillMenu", false);
						Win_SetText("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip", "点击此按钮重新打开扩展技能栏。");
						
						local x, y = Win_GetPos("UI.gameui.sketchbar.sketchmap.extendskillbtn");
						Win_SetText("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
						local w = Win_GetValue("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",value_channel_winrect,2);
						Win_SetValue("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",w-9,value_channel_coverpicpos,0);
						Win_SetValue("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",22,value_channel_coverpicpos,1);
						
						Win_AlignWidget("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip", "UI.gameui.sketchbar.sketchmap.extendskillbtn", aligntype_winrect+aligntype_clientrect, alignstyle_left_out+alignstyle_top_out, -8, 18);
						Win_ShowWidget("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",true);
						
						Win_SetValue("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",10, value_channel_timerspace);							
					end;
				};
			};			
		};
	
		-- 帮助菜单
		helpmenu=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;
			visible=0,	
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
			
			OnSelfShow=function()
				local cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.helpmenu",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.helpmenu");	  
			end;
			
			children=
			{
				--[[
				openhelpwinbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看帮助",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.helpmenu", false);
						Win_ShowWidget("UI.gameui.helpwindlg", true);
					end;
				};
				--]]
				
				quicksearchbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="快速搜索",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.quicksearchdlg", true);
						Win_ShowWidget("UI.gameui.helpmenu", false);
					end;
				};
				
				closespritebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="收回帮助精灵",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						ChangeHelpAction(1); -- 由客户端调用关闭
						
						SetHelpVar("showhelpsprite", 0);
						Win_ShowWidget("UI.gameui.helpmenu", false);
					end;
				};
				
				openspritebtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="召唤帮助精灵",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.helpspritedlg", true);
						--Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn", false);
						
						SetHelpVar("showhelpsprite", 1);
						Win_ShowWidget("UI.gameui.helpmenu", false);
					end;
				};
				
				closedailyhelpbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="关闭每日帮助",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=4,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						SetHelpVar("dailyhelp", 0);
						Win_ShowWidget("UI.gameui.helpmenu", false);
						
						if Win_IsVisible("UI.gameui.helpspritedlg") then
							Win_SetValue("UI.gameui.helpspritedlg", -1, value_channel_timerspace);
						end;
						
						if Win_IsVisible("UI.gameui.sketchbar.sketchmap.helpshowbtn") then
							Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn", -1, value_channel_timerspace);
						end;
					end;
				};
				
				opendailyhelpbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="显示每日帮助",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=5,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						SetHelpVar("dailyhelp", 1);
						if Win_IsVisible("UI.gameui.helpspritedlg") then
							Win_SetValue("UI.gameui.helpspritedlg", 600, value_channel_timerspace);
						end;
						
						if Win_IsVisible("UI.gameui.sketchbar.sketchmap.helpshowbtn") then
							Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn", 600, value_channel_timerspace);
						end;
						
						Win_ShowWidget("UI.gameui.helpmenu", false);
					end;
				};
				
				lockposbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="启动位置锁定",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=6,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						SetHelpVar("lockspritepos", 1);
						Win_ShowWidget("UI.gameui.helpmenu", false);
						Win_SetValue("UI.gameui.helpspritedlg", 0, value_channel_moveable, 0); 
						Win_SetValue("UI.gameui.helpspritedlg", 0, value_channel_moveable, 1); 
					end;
				};
				
				unlockposbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="关闭位置锁定",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=7,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						SetHelpVar("lockspritepos", 0);
						Win_ShowWidget("UI.gameui.helpmenu", false);
						Win_SetValue("UI.gameui.helpspritedlg", 1, value_channel_moveable, 0); 
						Win_SetValue("UI.gameui.helpspritedlg", 1, value_channel_moveable, 1); 
					end;
				};
			};
		};
				
		playermenu=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;
			visible=0,	
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
			
			OnSelfShow=function()
				local cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.playermenu",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.playermenu");	  
				end;
						
			
			children=
			{
				kickbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="踢出竞技场",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						local id = Win_GetValue("UI.gameui.playermenu", value_channel_customid);
						OpenArenaMember(0, id);												
					end;
				};
				
				changeownerbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="转移房主",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						local id = Win_GetValue("UI.gameui.playermenu", value_channel_customid);
						ChangeArenaOwner(id);
					end;
				};
				
				whisperbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="密 语",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);												
						Win_SetText("UI.gameui.chatbar.inputbar.chateredit",menuname);
						Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
						end;
				};
				
				gossipbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="交 谈",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						GossipTalk(menuname,"");
						end;
				};
				
				dealbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请参加交易",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=4,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
							Win_ShowWidget("UI.gameui.playermenu",false);
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							DealRequest(menuname);    
							end;
				};
				
				
				maketeam=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请组队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=5,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
							Win_ShowWidget("UI.gameui.playermenu",false);
							local menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							--Win_SetText("UI.gameui.teamconfigdlg.neighboredit",menuname);
							--Win_ShowWidget("UI.gameui.teamconfigdlg",true);
							Win_ShowWidget("UI.gameui.exteamconfigdlg",true);
							local rt = AddToStandbyMemberByName(menuname);
							if rt ~= 0 then UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList(); end;
							end;
						
					
				};

				jointeam=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="请求入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=6,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						TeamJoin(menuname, "请求加入队伍!");
						Win_ShowWidget("UI.gameui.playermenu",false);
					end;
				},
				
				
				inviteteam=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=7,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							Win_ShowWidget("UI.gameui.playermenu",false);
							local rst = TeamInvite(menuname,"邀请您加入队伍!");
							if rst ~= 0 then
							Win_ShowMsgBox("组队请求已经发送！");
							end;
							end;
				},
				
				
				kickteam=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="踢出队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						TeamKickout(menuname);
						end;						
				},
				
				followteam=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="跟随队长",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=9,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
							Win_ShowWidget("UI.gameui.playermenu",false);
							FollowTeamLeader();
							end;
				},
				
				--竞技场切换观战,客户端将竞技场容入队伍处理
				changesight=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="切换观战",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=10,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
							Win_ShowWidget("UI.gameui.playermenu",false);
							UI.children.gameui.CloseMainLabelBK();
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							ArenaChangeSight(menuname);
							end;
				},
				
				followplayer=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="跟随玩家",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=11,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						FollowPlayer(menuname);
						end;
				},					
				
				invitefriend=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="加为好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=12,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "0");
						Win_SetText("UI.gameui.inputcontentdlg.title", "申请加为好友");
						Win_ShowWidget("UI.gameui.inputcontentdlg", true);
					end;
				},
				
				inviteQQ=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="加为QQ好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=13,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						QQBuddyReqAdd(menuname);
						end;
				},
				
				
				makemaster=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="拜  师",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=14,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
							Win_ShowWidget("UI.gameui.playermenu",false);
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							--MasterRequest(menuname);
							if menuname~="" then
								Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
								Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "4");
								Win_SetText("UI.gameui.inputcontentdlg.title", "申请拜师");
								Win_ShowWidget("UI.gameui.inputcontentdlg", true);
							end;
							end;
				},
				
				makeprentice=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="收  徒",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=15,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
							Win_ShowWidget("UI.gameui.playermenu",false);
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							--ApprRequest(menuname);
							if menuname~="" then
								Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
								Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "5");
								Win_SetText("UI.gameui.inputcontentdlg.title", "申请收徒");
								Win_ShowWidget("UI.gameui.inputcontentdlg", true);
							end;
							end;	
				},
				
				kickmaster=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="请求退出师门",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=16,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						LeaveMasterRequest(menuname);
						Win_ShowWidget("UI.gameui.playermenu",false);
						end;							
				},
				
				betraymaster=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="强行退出师门",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=17,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						MasterBetray(menuname);
						Win_ShowWidget("UI.gameui.playermenu",false);
						end;	
				},					
				
				kickprentice=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="解除师徒关系",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=18,
					soundid={1005,1003},
					updatemute=1,
					
					OnMsgBoxOk=function()
						
						MasterKickout(menuname);
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						if menuname~=nil then	
						Win_ShowMsgBox("将徒弟 "..menuname.." 踢出师门会让您7天无法收徒，是否确认解除师徒关系?","系统消息",ui_msgid_yesno,"UI.gameui.playermenu.kickprentice");
						end;
						end;
				},
				
				querybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查询好友信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=19,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						  
						Win_ShowWidget("UI.gameui.playermenu",false);
						
						local menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						local bdyinfo=GetGameBuddy(menuname);
						if bdyinfo~=nil then
						Win_SetText("UI.gameui.friendinfodlg.IdLabel",bdyinfo.name);
						Win_SetText("UI.gameui.friendinfodlg.LevelLabel","Lv "..(bdyinfo.level));
						Win_SetText("UI.gameui.friendinfodlg.ProfessionLabel",bdyinfo.prof);
						Win_SetText("UI.gameui.friendinfodlg.TypeLabel",bdyinfo.type);
						Win_SetText("UI.gameui.friendinfodlg.TitleLabel",bdyinfo.title);
												  
						if bdyinfo.bmale then
						Win_SetText("UI.gameui.friendinfodlg.GenderLabel","男");
						else
						Win_SetText("UI.gameui.friendinfodlg.GenderLabel","女");
						end;
						
						end;
						
						Win_ShowWidget("UI.gameui.friendinfodlg",true);
						Win_SetFocus("UI.gameui.friendinfodlg");
						end;
				};
				
				queryequipbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看玩家信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=20,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						ShowEquipOther(menuname);
						end;
				};
												
				queryfamilybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看家族信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=21,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						Win_ShowWidget("UI.gameui.familyquerydlg", true);
						Win_SetFocus("UI.gameui.familyquerydlg");
						UpdatePlayerFamilyInfo(menuname);
					end;
				};
				
				invitefamilybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请加入家族",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=22,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "1");
						Win_SetText("UI.gameui.inputcontentdlg.title", "邀请加入家族");
						Win_ShowWidget("UI.gameui.inputcontentdlg", true);
					end;
				};
				
				applyfamilybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="申请加入家族",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=23,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "2");
						Win_SetText("UI.gameui.inputcontentdlg.title", "申请加入家族");
						Win_ShowWidget("UI.gameui.inputcontentdlg", true);
					end;
				};
				
				allybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="结 盟",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=24,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then
						ModifyFamilyFlag(menuname,0);
						end;
						end;
				};
				
				enemybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="敌 对",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=25,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then
						ModifyFamilyFlag(menuname,1);
						end;
						end;
				};
				
				cancelallybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="取消结盟",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=26,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then
						ModifyFamilyFlag(menuname,2);
						end;
						end;
				};
				
				cancelenemybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="取消敌对",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=27,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then
						ModifyFamilyFlag(menuname,2);
						end;
						end;
				};
				
				filterbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="屏 蔽",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=28,
					soundid={1005,1003},
					updatemute=1,
					
					OnMsgBoxOk=function()
						FilterAddPlayer(menuname);						
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then						
						Win_ShowMsgBox("您确定要屏蔽玩家 "..menuname.." 吗？","系统消息",ui_msgid_yesno,"UI.gameui.playermenu.filterbtn");						
						end;
						end;
				
				};

				reportbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="举报垃圾信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=29,
					soundid={1005,1003},
					updatemute=1,
					
					OnMsgBoxOk=function()
						ReportPlayer(menuname);						
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then						
						Win_ShowMsgBox("您确定要举报玩家 "..menuname.." 吗？","系统消息",ui_msgid_yesno,"UI.gameui.playermenu.reportbtn");						
						end;
						end;
				
				};

				changepos=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="转让队长",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=30,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						TeamChangePos(menuname);
						end;						
				},
				
				invitehousebtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请进入家族屋",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=31,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						InviteJoinFmHouse(menuname);
						end;						
				},
				
				peekpet=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看宠物",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=32,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						PeekOtherPet(menuname);

						--等服务器返回后再显示
						UI.children.gameui.children.otherpetdlg._showinfo=1;

					end;						
				},
				
				peekgod=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看幻神",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=33,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						PeekOtherGod(menuname);
					end;						
				},
				
				horseinvite=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请同乘",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=33,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						InviteHorse(menuname);
					end;						
				},
				
				avataractinvite=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请进行变装动作",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=34,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						InviteAvatarAct(menuname);
					end;						
				},
				
				pkteaminvite=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请加入战队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=35,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						SendInvitePlayer(menuname);
					end;						
				},
				
				reportwgbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="举报使用外挂",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=36,
					soundid={1005,1003},
					updatemute=1,
					
					OnMsgBoxOk=function()
						ReportWaigua(menuname);						
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);						  
						if menuname~=nil then						
						Win_ShowMsgBox("您确定要将玩家 "..menuname.." 举报为外挂吗？","系统消息",ui_msgid_yesno,"UI.gameui.playermenu.reportwgbtn");						
						end;
					end;
				},	
				kickvote=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="踢出冲锋战场",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=37,
					updatemute=1,
				
					soundid={1005,1003},
				
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						local menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						KickVote(menuname);												
					end;
				},	
				
				revengelistbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看仇人名单",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=38,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						local playername=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						QueryRevengeShareList(playername);
					end;						
				},

								
				achievelistbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看成就",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=39,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						ShowAchieve(menuname);
					end;						
				},
				
				leavegroupbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="从该群移除",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=40,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						local groupname,name = GetSaveName();
						KickMember(groupname,name);
					end;						
				},
				
				
				addfriendbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="加为好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=41,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						local groupname,name = GetSaveName();
						GmBuddyReqAdd(name,"");
					end;						
				},
				
				baowwubtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看战魂",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=42,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						ShowOtherBodyBaoWu(menuname);
					end;						
				},
				legionbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请加入军团",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=43,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						Legion_Invite(menuname);
					end;						
				},
				
				sendflowerbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="送花",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=43,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
						ShowSendFlowerDlg(menuname);
						--Legion_Invite(menuname);
					end;
				},
				
				querytimelimitedbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看时装信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=44,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick = function()
						Win_ShowWidget("UI.gameui.playermenu", false);
						menuname = Win_GetText("UI.gameui.playermenu", value_channel_customname);
						ShowTimelimitedOther(menuname);
					end;
				};
				
				otherPetcirclebtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看宠物法阵",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=45,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						
						if Win_IsVisible("UI.gameui.OthersPetcircledlg") then
							Win_ShowWidget("UI.gameui.OthersPetcircledlg",false);
						else				  
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							ShowOthersPetCircle(menuname);
						
							Win_ShowWidget("UI.gameui.OthersPetcircledlg",true);
							Win_SetFocus("UI.gameui.OthersPetcircledlg");
						end;																		
					end;
				};
				
				otherAncientCardbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查看他人典籍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=46,
					soundid={1005,1003},
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.playermenu",false);
						
						if Win_IsVisible("UI.gameui.otherAncientCardDlg") then			  
							Win_ShowWidget("UI.gameui.otherAncientCardDlg",false);
						else
							menuname=Win_GetText("UI.gameui.playermenu",value_channel_customname);
							ShowOthersAncientCard(menuname);	
						
							--Win_ShowWidget("UI.gameui.otherAncientCardDlg",true);
							--Win_SetFocus("UI.gameui.otherAncientCardDlg");
						end;											
					end;
				};							
			},					
			
		};
	
		--主角头像右键菜单
		mainplayermenu=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;
			visible=0,	
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
			
			OnSelfShow=function()
				local cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.mainplayermenu",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.mainplayermenu");	  
				end;
						
			
			children=
			{
				createteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="创建队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						TeamCreate(g_PlayerInfo.name.."的小队", "", "");
					end;
				};
				
				dismissteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="解散队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						TeamDismiss();
					end;
				};
				
				leaderleaveteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="离开队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						TeamLeave();
					end;
				};
				
				memberleaveteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="离开队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						TeamLeave();
					end;
				};
				
				avataractbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="变装动作",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						SingleAvatarAct(); -- 执行单独变装动作
					end;
				};
				
				leaderqueryhelpbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查询帮助",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						Win_ShowWidget("UI.gameui.helpwindlg", true);
					end;
				};
				
				memberqueryhelpbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查询帮助",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mainplayermenu",false);
						Win_ShowWidget("UI.gameui.helpwindlg", true);
					end;
				};
			};
		};
				
		
		friendmenudlg=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;			
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);	
				local menutype=Win_GetValue("UI.gameui.friendmenudlg",value_channel_customtype);
				
				--0:好友菜单,1:家族菜单
				if menutype==0 then
					Win_ShowWidget("UI.gameui.friendmenudlg.deletebtn",true);				
					Win_SetText("UI.gameui.friendmenudlg.querybtn","查询好友信息");				
				else
					local bBuddy=IsGMBuddy(menuname);
					Win_ShowWidget("UI.gameui.friendmenudlg.invitefriend",(not bBuddy));
					Win_ShowWidget("UI.gameui.friendmenudlg.deletebtn",false);
					Win_SetText("UI.gameui.friendmenudlg.querybtn","查询成员信息");
				end;
				
				local mtype=GetTeamMenuType(menuname);
				local ts = GetPlayerTeamStatus();
				
				Win_ShowWidget("UI.gameui.friendmenudlg.maketeambtn",(mtype==0));
				
				Win_ShowWidget("UI.gameui.friendmenudlg.jointeambtn",ts==0);    --无队伍
				Win_ShowWidget("UI.gameui.friendmenudlg.inviteteambtn",ts==2);  --队长
				
				Win_ShowWidget("UI.gameui.friendmenudlg.kickteambtn",(mtype==3)); 
				Win_ShowWidget("UI.gameui.friendmenudlg.followteambtn",(mtype==4)); 
			
				--local bQQ=IsQQBuddy(menuname);
				--Win_ShowWidget("UI.gameui.friendmenudlg.QQbtn",(not bQQ));
				Win_ShowWidget("UI.gameui.friendmenudlg.QQbtn",false);
				
				cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.friendmenudlg",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.friendmenudlg");
				end;

			children=
			{
				whisperbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="密 语",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);						
						Win_SetText("UI.gameui.chatbar.inputbar.chateredit",menuname);
						Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
						end;
				};
				
				gossipbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="交 谈",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						GossipTalk(menuname,"");									
						end;
				};
				
				mailbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="寄邮件",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
				    				     
					OnClick=function()						  
						  Win_ShowWidget("UI.gameui.friendmenudlg",false);
						  local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						  WriteMail(0,menuname);
						  end;
				};			
				
				smallpackbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="寄小包裹",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					updatemute=1,
				     				     
					OnClick=function()
						  Win_ShowWidget("UI.gameui.friendmenudlg",false);
						  local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						  WriteMail(1,menuname);
						  end;
				};			
			
				bigpackbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="寄大包裹",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=4,
					updatemute=1,
				     
					OnClick=function()
						  Win_ShowWidget("UI.gameui.friendmenudlg",false);
						  local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						  WriteMail(2,menuname);
						  end;
				};	
				
				invitefriend=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="加为好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=5,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg", menuname, value_channel_customname);
						Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "0");
						Win_SetText("UI.gameui.inputcontentdlg.title", "申请加为好友");
						Win_ShowWidget("UI.gameui.inputcontentdlg", true);
					end;
				};
				
				querybtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="查询好友信息",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=5,
					updatemute=1,
				     
					OnClick=function()
						menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						if menuname~="" then
						local menutype=Win_GetValue("UI.gameui.friendmenudlg",value_channel_customtype);						
						
						if menutype==0 then
						local bdyinfo=GetGameBuddy(menuname);
						if bdyinfo~=nil then
						Win_SetText("UI.gameui.friendinfodlg.IdLabel",bdyinfo.name);
						Win_SetText("UI.gameui.friendinfodlg.LevelLabel","Lv "..(bdyinfo.level));
						Win_SetText("UI.gameui.friendinfodlg.ProfessionLabel",bdyinfo.prof);
						Win_SetText("UI.gameui.friendinfodlg.TypeLabel",bdyinfo.type);
						Win_SetText("UI.gameui.friendinfodlg.TitleLabel",bdyinfo.title);
						
						if bdyinfo.bmale then
						Win_SetText("UI.gameui.friendinfodlg.GenderLabel","男");
						else
						Win_SetText("UI.gameui.friendinfodlg.GenderLabel","女");
						end;
						
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						Win_ShowWidget("UI.gameui.friendinfodlg",true);
						Win_SetFocus("UI.gameui.friendinfodlg");
						end;
						
						else
						
						local meminfo=GetFamilyMemInfoEx(-1,menuname);
						if meminfo~=nil then
						Win_SetText("UI.gameui.friendinfodlg.IdLabel",meminfo.name);						
						Win_SetText("UI.gameui.friendinfodlg.LevelLabel","Lv "..(meminfo.level));
						Win_SetText("UI.gameui.friendinfodlg.ProfessionLabel",meminfo.profname);
						Win_SetText("UI.gameui.friendinfodlg.TypeLabel",meminfo.posname);
						Win_SetText("UI.gameui.friendinfodlg.TitleLabel",meminfo.contribute);
		
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						Win_ShowWidget("UI.gameui.friendinfodlg",true);
						Win_SetFocus("UI.gameui.friendinfodlg");
						end;
						
						end;
						
						end;					
						
						end;
				};
				
				
				deletebtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="删除好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=6,
					updatemute=1,
					
					OnMsgBoxOk=function()
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						GmBuddyReqRemove(menuname);
					end;
				     
					OnClick=function()
						Win_ShowMsgBox("您确定要删除该好友吗?","系统消息",ui_msgid_yesno,"UI.gameui.friendmenudlg.deletebtn");
					end;
				};
				
				QQbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="加为QQ好友",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=7,
					updatemute=1,
				     
					OnClick=function()
						  Win_ShowWidget("UI.gameui.friendmenudlg",false);
						  menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						  QQBuddyReqAdd(menuname);
						  end;
				};
				
				maketeambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请组队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						local menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						--Win_SetText("UI.gameui.teamconfigdlg.neighboredit",menuname);
						--Win_ShowWidget("UI.gameui.teamconfigdlg",true);
						Win_ShowWidget("UI.gameui.exteamconfigdlg",true);
						local rt = AddToStandbyMemberByName(menuname);
						if rt ~= 0 then UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList(); end;
						end;
				};
				
				jointeambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="请求入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
							menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
							TeamJoin(menuname,"请求加入队伍!");
							Win_ShowWidget("UI.gameui.friendmenudlg",false);
							end;
				},
				
				inviteteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
							menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
							Win_ShowWidget("UI.gameui.friendmenudlg",false);
							local rst = TeamInvite(menuname,"邀请您加入队伍!");
							if rst ~= 0 then
							Win_ShowMsgBox("组队请求已经发送！");
							end;
							end;
				},
				
				
				kickteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="踢出队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.friendmenudlg",false);
						menuname=Win_GetText("UI.gameui.friendmenudlg",value_channel_customname);
						TeamKickout(menuname);
						end;						
				},
				
				followteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="跟随队长",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()							
							Win_ShowWidget("UI.gameui.friendmenudlg",false);
							FollowTeamLeader();
							end;	
				},
			};
		
		};
		
		
		mastermenudlg=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;			
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			visible=0,
			updatemute=1,
				
			
			OnSelfShow=function()
				local menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
				local mtype=GetTeamMenuType(menuname);
				Win_ShowWidget("UI.gameui.mastermenudlg.maketeambtn",(mtype==0));
				Win_ShowWidget("UI.gameui.mastermenudlg.jointeambtn",(mtype==1));
				Win_ShowWidget("UI.gameui.mastermenudlg.inviteteambtn",(mtype==2));
				Win_ShowWidget("UI.gameui.mastermenudlg.kickteambtn",(mtype==3)); 
				Win_ShowWidget("UI.gameui.mastermenudlg.followteambtn",(mtype==4)); 
				
				cursorinfo=Win_GetCursorInfo();
				Win_SetPos("UI.gameui.mastermenudlg",cursorinfo.x,cursorinfo.y);
				Win_AjustSelf("UI.gameui.mastermenudlg");
				end;

			children=
			{
				whisperbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="密 语",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);												
						Win_SetText("UI.gameui.chatbar.inputbar.chateredit",menuname);
						Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
						end;
				};
				
				gossipbtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="交 谈",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=1,
					updatemute=1,
					
					soundid={1005,1003},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
						GossipTalk(menuname,"");									
						end;
				};
				
				kickmaster=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="请求退出师门",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
						LeaveMasterRequest(menuname);
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						end;							
				},
				
				betraymaster=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="强行退出师门",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					soundid={1005,1003},
					updatemute=1,
					
					OnClick=function()
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
						MasterBetray(menuname);
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						end;							
				},					
				
				kickprentice=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="解除师徒关系",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=4,
					soundid={1005,1003},
					updatemute=1,
					
					OnMsgBoxOk=function()
						MasterKickout(menuname);
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
						
						if menuname~=nil then	
						Win_ShowMsgBox("将徒弟 "..menuname.." 踢出师门会让您7天无法收徒，是否确认解除师徒关系?","系统消息",ui_msgid_yesno,"UI.gameui.playermenu.kickprentice");
						end;
						end;
				};
				
				thankbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="感谢师恩",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=7,
					updatemute=1,
				     
					OnClick=function()
						  Win_ShowWidget("UI.gameui.mastermenudlg",false);
						  OweMaster();
						  end;
				};

				maketeambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请组队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
							Win_ShowWidget("UI.gameui.mastermenudlg",false);
							local menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
							--Win_SetText("UI.gameui.teamconfigdlg.neighboredit",menuname);
							--Win_ShowWidget("UI.gameui.teamconfigdlg",true);
							Win_ShowWidget("UI.gameui.exteamconfigdlg",true);
							local rt = AddToStandbyMemberByName(menuname);
							if rt ~= 0 then UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList(); end;
							end;
				};
				
				jointeambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="请求入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
							menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
							TeamJoin(menuname,"请求加入队伍!");
							Win_ShowWidget("UI.gameui.mastermenudlg",false);
							end;
				},
				
				inviteteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="邀请入队",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()
							menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
							Win_ShowWidget("UI.gameui.mastermenudlg",false);
							local rst = TeamInvite(menuname,"邀请您加入队伍!");
							if rst ~= 0 then
							Win_ShowMsgBox("组队请求已经发送！");
							end;
							end;
				},
				
				
				kickteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="踢出队伍",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()							
						Win_ShowWidget("UI.gameui.mastermenudlg",false);
						menuname=Win_GetText("UI.gameui.mastermenudlg",value_channel_customname);
						TeamKickout(menuname);
						end;						
				},
				
				followteambtn=
				{
					
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="跟随队长",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=8,
					updatemute=1,
					
					OnClick=function()							
							Win_ShowWidget("UI.gameui.mastermenudlg",false);
							FollowTeamLeader();
							end;	
				},
			};
		
		};
		
		
		
		--游戏界面				
		systeminfobtn0= 
		{
			type = "BUTTON",
			rect = { 184, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				PopSystemMsg();
				end;
		};
		
		systeminfobtn1= 
		{
			type = "BUTTON",
			rect = { 210, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				    PopSystemMsg();	
				    end;
		};
		
		systeminfobtn2= 
		{
			type = "BUTTON",
			rect = { 236, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				    PopSystemMsg();	
				    end;
		};
		
		systeminfobtn3= 
		{
			type = "BUTTON",
			rect = { 262, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				    PopSystemMsg();	
				    end;
		};
		systeminfobtn4= 
		{
			type = "BUTTON",
			rect = { 288, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				    PopSystemMsg();	
				    end;
		};
		
		systeminfobtn5= 
		{
			type = "BUTTON",
			rect = { 314, 70, 24, 24 },
			bkimage="res/uires/gameui/systeminfobtn.gsa",
			framescheme={{0,0,1,1,2,3,3,3}},
			initlayer=0;
			pluslayer=0;
			visible=0,
			soundid={-1,-1,-1,-1,1005,1009,1002},
			updatemute=1,
			
			OnClick=function()
				    PopSystemMsg();	
				    end;
		};				
--[[
		newbieinfowin=
		{
			type = "LABEL",
			rect={0,0,290,48},
			captionrect={4,4,282,32},
			textsize=12,
			rowspace=4,
			style=wgtstyle_topmost,							
			richmode=ui_richmode_all,
			richflag=1,
			ysizeable=1,
			minheight=48,
			visible=0,
			initlayer=100000,
			alphaspeed=0.02,
			alphafactor=0.0,
			marginh=6,
			marginv=6,

			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.newbieinfowin",false);
				end;
				      
			OnClick=function()
				    Win_ShowWidget("UI.gameui.newbieinfowin",false);
				    end;
			
			OnRClick=function()
				    Win_ShowWidget("UI.gameui.newbieinfowin",false);
				    end;
		};]]
		
		newbieinfowin=
		{
			type = "WIDGETLIST",
			rect={0,0,290,48},
			template={"res/uires/newbietip.lua"};
			initlayer=msgbox_layer-1;
			richflag=1,
			minheight=48,
			ysizeable=1,
			itemmarginh=0,
			itemmarginv=0,	
			style=wgtstyle_cleanwin,
			children={},
		};
		taskremindhintdlg=
		{
			type = "DIALOG",
			rect = {0,0,290,82},
			bkimage="res/uires/gameui/hint.gsa",
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose +wgtstyle_alphawin,							
			visible=0,
			updatemute=1,
			alphafactor=0.0,
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			taskid = nil,
	
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
	
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
		
			OnInit=function()
				local selfrect=Win_GetRect("UI.gameui.taskremindhintdlg",value_channel_winrect);
				local panelrect = Win_GetRect("UI.gameui.showtaskhintbtn",value_channel_winrect);
				local globalrect = Win_GetRect("UI.gameui",value_channel_winrect);
				local ox = panelrect.x + panelrect.w - selfrect.w;
				local oy = -globalrect.h + panelrect.y + selfrect.h + panelrect.h + 5;
				Win_AlignWidget("UI.gameui.taskremindhintdlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,ox,oy);
			end;
			
			OnUpdate=function()
				local selfrect=Win_GetRect("UI.gameui.taskremindhintdlg",value_channel_winrect);
				local panelrect = Win_GetRect("UI.gameui.showtaskhintbtn",value_channel_winrect);
				local globalrect = Win_GetRect("UI.gameui",value_channel_winrect);
				local ox = panelrect.x + panelrect.w - selfrect.w;
				local oy = -globalrect.h + panelrect.y + selfrect.h + panelrect.h + 5;
				Win_AlignWidget("UI.gameui.taskremindhintdlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,ox,oy);
			end;
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.taskremindhintdlg.hintlist",true);
				Win_ShowWidget("UI.gameui.taskremindhintdlg.openhintbtn",true);
				local selfrect=Win_GetRect("UI.gameui.taskremindhintdlg",value_channel_winrect);
				local panelrect = Win_GetRect("UI.gameui.showtaskhintbtn",value_channel_winrect);
				local globalrect = Win_GetRect("UI.gameui",value_channel_winrect);				
				local ox = panelrect.x + panelrect.w - selfrect.w;
				local oy = -globalrect.h + panelrect.y + selfrect.h + panelrect.h + 5;
				Win_AlignWidget("UI.gameui.taskremindhintdlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,ox,oy);
			end;
			
			OnSelfHide=function()
				Win_ShowWidget("UI.gameui.taskremindhintdlg.hintlist",false);
				Win_ShowWidget("UI.gameui.taskremindhintdlg.openhintbtn",false);
			end;

			OnCancel=function()
				Win_ShowWidget("UI.gameui.taskremindhintdlg", false);
			end;
			
			closeHint=function(id)
				if id == UI.children.gameui.children.taskremindhintdlg.taskid then
					if Win_IsVisible("UI.gameui.taskremindhintdlg") == true then
						Win_ShowWidget("UI.gameui.taskremindhintdlg",false);
					end;
				end;
			end;

			ShowHint=function(data,id)
				local whitecolor=GetColorIndex(255,255,255);
				local linedata=
				{
					caption=data,--"",
					color=whitecolor,
					strdata="",
					intdata=0,
				};
				local currentlist = "UI.gameui.taskremindhintdlg.hintlist";
				local datachannel = value_channel_itemdata;
				if Win_IsVisible("UI.gameui.taskremindhintdlg") == false then
					Win_ShowWidget("UI.gameui.taskremindhintdlg",true);
				end;
				UI.children.gameui.children.taskremindhintdlg.taskid = id;
				Win_SetValue("UI.gameui.taskremindhintdlg.hintlist",0,value_channel_item_num);
				Win_SetTable(currentlist,datachannel,linedata);
			end;
			ClearText=function()
				Win_SetValue("UI.gameui.taskremindhintdlg.hintlist",0,value_channel_item_num);
			end;
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 269,2,19,18 },
					bkimage="res/uires/gameui/closeupbtn.gsa",
					defaultcancel=1,
				},
				
				openhintbtn=
				{
					type = "BUTTON",
					rect = {268,63,20,19},
					bkimage="res/uires/gameui/openupbtn.gsa",
					tiptext="打开任务提示",
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.taskdlg") then
							Win_ShowWidget("UI.gameui.taskdlg",true);
							Win_SelectSelf("UI.gameui.taskdlg.doingtab");
							local num=TaskGetNumber(1);
							if num >=0 then
								for i=0,num do
								local taskinfo=TaskGetInfo(1,i);
									if taskinfo ~= nil then
										--debug_message(UI.children.gameui.children.taskremindhintdlg.taskid);
										local tmpid = UI.children.gameui.children.taskremindhintdlg.taskid;
										if taskinfo.id == tmpid then
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.titlelabel",taskinfo.title);								
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.publishlabel",taskinfo.publisher);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.placelabel",taskinfo.place);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.descript",taskinfo.desc);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.prizelabel",taskinfo.prize);
									
										if taskinfo.CountPerRound ~= 0 then
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.finishcountlabel",taskinfo.finishcount);
										else
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.finishcountlabel","");
										end;
									
										Win_SetValue("UI.gameui.taskdlg.doingtab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
										for i=0,taskinfo.nhint-1 do
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
										end;		
										Win_EnableWidget("UI.gameui.taskdlg.doingtab.stopbtn", true);	
										end;
										Win_AjustSelf("UI.gameui.taskdlg.doingtab.infopanel.hintlist");
										Win_SetValue("UI.gameui.taskdlg.doingtab.infopanel",1,value_channel_update_dirty);
									end;
								end;
							end;
						end;
					end;
				},
				
				hintlist=
				{
					type = "TEXTLIST",
					rect = {2,13,269,60},
					clientrect={2,0,269,60},
					titlerect={-20,-10,20,10},
					style=wgtstyle_clipself+wgtstyle_ajustfollow,
					extendstyle=textlist_style_delayscroll,
					scrollspeed=100000,
					rowspace=6,
					textsize=12,
					textstyle=dt_left+dt_magicedge,
					--groupid=0,
					ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
					magiccolor={0,0,0,128},
					linkcolor={100,100,255,255},
					--mousedelta=18,
					richmode=ui_richmode_all,
					richflag=1,
					--initlayer=0,
					--pluslayer=0,
					updatemute=1,

					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={0,32,10,34},
							pattern=wgtpattern_rawvisible+wgtpattern_alphavisible,
							style=wgtstyle_vertical+wgtstyle_ajustfollow,					
							ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
							bkcolor={0,0,0,128},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=0,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_caption_fill,
							updatemute=1,
							marginh=271,
									
							minwidth=10;
							maxwidth=10;
									

									
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,10,16},
									bkimage="res/uires/chatbar/minislidebtn.gsa",
									bkimagepos={0,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
								};--blockbtn
										
					
								pinup=
								{
									type="SPIN",
									rect={0,0,10,6},
									bkimage="res/uires/chatbar/miniupbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
											
								};--spinup
										
								spindown=
								{
									type="SPIN",
									rect={0,0,10,6},
									bkimage="res/uires/chatbar/minidnbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
										
							};--children
						};
					};
				},
			};
		};
		
		probeinfowin=
		{
			type = "LABEL",
			rect={0,0,274,159},
			bkimage="res/uires/gameui/probedlg.gsa",
			visible=0,
			initlayer=100000,
			alphaspeed=0.02,
			alphafactor=0.0,
			marginh=6,
			marginv=6,
			
			OnSelfShow=function()
				local picposx = math.random(10, 74);
				local picposy = math.random(100, 108);
				Win_RelativePos("UI.gameui.probeinfowin.piclabel", picposx, picposy);	
				
				local text=Win_GetText("UI.gameui.probeinfowin.infolabel2");
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,posy);
				end;
				
				local var=GetGameVar("notice");			
				SetGlobalQuery(GlobalQuery_Probe,1);
				end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin",posx,600);
				end;
				SetGlobalQuery(GlobalQuery_Probe,0);
				end;
				
			children=
			{							
				
				infolabel1=				
				{
					type = "LABEL",
					rect={10,10,165,50},
					textsize=12,
					rowspace=3,
					drawcolor={255,0,0,255},
					richmode=ui_richmode_color+ui_richmode_font,
					enable=0,	
					updatemute=1,
				};
				
				infolabel2=				
				{
					type = "LABEL",
					rect={10,70,165,30},
					textsize=12,
					rowspace=3,
					drawcolor={255,255,0,255},
					richmode=ui_richmode_color+ui_richmode_font,
					enable=0,	
					updatemute=1,
				};				
				
				piclabel=
				{
					type = "LABEL",
					rect={44,104,96,48},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_probe,
					enable=0,		
					updatemute=1,
				};
				
				timelabel=
				{
					type = "LABEL",
					rect={188,136,66,12},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_timer,
					textstyle=dt_vcenter+dt_left,
					enable=0,		
					updatemute=1,
				};
				
				radiobtn0=
				{	
					type = "CHECK",
					rect={182,47,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin",false);
						ConfirmProbe(0,true);
						end;
				};
				
				radiobtn1=
				{	
					type = "CHECK",
					rect={182,67,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",					
					bkimagepos={0,2},					
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin",false);
						ConfirmProbe(1,true);
						end;
				};
				
				radiobtn2=
				{	
					type = "CHECK",
					rect={182,87,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin",false);
						ConfirmProbe(2,true);
						end;
				};
				
				radiobtn3=
				{	
					type = "CHECK",
					rect={182,107,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=3,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin",false);
						ConfirmProbe(3,true);
						end;
				};
			};
		};
		
		probeinfowin1=
		{
			type = "LABEL",
			rect={0,0,274,159},
			bkimage="res/uires/gameui/probedlg.gsa",	
			visible=0,
			initlayer=100000,
			alphaspeed=0.02,
			alphafactor=0.0,
			marginh=6,
			marginv=6,
			
			OnSelfShow=function()
				local picposx = math.random(74);
				local picposy = math.random(100, 134);
				Win_RelativePos("UI.gameui.probeinfowin1.piclabel", picposx, picposy);	
				
				local text=Win_GetText("UI.gameui.probeinfowin1.infolabel2");
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					local posy = math.random(384, 609);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				else
					local posx = math.random(1, 526);
					local posy = math.random(300, 441);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,posy);
				end;
				local var=GetGameVar("notice");			
				SetGlobalQuery(GlobalQuery_Probe,1);
				end;
			
			OnSelfHide=function()
				Win_ClearPathPoint("UI.gameui.probeinfowin1");
				if GetScreenType()~=0 then
					local posx = math.random(1, 750);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,768);
				else
					local posx = math.random(1, 526);
					Win_PushPathPoint("UI.gameui.probeinfowin1",posx,600);
				end;
				SetGlobalQuery(GlobalQuery_Probe,0);
				end;
				
			children=
			{							
				
				infolabel1=				
				{
					type = "LABEL",
					rect={10,10,165,50},
					textsize=12,
					rowspace=3,
					drawcolor={255,0,0,255},
					richmode=ui_richmode_color+ui_richmode_font,
					enable=0,	
					updatemute=1,
				};
				
				infolabel2=				
				{
					type = "LABEL",
					rect={10,70,165,30},
					textsize=12,
					rowspace=3,
					drawcolor={255,255,0,255},
					richmode=ui_richmode_color+ui_richmode_font,
					enable=0,	
					updatemute=1,
				};				
				
				piclabel=
				{
					type = "LABEL",
					rect={10,100,100,25},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_probe,
					enable=0,		
					updatemute=1,					
				};
				
				timelabel=
				{
					type = "LABEL",
					rect={188,136,66,12},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_timer,
					textstyle=dt_vcenter+dt_left,
					enable=0,		
					updatemute=1,
				};
				
				radiobtn0=
				{	
					type = "CHECK",
					rect={182,47,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin1",false);
						ConfirmProbe(0,true);
						end;
				};
				
				radiobtn1=
				{	
					type = "CHECK",
					rect={182,67,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",					
					bkimagepos={0,2},					
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin1",false);
						ConfirmProbe(1,true);
						end;
				};
				
				radiobtn2=
				{	
					type = "CHECK",
					rect={182,87,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin1",false);
						ConfirmProbe(2,true);
						end;
				};
				
				radiobtn3=
				{	
					type = "CHECK",
					rect={182,107,78,16},
					captionrect={18,2,60,12},
					bkimage="res/uires/common/radiobtn.gsa",
					bkimagepos={0,2},
					textsize=12,
					textfont=1,
					groupid=0,
					groupstop=3,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.probeinfowin1",false);
						ConfirmProbe(3,true);
						end;
				};

				closebtn = 
				{
					type = "BUTTON",
					rect = { 249,5,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
					OnClick=function()
						Win_SetValue("UI.gameui.statusbar.probeicon",1,value_channel_enabled);
						SetAuthState(0);
						CloseAuth();
					end;
				},
				
			};
		};
	
		--caption="系统帮助",
		helpwindlg=
		{
			type = "DIALOG",
			rect={0,0,653,488},
			bkimage="res/uires/helpwin/helpwindlg.gsa",
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,							
			visible=0,
			updatemute=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.helpwindlg.searchtreelist", false);
				Win_ShowWidget("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", false);
				Win_ShowWidget("UI.gameui.helpwindlg.treelist", true);
				local info, len = GetRandomTip();
				UI.children.gameui.children.helpwindlg.OnShowBulletin(info, len);
			end;
			
			OnShowBulletin=function(msg,len)
				Win_SetText("UI.gameui.helpwindlg", msg, value_channel_customtext);
				Win_SetValue("UI.gameui.helpwindlg", len, value_channel_customid);
				
				if msg~="" and len>0 then
					UI.children.gameui.children.helpwindlg.children.tiplabel.ShowBulletin(msg,len);
				else
					Win_SetValue("UI.gameui.helpwindlg",0,value_channel_customindex);
				end;
			end;
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.helpwindlg", false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.helpwindlg", false);
			end;
		
			
			OnEnter=function()
				UI.children.gameui.children.helpwindlg.children.findbtn.OnClick();
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 626,18,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.helpwindlg", false);
					end;
				},
				
				tiplabel=
				{
					type="LABEL",
					rect={39, 49, 602, 14},
					style=wgtstyle_clipself+wgtstyle_clipchild_window,
					
					--滚动
					ShowBulletin=function(msg,len)
						Win_ClearPathPoint("UI.gameui.helpwindlg.tiplabel.movetiplabel");
						if (msg~="" and len>0) then
							Win_SetText("UI.gameui.helpwindlg.tiplabel.movetiplabel",msg);
							Win_SetValue("UI.gameui.helpwindlg.tiplabel.movetiplabel",len,value_channel_winrect,2);
							
							local winrect = Win_GetRect("UI.gameui.helpwindlg.tiplabel",value_channel_winrect);
							Win_SetPos("UI.gameui.helpwindlg.tiplabel.movetiplabel",winrect.x+winrect.w,winrect.y);
							Win_PushPathPoint("UI.gameui.helpwindlg.tiplabel.movetiplabel",winrect.x-len,winrect.y);
						end;
					end;

					children=
					{
						movetiplabel=
						{
							type = "LABEL",
							rect= {518, 43, 600, 14},
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_vcenter,	
							drawcolor={255,255,255,255},
							pathspeed=50,
							
							mornitor={value_channel_winrect},
					
							OnUpdate=function()
								local msg = Win_GetText("UI.gameui.helpwindlg",value_channel_customtext);
								local len = Win_GetValue("UI.gameui.helpwindlg",value_channel_customid);
								
								if msg~="" and len>0 then
									Win_ClearPathPoint("UI.gameui.helpwindlg.tiplabel.movetiplabel");
									
									local fwinrect = Win_GetRect("UI.gameui.helpwindlg.tiplabel",value_channel_winrect);
									local winrect = Win_GetRect("UI.gameui.helpwindlg.tiplabel.movetiplabel",value_channel_winrect);
									
									Win_SetPos("UI.gameui.helpwindlg.tiplabel.movetiplabel",winrect.x,fwinrect.y);
									Win_PushPathPoint("UI.gameui.helpwindlg.tiplabel.movetiplabel",fwinrect.x-len,fwinrect.y);
									
									if winrect.x + winrect.w - 1 < fwinrect.x then
										local info, size = GetRandomTip();
										UI.children.gameui.children.helpwindlg.children.tiplabel.ShowBulletin(info, size);
									end;
								end;
							end;
						};
					};					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 604,18,22,23},
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
					end;
				};		
				
				keywordedit=
				{
					type="EDIT",
					rect={36,460,318,12},	
					textsize=12,
					maxchar=20,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
				};
				
				findbtn= 
				{
					type = "BUTTON",
					rect = { 567,452,71,26 },
					bkimage="res/uires/helpwin/findbtn.gsa",
					
					
					OnClick=function()
						local keywordtxt=Win_GetText("UI.gameui.helpwindlg.keywordedit");
						local iCount = GetHelpID(keywordtxt);
						
						if iCount == 0 then
							Win_ShowMsgBox("没找到任何记录, 请重新输入关键字!");	
						else
							Win_ShowWidget("UI.gameui.helpwindlg.treelist", false);
							Win_ShowWidget("UI.gameui.helpwindlg.searchtreelist", true);
							Win_SetValue("UI.gameui.helpwindlg.searchtreelist",-1,value_channel_treeid);
							Win_RequeryChildNodes("UI.gameui.helpwindlg.searchtreelist");
						end;
					end;
				},
				
				searchtreelist=
				{
					type="TREECTRL",
					rect={42,79,236,363},			
					style=wgtstyle_clipself,
					dragtype=ui_drag_type_help_search,
					mousedelta=30,
					extendstyle=wgtlist_style_wheel;
					soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
					
					OnSelShow=function()
						Win_RequeryChildNodes("UI.gameui.helpwindlg.searchtreelist");
						Win_SetFocus("UI.gameui.helpwindlg.searchtreelist");
					end;
					
					
					OnValueChange=function(id)
						if id>=0 then
							Win_SetFocus("UI.gameui.helpwindlg.keywordedit");
							local txt=GetHelpText(id);
							Win_ShowWidget("UI.gameui.helpwindlg.infolist.movebtn", showbtn);
							Win_SetText("UI.gameui.helpwindlg.infolist.descedit",txt);
							Win_SetValue("UI.gameui.helpwindlg.infolist",1,value_channel_update_dirty);
						end;
					end;
					
					children=
					{
						returnmenubtn =
						{
							type = "BUTTON",
							rect = {164, 342, 69, 18 },
							bkimage="res/uires/helpwin/returnmenubtn.gsa",
							OnClick=function()
								Win_ShowWidget("UI.gameui.helpwindlg.searchtreelist", false);
								Win_ShowWidget("UI.gameui.helpwindlg.treelist", true);
								
								Win_SetText("UI.gameui.helpwindlg.infolist.descedit","");
								Win_ShowWidget("UI.gameui.helpwindlg.infolist.movebtn", false);
								Win_SetFocus("UI.gameui.helpwindlg.keywordedit");
							end;
						};
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={236,17,20,327},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							mousedelta=30,
							marginh=0,
							marginv=0,	
							visible=1,	
												
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				treelist=
				{
					type="TREECTRL",
					rect={42,79,236,363},			
					style=wgtstyle_clipself,
					dragtype=ui_drag_type_help,
					mousedelta=30,
					extendstyle=wgtlist_style_wheel;
					soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
					
					OnSelfShow=function()
						Win_SetFocus("UI.gameui.helpwindlg.treelist");
					end;
					
					OnValueChange=function(id, oldid)
						if id>=0 and id ~= oldid then
							local state = Win_GetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", value_channel_customstate);
							if state == 1 then
								Win_SetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn",  0, value_channel_customstate);
							elseif id ~= Win_GetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn",  value_channel_customid) and Win_IsVisible("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn") then
								Win_ShowWidget("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", false);
							end;
							Win_SetFocus("UI.gameui.helpwindlg.keywordedit");
							local txt=GetHelpText(id);
							Win_SetText("UI.gameui.helpwindlg.infolist.descedit",txt);
							Win_SetValue("UI.gameui.helpwindlg.infolist",1,value_channel_update_dirty);
						end;
					end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={236,17,20,327},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							mousedelta=30,
							marginh=0,
							marginv=0,	
							visible=1,	
												
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				infolist=
				{
					type="WIDGETLIST",
					rect={315,79,299,363},
					style=wgtstyle_clipchild_window,
					primaryscroll="UI.gameui.helpwindlg.vscroll",
					
					children=
					{
						--说明
						descedit=
						{
							type="LABEL",
							rect={0,0,287,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							richmode=ui_richmode_all,
							textstyle=dt_left,
							marginh=6,
							marginv=6,
							drawcolor={255,255,255,255},
							
							children=
							{
								returnprepagebtn =
								{
									type = "BUTTON",
									rect = {218,341,69,18},
									bkimage="res/uires/helpwin/returnmenubtn.gsa",
									OnClick=function()
										local preselid = Win_GetValue("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", value_channel_customid);
										Win_SetValue("UI.gameui.helpwindlg.treelist", preselid, value_channel_sel);
										Win_ShowWidget("UI.gameui.helpwindlg.infolist.descedit.returnprepagebtn", false);
									end;
								};
							};
						},
						--移动
						movebtn=
						{
							type="BUTTON",
							rect={156, 41, 60, 22},
							bkimage="res/uires/helpwin/findpathbtn.gsa",	
							updatemute=1,
							visible=0,
							
							OnClick=function()
								local sel = 0;
								if Win_IsVisible("UI.gameui.helpwindlg.treelist") == true then
									sel = Win_GetValue("UI.gameui.helpwindlg.treelist", value_channel_sel);
								elseif Win_IsVisible("UI.gameui.helpwindlg.searchtreelist") == true then
									sel = Win_GetValue("UI.gameui.helpwindlg.searchtreelist", value_channel_sel);
								end;
								
								HelpWinMoveToNPC(sel);
							end;
						};
					},-- children
				},
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={614,96,20,327},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
										
					buddywidget="UI.gameui.helpwindlg.infolist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
							
			};
			
		};
		
		
		eachbookdlg=
		{
			type="DIALOG",
			rect={0,0,332,446},
			bkimage="res/uires/bookdlg/1bookdlgbk.gsa",
			moveable=1,
			style=wgtstyle_topmost,
			visible=0,
			updatemute=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
							
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 307,6,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 287,6,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("无字天书");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};	
				
				title=
				{
					type="EDIT";
					rect={85,35,200,12},
					focuscolor = { 0, 0, 0, 255 },
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					editable=0,
				};
				
				author=
				{
					type="EDIT",
					rect={85,57,133,12},
					focuscolor = { 0, 0, 0, 255 },
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					editable=0,
				};
				
				server=
				{
					type="EDIT",
					rect={85,79,133,12},
					focuscolor = { 0, 0, 0, 255 },
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					editable=0,
				};
				
				descedit=
				{
					type="MULTIEDIT",
					rect={20,106,282,311};
					textsize=12,
					textstyle=dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_copydisable,	
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,	
					maxchar=20480,

					children=
					{
						desctionscroll=
						{
					
							type="SCROLLBAR",
							rect={290,15,15,290},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,	
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
			};
		};
		
		bookwindlg=
		{
			type = "DIALOG",
			rect={0,0,582,448},
			bkimage="res/uires/bookdlg/12bookdlgbk.gsa",
			moveable=1,
			style=wgtstyle_topmost,							
			visible=0,
			updatemute=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.bookwindlg.treelist");
				Win_SetValue("UI.gameui.bookwindlg.treelist",0,value_channel_sel);
				end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 556,17,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 536,17,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("无字天书");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};		
				
				treelist=
				{
					type="TREECTRL",
					rect={12,42,195,395},			
					style=wgtstyle_clipself,
					dragtype=ui_drag_type_book,
					mousedelta=30,
					soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
					
					OnValueChange=function(id)
						    if id>=0 then
						    txt=GetBookDesc(id);
						    if txt~="" then
						    Win_SetText("UI.gameui.bookwindlg.infolist.descedit",txt);
						    Win_SetValue("UI.gameui.bookwindlg.infolist",1,value_channel_update_dirty);
						    end;
						    end;
						    end;
					
					
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={201,17,15,362},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							mousedelta=30,
							marginh=0,
							marginv=0,	
							visible=1,	
												
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",											
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				infolist=
				{
					type="WIDGETLIST",
					rect={239,43,313,394},	
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window,
					
					primaryscroll="UI.gameui.bookwindlg.vscroll",
										
					children=
					{
						--说明
						descedit=
						{
							
							type="LABEL",
							rect={0,0,313,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							richmode=ui_richmode_all,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							drawcolor={255,255,255,255},
						},
					},-- children
					
				},
				
				
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={558,58,15,363},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
										
					buddywidget="UI.gameui.bookwindlg.infolist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
							
			};
			
		};
		
		--开店商品设置
		grocerydetaildlg=
		{
				
			type="DIALOG",
			rect={0,0,267,224},
			--captionrect={55,9,150,12},
			--caption="开店商品设置",
			textsize=12,
			textfont=1,
			bkimage="res/uires/grocerydlg/grocerydetail.gsa",
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			updatemute=1,
				  
			OnOk=function()
				
				local gold=Win_GetValue("UI.gameui.grocerydetaildlg.goldedit");
				local silver=Win_GetValue("UI.gameui.grocerydetaildlg.silveredit");
				local copper=Win_GetValue("UI.gameui.grocerydetaildlg.copperedit");
				
				local price=gold*1000000+silver*1000+copper;
				local count=Win_GetValue("UI.gameui.grocerydetaildlg.countedit");			
				
				AddShopItem(price,count);
				
				Win_ShowWidget("UI.gameui.grocerydetaildlg",false);
				
				end;
			
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.grocerydetaildlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.grocerydetaildlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.grocerydetaildlg",false);				     
			     end;
			     
			
			
			children=
			{				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 238,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},								
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 216,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("价格设置界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={36,191,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={181,191,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				goldlabel=
				{
					type="LABEL",
					rect={92,99,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					textstyle=dt_center+dt_vcenter,		
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={139,99,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					textstyle=dt_center+dt_vcenter,		
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={186,99,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					textstyle=dt_center+dt_vcenter,		
					enable=0,
				},			
				
				
				nameedit=
				{
					type="LABEL",
					rect={42,71,206,12},	
					textsize=12,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
				};
						
				
				
				countedit=
				{
					type="EDIT",
					rect={97,159,66,12},	
					textsize=12,					
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod=ui_editmethod_number+ui_editmethod_value,					
				};
				
				goldedit=
				{
					type="EDIT",
					rect={92,131,48,12},
					captionrect={20,0,28,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,									
					maxvalue=2000,
					minvalue=0,

					OnTab=function()
						   Win_SetFocus("UI.gameui.grocerydetaildlg.silveredit");
						   end;
				},
				
				silveredit=
				{
					type="EDIT",
					rect={143,132,48,12},
					captionrect={20,0,28,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,						
					maxvalue=999,
					minvalue=0,

					OnTab=function()
						   Win_SetFocus("UI.gameui.grocerydetaildlg.copperedit");
						   end;					
					
				},
				
				copperedit=
				{
					type="EDIT",
					rect={193,131,48,12},
					captionrect={20,0,28,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,						
					maxvalue=999,
					minvalue=0,
											
					OnTab=function()
						   Win_SetFocus("UI.gameui.grocerydetaildlg.goldedit");
						   end;
				},

			};			
				
		};	
		
		-- 出售，收购商店的设置界面， 具体根据背景图确定
		groceryconfigdlg=
		{
			type = "DIALOG",
			rect={0,0,304,455},
			bkimage="res/uires/grocerydlg/groceryconfig.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,							
			visible=0,			
			moveable=1,
			
			dragindex=-1,
			dragtype=ui_drag_type_shop,
			itemdragflag=-1,
			
			OnTimer=function()
				if(IsCrossServer() == 0) then
					Win_EnableWidget("UI.gameui.groceryconfigdlg.okbtn",true);
				elseif(IsCrossServer() == 1) then
					Win_EnableWidget("UI.gameui.groceryconfigdlg.okbtn",false);
				end;
			end;
			
			OnOk=function()
				if Win_IsVisible("UI.gameui.grocerydetaildlg") then
				Win_EndWidget("UI.gameui.grocerydetaildlg",false);
				end;
				local name=Win_GetText("UI.gameui.groceryconfigdlg.nameedit");
				local IsShopQuery;
				if Win_IsChecked("UI.gameui.groceryconfigdlg.shopquerychk") then
					IsShopQuery = 1;
				else 
					IsShopQuery = 0;
				end;
				if name~="" then
				CreateShop(name,1, IsShopQuery);
				
				Win_SetValue("UI.gameui.groceryconfigdlg",1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.groceryconfigdlg.okbtn",false);
				Win_SetText("UI.gameui.groceryconfigdlg.nameedit", "");
				Win_SetFocus("UI.gameui.groceryconfigdlg.nameedit");
				--Win_ShowWidget("UI.gameui.groceryconfigdlg",false);
				
				else
				Win_ShowMsgBox("请您输入商店名称！");				  
				end;
				end;			  
			
			OnCancel=function()
				EndShop();
				Win_ShowWidget("UI.gameui.groceryconfigdlg",false);
				end;
						
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.groceryconfigdlg","UI.gameui",aligntype_winrect,alignstyle_hcenter+alignstyle_vcenter);
				SetGlobalQuery(GlobalQuery_PlayerShop,1);
				Win_SetCheck("UI.gameui.groceryconfigdlg.shopquerychk", true);
				if(IsCrossServer() == 0) then
					Win_EnableWidget("UI.gameui.groceryconfigdlg.okbtn",true);
				elseif(IsCrossServer() == 1) then
					Win_EnableWidget("UI.gameui.groceryconfigdlg.okbtn",false);
				end;
			end;
				
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_PlayerShop,0);
				--EndShop();
				end;
					  
			children=
			{
			
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 276,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 254,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("商店设置面板");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={36,423,86,24},
					bkimage="res/uires/grocerydlg/beginshop.gsa",
					defaultok=1,							  
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={200,423,86,24},
					bkimage="res/uires/grocerydlg/giveup.gsa",
					defaultcancel=1,
				},
				
				
				nameedit=
				{
					type="EDIT",
					rect={32,401,256,12},	
					textsize=12,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
				};
				
				--是否加入摆摊查询
				shopquerychk=
				{
					type="CHECK",
					rect={197,378,94,20},
					bkimage = "res/uires/newcommon/checkbox.gsa",
				};
				
				grocerylist=
				{
					type="WIDGETLIST",
					rect={33,46,238,328},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,		
					dragtype=ui_drag_type_shop,
					dragindex=-1,
					itemmarginh=4,
					itemmarginv=4,

					primaryscroll="UI.gameui.groceryconfigdlg.groceryscroll",
					template={"res/uires/groceryconfig.lua"};
					
					children={},
					
				},--list
				
				groceryscroll=
				{
			
					type="SCROLLBAR",
					rect={272,63,20,293},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					
					buddywidget="UI.gameui.groceryconfigdlg.grocerylist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
			},
					
		},
			
		-- 我的出售界面，收购界面，具体根据2个背景图切换
		grocerystatusdlg=
		{
			type = "DIALOG",
			rect={0,0,310,430},
			bkimage="res/uires/grocerydlg/grocerystatus.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			moveable=1,
			visible=0,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			dragindex=-1,
			dragtype=ui_drag_type_shop,
			itemdragflag=-1,
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				       
			OnCancel=function()
				  Win_ShowMsgBox("要结束营业吗?","系统消息",ui_msgid_yesno,"UI.gameui.grocerystatusdlg");
				  end;
				  
			OnMsgBoxOk=function()
					    EndShop();
					    Win_ShowWidget("UI.gameui.grocerystatusdlg",false);
					    end;	
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.groceryconfigdlg",false);
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
						    
			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 281,33,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 260,33,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("玩家商店");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				endbtn=
				{
					type="BUTTON",
					rect={211,395,86,24},
					bkimage="res/uires/grocerydlg/endshop.gsa",
					defaultcancel=1,
				},
				
				buylabel=
				{
					type="LABEL",
					rect={7,18,46,26},
					bkimage="res/uires/grocerydlg/buylabel.gsa",
					framescheme={{0},{1}},
					enable=0,					
					visible=0;
				};
				
				grocerylist=
				{
					type="WIDGETLIST",
					rect={39,61,238,326},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,		
					dragtype=ui_drag_type_shop,
					dragindex=-1,
					itemmarginh=4,
					itemmarginv=4,

					primaryscroll="UI.gameui.grocerystatusdlg.groceryscroll",
					template={"res/uires/grocerystatus.lua"};
					
					children={},
					
				},--list
				
				groceryscroll=
				{
			
					type="SCROLLBAR",
					rect={278,77,20,293},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					
					buddywidget="UI.gameui.grocerystatusdlg.grocerylist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll	
				
			};
					
		};		
		
		
		mailresistdlg=
		{
			type = "DIALOG",
			rect={0,0,90,0},			
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_popup,							
			visible=0,
						
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			updatemute=1,
						      
			OnSelfHide=function()
				if Win_IsEnabled("UI.gameui.maillistdlg.mailresistbtn") then
						
				for i=1,9 do
				local wgtname="UI.gameui.mailresistdlg.checkwgt"..i;				
				if Win_IsVisible(wgtname) then
				local breject=Win_IsChecked(wgtname);
				local buddyname=Win_GetText(wgtname);
				MailReject(buddyname,breject);
				end;
				end;
				ConfirmMailReject();
				
				end;
				
				end;		  
			
			OnSelfShow=function()
				num=GetNumGameBuddy();
				if num>9 then
				num=9;
				end;
				
				for i=1,9 do				
				wgtname="UI.gameui.mailresistdlg.checkwgt"..i;
				Win_ShowWidget(wgtname,(i<=num));				
				end;
												
				for i=1,num do				
				local bdyinfo=GetGameBuddy(i);
				local wgtname="UI.gameui.mailresistdlg.checkwgt"..i;
				if bdyinfo~=nil then
				Win_SetText(wgtname,bdyinfo.name);
				Win_SetCheck(wgtname,bdyinfo.breject);
				Win_ShowWidget(wgtname,true);
				else
				Win_ShowWidget(wgtname,false);
				end;								
				end;			
				
				Win_SetSize("UI.gameui.mailresistdlg",90,num*16+16);
				Win_AlignWidget("UI.gameui.mailresistdlg","UI.gameui.maillistdlg.mailresistbtn",aligntype_winrect,alignstyle_top_out+alignstyle_left_in);
				
				end;
			
			children=
			{
				checkwgt1=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,8,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt2=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,24,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt3=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,40,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt4=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,56,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt5=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,72,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt6=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,88,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt7=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,104,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt8=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,120,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
				
				checkwgt9=
				{
					type="CHECK";
					bkimage="res/uires/common/radiobtn.gsa";
					rect={9,136,72,16};
					captionrect={16,2,54,12},
					textsize=12,
					updatemute=1,
				};
			
			};	
		};
		
		--caption="我的邮箱",
		maillistdlg=
		{
				
			type="DIALOG",
			rect={0,0,473,349},
			bkimage="res/uires/maildlg/maillistdlg.gsa",
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			
			dragindex=-1,
			dragtype=ui_drag_type_maillist,
			itemdragflag=-1,
			updatemute=1,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.maillistdlg",false);
				end;
				
			UpdateMailList=function()
				Win_SetValue("UI.gameui.ctrlbar.emailbtn",0,value_channel_framescheme);
				
				local buddynum=GetNumGameBuddy();				
				local var=GetGameVar("rejectmail");				
				Win_EnableWidget("UI.gameui.maillistdlg.mailresistbtn",((var==0)and(buddynum>0)));
				
				local num,svrnum,newnum=GetNumMail();
				local mailindex = Win_GetValue("UI.gameui.maillistdlg.list", value_channel_customid);
				local oldsel = 0;
				local judgesel = GetMailUIIndex(mailindex)-1;
				if judgesel<=0 then
					if num>0 then
					Win_SetValue("UI.gameui.maillistdlg.list",0,value_channel_sel);
					local mailindex = GetMailStubIndex(1);
					Win_SetValue("UI.gameui.maillistdlg.list",mailindex,value_channel_customid);
					end;
				else
					oldsel = judgesel;
				end;
				
				if oldsel>=num then
				oldsel=num-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.maillistdlg.list",num,value_channel_item_num);
				Win_SetValue("UI.gameui.maillistdlg.list",oldsel,value_channel_sel);
				Win_SetValue("UI.gameui.maillistdlg.progvolumn",svrnum);
				Win_SetText("UI.gameui.maillistdlg.mailnumlabel",num);
				Win_SetText("UI.gameui.maillistdlg.newnumlabel",newnum);
				
				end;

			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.maillistdlg",false);
			       end;
				
			
			OnSelfShow=function()
				PushNewbieTips(25);
				UI.children.gameui.children.maillistdlg.UpdateMailList();
				SetGlobalQuery(GlobalQuery_MailListOpen,1);
				RequestNewbieHelp(help_maildlg);
				
				Win_AlignWidget("UI.gameui.maillistdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_MailListOpen,0);
				
				RequestNewbieHelp(help_maildlg,0);
				
				end;
			
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_maildlg,
						offsetx=69,
						offsety=225,
					},
					
				};
			
				closebtn=
				{
					type="BUTTON",
					rect={446,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 424,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_maildlg,-1);
						--[[
						local helpid=GetHelpID("信件列表界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				mailnumlabel= 
				{
					type = "LABEL",
					rect={105,285,32,12};
					drawcolor = { 128, 128, 128, 255 },
					caption="0",
					textsize=12;
					enable=0;				
				};
				
				newnumlabel= 
				{
					type = "LABEL",
					rect={228,285,32,12};
					drawcolor = { 128, 128, 128, 255 },
					caption="0",
					textsize=12;
					enable=0;				
				};				
				
				closemailbtn=
				{
					type="BUTTON",
					rect={390,316,70,24},
					bkimage="res/uires/newcommon/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				};
				
				delbtn=
				{
					type="BUTTON",
					rect={33,316,86,24},
					bkimage="res/uires/maildlg/delbtn.gsa",
					
					OnClick=function()
						idx=Win_GetValue("UI.gameui.maillistdlg.list",value_channel_sel);
						if idx>=0 then
						DeleteMail(idx+1);
						end;
						end;
					
				};				
				
				delallbtn=
				{
					type="BUTTON",
					rect={140,316,86,24},
					bkimage="res/uires/maildlg/delallbtn.gsa",
					
					OnClick=function()
						local num,svrnum,newnum,sysnum=GetNumMail();
						if (num > 0) then
						Win_ShowMsgBox("您确认要删除邮件吗?","系统消息",ui_msgid_yesno,"UI.gameui.maillistdlg.delallbtn");
						end;
						end;
						
					OnMsgBoxOk=function()
						DeleteAllMail();
						end;
				};
				
				mailresistbtn=
				{
					type="BUTTON",
					rect={253,266,86,24},
					bkimage="res/uires/maildlg/mailresistbtn.gsa",	
					visible=0;
					
					OnClick=function()
						    local buddynum=GetNumGameBuddy();
						    if buddynum>0 then
						    if not Win_IsVisible("UI.gameui.mailresistdlg") then
						    Win_ShowWidget("UI.gameui.mailresistdlg",true);
						    Win_ActiveSelf("UI.gameui.mailresistdlg");
						    end;
						    end;
						    end;
				};		
			
			
				configbtn=
				{
					type = "CHECK",
					rect={373,283,86,24},
					bkimage="res/uires/maildlg/configbtn.gsa",				
					framescheme={{2,1,2,1,2,1,2,1},{0,0,0,0,0,0,0,0}},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.maillistdlg.configbtn")  then
						Win_ShowWidget("UI.gameui.mailconfigdlg",true);
						Win_SetFocus("UI.gameui.mailconfigdlg");						     
						else
						Win_ShowWidget("UI.gameui.mailconfigdlg",false);
						end;						     
						end;	
				};
			
				progvolumn=
				{
					type="PROGRESSBAR",
					rect={33,304,220,8},
					bkimage="res/uires/maildlg/volumnbk.gsa",
					progresscover="res/uires/maildlg/volumn.gsa",
					range={0,30},
					enable=0,
				};
				
				list=
				{
					type="LISTBOX",
					rect={37,70,406,204},											
					itemnum=0,
					dragtype=ui_drag_type_maillist,
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,	
					mousedelta=24,
					itemwidth=348,
					itemheight=21,
					itemmarginh=0,
					itemmarginv=0,	
					
					--itemselback="res/uires/family/detailitemsel.gsa",
					--itemselpos={0,0,0,-1},	
					
					OnDBClick=function(sel)
						local sel=Win_GetValue("UI.gameui.maillistdlg.list",value_channel_sel);
						if sel>=0 then
						ReceiveMail(sel+1);
						end;
						end;
					
					OnClick=function()
						local num=Win_GetValue("UI.gameui.maillistdlg.list",value_channel_item_num);
						if (num>0) then
							local sel=Win_GetValue("UI.gameui.maillistdlg.list",value_channel_sel);
							local mailindex = GetMailStubIndex(sel+1);
							Win_SetValue("UI.gameui.maillistdlg.list",mailindex,value_channel_customid);
							end;
						end;
				

					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={403,17,20,168},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",									
								
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
							};--children
						};--scroll
					};
				},--list
			};
		};
		
		--请帖邮件
		invitationmaildlg=
		{
			type="DIALOG",
			rect={0,0,474,302},		
			bkimage="res/uires/marriagesys/invitationmaildlgbk.gsa", 
			textsize=12,
			textfont=1,
			moveable=1,	
			style=wgtstyle_topmost,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.invitationmaildlg","UI.gameui.accelbar",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_out,0,2);
			end;

			children=
			{
				
				closebtn=
				{
					type="BUTTON",
					rect={430,24,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 410,24,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("请帖界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				husbandlabel=
				{
					type="LABEL",
					rect={255,102,80,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
				};
				
				wifelabel=
				{
					type="LABEL",
					rect={352,102,80,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
				};
				
				marriagedate=
				{
					type="LABEL",
					rect={335,173,120,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
				};
			};
		};
		--豪华请帖邮件
		luxinvitationmaildlg=
		{
			type="DIALOG",
			rect={0,0,491,321},		
			bkimage="res/uires/marriagesys/luxinvitationmaildlgbk.gsa", 
			textsize=12,
			textfont=1,
			moveable=1,	
			style=wgtstyle_topmost,
			visible=0,
			updatemute=1,
				
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.luxinvitationmaildlg","UI.gameui.accelbar",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_out,0,2);
			end;
				
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={436,24,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 416,24,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
				
					OnClick=function()
						local helpid=GetHelpID("请帖界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				husbandlabel=
				{
					type="LABEL",
					rect={267,107,80,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
			};
		
				wifelabel=
				{
					type="LABEL",
					rect={364,107,80,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
		};
		
				marriagedate=
				{
					type="LABEL",
					rect={347,179,120,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_center,
				};
			};
		};
		
		--发送普通邮件
		sendmaildlg=
		{
				
			type="DIALOG",
			rect={0,0,304,395},			
			bkimage="res/uires/maildlg/maildlg.gsa",
			adornpic={"res/uires/maildlg/receiver.gsa", "res/uires/maildlg/maildlg_send.gsa"},
			adornpicpos={{30,73}, {117,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
					
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.sendmaildlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				SetGlobalQuery(GlobalQuery_WriteMail,1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_WriteMail,0);
				end;
				
			OnOk=function()
				local pto=Win_GetText("UI.gameui.sendmaildlg.manedit");
				if pto=="" then
				Win_ShowMsgBox("请输入收件人名称！");
				else
				local ptitle=Win_GetText("UI.gameui.sendmaildlg.titleedit");
				local pbody=Win_GetText("UI.gameui.sendmaildlg.contentedit");
				local ntype=Win_GetValue("UI.gameui.sendmaildlg",value_channel_customtype);
				SendMail(ntype,pto, ptitle, pbody,money); 
				Win_ShowWidget("UI.gameui.sendmaildlg",false);				
				end;
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.sendmaildlg",false);
			       end;			
					
			children=
			{
								
				closebtn=
				{
					type="BUTTON",
					rect={275,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("信纸发送界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				
				sendbtn=
				{
					type="BUTTON",
					rect={146,361,69,24},
					bkimage="res/uires/newcommon/sendbtn.gsa",					
					tiptext="发送",
					defaultok=1,								
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={222,361,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",
					defaultcancel=1,
					tiptext="取消",
					soundid={1007},
				},
				
								
				facebtn = 
				{
					type = "CHECK",
					rect={271,71,19,19},
					bkimage="res/uires/maildlg/facebtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					tiptext="Alt+B",
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendmaildlg.facebtn")  then
						     Win_SetText("UI.gameui.facedlg","UI.gameui.sendmaildlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.facedlg","UI.gameui.sendmaildlg.facebtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.facedlg",true);
						     Win_SetFocus("UI.gameui.facedlg.facelist");		     
						     end;						     
						     end;
				};
				
				
				colorbtn = 
				{
					type="CHECK",
					rect={245,71,19,19},
					bkimage="res/uires/maildlg/colorbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendmaildlg.colorbtn")  then
						     Win_SetText("UI.gameui.colordlg","UI.gameui.sendmaildlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.colordlg","UI.gameui.sendmaildlg.colorbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.colordlg",true);
						     Win_SetFocus("UI.gameui.colordlg");						     
						     end;						     
						     end;
					
				};
				
				fontbtn=
				{
					type="BUTTON",
					rect={219,71,19,19},
					bkimage="res/uires/maildlg/fontbtn.gsa",
					framescheme={{0,0,1,1,1,1,2,2}},
					
					OnClick=function()
						    font=Win_EditGetFont("UI.gameui.sendmaildlg.contentedit");
						    if font==0 then
						    font =1;
						    else 
						    font =0;
						    end;
						    
						    Win_EditSetFont("UI.gameui.sendmaildlg.contentedit",font);
						    end;
				};
				
				manbtn = 
				{
					type = "CHECK",
					rect = { 194,72, 16, 16 },
					bkimage = "res/uires/newcommon/dropbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.sendmaildlg.manbtn")  then
						Win_SetText("UI.gameui.mandlg","UI.gameui.sendmaildlg",value_channel_customname);
						Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendmaildlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
						Win_ShowWidget("UI.gameui.mandlg",true);
						Win_SetFocus("UI.gameui.mandlg");						     
						end;						     
						end;
				};	
				
				manedit=
				{
					type="EDIT",
					rect={83,75,110,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=32,
					
					OnDBClick=function()
						Win_SetText("UI.gameui.mandlg","UI.gameui.sendmaildlg",value_channel_customname);
						Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendmaildlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
						Win_ShowWidget("UI.gameui.mandlg",true);
						Win_SetFocus("UI.gameui.mandlg");						     
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendmaildlg.contentedit");
						   end;
				};
				
				titleedit=
				{
					type="EDIT",
					rect={83,51,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=100,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendmaildlg.manedit");
						   end;
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,100,252,254},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_noitem,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,	
					richflag=1,
					
					OnError=function(errid)
						if errid==wgterror_medit_font then
						Win_ShowMsgBox("文字太多,无法插入字体!");
						elseif errid==wgterror_medit_color then
						Win_ShowMsgBox("文字太多,无法插入颜色!");
						elseif errid==wgterror_medit_insert then
						Win_ShowMsgBox("文字太多,无法插入!");
						end;						
						end;
					
					OnEnter=function()
					    local pto=Win_GetText("UI.gameui.sendmaildlg.manedit");
					    local ptitle=Win_GetText("UI.gameui.sendmaildlg.titleedit");
					    local pbody=Win_GetText("UI.gameui.sendmaildlg.contentedit");
					    local ntype=Win_GetValue("UI.gameui.sendmaildlg",value_channel_customtype);
					    SendMail(ntype,pto, ptitle, pbody,money); 
					    Win_ShowWidget("UI.gameui.sendmaildlg",false);
					    end;	
					    
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendmaildlg.titleedit");
						   end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={232,17,20,218},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							enable=1;
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.sendmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.sendmaildlg.contentedit", 0, 0, 252-20, 254, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.sendmaildlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.sendmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.sendmaildlg.contentedit", 0, 0, 252, 254, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
							};--children
						};--scroll
					};	
				};
			};
		};
			
		-- 接收普通邮件
		readmaildlg=
		{
				
			type="DIALOG",
			rect={0,0,304,395},			
			bkimage="res/uires/maildlg/maildlg.gsa",			
			adornpic={"res/uires/maildlg/sender.gsa", "res/uires/maildlg/maildlg_normal.gsa"},
			adornpicpos={{30,73}, {117,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.readmaildlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			OnOk=function()
				local ptitle=Win_GetText("UI.gameui.readmaildlg.titleedit");				    
				local pto=Win_GetText("UI.gameui.readmaildlg.manedit");
				WriteMail(0,pto,ptitle);
				Win_ShowWidget("UI.gameui.readmaildlg",false);				
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.readmaildlg",false);
			       end;	
			
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={275,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("信纸接受界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				--读邮件
				replybtn=
				{
					type="BUTTON",
					rect={30,362,86,24},
					bkimage="res/uires/maildlg/replybtn.gsa",
					tiptext="回复",
					defaultok=1,					
				},
				
				sendsmallbtn=
				{
					type="BUTTON",
					rect={118,362,86,24},
					bkimage="res/uires/maildlg/sendsmall.gsa",
					tiptext="寄小包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.readmaildlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.readmaildlg.manedit");
						    WriteMail(1,pto,ptitle);
						    end;
				},
				
				sendbigbtn=
				{
					type="BUTTON",
					rect={207,362,86,24},
					bkimage="res/uires/maildlg/sendbig.gsa",
					tiptext="寄大包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.readmaildlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.readmaildlg.manedit");
						    WriteMail(2,pto,ptitle);
						    end;
				},
				
				
				manedit=
				{
					type="EDIT",
					rect={83,75,122,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_left,					
					editable=0,
				};
				
				titleedit=
				{
					type="EDIT",					
					rect={83,51,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},										
					textstyle=dt_left,
					maxchar=100,
					editable=0,
										
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,100,252,254},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,		
					editable=0,
					richflag=1,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={232,17,20,218},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							enable=1;
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.readmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.readmaildlg.contentedit", 0, 0, 252-20, 254, value_channel_captionrect);
									Win_SetValue("UI.gameui.readmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.readmaildlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.readmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.readmaildlg.contentedit", 0, 0, 252, 254, value_channel_captionrect);
									Win_SetValue("UI.gameui.readmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
							};--children
						};--scroll
					};
				};
			};
		};
		
		-- 接收彩玉邮件
		exreadmaildlg=
		{
				
			type="DIALOG",
			rect={0,0,304,395},			
			bkimage="res/uires/maildlg/exmaildlg.gsa",			
			adornpic={"res/uires/maildlg/sender.gsa", "res/uires/maildlg/maildlg_normal.gsa"},
			adornpicpos={{30,73}, {117,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.exreadmaildlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			OnOk=function()
				local ptitle=Win_GetText("UI.gameui.exreadmaildlg.titleedit");				    
				local pto=Win_GetText("UI.gameui.exreadmaildlg.manedit");
				WriteMail(0,pto,ptitle);
				Win_ShowWidget("UI.gameui.exreadmaildlg",false);				
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.exreadmaildlg",false);
			       end;	
			
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={275,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("信纸接受界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				--读邮件
				replybtn=
				{
					type="BUTTON",
					rect={30,362,86,24},
					bkimage="res/uires/maildlg/replybtn.gsa",
					tiptext="回复",
					defaultok=1,					
				},
				
				sendsmallbtn=
				{
					type="BUTTON",
					rect={118,362,86,24},
					bkimage="res/uires/maildlg/sendsmall.gsa",
					tiptext="寄小包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.exreadmaildlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.exreadmaildlg.manedit");
						    WriteMail(1,pto,ptitle);
						    end;
				},
				
				sendbigbtn=
				{
					type="BUTTON",
					rect={207,362,86,24},
					bkimage="res/uires/maildlg/sendbig.gsa",
					tiptext="寄大包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.exreadmaildlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.exreadmaildlg.manedit");
						    WriteMail(2,pto,ptitle);
						    end;
				},
				
				
				manedit=
				{
					type="LABEL",
					rect={83,75,122,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_left,					
					editable=0,
				};
				
				titleedit=
				{
					type="EDIT",					
					rect={83,51,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},										
					textstyle=dt_left,
					maxchar=100,
					editable=0,
				};
				
				bowlderedit=
				{
					type="LABEL",					
					rect={72,341,80,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},										
					textstyle=dt_center+dt_vcenter,
					enable=0;
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,100,252,228},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,		
					editable=0,
					richflag=1,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={232,17,20,192},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							enable=1;
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.exreadmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.exreadmaildlg.contentedit", 0, 0, 252-20, 228, value_channel_captionrect);
									Win_SetValue("UI.gameui.exreadmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.exreadmaildlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.exreadmaildlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.exreadmaildlg.contentedit", 0, 0, 252, 228, value_channel_captionrect);
									Win_SetValue("UI.gameui.exreadmaildlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll
					};
				};
			};
		};
		
		--caption="发送大包裹",
		sendbigpackdlg=
		{
				
			type="DIALOG",
			rect={0,0,304,423},			
			bkimage="res/uires/maildlg/bigpackdlg.gsa",
			adornpic={"res/uires/maildlg/receiver.gsa", "res/uires/maildlg/bigpackdlg_send.gsa"},
			adornpicpos={{30,70}, {107,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.sendbigpackdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				SetGlobalQuery(GlobalQuery_WriteBigPack,1);
				if(IsCrossServer() == 0) then
					Win_ShowWidget("UI.gameui.sendbigpackdlg.sendbtn",true);
				elseif(IsCrossServer() == 1) then
					Win_ShowWidget("UI.gameui.sendbigpackdlg.sendbtn",false);
				end;
				
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_WriteBigPack,0);
				end;
				
			OnOk=function()
				if(IsCrossServer() == 0) then
					local pto=Win_GetText("UI.gameui.sendbigpackdlg.manedit");
					if pto=="" then
					Win_ShowMsgBox("请输入收件人名称！");
					else
					local ptitle=Win_GetText("UI.gameui.sendbigpackdlg.titleedit");
					local pbody=Win_GetText("UI.gameui.sendbigpackdlg.contentedit");
					
					local gold=Win_GetValue("UI.gameui.sendbigpackdlg.goldedit");
					local silver=Win_GetValue("UI.gameui.sendbigpackdlg.silveredit");
					local copper=Win_GetValue("UI.gameui.sendbigpackdlg.copperedit");
					local money=gold*1000000+silver*1000+copper;
					
					SendMail(2,pto, ptitle, pbody,money); 
					Win_ShowWidget("UI.gameui.sendbigpackdlg",false);
					end;
				end;
			end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.sendbigpackdlg",false);
			       end;	
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={275,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("超级包袱发送界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				sendbtn=
				{
					type="BUTTON",
					rect={146,389,69,24},
					bkimage="res/uires/newcommon/sendbtn.gsa",					
					tiptext="发送",
					defaultok=1,
					
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={223,389,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",
					defaultcancel=1,
					tiptext="取消",
					soundid={1007},
				},
				
				facebtn = 
				{
					type = "CHECK",
					rect={271,71,19,19},
					bkimage="res/uires/maildlg/facebtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					tiptext="Alt+B",
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.sendbigpackdlg.facebtn")  then
						Win_SetText("UI.gameui.facedlg","UI.gameui.sendbigpackdlg",value_channel_customname);
						Win_AlignWidget("UI.gameui.facedlg","UI.gameui.sendbigpackdlg.facebtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						Win_ShowWidget("UI.gameui.facedlg",true);
						Win_SetFocus("UI.gameui.facedlg.facelist");
						end;						     
						end;				
					
				};
				
				
				colorbtn = 
				{
					type="CHECK",
					rect={245,71,19,19},
					bkimage="res/uires/maildlg/colorbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendbigpackdlg.colorbtn")  then
						     Win_SetText("UI.gameui.colordlg","UI.gameui.sendbigpackdlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.colordlg","UI.gameui.sendbigpackdlg.colorbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.colordlg",true);
						     Win_SetFocus("UI.gameui.colordlg");						     
						     end;						     
						     end;
					
				};
				
				fontbtn=
				{
					type="BUTTON",
					rect={219,71,19,19},
					bkimage="res/uires/maildlg/fontbtn.gsa",
					
					OnClick=function()
						    font=Win_EditGetFont("UI.gameui.sendbigpackdlg.contentedit");
						    if font==0 then
						    font =1;
						    else 
						    font =0;
						    end;
						    
						    Win_EditSetFont("UI.gameui.sendbigpackdlg.contentedit",font);
						    end;
				};
				
				manbtn = 
				{
					type = "CHECK",
					rect = { 194,72, 16, 16 },
					bkimage = "res/uires/newcommon/dropbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					OnClick=function()
					     if  Win_IsChecked("UI.gameui.sendbigpackdlg.manbtn")  then
					     Win_SetText("UI.gameui.mandlg","UI.gameui.sendbigpackdlg",value_channel_customname);
					     Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendbigpackdlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
					     Win_ShowWidget("UI.gameui.mandlg",true);
					     Win_SetFocus("UI.gameui.mandlg");						     
					     end;						     
					     end;
					
				};	
				
				manedit=
				{
					type="EDIT",
					rect={83,74,110,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=32,
					
					OnDBClick=function()
					     Win_SetText("UI.gameui.mandlg","UI.gameui.sendbigpackdlg",value_channel_customname);
					     Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendbigpackdlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
					     Win_ShowWidget("UI.gameui.mandlg",true);
					     Win_SetFocus("UI.gameui.mandlg");						     
					     end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.contentedit");
						   end;
				};
				
				titleedit=
				{
					type="EDIT",
					rect={83,50,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=100,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.manedit");
						   end;
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,99,252,164},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,				
					richflag=1,
					
					OnError=function(errid)
						if errid==wgterror_medit_font then
						Win_ShowMsgBox("文字太多,无法插入字体!");
						elseif errid==wgterror_medit_color then
						Win_ShowMsgBox("文字太多,无法插入颜色!");
						elseif errid==wgterror_medit_insert then
						Win_ShowMsgBox("文字太多,无法插入!");
						end;						
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.goldedit");
						   end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={232,17,20,128},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.sendbigpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.sendbigpackdlg.contentedit", 0, 0, 252-20, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendbigpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.sendbigpackdlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.sendbigpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.sendbigpackdlg.contentedit", 0, 0, 252, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendbigpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};

				};
				
				goldedit=
				{
					type="EDIT",
					rect={59,363,24,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={-19,0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=2000,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendbigpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendbigpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendbigpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendbigpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.silveredit");
						   end;
					
					
				},
				
				silveredit=
				{
					type="EDIT",
					rect={110,363,24,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={-19, 0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendbigpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendbigpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendbigpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendbigpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.copperedit");
						   end;					
					
				},
				
				copperedit=
				{
					type="EDIT",
					rect={159,363,24,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={-19,0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendbigpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendbigpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendbigpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendbigpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendbigpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendbigpackdlg.titleedit");
						   end;
										
				},
				
				mailitem0=
				{						
					type="WIDGET",
					rect={39,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=0,
					dragtype=ui_drag_type_bigpack_write,	
					style=wgtstyle_renderitem,																	
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem1=
				{						
					type="WIDGET",
					rect={81,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=1,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem2=
				{						
					type="WIDGET",
					rect={123,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=2,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem3=
				{						
					type="WIDGET",
					rect={165,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=3,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem4=
				{						
					type="WIDGET",
					rect={207,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=4,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem5=
				{						
					type="WIDGET",
					rect={250,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=5,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem6=
				{						
					type="WIDGET",
					rect={39,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=6,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem7=
				{						
					type="WIDGET",
					rect={81,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=7,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem8=
				{						
					type="WIDGET",
					rect={123,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=8,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem9=
				{						
					type="WIDGET",
					rect={165,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=9,
					dragtype=ui_drag_type_bigpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
			};
		};
		
		--caption="收取大包裹",
		readbigpackdlg=
		{
			type="DIALOG",
			rect={0,0,304,423},			
			bkimage="res/uires/maildlg/bigpackdlg.gsa",			
			adornpic={"res/uires/maildlg/sender.gsa", "res/uires/maildlg/bigpackdlg_receive.gsa"},
			adornpicpos={{30,70}, {107,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.readbigpackdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
			
			OnOk=function()
				local ptitle=Win_GetText("UI.gameui.readbigpackdlg.titleedit");						    
				local pto=Win_GetText("UI.gameui.readbigpackdlg.manedit");
				WriteMail(0,pto,ptitle);
				Win_ShowWidget("UI.gameui.readbigpackdlg",false);				
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.readbigpackdlg",false);
			       end;			
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={275,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("超级包袱接受界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				replybtn=
				{
					type="BUTTON",
					rect={30,389,86,24},
					bkimage="res/uires/maildlg/replybtn.gsa",
					defaultok=1,
					tiptext="回复",
				},
				
				sendsmallbtn=
				{
					type="BUTTON",
					rect={120,389,86,24},
					bkimage="res/uires/maildlg/sendsmall.gsa",
					tiptext="寄小包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.readbigpackdlg.titleedit");
						    local pto=Win_GetText("UI.gameui.readbigpackdlg.manedit");
						    WriteMail(1,pto,ptitle);
						    end;
				},
				
				sendbigbtn=
				{
					type="BUTTON",
					rect={210,389,86,24},
					bkimage="res/uires/maildlg/sendbig.gsa",
					tiptext="寄大包裹",
					
					OnClick=function()						    
						    local ptitle=Win_GetText("UI.gameui.readbigpackdlg.titleedit");
						    local pto=Win_GetText("UI.gameui.readbigpackdlg.manedit");
						    WriteMail(2,pto,ptitle);
						    end;
				},
				
				manedit=
				{
					type="EDIT",
					rect={83,74,110,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					textstyle=dt_left,					
					editable=0,
				};
				
				titleedit=
				{
					type="EDIT",					
					rect={83,50,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					textstyle=dt_left,
					maxchar=100,
					editable=0,
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,99,252,164},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,	
					editable=0,
					richflag=1,
										
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={232,17,20,128},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,	
	
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.readbigpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.readbigpackdlg.contentedit", 0, 0, 252-20, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.readbigpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.readbigpackdlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.readbigpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.readbigpackdlg.contentedit", 0, 0, 252, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.readbigpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,	
								};--spindown
							};--children
						};--scroll
					};					
				};
				
				goldedit=
				{
					type="LABEL",
					rect={59,363,24,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={-19,0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					enable=0;
				},
				
				silveredit=
				{
					type="LABEL",
					rect={110,363,24,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={-19, 0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					enable=0;
				},
				
				copperedit=
				{
					type="LABEL",
					rect={159,363,24,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={-19,0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					enable=0;
				},
				
				mailitem0=
				{						
					type="WIDGET",
					rect={39,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=0,
					dragtype=ui_drag_type_bigpack_recv,	
					style=wgtstyle_renderitem,																	
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem1=
				{						
					type="WIDGET",
					rect={81,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=1,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem2=
				{						
					type="WIDGET",
					rect={123,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=2,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem3=
				{						
					type="WIDGET",
					rect={165,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=3,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem4=
				{						
					type="WIDGET",
					rect={207,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=4,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem5=
				{						
					type="WIDGET",
					rect={250,276,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=5,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem6=
				{						
					type="WIDGET",
					rect={39,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=6,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem7=
				{						
					type="WIDGET",
					rect={81,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=7,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem8=
				{						
					type="WIDGET",
					rect={123,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=8,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mailitem9=
				{						
					type="WIDGET",
					rect={165,317,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=9,
					dragtype=ui_drag_type_bigpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
			};
		};
		
		--caption="发送小包裹",
		sendsmallpackdlg=
		{
				
			type="DIALOG",
			rect={0,0,304,385},			
			bkimage="res/uires/maildlg/smallpackdlg.gsa",
			adornpic={"res/uires/maildlg/receiver.gsa", "res/uires/maildlg/smallpackdlg_send.gsa"},
			adornpicpos={{30,70}, {107,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.sendsmallpackdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				SetGlobalQuery(GlobalQuery_WriteSmallPack,1);
				
				if(IsCrossServer() == 0) then
					Win_ShowWidget("UI.gameui.sendsmallpackdlg.sendbtn",true);
				elseif(IsCrossServer() == 1) then
					Win_ShowWidget("UI.gameui.sendsmallpackdlg.sendbtn",false);
				end;
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_WriteSmallPack,0);
				end;
				
			OnOk=function()
				if(IsCrossServer() == 0) then
					local pto=Win_GetText("UI.gameui.sendsmallpackdlg.manedit");
					
					if pto=="" then
					Win_ShowMsgBox("请输入收件人名称！");
					else				
					local ptitle=Win_GetText("UI.gameui.sendsmallpackdlg.titleedit");
					local pbody=Win_GetText("UI.gameui.sendsmallpackdlg.contentedit");
					
					local gold=Win_GetValue("UI.gameui.sendsmallpackdlg.goldedit");
					local silver=Win_GetValue("UI.gameui.sendsmallpackdlg.silveredit");
					local copper=Win_GetValue("UI.gameui.sendsmallpackdlg.copperedit");
					local money=gold*1000000+silver*1000+copper;
					
					SendMail(1,pto, ptitle, pbody,money); 
					Win_ShowWidget("UI.gameui.sendsmallpackdlg",false);				
					end;
				end;
			end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.sendsmallpackdlg",false);
			       end;	
						    
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={275,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("包袱发送界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				sendbtn=
				{
					type="BUTTON",
					rect={146,351,69,24},
					bkimage="res/uires/newcommon/sendbtn.gsa",					
					tiptext="发送",
					defaultok=1,
					
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={224,351,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",
					defaultcancel=1,
					tiptext="取消",
					soundid={1007},
				},
								
				facebtn = 
				{
					type = "CHECK",
					rect={271,71,19,19},
					bkimage="res/uires/maildlg/facebtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					tiptext="Alt+B",
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendsmallpackdlg.facebtn")  then
						     Win_SetText("UI.gameui.facedlg","UI.gameui.sendsmallpackdlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.facedlg","UI.gameui.sendsmallpackdlg.facebtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.facedlg",true);
						     Win_SetFocus("UI.gameui.facedlg.facelist");					     
						     end;
						     end;	
				};
				
				colorbtn = 
				{
					type="CHECK",
					rect={245,71,19,19},
					bkimage="res/uires/maildlg/colorbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendsmallpackdlg.colorbtn")  then
						     Win_SetText("UI.gameui.colordlg","UI.gameui.sendsmallpackdlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.colordlg","UI.gameui.sendsmallpackdlg.colorbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.colordlg",true);
						     Win_SetFocus("UI.gameui.colordlg");						     
						     end;						     
						     end;
				};
				
				fontbtn=
				{
					type="BUTTON",
					rect={219,71,19,19},
					bkimage="res/uires/maildlg/fontbtn.gsa",
					
					OnClick=function()
						    font=Win_EditGetFont("UI.gameui.sendsmallpackdlg.contentedit");
						    if font==0 then
						    font =1;
						    else 
						    font =0;
						    end;
						    
						    Win_EditSetFont("UI.gameui.sendsmallpackdlg.contentedit",font);
						    end;
				};
				
				manbtn = 
				{
					type = "CHECK",
					rect = { 194,72, 16, 16 },
					bkimage = "res/uires/newcommon/dropbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{2,2,1,1,2,2,2,2},{0,0,0,0,0,0,2,2}},
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.sendsmallpackdlg.manbtn")  then
						     Win_SetText("UI.gameui.mandlg","UI.gameui.sendsmallpackdlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendsmallpackdlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
						     Win_ShowWidget("UI.gameui.mandlg",true);
						     Win_SetFocus("UI.gameui.mandlg");						     
						     end;						     
						     end;	
				};	
				
				manedit=
				{
					type="EDIT",
					rect={83,74,110,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=32,
					
					OnDBClick=function()
						Win_SetText("UI.gameui.mandlg","UI.gameui.sendsmallpackdlg",value_channel_customname);
						Win_AlignWidget("UI.gameui.mandlg","UI.gameui.sendsmallpackdlg.manbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_out,0,2);
						Win_ShowWidget("UI.gameui.mandlg",true);
						Win_SetFocus("UI.gameui.mandlg");		
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.contentedit");
						   end;
				};
				
				titleedit=
				{
					type="EDIT",
					rect={83,50,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=100,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.manedit");
						   end;
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,99,252,164},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,						
					richflag=1,
					
					OnError=function(errid)
						if errid==wgterror_medit_font then
						Win_ShowMsgBox("文字太多,无法插入字体!");
						elseif errid==wgterror_medit_color then
						Win_ShowMsgBox("文字太多,无法插入颜色!");
						elseif errid==wgterror_medit_insert then
						Win_ShowMsgBox("文字太多,无法插入!");
						end;						
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.goldedit");
						   end;
						   
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={232,17,20,128},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.sendsmallpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.sendsmallpackdlg.contentedit", 0, 0, 252-20, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendsmallpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.sendsmallpackdlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.sendsmallpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.sendsmallpackdlg.contentedit", 0, 0, 252, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.sendsmallpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
							};--children
						};--scroll
					};
				};
				
				goldedit=
				{
					type="EDIT",
					rect={59,323,24,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={-19,0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=2000,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendsmallpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendsmallpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendsmallpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendsmallpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.silveredit");
						   end;
				},
				
				silveredit=
				{
					type="EDIT",
					rect={110,323,24,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={-19, 0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendsmallpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendsmallpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendsmallpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendsmallpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.copperedit");
						   end;
				},
				
				copperedit=
				{
					type="EDIT",
					rect={159,323,24,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={-19,0};
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.sendsmallpackdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.sendsmallpackdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.sendsmallpackdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.sendsmallpackdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.sendsmallpackdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.sendsmallpackdlg.titleedit");
						   end;
				},
				
				mailitem0=
				{						
					type="WIDGET",
					rect={41,277,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=0,
					dragtype=ui_drag_type_smallpack_write,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
			};
		};
		
		--caption="接收小包裹",
		readsmallpackdlg=
		{
			type="DIALOG",
			rect={0,0,304,385},			
			bkimage="res/uires/maildlg/smallpackdlg.gsa",			
			adornpic={"res/uires/maildlg/sender.gsa", "res/uires/maildlg/smallpackdlg_receive.gsa"},
			adornpicpos={{30,70}, {107,15}},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.readsmallpackdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			OnOk=function()
				local ptitle=Win_GetText("UI.gameui.readsmallpackdlg.titleedit");				    
				local pto=Win_GetText("UI.gameui.readsmallpackdlg.manedit");
				WriteMail(0,pto,ptitle);
				Win_ShowWidget("UI.gameui.readsmallpackdlg",false);				
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.readsmallpackdlg",false);
			       end;	
			
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={275,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("包袱接受界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				replybtn=
				{
					type="BUTTON",
					rect={30,351,86,24},
					bkimage="res/uires/maildlg/replybtn.gsa",
					defaultok=1,
					tiptext="回复",
					defaultok=1,
				},
				
				sendsmallbtn=
				{
					type="BUTTON",
					rect={120,352,86,24},
					bkimage="res/uires/maildlg/sendsmall.gsa",
					tiptext="寄小包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.readsmallpackdlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.readsmallpackdlg.manedit");
						    WriteMail(1,pto,ptitle);
						    end;
				},
				
				sendbigbtn=
				{
					type="BUTTON",
					rect={210,352,86,24},
					bkimage="res/uires/maildlg/sendbig.gsa",
					tiptext="寄大包裹",
					
					OnClick=function()
						    local ptitle=Win_GetText("UI.gameui.readsmallpackdlg.titleedit");						    
						    local pto=Win_GetText("UI.gameui.readsmallpackdlg.manedit");
						    WriteMail(2,pto,ptitle);
						    end;
				},
				
				manedit=
				{
					type="EDIT",
					rect={83,74,110,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					textstyle=dt_left,
					editable=0,
				};
				
				titleedit=
				{
					type="EDIT",					
					rect={83,50,204,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					textstyle=dt_left,
					maxchar=100,
					editable=0,
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={37,99,252,164},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,	
					editable=0,
					richflag=1,
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={232,17,20,128},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.readsmallpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w == 252) then
									Win_SetRect("UI.gameui.readsmallpackdlg.contentedit", 0, 0, 252-20, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.readsmallpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								Win_SetValue("UI.gameui.readsmallpackdlg.contentedit.vscroll", 0, value_channel_pos);
								local panelrect = Win_GetRect("UI.gameui.readsmallpackdlg.contentedit", value_channel_captionrect);
								if (panelrect.w < 252) then
									Win_SetRect("UI.gameui.readsmallpackdlg.contentedit", 0, 0, 252, 164, value_channel_captionrect);
									Win_SetValue("UI.gameui.readsmallpackdlg.contentedit",1,value_channel_update_dirty);
								end;
							end;
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll
					};
				};
				
				goldedit=
				{
					type="LABEL",
					rect={59,323,24,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={-19,0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={110,323,24,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={-19, 0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
				},
				
				copperedit=
				{
					type="LABEL",
					rect={159,323,24,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={-19,0};
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
				},
				
				mailitem0=
				{						
					type="WIDGET",
					rect={41,277,36,36},
					bkimage="res/uires/newcommon/itembkimg.gsa",
					bkimagepos={-2,-2};
					dragindex=0,
					dragtype=ui_drag_type_smallpack_recv,																		
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
			};
		};
				
		transportdlg=
		{
		
			type="DIALOG",
			rect={186,45,343,426},
			captionrect={70,27,180,12},
			caption="传送",
			textsize=12,
			textfont=1,
			bkimage="res/uires/transportdlg/transportdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0,
			moveable=1,
			updatemute=1,
				
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.transportdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			OnSelfHide=function()
				TransportClose();
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.transportdlg",false);
				end;
			
			OnOk=function()
				sel=Win_GetSelect("UI.gameui.transportdlg.list",0);				
				TransportTo(sel+1);
				Win_ShowWidget("UI.gameui.transportdlg",false);
				end;
			
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={294,23,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 273,23,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("传送界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={226,399,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				transportbtn=
				{
					type="BUTTON",
					rect={30,399,90,22},
					bkimage="res/uires/transportdlg/transportbtn.gsa",
					defaultok=1,
				},
				
				list=
				{					
					type="WIDGETLIST",
					rect={34,54,257,340},	
					style=wgtstyle_clipchild_window,	
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,
					dragtype=ui_drag_type_transport,
					dragindex=-1,
					primaryscroll="UI.gameui.transportdlg.vscroll",
					itemmarginh=0,
					itemmarginv=0,
					
					template={"res/uires/transitem.lua"};
					
					children={},								
				},--list
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={297,72,15,300},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.transportdlg.list",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
			},	
		
		};
		
		--传送
		extransportdlg=
		{
		
			type="DIALOG",
			rect={0,0,235,407},
			bkimage="res/uires/transportdlg/extransportdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			moveable=1,
			updatemute=1,
				
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.extransportdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			OnSelfHide=function()
				TransportClose();
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.extransportdlg",false);
				end;
			
			OnOk=function()
				sel=Win_GetSelect("UI.gameui.extransportdlg.list",0);				
				TransportTo(sel+1);
				Win_ShowWidget("UI.gameui.extransportdlg",false);
				end;
			
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={234,23,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					visible=0;
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 213,23,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					visible=0;
					
					OnClick=function()
						local helpid=GetHelpID("传送界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={133,370,86,24},
					bkimage="res/uires/newcommon/cancelsmallbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				transportbtn=
				{
					type="BUTTON",
					rect={16,370,86,24},
					bkimage="res/uires/transportdlg/transportbtn.gsa",
					defaultok=1,
				},
				
				list=
				{					
					type="WIDGETLIST",
					rect={24,59,171,301},	
					style=wgtstyle_clipchild_window,	
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,
					dragtype=ui_drag_type_transport,
					dragindex=-1,
					primaryscroll="UI.gameui.extransportdlg.vscroll",
					itemmarginh=0,
					itemmarginv=0,
					
					template={"res/uires/extransitem.lua"};
					
					children={},								
				},--list
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={193,77,20,263},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.extransportdlg.list",
														
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
			},	
		
		};
		
		figuredlg=
		{
		
			type="DIALOG",
			rect={0,0,345,476},
			captionrect={95,38,150,12},
			textfont=1,
			textsize=12,
			drawcolor={255,255,255,255},
			bkimage="res/uires/figuredlg/figuredlg.gsa",			
			style=wgtstyle_topmost,
			moveable=1,	
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_vcenter+alignstyle_hcenter,	
			updatemute=1,
			
			OnSelfShow=function()
					sel=Win_GetValue("UI.gameui.figuredlg.list",value_channel_sel);
					bufinfo=Win_GetCustomBuffer("UI.gameui.figuredlg.figureview");
					bufinfo.index=sel;		   
					Win_SetCustomBuffer("UI.gameui.figuredlg.figureview",bufinfo);
					end;
			
			OnOk=function()
				  sel=Win_GetValue("UI.gameui.figuredlg.list",value_channel_sel);
				  ChangePlayerFigure(sel);
				  end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={276,34,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 256,34,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local mode=Win_GetValue("UI.gameui.figuredlg",value_channel_customtype);
						local helpid=GetHelpID("发色");
						if mode==1 then
						helpid=GetHelpID("发型");
						end;
						
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={67,441,90,22},
					bkimage="res/uires/figuredlg/figurebtn.gsa",
					defaultok=1,
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={205,441,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				
				
				figureview=
				{
					type = "WIDGET",
					rect = { 127,111,88,107 },
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_figure,
					enable=0,
				},
										
				list=
				{
					type="LISTBOX",
					rect={60,272,202,160},								
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_figure,

					itemheight=40,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					OnValueChange=function()
						sel=Win_GetValue("UI.gameui.figuredlg.list",value_channel_sel);
						bufinfo=Win_GetCustomBuffer("UI.gameui.figuredlg.figureview");
						bufinfo.index=sel;		   
						Win_SetCustomBuffer("UI.gameui.figuredlg.figureview",bufinfo);
						end;				
			
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={214,14,15,128},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
				},--list
			},	
		};
		
		
		--仓库列表
		garagedlg=
		{
		
			type="DIALOG",
			rect={0,0,350,379},
			bkimage="res/uires/garagedlg/garagedlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			moveable=1,
			updatemute=1,

			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.garagedlg","UI.gameui",aligntype_winrect,alignstyle_hcenter+alignstyle_vcenter);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.garagedlg",false);
				end;
			
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={296,21,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 274,21,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族仓库列表界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={198,346,86,24},
					bkimage="res/uires/newcommon/cancelsmallbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				buygaragebtn=
				{
					type="BUTTON",
					rect={63,346,86,24},
					bkimage="res/uires/garagedlg/buygaragebtn.gsa",
					
					OnClick=function()
						sel=Win_GetValue("UI.gameui.garagedlg.list",value_channel_sel);				
						FamStashNew(sel);
						Win_ShowWidget("UI.gameui.garagedlg",false);
						end;
				},

				list=
				{					

					type="LISTBOX",
					rect={45,58,241,280},														
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,	
					dragtype=ui_drag_type_garage,
					mousedelta=24,
					itemwidth=241,
					itemheight=49,
					itemmarginh=0,
					itemmarginv=0,		
					
					itemdrawback="res/uires/garagedlg/garageback.gsa",
					itemdrawpos={0,48,-1,0},
					itemselback="res/uires/garagedlg/garagesel.gsa",
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={240,18,20,243},			
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,

							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
				},--list
				
			},	
		};
		
		
		--炼化界面
		refinedlg=
		{
			type="DIALOG",
			rect={0,0,246,352},
			bkimage="res/uires/refinedlg/refinedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.refinedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_SetFocus("UI.gameui.waredlg.equiptab");
				
				Win_SetText("UI.gameui.refinedlg.goldlabel",0);
				Win_SetText("UI.gameui.refinedlg.silverlabel",0);
				Win_SetText("UI.gameui.refinedlg.copperlabel",0);
				
				SetGlobalQuery(GlobalQuery_RefineDlg,1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_RefineDlg,0);
				end;
				
			OnOk=function()
				--local bEnabled = Win_GetValue("UI.gameui.refinedlg.refinebtn",value_channel_framescheme);
				--if bEnabled~=0 then
				--UI.children.gameui.children.refinedlg.children.refinebtn.OnClick();
				--end;
				end;
				
			OnCancel=function()
				CancelRefineEquipment();
				Win_ShowWidget("UI.gameui.refinedlg",false);
				end;
			
			children=
			{
				mother=
				{
					type="WIDGET";
					rect={84,53,88,105};
					clientrect={0,0,88,105};
					dragtype=ui_drag_type_equipmaking,
					dragindex=0,
					aligntype=aligntype_winrect+aligntype_father;
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				father=
				{
					type="WIDGET";
					rect={81,206,36,36};
					clientrect={0,0,36,36};
					dragtype=ui_drag_type_equipmaking,
					dragindex=1,
					aligntype=aligntype_winrect+aligntype_father;
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				colorsoil=
				{
					type="WIDGET",
					rect={139,206,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_colorsoil,
					tiptext="这里显示的是你拥有的“五色土”数量。\n每次炼化，需要一块“五色土”。";
				};
				
				soilnum=
				{
					type="LABEL",
					rect={130,244,54,12},
					captionrect={0,0,54,12},
					textsize=12,
					textfont=0,
					textstyle=dt_center,
					richmode=ui_richmode_color,
				};
				

				goldlabel=
				{
					type="LABEL",
					rect={75,299,42,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={118,299,42,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={161,299,42,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},			

				clearbtn=
				{
					type="BUTTON",
					rect={17,324,70,22},
					bkimage="res/uires/evolvedlg/clearbtn.gsa",
					tiptext="重新选择炼化装备。";
					
					OnClick=function()
						ClearRefineEquiptment();
						end;
				};
				
				refinebtn=
				{
					type="BUTTON",
					rect={92,324,70,22},
					bkimage="res/uires/refinedlg/refinebtn.gsa",
					framescheme={{3,3,3,3},{0,1,2,3}},
					dragtype=ui_drag_type_refinebtn,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						local bEnabled = Win_GetValue("UI.gameui.refinedlg.refinebtn",value_channel_framescheme);
						if bEnabled ~= 0 then
							local slot=QueryRefineFatherSlot();
							if slot>0 then
								Win_ShowMsgBox("被炼化的材料装备上有槽,炼化后这些效果会消失.\n    您确定一定要执行炼化吗?","判断",ui_msgid_yesno,"UI.gameui.refinedlg.refinebtn");
							else
								RefineEquipment();
								--Win_ShowWidget("UI.gameui.refinedlg",false);
								end;
							end;
						end;
					
					OnMsgBoxOk=function()
						RefineEquipment();
						--Win_ShowWidget("UI.gameui.refinedlg",false);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={167,324,70,22},
					bkimage="res/uires/evolvedlg/cancelbtn.gsa",
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 201,5,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("装备炼化");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 221,5,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				};
			};
		};
		
		
		--炼化过程
		refineprocessdlg=
		{
			type="DIALOG",
			rect={0,0,240,326},
			bkimage="res/uires/refinedlg/processdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.refineprocessdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				SetGlobalQuery(GlobalQuery_RefineProcess,1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_RefineProcess,0);
				end;
			
			OnCancel=function()
				if Win_IsEnabled("UI.gameui.refineprocessdlg.closebtn") then
				Win_ShowWidget("UI.gameui.refineprocessdlg",false);
				end;
				end;
			
			children=
			{
				flash=
				{
					type="WIDGET",
					rect={53,53,128,128},
					clientrect={0,0,128,128},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_refineprocess,
				};

				equipment=
				{
					type="WIDGET",
					rect={58,197,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_refineequip,
				};
				
				equipmentname=
				{
					type="LABEL",
					rect={102,213,85,12},
					captionrect={0,0,85,12},
					textsize=12,
					textfont=0,
					textstyle=dt_center,
					drawcolor={255,255,255,255},
				};
				
				attr=
				{
					type="WIDGET",
					rect={34,242,173,60},
					clientrect={0,0,173,60},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_refineattribute,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 180,23,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("炼化过程");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 200,23,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				};
			};
		};
		
		
		--装备升级
		evolvedlg=
		{
			type="DIALOG",
			rect={0,0,264,266},
			bkimage="res/uires/evolvedlg/evolvedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.evolvedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_SetFocus("UI.gameui.waredlg.equiptab");
				
				Win_SetText("UI.gameui.evolvedlg.goldlabel",0);
				Win_SetText("UI.gameui.evolvedlg.silverlabel",0);
				Win_SetText("UI.gameui.evolvedlg.copperlabel",0);
				
				SetGlobalQuery(GlobalQuery_EvolveDlg,1);
				end;
				
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_EvolveDlg,0);
				end;
				
			OnOk=function()
				--local bEnabled = Win_GetValue("UI.gameui.evolvedlg.evolvebtn",value_channel_framescheme);
				--if bEnabled ~= 0 then
				--UI.children.gameui.children.evolvedlg.children.evolvebtn.OnClick();
				--end;
				end;
			
			OnCancel=function()
				CancelEvolveEquiptment();
				Win_ShowWidget("UI.gameui.evolvedlg",false);
				end;
			
			children=
			{
				equip=
				{
					type="WIDGET",
					rect={62,57,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_equipevolve,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				evolveequip=
				{
					type="WIDGET",
					rect={165,57,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_equipevolve,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				equipname=
				{
					type="LABEL",
					rect={36,101,86,12},
					captionrect={0,0,86,12},
					textstyle=dt_center;
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
				};
				
				evolveequipname=
				{
					type="LABEL",
					rect={140,101,86,12},
					captionrect={0,0,86,12},
					textstyle=dt_center;
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
				};
				
				starstone1=
				{
					type="WIDGET",
					rect={42,126,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_starstone,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				starstone2=
				{
					type="WIDGET",
					rect={113,126,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_starstone,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				starstone3=
				{
					type="WIDGET",
					rect={184,126,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_starstone,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				probability=
				{
					type="LABEL",
					rect={31,185,100,12},
					captionrect={45,0,55,12},
					textstyle=dt_center,
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
					tiptext="当你的装备进化时，你放置的七星石的\n品质，将会决定在进化过程中是否会出\n现接纳“宝石”的槽。\n七星品质越高，出现“槽”的概率越高。\n所有装备上最多只能出现三个槽。",
				},
				
				goldlabel=
				{
					type="LABEL",
					rect={84,211,48,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={138,211,48,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={192,211,48,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},			
				
				clearbtn=
				{
					type="BUTTON",
					rect={17,232,70,22},
					bkimage="res/uires/evolvedlg/clearbtn.gsa",
					tiptext="重新选择进化装备。",
					
					OnClick=function()
						ClearEvolveEquiptment();
						end;
				};
				
				evolvebtn=
				{
					type="BUTTON",
					rect={95,232,70,22},
					bkimage="res/uires/evolvedlg/evolvebtn.gsa",
					framescheme={{3,3,3,3},{0,1,2,3}},
					dragtype=ui_drag_type_evolvebtn,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						local bEnabled = Win_GetValue("UI.gameui.evolvedlg.evolvebtn",value_channel_framescheme);
						if bEnabled ~= 0 then
							EvolveEquiptment();
							--Win_ShowWidget("UI.gameui.evolvedlg",false);
							end;
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={174,232,70,22},
					bkimage="res/uires/evolvedlg/cancelbtn.gsa",
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 211,19,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("装备升级");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 230,19,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				};
			
			};
		};

		
		--装备添补
		replenishdlg=
		{
			type="DIALOG",
			rect={0,0,247,336},
			bkimage="res/uires/replenishdlg/replenishdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.replenishdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_SetFocus("UI.gameui.waredlg.equiptab");
				
				Win_SetText("UI.gameui.replenishdlg.goldlabel",0);
				Win_SetText("UI.gameui.replenishdlg.silverlabel",0);
				Win_SetText("UI.gameui.replenishdlg.copperlabel",0);
				
				for i=0,2 do
				Win_ShowWidget("UI.gameui.replenishdlg.itemwgt"..i,false);
				end;
				
				SetGlobalQuery(GlobalQuery_BesetDlgEquip,1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_BesetDlgEquip,0);
				end;
				
			OnOk=function()
				--UI.children.gameui.children.replenishdlg.children.affirmbtn.OnClick();
				end;
				
			OnCancel=function()
				if Win_IsChecked("UI.gameui.replenishdlg.beatawaybtn") then
				Win_SetCheck("UI.gameui.replenishdlg.beatawaybtn",false);
				else
				ReplenishItem(false);
				Win_ShowWidget("UI.gameui.replenishdlg",false);
				end;
				end;
			
			children=
			{
				equip=
				{
					type="WIDGET",
					rect={96,86,64,80},
					clientrect={0,0,64,80},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_beset_list,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				};
				
				equipname=
				{
					type="LABEL",
					rect={58,200,140,12},
					captionrect={0,0,140,12},
					textstyle=dt_center;
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
					updatemute=1,
				};
				
				itemwgt0=
				{
					type="WIDGET",
					rect={43,221,36,36},
					clientrect={0,0,36,36},
					bkimage="res/uires/composedlg/sculphole.gsa",
					bkimagepos={-2,-2},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_beset_items,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.replenishdlg.beatawaybtn") then
						Win_ShowMsgBox("你确定将这块宝石凿除下来吗？","系统消息",ui_msgid_yesno,"UI.gameui.replenishdlg.itemwgt0");
						--BeatAwayItem(0);
						end;
						end;
					
					OnMsgBoxOk=function()
						BeatAwayItem(0);
						end;
						
					PlayEffect=function()
						Win_SetText("UI.gameui.replenishdlg.itemwgt0","res/effect/beatawaylight.gsa",value_channel_effectpic);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt0",-42,value_channel_effectpicpos,0);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt0",-38,value_channel_effectpicpos,1);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt0",0.2,value_channel_timerspace);
						end;
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.replenishdlg.itemwgt0.effectwgt",true);
						end;
					
						
					children=
					{
						effectwgt=
						{
							type="WIDGET",
							rect={0,0,36,36},
							effectpic="res/effect/beatawaystar.gsa",
							effectpicpos={-65,-18},
							framespeed=0.1;
							style=wgtstyle_topmost,
							visible=0,
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt0.effectwgt",0,value_channel_effectframe);
								Win_SetText("UI.gameui.replenishdlg.itemwgt0","",value_channel_effectpic);
								Win_SetValue("UI.gameui.replenishdlg.itemwgt0.effectwgt",2.6,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt0.effectwgt",-1,value_channel_timerspace);
								Win_ShowWidget("UI.gameui.replenishdlg.itemwgt0.effectwgt",false);
								EndPlayBeatAwayEffect(0);
								end;
						},
					},
				},
				
				itemwgt1=
				{
					type="WIDGET",
					rect={110,221,36,36},
					clientrect={0,0,36,36},
					bkimage="res/uires/composedlg/sculphole.gsa",
					bkimagepos={-2,-2},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_beset_items,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.replenishdlg.beatawaybtn") then
						Win_ShowMsgBox("你确定将这块宝石凿除下来吗？","系统消息",ui_msgid_yesno,"UI.gameui.replenishdlg.itemwgt1");
						--BeatAwayItem(1);
						end;
						end;
					
					OnMsgBoxOk=function()
						BeatAwayItem(1);
						end;
						
					PlayEffect=function()
						Win_SetText("UI.gameui.replenishdlg.itemwgt1","res/effect/beatawaylight.gsa",value_channel_effectpic);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt1",-42,value_channel_effectpicpos,0);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt1",-38,value_channel_effectpicpos,1);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt1",0.2,value_channel_timerspace);
						end;
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.replenishdlg.itemwgt1.effectwgt",true);
						end;
					
						
					children=
					{
						effectwgt=
						{
							type="WIDGET",
							rect={0,0,36,36},
							effectpic="res/effect/beatawaystar.gsa",
							effectpicpos={-65,-18},
							framespeed=0.1;
							style=wgtstyle_topmost,
							visible=0,
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt1.effectwgt",0,value_channel_effectframe);
								Win_SetText("UI.gameui.replenishdlg.itemwgt1","",value_channel_effectpic);
								Win_SetValue("UI.gameui.replenishdlg.itemwgt1.effectwgt",2.6,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt1.effectwgt",-1,value_channel_timerspace);
								Win_ShowWidget("UI.gameui.replenishdlg.itemwgt1.effectwgt",false);
								EndPlayBeatAwayEffect(1);
								end;
						},
					},
				},
				
				itemwgt2=
				{
					type="WIDGET",
					rect={178,221,36,36},
					clientrect={0,0,36,36},
					bkimage="res/uires/composedlg/sculphole.gsa",
					bkimagepos={-2,-2},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_beset_items,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.replenishdlg.beatawaybtn") then
						Win_ShowMsgBox("你确定将这块宝石凿除下来吗？","系统消息",ui_msgid_yesno,"UI.gameui.replenishdlg.itemwgt2");
						--BeatAwayItem(2);
						end;
						end;
					
					OnMsgBoxOk=function()
						BeatAwayItem(2);
						end;
					
					PlayEffect=function()
						Win_SetText("UI.gameui.replenishdlg.itemwgt2","res/effect/beatawaylight.gsa",value_channel_effectpic);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt2",-42,value_channel_effectpicpos,0);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt2",-38,value_channel_effectpicpos,1);
						Win_SetValue("UI.gameui.replenishdlg.itemwgt2",0.2,value_channel_timerspace);
						end;
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.replenishdlg.itemwgt2.effectwgt",true);
						end;
					
						
					children=
					{
						effectwgt=
						{
							type="WIDGET",
							rect={0,0,36,36},
							effectpic="res/effect/beatawaystar.gsa",
							effectpicpos={-65,-18},
							framespeed=0.1;
							style=wgtstyle_topmost,
							visible=0,
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt2.effectwgt",0,value_channel_effectframe);
								Win_SetText("UI.gameui.replenishdlg.itemwgt2","",value_channel_effectpic);
								Win_SetValue("UI.gameui.replenishdlg.itemwgt2.effectwgt",2.6,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetValue("UI.gameui.replenishdlg.itemwgt2.effectwgt",-1,value_channel_timerspace);
								Win_ShowWidget("UI.gameui.replenishdlg.itemwgt2.effectwgt",false);
								EndPlayBeatAwayEffect(2);
								end;
						},
					},
				},
				
				goldlabel=
				{
					type="LABEL",
					rect={76,283,45,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,		
					updatemute=1,
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={120,283,45,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={164,283,45,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},			
				
				clearbtn=
				{
					type="BUTTON",
					rect={24,307,44,22},
					bkimage="res/uires/replenishdlg/clearbtn.gsa",
					tiptext="重新选择添补装备",
					updatemute=1,
					
					OnClick=function()
						ClearReplenishEquiptment();
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={78,307,44,22},
					bkimage="res/uires/replenishdlg/replenishbtn.gsa",
					framescheme={{3,3,3,3},{0,1,2,3}},
					dragtype=ui_drag_type_replenish,
					dragindex=0,
					defaultok=1;
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
					
					OnClick=function()
						local bEnabled = Win_GetValue("UI.gameui.replenishdlg.affirmbtn",value_channel_framescheme);
						if bEnabled ~= 0 then
							Win_ShowMsgBox("你确定将这块宝石镶嵌上去吗？","系统消息",ui_msgid_yesno,"UI.gameui.replenishdlg.affirmbtn");
							--ReplenishItem(true);
							end;
						end;
					
					OnMsgBoxOk=function()
						ReplenishItem(true);
						end;
				};
				
				beatawaybtn=
				{
					type="CHECK",
					rect={133,307,44,22},
					bkimage="res/uires/replenishdlg/beatawaybtn.gsa",
					framescheme={{0,0,1,1,2,2,3,3},{0,0,0,0,0,0,2,2}},
					updatemute=1,
					
					OnCheck=function(bcheck)
						Win_SetValue("UI.gameui.replenishdlg.beatawaybtn",bcheck~=0,value_channel_framescheme);
						ToggleBeatAway(bcheck~=0);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={188,307,44,22},
					bkimage="res/uires/replenishdlg/cancelbtn.gsa",
					defaultcancel=1,
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 203,6,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("装备添补");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 222,6,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					tiptext="Escape关闭",	
					defaultcancel=1,
					updatemute=1,
				};
			
			};
		};
		
		
		--武器升级
		equipflydlg=
		{
			type="DIALOG",
			rect={0,0,257,335},
			bkimage="res/uires/equipflydlg/equipflydlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.equipflydlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.waredlg",true);
				Win_SetFocus("UI.gameui.waredlg.equiptab");
				SetGlobalQuery(GlobalQuery_EquipFly,1);
				end;
				
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_EquipFly,0);
				end;
			
			OnCancel=function()
				CancelFlyEquip();
				Win_ShowWidget("UI.gameui.equipflydlg",false);
				end;
			
			children=
			{
				preequip=
				{
					type="WIDGET",
					rect={42,65,68,89},
					clientrect={0,0,68,89},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_preflyequip,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				flyequip=
				{
					type="WIDGET",
					rect={150,65,68,89},
					clientrect={0,0,68,89},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_preflyequip,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				preequipname=
				{
					type="LABEL",
					rect={36,174,86,12},
					captionrect={0,0,86,12},
					textstyle=dt_center;
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
				};
				
				flyequipname=
				{
					type="LABEL",
					rect={141,174,86,12},
					captionrect={0,0,86,12},
					textstyle=dt_center;
					textsize=12,
					textfont=0,
					drawcolor={255,255,255,255},
				};
				
				canflyequip0=
				{
					type="WIDGET",
					rect={42,224,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_canflyequip,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						SelectFlyEquip(0);
						end;
				},
				
				canflyequip1=
				{
					type="WIDGET",
					rect={113,224,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_canflyequip,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						SelectFlyEquip(1);
						end;
				},
				
				canflyequip2=
				{
					type="WIDGET",
					rect={184,224,36,36},
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_canflyequip,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						SelectFlyEquip(2);
						end;
				},
				
				clearbtn=
				{
					type="BUTTON",
					rect={18,301,70,22},
					bkimage="res/uires/evolvedlg/clearbtn.gsa",
					
					OnClick=function()
						ClearFlyEquip();
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={95,301,70,22},
					bkimage="res/uires/equipflydlg/equipflybtn.gsa",
					framescheme={{3,3,3,3},{0,1,2,3}},
					tiptext="令你的武器变成魂化后的装备。",
					
					OnClick=function()
						local bEnabled = Win_GetValue("UI.gameui.equipflydlg.affirmbtn",value_channel_framescheme);
						if bEnabled ~= 0 then
							Win_ShowMsgBox("是否确认武器魂化?魂化后原始武器将会永久消失,同时得到魂化后的武器.","系统消息",ui_msgid_yesno,"UI.gameui.equipflydlg.affirmbtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						FlyEquip();
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={173,301,70,22},
					bkimage="res/uires/evolvedlg/cancelbtn.gsa",
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 211,18,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("武器升级");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 231,18,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				};
			
			};
		};
		
		
		--合成
		composedlg=
		{
		
			type="DIALOG",
			rect={0,0,450,484},
			captionrect={132,44,177,12},
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			bkimage="res/uires/composedlg/composedlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			visible=0,
			moveable=1,
			
			OnOk=function()
				local bavailale = Win_GetValue("UI.gameui.composedlg",value_channel_customindex);
				if bavailale ~= 0 then
				ItemModConfirm(true,0);
				Win_SetValue("UI.gameui.composedlg",0,value_channel_customindex);
				Win_SetValue("UI.gameui.composedlg",0.2,value_channel_timerspace);
				end;
				end;
			
			OnTimer=function()
				Win_SetValue("UI.gameui.composedlg",1,value_channel_customindex);
				Win_SetValue("UI.gameui.composedlg",-1,value_channel_timerspace);
				end;
			
			OnCancel=function()
				ItemModConfirm(false);
				Win_ShowWidget("UI.gameui.composedlg",false);
				end;
				
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.composedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_EnableWidget("UI.gameui.composedlg.keepcomposebtn",false);
				Win_SetValue("UI.gameui.composedlg",1,value_channel_customindex);
				SetGlobalQuery(GlobalQuery_ItemModOpen,1);
				
				local modtype = Win_GetValue("UI.gameui.composedlg",value_channel_customtype);
				if modtype == 0 then
					RequestNewbieHelp(help_composedlg_hc);
				elseif modtype == 1 then
					RequestNewbieHelp(help_composedlg_jg);
				end;
				
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_ItemModOpen,0);
				
				local modtype = Win_GetValue("UI.gameui.composedlg",value_channel_customtype);
				if modtype == 0 then
					RequestNewbieHelp(help_composedlg_hc,0);
				elseif modtype == 1 then
					RequestNewbieHelp(help_composedlg_jg,0);
				end;
				
				end;
			
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_composedlg_hc,
						offsetx=150,
						offsety=-2,
					},
					
				};
			
				closebtn = 
				{
					type = "BUTTON",
					rect = { 340,40,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",	
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 318,40,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					--[[OnClick=function()
						local helpid=GetHelpID("合成界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;]]
					
					OnClick=function()
						local modtype = Win_GetValue("UI.gameui.composedlg",value_channel_customtype);
						if modtype == 0 then
							RequestNewbieHelp(help_composedlg_hc,-1);
						elseif modtype == 1 then
							RequestNewbieHelp(help_composedlg_jg,-1);
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={100,447,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					updatemute=1,
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={283,447,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,	
					soundid={1007},	
					updatemute=1,					
				};
			
				composebtn=
				{
					type="BUTTON",
					rect={100,447,90,22},
					bkimage="res/uires/composedlg/composebtn.gsa",
					defaultok=1,
					updatemute=1,
				};
				
				
				--免爆加工
				keepcomposebtn=
				{
					type="BUTTON",
					rect={191,447,90,22},
					bkimage="res/uires/composedlg/keepcomposebtn.gsa",
					updatemute=1,
					
					OnClick=function()
						ItemModConfirm(true,1);
						end;
				};
				
								
				goldedit=
				{
					type="LABEL",
					rect={163,422,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,		
					updatemute=1,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={200,422,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={236,422,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},
				
				
				list=
				{
					type="LISTBOX",
					rect={103,78,220,215},											
					
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					
					dragtype=ui_drag_type_syn_list,
					updatemute=1,
					
					itemwidth=220,
					itemheight=40,
					itemmarginh=0,
					itemmarginv=0,
					
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnValueChange=function(sel)
						if sel>=0 then
						local isKeepMod = ItemModSelect(sel+1);
						Win_EnableWidget("UI.gameui.composedlg.keepcomposebtn",(isKeepMod~=0));
						end;
						end;
					
		
					children=
					{	
						noticelabel=
						{
							type="LABEL",
							rect={12,14,198,48},
							textsize=12,
							rowspace=4,
							enable=0,					
						},
						
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={231,16,15,178},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
												
				},--list
				
				itemwgt0=
				{
						
					type="WIDGET",
					rect={118,331,36,36},
					dragindex=0,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",	
					updatemute=1,					
				};
				
				itemwgt1=
				{
						
					type="WIDGET",
					rect={161,331,36,36},
					dragindex=1,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt2=
				{
						
					type="WIDGET",
					rect={204,331,36,36},
					dragindex=2,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt3=
				{
						
					type="WIDGET",
					rect={247,331,36,36},
					dragindex=3,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt4=
				{
						
					type="WIDGET",
					rect={291,331,36,36},
					dragindex=4,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt5=
				{
						
					type="WIDGET",
					rect={118,372,36,36},
					dragindex=5,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt6=
				{
						
					type="WIDGET",
					rect={161,372,36,36},
					dragindex=6,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt7=
				{
						
					type="WIDGET",
					rect={204,372,36,36},
					dragindex=7,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt8=
				{
						
					type="WIDGET",
					rect={247,372,36,36},
					dragindex=8,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt9=
				{
						
					type="WIDGET",
					rect={291,372,36,36},
					dragindex=9,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};

			};
		};
		
		refinetypedlg=
		{
			type="DIALOG",
			rect={0,0,106,122},
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
						
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.refinetypedlg")  then											
				if Win_IsChecked("UI.gameui.queryrefinedlg.alltab.typebtn") then
				Win_SetCheck("UI.gameui.queryrefinedlg.alltab.typebtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()
				local tgt,num,option=GetComposeInfo(1, Win_GetText("UI.gameui.queryrefinedlg.alltab.typeedit"));
				
				Win_SetValue("UI.gameui.refinetypedlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.refinetypedlg.list",tgt[i],value_channel_itemtext,i-1);
				end;				
				
				Win_AlignWidget("UI.gameui.refinetypedlg","UI.gameui.queryrefinedlg.alltab.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				Win_SetFocus("UI.gameui.refinetypedlg.list");
				end;					  
				
						
			children=
			{
				list=
				{
					type="LISTBOX",
					rect={6,3,100,116},					
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					
					textsize=12,
					ysizeable=1,
																
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,

					OnClick=function()
						Win_ShowWidget("UI.gameui.refinetypedlg",false);
						local txt=Win_GetText("UI.gameui.refinetypedlg.list",value_channel_seltext);
						local option=Win_GetValue("UI.gameui.refinetypedlg.list",value_channel_sel);
												
						if txt~="" then										
						Win_SetText("UI.gameui.queryrefinedlg.alltab.typeedit",txt);
						SetComposeInfo(1,option);
						end;												
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
					
						};--scroll
					};
					
				},--list		
					
			};
		};
		
		
		refineleveldlg=
		{
			type="DIALOG",
			rect={0,0,106,122},
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.refineleveldlg")  then											
				if Win_IsChecked("UI.gameui.queryrefinedlg.alltab.levelbtn") then
				Win_SetCheck("UI.gameui.queryrefinedlg.alltab.levelbtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()
				local tgt,num,option=GetComposeInfo(2, Win_GetText("UI.gameui.queryrefinedlg.alltab.typeedit"));
				
				Win_SetValue("UI.gameui.refineleveldlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.refineleveldlg.list",tgt[i],value_channel_itemtext,i-1);
				end;				
				
				Win_AlignWidget("UI.gameui.refineleveldlg","UI.gameui.queryrefinedlg.alltab.levelbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				Win_SetFocus("UI.gameui.refineleveldlg.list");
				end;					  
				
						
			children=
			{
				list=
				{
					type="LISTBOX",
					rect={6,3,100,116},					
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					
					textsize=12,
					ysizeable=1,
																
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,
											
					OnClick=function()
						Win_ShowWidget("UI.gameui.refineleveldlg",false);
						local txt=Win_GetText("UI.gameui.refineleveldlg.list",value_channel_seltext);
						local option=Win_GetValue("UI.gameui.refineleveldlg.list",value_channel_sel);
												
						if txt~="" then										
						Win_SetText("UI.gameui.queryrefinedlg.alltab.leveledit",txt);
						SetComposeInfo(2,option);
						end;												
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
					
						};--scroll
					};
					
				},--list		
					
			};
		};
		
		
		refineclassdlg=
		{
			type="DIALOG",
			rect={0,0,106,122},
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.refineclassdlg")  then											
				if Win_IsChecked("UI.gameui.queryrefinedlg.alltab.classbtn") then
				Win_SetCheck("UI.gameui.queryrefinedlg.alltab.classbtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()
				local tgt,num,option=GetComposeInfo(3, Win_GetText("UI.gameui.queryrefinedlg.alltab.typeedit"));
				
				Win_SetValue("UI.gameui.refineclassdlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.refineclassdlg.list",tgt[i],value_channel_itemtext,i-1);
				end;				
				
				Win_AlignWidget("UI.gameui.refineclassdlg","UI.gameui.queryrefinedlg.alltab.classbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				Win_SetFocus("UI.gameui.refineclassdlg.list");
				end;					  
				
						
			children=
			{
				list=
				{
					type="LISTBOX",
					rect={6,3,100,116},					
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					
					textsize=12,
					ysizeable=1,
																
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,
											
					OnClick=function()
						Win_ShowWidget("UI.gameui.refineclassdlg",false);
						local txt=Win_GetText("UI.gameui.refineclassdlg.list",value_channel_seltext);
						local option=Win_GetValue("UI.gameui.refineclassdlg.list",value_channel_sel);
												
						if txt~="" then										
						Win_SetText("UI.gameui.queryrefinedlg.alltab.classedit",txt);
						SetComposeInfo(3,option);
						end;												
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
					
						};--scroll
					};
					
				},--list		
					
			};
		};
		
		
		
		composetypedlg=
		{
			type="DIALOG",
			rect={0,0,106,122},
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.composetypedlg")  then											
				if Win_IsChecked("UI.gameui.querycomposedlg.typebtn") then
				Win_SetCheck("UI.gameui.querycomposedlg.typebtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()
				local tgt,num,option=GetComposeInfo(0, Win_GetText("UI.gameui.queryrefinedlg.alltab.typeedit"));
				
				Win_SetValue("UI.gameui.composetypedlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.composetypedlg.list",tgt[i],value_channel_itemtext,i-1);
				end;			
				
				Win_AlignWidget("UI.gameui.composetypedlg","UI.gameui.querycomposedlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				Win_SetFocus("UI.gameui.composetypedlg.list");
				end;			  
				
						
			children=
			{
				list=
				{
					type="LISTBOX",
					rect={6,3,100,116},					
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					
					textsize=12,
					ysizeable=1,
																
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,
											
					OnClick=function()
						Win_ShowWidget("UI.gameui.composetypedlg",false);
						local txt=Win_GetText("UI.gameui.composetypedlg.list",value_channel_seltext);
						local option=Win_GetValue("UI.gameui.composetypedlg.list",value_channel_sel);
												
						if txt~="" then										
						Win_SetText("UI.gameui.querycomposedlg.typeedit",txt);
						SetComposeInfo(0,option);
						end;												
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
					
						};--scroll
					};
					
				},--list		
					
			};
		};
		
		
		querycomposedlg=
		{
		
			type="DIALOG",
			rect={0,0,262,322},
			captionrect={52,13,140,12},
			caption="合成查询",
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			bkimage="res/uires/composedlg/querycomposedlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			visible=0,
			moveable=1,
			
			OnOk=function()
				ItemModConfirm(true);
				end;			
			
			OnCancel=function()
				ItemModConfirm(false);
				Win_ShowWidget("UI.gameui.querycomposedlg",false);
				end;
				
			OnSelfShow=function()
				local tgt,num,option=GetComposeInfo(0);
				Win_SetText("UI.gameui.querycomposedlg.typeedit",tgt[option+1]);
				
				Win_AlignWidget("UI.gameui.querycomposedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
			children=
			{
			
				closebtn = 
				{
					type = "BUTTON",
					rect = { 237,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",		
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 215,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("合成界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				typeedit=
				{
					type="LABEL",	
					rect = { 80,51,64,12 },
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},																	
					updatemute=1,
				},
				
				
				typebtn = 
				{
					type = "CHECK",
					rect = { 144,49,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					updatemute=1,
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.querycomposedlg.typebtn")  then
						     Win_ShowWidget("UI.gameui.composetypedlg",true);
						     else 
						     Win_ShowWidget("UI.gameui.composetypedlg",false);
						     end;						     
						     end;						
				},	
				
				namebtn=
				{
					type="BUTTON",
					rect={30,74,132,12},
					caption="名称",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.querycomposedlg.namebtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.querycomposedlg.namebtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.querycomposedlg.namebtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
						
					OnClick=function()
						ItemModSort(0);
						end;
				};
				
				levelbtn=
				{
					type="BUTTON",
					rect={169,74,52,12},
					caption="等级",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.querycomposedlg.levelbtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.querycomposedlg.levelbtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.querycomposedlg.levelbtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;	

					OnClick=function()
						ItemModSort(1);
						end;	
				};
				
				
				list=
				{
					type="LISTBOX",
					rect={30,90,192,92},											
					
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					
					dragtype=ui_drag_type_syn_list,
					
					itemwidth=192,
					itemheight=16,
					itemmarginh=0,
					itemmarginv=0,
					
					textsize=12,
					itemdrawback="res/uires/family/detailitembk.gsa",
					itemdrawpos={0,16,-1,0},
					
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0,0,0,-1},				
										
					tipwidget="UI.gameui.ScrnTooltip",
					
					updatemute=1,
					
					OnValueChange=function(sel)
						if sel>=0 then
						ItemModSelect(sel+1);
						end;
						end;
					
		
					children=
					{	
						noticelabel=
						{
							type="LABEL",
							rect={0,14,192,48},
							textsize=12,
							rowspace=4,
							enable=0,					
						},
						
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={198,2,15,70},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
												
				},--list
				
				itemwgt0=
				{
						
					type="WIDGET",
					rect={31,203,36,36},
					dragindex=0,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt1=
				{
						
					type="WIDGET",
					rect={74,203,36,36},
					dragindex=1,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt2=
				{
						
					type="WIDGET",
					rect={117,203,36,36},
					dragindex=2,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt3=
				{
						
					type="WIDGET",
					rect={160,203,36,36},
					dragindex=3,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt4=
				{
						
					type="WIDGET",
					rect={203,203,36,36},
					dragindex=4,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt5=
				{
						
					type="WIDGET",
					rect={31,251,36,36},
					dragindex=5,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt6=
				{
						
					type="WIDGET",
					rect={74,251,36,36},
					dragindex=6,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt7=
				{
						
					type="WIDGET",
					rect={117,251,36,36},
					dragindex=7,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt8=
				{
						
					type="WIDGET",
					rect={160,251,36,36},
					dragindex=8,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt9=
				{
						
					type="WIDGET",
					rect={203,251,36,36},
					dragindex=9,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};				
			};
		};
		
		--镶嵌
		sculpdlg=
		{
			type="DIALOG",
			rect={0,0,474,521},
			captionrect={155,45,156,12},			
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			bkimage="res/uires/composedlg/sculpdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			visible=0,
			moveable=1,			
				
			OnOk=function()
				local bavailale = Win_GetValue("UI.gameui.sculpdlg",value_channel_customindex);
				if bavailale ~= 0 then
				Win_ShowMsgBox("你确定将这张卡片镶嵌上去吗？","系统消息",ui_msgid_yesno,"UI.gameui.sculpdlg");
				--ItemModConfirm(true);
				--Win_SetValue("UI.gameui.sculpdlg",0,value_channel_customindex);
				--Win_SetValue("UI.gameui.sculpdlg",0.2,value_channel_timerspace);
				end;
				end;
			
			OnMsgBoxOk=function()
				ItemModConfirm(true);
				Win_SetValue("UI.gameui.sculpdlg",0,value_channel_customindex);
				Win_SetValue("UI.gameui.sculpdlg",0.2,value_channel_timerspace);
				end;
			
			OnTimer=function()
				Win_SetValue("UI.gameui.sculpdlg",1,value_channel_customindex);
				Win_SetValue("UI.gameui.sculpdlg",-1,value_channel_timerspace);
				end;
				
			OnCancel=function()
				ItemModConfirm(false);
				Win_ShowWidget("UI.gameui.sculpdlg",false);
				end;			
				
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.sculpdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				for i=0,4 do
				Win_ShowWidget("UI.gameui.sculpdlg.itemwgt"..i,false);
				end;
				Win_SetValue("UI.gameui.sculpdlg",1,value_channel_customindex);
				
				RequestNewbieHelp(help_composedlg_xq);
				
				end;
				
			OnSelfHide=function()
				RequestNewbieHelp(help_composedlg_xq,0);
				end;
				
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_composedlg_xq,
						offsetx=-9,
						offsety=103,
					},
					
				};
			
				closebtn = 
				{
					type = "BUTTON",
					rect = { 338,40,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
					updatemute=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 318,40,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						RequestNewbieHelp(help_composedlg_xq,-1);
						--[[local helpid=GetHelpID("镶嵌界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);]]
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={284,447,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,	
					soundid={1007},					
					updatemute=1,
				};
			
			
				
				sculpbtn=
				{
					type="BUTTON",
					rect={116,447,90,22},
					bkimage="res/uires/composedlg/sculpbtn.gsa",	
					defaultok=1,
					updatemute=1,
				};
				
				goldedit=
				{
					type="LABEL",
					rect={170,428,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,		
					updatemute=1,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={207,428,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={243,428,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				},			
				
				
				labelsculp=
				{
					type="LABEL",
					rect={168,235,132,12},					
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					updatemute=1,
				};
				
				itemsculp=
				{
						
					type="WIDGET",
					rect={200,120,64,80},
					dragindex=0,
					dragtype=ui_drag_type_syn_list,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt0=
				{
						
					type="WIDGET",
					rect={125,251,40,40},
					bkimage="res/uires/composedlg/sculphole.gsa",
					dragindex=0,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt1=
				{
						
					type="WIDGET",
					rect={169,251,40,40},
					bkimage="res/uires/composedlg/sculphole.gsa",
					dragindex=1,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt2=
				{
						
					type="WIDGET",
					rect={209,251,40,40},
					bkimage="res/uires/composedlg/sculphole.gsa",
					dragindex=2,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt3=
				{
						
					type="WIDGET",
					rect={255,251,40,40},
					bkimage="res/uires/composedlg/sculphole.gsa",
					dragindex=3,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};
				
				itemwgt4=
				{
						
					type="WIDGET",
					rect={299,251,40,40},
					bkimage="res/uires/composedlg/sculphole.gsa",
					dragindex=4,
					dragtype=ui_drag_type_syn_items,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
					updatemute=1,
				};			
				
				infolist=
				{
					type="WIDGETLIST",
					rect={122,316,224,90},
															
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static,
					updatemute=1,
					
					primaryscroll="UI.gameui.sculpdlg.vscroll",
										
					children=
					{
						--说明
						infolabel=
						{
							
							type="LABEL",
							rect={0,0,224,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
						
						
					},-- children
					
				},
				
				
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={333,336,15,75},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.sculpdlg.infolist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",									
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
														
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll			
			};
			
		};
		
		--修理
		repairdlg=
		{
			type="DIALOG",
			rect={0,0,237,300},
			bkimage="res/uires/repairdlg/repairdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,			

			visible=0,
			moveable=1,
			updatemute=1,			
			
			OnOk=function()
				EndRepair();
				Win_ShowWidget("UI.gameui.repairdlg",false);				
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.repairdlg",false);
				CancelVipSpecRepair();
				end;		
				
			
			children=
			{
				title=
				{
					type="LABEL",
					rect={93,20,75,22},
					bkimage="res/uires/repairdlg/repairetype.gsa",
					enable=0,
					framescheme={{0},{1},{2}},
				},
			
				closebtn = 
				{
					type = "BUTTON",
					rect = { 210,21,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 188,21,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						--Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={152,265,73,28},
					bkimage="res/uires/repairdlg/cancelbtn.gsa",
					defaultcancel=1,	
					soundid={1007},					
				};
				
				repairbtn=
				{
					type="BUTTON",
					rect={37,265,73,28},
					bkimage="res/uires/repairdlg/repairbtn.gsa",	
					defaultok=1,
				};
				
				goldfee=
				{
					type="LABEL",
					rect={92,162,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,				
				},
				
				silverfee=
				{
					type="LABEL",
					rect={128,162,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperfee=
				{
					type="LABEL",
					rect={164,162,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				regoldfee=
				{
					type="LABEL",
					rect={92,187,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,				
				},
				
				resilverfee=
				{
					type="LABEL",
					rect={128,187,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				recopperfee=
				{
					type="LABEL",
					rect={164,187,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				goldedit=
				{
					type="LABEL",
					rect={92,219,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,				
				},
				
				silveredit=
				{
					type="LABEL",
					rect={128,219,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={164,219,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},			
				
				regoldedit=
				{
					type="LABEL",
					rect={92,244,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,				
				},
				
				resilveredit=
				{
					type="LABEL",
					rect={128,244,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				recopperedit=
				{
					type="LABEL",
					rect={164,244,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				labelrepair=
				{
					type="LABEL",
					rect={74,134,114,12},					
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
					visible=0;
				};
				
				itemrepair=
				{
						
					type="WIDGET",
					rect={113,98,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_idobj,			
					tipwidget="UI.gameui.ScrnTooltip",
					itemdragflag=-1,
				};
			};
			
		};
		
		reportdlg=
		{
				
			type="DIALOG",
			rect={0,0,269,379},			
			captionrect={54,10,142,12},
			textsize=12,
			textfont=1,
			bkimage="res/uires/taskdlg/reportdlg.gsa",			
			moveable=1,				
			style=wgtstyle_topmost+wgtstyle_alphawin,			
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.reportdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
			
			children=
			{
							
				closebtn=
				{
					type="BUTTON",
					rect={244,6,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 222,6,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("任务界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				reportlabel=
				{
					type="LABEL",
					rect={23,34,230,12},	
					textsize=12,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},	
					textstyle=dt_left,
					enable=0,					
				};
				
				--读邮件
				pageupbtn=
				{
					type="BUTTON",
					rect={20,354,70,22},
					bkimage="res/uires/common/pageup.gsa",
				},
				
				pagednbtn=
				{
					type="BUTTON",
					rect={190,354,70,22},
					bkimage="res/uires/common/pagedn.gsa",					
				},
				
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={22,61,234,290},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=512,		
					editable=0,
				};
				
				
				
			};
		
		};
		
		taskdlg=
		{
		
			type="DIALOG",
			rect={0,0,515,407},
			bkimage="res/uires/taskdlg/taskbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			visible=0,
			moveable=1,
			updatemute=1,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.taskdlg",false);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.taskdlg",false);
				end;
					
			OnSelfShow=function()
					PushNewbieTips(41);
					UI.children.gameui.OnTaskUpdate(1, 0);
					TaskRequireList();  
					Win_AlignWidget("UI.gameui.taskdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);		

					Win_SetCheck("UI.gameui.taskdlg.worldtab",false);
					Win_SetCheck("UI.gameui.taskdlg.storytab",false);
					Win_SetCheck("UI.gameui.taskdlg.recommendtab",false);
					Win_SetCheck("UI.gameui.taskdlg.indextab",false);
					Win_SetCheck("UI.gameui.taskdlg.doingtab",true);
					
					Win_SetValue("UI.gameui.taskdlg.recommendtab",0,value_channel_customtype);
					Win_SetValue("UI.gameui.taskdlg.indextab",0,value_channel_customtype);
					
					Win_SetValue("UI.gameui.taskdlg.indextab.tasktree",1,value_channel_update_dirty);
					Win_SetValue("UI.gameui.taskdlg.indextab.tasktree",-1,value_channel_treeid);
					Win_ExtendTreeCtrl("UI.gameui.taskdlg.indextab.tasktree",0);
					Win_SetValue("UI.gameui.taskdlg.indextab.tasktreelevel",1,value_channel_update_dirty);
					Win_SetValue("UI.gameui.taskdlg.indextab.tasktreelevel",-1,value_channel_treeid);
					Win_ExtendTreeCtrl("UI.gameui.taskdlg.indextab.tasktreelevel",0);
					
					UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep7");
						
					local sel = Win_GetSelect("UI.gameui.taskdlg",0);
					if sel == 3 then
						RequestNewbieHelp(help_task_recommend);
					elseif sel == 4 then
						RequestNewbieHelp(help_task_index);
					else
						RequestNewbieHelp(help_taskdlg);
					end;
					
					UI.children.gameui.children.taskdlg.OnUpdateSel();
					
					end;	
					
			OnSelfHide=function()
				
				local sel = Win_GetSelect("UI.gameui.taskdlg",0);
				if sel == 3 then
					RequestNewbieHelp(help_task_recommend,0);
				elseif sel == 4 then
					RequestNewbieHelp(help_task_index,0);
				else
					RequestNewbieHelp(help_taskdlg,0);
				end;
			end;
						
			-- 任务变化的时候，左边节点变化，没有更新右边
			OnUpdateSel=function()
				if Win_IsChecked("UI.gameui.taskdlg.doingtab") then
					local nsel = GetCurSelTask();
					Win_SetValue("UI.gameui.taskdlg.doingtab.tasklist",nsel, value_channel_sel);
					UI.children.gameui.children.taskdlg.children.doingtab.children.tasklist.OnValueChange();
				elseif Win_IsChecked("UI.gameui.taskdlg.worldtab") then
					UI.children.gameui.children.taskdlg.children.worldtab.children.tasklist.OnValueChange();
				elseif Win_IsChecked("UI.gameui.taskdlg.storytab") then
					local treesel=Win_GetValue("UI.gameui.taskdlg.storytab.tasktree",value_channel_sel);
					UI.children.gameui.children.taskdlg.children.storytab.children.tasktree.OnValueChange(treesel, -1);
				elseif Win_IsChecked("UI.gameui.taskdlg.recommendtab")  then
					local treesel=Win_GetValue("UI.gameui.taskdlg.recommendtab.tasktree",value_channel_sel);
					UI.children.gameui.children.taskdlg.children.recommendtab.children.tasktree.OnValueChange(treesel, -1);
				elseif Win_IsChecked("UI.gameui.taskdlg.indextab")  then
					local treesel=Win_GetValue("UI.gameui.taskdlg.indextab.tasktree",value_channel_sel);
					UI.children.gameui.children.taskdlg.children.indextab.children.tasktree.OnValueChange(treesel, -1);
				end;
			
			end;
						
			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 488,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 466,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local sel = Win_GetSelect("UI.gameui.taskdlg",0);
						if sel == 3 then
							RequestNewbieHelp(help_task_recommend,-1);
						elseif sel == 4 then
							RequestNewbieHelp(help_task_index,-1);
						else
							RequestNewbieHelp(help_taskdlg,-1);
						end;
					
						--[[
						local helpid=GetHelpID("任务界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = { 416,371,90,28 },
					bkimage="res/uires/taskdlg/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				},								
				doingtab=
				{
					type="TABWIN",
					rect={36,65,467,301},					
					tabrect={3,0,89,22},
					tabcover="res/uires/taskdlg/doingtab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_taskdlg);
							RequestNewbieHelp(help_task_recommend,0);
							RequestNewbieHelp(help_task_index,0);
						end;
						end;
									
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_taskdlg,
								offsetx=-108,
								offsety=272,
							},
							
						};
						
						openpathbtn=
						{
							type="BUTTON",
							rect={1,306,90,28},
							bkimage="res/uires/taskdlg/opencitypathbtn.gsa",		
							
							OnClick=function()
								local iSel = Win_GetValue("UI.gameui.taskdlg.doingtab.tasklist", value_channel_sel);
								DClickTaskList(iSel);
							end;
						};
						
						closepathbtn=
						{
							type="BUTTON",
							rect={99,306,90,28},
							bkimage="res/uires/taskdlg/closecitypathbtn.gsa",		
							
							OnClick=function()
								CloseCityPath();
							end;
						};
						
						stopbtn=
						{
							type="BUTTON",
							rect={197,306,90,28},
							bkimage="res/uires/taskdlg/stopbtn.gsa",	
							updatemute=1,
		
							OnClick=function()
								if Win_IsVisible("UI.gameui.npcdlg") then
								Win_ShowMsgBox("Npc对话状态不允许任务操作!","系统消息",ui_msgid_close);
								else
								Win_ShowMsgBox("您确定要终止该任务吗?","系统消息",ui_msgid_yesno,"UI.gameui.taskdlg.doingtab.stopbtn");
								end;
								end;
								    
							OnMsgBoxOk=function()
								if not Win_IsVisible("UI.gameui.npcdlg") then
								num=TaskGetNumber( 1 );
								if num>0 then
								sel=Win_GetValue("UI.gameui.taskdlg.doingtab.tasklist",value_channel_sel);	
								TaskCancel( sel );						    
								end;
								end;								
								end;					
								    
							
						};
						
						tasklist=
						{
						
							type="LISTBOX",
							rect={4,10,161,286},
							visible=1,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself,	
							extendstyle=listbox_style_itemheight_fix+listbox_style_enum_item+listbox_style_richtext,
							richmode=ui_richmode_all,
							dragtype=ui_drag_type_opentask,
							updatemute=1,
							
							itemheight=14,
							itemwidth=157,
							textsize=12,
							itemtextstyle=dt_left+dt_vcenter;
							
							--itemselback="res/uires/common/itemsel.gsa",	
							--itemselpos={0,0,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnDBClick=function(idx)
								DClickTaskList(idx);
							end;

							OnValueChange=function()
								local sel=Win_GetValue("UI.gameui.taskdlg.doingtab.tasklist",value_channel_sel);
								
								local num=TaskGetNumber(1);
								
								local bempty=1;
								if ((num>0)and(sel>-1)) then
									TaskActive(sel);
									local taskinfo=TaskGetInfo(1,sel);
									
									if taskinfo~=nil then
										bempty=0;
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.titlelabel",taskinfo.title);								
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.publishlabel",taskinfo.publisher);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.placelabel",taskinfo.place);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.descript",taskinfo.desc);
										Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.prizelabel",taskinfo.prize);
									
										if taskinfo.CountPerRound ~= 0 then
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.finishcountlabel",taskinfo.finishcount);
										else
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.finishcountlabel","");
										end;
									
										Win_SetValue("UI.gameui.taskdlg.doingtab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
										for i=0,taskinfo.nhint-1 do
											Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
										end;		
										Win_EnableWidget("UI.gameui.taskdlg.doingtab.stopbtn", true);										
									else
										Win_EnableWidget("UI.gameui.taskdlg.doingtab.stopbtn", false);
									end;								
								end;
									
								if bempty==1 then
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.titlelabel","");
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.publishlabel","");
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.placelabel","");
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.descript","");
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.prizelabel","");
									Win_SetText("UI.gameui.taskdlg.doingtab.infopanel.finishcountlabel","");
								
									Win_SetValue("UI.gameui.taskdlg.doingtab.infopanel.hintlist",0,value_channel_item_num);
								end;
								
								Win_AjustSelf("UI.gameui.taskdlg.doingtab.infopanel.hintlist");
								Win_SetValue("UI.gameui.taskdlg.doingtab.infopanel",1,value_channel_update_dirty);								
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
		
						infopanel=
						{
						
							type="WIDGETLIST",
							rect={201,10,243,286},
							style=wgtstyle_clipchild_client,
							updatemute=1,
							
							primaryscroll="UI.gameui.taskdlg.doingtab.vscroll",
		
							children=
							{
								titlelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=0,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								publishlabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=1,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								placelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=2,
									richmode=ui_richmode_all,
									rowspace=4,
								};								
								
								descript=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=3,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								hintlist=
								{
									type="LISTBOX",
									rect={0,0,240,0},																										
									visible=1,
									style=wgtstyle_vertical,	
									extendstyle=listbox_style_auto_comfort+listbox_style_richtext,
									richmode=ui_richmode_all,
									ysizeable=1,
									groupstop=4,
									rowspace=4,
									
									itemheight=14,
									itemwidth=247,
									textsize=12,
									itemtextstyle=dt_left+dt_vcenter;
									
								};
								
								sepratorlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=5,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								prizelabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=6,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								finishcountlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=7,
									richmode=ui_richmode_all,
									rowspace=4,
								};
							};			
						
						};			
			
			
					
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={440,26,20,251},	
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,		
							updatemute=1,
							
							buddywidget="UI.gameui.taskdlg.doingtab.infopanel",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
				
			
	
			
					
					};
				};
				
				worldtab=
				{
					type="TABWIN",
					rect={36,65,467,301},					
					--tabrect={95,0,89,22},
					tabrect={279,0,89,22},
					tabcover="res/uires/taskdlg/worldtab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					
					OnCheck=function(bchecked)
						if bchecked ~= 0 then
							RequestNewbieHelp(help_task_index,0);
							RequestNewbieHelp(help_taskdlg,0);
							RequestNewbieHelp(help_task_recommend,0);
						end;
						end;
					
					children=
					{
						findedit=
						{
							type="EDIT",
							rect={10,307,96,12},	
							textsize=12,
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							updatemute=1,
							visible=0;
						};
					
						findbtn=
						{
							type="BUTTON",
							rect={110,302,60,22},
							bkimage="res/uires/common/findbtn.gsa",	
							updatemute=1,
							visible=0,
							
							OnClick=function()
								  
								    txt=Win_GetText("UI.gameui.taskdlg.worldtab.findedit");
								    
								    if txt~="" then
								    sel=TaskFindByName(2,txt);
								    
								    if sel>=0 and sel<TaskGetNumber(2) then
								    Win_SetValue("UI.gameui.taskdlg.worldtab.tasklist",sel,value_channel_sel);
								    UI.children.gameui.children.taskdlg.children.worldtab.children.tasklist.OnValueChange();
								    end;
								    
								    end;
								    
								    end;
							
						};
						
						
						tasklist=
						{
						
							type="LISTBOX",
							rect={4,10,161,286},
							visible=1,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself,	
							extendstyle=listbox_style_itemheight_fix+listbox_style_enum_item+listbox_style_richtext,					
							richmode=ui_richmode_all,
							dragtype=ui_drag_type_worldtask,
							updatemute=1,
							
							itemheight=14,
							itemwidth=293,
							textsize=12,
							itemtextstyle=dt_left+dt_vcenter;
							
							itemselback="res/uires/common/itemsel.gsa",	
							itemselpos={0,0,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",

							OnValueChange=function()
								sel=Win_GetValue("UI.gameui.taskdlg.worldtab.tasklist",value_channel_sel);
								
								bempty=1;
								if (TaskGetNumber(2)>0) and (sel>-1)  then
								local taskinfo=TaskGetInfo( 2, sel );
								if taskinfo then
								bempty=0;
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.titlelabel",taskinfo.title);
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.publishlabel",taskinfo.publisher);
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.placelabel",taskinfo.place);
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.descript",taskinfo.desc);
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.prizelabel",taskinfo.prize);	
								if taskinfo.CountPerRound ~= 0 then
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.finishcountlabel",taskinfo.finishcount);
								else
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.finishcountlabel","");
								end;									
								end;
								end;
								
								if bempty==1 then
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.worldtab.infopanel.finishcountlabel","");
								end;
								
								Win_SetValue("UI.gameui.taskdlg.worldtab.infopanel",1,value_channel_update_dirty);
								
								--隐藏returnprepagebtn
								if Win_IsVisible("UI.gameui.taskdlg.indextab.returnprepagebtn") then
									Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", false);							
								end;
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};		
						
						infopanel=
						{
						
							type="WIDGETLIST",
							rect={201,10,243,286},
							style=wgtstyle_clipchild_window,
							updatemute=1,
							
							primaryscroll="UI.gameui.taskdlg.worldtab.vscroll",
		
							children=
							{
								titlelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=0,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								publishlabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=1,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								placelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=2,
									richmode=ui_richmode_all,
									rowspace=4,
								};								
								
								descript=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=3,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								sepratorlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=4,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								prizelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=5,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								finishcountlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=6,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								
																						
							};			
						
						};			
	
	
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={440,26,20,251},	
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,		
							updatemute=1,
							
							buddywidget="UI.gameui.taskdlg.worldtab.infopanel",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				storytab=
				{
					type="TABWIN",
					rect={36,65,467,301},					
					tabrect={187,0,89,22},
					tabcover="res/uires/taskdlg/taletab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					
					OnCheck=function(bcheck)
						if (bcheck~=0) then
							--RequestNewbieHelp(help_task_recommend);
							--RequestNewbieHelp(help_taskdlg, 0);
							--RequestNewbieHelp(help_task_index,0);
						
							local bchecked = Win_GetValue("UI.gameui.taskdlg.storytab",value_channel_customtype);
							if bchecked == 0 then
								Win_SetValue("UI.gameui.taskdlg.storytab.tasktree",1,value_channel_update_dirty);
								Win_SetValue("UI.gameui.taskdlg.storytab",1,value_channel_customtype);
								Win_SetValue("UI.gameui.taskdlg.storytab.tasktree",-1,value_channel_treeid);
								Win_ExtendTreeCtrl("UI.gameui.taskdlg.storytab.tasktree",1);
								Win_SetValue("UI.gameui.taskdlg.storytab.tasktree",-1,value_channel_sel);
								
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.storytab.infopanel.finishcountlabel","");
								Win_SetValue("UI.gameui.taskdlg.storytab.infopanel.hintlist",0,value_channel_item_num);
							end;
						end;
						
						end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_task_recommend,
								offsetx=-94,
								offsety=-15,
							},
							
						};
						
						tasktree=
						{
							type="TREECTRL",
							rect={4,10,161,286},
							style=wgtstyle_clipself,
							dragtype=ui_drag_type_storytask,
							mousedelta=30,
							soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnDBClick=function(idx)
								DClickTaskList(idx);
							end;

							OnValueChange=function(sel, oldsel)
								if sel ~= oldsel then								
									local num=TaskGetNumber(1);
									local bempty=1;
									if ((num>0)and(sel>-1)) then
									TaskActive(sel);
									local taskinfo=TaskGetInfo(3,sel);
									
									if taskinfo~=nil then
									bempty=0;
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.titlelabel",taskinfo.title);
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.publishlabel",taskinfo.publisher);
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.placelabel",taskinfo.place);
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.descript",taskinfo.desc);
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.prizelabel",taskinfo.prize);
									
									if taskinfo.CountPerRound ~= 0 then
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.finishcountlabel",taskinfo.finishcount);
									else
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.finishcountlabel","");
									end;
									
									Win_SetValue("UI.gameui.taskdlg.storytab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
									for i=0,taskinfo.nhint-1 do
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
									end;							
									end;								
									end;
									
									if bempty==1 then
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.titlelabel","");
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.publishlabel","");
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.placelabel","");
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.descript","");
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.prizelabel","");
									Win_SetText("UI.gameui.taskdlg.storytab.infopanel.finishcountlabel","");
								
									Win_SetValue("UI.gameui.taskdlg.storytab.infopanel.hintlist",0,value_channel_item_num);
									end;
									
									Win_AjustSelf("UI.gameui.taskdlg.storytab.infopanel.hintlist");
									Win_SetValue("UI.gameui.taskdlg.storytab.infopanel",1,value_channel_update_dirty);
									
									--隐藏returnprepagebtn
									if Win_IsVisible("UI.gameui.taskdlg.indextab.returnprepagebtn") then
										Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", false);							
									end;
								end;
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
		
						infopanel=
						{
						
							type="WIDGETLIST",
							rect={201,10,243,286},
							style=wgtstyle_clipchild_client,
							updatemute=1,
							
							primaryscroll="UI.gameui.taskdlg.storytab.vscroll",
		
							children=
							{
								titlelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=0,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								publishlabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=1,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								placelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=2,
									richmode=ui_richmode_all,
									rowspace=4,
								};								
								
								descript=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=3,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								hintlist=
								{
								
									type="LISTBOX",
									rect={0,0,240,0},																										
									visible=1,
									style=wgtstyle_vertical,	
									extendstyle=listbox_style_auto_comfort+listbox_style_richtext,
									richmode=ui_richmode_all,
									ysizeable=1,
									groupstop=4,
									rowspace=4,
									
									itemheight=14,
									itemwidth=247,
									textsize=12,
									itemtextstyle=dt_left+dt_vcenter;
									
								};
								
								sepratorlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=5,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								prizelabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=6,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								finishcountlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=7,
									richmode=ui_richmode_all,
									rowspace=4,
								};
							};			
						
						};			
			
			
					
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={440,26,20,251},	
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,		
							updatemute=1,
							
							buddywidget="UI.gameui.taskdlg.storytab.infopanel",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				
				recommendtab=
				{
					type="TABWIN",
					rect={36,65,467,301},					
					tabrect={95,0,89,22},
					--tabrect={279,0,89,22},
					tabcover="res/uires/taskdlg/recommendtab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					
					OnCheck=function(bcheck)
						if (bcheck~=0) then
							RequestNewbieHelp(help_task_recommend);
							RequestNewbieHelp(help_taskdlg, 0);
							RequestNewbieHelp(help_task_index,0);
						
							local bchecked = Win_GetValue("UI.gameui.taskdlg.recommendtab",value_channel_customtype);
							if bchecked == 0 then
								Win_SetValue("UI.gameui.taskdlg.recommendtab.tasktree",1,value_channel_update_dirty);
								Win_SetValue("UI.gameui.taskdlg.recommendtab",1,value_channel_customtype);
								Win_SetValue("UI.gameui.taskdlg.recommendtab.tasktree",-1,value_channel_treeid);
								Win_ExtendTreeCtrl("UI.gameui.taskdlg.recommendtab.tasktree",1);
								Win_SetValue("UI.gameui.taskdlg.recommendtab.tasktree",-1,value_channel_sel);
								
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.finishcountlabel","");
								Win_SetValue("UI.gameui.taskdlg.recommendtab.infopanel.hintlist",0,value_channel_item_num);
							end;
						end;
						
						end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_task_recommend,
								offsetx=-94,
								offsety=-15,
							},
							
						};
						
						tasktree=
						{
							type="TREECTRL",
							rect={4,10,161,286},
							style=wgtstyle_clipself,
							dragtype=ui_drag_type_recommendtask,
							mousedelta=30,
							soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnDBClick=function(idx)
								DClickTaskList(idx);
							end;

							OnValueChange=function(sel, oldsel)
								if sel ~= oldsel then								
									local num=TaskGetNumber(1);
									local bempty=1;
									if ((num>0)and(sel>-1)) then
									TaskActive(sel);
									local taskinfo=TaskGetInfo(4,sel);
									
									if taskinfo~=nil then
									bempty=0;
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.titlelabel",taskinfo.title);
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.publishlabel",taskinfo.publisher);
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.placelabel",taskinfo.place);
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.descript",taskinfo.desc);
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.prizelabel",taskinfo.prize);
									
									if taskinfo.CountPerRound ~= 0 then
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.finishcountlabel",taskinfo.finishcount);
									else
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.finishcountlabel","");
									end;
									
									Win_SetValue("UI.gameui.taskdlg.recommendtab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
									for i=0,taskinfo.nhint-1 do
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
									end;							
									end;								
									end;
									
									if bempty==1 then
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.titlelabel","");
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.publishlabel","");
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.placelabel","");
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.descript","");
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.prizelabel","");
									Win_SetText("UI.gameui.taskdlg.recommendtab.infopanel.finishcountlabel","");
								
									Win_SetValue("UI.gameui.taskdlg.recommendtab.infopanel.hintlist",0,value_channel_item_num);
									end;
									
									Win_AjustSelf("UI.gameui.taskdlg.recommendtab.infopanel.hintlist");
									Win_SetValue("UI.gameui.taskdlg.recommendtab.infopanel",1,value_channel_update_dirty);
									
									--隐藏returnprepagebtn
									if Win_IsVisible("UI.gameui.taskdlg.indextab.returnprepagebtn") then
										Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", false);							
									end;
								end;
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
		
						infopanel=
						{
						
							type="WIDGETLIST",
							rect={201,10,243,286},
							style=wgtstyle_clipchild_client,
							updatemute=1,
							
							primaryscroll="UI.gameui.taskdlg.recommendtab.vscroll",
		
							children=
							{
								titlelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=0,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								publishlabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=1,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								placelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=2,
									richmode=ui_richmode_all,
									rowspace=4,
								};								
								
								descript=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=3,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								hintlist=
								{
								
									type="LISTBOX",
									rect={0,0,240,0},																										
									visible=1,
									style=wgtstyle_vertical,	
									extendstyle=listbox_style_auto_comfort+listbox_style_richtext,
									richmode=ui_richmode_all,
									ysizeable=1,
									groupstop=4,
									rowspace=4,
									
									itemheight=14,
									itemwidth=247,
									textsize=12,
									itemtextstyle=dt_left+dt_vcenter;
									
								};
								
								sepratorlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=5,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								prizelabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=6,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								finishcountlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=7,
									richmode=ui_richmode_all,
									rowspace=4,
								};
							};			
						
						};			
			
			
					
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={440,26,20,251},	
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,		
							updatemute=1,
							
							buddywidget="UI.gameui.taskdlg.recommendtab.infopanel",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				
				indextab=
				{
					type="TABWIN",
					rect={36,65,467,301},					
					tabrect={371,0,89,22},
					tabcover="res/uires/taskdlg/indextab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					
					OnCheck=function(bcheck)
						if (bcheck~=0) then
							RequestNewbieHelp(help_task_index);
							RequestNewbieHelp(help_taskdlg,0);
							RequestNewbieHelp(help_task_recommend,0);
					
							local bchecked = Win_GetValue("UI.gameui.taskdlg.indextab",value_channel_customtype);
							if bchecked == 0 then
								SortIndexTask(0);
								Win_SetValue("UI.gameui.taskdlg.indextab",1,value_channel_customtype);
								
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel","");
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel.hintlist",0,value_channel_item_num);
								
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktree", true);
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktreelevel", false);
							end;
						end;
					end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_task_index,
								offsetx=-111,
								offsety=-24,
							},
						};
						
						sortbylevelbtn=
						{
							type="BUTTON",
							rect={-6,305,92,29},
							bkimage="res/uires/taskdlg/sortbylevelbtn.gsa",		

							OnClick=function()
								SetTaskIndexType(5);
								local sel = Win_GetValue("UI.gameui.taskdlg.indextab.tasktreelevel", value_channel_sel);
								Win_SetValue("UI.gameui.taskdlg.indextab.tasktreelevel", sel, value_channel_sel);
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktree", false);
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktreelevel", true);
							end;
						};
						
						sortbymapbtn=
						{
							type="BUTTON",
							rect={95,305,92,29},
							bkimage="res/uires/taskdlg/sortbymapbtn.gsa",		

							OnClick=function()
								SetTaskIndexType(4);
								local sel = Win_GetValue("UI.gameui.taskdlg.indextab.tasktree", value_channel_sel);
								Win_SetValue("UI.gameui.taskdlg.indextab.tasktree", sel, value_channel_sel);
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktreelevel", false);
								Win_ShowWidget("UI.gameui.taskdlg.indextab.tasktree", true);
							end;
						};

						topcheck=
						{
							type="CHECK";
							rect={196,312,118,18};
							bkimage="res/uires/newcommon/checkbox.gsa";
							bkimagepos={0,-2};
							caption="将已完成任务置顶";
							textsize=12,
							textstyle=dt_left;
							captionrect={20, 2, 100, 18};
							bkcolor={0,0,0,0},
							drawcolor={229,183,83,255},
							checked=0,
							
							OnCheck=function(bcheck)
								local oldselmap, oldtaskmap, tasktreemap, tasktypemap;
								local oldsellevel, oldtasklevel, tasktreelevel, tasktypelevel;
								oldselmap = Win_GetValue("UI.gameui.taskdlg.indextab.tasktree",value_channel_sel);
								oldtaskmap = TaskGetInfo(5, oldsel);
								tasktreemap = "UI.gameui.taskdlg.indextab.tasktree";
								tasktypemap = 5;
								oldsellevel = Win_GetValue("UI.gameui.taskdlg.indextab.tasktreelevel",value_channel_sel);
								oldtasklevel = TaskGetInfo(6, oldsel);
								tasktreelevel = "UI.gameui.taskdlg.indextab.tasktreelevel";
								tasktypelevel = 6;
								
								if bcheck~=0 then
									SortIndexTask(1);
								else
									SortIndexTask(0);
								end;
								
								Win_RequeryChildNodes(tasktreemap);
								Win_RequeryChildNodes(tasktreelevel);
								if oldtaskmap ~= nil then
									local nodeid = TaskNodeGetInfo(tasktypemap, oldtaskmap.id);
									Win_SetValue(tasktreemap, nodeid,value_channel_sel);
								end;
								if oldtasklevel ~= nil then
									local nodeid = TaskNodeGetInfo(tasktypelevel, oldtasklevel.id);
									Win_SetValue(tasktreelevel, nodeid,value_channel_sel);
								end;
							end;
						};	
						
						tasktree=
						{
							type="TREECTRL",
							rect={4,10,161,286},
							style=wgtstyle_clipself,
							dragtype=ui_drag_type_indextask,
							mousedelta=30,
							soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnDBClick=function(idx)
								DClickTaskList(idx);
							end;

							OnValueChange=function(sel, oldsel)
								local num=TaskGetNumber(1);
								local bempty=1;
								if ((num>0)and(sel>-1)) then
								TaskActive(sel);
								local taskinfo=TaskGetInfo(5,sel);
								
								if taskinfo~=nil then
								bempty=0;
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.titlelabel",taskinfo.title);								
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.publishlabel",taskinfo.publisher);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.placelabel",taskinfo.place);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.descript",taskinfo.desc);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.prizelabel",taskinfo.prize);
								
								if taskinfo.CountPerRound ~= 0 then
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel",taskinfo.finishcount);
								else
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel","");
								end;
								
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
								for i=0,taskinfo.nhint-1 do
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
								end;							
								end;								
								end;
								
								if bempty==1 then
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel","");
							
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel.hintlist",0,value_channel_item_num);
								end;
								
								Win_AjustSelf("UI.gameui.taskdlg.indextab.infopanel.hintlist");
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel",1,value_channel_update_dirty);
									
								--隐藏returnprepagebtn
								if sel ~= oldsel then
									local state = Win_GetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", value_channel_customstate);
									if state == 1 then
										Win_SetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", 0, value_channel_customstate);
									elseif Win_IsVisible("UI.gameui.taskdlg.indextab.returnprepagebtn") then
										Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", false);
									end;								
								end;
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
		
						tasktreelevel=
						{
							type="TREECTRL",
							rect={4,10,161,286},
							style=wgtstyle_clipself,
							dragtype=ui_drag_type_indextasklevel,
							mousedelta=30,
							soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
							visible=0,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnDBClick=function(idx)
								DClickTaskList(idx);
							end;

							OnValueChange=function(sel, oldsel)
								local num=TaskGetNumber(1);
								local bempty=1;
								if ((num>0)and(sel>-1)) then
								TaskActive(sel);
								local taskinfo=TaskGetInfo(6,sel);
								
								if taskinfo~=nil then
								bempty=0;
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.titlelabel",taskinfo.title);								
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.publishlabel",taskinfo.publisher);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.placelabel",taskinfo.place);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.descript",taskinfo.desc);
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.prizelabel",taskinfo.prize);
								
								if taskinfo.CountPerRound ~= 0 then
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel",taskinfo.finishcount);
								else
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel","");
								end;
								
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel.hintlist",taskinfo.nhint,value_channel_item_num);
								for i=0,taskinfo.nhint-1 do
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.hintlist",taskinfo.hints[i],value_channel_itemtext,i);											
								end;							
								end;								
								end;
								
								if bempty==1 then
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.titlelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.publishlabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.placelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.descript","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.prizelabel","");
								Win_SetText("UI.gameui.taskdlg.indextab.infopanel.finishcountlabel","");
							
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel.hintlist",0,value_channel_item_num);
								end;
								
								Win_AjustSelf("UI.gameui.taskdlg.indextab.infopanel.hintlist");
								Win_SetValue("UI.gameui.taskdlg.indextab.infopanel",1,value_channel_update_dirty);
								--隐藏returnprepagebtn
								if sel ~= oldsel then	
									local state = Win_GetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", value_channel_customstate);
									if state == 1 then
										Win_SetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", 0, value_channel_customstate);
									elseif Win_IsVisible("UI.gameui.taskdlg.indextab.returnprepagebtn") then
										Win_ShowWidget("UI.gameui.taskdlg.indextab.returnprepagebtn", false);
									end;								
								end;
							end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={161,16,20,251},					
									style=wgtstyle_vertical,					
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
														
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
						
						infopanel=
						{
						
							type="WIDGETLIST",
							rect={201,10,243,268},
							style=wgtstyle_clipchild_client,
							updatemute=1,
							
							primaryscroll="UI.gameui.taskdlg.indextab.vscroll",
		
							children=
							{
								titlelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=0,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								publishlabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=1,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								placelabel=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=2,
									richmode=ui_richmode_all,
									rowspace=4,
								};								
								
								descript=
								{
									type="LABEL",
									rect={0,0,240,12},									
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=3,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								hintlist=
								{
								
									type="LISTBOX",
									rect={0,0,240,0},																										
									visible=1,
									style=wgtstyle_vertical,	
									extendstyle=listbox_style_auto_comfort+listbox_style_richtext,
									richmode=ui_richmode_all,
									ysizeable=1,
									groupstop=4,
									rowspace=4,
									
									itemheight=14,
									itemwidth=247,
									textsize=12,
									itemtextstyle=dt_left+dt_vcenter;
									
								};
								
								sepratorlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=5,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								prizelabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=6,
									richmode=ui_richmode_all,
									rowspace=4,
								};
								
								finishcountlabel=
								{
									type="LABEL",
									rect={0,0,240,12},								
									textstyle=dt_left+dt_vcenter,
									textsize=12,
									ysizeable=1,
									groupstop=7,
									richmode=ui_richmode_all,
									rowspace=4,
								};
							};			
						
						};			
			
						returnprepagebtn =
						{
							type = "BUTTON",
							rect = {371,277,69,18},
							bkimage="res/uires/helpwin/returnmenubtn.gsa",
							OnClick=function()
								local preselindex = Win_GetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", value_channel_customindex);
								local preselid = Win_GetValue("UI.gameui.taskdlg.indextab.returnprepagebtn", value_channel_customid);
								if preselindex == 0 then
									Win_SelectSelf("UI.gameui.taskdlg.doingtab");
									Win_SetValue("UI.gameui.taskdlg.doingtab.tasklist", preselid, value_channel_sel);
								elseif preselindex == 1 then
									Win_SelectSelf("UI.gameui.taskdlg.worldtab");
									Win_SetValue("UI.gameui.taskdlg.worldtab.tasklist", preselid, value_channel_sel);
								elseif preselindex == 2 then
									Win_SelectSelf("UI.gameui.taskdlg.storytab");
									Win_SetValue("UI.gameui.taskdlg.storytab.tasktree", preselid, value_channel_sel);
								elseif preselindex == 3 then
									Win_SelectSelf("UI.gameui.taskdlg.recommendtab");
									Win_SetValue("UI.gameui.taskdlg.recommendtab.tasktree", preselid, value_channel_sel);
								elseif preselindex == 4 then
									Win_SelectSelf("UI.gameui.taskdlg.indextab");
									if Win_IsVisible("UI.gameui.taskdlg.indextab.tasktree") then
										Win_SetValue("UI.gameui.taskdlg.indextab.tasktree", preselid, value_channel_sel);
									else
										Win_SetValue("UI.gameui.taskdlg.indextab.tasktreelevel", preselid, value_channel_sel);
									end;
								end;
							end;
						};
					
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={440,26,20,251},	
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,		
							updatemute=1,
							
							buddywidget="UI.gameui.taskdlg.indextab.infopanel",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
			};
				
		};
	
		--caption="输入仓库密码",
		passwdinputdlg=
		{
			type="DIALOG",
			rect={0,0,228,130},
			moveable=1,
			visible=0,
			style=wgtstyle_topmost+wgtstyle_customclose,
			bkimage="res/uires/garagedlg/passwdinput.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			updatemute=1,
						
			OnSelfShow=function()	
				Win_SetText("UI.gameui.passwdinputdlg.pwdedit","");
				Win_SetFocus("UI.gameui.passwdinputdlg.pwdedit");
				end;
					   
					   
			OnOk=function()	
				okpwd=Win_GetText("UI.gameui.passwdinputdlg.pwdedit");
				okpwdsize=Win_GetValue("UI.gameui.passwdinputdlg.pwdedit",value_channel_captionsize);
				if okpwd=="" then
				Win_ShowMsgBox("请您输入仓库密码!");
				elseif okpwdsize<6 or okpwdsize>8  then
				Win_ShowMsgBox("请您输入6到8位仓库密码!");
				else 				
				InputGaragePwd("UI.gameui.passwdinputdlg.pwdedit");
				Win_ShowWidget("UI.gameui.passwdinputdlg",false);
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.passwdinputdlg",false);
			     CancelInputGaragePwd();
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.passwdinputdlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.passwdinputdlg",false);				     
			     end;
			     
			OnSelfHide=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdinputdlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdinputdlg");
				end;
			     
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={200,6,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 178,6,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("设置密码");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={26,98,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={135,98,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				pwdedit=
				{
					type="EDIT",
					rect={23,68,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdinputdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
			},
			
		};
		
		--caption="修改仓库密码",
		passwdmoddlg=
		{
			type="DIALOG",
			rect={0,0,203,219},
			moveable=1,
			visible=0,
			style=wgtstyle_topmost+wgtstyle_customclose,
			bkimage="res/uires/garagedlg/passwdmod.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			updatemute=1,
						
			OnSelfShow=function()	
				Win_SetText("UI.gameui.passwdmoddlg.oldpwdedit","");
				Win_SetText("UI.gameui.passwdmoddlg.newpwdedit","");
				Win_SetText("UI.gameui.passwdmoddlg.okpwdedit","");
				Win_SetFocus("UI.gameui.passwdmoddlg.oldpwdedit");
				end;
					   
					   
			OnOk=function()	
				oldpwd=Win_GetText("UI.gameui.passwdmoddlg.oldpwdedit");
				newpwd=Win_GetText("UI.gameui.passwdmoddlg.newpwdedit");
				okpwd=Win_GetText("UI.gameui.passwdmoddlg.okpwdedit");
				
				newpwdsize=Win_GetValue("UI.gameui.passwdmoddlg.newpwdedit",value_channel_captionsize);
				okpwdsize=Win_GetValue("UI.gameui.passwdmoddlg.okpwdedit",value_channel_captionsize);
				  
				if oldpwd=="" then
				Win_ShowMsgBox("请您输入仓库旧的密码!");
				elseif newpwd=="" then
				Win_ShowMsgBox("请您输入仓库新的密码!");
				elseif okpwd=="" then
				Win_ShowMsgBox("请您确认仓库新的密码!");
				elseif newpwdsize~=okpwdsize then
				Win_ShowMsgBox("两次输入的密码长度不等!");
				elseif newpwdsize<6 or newpwdsize>8 then
				Win_ShowMsgBox("请输入6到8位新密码!");
				elseif okpwdsize<6 or okpwdsize>8 then
				Win_ShowMsgBox("请输入6到8位新确认密码!");
				else						  
				bResult=ModifyGaragePwd("UI.gameui.passwdmoddlg.oldpwdedit","UI.gameui.passwdmoddlg.newpwdedit","UI.gameui.passwdmoddlg.okpwdedit");
				if bResult then
				Win_ShowWidget("UI.gameui.passwdmoddlg",false);
				end;
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.passwdmoddlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.passwdmoddlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.passwdmoddlg",false);				     
			     end;
			     
			OnSelfHide=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdmoddlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdmoddlg");
				end;
			     
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={174,7,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 152,7,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("重设密码界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={19,186,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={114,186,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				oldpwdedit=
				{
					type="EDIT",
					rect={22,64,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,	

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdmoddlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				newpwdedit=
				{
					type="EDIT",
					rect={22,111,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,	

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdmoddlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				okpwdedit=
				{
					type="EDIT",
					rect={22,157,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,	

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdmoddlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},		
				
			},
			
		};
		
		--caption="设置仓库密码",
		passwdsetdlg=
		{
			type="DIALOG",
			rect={0,0,228,176},
			moveable=1,
			visible=0,
			style=wgtstyle_topmost+wgtstyle_customclose,
			bkimage="res/uires/garagedlg/passwdset.gsa",
			updatemute=1,
						
			OnSelfShow=function()	
				Win_AlignWidget("UI.gameui.passwdsetdlg","UI.gameui",aligntype_winrect,alignstyle_hcenter+alignstyle_vcenter);		
				Win_SetText("UI.gameui.passwdsetdlg.newpwdedit","");
				Win_SetText("UI.gameui.passwdsetdlg.okpwdedit","");
				Win_SetFocus("UI.gameui.passwdsetdlg.newpwdedit");
				end;
					   
					   
			OnOk=function()	
				newpwd=Win_GetText("UI.gameui.passwdsetdlg.newpwdedit");
				okpwd=Win_GetText("UI.gameui.passwdsetdlg.okpwdedit");
				 
				newpwdsize=Win_GetValue("UI.gameui.passwdsetdlg.newpwdedit",value_channel_captionsize);
				okpwdsize=Win_GetValue("UI.gameui.passwdsetdlg.okpwdedit",value_channel_captionsize);
				
				if newpwd=="" then
				Win_ShowMsgBox("请您输入仓库新的密码!");
				elseif okpwd=="" then
				Win_ShowMsgBox("请您确认仓库新的密码!");
				elseif newpwdsize~=okpwdsize then
				Win_ShowMsgBox("两次输入的密码长度不等!");
				elseif newpwdsize<6 or newpwdsize>8 then
				Win_ShowMsgBox("请输入6到8位新密码!");
				elseif okpwdsize<6 or okpwdsize>8 then
				Win_ShowMsgBox("请输入6到8位新确认密码!");
				else					  
				bResult=SetGaragePwd("UI.gameui.passwdsetdlg.newpwdedit","UI.gameui.passwdsetdlg.okpwdedit");
				if bResult then
				Win_ShowWidget("UI.gameui.passwdsetdlg",false);
				end;
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.passwdsetdlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.passwdsetdlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.passwdsetdlg",false);				     
			     end;
			
			OnSelfHide=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdsetdlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("passwdsetdlg");
				end;
			     
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={199,6,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 177,6,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("设置密码");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={22,142,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={136,142,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				newpwdedit=
				{
					type="EDIT",
					rect={23,67,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,		

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdsetdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				okpwdedit=
				{
					type="EDIT",
					rect={23,112,168,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol+ui_editmethod_coder,
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=8,	

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 8 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"passwdsetdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},		
				
			},
			
		};
		
		
		teamconfigdlg=
		{
			type="DIALOG",
			rect={0,0,255,212},
			captionrect={55,9,147,12},
			caption="组队设置",
			textsize=12,
			textfont=1,
			moveable=1,
			visible=0,
			style=wgtstyle_topmost+wgtstyle_customclose,
			bkimage="res/uires/teamdlg/teamconfigdlg.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			updatemute=1,
			
			OnSelfShow=function()	
				local defteamname=(g_PlayerInfo.name).."的小队";
				Win_SetText("UI.gameui.teamconfigdlg.nameedit",defteamname);
				Win_SetFocus("UI.gameui.teamconfigdlg.nameedit");
				RequestNewbieHelp(help_teamconfigdlg);
				end;
					   
					   
			OnOk=function()	
				name=Win_GetText("UI.gameui.teamconfigdlg.nameedit");
				  
				if name=="" then
				Win_ShowMsgBox("请您输入队伍名称!");
				else
				
				
				partner=Win_GetText("UI.gameui.teamconfigdlg.neighboredit");
				msg="";				  				  
				  
				TeamCreate(name,partner,msg); 
				Win_ShowWidget("UI.gameui.teamconfigdlg",false);
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.teamconfigdlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.teamconfigdlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.teamconfigdlg",false);				     
			     end;
			     
			OnSelfHide=function()
				RequestNewbieHelp(help_teamconfigdlg,0);
				end;
			     
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_teamconfigdlg,
						offsetx=-80,
						offsety=10,
					},
					
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={230,6,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 209,6,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_teamconfigdlg,-1);
						--[[
						local helpid=GetHelpID("组队");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={38,185,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={155,185,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				nameedit=
				{
					type="EDIT",
					rect={23,53,216,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=30,										
				},

				
				neighboredit=
				{
					type="MULTIEDIT",
					rect={76,78,140,90},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=500,						
					editable=0,				

					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={144,10,15,66},
							style=wgtstyle_vertical,												
							pagesize=1,
							marginh=0,
							marginv=0,	
							visible=1,	
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,18,16},
									bkimage="res/uires/common/smallupbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,18,16},
									bkimage="res/uires/common/smalldnbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};

					
				};
				
				neighborbtn=
				{
					type="CHECK",
					rect={21,93,44,22},
					bkimage="res/uires/common/addbtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{1,1,0,0,1,1,2,2},{0,0,1,1,0,0,2,2}},
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.teamconfigdlg.neighborbtn")  then
						     Win_SetText("UI.gameui.neighbordlg","UI.gameui.teamconfigdlg",value_channel_customname);
						     Win_AlignWidget("UI.gameui.neighbordlg","UI.gameui.teamconfigdlg.neighborbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						     Win_ShowWidget("UI.gameui.neighbordlg",true);
						     Win_SetFocus("UI.gameui.neighbordlg");						     
						     end;						     
						     end;
				},				
				
				
			},
			
		};

		updateteamcfgdlg=
		{
			type="DIALOG";
			bkimage="res/uires/teamdlg/updateteamcfgdlg.gsa";
			rect={0,0,250,189};
			style=wgtstyle_topmost+wgtstyle_customclose,
			moveable=1,
			visible=0,
			
			OnOk=function()
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.publishcheck")) then
					local idx = Win_GetValue("UI.gameui.updateteamcfgdlg.publishtargetbtn",value_channel_customindex);
					TeamPlat_ChangeTarget(idx);
				end;
				UI.children.gameui.children.updateteamcfgdlg.OnSetTeamConfig();
				UpdateTeamSetting();
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.updateteamcfgdlg",false);
				end;
				
			OnEscape=function()
				Win_ShowWidget("UI.gameui.updateteamcfgdlg",false);
				end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.updateteamcfgdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				local baccept, bjob, bfml, gender, pnames = GetTeamSetting();
				Win_SetCheck("UI.gameui.updateteamcfgdlg.accepleadercheck", baccept~=0);
				Win_SetCheck("UI.gameui.updateteamcfgdlg.jobcheck", bjob~=0);
				Win_SetCheck("UI.gameui.updateteamcfgdlg.familycheck", bfml~=0);
				Win_SetCheck("UI.gameui.updateteamcfgdlg.gendercheck", gender~=0);
				Win_SetCheck("UI.gameui.updateteamcfgdlg.boyradio", gender==2);
				Win_SetCheck("UI.gameui.updateteamcfgdlg.girlradio", gender==1 or gender==0);
				
				if (pnames == "") then
					Win_SetText("UI.gameui.updateteamcfgdlg.jobrequireedit","请选择职业");
				else
					Win_SetText("UI.gameui.updateteamcfgdlg.jobrequireedit", pnames);
				end;
				
				end;
				
			OnSetTeamConfig=function()
				local baccept = 0;
				local bjob = 0;
				local bonefml = 0;
				local bgender = 0;
				local bboy = 0;
				local bgirl = 0;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.accepleadercheck")) then baccept = 1; end;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.jobcheck")) then bjob = 1; end;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.familycheck")) then bonefml = 1; end;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.gendercheck")) then bgender = 1; end;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.boyradio")) then bboy = 1; end;
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.girlradio")) then bgirl = 1; end;
				local pjobs = Win_GetText("UI.gameui.updateteamcfgdlg.jobrequireedit");
				if (pjobs == "请选择职业") then pjobs = ""; end;
				
				if (Win_IsChecked("UI.gameui.updateteamcfgdlg.jobcheck") and pjobs == "") then
					Win_ShowMsgBox("请选择职业!");
				else
					local genderidx = 0;
					if bgender~=0 then
						if bboy~=0 then genderidx = 2;
						elseif bgirl~=0 then genderidx = 1;
						end;
					end;
					
					SetTeamSetting(baccept, bjob, pjobs, bonefml, genderidx);
					Win_ShowWidget("UI.gameui.updateteamcfgdlg",false);
				end;
				
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={223,7,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultok=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 201,7,22, 23},
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("交友界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				accepleadercheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={15,54,198,18};
					checked=0,
				};

				jobcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={15,72,68,18};
					checked=0,
				};

				familycheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={15,90,68,18};
					checked=0,
				};

				gendercheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={15,109,68,18};
					checked=0,
				};

				jobrequireedit=
				{
					type="EDIT";
					rect={103,74,78,13};
					textstyle=dt_center+dt_vcenter,
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					editable=0,
				};
				
				joblistbtn = 
				{
					type = "CHECK",
					rect = { 194,71,16,16 },
					bkimage = "res/uires/newcommon/dropbtn.gsa",	
					bkimagepos={1,2},
					framescheme={{2,1,2,2},{0,0,0,0}},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.updateteamcfgdlg.joblistbtn")  then
						Win_SetValue("UI.gameui.proflistdlg",2,value_channel_customindex);
						Win_AlignWidget("UI.gameui.proflistdlg","UI.gameui.updateteamcfgdlg.joblistbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						Win_ShowWidget("UI.gameui.proflistdlg",true);
						Win_SetFocus("UI.gameui.proflistdlg");						     
						end;
						end;						
				},	

				boyradio=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={93,109,70,18};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
				};

				girlradio=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={164,109,70,18};
					groupid=0,
					groupstop=1,
					checked=1,
					extendstyle=ui_btn_style_radio,
				};
				
				publishcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					rect={15,128,68,18};
					checked=1,
				};
				publishtargetbtn= 
				{
					type = "CHECK",
					rect = {111,129,120,16},
					bkimage = "res/uires/newcommon/dropbtn.gsa",
					bkimagepos={100,0},
					textsize = 12,
					framescheme={{2,1,2,2},{0,0,0,0}},
					extendstyle=ui_btn_style_none,
					text = "自由组队";
					
					OnInit = function()
						UI.children.gameui.children.updateteamcfgdlg.children.publishtargetbtn.UpdateValue(0);
					end;
					UpdateValue = function(i)
						local name = TeamPlat_GetPWorldNameAt(i);
						Win_SetText("UI.gameui.updateteamcfgdlg.publishtargetbtn",name);
						Win_SetValue("UI.gameui.updateteamcfgdlg.publishtargetbtn",i,value_channel_customindex);
					end;
					OnClick=function()
						if  Win_IsChecked("UI.gameui.updateteamcfgdlg.publishtargetbtn")  then
							Win_SetValue("UI.gameui.listdlg",603,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else 
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;						     
					end;						
				};				
				affirmbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/affirmbtn.gsa";
					rect={39,155,73,28};
					defaultok=1,
				};

				cancelbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/cancelbtn.gsa";
					rect={148,155,73,28};
					defaultcancel=1,
				};
			};
		};

		
		exteamconfigdlg=
		{
			type="DIALOG";
			bkimage="res/uires/teamdlg/teamconfigdlg.gsa";
			style=wgtstyle_customclose+wgtstyle_topmost,
			rect={19,43,471,390};
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.exteamconfigdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				UI.children.gameui.children.exteamconfigdlg.UpdatePlayerList();
				SortNearPlayers(1);
				
				InitStandbyMember();
				
				local defteamname=(g_PlayerInfo.name).."的小队";
				Win_SetText("UI.gameui.exteamconfigdlg.teamname",defteamname);
				Win_SetFocus("UI.gameui.exteamconfigdlg.teamname");
				
				Win_SetCheck("UI.gameui.exteamconfigdlg.accepleadercheck", false);
				Win_SetCheck("UI.gameui.exteamconfigdlg.jobcheck", false);
				Win_SetCheck("UI.gameui.exteamconfigdlg.familycheck", false);
				Win_SetCheck("UI.gameui.exteamconfigdlg.gendercheck", false);
				Win_SetCheck("UI.gameui.exteamconfigdlg.boyradio", false);
				Win_SetCheck("UI.gameui.exteamconfigdlg.girlradio", true);
				Win_SetText("UI.gameui.exteamconfigdlg.jobrequireedit", "请选择职业");
				
				SetGlobalQuery(GlobalQuery_TeamConfigDlg,1);
				RequestNewbieHelp(help_teamconfigdlg);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_TeamConfigDlg,0);
				RequestNewbieHelp(help_teamconfigdlg,0);
				end;

			
			UpdatePlayerList=function()
				Win_SetValue("UI.gameui.exteamconfigdlg.refreshbtn",0,value_channel_customindex);
				Win_EnableWidget("UI.gameui.exteamconfigdlg.refreshbtn",false);
				Win_SetValue("UI.gameui.exteamconfigdlg.refreshbtn",1,value_channel_timerspace);
				
				local num=UpdateNearPlayers();
				if num > 50 then num = 50 end;
				Win_SetValue("UI.gameui.exteamconfigdlg.playerlist",num,value_channel_item_num);
				if (num > 0) then Win_SetValue("UI.gameui.exteamconfigdlg.playerlist",0,value_channel_sel);end;
				end;
			
			OnOk=function()
				if IsInBattleDeque() ~= 0 then
					Win_ShowMsgBox("组队后将自动退出战场排队队列，您确定要组队吗?","系统消息",ui_msgid_yesno,"UI.gameui.exteamconfigdlg");
				else
					local name=Win_GetText("UI.gameui.exteamconfigdlg.teamname");
					local baccepleadercheck = Win_IsChecked("UI.gameui.exteamconfigdlg.accepleadercheck");
					local bjobcheck = Win_IsChecked("UI.gameui.exteamconfigdlg.jobcheck");
					local bfamilycheck = Win_IsChecked("UI.gameui.exteamconfigdlg.familycheck");
					local bgendercheck = Win_IsChecked("UI.gameui.exteamconfigdlg.gendercheck");
					
					if (Win_IsChecked("UI.gameui.exteamconfigdlg.publishcheck")) then
						local idx = Win_GetValue("UI.gameui.exteamconfigdlg.publishtargetbtn",value_channel_customindex);
						TeamPlat_SetPWorldTarget(idx);
					else
						TeamPlat_SetPWorldTarget(-1);
					end;
					
					if name=="" then
						Win_ShowMsgBox("请您输入队伍名称!");
					else
					
						local num = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_item_num);
						local wholetxt="";
						for i=0,num-1 do
							if i==0 then
								local itemname = Win_GetText("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_itemtext, i);
								wholetxt = itemname;
							else
								local itemname = Win_GetText("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_itemtext, i);
								wholetxt = wholetxt..";"..itemname;
							end;
						end;
					
						local jobrequired = Win_GetText("UI.gameui.exteamconfigdlg.jobrequireedit");
						if (Win_IsChecked("UI.gameui.exteamconfigdlg.jobcheck") and jobrequired == "请选择职业") then
							Win_ShowMsgBox("请选择职业!");
						else
						
							local msg = "";
							TeamCreate(name, wholetxt, msg); 
							
							if not Win_IsChecked("UI.gameui.exteamconfigdlg.accepleadercheck") then
								Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
							end;
							
							local itemnum = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_item_num);
							if itemnum == 0 then
								Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
							end;
						end;
					
					end;
				end;
				end;
			
			OnMsgBoxOk=function()
				ClearBattleStatus();
				local name=Win_GetText("UI.gameui.exteamconfigdlg.teamname");
				local baccepleadercheck = Win_IsChecked("UI.gameui.exteamconfigdlg.accepleadercheck");
				local bjobcheck = Win_IsChecked("UI.gameui.exteamconfigdlg.jobcheck");
				local bfamilycheck = Win_IsChecked("UI.gameui.exteamconfigdlg.familycheck");
				local bgendercheck = Win_IsChecked("UI.gameui.exteamconfigdlg.gendercheck");
				
				if name=="" then
				Win_ShowMsgBox("请您输入队伍名称!");
				else
				
				local num = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_item_num);
				local wholetxt="";
				for i=0,num-1 do
				if i==0 then
					local itemname = Win_GetText("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_itemtext, i);
					wholetxt = itemname;
				else
					local itemname = Win_GetText("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_itemtext, i);
					wholetxt = wholetxt..";"..itemname;
				end;
				end;
				
				local jobrequired = Win_GetText("UI.gameui.exteamconfigdlg.jobrequireedit");
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.jobcheck") and jobrequired == "请选择职业") then
					Win_ShowMsgBox("请选择职业!");
				else
				
					local msg = "";
					TeamCreate(name, wholetxt, msg); 
					
					if not Win_IsChecked("UI.gameui.exteamconfigdlg.accepleadercheck") then
						Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
					end;
					
					local itemnum = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_item_num);
					if itemnum == 0 then
						Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
					end;
				end;
				
				end;
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
				end;
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.exteamconfigdlg",false);
				end;
				
			
			OnSetTeamConfig=function()
				local baccept = 0;
				local bjob = 0;
				local bonefml = 0;
				local bgender = 0;
				local bboy = 0;
				local bgirl = 0;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.accepleadercheck")) then baccept = 1; end;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.jobcheck")) then bjob = 1; end;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.familycheck")) then bonefml = 1; end;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.gendercheck")) then bgender = 1; end;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.boyradio")) then bboy = 1; end;
				if (Win_IsChecked("UI.gameui.exteamconfigdlg.girlradio")) then bgirl = 1; end;
				local pjobs = Win_GetText("UI.gameui.exteamconfigdlg.jobrequireedit");
				if pjobs == "请选择职业" then pjobs = ""; end;
				
				local genderidx = 0;
				if bgender~=0 then
					if bboy~=0 then genderidx = 2;
					elseif bgirl~=0 then genderidx = 1;
					end;
				end;
				
				
				SetTeamSetting(baccept, bjob, pjobs, bonefml, genderidx);
				
				--更加最新的组队契约筛选预备成员
				FilterStandbyMember();
				UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList();
				
				end;
				
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_teamconfigdlg,
						offsetx=257,
						offsety=189,
					},
					
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={443,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 421,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_teamconfigdlg,-1);
						end;
				};
				
				teamname=
				{
					type="EDIT";
					rect={99,52,252,12};
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=30,	
				};

				publishcheck=
				{
					type="CHECK";
					rect={241,76,16,16};
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					checked=1,
					
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetCheck("UI.gameui.exteamconfigdlg.publishtargetbtn",true);
							Win_SetValue("UI.gameui.listdlg",602,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						end;
						UI.children.gameui.children.exteamconfigdlg.children.publishtargetbtn.UpdateValue(-1);
					end;
				};
				publishtargetbtn= 
				{
					type = "CHECK",
					rect = {337,76,120,16},
					bkimage = "res/uires/newcommon/dropbtn.gsa",
					bkimagepos={100,0},
					textsize = 12,
					framescheme={{2,1,2,2},{0,0,0,0}},
					extendstyle=ui_btn_style_none,
					text = "自由组队";
					
					OnInit = function()
						UI.children.gameui.children.exteamconfigdlg.children.publishtargetbtn.UpdateValue(0);
					end;
					UpdateValue = function(i)
						if i ~= -1 then
							local name = TeamPlat_GetPWorldNameAt(i);
							Win_SetText("UI.gameui.exteamconfigdlg.publishtargetbtn",name);
							Win_SetValue("UI.gameui.exteamconfigdlg.publishtargetbtn",i,value_channel_customindex);
						end;
						if (Win_IsChecked("UI.gameui.exteamconfigdlg.publishcheck")) then
							local idx = Win_GetValue("UI.gameui.exteamconfigdlg.publishtargetbtn",value_channel_customindex);
							TeamPlat_SetPWorldTarget(idx);
						end;
					end;
					OnClick=function()
						if  Win_IsChecked("UI.gameui.exteamconfigdlg.publishtargetbtn")  then
							Win_SetValue("UI.gameui.listdlg",602,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else 
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;						     
					end;						
				};
				accepleadercheck=
				{
					type="CHECK";
					rect={35,94,196,16};
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					checked=0,
					
					OnCheck=function(bcheck)
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};

				jobcheck=
				{
					type="CHECK";
					rect={35,111,66,16};
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					checked=0,
					
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetCheck("UI.gameui.exteamconfigdlg.joblistbtn",true);
							UI.children.gameui.children.exteamconfigdlg.children.joblistbtn.OnClick();
						end;
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};

				familycheck=
				{
					type="CHECK";
					rect={241,95,66,16};
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					checked=0,
					
					OnCheck=function(bcheck)
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};
				
				gendercheck=
				{
					type="CHECK";
					rect={241,113,66,13};
					bkimage="res/uires/newcommon/checkbox.gsa";
					bkimagepos={0, -2};
					checked=0,
					
					OnCheck=function(bcheck)
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};

				jobrequireedit=
				{
					type="EDIT";
					rect={123,114,78,13};
					textstyle=dt_center+dt_vcenter,
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					editable=0,
					
					OnValueChange=function()
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};
				
				joblistbtn = 
				{
					type = "CHECK",
					rect = {219,112,14,14 },
					bkimage = "res/uires/newcommon/dropbtn.gsa",	
					framescheme={{2,1,2,2},{0,0,0,0}},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.exteamconfigdlg.joblistbtn")  then
						Win_SetValue("UI.gameui.proflistdlg",1,value_channel_customindex);
						Win_AlignWidget("UI.gameui.proflistdlg","UI.gameui.exteamconfigdlg.joblistbtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						Win_ShowWidget("UI.gameui.proflistdlg",true);
						Win_SetFocus("UI.gameui.proflistdlg");						     
						end;
						end;						
				},	

				boyradio=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					rect={319,113,66,16};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					
					OnCheck=function(bcheck)
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};

				girlradio=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					rect={391,113,66,16};
					groupid=0,
					groupstop=1,
					checked=1,
					extendstyle=ui_btn_style_radio,
					
					OnCheck=function(bcheck)
						UI.children.gameui.children.exteamconfigdlg.OnSetTeamConfig();
						end;
				};

				playerlist=
				{
					type="LISTBOX";
					rect={46,211,185,126};
					itemnum=0,
					dragtype=ui_drag_type_nearplayers,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix,	
					itemdragflag=-1,
					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,

					itemdrawback="res/uires/teamdlg/itembk.gsa",
					itemdrawpos={-43, 22, 0, 0},
					itemselback="res/uires/teamdlg/itemsel.gsa",
					itemselpos={0,2,0,0},	
					updatemute=1,							
	
					OnRClick=function(idx)
							if idx>=0 then
							Win_SetValue("UI.gameui.exteamconfigdlg.playerlist",idx,value_channel_sel);
							local name = GetNearPlayerListName(idx);
							if name ~= "" then
							UI.children.gameui.OnOpenPlayerMenu(name);
							end;
							end;								       
							end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={165,19,20,86},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				selplayerlist=
				{
					type="LISTBOX";
					rect={334,192,110,145};
					itemnum=0,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix,	
					itemdragflag=-1,
					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					itemdrawback="res/uires/teamdlg/itembk.gsa",
					itemdrawpos={-43, 22, 0, 0},
					itemselback="res/uires/teamdlg/itemsel.gsa",
					itemselpos={0,2,0,0},	
					textsize=12,
					updatemute=1,	

					UpdateList=function()
						local info, num = GetStandbyMemberInfo();
						Win_SetValue("UI.gameui.exteamconfigdlg.selplayerlist",num,value_channel_item_num);
						for i = 1, num do
						Win_SetText("UI.gameui.exteamconfigdlg.selplayerlist",info[i],value_channel_itemtext,i-1);
						end;
						if (num > 0) then Win_SetValue("UI.gameui.exteamconfigdlg.selplayerlist",num-1,value_channel_sel);end;
						end;
	
					OnRClick=function(idx)
							if idx>=0 then
							
							end;								       
							end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={94,19,20,105},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
				};

				refreshbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/refreshbtn.gsa";
					rect={177,162,43,23};
					
					OnClick=function()
						local bcando = Win_GetValue("UI.gameui.exteamconfigdlg.refreshbtn",value_channel_customindex);
						if bcando ~= 0 then
						UI.children.gameui.children.exteamconfigdlg.UpdatePlayerList();
						else
						Win_ShowMsgBox("对不起，刷新不能太过频繁！");
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.exteamconfigdlg.refreshbtn",1,value_channel_customindex);
						Win_EnableWidget("UI.gameui.exteamconfigdlg.refreshbtn",true);
						Win_SetValue("UI.gameui.exteamconfigdlg.refreshbtn",-1,value_channel_timerspace);
						end;
				};

				addbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/addbtn.gsa";
					rect={248,231,73,28};
					
					OnClick=function()
						local num = Win_GetValue("UI.gameui.exteamconfigdlg.playerlist",value_channel_item_num);
						if num > 0 then
							local sel = Win_GetValue("UI.gameui.exteamconfigdlg.playerlist",value_channel_sel);
							local rst = AddToStandbyMember(sel);
							if rst ~= 0 then
							UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList();
							end;
						end;
						end;
				};

				delbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/delbtn.gsa";
					rect={248,277,73,28};
					
					OnClick=function()
						local num = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_item_num);
						if num > 0 then
							local sel = Win_GetValue("UI.gameui.exteamconfigdlg.selplayerlist",value_channel_sel);
							local rst = DelStandbyMember(sel);
							if rst ~= 0 then
							UI.children.gameui.children.exteamconfigdlg.children.selplayerlist.UpdateList();
							end;
						end;
						end;
				};

				affirmbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/affirmbtn.gsa";
					rect={136,353,90,29};
					defaultok=1,
				};

				cancelbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/cancelbtn.gsa";
					rect={287,353,90,28};
					defaultcancel=1,
				};
				
				titlelabel=
				{
					type = "LABEL",
					rect = {46,190,185,21},
					bkimage="res/uires/teamdlg/teamcfgbk.gsa",
					enable=0,		
					initlayer=0;
					updatemute=1,
				};

				sexcheck=
				{
					type="BUTTON";
					rect={44,190,28,21};
					bkimage="res/uires/teamdlg/sexbtn.gsa",
					initlayer=1;
					
					OnClick=function()
						SortNearPlayers(0);
						end;
				};

				namecheck=
				{
					type="BUTTON";
					rect={71,190,72,21};
					bkimage="res/uires/teamdlg/teamcfgname.gsa",
					initlayer=1;

					OnClick=function()
						SortNearPlayers(1);
						end;
				};

				profcheck=
				{
					type="BUTTON";
					rect={143,190,40,21};
					bkimage="res/uires/teamdlg/teamcfgprof.gsa",
					initlayer=1;
					
					OnClick=function()
						SortNearPlayers(2);
						end;
				};

				levelcheck=
				{
					type="BUTTON";
					rect={183,190,28,21};
					bkimage="res/uires/teamdlg/teamcfglevel.gsa",
					initlayer=1;
					
					OnClick=function()
						SortNearPlayers(3);
						end;
				};

			};
		};
		
		
		--组队契约
		bargainbtn=
		{
			type="BUTTON",
			rect={43,110,30,30},
			visible=0,
			bkimage="res/uires/bargaindlg/bargainbtn.gsa",
			framescheme={{0,1,2,3},{4,5,6,7}},
			moveable=0,
			
			OnClick=function()
				if not Win_IsVisible("UI.gameui.bargaindlg") then
					Win_ShowWidget("UI.gameui.bargaindlg",true);
				else
					Win_ShowWidget("UI.gameui.bargaindlg",false);
				end;
				end;
		};
		
		bargaindlg=
		{
			type="DIALOG";
			bkimage="res/uires/bargaindlg/bargaindlgbk.gsa";
			rect={29,58,460,409};
			caption="组队契约";
			captionrect={60,13,325,12};
			drawcolor={255,255,0,255},
			textfont=1,
			textsize=12,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0,
			moveable=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.bargaindlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				local myinfo = GetMainPlayerInfo();
				if myinfo.isinteam ~= 0 then
					Win_SetValue("UI.gameui.bargaindlg",0,value_channel_customtype);
					Win_ShowWidget("UI.gameui.bargaindlg.mybargainbtn",false);
					Win_ShowWidget("UI.gameui.bargaindlg.teambargainbtn",true);
					UI.children.gameui.children.bargaindlg.UpdateDlg(0);				
				else
					Win_SetValue("UI.gameui.bargaindlg",1,value_channel_customtype);
					Win_ShowWidget("UI.gameui.bargaindlg.teambargainbtn",false);
					Win_ShowWidget("UI.gameui.bargaindlg.mybargainbtn",true);
					UI.children.gameui.children.bargaindlg.UpdateDlg(1);		
				end;
				end;
			
			UpdateDlg=function(idx)
				SetTeamCovMode(idx);
				
				UI.children.gameui.children.bargaindlg.ShowStar(1, 0, 0);
				UI.children.gameui.children.bargaindlg.ShowStar(2, 0, 0);
				UI.children.gameui.children.bargaindlg.ShowStar(3, 0, 0);
				UI.children.gameui.children.bargaindlg.ShowStar(4, 0, 0);
				UI.children.gameui.children.bargaindlg.ShowStar(5, 0, 0);
				UI.children.gameui.children.bargaindlg.ShowPlayerInfo(1, 0, "", "", "", "");
				UI.children.gameui.children.bargaindlg.ShowPlayerInfo(2, 0, "", "", "", "");
				UI.children.gameui.children.bargaindlg.ShowPlayerInfo(3, 0, "", "", "", "");
				UI.children.gameui.children.bargaindlg.ShowPlayerInfo(4, 0, "", "", "", "");
				UI.children.gameui.children.bargaindlg.ShowPlayerInfo(5, 0, "", "", "", "");
				Win_ShowWidget("UI.gameui.bargaindlg.exhead1",false);
				Win_ShowWidget("UI.gameui.bargaindlg.exhead2",false);
				
				local bargaintime = GetCurBargainTime(idx);
				Win_SetText("UI.gameui.bargaindlg.timelabel",bargaintime);
				Win_SetValue("UI.gameui.bargaindlg.timelabel",1,value_channel_timerspace);
				
				local name, benable, lefttext, righttext = GetBargainInfo(idx);
				Win_SetText("UI.gameui.bargaindlg.bargainname", name);
				Win_SetCheck("UI.gameui.bargaindlg.statuscheck", benable~=0);
				Win_SetText("UI.gameui.bargaindlg.conditionedit",lefttext);
				Win_SetText("UI.gameui.bargaindlg.effectedit",righttext);
				Win_SetValue("UI.gameui.bargaindlg.conditionedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.bargaindlg.conditionedit",0,value_channel_range_end);
				Win_SetValue("UI.gameui.bargaindlg.effectedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.bargaindlg.effectedit",0,value_channel_range_end);
				
				local condValid, attrVallid = IsTeamCovValid(idx);
				if condValid~=0 then
					Win_SetValue("UI.gameui.bargaindlg.conditionedit",GetColorIndex(255,255,255,255),value_channel_color_draw);
				else
					Win_SetValue("UI.gameui.bargaindlg.conditionedit",GetColorIndex(128,128,128,255),value_channel_color_draw);
				end;
				
				if attrVallid~=0 then
					Win_SetValue("UI.gameui.bargaindlg.effectedit",GetColorIndex(255,255,255,255),value_channel_color_draw);
				else
					Win_SetValue("UI.gameui.bargaindlg.effectedit",GetColorIndex(128,128,128,255),value_channel_color_draw);
				end;
				
				if idx == 0 then
					local teaminfo=TeamGetInfo();
					for i=1,teaminfo.nmember do
					local buddyinfo=TeamGetMember(i-1);
					UI.children.gameui.children.bargaindlg.ShowPlayerInfo(i, 1, buddyinfo.name,  buddyinfo.level, buddyinfo.profname, buddyinfo.family);
					
					--组队契约 返回1~5, 0为非法
					local starinfo = GetTeamCovMemberID(buddyinfo.name);
					UI.children.gameui.children.bargaindlg.ShowStar(i, starinfo, starinfo-1);
				
					local bufinfo=Win_GetCustomBuffer("UI.gameui.bargaindlg.head"..i);
					bufinfo.index=i-1;
					Win_SetCustomBuffer("UI.gameui.bargaindlg.head"..i,bufinfo);
					Win_SetValue("UI.gameui.bargaindlg.head"..i,custom_buffer_bargainhead,value_channel_csutombuffer);
					end;
					
					local hasconvenant = HasTeamConvenant(idx);
					if hasconvenant~=0 then
						if teaminfo.isleader ~= 0 then
							Win_EnableWidget("UI.gameui.bargaindlg.clearstatusbtn", true);
						else
							Win_EnableWidget("UI.gameui.bargaindlg.clearstatusbtn", false);
						end;
					else
						Win_EnableWidget("UI.gameui.bargaindlg.clearstatusbtn", false);
					end;
					Win_EnableWidget("UI.gameui.bargaindlg.statuscheck",hasconvenant~=0 and teaminfo.isleader~=0);
				
				elseif idx == 1 then
					Win_SetValue("UI.gameui.bargaindlg.conditionedit",GetColorIndex(128,128,128,255),value_channel_color_draw);
					Win_SetValue("UI.gameui.bargaindlg.effectedit",GetColorIndex(128,128,128,255),value_channel_color_draw);
					
					local playerInfo=GetMainPlayerInfo();
					local binteam = playerInfo.isinteam;
					if binteam~=0 then
						UI.children.gameui.children.bargaindlg.ShowPlayerInfo(1, 1, playerInfo.name,  playerInfo.LEVEL, playerInfo.profname, playerInfo.family);
						Win_ShowWidget("UI.gameui.bargaindlg.exhead1",true);
						Win_ShowWidget("UI.gameui.bargaindlg.head1",false);
					else
						UI.children.gameui.children.bargaindlg.ShowPlayerInfo(2, 1, playerInfo.name,  playerInfo.LEVEL, playerInfo.profname, playerInfo.family);
						Win_ShowWidget("UI.gameui.bargaindlg.exhead2",true);
						Win_ShowWidget("UI.gameui.bargaindlg.head2",false);
					end;
					
					local hasconvenant = HasTeamConvenant(idx);
					if hasconvenant~=0 then
						Win_EnableWidget("UI.gameui.bargaindlg.clearstatusbtn", true);
					else
						Win_EnableWidget("UI.gameui.bargaindlg.clearstatusbtn", false);
					end;
					
					Win_EnableWidget("UI.gameui.bargaindlg.statuscheck",true);
					if (hasconvenant==0) then
						Win_EnableWidget("UI.gameui.bargaindlg.statuscheck",false);
					else
						Win_SetCheck("UI.gameui.bargaindlg.statuscheck",attrVallid~=0);
					end;
					
				end
				
		
				end;
			
			OnOk=function()
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.bargaindlg",false);
				end;
			
			ShowStar=function(id, bshow, frame)
				if id < 1 or id > 5 then return; end;
				local wgtpath = "UI.gameui.bargaindlg.start"..id;
				Win_ShowWidget(wgtpath, bshow~=0);
				if (bshow~=0) then Win_SetValue(wgtpath, frame, value_channel_framescheme); end;
				end;
			
			ShowPlayerInfo=function(id, bshowhead, name, level, prof, family)
				if id < 1 or id > 5 then return; end;
				local headpath = "UI.gameui.bargaindlg.head"..id;
				local namepath = "UI.gameui.bargaindlg.name"..id;
				local levelpath = "UI.gameui.bargaindlg.level"..id;
				local profpath = "UI.gameui.bargaindlg.prof"..id;
				local familypath = "UI.gameui.bargaindlg.family"..id;
				Win_ShowWidget(headpath, bshowhead~=0);
				Win_SetText(namepath, name);
				Win_SetText(levelpath, level);
				Win_SetText(profpath, prof);
				Win_SetText(familypath, family);
				end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={434,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 414,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("组队契约");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				teambargainbtn=
				{
					type="BUTTON",
					rect={29,40,90,22},
					bkimage="res/uires/bargaindlg/teambargainbtn.gsa",
					tiptext="切换到个人契约",
					
					OnClick=function()
						Win_SetValue("UI.gameui.bargaindlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.bargaindlg.teambargainbtn",false);
						Win_ShowWidget("UI.gameui.bargaindlg.mybargainbtn",true);
						UI.children.gameui.children.bargaindlg.UpdateDlg(1);
						end;
				};
				
				mybargainbtn=
				{
					type="BUTTON",
					rect={29,40,90,22},
					bkimage="res/uires/bargaindlg/mybargainbtn.gsa",
					tiptext="切换到队伍契约",
					visible=0,
					
					OnClick=function()
						Win_SetValue("UI.gameui.bargaindlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.bargaindlg.mybargainbtn",false);
						Win_ShowWidget("UI.gameui.bargaindlg.teambargainbtn",true);
						UI.children.gameui.children.bargaindlg.UpdateDlg(0);
						end;
				};
				
				timelabel=
				{
					type="LABEL";
					rect={33,69,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
					
					OnTimer=function()
						local customtype = Win_GetValue("UI.gameui.bargaindlg",value_channel_customtype);
						local bargaintime = GetCurBargainTime(customtype);
						Win_SetText("UI.gameui.bargaindlg.timelabel",bargaintime);
						if Win_IsVisible("UI.gameui.bargaindlg") then
							Win_SetValue("UI.gameui.bargaindlg.timelabel",1,value_channel_timerspace);
						else
							Win_SetValue("UI.gameui.bargaindlg.timelabel",-1,value_channel_timerspace);
						end;
						end;
				};

				item=
				{
					type="WIDGET";
					bkimagepos={2,3};
					rect={174,50,36,36};
					clientrect={0,0,36,36},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_bargain,
					dragindex=0,
				};

				bargainname=
				{
					type="LABEL";
					rect={215,70,77,13};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				bargainstatus=
				{
					type="LABEL";
					rect={333,69,77,13};
					captinorect={0,0,77,13};
					caption="契约生效",
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter+dt_magicedge,
				};

				statuscheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkbox.gsa";
					rect={423,68,15,14};
					
					OnClick=function()
						local bcheck=Win_IsChecked("UI.gameui.bargaindlg.statuscheck");
						local customtype = Win_GetValue("UI.gameui.bargaindlg",value_channel_customtype);
						EnableBargain(customtype);
						Win_SetCheck("UI.gameui.bargaindlg.statuscheck",bcheck~=1);
						end;
				};

				
				clearstatusbtn=
				{
					type="BUTTON";
					bkimage="res/uires/bargaindlg/clearstatusbtn.gsa";
					rect={352,40,91,22};
					
					OnClick=function()
						Win_ShowMsgBox("您确定要清除契约吗?","系统消息",ui_msgid_yesno,"UI.gameui.bargaindlg.clearstatusbtn");
						end;
					
					OnMsgBoxOk=function()
						local customtype = Win_GetValue("UI.gameui.bargaindlg",value_channel_customtype);
						ClearBargainStatus(customtype);
						end;
				};
				
				conditionedit=
				{
					type="MULTIEDIT";
					rect={37,121,158,131};
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={164,17,15,93},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,							
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							updatemute=1,

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				effectedit=
				{
					type="MULTIEDIT";
					rect={252,121,158,131};
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={164,17,15,93},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,							
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							updatemute=1,

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				start1=
				{
					type="WIDGET";
					bkimage="res/uires/bargaindlg/star.gsa";
					framescheme={{0},{1},{2},{3},{4}},
					bkimagepos={-2,-4};
					rect={26,269,13,13};
					visible=0,
				};

				start2=
				{
					type="WIDGET";
					bkimagepos={-2,-4};
					rect={110,269,13,13};
					bkimage="res/uires/bargaindlg/star.gsa";
					framescheme={{0},{1},{2},{3},{4}},
					bkimagepos={-2,-4};
					visible=0,
				};

				start3=
				{
					type="WIDGET";
					bkimagepos={-2,-4};
					rect={194,269,13,13};
					framescheme={{0},{1},{2},{3},{4}},
					bkimage="res/uires/bargaindlg/star.gsa";
					bkimagepos={-2,-4};
					visible=0,
				};

				start4=
				{
					type="WIDGET";
					bkimagepos={-2,-4};
					rect={278,269,13,13};
					bkimage="res/uires/bargaindlg/star.gsa";
					framescheme={{0},{1},{2},{3},{4}},
					bkimagepos={-2,-4};
					visible=0,
				};

				start5=
				{
					type="WIDGET";
					bkimagepos={-2,-4};
					rect={362,269,13,13};
					bkimage="res/uires/bargaindlg/star.gsa";
					framescheme={{0},{1},{2},{3},{4}},
					bkimagepos={-2,-4};
					visible=0,
				};

				name1=
				{
					type="LABEL";
					rect={27,304,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level1=
				{
					type="LABEL";
					rect={56,324,50,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof1=
				{
					type="LABEL";
					rect={56,341,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family1=
				{
					type="LABEL";
					rect={28,373,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head1=
				{
					type="WIDGET";
					rect={51,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_bargainhead,
				};
				
				exhead1=
				{
					type="WIDGET";
					rect={51,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_mybargainhead,
					visible=0;
				};
				
				name2=
				{
					type="LABEL";
					rect={111,304,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level2=
				{
					type="LABEL";
					rect={140,324,50,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof2=
				{
					type="LABEL";
					rect={140,341,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family2=
				{
					type="LABEL";
					rect={112,373,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head2=
				{
					type="WIDGET";
					rect={135,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_bargainhead,
				};
				
				exhead2=
				{
					type="WIDGET";
					rect={135,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_mybargainhead,
					visible=0;
				};
				
				name3=
				{
					type="LABEL";
					rect={195,304,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level3=
				{
					type="LABEL";
					rect={224,324,50,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof3=
				{
					type="LABEL";
					rect={224,341,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family3=
				{
					type="LABEL";
					rect={196,373,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head3=
				{
					type="WIDGET";
					rect={219,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_bargainhead,
				};
				
				name4=
				{
					type="LABEL";
					rect={279,304,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level4=
				{
					type="LABEL";
					rect={308,324,50,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof4=
				{
					type="LABEL";
					rect={308,341,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family4=
				{
					type="LABEL";
					rect={280,373,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head4=
				{
					type="WIDGET";
					rect={303,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_bargainhead,
				};
				
				name5=
				{
					type="LABEL";
					rect={363,304,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level5=
				{
					type="LABEL";
					rect={392,324,50,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof5=
				{
					type="LABEL";
					rect={392,341,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family5=
				{
					type="LABEL";
					rect={364,373,78,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head5=
				{
					type="WIDGET";
					rect={387,271,25,25};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_bargainhead,
				};

			};
		};
		
		--察看附近队伍
		findnearteamdlg=
		{
			type="DIALOG";
			bkimage="res/uires/teamdlg/findnearteamdlgbk.gsa";
			rect={0,0,605,464};
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0,
			moveable=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.findnearteamdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.findnearteamdlg.teamlist",-1,value_channel_sel);
				UI.children.gameui.children.findnearteamdlg.UpdateTeamList();
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.findnearteamdlg",false);
				end;
			
			UpdateDlg=function(idx)
				SetCurSelNearTeam(idx);
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(1, 0, "", "", "", "");
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(2, 0, "", "", "", "");
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(3, 0, "", "", "", "");
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(4, 0, "", "", "", "");
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(5, 0, "", "", "", "");
				
				local name, lefttext, righttext = GetTeamBargainInfo(idx);
				Win_SetText("UI.gameui.findnearteamdlg.name", name);
				Win_SetText("UI.gameui.findnearteamdlg.conditionedit",lefttext);
				Win_SetText("UI.gameui.findnearteamdlg.effectedit",righttext);
				Win_SetValue("UI.gameui.findnearteamdlg.conditionedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.findnearteamdlg.conditionedit",0,value_channel_range_end);
				Win_SetValue("UI.gameui.findnearteamdlg.effectedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.findnearteamdlg.effectedit",0,value_channel_range_end);
				
				local num=GetTeamBargainMemberNum(idx);
				for i=1,num do
				local buddyinfo=GetTeamBargainMemberInfo(idx,i-1);
				UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(i, 1, buddyinfo.name,  buddyinfo.level, buddyinfo.prof, buddyinfo.family);
				end;
				
				local myinfo = GetMainPlayerInfo();
				if (myinfo.isinteam ~= 0) then
					Win_EnableWidget("UI.gameui.findnearteamdlg.joinbtn", false);
				else
					Win_EnableWidget("UI.gameui.findnearteamdlg.joinbtn", true);
				end;
				
				end;
			
			ShowPlayerInfo=function(id, bshowhead, name, level, prof, family)
				if id < 1 or id > 5 then return; end;
				local headpath = "UI.gameui.findnearteamdlg.head"..id;
				local namepath = "UI.gameui.findnearteamdlg.name"..id;
				local levelpath = "UI.gameui.findnearteamdlg.level"..id;
				local profpath = "UI.gameui.findnearteamdlg.prof"..id;
				local familypath = "UI.gameui.findnearteamdlg.family"..id;
				Win_ShowWidget(headpath, bshowhead~=0);
				Win_SetText(namepath, name);
				if (level~="") then
				Win_SetText(levelpath, level.."级");
				else
				Win_SetText(levelpath, "");
				end;
				Win_SetText(profpath, prof);
				
				if (family~="") then
				Win_SetText(familypath, "家族: "..family);
				else
				Win_SetText(familypath, "");
				end;
				
				end;
			
			UpdateTeamList=function()
				Win_SetValue("UI.gameui.findnearteamdlg.refreshbtn",0,value_channel_customindex);
				Win_EnableWidget("UI.gameui.findnearteamdlg.refreshbtn",false);
				Win_SetValue("UI.gameui.findnearteamdlg.refreshbtn",1,value_channel_timerspace);
				
				local num=UpdateNearTeams();
				if num > 50 then num = 50 end;
				Win_SetValue("UI.gameui.findnearteamdlg.teamlist",num,value_channel_item_num);
				if (num > 0) then
					Win_SetValue("UI.gameui.findnearteamdlg.teamlist",0,value_channel_sel);
					UI.children.gameui.children.findnearteamdlg.UpdateDlg(0);
					for i=0, num-1 do
						local lname = GetNearTeamItem(i);
						if lname ~= "" then
							Win_SetText("UI.gameui.findnearteamdlg.teamlist",lname, value_channel_tiptext,i);
						else
							Win_SetText("UI.gameui.findnearteamdlg.teamlist","", value_channel_tiptext,i);
						end;
					end;
				else
					UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(1, 0, "", "", "", "");
					UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(2, 0, "", "", "", "");
					UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(3, 0, "", "", "", "");
					UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(4, 0, "", "", "", "");
					UI.children.gameui.children.findnearteamdlg.ShowPlayerInfo(5, 0, "", "", "", "");
					Win_SetText("UI.gameui.findnearteamdlg.name", "");
					Win_SetText("UI.gameui.findnearteamdlg.conditionedit","");
					Win_SetText("UI.gameui.findnearteamdlg.effectedit","");
					Win_EnableWidget("UI.gameui.findnearteamdlg.joinbtn", false);
				end;
				end;

			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={575,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 553,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("组队契约");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				
				refreshbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/refreshbtn.gsa";
					rect={226,48,42,22};
					
					OnClick=function()
						local bcando = Win_GetValue("UI.gameui.findnearteamdlg.refreshbtn",value_channel_customindex);
						if bcando ~= 0 then
						UI.children.gameui.children.findnearteamdlg.UpdateTeamList();
						else
						Win_ShowMsgBox("对不起，刷新不能太过频繁！");
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.findnearteamdlg.refreshbtn",1,value_channel_customindex);
						Win_EnableWidget("UI.gameui.findnearteamdlg.refreshbtn",true);
						Win_SetValue("UI.gameui.findnearteamdlg.refreshbtn",-1,value_channel_timerspace);
						end;
				};
				
				teamlist=
				{
					type="LISTBOX";
					rect={46,96,200,315};
					itemnum=0,
					dragtype=ui_drag_type_nearteams,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix,	
					itemdragflag=-1,
					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={-5,0,0,0},	
					updatemute=1,							
	
					OnValueChange=function(sel)
						if sel >= 0 then
							UI.children.gameui.children.findnearteamdlg.UpdateDlg(sel);
						end;
						end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={201,17,20,279},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,

							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				conditionedit=
				{
					type="MULTIEDIT";
					rect={448,123,114,142};
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={113,17,20,106},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,							
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							updatemute=1,

							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				effectedit=
				{
					type="MULTIEDIT";
					rect={448,297,114,141};
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={116,17,15,106},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,							
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							updatemute=1,

							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				name=
				{
					type="LABEL";
					rect={447,75,132,17};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};
				
				name1=
				{
					type="LABEL";
					rect={343,78,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level1=
				{
					type="LABEL";
					rect={342,98,30,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof1=
				{
					type="LABEL";
					rect={372,98,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family1=
				{
					type="LABEL";
					rect={295,120,128,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head1=
				{
					type="WIDGET";
					rect={293,86,25,25};
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_nearteammemhead,
					dragindex=0,
				};
				
				name2=
				{
					type="LABEL";
					rect={343,154,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level2=
				{
					type="LABEL";
					rect={342,175,30,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof2=
				{
					type="LABEL";
					rect={372,175,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family2=
				{
					type="LABEL";
					rect={295,196,128,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head2=
				{
					type="WIDGET";
					rect={293,161,25,25};
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_nearteammemhead,
					dragindex=1,
				};
				
				name3=
				{
					type="LABEL";
					rect={343,231,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level3=
				{
					type="LABEL";
					rect={342,252,30,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof3=
				{
					type="LABEL";
					rect={372,252,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family3=
				{
					type="LABEL";
					rect={295,274,128,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head3=
				{
					type="WIDGET";
					rect={293,239,25,25};
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_nearteammemhead,
					dragindex=2,
				};
				
				name4=
				{
					type="LABEL";
					rect={343,307,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level4=
				{
					type="LABEL";
					rect={342,328,30,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof4=
				{
					type="LABEL";
					rect={372,328,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family4=
				{
					type="LABEL";
					rect={295,350,128,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head4=
				{
					type="WIDGET";
					rect={293,315,25,25};
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_nearteammemhead,
					dragindex=3,
				};
				
				name5=
				{
					type="LABEL";
					rect={343,382,79,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				level5=
				{
					type="LABEL";
					rect={342,403,30,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				prof5=
				{
					type="LABEL";
					rect={372,403,50,15};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				family5=
				{
					type="LABEL";
					rect={295,424,128,14};
					textsize=12,
					drawcolor={255,255,255,255},
					textstyle=dt_center+dt_vcenter,
				};

				head5=
				{
					type="WIDGET";
					rect={293,390,25,25};
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_nearteammemhead,
					dragindex=4,
				};

				
				joinbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/joinbtn.gsa";
					rect={116,418,86,24};
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.findnearteamdlg.teamlist",value_channel_sel);
						NearTeamJoin(sel);
						end;
				};
			};
		};

		
		friendconfigdlg=
		{
			type="DIALOG",
			rect={0,0,145,212},
			captionrect={48,10,50,12},
			textsize=12,
			textfont=1,			
			caption="交友设置",				
			style=wgtstyle_topmost,
			bkimage="res/uires/teamdlg/friendconfigdlg.gsa",
			moveable=1,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			updatemute=1,
			
			OnSelfHide=function()
				if Win_IsChecked("UI.gameui.teamdlg.configbtn") then
				Win_SetCheck("UI.gameui.teamdlg.configbtn",false);						
				end;
				end;
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.friendconfigdlg",false);				       
				       end;
			
			OnSelfShow=function()
					  bhide, bshowlevel,bflash= GmBuddyGetFlag();
					  Win_SetCheck("UI.gameui.friendconfigdlg.hideCheck",bhide);
					  Win_SetCheck("UI.gameui.friendconfigdlg.levelCheck",bshowlevel);					  
					  Win_SetCheck("UI.gameui.friendconfigdlg.flashCheck",bflash);
					  end;
					  
			
			children=
			{
								
				closebtn=
				{
					type="BUTTON",
					rect={120,5,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultok=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 99,5,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("交友界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				applybtn=
				{
					type="BUTTON",
					rect={32,186,90,22},
					bkimage="res/uires/common/applybtn.gsa",
					defaultok=1,
					
					OnClick=function()
						bhide=Win_IsChecked("UI.gameui.friendconfigdlg.hideCheck");
						bshowlevel=Win_IsChecked("UI.gameui.friendconfigdlg.levelCheck");
						bflash=Win_IsChecked("UI.gameui.friendconfigdlg.flashCheck");
						GmBuddySetFlag(bhide,bshowlevel,bflash);						
						end;
					
					
				},				
				
				hideCheck=
				{
					type="CHECK",
					rect={30,46,80,14},
					bkimage="res/uires/common/checkbox.gsa",					
				};
				
				levelCheck=
				{
					type="CHECK",
					rect={30,65,80,14},
					bkimage="res/uires/common/checkbox.gsa",					
				};
				
				flashCheck=
				{
					type="CHECK",
					rect={30,84,94,14},
					bkimage="res/uires/common/checkbox.gsa",					
				};
				
				
			},
			
		};
		
		--caption="邮箱设置",				
		mailconfigdlg=
		{
			type="DIALOG",
			rect={0,0,196,225},	
			style=wgtstyle_topmost+wgtstyle_alphawin,
			bkimage="res/uires/maildlg/mailconfigdlg.gsa",
			moveable=1,
			visible=0,
			updatemute=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
	
			OnSelfHide=function()
				if Win_IsChecked("UI.gameui.maillistdlg.configbtn") then
				Win_SetCheck("UI.gameui.maillistdlg.configbtn",false);						
				end;
				end;
			
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.mailconfigdlg",false);				       
				       end;
			
			OnSelfShow=function()					 
				local var=GetGameVar("rejectmail");
				Win_SetCheck("UI.gameui.mailconfigdlg.resistCheck",(var==1));
					  
				var=GetGameVar("keepmail");
				Win_SetCheck("UI.gameui.mailconfigdlg.keepCheck",(var==1));
					  
				var=GetGameVar("fullnote");
				Win_SetCheck("UI.gameui.mailconfigdlg.noticeCheck",(var==1));					  
				end;
					  
			
			children=
			{	
				closebtn=
				{
					type="BUTTON",
					rect={169,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultok=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 147,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("信箱设置界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				applybtn=
				{
					type="BUTTON",
					rect={66,192,90,28},
					bkimage="res/uires/newcommon/applybtn.gsa",
					defaultok=1,
					
					OnClick=function()
				
						if Win_IsChecked("UI.gameui.mailconfigdlg.resistCheck") then
						SetGameVar("rejectmail",1);						
						else
						SetGameVar("rejectmail",0);						
						end;
						
						if Win_IsChecked("UI.gameui.mailconfigdlg.keepCheck") then
						SetGameVar("keepmail",1);
						else
						SetGameVar("keepmail",0);
						end;
						
						if Win_IsChecked("UI.gameui.mailconfigdlg.noticeCheck") then
						SetGameVar("fullnote",1);
						else
						SetGameVar("fullnote",0);
						end;
						
						local buddynum=GetNumGameBuddy();				
						local var=GetGameVar("rejectmail");				
						Win_EnableWidget("UI.gameui.maillistdlg.mailresistbtn",((var==0)and(buddynum>0)));
						
						ConfirmMailReject();
						end;
				},				
				
				resistCheck=
				{
					type="CHECK",
					rect={60,63,80,16},
					bkimage="res/uires/newcommon/checkbox.gsa",					
					bkimagepos={0,-2};
				};
				
				keepCheck=
				{
					type="CHECK",
					rect={60,87,105,16},
					bkimage="res/uires/newcommon/checkbox.gsa",					
					bkimagepos={0,-2};
				};
				
				noticeCheck=
				{
					type="CHECK",
					rect={60,110,105,16},
					bkimage="res/uires/newcommon/checkbox.gsa",					
					bkimagepos={0,-2};
				};
				
			},
			
		};
		
		friendinfodlg=
		{
			type = "DIALOG",
			rect={0,0,118,116},
			bkimage="res/uires/teamdlg/friendinfodlg.gsa",
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_popup,						
			visible=0,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			updatemute=1,
			
			OnRClick=function()
			      Win_ShowWidget("UI.gameui.friendinfodlg",false);
			      end;
			
			children=
			{
				IdLabel= 
				{
					type = "LABEL",
					rect = { 8,8,100,12 },
					textsize=12,
					enable=0,
				};
				
				GenderLabel= 
				{
					type = "LABEL",
					rect = { 8,25,100,12 },
					textsize=12,
					enable=0,
				};
				
				LevelLabel= 
				{
					type = "LABEL",
					rect = { 8,42,100,12 },
					textsize=12,
					enable=0,
				};
				
				ProfessionLabel= 
				{
					type = "LABEL",
					rect = { 8,59,100,12 },
					textsize=12,
					enable=0,
				};
				
				TypeLabel= 
				{
					type = "LABEL",
					rect = { 8,76,100,12 },
					textsize=12,
					enable=0,
				};
				
				TitleLabel= 
				{
					type = "LABEL",
					rect = { 8,93,100,12 },
					textsize=12,
					enable=0,
				};				
				
			};
			
		};
		
		nearplayerlistdlg=
		{
			type="DIALOG";
			bkimage="res/uires/teamdlg/nearplayerlistdlg.gsa";
			rect={0,0,335,257};
			moveable=1,
			style=wgtstyle_topmost,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.nearplayerlistdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				UI.children.gameui.children.nearplayerlistdlg.UpdatePlayerList();
				SortNearPlayers(1);
				end;
			
			UpdatePlayerList=function()
				Win_SetValue("UI.gameui.nearplayerlistdlg.refreshbtn",0,value_channel_customindex);
				Win_EnableWidget("UI.gameui.nearplayerlistdlg.refreshbtn",false);
				Win_SetValue("UI.gameui.nearplayerlistdlg.refreshbtn",1,value_channel_timerspace);
				
				local num=UpdateNearPlayers();
				if num > 50 then num = 50 end;
				Win_SetValue("UI.gameui.nearplayerlistdlg.playerlist",num,value_channel_item_num);
				end;

			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 309,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 287,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("好友");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				playerlist=
				{
					type="LISTBOX";
					rect={56,102,248,126};
					itemnum=0,
					dragtype=ui_drag_type_nearplayers,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix,	
					itemdragflag=-1,
					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					
					itemdrawback="res/uires/teamdlg/itembk.gsa",
					itemdrawpos={-43, 22, 0, 0},
					itemselback="res/uires/teamdlg/itemsel.gsa",
					itemselpos={0,2,0,0},	
					updatemute=1,							
	
					OnRClick=function(idx)
							if idx>=0 then
							Win_SetValue("UI.gameui.nearplayerlistdlg.playerlist",idx,value_channel_sel);
							local name = GetNearPlayerListName(idx);
							if name ~= "" then
							UI.children.gameui.OnOpenPlayerMenu(name);
							end;
							end;								       
							end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={228,19,20,86},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
				};

				titlelabel=
				{
					type = "LABEL",
					rect = {55,81,250,21},
					bkimage="res/uires/teamdlg/teamcfgbk.gsa",
					enable=0,		
					initlayer=0;
				};

				sexcheck=
				{
					type="BUTTON";
					rect={54,82,28,21};
					bkimage="res/uires/teamdlg/sexbtn.gsa",
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						SortNearPlayers(0);
						end;
				};

				namecheck=
				{
					type="BUTTON";
					rect={81,81,72,21};
					bkimage="res/uires/teamdlg/teamcfgname.gsa",
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						SortNearPlayers(1);
						end;
				};

				profcheck=
				{
					type="BUTTON";
					rect={153,81,40,21};
					bkimage="res/uires/teamdlg/teamcfgprof.gsa",
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						SortNearPlayers(2);
						end;
				};

				levelcheck=
				{
					type="BUTTON";
					rect={193,81,28,21};
					bkimage="res/uires/teamdlg/teamcfglevel.gsa",
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						SortNearPlayers(3);
						end;
				};
				
				lhlevelcheck=
				{
					type="BUTTON";
					rect={221,81,64,21};
					bkimage="res/uires/teamdlg/teamcfglhlevel.gsa",
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						SortNearPlayers(4);
						end;
				};

				refreshbtn=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/refreshbtn.gsa";
					rect={261,54,43,23};
					
					OnClick=function()
						local bcando = Win_GetValue("UI.gameui.nearplayerlistdlg.refreshbtn",value_channel_customindex);
						if bcando ~= 0 then
						UI.children.gameui.children.nearplayerlistdlg.UpdatePlayerList();
						else
						Win_ShowMsgBox("对不起，刷新不能太过频繁！");
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.nearplayerlistdlg.refreshbtn",1,value_channel_customindex);
						Win_EnableWidget("UI.gameui.nearplayerlistdlg.refreshbtn",true);
						Win_SetValue("UI.gameui.nearplayerlistdlg.refreshbtn",-1,value_channel_timerspace);
						end;
				};
			};
		};
				
				
		
		proflistdlg=
		{
			type="DIALOG",
			rect={0,0,126,128},	
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/newcommon/patchupleft.gsa",
			patchupright="res/uires/newcommon/patchupright.gsa",
			patchdownleft="res/uires/newcommon/patchdownleft.gsa",
			patchdownright="res/uires/newcommon/patchdownright.gsa",
			
			patchmiddle="res/uires/newcommon/patchmiddle.gsa",
			
			patchupmiddle="res/uires/newcommon/patchupmiddle.gsa",
			patchdownmiddle="res/uires/newcommon/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/newcommon/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/newcommon/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
	
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.proflistdlg")  then
					local index = Win_GetValue("UI.gameui.proflistdlg",value_channel_customindex);
					if index == 1 then
					
					if Win_IsChecked("UI.gameui.exteamconfigdlg.joblistbtn") then
					Win_SetCheck("UI.gameui.exteamconfigdlg.joblistbtn",false);									
					end;
					
					elseif index == 2 then
					if Win_IsChecked("UI.gameui.updateteamcfgdlg.joblistbtn") then
					Win_SetCheck("UI.gameui.updateteamcfgdlg.joblistbtn",false);									
					end;
					
					end;
				end;
				end;	
			
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.proflistdlg",false);				       
				       end;
					
			OnSelfShow=function()
				local oldtxt= "";
				local index = Win_GetValue("UI.gameui.proflistdlg",value_channel_customindex);
				if index == 1 then
					oldtxt = Win_GetText("UI.gameui.exteamconfigdlg.jobrequireedit");
					if oldtxt == "请选择职业" then oldtxt = ""; end;
					
				elseif index == 2 then
					oldtxt = Win_GetText("UI.gameui.updateteamcfgdlg.jobrequireedit");
					if oldtxt == "请选择职业" then oldtxt = ""; end;
				end;
				
				local names, num = GetProfInfo();
				Win_SetValue("UI.gameui.proflistdlg.proflist",num,value_channel_item_num);
				for i=0,num-1 do		
					Win_SetText("UI.gameui.proflistdlg.proflist",names[i+1],value_channel_itemtext,i);
					
					if IsStringInTable(names[i+1], oldtxt) ~= 0 then
						Win_SetValue("UI.gameui.proflistdlg.proflist",i,value_channel_sel);
					end;
					
				end;
			
				end;	
			
			OnSelfHide=function()
				local num,vectxt=Win_GetTable("UI.gameui.proflistdlg.proflist",value_channel_seltext);
				local wholetxt="";
				for i=0,num-1 do
				if i==0 then
				wholetxt=vectxt[i];
				else
				wholetxt=wholetxt..";"..vectxt[i];
				end;
				end;
				
				local index = Win_GetValue("UI.gameui.proflistdlg",value_channel_customindex);
				if index == 1 then
					if wholetxt == "" then wholetxt = "请选择职业"; end;
					Win_SetText("UI.gameui.exteamconfigdlg.jobrequireedit",wholetxt);
				elseif index == 2 then
					if wholetxt == "" then wholetxt = "请选择职业"; end;
					Win_SetText("UI.gameui.updateteamcfgdlg.jobrequireedit",wholetxt);
				end;
				
				end;	
					
			children=
			{
				proflist=
				{
					type="LISTBOX",
					rect={5,3,100,122},
					clientrect={4,1,88,122},					
					style=wgtstyle_vertical+wgtstyle_popup+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_multi_sel,	
												
					itemnum=0,									
					itemheight=20,
					itemwidth=88,
					itemmarginv=0,
					itemmarginh=0,						
					
					itemselback="res/uires/newcommon/checkbox.gsa",
					itemselpos={0,0,0,-1},
					
					textsize=12,
					
					updatemute=1,
										
					OnRClick=function()
						       Win_ShowWidget("UI.gameui.proflistdlg",false);
						       
						        local index = Win_GetValue("UI.gameui.proflistdlg",value_channel_customindex);
							if index == 1 then
								Win_SetFocus("UI.gameui.exteamconfigdlg.jobrequireedit");
							elseif index == 2 then
								Win_SetFocus("UI.gameui.updateteamcfgdlg.jobrequireedit");
							end;
							
						       end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,							
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,	
								};--spindown
								
							};--children
					
						};--scroll
					};
				
				};
			};
		
		};
		
		--"交友",	
		teamdlg=
		{
			type="DIALOG",
			rect={0,0,410,382},
			bkimage="res/uires/teamdlg/teamdlgbk.gsa",
			moveable=1,
						
			--edgethick=4,
			--ajustedge=edge_flag_up+edge_flag_down;
			--ajustflag=rect_flag_window+rect_flag_client;			
			--minheight=374;
			--maxheight=500;
			--edgeup={{17,0},{36,8},{148,10}},
			
			visible=0,
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			
			updatemute=1,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.teamdlg",false);
				end;
				
			OnEdgeAjust=function(x,y,w,h)
				--Win_SetPos("UI.gameui.teamdlg.configbtn",x+8,y+h-53);
				--Win_SetPos("UI.gameui.teamdlg.addbtn",x+135,y+h-81);
				--Win_SetPos("UI.gameui.teamdlg.nameedit",x+19,y+h-75);
				--Win_SetPos("UI.gameui.teamdlg.friendtab.btnpanel",x+48,y+h-56);
				--Win_SetPos("UI.gameui.teamdlg.teamtab.btnpanel",x+48,y+h-56);
				--Win_SetPos("UI.gameui.teamdlg.mastertab.btnpanel",x+48,y+h-56);
				--Win_SetPos("UI.gameui.teamdlg.prenticetab.btnpanel",x+48,y+h-56);
				--Win_SetPos("UI.gameui.teamdlg.filtertab.btnpanel",x+48,y+h-56);
				--Win_SetPos("UI.gameui.teamdlg.teamtab.setbtn",x+9,y+h-52);
				--Win_SetPos("UI.gameui.teamdlg.findbtn",x+9,y+h-35);
				--Win_SetPos("UI.gameui.teamdlg.findteambtn",x+9,y+h-18);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.teamdlg",false);
				end;
			
			OnSelfShow=function()
				PushNewbieTips(38);
				UI.children.gameui.children.teamdlg.UpdateFriendTab();
				UI.children.gameui.children.teamdlg.UpdateTeamTab();
				UI.children.gameui.children.teamdlg.UpdateMasterTab();				
				UI.children.gameui.children.teamdlg.UpdatePrenticeTab();
				UI.children.gameui.children.teamdlg.UpdateLastChatTab();
				UI.children.gameui.children.teamdlg.UpdateFilterTab();
				Win_AlignWidget("UI.gameui.teamdlg","UI.gameui.rightbottomlocalizer",aligntype_winrect,alignstyle_right_in+alignstyle_bottom_in);
				
				Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.setbtn",false);
				local info = TeamGetInfo();
				if info.nmember > 0 then
					if info.isleader ~= 0 then
						Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.setbtn",true);
					end;
				end;
				
				Win_SetFocus("UI.gameui.teamdlg.teamtab", true);
				Win_SetFocus("UI.gameui.teamdlg.friendtab", false);
				Win_SetFocus("UI.gameui.teamdlg.mastertab", false);
				Win_SetFocus("UI.gameui.teamdlg.prenticetab", false);
				Win_SetFocus("UI.gameui.teamdlg.lastchattab", false);
				Win_SetFocus("UI.gameui.teamdlg.filtertab", false);
				
				Win_SetText("UI.gameui.teamdlg.nameedit", "请输入玩家姓名");
				Win_SetValue("UI.gameui.teamdlg.nameedit",GetColorIndex(96,96,96),value_channel_color_draw); 
				Win_SetValue("UI.gameui.teamdlg.nameedit", 0, value_channel_customindex);
	
				end;			
						
			UpdateFriendTab=function()
				local num=GetNumGameBuddy();
				local oldsel=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
				oldsel=0;
				end;
				Win_SetValue("UI.gameui.teamdlg.friendtab.memberlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.teamdlg.friendtab.memberlist",oldsel,value_channel_sel);
				
				Win_EnableWidget("UI.gameui.teamdlg.friendtab.btnpanel.chatbtn",(num>0));
				Win_EnableWidget("UI.gameui.teamdlg.friendtab.btnpanel.delbtn",(num>0));
				end;		
			
			UpdateTeamTab=function()					  
					  
					--得到玩家自己所在队伍信息
					local teaminfo=TeamGetInfo();
					local num=teaminfo.nmember; 					
					local oldsel=Win_GetValue("UI.gameui.teamdlg.teamtab.memberlist",value_channel_sel);
					if (oldsel<0) or (oldsel>=num)  then 
					oldsel=0;
					end;
					Win_SetValue("UI.gameui.teamdlg.teamtab.memberlist",num,value_channel_item_num);
					Win_SetValue("UI.gameui.teamdlg.teamtab.memberlist",oldsel,value_channel_sel);
					
					  
					--没有组队
					if num<1 then
					
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.createbtn",true);
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.dismissbtn",false);
					
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.createbtn",true);					  
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.followbtn",false);
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.leavebtn",false);
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.voicebtn",false);					  
					
					--在队伍之中					  
					else
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.createbtn",false);				  
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.leavebtn",true);					  
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.voicebtn",true);					  
											 
					--是队长
					if teaminfo.isleader~=0 then
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.createbtn",false);
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.dismissbtn",true);
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.followbtn",false);					  
					else 					  
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.createbtn",true);
					Win_ShowWidget("UI.gameui.teamdlg.teamtab.btnpanel.dismissbtn",false);
					Win_EnableWidget("UI.gameui.teamdlg.teamtab.btnpanel.followbtn",true);
					Win_SetCheck("UI.gameui.teamdlg.teamtab.btnpanel.followbtn",IsFollowOther());
					end;
					
					end;
					
					
					end;
			
			UpdatePrenticeTab=function()
				local numPrentice=GetMPItemCount(1);
				local oldsel=Win_GetValue("UI.gameui.teamdlg.prenticetab.memberlist",value_channel_sel);
				if (oldsel<0) or (oldsel>=numPrentice)  then 
					oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.teamdlg.prenticetab.memberlist",numPrentice,value_channel_item_num);
				Win_SetValue("UI.gameui.teamdlg.prenticetab.memberlist",oldsel,value_channel_sel);

				Win_EnableWidget("UI.gameui.teamdlg.prenticetab.btnpanel.chatbtn",(numPrentice>0));				
			end;
				
			UpdateMasterTab=function()
				local numMaster=GetMPItemCount(0);				
				local oldsel=Win_GetValue("UI.gameui.teamdlg.mastertab.memberlist",value_channel_sel);
				if (oldsel<0) or (oldsel>=numMaster)  then 
					oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.teamdlg.mastertab.memberlist",numMaster,value_channel_item_num);
				Win_SetValue("UI.gameui.teamdlg.mastertab.memberlist",oldsel,value_channel_sel);
				
				Win_EnableWidget("UI.gameui.teamdlg.mastertab.btnpanel.thankbtn",(numMaster>0));
				Win_EnableWidget("UI.gameui.teamdlg.mastertab.btnpanel.chatbtn",(numMaster>0));				
			end;
				
			UpdateLastChatTab=function()
				local num=GetLastChatListNum();				
				local oldsel=Win_GetValue("UI.gameui.teamdlg.lastchattab.memberlist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
					oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.teamdlg.lastchattab.memberlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.teamdlg.lastchattab.memberlist",oldsel,value_channel_sel);
				
				Win_EnableWidget("UI.gameui.teamdlg.lastchattab.btnpanel.chatbtn",(num>0));				
			end;
				
			UpdateFilterTab=function()
				local info=FilterGetInfo();
				local num=0;				
				if info~=nil then	
				num=info.nmember;
				end;
				
				local oldsel=Win_GetValue("UI.gameui.teamdlg.filtertab.memberlist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
				oldsel=0;
				end;
				Win_SetValue("UI.gameui.teamdlg.filtertab.memberlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.teamdlg.filtertab.memberlist",oldsel,value_channel_sel);				
				
				Win_EnableWidget("UI.gameui.teamdlg.filtertab.btnpanel.delbtn",(num>0));
				end;
				
						
			
			OnSelfHide=function()
				if Win_IsChecked("UI.gameui.teamdlg.teamtab") then
					RequestNewbieHelp(help_teamdlg_team,0);
				elseif Win_IsChecked("UI.gameui.teamdlg.friendtab") then
					RequestNewbieHelp(help_teamdlg_friend,0);
				elseif Win_IsChecked("UI.gameui.teamdlg.mastertab") then
					RequestNewbieHelp(help_teamdlg_master,0);
				elseif Win_IsChecked("UI.gameui.teamdlg.prenticetab") then
					RequestNewbieHelp(help_teamdlg_family,0);--借用famliy的id，暂时
				elseif Win_IsChecked("UI.gameui.teamdlg.filtertab") then
					RequestNewbieHelp(help_teamdlg_filter,0);
				end;
				end;
				
			children = 
			{		
				--关闭按钮
				minclosebtn = 
				{
					type = "BUTTON",
					rect = { 384,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 321,349,73,28 },
					bkimage="res/uires/teamdlg/closebtn.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 361,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.teamdlg.teamtab") then
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_team,-1);
							end;
						elseif Win_IsChecked("UI.gameui.teamdlg.friendtab") then
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_friend,-1);
							end;
						elseif Win_IsChecked("UI.gameui.teamdlg.mastertab") then
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_master,-1);
							end;
						elseif Win_IsChecked("UI.gameui.teamdlg.prenticetab") then
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_family,-1);
							end;
						elseif Win_IsChecked("UI.gameui.teamdlg.filtertab") then
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_filter,-1);
							end;
						end;
						
						--[[
						local helpid=GetHelpID("好友");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				configbtn = 
				{
					type = "CHECK",
					rect = { 8,321,20,49 },					
					bkimage="res/uires/teamdlg/configbtn.gsa",
					framescheme={{1,1,0,0,1,1,2,2},{0,0,1,1,0,0,2,2}},
					extendstyle=ui_btn_style_none,
					enable=1,
					visible=0,
					
					OnClick=function()
						     if  Win_IsChecked("UI.gameui.teamdlg.configbtn")  then
						     Win_ShowWidget("UI.gameui.friendconfigdlg",true);
						     Win_SetFocus("UI.gameui.friendconfigdlg");
						     else
						     Win_ShowWidget("UI.gameui.friendconfigdlg",false);
						     end;						     
						     end;
				};
				
			
				findbtn= 
				{
					type = "BUTTON",
					rect = { 36,349,101,28 },					
					bkimage="res/uires/teamdlg/findbtn.gsa",
					
					OnClick=function()
						     if  not Win_IsVisible("UI.gameui.nearplayerlistdlg")  then
						     Win_ShowWidget("UI.gameui.nearplayerlistdlg",true);
						     Win_SetFocus("UI.gameui.nearplayerlistdlg");
						     else
						     Win_ShowWidget("UI.gameui.nearplayerlistdlg",false);
						     end;						     
						     end;
				};
				
				findteambtn= 
				{
					type = "BUTTON",
					rect = { 177,349,101,28 },					
					bkimage="res/uires/teamdlg/findteambtn.gsa",
					
					OnClick=function()
						     if  not Win_IsVisible("UI.gameui.findnearteamdlg")  then
						     Win_ShowWidget("UI.gameui.findnearteamdlg",true);
						     Win_SetFocus("UI.gameui.findnearteamdlg");
						     else
						     Win_ShowWidget("UI.gameui.findnearteamdlg",false);
						     end;						     
						     end;
				};
						
						
				addbtn = 
				{
					type = "BUTTON",
					rect = { 275,282,73,28 },					
					bkimage="res/uires/teamdlg/addbtn.gsa",	
					
					OnClick=function()
						name=Win_GetText("UI.gameui.teamdlg.nameedit");
						cursel=Win_GetSelect("UI.gameui.teamdlg",0);
						
						local n = Win_GetValue("UI.gameui.teamdlg.nameedit", value_channel_customindex);
						if n==0 then 
							name="";
						end;
						
						if cursel==0 then
							if name~="" then
								local rst = TeamInvite(name,"邀请您加入队伍!");
								if rst ~= 0 then
									Win_ShowMsgBox("组队请求已经发送！");
								end;
							else
								Win_ShowMsgBox("请您输入队友名称！");		
							end;
						elseif cursel==1 then
							if name~="" then
								Win_SetText("UI.gameui.inputcontentdlg", name, value_channel_customname);
								Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "0");
								Win_SetText("UI.gameui.inputcontentdlg.title", "申请加为好友");
								Win_ShowWidget("UI.gameui.inputcontentdlg", true);
							else
								Win_ShowMsgBox("请您输入好友名称");		
							end;
						elseif cursel==5 then
							if name~="" then
								FilterAddPlayer(name);
							else
								Win_ShowMsgBox("请您输入要屏蔽的玩家名称！");
							end;
						elseif cursel==6 then
							--if name~="" then
								--添加仇人
							--	AddEnemy(name);
							--else
								Win_ShowMsgBox("不支持手动添加仇人！");
							--end;
						end;
					end;						
				};
				
				nameedit=
				{
					type="EDIT",
					rect={33,290,234,12},					
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=24,

					OnGainFocus=function()
						local n = Win_GetValue("UI.gameui.teamdlg.nameedit", value_channel_customindex);
						if n==0 then
							Win_SetText("UI.gameui.teamdlg.nameedit", "");
							Win_SetValue("UI.gameui.teamdlg.nameedit",GetColorIndex(255,255,255),value_channel_color_draw); 
							Win_SetValue("UI.gameui.teamdlg.nameedit", 1, value_channel_customindex);
						end;
					end;
					
					OnLostFocus=function()
						local ctext= Win_GetText("UI.gameui.teamdlg.nameedit");
						if ctext=="" then
							Win_SetText("UI.gameui.teamdlg.nameedit", "请输入玩家姓名");
							Win_SetValue("UI.gameui.teamdlg.nameedit",GetColorIndex(96,96,96),value_channel_color_draw); 
							Win_SetValue("UI.gameui.teamdlg.nameedit", 0, value_channel_customindex);
						end;
					end;
				};
						
				teamtab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={0,-1,51,22},
					tabcover="res/uires/teamdlg/teambtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							if Win_IsVisible("UI.gameui.teamdlg") then
								RequestNewbieHelp(help_teamdlg_team);
							end;
							
							if GetShowTeamExceptCheck() == 0 then
								Win_SetCheck("UI.gameui.teamdlg.teamtab.btnpanel.showteamexceptbtn", false);
							else
								Win_SetCheck("UI.gameui.teamdlg.teamtab.btnpanel.showteamexceptbtn", true);
							end;
						else
							RequestNewbieHelp(help_teamdlg_team,0);
						end;
						end;
											
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_team,
								offsetx=-99,
								offsety=18,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,241,264, 45},	
							updatemute=1,
							
							children=
							{
								createbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/createbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()								    
										    --Win_SetText("UI.gameui.teamconfigdlg.neighboredit","");
										    --Win_ShowWidget("UI.gameui.teamconfigdlg",true);
										    Win_ShowWidget("UI.gameui.exteamconfigdlg",true);
										    end;
									
								},						
								
								dismissbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/dismissbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										Win_ShowMsgBox("您确定要解散队伍吗?","系统消息",ui_msgid_yesno,"UI.gameui.teamdlg.teamtab.btnpanel.dismissbtn");
										end;
									
									OnMsgBoxOk=function()
										TeamDismiss();
										end;
								},
								
								setbtn= 
								{
									type = "BUTTON",
									rect = {60 ,2,70,18 },					
									bkimage="res/uires/teamdlg/setbtn.gsa",
									bkimagepos={1,-1},
									framescheme={{1,1,0,0,1,1,2,2}},
									tiptext="组队设置",
									
									OnClick=function()
										     if  not Win_IsVisible("UI.gameui.updateteamcfgdlg")  then
										     Win_ShowWidget("UI.gameui.updateteamcfgdlg",true);
										     Win_SetFocus("UI.gameui.updateteamcfgdlg");
										     else
										     Win_ShowWidget("UI.gameui.updateteamcfgdlg",false);
										     end;						     
										     end;
								};	

								followbtn = 
								{
									type = "CHECK",
									rect = { 143,2,47,18 },					
									bkimage="res/uires/common/followbtn.gsa",
									framescheme={{1,1,1,1,1,1,2,2},{0,0,0,0,0,0,2,2},},							
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										    FollowTeamLeader();
										    end;
									
								},
								
								voicebtn = 
								{
									type = "BUTTON",
									rect = { 60,2,47,18 },					
									bkimage="res/uires/common/voicebtn.gsa",
									style=wgtstyle_fatherenable,
									framescheme={{1,1,0,0,1,1,2,2}},
									
									--关闭语音系统
									visible=0,
									enable=0,
									
									OnClick=function()
										Win_ToggleWidget("UI.gameui.voicesetdlg",1);
										end;
									
								},
								
								
								leavebtn = 
								{
									type = "BUTTON",
									rect = { 210,2,47,18 },					
									bkimage="res/uires/common/leavebtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										Win_ShowMsgBox("您确定要离开队伍吗?","系统消息",ui_msgid_yesno,"UI.gameui.teamdlg.teamtab.btnpanel.leavebtn");
										end;
									
									OnMsgBoxOk=function()
										TeamLeave();
										end;	    
								},
								
								showteamexceptlabel=
								{
									type="LABEL",
									rect={20, 25, 110, 16},
									bkimage="res/uires/teamdlg/showteamexceptlabel.gsa";
									enable=0;
								};
								
								showteamexceptbtn = 
								{
									type="CHECK",
									rect = { 2, 23, 127, 18 },		
									bkimage="res/uires/newcommon/checkbox.gsa";
									
									OnCheck=function(bcheck)
										OnCheckShowTeamExcept(bcheck);
									end;
								},
							};
						
						};	
						
						memberlist=
						{
							type="LISTBOX",
							rect={3,21,362,190};
							dragtype=ui_drag_type_team,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={24,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							updatemute=1,
							
							
							OnDBClick=function(idx)
								local mateNum=Win_GetValue("UI.gameui.teamdlg.teamtab.memberlist",value_channel_item_num);
								if idx >= 0 and mateNum > 0 then
									local mateInfo=TeamGetMember(idx);
									if mateInfo~=nil then
										if mateInfo.name~="" and mateInfo.name~=g_PlayerInfo.name then
											GossipTalk(mateInfo.name);
										end;
									end;
								end;
							end;
							
							OnRClick=function(idx)
								if idx>=0 then
								matenum=Win_GetValue("UI.gameui.teamdlg.teamtab.memberlist",value_channel_item_num);
																	
								if matenum>0 then									
								local mateinfo=TeamGetMember(idx);
								UI.children.gameui.OnOpenPlayerMenu(mateinfo.name);
								end;
								
								end;
																	
							       end;
								       
							OnValueChange=function(sel)
										local mateinfo=TeamGetMember(sel);
										Win_SetText("UI.gameui.chatbar.inputbar.chateredit",mateinfo.name);
										Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
										end;
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={334,17,20,152},
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
																		
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};		       
						};
										
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							--caption="sex",
							initlayer=10,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
					
						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							--caption="姓名",
							initlayer=10,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						playerlevelbtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/playerlevelbtn.gsa",
							--caption="等级",
							initlayer=10,
							
							OnClick=function()
								end;
						};
						
						profbtn=
						{
							type="BUTTON",
							rect={245,-1,120,21},
							bkimage="res/uires/teamdlg/profbtn.gsa",
							--caption="职业",
							initlayer=10,
							
							OnClick=function()
								end;
						};
						
					};
					
				},
				friendtab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={51,-1,51,22},
					tabcover="res/uires/teamdlg/friendbtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							RequestNewbieHelp(help_teamdlg_friend);
						else
							RequestNewbieHelp(help_teamdlg_friend,0);
						end;
						end;
						
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_friend,
								offsetx=-108,
								offsety=21,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,264,22},	
							updatemute=1,
							
							children=
							{
							
								chatbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/chatbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local bdynum=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_item_num);
										if bdynum>0 then
										local idx=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_sel);
										if idx>=0 then
										local bdyinfo=GetGameBuddy(idx+1);
										if bdyinfo~=nil then
										GossipTalk(bdyinfo.name);
										end;
										end;										
										end;										
										end;
									
								},						
								
								delbtn = 
								{
									type = "BUTTON",
									rect = { 60,2,47,18 },					
									bkimage="res/uires/common/delbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local bdynum=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_item_num);
										if bdynum>0 then
										local idx=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_sel);
										if idx>=0 then
										local bdyinfo=GetGameBuddy(idx+1);
										if bdyinfo~=nil then
										GmBuddyReqRemove(bdyinfo.name);
										end;
										end;
										end;										
										end;
								},
								
							};
						
						};	
						
						

						titlelabel=
						{
							type = "LABEL",
							rect = {243,0,122,19},
							bkimage="res/uires/teamdlg/title2.gsa",
							enable=1,		
							initlayer=0,
							visible = 0,
						};
						
						memberlist=
						{
							type="LISTBOX",
							rect={3,21,362,190};
							dragtype=ui_drag_type_gmbuddy,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;							
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,

							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={24,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",	

							updatemute=1,							
							
							OnDBClick=function(idx)
								local memNum=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_item_num);
								if idx >= 0 and memNum > 0 then
									local bdyInfo=GetGameBuddy(idx+1);
									if bdyInfo~=nil then
										if bdyInfo.name~="" and bdyInfo.name~=g_PlayerInfo.name then
											GossipTalk(bdyInfo.name);
										end;
									end;
								end;
							end;
							
							OnRClick=function(idx)
									if idx>=0 then
										local bdynum=Win_GetValue("UI.gameui.teamdlg.friendtab.memberlist",value_channel_item_num);
									
										if bdynum>0 then									
											local bdyinfo=GetGameBuddy(idx+1);
											if bdyinfo~=nil then
												Win_SetValue("UI.gameui.friendmenudlg",0,value_channel_customtype);
												Win_SetText("UI.gameui.friendmenudlg",bdyinfo.name,value_channel_customname);										
												Win_SetValue("UI.gameui.friendmenudlg",1,value_channel_update_dirty);
												Win_ShowWidget("UI.gameui.friendmenudlg",true);
												Win_SetFocus("UI.gameui.friendmenudlg");
											end;
								        end;

									end;								       
					        end;
								       
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={334,17,20,152},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																		
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};	       
						};
						
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							--caption="sex",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							--caption="姓名",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						playerlevelbtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/playerlevelbtn.gsa",
							--caption="等级",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						playerlhlevelbtn=
						{
							type="BUTTON",
							rect={245,-1,122,21},
							bkimage="res/uires/teamdlg/playerlhlevelbtn.gsa",
							--caption="等级",
							initlayer=1,
							
							OnClick=function()
								end;
						};
					};
				},
				
				mastertab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={102,-1,51,22},
					tabcover="res/uires/teamdlg/masterlistbtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							RequestNewbieHelp(help_teamdlg_master);
						else
							RequestNewbieHelp(help_teamdlg_master,0);
						end;
						end;
						
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_master,
								offsetx=-87,
								offsety=11,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,264,22},	
							updatemute=1,
							
							children=
							{
							
								chatbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/chatbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local bdynum=Win_GetValue("UI.gameui.teamdlg.mastertab.memberlist",value_channel_item_num);
										if bdynum>0 then
											local idx=Win_GetValue("UI.gameui.teamdlg.mastertab.memberlist",value_channel_sel);
											if idx>=0 then
												local bdyinfo=GetMPItem(0,idx);
												if bdyinfo~=nil then
													GossipTalk(bdyinfo.name);
												end;
											end;										
										end;										
										end;
									
								},						
								
								thankbtn= 
								{
									type = "BUTTON",
									rect = { 60,2,47,18 },					
									bkimage="res/uires/common/thankbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										OweMaster();										
										end;
								},
							};
						
						};	
						
						
						
						memberlist=
						{
							type="LISTBOX",
							rect={3,21,362,190};
							dragtype=ui_drag_type_masterlist,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;							
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,
																					
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={24,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",	

							updatemute=1,							
							
							OnDBClick=function(idx)
								local bdyInfo=GetMPItem(0,idx);
								if bdyInfo~=nil then
									if bdyInfo.name~="" and bdyInfo.name~=g_PlayerInfo.name then
										GossipTalk(bdyInfo.name);
									end;
								end;
							end;
							
							OnRClick=function(idx)
								local bdyinfo=GetMPItem(0,idx);
								if bdyinfo~=nil then
									Win_SetText("UI.gameui.mastermenudlg",bdyinfo.name,value_channel_customname);									
								
									Win_ShowWidget("UI.gameui.mastermenudlg.thankbtn",CanOweMaster(bdyinfo.name));												
									menutype=GetMasterMenuType(bdyinfo.name);												
									Win_ShowWidget("UI.gameui.mastermenudlg.kickprentice",(menutype==3));	
									Win_ShowWidget("UI.gameui.mastermenudlg.kickmaster",(menutype==2));
									Win_ShowWidget("UI.gameui.mastermenudlg.betraymaster",((menutype==2) or (menutype==4)));
								
									Win_SetValue("UI.gameui.mastermenudlg",1,value_channel_update_dirty);
									Win_ShowWidget("UI.gameui.mastermenudlg",true);
									Win_SetFocus("UI.gameui.mastermenudlg");
								end;						       
								end;													
								       
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={334,17,20,152},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																		
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};	       
						};
						
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							--caption="sex",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							--caption="姓名",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						playerlevelbtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/playerlevelbtn.gsa",
							--caption="等级",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
						profbtn=
						{
							type="BUTTON",
							rect={245,-1,120,21},
							bkimage="res/uires/teamdlg/profbtn.gsa",
							--caption="职业",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
					};
				},
				
				prenticetab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={153,-1,51,22},
					tabcover="res/uires/teamdlg/prenticelistbtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							RequestNewbieHelp(help_teamdlg_family);
						else
							RequestNewbieHelp(help_teamdlg_family,0);
						end;
						end;
						
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_family,
								offsetx=-88,
								offsety=9,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,264,22},	
							updatemute=1,
							
							children=
							{
							
								chatbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/chatbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local bdynum=Win_GetValue("UI.gameui.teamdlg.prenticetab.memberlist",value_channel_item_num);
										if bdynum>0 then
											local idx=Win_GetValue("UI.gameui.teamdlg.prenticetab.memberlist",value_channel_sel);
											if idx>=0 then
												local bdyinfo=GetMPItem(1,idx);
												if bdyinfo~=nil then
													GossipTalk(bdyinfo.name);
												end;
											end;										
										end;										
										end;
									
								},
								
								personbtn= 
								{
									type = "BUTTON",
									rect = { 60,-3,73,30 },					
									bkimage="res/uires/teamdlg/personbtn.gsa",
									style=wgtstyle_fatherenable,
									
									OnClick=function()
											QueryPrenticeStat();
										end;
								},								
							};
						
						};	
						
						memberlist=
						{
							type="LISTBOX",
							rect={3,21,362,190};
							dragtype=ui_drag_type_prenticelist,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;							
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,
																					
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={24,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",	

							updatemute=1,							
							
							OnDBClick=function(idx)
								local bdyInfo=GetMPItem(1,idx);
								if bdyInfo~=nil then
									if bdyInfo.name~="" and bdyInfo.name~=g_PlayerInfo.name then
										GossipTalk(bdyInfo.name);
									end;
								end;
							end;
							
							OnRClick=function(idx)
								local bdyinfo=GetMPItem(1,idx);
								if bdyinfo~=nil then
									Win_SetText("UI.gameui.mastermenudlg",bdyinfo.name,value_channel_customname);									
								
									Win_ShowWidget("UI.gameui.mastermenudlg.thankbtn",CanOweMaster(bdyinfo.name));												
									menutype=GetMasterMenuType(bdyinfo.name);
									Win_ShowWidget("UI.gameui.mastermenudlg.kickprentice",(menutype==3));	
									Win_ShowWidget("UI.gameui.mastermenudlg.kickmaster",(menutype==2));
									Win_ShowWidget("UI.gameui.mastermenudlg.betraymaster",((menutype==2) or (menutype==4)));
								
									Win_SetValue("UI.gameui.mastermenudlg",1,value_channel_update_dirty);
									Win_ShowWidget("UI.gameui.mastermenudlg",true);
									Win_SetFocus("UI.gameui.mastermenudlg");
								end;						       
							end;	
								       
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={334,17,20,152},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																		
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};	       
						};
						
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							--caption="sex",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};

						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							--caption="姓名",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						playerlevelbtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/playerlevelbtn.gsa",
							--caption="等级",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
						profbtn=
						{
							type="BUTTON",
							rect={245,-1,120,21},
							bkimage="res/uires/teamdlg/profbtn.gsa",
							--caption="职业",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
					};
				},
				
			
				lastchattab=	--最近
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={204,0,51,22},
					tabcover="res/uires/teamdlg/latelybtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							RequestNewbieHelp(help_teamdlg_filter);
						else
							RequestNewbieHelp(help_teamdlg_filter,0);
						end;
						end;
					
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_filter,
								offsetx=-116,
								offsety=197,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,264,22},	
							updatemute=1,
							
							children=
							{
							
								chatbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/chatbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local bdynum=Win_GetValue("UI.gameui.teamdlg.lastchattab.memberlist",value_channel_item_num);
										if bdynum>0 then
											local idx=Win_GetValue("UI.gameui.teamdlg.lastchattab.memberlist",value_channel_sel);
											if idx>=0 then
												local name=GetLastChatListPlayer(idx);
												if name~=nil then
													GossipTalk(name);
												end;
											end;										
										end;										
										end;
									
								},						
							};
						
						};	
						
						memberlist=
						{
							type="LISTBOX",
							rect={3,21,362,190};
							dragtype=ui_drag_type_lastchatplayer,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={0,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",	

							updatemute=1,
							
							OnSelfShow=function()
								local num = GetLastChatListNum();
								Win_SetValue("UI.gameui.teamdlg.lastchattab.memberlist",num,value_channel_item_num);
								Win_SetValue("UI.gameui.teamdlg.lastchattab.memberlist",0,value_channel_sel);
							end;
							
							OnRClick=function(idx)
								Win_SetValue("UI.gameui.teamdlg.lastchattab.memberlist",idx,value_channel_sel);
								UI.children.gameui.OnOpenPlayerMenu(GetLastChatListPlayer(idx));
							end;
							
							OnDBClick=function(idx)
								local name=GetLastChatListPlayer(idx);
								if name~=nil then
									if name~="" and name~=g_PlayerInfo.name then
										GossipTalk(name);
									end;
								end;
							end;

							OnValueChange=function(idx)
										
								if idx>=0 then
								local num=Win_GetValue("UI.gameui.teamdlg.lastchattab.memberlist",value_channel_item_num);
																	
								if num>0 then	
								local name=GetLastChatListPlayer(idx);
								Win_SetText("UI.gameui.teamdlg.nameedit",name);
								end;
								
								end;
																	
							        end;
									
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={334,15,20,152},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=16,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
																		
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};		       
						};
						
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							initlayer=1,
							
							OnClick=function()
								end;
						};

						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
						activitybtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/activitybtn.gsa",
							initlayer=1,
							
							OnClick=function()
								end;
						};
						
						timebtn=
						{
							type="BUTTON",
							rect={245,-1,120,21},
							bkimage="res/uires/teamdlg/timebtn.gsa",
							initlayer=1,
							
							OnClick=function()
								end;
						};
					};
				},
				
				filtertab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={255,-1,51,22},
					tabcover="res/uires/teamdlg/filterbtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=5,
					tabstop=5,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							Win_SetValue("UI.gameui.teamdlg.enemytab", 0, value_channel_customtype);
							RequestNewbieHelp(help_teamdlg_filter);
						else
							RequestNewbieHelp(help_teamdlg_filter,0);
						end;
						end;
					
					children=
					{	
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_teamdlg_filter,
								offsetx=-116,
								offsety=197,
							},
							
						};
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,264,22},	
							updatemute=1,
							
							children=
							{
								delbtn = 
								{
									type = "BUTTON",
									rect = { 2,2,47,18 },					
									bkimage="res/uires/common/delbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local idx=Win_GetValue("UI.gameui.teamdlg.filtertab.memberlist",value_channel_sel);
										if idx>=0 then
										local filternum=Win_GetValue("UI.gameui.teamdlg.filtertab.memberlist",value_channel_item_num);
																			
										if filternum>0 then									
										local filterinfo=FilterGetMember(idx);
										FilterDelPlayer(filterinfo.name);
										end;
										
										end;
										end;
								},
								
							};
						
						};	
						
						memberlist=
						{
							type="LISTBOX",
							rect={4,4,362,210};
							dragtype=ui_drag_type_filterlist,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemdrawback="res/uires/teamdlg/itembk.gsa",	
							itemdrawpos={0,22,0,0},
							itemselback="res/uires/teamdlg/itemsel.gsa",	
							itemselpos={24,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",	

							updatemute=1,
															       
							OnValueChange=function(idx)
										
								if idx>=0 then
								local filternum=Win_GetValue("UI.gameui.teamdlg.filtertab.memberlist",value_channel_item_num);
																	
								if filternum>0 then									
								local filterinfo=FilterGetMember(idx);
								Win_SetText("UI.gameui.teamdlg.nameedit",filterinfo.name);
								end;
								
								end;
																	
							        end;
									
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={334,15,20,171},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=16,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
																		
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};		       
						};
					};
					
				},
				
				-- 仇人列表
				enemytab=
				{
					type="TABWIN",
					rect={33,66,367,211},	
					tabrect={306,-1,51,22},
					tabcover="res/uires/teamdlg/enemytab.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=6,
					tabstop=6,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
									
					OnCheck=function(bcheck)
						local bChecked = Win_GetValue("UI.gameui.teamdlg.enemytab", value_channel_customtype);
						if bcheck ~= 0 and bChecked ==0 then
							if Win_GetValue("UI.gameui.teamdlg.enemytab", value_channel_customid) == 0 then
								QryEnemy();
								Win_SetValue("UI.gameui.teamdlg.enemytab",  1, value_channel_customid);
							end;
							
							local bEnabled = IsDisableEnemyList();
							Win_SetCheck("UI.gameui.teamdlg.enemytab.check",  bEnabled);
							
							local num = GetNumOfEnemy();
							Win_SetValue("UI.gameui.teamdlg.enemytab.enemylist", num, value_channel_item_num);
							
							Win_SetValue("UI.gameui.teamdlg.enemytab", 1, value_channel_customtype);
						end;
					end;
					
					children=
					{	
						check= 
						{
							type = "CHECK",
							rect={244,253,100,20};
							captionrect={20,0,80,20};
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							bkimage = "res/uires/newcommon/checkbox.gsa",
							visible=1,
							initlayer=2;
							caption="不记录仇人",
							
							OnCheck=function(bcheck)		
								DisableEnemyList(bcheck);
							end;	
						},
						
						btnpanel=
						{
							type="WIDGET",
							rect={0,251,150,22},	
							updatemute=1,
							
							children=
							{
								selectallbtn=
								{
									type="BUTTON",
									rect={2,2,47,18 },
									bkimage="res/uires/teamdlg/selallbtn.gsa",
									framescheme={{0,0,1,1,0,0,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local numEnemy=Win_GetValue("UI.gameui.teamdlg.enemytab.enemylist", value_channel_item_num);
										for i=0,numEnemy-1 do
											Win_SetCheck("UI.gameui.teamdlg.enemytab.enemylist.enemy"..i..".check", true);
										end;
									end;
								};
						
								delbtn = 
								{
									type = "BUTTON",
									rect = {60,2,47,18 },					
									bkimage="res/uires/common/delbtn.gsa",
									framescheme={{1,1,0,0,1,1,2,2}},
									style=wgtstyle_fatherenable,
									
									OnClick=function()
										local delCount = 0;
										local delList = "";
										local numEnemy=Win_GetValue("UI.gameui.teamdlg.enemytab.enemylist", value_channel_item_num);
										if numEnemy ~= 0 then
											for i=0,numEnemy-1 do
												if  Win_IsChecked("UI.gameui.teamdlg.enemytab.enemylist.enemy"..i..".check") then
													delCount = delCount + 1;
													delList = delList..i..',';
												end;
											end;										
										end;

										if delCount ~= 0 then
											DelEnemy(delList);
										else
											Win_ShowMsgBox("请选择要删除的仇人。","系统消息",ui_msgid_affirm,"UI.gameui.teamdlg.enemytab.btnpanel.delbtn");
										end;
									end;
								},
								
							};
						
						};	

						
						sexbtn=
						{
							type="BUTTON",
							rect={0,0,25,19},
							bkimage="res/uires/teamdlg/sexbtn.gsa",
							--caption="sex",
							initlayer=1,
							
							OnClick=function()
								--SetFamilyDetailSortType(0);
								end;
						};
						
						namebtn=
						{
							type="BUTTON",
							rect={25,-1,140,21},
							bkimage="res/uires/teamdlg/namebtn.gsa",
							initlayer=10,
							
							OnClick=function()
								end;
						};
						
						playerlevelbtn=
						{
							type="BUTTON",
							rect={165,-1,81,21},
							bkimage="res/uires/teamdlg/playerlevelbtn.gsa",
							initlayer=10,
							
							OnClick=function()
								end;
						};
						
						profbtn=
						{
							type="BUTTON",
							rect={245,-1,120,21},
							bkimage="res/uires/teamdlg/profbtn.gsa",
							initlayer=10,
							
							OnClick=function()
							end;
						};
						
						enemylist=
						{
							type="WIDGETLIST",
							rect={10,21,355,180},	
							style=wgtstyle_clipchild_window+wgtstyle_vertical,	
							dragindex=-1,
							--marginv=0,
							itemmarginh=0,
							itemmarginv=0,
							primaryscroll="UI.gameui.teamdlg.enemytab.vscroll",
							
							template={"res/uires/enemy.lua"};
							
							children={},
						},--list
						
						vscroll=
						{
							type="SCROLLBAR",
							rect={345,40,20,150},	
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=16,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							
							buddywidget="UI.gameui.teamdlg.enemytab.enemylist",
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				},
			},
		};

		voicesetdlg=
		{
			type="DIALOG",
			rect={0,0,267,191},
			captionrect={54,10,158,12},
			textsize=12,
			textfont=1,			
			caption="队伍通话设置",						
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,				
			bkimage="res/uires/teamdlg/voicesetdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnOk=function()
				local mictimer=Win_GetValue("UI.gameui.voicesetdlg.Timerslider",value_channel_pos);
				ChangeTeamParam(mictimer);
				StartTeamTalk();
				end;
			
			OnSelfShow=function()
				local mictimer=GetTeamParam();
				
				Win_SetText("UI.gameui.voicesetdlg.Timerlabel",mictimer);
				Win_SetValue("UI.gameui.voicesetdlg.Timerslider",mictimer,value_channel_pos);
				
				local teaminfo=TeamGetInfo();		
				Win_EnableWidget("UI.gameui.voicesetdlg.Timerslider",teaminfo.isleader);
				
				local bvoice=((teaminfo.isleader)and(not(IsInTeamTalk())));
				Win_ShowWidget("UI.gameui.voicesetdlg.voicebtn",bvoice);
				Win_ShowWidget("UI.gameui.voicesetdlg.affirmbtn",(not bvoice));				
				 
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={239,6,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 220,6,20,19},
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("队伍通话设置界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={172,165,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
				};	
				
				affirmbtn=
				{
					type="BUTTON",
					rect={41,165,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					visible=0,					
				};
				
				voicebtn=
				{
					type="BUTTON",
					rect={31,165,90,22},
					bkimage="res/uires/teamdlg/voicebtn.gsa",
					defaultok=1,				
				};	
				
				
				Timerlabel=
				{
					type="LABEL",
					rect={35,74,32,12},				
					textsize=12,
				};
				
				Timerslider=
				{
			
					type="SCROLLBAR",
					rect={95,72,148,14};									
					range={30,120},
					pagesize=4,
					visible=1,	
					
					OnValueChange=function(pos)
						Win_SetText("UI.gameui.voicesetdlg.Timerlabel",pos);
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,31,16},	
							bkimage="res/uires/sysoption/blockbtn.gsa",
							bkimagepos={0,2},
							framescheme={{0,0,0,1},{0,0,0,1}};
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
																
							
						};--blockbtn
										
						
					};--children
					
				};--scroll
				
			};			
		};
		
		--摆摊查询界面，add by abrahamhu 2008-08-12
		shopquerydlg=
		{
			type="DIALOG",
			rect={50,100,550,424},
			bkimage="res/uires/shopquerydlg/shopquery.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			moveable=1,
			updatemute=1,
			--initlayer=0,
			visible=0,
			
			OnSelfShow=function()
				--Win_ShowWidget("UI.gameui.shopquerydlg.notesdlg",true);
				--Win_SetValue("UI.gameui.shopquerydlg.notesdlg",5,value_channel_timerspace);
				--Win_SetFocus("UI.gameui.shopquerydlg.notesdlg");
				--Win_EnableWidget("UI.gameui.shopquerydlg.notesdlg.okbtn",false);
				
				Win_SetText("UI.gameui.shopquerydlg.queryedit", "");
				Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", false);
				Win_ShowWidget("UI.gameui.shopquerydlg.querytree", true);
				Win_SetValue("UI.gameui.shopquerydlg.querytree", -1, value_channel_sel);
				Win_ExtendTreeCtrl("UI.gameui.shopquerydlg.querytree", 0);
				SetShopQuerySortType(0);
				Win_EnableWidget("UI.gameui.shopquerydlg.moneybtn", false);
				Win_SetValue("UI.gameui.shopquerydlg.moneybtn", -1, value_channel_customid);
				Win_EnableWidget("UI.gameui.shopquerydlg.levelbtn", false);
				Win_SetValue("UI.gameui.shopquerydlg.levelbtn", -1, value_channel_customid);
				Win_EnableWidget("UI.gameui.shopquerydlg.serverbtn", false);
				Win_SetValue("UI.gameui.shopquerydlg.serverbtn", -1, value_channel_customid);
				Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", false);
				Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", false);
				Win_SetText("UI.gameui.shopquerydlg.pageedit", "");
				Win_SetText("UI.gameui.shopquerydlg.pagelabel", "");
				Win_SetValue("UI.gameui.shopquerydlg.resultlist",0,value_channel_item_num);
				Win_SetValue("UI.gameui.shopquerydlg.querybtn",-1,value_channel_timerspace);
				--Win_SetFocus("UI.gameui.shopquerydlg.queryedit");
				
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				ResetShopQueryData();
				EndShop();
				LockPlayer(0);
			end;
			
			OnOk=function()
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.shopquerydlg", false);
			end;
			
			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 521,25,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 498,25,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				--[[
				notesdlg=
				{
					type="LABEL";
					rect={0,0,549,420},
					bkimage="res/uires/shopquerydlg/notes.gsa",
					moveable=0,
					--initlayer=1,
					visible=1,
					updatemute=1,
					
					--accel=
					--{
						--{"UI.children.newresetsecudlg.OnAccel_Tab",9},
						
						--{"UI.children.newresetsecudlg.OnAccel_OnLeft",37},--left 		
						--{"UI.children.newresetsecudlg.OnAccel_OnRight",39},--right
					--};

					--OnAccel_Tab=function()
						--return 0;
					--end;

					--OnAccel_OnLeft=function()
						--return 0;
					--end;
					--OnAccel_OnRight=function()
						--return 0;
					--end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopquerydlg.notesdlg",-1,value_channel_timerspace);
						Win_EnableWidget("UI.gameui.shopquerydlg.notesdlg.okbtn",true);

					end;
					
					children=
					{
						okbtn=
						{	
							type="BUTTON",
							rect={261,325,69,24},
							bkimage="res/uires/sysdlg/affirmbtn.gsa",
							visible=1,
							soundid={1005},
							enable=0;

							OnClick=function()
								Win_ShowWidget("UI.gameui.shopquerydlg.notesdlg",false);
							end;
						},
					};
					
				};
				--]]
				
				--搜索栏
				queryedit=
				{
					type="EDIT",
					rect={57,77,130,12},
					editmethod=ui_editmethod_chinese+ui_editmethod_english+ui_editmethod_number+ui_editmethod_symbol,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxchar=16,
					
					--重载OnPaste()函数,防止CTRL+C拷贝
					OnPaste=function()
					end;
					
					OnEnter = function()
						if Win_IsEnabled("UI.gameui.shopquerydlg.querybtn") then
							UI.children.gameui.children.shopquerydlg.children.querybtn.OnClick();
							Win_SetFocus("UI.gameui.shopquerydlg.queryedit");
						end;
					end;
				};
				
				--搜索
				querybtn=
				{
					type="BUTTON",
					rect={190,73,42,20},
					bkimage="res/uires/shopquerydlg/query.gsa",
					
					OnClick=function()
						Win_SetValue("UI.gameui.shopquerydlg.querybtn",6,value_channel_timerspace);
						Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", false);
						Win_EnableWidget("UI.gameui.shopquerydlg.moneybtn", false);
						Win_SetValue("UI.gameui.shopquerydlg.moneybtn", -1, value_channel_customid);
						Win_EnableWidget("UI.gameui.shopquerydlg.levelbtn", false);
						Win_SetValue("UI.gameui.shopquerydlg.levelbtn", -1, value_channel_customid);
						Win_EnableWidget("UI.gameui.shopquerydlg.serverbtn", false);
						Win_SetValue("UI.gameui.shopquerydlg.serverbtn", -1, value_channel_customid);
						Win_EnableWidget("UI.gameui.shopquerydlg.pageupbtn", false);
						Win_EnableWidget("UI.gameui.shopquerydlg.pagedownbtn", false);
						Win_SetText("UI.gameui.shopquerydlg.pagelabel", "");
						SetShopQueryState(0);
						ResetShopQueryData();
						Win_SetValue("UI.gameui.shopquerydlg.resultlist",0,value_channel_item_num);
						StartShopQuery(Win_GetText("UI.gameui.shopquerydlg.queryedit"), Win_GetValue("UI.gameui.shopquerydlg.querytree", value_channel_sel));
					end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopquerydlg.querybtn",-1,value_channel_timerspace);
						if Win_GetValue("UI.gameui.shopquerydlg.querytree", value_channel_sel) ~= -1 then
							Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", true);
						else 
							Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", false);
						end;
					end;
				};
				
				--价格排序
				moneybtn=
				{
					type="BUTTON",
					rect={245,59,20,19},
					bkimage="res/uires/shopquerydlg/money.gsa",
					tiptext="点击按价格排序",
					
					OnClick=function()
						if Win_GetValue("UI.gameui.shopquerydlg.moneybtn", value_channel_customid) == -1 then
							Win_SetValue("UI.gameui.shopquerydlg.moneybtn", 0, value_channel_customid);
							SetShopQuerySortType(1);
						elseif Win_GetValue("UI.gameui.shopquerydlg.moneybtn", value_channel_customid) == 0 then
							Win_SetValue("UI.gameui.shopquerydlg.moneybtn", 1, value_channel_customid);
							SetShopQuerySortType(2);
						elseif Win_GetValue("UI.gameui.shopquerydlg.moneybtn", value_channel_customid) == 1 then
							Win_SetValue("UI.gameui.shopquerydlg.moneybtn", 0, value_channel_customid);
							SetShopQuerySortType(1);
						end;
					end;
				};
				
				--等级排序
				levelbtn=
				{
					type="BUTTON",
					rect={269,59,20,19},
					bkimage="res/uires/shopquerydlg/level.gsa",
					tiptext="点击按需要等级排序",
					
					OnClick=function()
						if Win_GetValue("UI.gameui.shopquerydlg.levelbtn", value_channel_customid) == -1 then
							Win_SetValue("UI.gameui.shopquerydlg.levelbtn", 0, value_channel_customid);
							SetShopQuerySortType(3);
						elseif Win_GetValue("UI.gameui.shopquerydlg.levelbtn", value_channel_customid) == 0 then
							Win_SetValue("UI.gameui.shopquerydlg.levelbtn", 1, value_channel_customid);
							SetShopQuerySortType(4);
						elseif Win_GetValue("UI.gameui.shopquerydlg.levelbtn", value_channel_customid) == 1 then
							Win_SetValue("UI.gameui.shopquerydlg.levelbtn", 0, value_channel_customid);
							SetShopQuerySortType(3);
						end;
					end;
				};
				
				--服务器排序
				serverbtn=
				{
					type="BUTTON",
					rect={293,59,20,19},
					bkimage="res/uires/shopquerydlg/server.gsa",
					tiptext="点击按所在线排序",
					
					OnClick=function()
						if Win_GetValue("UI.gameui.shopquerydlg.serverbtn", value_channel_customid) == -1 then
							Win_SetValue("UI.gameui.shopquerydlg.serverbtn", 0, value_channel_customid);
							SetShopQuerySortType(5);
						elseif Win_GetValue("UI.gameui.shopquerydlg.serverbtn", value_channel_customid) == 0 then
							Win_SetValue("UI.gameui.shopquerydlg.serverbtn", 1, value_channel_customid);
							SetShopQuerySortType(6);
						elseif Win_GetValue("UI.gameui.shopquerydlg.serverbtn", value_channel_customid) == 1 then
							Win_SetValue("UI.gameui.shopquerydlg.serverbtn", 0, value_channel_customid);
							SetShopQuerySortType(5);
						end;
					end;
				};
				
				--上页
				pageupbtn=
				{
					type="BUTTON",
					rect={356,59,42,20},
					bkimage="res/uires/shopquerydlg/pageup.gsa",
					
					OnClick=function()
						ShopQueryPageUp();
					end;
				};
				
				--当前页
				pageedit=
				{
					type="EDIT",
					rect={408,62,25,12},
					editmethod=ui_editmethod_number,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxchar=3,
					
					OnEnter = function()
						local page = tonumber(Win_GetText("UI.gameui.shopquerydlg.pageedit"));
						ShopQueryPageGoto(page);
					end;
				};
				
				pagelabel=
				{
					type="LABEL",
					rect={436,58,25,20};
					textsize=12;
				};
				
				--下页
				pagedownbtn=
				{
					type="BUTTON",
					rect={461,59,42,20},
					bkimage="res/uires/shopquerydlg/pagedown.gsa",
					
					OnClick=function()
						ShopQueryPageDown();
					end;
				};
				
				--查询树
				querytree=
				{
					type="TREECTRL",
					rect={55,120,171,286},
					style=wgtstyle_clipself,
					dragtype=ui_drag_type_shopquery,
					mousedelta=30,
					
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnSelfShow=function()
						Win_SetFocus("UI.gameui.shopquerydlg.querytree");
					end;

					OnValueChange=function(sel, oldsel)
						if Win_GetValue("UI.gameui.shopquerydlg.querytree", value_channel_sel) ~= -1
						and Win_GetValue("UI.gameui.shopquerydlg.querybtn",value_channel_timerspace) == -1 then
							Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", true);
						else 
							Win_EnableWidget("UI.gameui.shopquerydlg.querybtn", false);
						end;
						Win_SetFocus("UI.gameui.shopquerydlg.queryedit");
						--Win_SetFocus("UI.gameui.shopquerydlg.notesdlg");
					end;
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={161,16,20,251},					
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
												
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
						};--scroll
					};
				};
				
				--查询结果物品列表
				resultlist=
				{
					type="WIDGETLIST",
					rect={247,84,255,294},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_shopqueryshowlist,
					dragindex=-1,
					primaryscroll="UI.gameui.shopquerydlg.resultscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/shopqueryl.lua"};
					
					children={},
				},--list
				
				resultscroll=
				{
			
					type="SCROLLBAR",
					rect={509,103,20,256},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.shopquerydlg.resultlist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
			
				goldlabel=
				{
					type="LABEL",
					rect={288,396,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={324,396,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={360,396,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				weightlabel=
				{
					type="LABEL",
					rect={439,396,72,12},						
					textsize=12,
					enable=1,
				},
			};
		};
		
		tradedlg=
		{
			type="DIALOG",
			rect={184,48,620,500},				
			bkimage="res/uires/tradedlg/tradedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.tradedlg","UI.gameui",aligntype_winrect,alignstyle_hcenter+alignstyle_vcenter);
				--处理滚动条变短产生的不同步问题
				Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
			end;
				
			OnSelfHide=function()
				Win_ShowWidget("UI.gameui.tradedlg.weaponbtn", false);
				Win_ShowWidget("UI.gameui.tradedlg.dressbtn", false);
				Win_ShowWidget("UI.gameui.tradedlg.othersbtn", false);
				Win_ShowWidget("UI.gameui.tradedlg.jewelrybtn", false);	
				Win_ShowWidget("UI.gameui.tradedlg.regoldbtn", false);
				Win_ShowWidget("UI.gameui.tradedlg.goldbtn", false);				
			end;
					  
			OnOk=function()
				  ConfirmShopSale(); 
				  end;
				  
			OnCancel=function()
				  CancelShopSale(); 
				  end;
				  
			OnMsgBoxOk=function()
				 ConfirmShopSale();
			end;

				  
			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 590,23,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 568,23,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("Npc商店界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				weaponbtn=
				{
					type="CHECK",
					rect={31,70,28,51},					
					bkimage="res/uires/tradedlg/weaponbtn.gsa",
					tiptext="武器",
					groupid=0,
					groupstop=0,
					visible=0,
					extendstyle=ui_btn_style_radio,

					OnCheck=function(bcheck)
						if bcheck == 1 then
							UpdateBuyList(1);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},
				
				dressbtn=
				{
					type="CHECK",
					rect={31,120,28,51},					
					bkimage="res/uires/tradedlg/dressbtn.gsa",
					tiptext="服装",
					groupid=0,
					groupstop=1,
					visible=0,
					extendstyle=ui_btn_style_radio,
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							UpdateBuyList(2);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},
				
				othersbtn=
				{
					type="CHECK",
					rect={31,170,28,51},					
					bkimage="res/uires/tradedlg/othersbtn.gsa",
					tiptext="防具",
					groupid=0,
					groupstop=2,
					visible=0,
					extendstyle=ui_btn_style_radio,

					OnCheck=function(bcheck)
						if bcheck == 1 then
							UpdateBuyList(3);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},
				
				jewelrybtn=
				{
					type="CHECK",
					rect={31,220,28,51},					
					bkimage="res/uires/tradedlg/jewelrybtn.gsa",
					tiptext="首饰",
					groupid=0,
					groupstop=3,
					visible=0,
					extendstyle=ui_btn_style_radio,

					OnCheck=function(bcheck)
						if bcheck == 1 then
							UpdateBuyList(4);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},
				
				--金票购买
				regoldbtn=
				{
					type="CHECK",
					rect={31,154,28,85},					
					bkimage="res/uires/tradedlg/regoldbtn.gsa",
					tiptext="可以用金票购买",
					groupid=0,
					groupstop=5,
					visible=0,
					extendstyle=ui_btn_style_radio,

					OnCheck=function(bcheck)
						if bcheck == 1 then
							ClearNpcShop();
							UpdateBuyList(5);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},
				
				--金币购买
				goldbtn=
				{
					type="CHECK",
					rect={31,70,28,85},					
					bkimage="res/uires/tradedlg/goldbtn.gsa",
					tiptext="只能用金币购买",
					groupid=0,
					groupstop=4,
					visible=0,
					extendstyle=ui_btn_style_radio,
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							ClearNpcShop();
							UpdateBuyList(6);
							Win_SetValue("UI.gameui.tradedlg.leftscroll",0,value_channel_pos);
						end;
					end;
				},

				tradebtn = 
				{
					type = "BUTTON",
					rect = {335,462,86,24},
					bkimage="res/uires/tradedlg/tradebtn.gsa",
					
					OnClick=function()
						--Win_ShowMsgBox("此交易不是在大额交易平台上产生的，有可能被拔回,确定需要购买吗?","系统消息",ui_msgid_yesno,"UI.gameui.tradedlg");
						local npcstate,npcdata = GetNPCState();
						if npcstate == 3 and npcdata == 66 then
							--Win_ShowMsgBox("此交易不是在大额交易平台上产生的，有可能被拔回,确定需要购买吗?","系统消息",ui_msgid_notes,"UI.gameui.tradedlg");
							ConfirmShopSale();
						else
							ConfirmShopSale();
						end;
					end;
				},
				
				clearbtn = 
				{
					type = "BUTTON",
					rect = {428,462,86,24},
					bkimage="res/uires/tradedlg/clearbtn.gsa",
					
					OnClick=function()
						    ClearNpcShop();
						    end;

					
				},
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = {520,462,86,24},
					bkimage="res/uires/tradedlg/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				},
				
				repairallbtn = 
				{
					type = "BUTTON",
					rect = {56,462,86,24},
					bkimage="res/uires/tradedlg/repairall.gsa",
					soundid={1001},
					tiptext = "花费一定的金币修理身上的全部装备，要消耗装备的耐久哦。";
					
					OnClick=function()
						RepairItem(2);
						end;
				},
				
				repairspecialbtn = 
				{
					type = "BUTTON",
					rect = {149,462,86,24},
					bkimage="res/uires/tradedlg/repairspecial.gsa",
					soundid={1001},
					tiptext = "花费更多的金币对单件装备进行特殊修理，不会消耗装备的耐久。";
					
					OnClick=function()
						RepairItem(1);
						end;
					
				},
				
				repairbtn = 
				{
					type = "BUTTON",
					rect = {242,462,86,24},
					bkimage="res/uires/tradedlg/repairbtn.gsa",
					soundid={1001},
					tiptext = "花费少量的金币对单件装备进行一般修理，会消耗装备的耐久。";
					
					OnClick=function()
						RepairItem(0);
						end;
				},			
				
				buylabel=
				{
					type="LABEL",
					rect={24,27,40,23},
					bkimage="res/uires/tradedlg/buylabel.gsa",
					framescheme={{0},{1},{2}},
					enable=0,					
				};
				
				leftlabel=
				{
					type="LABEL",
					rect={100,27,200,16},
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					enable=0,
				};
				
				rightlabel=
				{
					type="LABEL",
					rect={350,27,200,16},
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					enable=0,
				};
				
				taxrate=
				{
					type="LABEL",
					rect={32,28,25,25},
					drawcolor={255,255,255,255},
					textsize=12,
					textfont=1,
					textstyle=dt_center+dt_vcenter,
					richmode=ui_richmode_font+ui_richmode_color,		
					tiptext="当日税率",
				};
				
				goldedit=
				{
					type="LABEL",
					rect={399,408,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,
					enable=0,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={435,408,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={471,408,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				regoldedit=
				{
					type="LABEL",
					rect={399,432,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,
					enable=0,					
				},
				
				resilveredit=
				{
					type="LABEL",
					rect={435,432,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				recopperedit=
				{
					type="LABEL",
					rect={471,432,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				weightedit=
				{
					type="LABEL",
					rect={533,428,72,12},						
					textsize=12,
					enable=0,
				},
				
				--商品
				goldlabel=
				{
					type="LABEL",
					rect={399,350,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					richmode=ui_richmode_color,
					textsize=12,
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={435,350,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={471,350,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				regoldlabel=
				{
					type="LABEL",
					rect={399,376,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/gold.gsa",
					richmode=ui_richmode_color,
					textsize=12,
					enable=0,					
				},
				
				resilverlabel=
				{
					type="LABEL",
					rect={435,376,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/silver.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				recopperlabel=
				{
					type="LABEL",
					rect={471,376,36,12},
					captionrect={12,0,24,12},
					bkimage="res/uires/common/copper.gsa",
					richmode=ui_richmode_color,
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				weightlabel=
				{
					type="LABEL",
					rect={545,371,48,12},						
					textsize=12,
					enable=0,
				},
				
				leftlist=
				{
					type="WIDGETLIST",
					rect={61,52,250,398},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_buylist,
					dragindex=-1,
					primaryscroll="UI.gameui.tradedlg.leftscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/tradeiteml.lua"};
					
					children={},
					
				},--list
				
				leftscroll=
				{
			
					type="SCROLLBAR",
					rect={307,70,20,361},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.tradedlg.leftlist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				rightlist=
				{
					type="WIDGETLIST",
					rect={338,51,248,277},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_selbuylist,
					dragindex=-1,
					primaryscroll="UI.gameui.tradedlg.rightscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/tradeitemr.lua"};
					
					children={},
					
				},--list
				
				rightscroll=
				{
			
					type="SCROLLBAR",
					rect={584,70,20,239},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.tradedlg.rightlist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			},
		
		};
		
		dealdlg=
		{
			
			type="DIALOG",
			rect={0,0,502,297},
			bkimage="res/uires/dealdlg/dealdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			moveable=1,
			visible=0,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.dealdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				SetGlobalQuery(GlobalQuery_PlayerDeal,1);
				
				--[[local v = GetVipInfo();
				if v.RealVip==1 then
					Win_ShowWidget("UI.gameui.dealdlg.peerinfobtn",true);
				else
					Win_ShowWidget("UI.gameui.dealdlg.peerinfobtn",false);
				end;]]
				Win_ShowWidget("UI.gameui.dealdlg.peerinfobtn",true);
				local name=Win_GetText("UI.gameui.dealdlg.chargelabel");
				ShowEquipOther(name);
			end;
			
			OnSelfHide=function()
				 CancelDeal();
				 Win_CancelDrag();
				 SetGlobalQuery(GlobalQuery_PlayerDeal,0);

				Win_ShowWidget("UI.gameui.dealdlg.peerinfobtn",false);
				 end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.dealdlg",false);
				end;
			OnMsgBoxOk=function()
				local gold=Win_GetValue("UI.gameui.dealdlg.goldedit");
				local silver=Win_GetValue("UI.gameui.dealdlg.silveredit");
				local copper=Win_GetValue("UI.gameui.dealdlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				LockDealItem(money);
			end;
				
			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 475,33,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,	
					soundid={1001},	
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 453,33,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("交易界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				--自己头像
				playericon=
				{
					type="WIDGET",
					rect={4,7,48,48},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_head,
					customtype=0,
					initlayer=0;
					enable=0;					
				};
				--高光显示圈
				headlgithicon=
				{
					type="WIDGET",
					rect={4,-9,57,70},
					bkimage="res/uires/dealdlg/headlight.gsa",
					enable=0,		
					updatemute=100,
					initlayer=1;
					visible=1;
				};
				
				--对方头像
				dealericon=
				{
					type="WIDGET",
					rect={241,6,48,48},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_head,	
					customtype=1,
					initlayer=0;
					enable=0;					
				};		
				--高光显示圈
				headlgithicon2=
				{
					type="WIDGET",
					rect={241,-10,57,70},
					bkimage="res/uires/dealdlg/headlight.gsa",
					enable=0,		
					updatemute=1,
					initlayer=101;
					visible=1;
				};		
				
				
				offerlabel=
				{
					type="LABEL",
					rect={79,37,136,16},					
					textsize=14,
					textfont=1,
					drawcolor={230,190,61,255},
					enable=0,										
				},

				chargelabel=
				{
					type="LABEL",
					rect={309,37,126,16},	
					textsize=14,
					textfont=1,
					drawcolor={230,190,61,255},
					enable=0,
				},
				
				g1=
				{
					type="LABEL",
					rect={39,61,12,12},
					bkimage="res/uires/common/gold.gsa",
					enable=1;
				};
				
				goldedit=
				{
					type="EDIT",
					rect={57,61,50,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=9999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.dealdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.dealdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.dealdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.dealdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.dealdlg.silveredit");
						   end;
					
					
				},
				
				s1=
				{
					type="LABEL",
					rect={113,61,12,12},
					bkimage="res/uires/common/silver.gsa",
					enable=1;
				};
				
				silveredit=
				{
					type="EDIT",
					rect={132,61,50,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.dealdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.dealdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.dealdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.dealdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.dealdlg.copperedit");
						   end;					
					
				},
				
				c1=
				{
					type="LABEL",
					rect={188,61,12,12},
					bkimage="res/uires/common/copper.gsa",
					enable=1;
				};
				
				copperedit=
				{
					type="EDIT",
					rect={205,61,50,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					maxvalue=999,
					minvalue=0,
					
					OnValueChange=function()
						
						local gold=Win_GetValue("UI.gameui.dealdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.dealdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.dealdlg.copperedit");
						local total=gold*1000000+silver*1000+copper;
						local money=GetMoney();
						
						if total>money then
						gold=math.floor(money/1000000);
						silver=math.floor((money-gold*1000000)/1000);
						copper=money-gold*1000000-silver*1000;												
						Win_SetValue("UI.gameui.dealdlg.goldedit",gold,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.silveredit",silver,value_channel_pos);
						Win_SetValue("UI.gameui.dealdlg.copperedit",copper,value_channel_pos);
						end;
								
						end;
						
					OnTab=function()
						   Win_SetFocus("UI.gameui.dealdlg.goldedit");
						   end;	
				},
				
				goldlabel=
				{
					type="LABEL",
					rect={295,61,50,12},
					captionrect={12,0,38,12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={363,61,50,12},
					captionrect={12,0,38,12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={430,61,50,12},
					captionrect={12,0,38,12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				agreebtn=
				{
					type="BUTTON",
					rect={179,265,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",					
					soundid={1005},
					
					OnClick=function()
						 --Win_ShowMsgBox("此交易不是在安全交易平台上产生的，有可能被拔回,确定需要交易吗?","系统消息",ui_msgid_notes,"UI.gameui.dealdlg");
						local gold=Win_GetValue("UI.gameui.dealdlg.goldedit");
						local silver=Win_GetValue("UI.gameui.dealdlg.silveredit");
						local copper=Win_GetValue("UI.gameui.dealdlg.copperedit");
						local money=gold*1000000+silver*1000+copper;
						LockDealItem(money);
						    end;
				},
				
				
				dealbtn=
				{
					type="BUTTON",
					rect={275,265,69,24},
					bkimage="res/uires/dealdlg/dealokbtn.gsa",					
					
					OnClick=function()
						CompleteDeal();
						end;
				},
				
				peerinfobtn=
				{
					type="BUTTON",
					rect={349,265,69,24},
					bkimage="res/uires/dealdlg/peerinfobtn.gsa",
					coverpic = "res/uires/dealdlg/highlight.gsa",
					coverpicpos={-5,-5,16,16},
					
					__b_showeff = false;
					
					OnSelfShow = function()
						Win_SetValue("UI.gameui.dealdlg.peerinfobtn",1,value_channel_timerspace);
					end;
					OnSelfHide = function()
						Win_SetValue("UI.gameui.dealdlg.peerinfobtn",-1,value_channel_timerspace);
					end;
					OnTimer = function()
						local b = UI.children.gameui.children.dealdlg.children.peerinfobtn.__b_showeff;
						if b then
							Win_SetCoverPic("UI.gameui.dealdlg.peerinfobtn","res/uires/dealdlg/highlight.gsa");
						else
							Win_SetCoverPic("UI.gameui.dealdlg.peerinfobtn","");
						end;
						UI.children.gameui.children.dealdlg.children.peerinfobtn.__b_showeff = not b;
						Win_SetValue("UI.gameui.dealdlg.peerinfobtn",0.5,value_channel_timerspace);
					end;
					OnClick = function()
						local name=Win_GetText("UI.gameui.dealdlg.chargelabel");
						ShowEquipOther(name);
					end;
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={424,265,69,24},
					bkimage="res/uires/newcommon/closebtn.gsa",	
					defaultcancel=1,	
					soundid={1001},					
				},
				
				
				offerlist=
				{
					type="LISTBOX",
					rect={42,86,211,170},																											
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=20,	
					dragtype=ui_drag_type_deal_mine,
					
					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},
					itemfocuscolor={0,0,255,255},	
					tipwidget="UI.gameui.ScrnTooltip",					
				},
				
				chargelist=
				{
					type="LISTBOX",
					rect={278,86,211,170},																											
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=20,	
					dragtype=ui_drag_type_deal_other,
					
					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},
					itemfocuscolor={0,0,255,255},	
					tipwidget="UI.gameui.ScrnTooltip",
				},
			},
		};

	
		---caption="我的技能",
		skilldlg=
		{
			type = "DIALOG",
			rect={0,0,523,491},
			bkimage="res/uires/skilldlg/skilldlgbk.gsa",
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,		
			
			dragindex=-1,
			dragtype=ui_drag_type_skill_main,
			itemdragflag=-1,
			mornitor={value_channel_dragging},			
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnUpdate=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep803");
				UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep803");
				end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.skilldlg",false);
				end;
				
			OnSelfShow=function()
				PushNewbieTips(39);
				Win_SetValue("UI.gameui.skilldlg",-1,value_channel_customindex);
				Win_SelectSelf("UI.gameui.skilldlg.tab0");
				if Win_IsVisible("UI.gameui.skilldlg.tab0") then
				Win_SetFocus("UI.gameui.skilldlg.tab0");
				end;
				
				BeginStudy();
				UI.children.gameui.OnSkillUpdate();
				
				local bCheck = GetSuitSkillLock();
				Win_SetCheck("UI.gameui.skilldlg.tab2.skillcontain.allskills.skilllockcheck", (bCheck~=0));
				
				if Win_IsVisible("UI.gameui.studydlg") then
				Win_ShowWidget("UI.gameui.studydlg",false);
				end;
				Win_AlignWidget("UI.gameui.skilldlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				
				RequestNewbieHelp(help_skilldlg);
				QueryNewbieNextStep(803);
				
				
				Win_ShowWidget("UI.gameui.skilldlg.godstepdlg", true);
				Win_AlignWidget("UI.gameui.skilldlg.godstepdlg","UI.gameui.skilldlg",aligntype_winrect,alignstyle_top_in+alignstyle_left_in,300,15);
				Win_ShowWidget("UI.gameui.skilldlg.opengodstepskillbtn", false);
				Win_ShowWidget("UI.gameui.skilldlg.closegodstepskillbtn", true);
				
				Win_SelectSelf("UI.gameui.skilldlg.godstepdlg.tab0");
				
				UI.children.gameui.OnGodPanelUpdate();
				
				--for i=1,8 do
				--Win_ShowWidget("UI.gameui.skilldlg.godstepdlg.god"..i,true);
				--end;
				
				SetGlobalQuery(GlobalQuery_StudySkill,1);
				
				end;
				
			OnSelfHide=function()
				RequestNewbieHelp(help_skilldlg,0);
				SetGlobalQuery(GlobalQuery_StudySkill,0);
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep803");
				UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep803");
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				  
			OnCancel=function()
				       Win_ShowWidget("UI.gameui.skilldlg",false);
				       end;
						
			children=
			{				
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_skilldlg,
						offsetx=-85,
						offsety=83,
					},
					
				};
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 274,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_skilldlg,-1);
						--[[
						local helpid=GetHelpID("技能栏界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				opengodstepskillbtn=
				{
					type = "BUTTON",
					rect = {206,429,90,30 },
					bkimage="res/uires/xianjie/popxianjiebtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.skilldlg.godstepdlg", true);
						Win_AlignWidget("UI.gameui.skilldlg.godstepdlg","UI.gameui.skilldlg",aligntype_winrect,alignstyle_top_in+alignstyle_left_in,300,15);
						Win_ShowWidget("UI.gameui.skilldlg.opengodstepskillbtn", false);
						Win_ShowWidget("UI.gameui.skilldlg.closegodstepskillbtn", true);
					end;
				};
				
				
				closegodstepskillbtn=
				{
					type = "BUTTON",
					rect = {206,429,90,30 },
					bkimage="res/uires/xianjie/closexianjiebtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.skilldlg.godstepdlg", false);
						Win_ShowWidget("UI.gameui.skilldlg.opengodstepskillbtn", true);
						Win_ShowWidget("UI.gameui.skilldlg.closegodstepskillbtn", false);
					end;
				};
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = { 206,457,90,28 },
					bkimage="res/uires/skilldlg/closebtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				usedpointslabel=
				{
					type="LABEL",
					rect= {128,464,80,12},
					textsize=12,
					caption="0",
					visible=1,
				},
				
				pointlabel=
				{
					type="LABEL",
					rect={128,441,80,12},						
					textsize=12,
					caption="0",
					enable=1,
				},
				
				skillfire= 
				{
					type = "LABEL",
					rect = { 123,440,16,16 },
					effectpic="res/uires/common/skillfire.gsa",
					effectpicpos={-5,-15},
					drawflag=drawflag_draw_effect,
				},

				godstepdlg=
				{
					type = "DIALOG",
					rect = { 299, 15, 250, 449},
					bkimage="res/uires/xianjie/mygodbk.gsa",
					bkimagepos = {0,0},
					visible=1;
					style=wgtstyle_topmost+wgtstyle_alphawin,
					
					
					OnCancel=function()
						Win_ShowWidget("UI.gameui.skilldlg.godstepdlg",false);
						Win_ShowWidget("UI.gameui.skilldlg.opengodstepskillbtn", true);
						Win_ShowWidget("UI.gameui.skilldlg.closegodstepskillbtn", false);
				        end;
					
					OnMsgBoxOk=function()
						LevelUpGodStep();
					end;

					children=
					{
						--关闭按钮
						closebtn = 
						{
							type = "BUTTON",
							rect = { 223,5,22,23 },
							bkimage="res/uires/newcommon/miniclose.gsa",
							defaultcancel=1,
						},
						
						--剩余仙力点数
						reservepointlabel=
						{
							type="LABEL",
							rect={99,303,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},

						--本系投入点数
						setpointlabel=
						{
							type="LABEL",
							rect={119,326,36,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--当前仙阶
						currentgodsteplabel=
						{
							type="LABEL",
							rect={74,347,60,12},						
							textsize=12,
							caption="",
							enable=1,
						},
						
						--天地灵气
						linqipointlabel=
						{
							type="LABEL",
							rect={72,369,60,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--老君金丹
						laojunpointlabel=
						{
							type="LABEL",
							rect={195,369,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--体质
						healthabel=
						{
							type="LABEL",
							rect={46,405,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--力量
						strengthlabel=
						{
							type="LABEL",
							rect={126,405,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--智慧
						intelligencelabel=
						{
							type="LABEL",
							rect={203,405,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--敏捷
						agilelabel=
						{
							type="LABEL",
							rect={46,423,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--精神
						spiritlabel=
						{
							type="LABEL",
							rect={126,423,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						--灵巧
						linqiaolabel=
						{
							type="LABEL",
							rect={203,423,48,12},						
							textsize=12,
							caption="0",
							enable=1,
						},
						
						updategodstepbtn = 
						{
							type = "BUTTON",
							rect = { 149,301,90,30 },
							bkimage="res/uires/xianjie/upgradexianjiebtn.gsa",
							soundid={1007},
							
							OnClick=function()
							local canLevel = CanGodLevelUp();
							local status = GetGodLevelUpCondition();
							
							if status.currentrolegodlevel == 15 then
								Win_ShowMsgBox("已升到顶级仙阶!");
							else
								local money = status.needmoney;
								local god = math.floor(status.needmoney / 1000000);
								local silver = math.floor((status.needmoney - god * 1000000) / 1000);
								local boddy = status.needmoney - god * 1000000 - silver * 1000;
								local moneystr = ",需要金钱";
								if god >0 then
									moneystr = moneystr..god.."金";
		 						end;
								
								if silver > 0 then
									moneystr = moneystr..silver.."银";
								end;
								 
								if boddy >0 then
									moneystr = moneystr..boddy.."铜";
								end;
								local outstr = "升至"..status.levelname.."需要灵气"..status.linqi..",金丹"..status.jindan..",人物等级"..status.rolelevel..moneystr;
								
								if canLevel == 1 then
									outstr = outstr..".您是否提升?";
									Win_ShowMsgBox(outstr,"系统消息",ui_msgid_yesno,"UI.gameui.skilldlg.godstepdlg");
								else
									outstr = outstr..".您尚未达到条件，请继续努力!"
									Win_ShowMsgBox(outstr);
								end;
							end;
							end;
						},
						
						
						resetxianjieskillbtn=
						{
							type = "BUTTON",
							rect = { 149,333,90,30 },
							bkimage="res/uires/xianjie/resetxianjieskillbtn.gsa",
							soundid={1007},	
							
							OnClick=function()
								local canlevelup = CanResetGodStepSkill();
								
								if canlevelup == 1 then
								    Win_ShowMsgBox("您真的要重置仙阶技能吗?","系统消息",ui_msgid_yesno,"UI.gameui.skilldlg.godstepdlg.resetxianjieskillbtn");
								elseif canlevelup == 2 then
								    Win_ShowMsgBox("您已开启家族第二个奇门技能栏，如果重置仙阶技能，将会强制关闭该技能栏，是否重置?","系统消息",ui_msgid_yesno,"UI.gameui.skilldlg.godstepdlg.resetxianjieskillbtn");
								else
								    Win_ShowMsgBox("重置仙阶技能需要秘之幻镜!");
								end;
							end;
							
							OnMsgBoxOk=function()
								ResetGodStepLevel();
							end;
						},
						
						tab0=
						{
							type="TABWIN",
							rect={12,50,226,243},							
							tabrect={0,0,63,22},
							tabcover="res/uires/xianjie/xianjieprofession.gsa",
							tabwintype=tabwin_type_up,
							groupid=0,
							groupstop=0,
							tabstop=0,
							soundid={1003},
							checked=0,
							visible=1,
							updatemute=1,
							style=wgtstyle_ajustfollow+wgtstyle_alphawin,
							ajustflag=rect_flag_window+rect_flag_client;
					
							dragindex=-1,
							dragtype=ui_drag_type_godstep_skill_profession,
							itemdragflag=-1,
							
							OnCheck=function(bcheck)
									if bcheck==1 then
									local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0",value_channel_customtype);
									local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0",value_channel_customid);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgtype,value_channel_customtype);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgindex,value_channel_customid);
									UI.children.gameui.OnSkillUpdate();
									UI.children.gameui.OnGodPanelUpdate();
								end;
							end;
							
							children=
							{
								skillcontain=
								{
									type = "WIDGETLIST",
									rect = { 0,0,226,243 },
									style=wgtstyle_clipchild_window,
									
									children=
									{
										allskills=
										{
											type = "WIDGET",
											rect = { 0,0,226,243 },										
											style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
											--custombuffer=custom_buffer_skilltree,
											updatemute=1,
											
											children=
											{
												skill1=
												{
													type = "WIDGET",
													rect = { 10,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill1",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill1",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill1",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill2=
												{
													type = "WIDGET",
													rect = { 184,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill2",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill2",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill2",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill3=
												{
													type = "WIDGET",
													rect = { 10,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill3",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill3",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill3",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill4=
												{
													type = "WIDGET",
													rect = { 184,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill4",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill4",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill4",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											
												skill5=
												{
													type = "WIDGET",
													rect = { 10,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill5",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill5",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill5",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill6=
												{
													type = "WIDGET",
													rect = { 184,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill6",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill6",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill6",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill7=
												{
													type = "WIDGET",
													rect = { 10,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill7",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill7",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill7",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill8=
												{
													type = "WIDGET",
													rect = { 184,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill8",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill8",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill8",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill9=
												{
													type = "WIDGET",
													rect = { 10,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill9",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill9",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill9",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill10=
												{
													type = "WIDGET",
													rect = { 184,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill10",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill10",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill10",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill11=
												{
													type = "WIDGET",
													rect = { 54,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill11",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill11",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill11",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill12=
												{
													type = "WIDGET",
													rect = { 140,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill12",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill12",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill12",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill13=
												{
													type = "WIDGET",
													rect = { 54,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill13",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill13",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill13",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill14=
												{
													type = "WIDGET",
													rect = { 140,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill14",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill14",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill14",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											
												skill15=
												{
													type = "WIDGET",
													rect = { 54,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill15",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill15",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill15",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill16=
												{
													type = "WIDGET",
													rect = { 140,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill16",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill16",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill16",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill17=
												{
													type = "WIDGET",
													rect = { 54,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill17",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill17",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill17",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill18=
												{
													type = "WIDGET",
													rect = { 140,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill18",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill18",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill18",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill19=
												{
													type = "WIDGET",
													rect = { 54,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill19",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill19",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill19",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill20=
												{
													type = "WIDGET",
													rect = { 140,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill20",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skil20",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab0.skillcontain.allskills.skill20",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
											},
										},
								        },
								},
							},
						},
						
						tab1=
						{
							type="TABWIN",
							rect={12,50,226,243},							
							tabrect={64,0,63,22},
							tabcover="res/uires/xianjie/xianjietongyuongbtn.gsa",
							tabwintype=tabwin_type_up,
							groupid=0,
							groupstop=1,
							tabstop=1,
							soundid={1003},
							--checked=0,
							visible=1,
							updatemute=1,
							dragindex=-1,
							dragtype=ui_drag_type_godstep_skill_common,
							itemdragflag=-1,
							style=wgtstyle_ajustfollow+wgtstyle_alphawin,
							ajustflag=rect_flag_window+rect_flag_client;
							
							OnCheck=function(bcheck)

								if bcheck==1 then
									local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1",value_channel_customtype);
									local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1",value_channel_customid);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgtype,value_channel_customtype);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgindex,value_channel_customid);
									UI.children.gameui.OnSkillUpdate();
									UI.children.gameui.OnGodPanelUpdate();
								end;
							end;
							
							children=
							{
								skillcontain=
								{
									type = "WIDGETLIST",
									rect = { 0,0,226,243 },
									style=wgtstyle_clipchild_window,
									
									children=
									{
										allskills=
										{
											type = "WIDGET",
											rect = { 0,0,226,243 },										
											style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
											--custombuffer=custom_buffer_godskilltree,
											updatemute=1,
											
											children=
											{
												skill1=
												{
													type = "WIDGET",
													rect = { 10,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
													
											
													children=
													{
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill1",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill1",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill1",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill2=
												{
													type = "WIDGET",
													rect = { 184,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill2",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill2",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill2",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill3=
												{
													type = "WIDGET",
													rect = { 10,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill3",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill3",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill3",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill4=
												{
													type = "WIDGET",
													rect = { 184,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill4",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill4",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill4",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											
												skill5=
												{
													type = "WIDGET",
													rect = { 10,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill5",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill5",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill5",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill6=
												{
													type = "WIDGET",
													rect = { 184,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill6",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill6",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill6",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill7=
												{
													type = "WIDGET",
													rect = { 10,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill7",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill7",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill7",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill8=
												{
													type = "WIDGET",
													rect = { 184,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill8",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill8",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill8",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill9=
												{
													type = "WIDGET",
													rect = { 10,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill9",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill9",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill9",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill10=
												{
													type = "WIDGET",
													rect = { 184,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill10",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill10",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill10",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill11=
												{
													type = "WIDGET",
													rect = { 54,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill11",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill11",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill11",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill12=
												{
													type = "WIDGET",
													rect = { 140,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill12",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill12",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill12",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill13=
												{
													type = "WIDGET",
													rect = { 54,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill13",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill13",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill13",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill14=
												{
													type = "WIDGET",
													rect = { 140,54,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill14",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill14",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill14",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											
												skill15=
												{
													type = "WIDGET",
													rect = { 54,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill15",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill15",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill15",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill16=
												{
													type = "WIDGET",
													rect = { 140,101,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill16",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill16",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill16",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill17=
												{
													type = "WIDGET",
													rect = { 54,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill17",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill17",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill17",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												skill18=
												{
													type = "WIDGET",
													rect = { 140,148,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill18",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill18",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill18",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill19=
												{
													type = "WIDGET",
													rect = { 54,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill19",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill19",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill19",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill20=
												{
													type = "WIDGET",
													rect = { 140,195,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill20",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skill20",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab1.skillcontain.allskills.skil20",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											},
										},
								        },
								},
							},
						},
						
						tab2=
						{
							type="TABWIN",
							rect={12,50,226,243},							
							tabrect={128,0,82,22},
							tabcover="res/uires/xianjie/xianjiexianfabtn.gsa",
							tabwintype=tabwin_type_up,
							groupid=0,
							groupstop=2,
							tabstop=2,
							soundid={1003},
							--checked=0,
							visible=1,
							updatemute=1,
							style=wgtstyle_ajustfollow+wgtstyle_alphawin,
							ajustflag=rect_flag_window+rect_flag_client;
					
							dragindex=-1,
							dragtype=ui_drag_type_godstep_skill_xianfa,
							itemdragflag=-1,
							
							OnCheck=function(bcheck)
									if bcheck==1 then
									local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customtype);
									local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2",value_channel_customid);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgtype,value_channel_customtype);
									Win_SetValue("UI.gameui.skilldlg.godstepdlg",dgindex,value_channel_customid);
									UI.children.gameui.OnSkillUpdate();
									UI.children.gameui.OnGodPanelUpdate();
								end;
							end;
							
							children=
							{
								skillcontain=
								{
									type = "WIDGETLIST",
									rect = { 0,0,226,243 },
									style=wgtstyle_clipchild_window,
									
									children=
									{
										allskills=
										{
											type = "WIDGET",
											rect = { 0,0,226,243 },										
											style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
											updatemute=1,
											
											children=
											{
												skill1=
												{
													type = "WIDGET",
													rect = { 10,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
													
											
													children=
													{
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill1",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill1",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill1",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												
												
												skill2=
												{
													type = "WIDGET",
													rect = { 53,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill2",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill2",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill2",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill3=
												{
													type = "WIDGET",
													rect = { 96,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill3",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill3",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill3",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill4=
												{
													type = "WIDGET",
													rect = { 139,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill4",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill4",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill4",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
												
												skill5=
												{
													type = "WIDGET",
													rect = { 182,7,36,36 },
													bkimage="res/uires/skilldlg/skillrect.gsa";
													bkimagepos={-3,-3},
													framescheme={{0},{1}},
													style=wgtstyle_renderitem,
													tipwidget="UI.gameui.ScrnTooltip",
													dragtype=-1,
													dragindex=-1,
													visible=0,
													updatemute=1,
											
													children=
													{
											
														upgradebtn= 
														{
															type = "BUTTON",
															rect = { -9,25,22,19 },
															bkimage="res/uires/newcommon/plusbtn.gsa",	
															tiptext="学习",
															updatemute=1,
													
															OnClick=function()
																local dgtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill5",value_channel_dragtype);
																local dgindex = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill5",value_channel_dragindex);
																--if dgtype==ui_drag_type_skill_life then
																--dgindex = dgindex+1;
																--end;
														
																local customtype = Win_GetValue("UI.gameui.skilldlg.godstepdlg.tab2.skillcontain.allskills.skill5",value_channel_customtype);
																if customtype==0 then
																SkillLearn(dgtype,dgindex);
																else
																SkillUpgrade(dgtype,dgindex);
																end;
														
															end;
														},
												
													},
												},
											},
										},
									},
								},
							},
						},
					
						god1=
						{
							type="WIDGET",
							rect={15,50,223,20},
							bkimage="res/uires/xianjie/god01.gsa",
							visible=0,
							updatemute=1,
						},
						
						god2=
						{
							type="WIDGET",
							rect={15,70,223,15},
							bkimage="res/uires/xianjie/god02.gsa",
							visible=0,
							updatemute=1,
						},
						
						god3=
						{
							type="WIDGET",
							rect={15,85,223,16},
							bkimage="res/uires/xianjie/god03.gsa",
							visible=0,
							updatemute=1,
						},
						
						god4=
						{
							type="WIDGET",
							rect={15,101,223,16},
							bkimage="res/uires/xianjie/god04.gsa",
							visible=0,
							updatemute=1,
						},
						
						god5=
						{
							type="WIDGET",
							rect={15,117,223,16},
							bkimage="res/uires/xianjie/god05.gsa",
							visible=0,
							updatemute=1,
						},
						
						god6=
						{
							type="WIDGET",
							rect={15,133,223,16},
							bkimage="res/uires/xianjie/god06.gsa",
							visible=0,
							updatemute=1,
						},
						
						god7=
						{
							type="WIDGET",
							rect={15,149,223,16},
							bkimage="res/uires/xianjie/god07.gsa",
							visible=0,
							updatemute=1,
						},
						
						god8=
						{
							type="WIDGET",
							rect={15,165,223,16},
							bkimage="res/uires/xianjie/god08.gsa",
							visible=0,
							updatemute=1,
						},
						
						god9=
						{
							type="WIDGET",
							rect={15,181,223,14},
							bkimage="res/uires/xianjie/god09.gsa",
							visible=0,
							updatemute=1,
						},
						
						god10=
						{
							type="WIDGET",
							rect={15,195,223,16},
							bkimage="res/uires/xianjie/god10.gsa",
							visible=0,
							updatemute=1,
						},
						
						god11=
						{
							type="WIDGET",
							rect={15,211,223,15},
							bkimage="res/uires/xianjie/god11.gsa",
							visible=0,
							updatemute=1,
						},
						
						god12=
						{
							type="WIDGET",
							rect={15,226,223,16},
							bkimage="res/uires/xianjie/god12.gsa",
							visible=0,
							updatemute=1,
						},
						
						god13=
						{
							type="WIDGET",
							rect={15,242,223,16},
							bkimage="res/uires/xianjie/god13.gsa",
							visible=0,
							updatemute=1,
						},
						
						god14=
						{
							type="WIDGET",
							rect={15,258,223,15},
							bkimage="res/uires/xianjie/god14.gsa",
							visible=0,
							updatemute=1,
						},
						
						god15=
						{
							type="WIDGET",
							rect={15,273,223,15},
							bkimage="res/uires/xianjie/god15.gsa",
							visible=0,
							updatemute=1,
						},
						
						
					},
				},
				
				tab0=
				{
					type="TABWIN",
					rect={36,66,251,362},							
					tabrect={0,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					checked=0,
					visible=0,
					updatemute=1,
					
					dragindex=-1,
					dragtype=ui_drag_type_skill_main,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0",value_channel_customid);
						Win_SetValue("UI.gameui.skilldlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.skilldlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.skilldlg",value_channel_customindex);
						if stop ~= 0 then
						Win_SetValue("UI.gameui.skilldlg",0,value_channel_customindex);
						UI.children.gameui.OnSkillUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.skilldlg.tab0.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										infolabel=
										{
											type = "LABEL",
											rect = { 18,70,190,40 },
											caption="尚未就职，无可用主修技能!",
											textsize=12,											
											visible=0,
											updatemute=1,
										},
										
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
										
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab0.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.skilldlg.tab0.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
				tab1=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={84,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					visible=0,
					updatemute=1,
					
					dragindex=-1,
					dragtype=ui_drag_type_skill_main,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1",value_channel_customid);
						Win_SetValue("UI.gameui.skilldlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.skilldlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.skilldlg",value_channel_customindex);
						if stop ~= 1 then
						Win_SetValue("UI.gameui.skilldlg",1,value_channel_customindex);
						UI.children.gameui.OnSkillUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.skilldlg.tab1.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										infolabel=
										{
											type = "LABEL",
											rect = { 18,70,190,40 },
											caption="尚未就职，无可用辅修技能!",
											textsize=12,											
											visible=0,
											updatemute=1,
										},	
										
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab1.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.skilldlg.tab1.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
				tab2=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={168,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					visible=0,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2",value_channel_customid);
						Win_SetValue("UI.gameui.skilldlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.skilldlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.skilldlg",value_channel_customindex);
						if stop ~= 2 then
						Win_SetValue("UI.gameui.skilldlg",2,value_channel_customindex);
						UI.children.gameui.OnSkillUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.skilldlg.tab2.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
										
									children=
									{
										suitskillbk=
										{
											type = "WIDGET",
											rect = { 2,77,199,24 },
											bkimage="res/uires/skilldlg/suitskillbk.gsa";
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=1,
											updatemute=1,
										},	

										usesuitskillbk=
										{
											type = "WIDGET",
											rect = { 27,152,97,13 },
											bkimage="res/uires/skilldlg/usesuitskill.gsa";
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=1,
											initlayer=1;
											updatemute=1,
										},
										
										skilllockcheck= 
										{
											type = "CHECK",
											rect={7,149,120,20};
											textsize=12,
											textstyle=dt_left,
											bkimage = "res/uires/newcommon/checkbox.gsa",
											visible=1,
											initlayer=2;
											
											OnCheck=function(bcheck)									   
												LockSuitSkill(bcheck);
												end;				
										},										
																			
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill1",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill2",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill3",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill4",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill5",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill6",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill7",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill8",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill9",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill10",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill11",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill12",value_channel_dragindex);
													--	if dgtype==ui_drag_type_skill_life then
													--	dgindex = dgindex+1;
													--	end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,											
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab2.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.skilldlg.tab2.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
				tab3=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={250,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					visible=0,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3",value_channel_customid);
						Win_SetValue("UI.gameui.skilldlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.skilldlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.skilldlg",value_channel_customindex);
						if stop ~= 3 then
						Win_SetValue("UI.gameui.skilldlg",3,value_channel_customindex);
						UI.children.gameui.OnSkillUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.skilldlg.tab3.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.skilldlg.tab3.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.skilldlg.tab3.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
			};
		};

		-- npc对话学习
		studydlg=
		{
			type = "DIALOG",
			rect={0,0,303,491},
			bkimage="res/uires/skilldlg/skilldlgbk.gsa",
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose+ wgtstyle_alphawin,
			visible=0,			
			
			dragindex=-1,
			dragtype=ui_drag_type_skill_main,
			itemdragflag=-1,
			
			updatemute=1,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.studydlg",false);
				end;
				
			OnSelfShow=function()
				LockPlayer(1);
				PushNewbieTips(39);
				Win_SetValue("UI.gameui.studydlg",-1,value_channel_customindex);
				Win_SelectSelf("UI.gameui.studydlg.tab0");
				if Win_IsVisible("UI.gameui.studydlg.tab0") then
				Win_SetFocus("UI.gameui.studydlg.tab0");
				end;
				
				UI.children.gameui.OnLearnUpdate();
				
				local bCheck = GetSuitSkillLock();
				Win_SetCheck("UI.gameui.studydlg.tab2.skillcontain.allskills.skilllockcheck", (bCheck~=0));					
				
				if Win_IsVisible("UI.gameui.skilldlg") then
				Win_ShowWidget("UI.gameui.skilldlg",false);
				end;
				Win_AlignWidget("UI.gameui.studydlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				
				Win_EnableWidget("UI.gameui.studydlg.clearbtn",false);
				Win_EnableWidget("UI.gameui.studydlg.simubtn",true);
				EndSimuSkill();
				
				SetGlobalQuery(GlobalQuery_StudySkill,1);
				
				--RequestNewbieHelp(help_studydlg);
				QueryNewbieNextStep(801);
				
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				  
			OnCancel=function()
					Win_ShowWidget("UI.gameui.studydlg",false);
				        end;
			
			OnSelfHide=function()
				LockPlayer(0);
				EndSimuSkill();
				SetGlobalQuery(GlobalQuery_StudySkill,0);
				--RequestNewbieHelp(help_studydlg,0);
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep801");
				end;
						
			children=
			{				
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_studydlg,
						offsetx=-80,
						offsety=-37,
					},
				};
				
				newbiecustom1=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_newtask_study,
						offsetx=-80,
						offsety=-37,
					},
				};
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 274,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 253,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						--RequestNewbieHelp(help_studydlg,-1);
						GameUILogInfo("此功能暂时没有开放！");
						--[[
						local helpid=GetHelpID("技能栏界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				simubtn = 
				{
					type = "BUTTON",
					tiptext="开始模拟升级",
					rect = { 221,430,73,28 },
					bkimage="res/uires/skilldlg/simubtn.gsa",
					soundid={1007},
					
					OnClick=function()
						StartSimuSkill();
						Win_EnableWidget("UI.gameui.studydlg.clearbtn",true);
						Win_EnableWidget("UI.gameui.studydlg.simubtn",false);
						end;
				},
				
				clearbtn = 
				{
					type = "BUTTON",
					tiptext="结束模拟升级",
					rect = { 221,458,73,28 },
					bkimage="res/uires/skilldlg/clearbtn.gsa",
					soundid={1007},
					
					OnClick=function()
						EndSimuSkill();
						Win_EnableWidget("UI.gameui.studydlg.simubtn",true);
						Win_EnableWidget("UI.gameui.studydlg.clearbtn",false);
						end;
				},
				
				usedpointslabel=
				{
					type="LABEL",
					rect= {128,464,80,12},
					textsize=12,
					caption="0",
					visible=1,
				},
				
				pointlabel=
				{
					type="LABEL",
					rect={128,441,80,12},						
					textsize=12,
					caption="0",
					enable=0,
				},
				
				skillfire= 
				{
					type = "LABEL",
					rect = { 123,440,16,16 },
					effectpic="res/uires/common/skillfire.gsa",
					effectpicpos={-5,-15},
					drawflag=drawflag_draw_effect,
				},			
				
				tab0=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={0,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					checked=1,
					visible=0,
					
					dragindex=-1,
					dragtype=ui_drag_type_skill_main,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.studydlg.tab0",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.studydlg.tab0",value_channel_customid);
						Win_SetValue("UI.gameui.studydlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.studydlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.studydlg",value_channel_customindex);
						if stop ~= 0 then
						Win_SetValue("UI.gameui.studydlg",0,value_channel_customindex);
						UI.children.gameui.OnLearnUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.studydlg.tab0.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										infolabel=
										{
											type = "LABEL",
											rect = { 18,70,190,40 },
											caption="尚未就职，无可用主修技能!",
											textsize=12,											
											visible=0,
											updatemute=1,
										},
										
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab0.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.studydlg.tab0.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
				};
				
				tab1=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={84,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					visible=0,
					
					dragindex=-1,
					dragtype=ui_drag_type_skill_main,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.studydlg.tab1",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.studydlg.tab1",value_channel_customid);
						Win_SetValue("UI.gameui.studydlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.studydlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.studydlg",value_channel_customindex);
						if stop ~= 1 then
						Win_SetValue("UI.gameui.studydlg",1,value_channel_customindex);
						UI.children.gameui.OnLearnUpdate();
						end;
						end;
						end;	
					
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.studydlg.tab1.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										infolabel=
										{
											type = "LABEL",
											rect = { 18,70,190,40 },
											caption="尚未就职，无可用辅修技能!",
											textsize=12,											
											visible=0,
											updatemute=1,
										},	
										
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab1.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.studydlg.tab1.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
				tab2=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={168,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					visible=0,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.studydlg.tab2",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.studydlg.tab2",value_channel_customid);
						Win_SetValue("UI.gameui.studydlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.studydlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.studydlg",value_channel_customindex);
						if stop ~= 2 then
						Win_SetValue("UI.gameui.studydlg",2,value_channel_customindex);
						UI.children.gameui.OnLearnUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = {0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.studydlg.tab2.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										suitskillbk=
										{
											type = "WIDGET",
											rect = { 2,77,199,24 },
											bkimage="res/uires/skilldlg/suitskillbk.gsa";
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=1,
											updatemute=1,
										},

										usesuitskillbk=
										{
											type = "WIDGET",
											rect = { 27,152,97,13 },
											bkimage="res/uires/skilldlg/usesuitskill.gsa";
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=1,
											initlayer=1;
											updatemute=1,
										},
										
										skilllockcheck= 
										{
											type = "CHECK",
											rect={7,149,120,20};
											textsize=12,
											textstyle=dt_left,
											bkimage = "res/uires/newcommon/checkbox.gsa",
											visible=1,
											initlayer=2;
											
											OnCheck=function(bcheck)									   
												LockSuitSkill(bcheck);
												end;				
										},
										
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill1",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill2",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill3",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill4",value_channel_dragindex);
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill5",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill6",value_channel_dragindex);
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill7",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill8",value_channel_dragindex);
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill9",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill10",value_channel_dragindex);
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill11",value_channel_dragindex);

														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab2.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.studydlg.tab2.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
				tab3=
				{
					type="TABWIN",
					rect={37,66,251,362},							
					tabrect={250,0,82,22},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					visible=0,
					itemdragflag=-1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.studydlg.tab3",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.studydlg.tab3",value_channel_customid);
						Win_SetValue("UI.gameui.studydlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.studydlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.studydlg",value_channel_customindex);
						if stop ~= 3 then
						Win_SetValue("UI.gameui.studydlg",3,value_channel_customindex);
						UI.children.gameui.OnLearnUpdate();
						end;
						end;
						end;	
						
					children=
					{
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 0,0,233,361 },
							style=wgtstyle_clipchild_window;
							primaryscroll="UI.gameui.studydlg.tab3.skillscroll",
							
							children=
							{
								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,233,361 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									custombuffer=custom_buffer_skilltree,
									updatemute=1,
									
									children=
									{
										skill1=
										{
											type = "WIDGET",
											rect = { 16,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 74,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 132,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 190,10,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 16,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.studydlg.tab3.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={233,19,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.studydlg.tab3.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					
					};
					
				};
				
			};
		};
		

		
		--"我的物品栏",
		waredlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 262, 450 },
			bkimage="res/uires/waredlg/waredlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,			
			tabstop=0,
			moveable=1,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			marginh=0,		
			marginv=0,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_vcenter,
			
			dragindex=-1,
			dragtype=ui_drag_type_ware_medicine,
			itemdragflag=-1,
			
			mornitor={value_channel_winrect},
			
			OnUpdate=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep301");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1001");
				end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.waredlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnCancel=function()
				       Win_ShowWidget("UI.gameui.waredlg",false);
				       end;
				       
			OnDragEnter=function()
				local info=Win_GetDragInfo();
				if info.itemtype==ui_item_ware then
				Win_SetFocus("UI.gameui.waredlg.waretab");
				elseif info.itemtype==ui_item_medicine then
				Win_SetFocus("UI.gameui.waredlg.medicinetab");
				else
				Win_SetFocus("UI.gameui.waredlg.equiptab");
				end;
				
				if info.type == ui_drag_type_xianzhibaowu or info.type == ui_drag_type_baonang or info.type == ui_drag_type_bodybaowu then
					Win_SetFocus("UI.gameui.waredlg.equiptab");
				end;
				end;
			
	
			OnSelfShow=function()
				PushNewbieTips(36);
				local money=GetMoney();
				local goldbill=GetGoldBill();
				local gold=math.floor(money/1000000);
				local silver=math.floor((money-gold*1000000)/1000);
				local copper=money-gold*1000000-silver*1000;
				local billgold=math.floor(goldbill/1000000);
				local billsilver=math.floor((goldbill-billgold*1000000)/1000);
				local billcopper=goldbill-billgold*1000000-billsilver*1000;
				Win_SetText("UI.gameui.waredlg.goldedit",gold);
				Win_SetText("UI.gameui.waredlg.silveredit",silver);
				Win_SetText("UI.gameui.waredlg.copperedit",copper);
				Win_SetText("UI.gameui.waredlg.regoldedit",billgold);
				Win_SetText("UI.gameui.waredlg.resilveredit",billsilver);
				Win_SetText("UI.gameui.waredlg.recopperedit",billcopper);
				Win_SetText("UI.gameui.waredlg.assetsedit",g_PlayerInfo.ASSETS);
				Win_SetText("UI.gameui.waredlg.activeedit",g_PlayerInfo.ACTIVE);
				
				Win_AlignWidget("UI.gameui.waredlg","UI.gameui.rightbottomlocalizer",aligntype_winrect,alignstyle_right_in+alignstyle_bottom_in);
				
				Win_SetCheck("UI.gameui.waredlg.medicinetab",true);
				Win_SetCheck("UI.gameui.waredlg.equiptab",false);
				Win_SetCheck("UI.gameui.waredlg.waretab",false);
				
				UI.children.gameui.children.waredlg.OnUpdateProtect();
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep3");
				QueryNewbieNextStep(1001);
				
				if IsInNewTask() ~= 0 and GetCurStep() == 3 then
					Win_SetCheck("UI.gameui.waredlg.medicinetab",false);
					Win_SetCheck("UI.gameui.waredlg.waretab",false);
					Win_SetCheck("UI.gameui.waredlg.equiptab",true);
				end;
				
				Win_SetText("UI.gameui.waredlg.diamondedit", GetDiamond());
			end;
				
			-- 限时保护更新
			OnUpdateProtect=function()
				local ptype = "";
				local info1 = "";
				local info2 = "";
				local enableCancel = false;
				local protectInfo = GetLoginProtectInfo();
								
				if protectInfo.type == 1 then
					ptype = "部分保护";
				elseif protectInfo.type == 2 then
					ptype = "全部保护";
				end;
				
				if protectInfo.type > 0 then
					if protectInfo.pasttime <= protectInfo.protecttime then
						info1 = "保护时间剩余" .. tostring(math.floor((protectInfo.protecttime - protectInfo.pasttime)/60)) .. "分钟";
						Win_SetValue("UI.gameui.waredlg.protectinfo1", GetColorIndex(0,255,0,255), value_channel_color_draw);
					elseif protectInfo.pasttime > protectInfo.protecttime then
						info1 = "已经超出登录保护时间";
						Win_SetValue("UI.gameui.waredlg.protectinfo1", GetColorIndex(255,0,0,255), value_channel_color_draw);
					end;
					
					if protectInfo.modifytype == 1 then
						enableCancel = true;
						if protectInfo.optime == 0 then
							info2 = "取消安全保护在下次登录时生效";
						else
							info2 = "取消安全保护生效还剩" .. tostring(math.floor(protectInfo.optime/3600)) .. "小时";
						end;
					elseif protectInfo.modifytype == 2 or protectInfo.modifytype == 3 then
						enableCancel = true;
						if protectInfo.optime == 0 then
							info2 = "缩短安全保护时间在下次登录时生效";
						else
							info2 = "缩短安全保护时间生效还剩" .. tostring(math.floor(protectInfo.optime/3600)) .. "小时";
						end;
					end;
				end;			
				
				Win_SetText("UI.gameui.waredlg.protecttype", ptype);
				Win_SetText("UI.gameui.waredlg.protectinfo1", info1);
				Win_SetText("UI.gameui.waredlg.protectinfo2", info2);
				Win_ShowWidget("UI.gameui.waredlg.protectcancel", enableCancel);
			end;
			
			OnSelfHide=function()
				CancelMagicCard();
				
				if Win_IsChecked("UI.gameui.waredlg.waretab") then
					RequestNewbieHelp(help_waredlg_ware,0);
				elseif Win_IsChecked("UI.gameui.waredlg.equiptab") then
					RequestNewbieHelp(help_waredlg_equip,0);
				elseif Win_IsChecked("UI.gameui.waredlg.medicinetab") then
					RequestNewbieHelp(help_waredlg_medicine,0);
				end;
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep301");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1001");
			end;
					   

			children = 
			{				
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 233,18,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 211,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.waredlg.waretab") then
							if Win_IsVisible("UI.gameui.waredlg") then
								RequestNewbieHelp(help_waredlg_ware,-1);
							end;
						elseif Win_IsChecked("UI.gameui.waredlg.equiptab") then
							if Win_IsVisible("UI.gameui.waredlg") then
								RequestNewbieHelp(help_waredlg_equip,-1);
							end;
						elseif Win_IsChecked("UI.gameui.waredlg.medicinetab") then
							if Win_IsVisible("UI.gameui.waredlg") then
								RequestNewbieHelp(help_waredlg_medicine,-1);
							end;
						end;
						--[[
						local helpid=GetHelpID("物品栏");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				--整理按钮
				tidybtn= 
				{
					type = "BUTTON",
					rect = { 206,46,42,20 },
					bkimage="res/uires/waredlg/tidybtn.gsa",
					
					OnClick=function()
						TidyPack(ui_drag_type_ware_medicine);
						TidyPack(ui_drag_type_ware_ware);
						TidyPack(ui_drag_type_ware_equip);
					end;
				};
				
				goldedit=
				{
					type="LABEL",
					rect={72,288,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=1,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={120,288,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={168,288,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				regoldedit=
				{
					type="LABEL",
					rect={72,309,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				resilveredit=
				{
					type="LABEL",
					rect={120,309,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				recopperedit=
				{
					type="LABEL",
					rect={168,309,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				assetsedit=
				{
					type="LABEL",
					rect={184,328,60,12},
					textsize=12,	
					textstyle=dt_center,
					bkcolor={0,0,0,0},
					enable=0,
				};
				
				activeedit=
				{
					type="LABEL",
					rect={80,328,60,12},
					textsize=12,	
					textstyle=dt_center,
					bkcolor={0,0,0,0},
					enable=0,
				};
				
				
				
				bowlderedit=
				{
					type="LABEL",
					rect={62,352,78,12},
					textsize=12,	
					textstyle=dt_center,
					bkcolor={0,0,0,0},
					enable=0,
				};				
				
				weightedit=
				{
					type="LABEL",
					rect={182,352,66,12},						
					textsize=12,
					textstyle=dt_center,
					enable=1,
				},
				
				diamondlabel=
				{
					type="LABEL",
					rect={33,371,40,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={200,230,0,255},
					enable=1,
					caption="钻石：",
				},
				diamondedit=
				{
					type="LABEL",
					rect={66,371,70,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=1,
				},
				
				-- 安全保护
				loginprotectbtn= 
				{
					type = "BUTTON",
					rect = { 28,390,90,30 },
					bkimage="res/uires/waredlg/protectbtn.gsa",
					
					OnClick=function()
						local info = GetLoginProtectInfo();
						if info.type == 0 then
							Win_ShowWidget("UI.gameui.selectprotecttypedlg", true);
						else
							Win_ShowWidget("UI.gameui.protectsetupdlg", true);
						end;
					end;
				};
				
				protecttype=
				{
					type="LABEL",
					rect={46,421,55,18},
					drawcolor={255,0,0,255},
					textfont=1,
					textsize=12,
					textstyle=dt_center,
					caption="",
				},
				
				protectinfo1=
				{
					type="LABEL",
					rect={123,390,127,18},
					drawcolor={0,255,0,255},
					textfont=1,
					textsize=12,
					textstyle=dt_left,
					initlayer=1,
					caption="",
				},	
				protectinfo2=
				{
					type="LABEL",
					rect={123,407,126,30},
					drawcolor={255,0,0,255},
					textfont=1,
					textsize=12,
					textstyle=dt_left,
					initlayer=1,
					caption="",
				},
				protectcancel=
				{
					type="BUTTON",
					rect={220,402,30,15},						
					textsize=12,
					textstyle=dt_center,
					enable=1,
					visible=0,
					initlayer=2,
					bkimage="res/uires/waredlg/cancelbtn.gsa",
					
					OnClick=function()
						CancelLoginProtectOperation();
					end;
				},				
				
				medicinetab=
				{
					type="TABWIN",
					rect={33,69,216,210},									
					tabrect={-2,-1, 53,22},
					tabcover="res/uires/waredlg/medicinebtn.gsa",
					tabwintype=tabwin_type_up,							
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							RequestNewbieHelp(help_waredlg_ware,0);
							RequestNewbieHelp(help_waredlg_equip,0);
							if Win_IsVisible("UI.gameui.waredlg") then
								RequestNewbieHelp(help_waredlg_medicine);
							end;
						end;
						end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_waredlg_medicine,
								offsetx=-105,
								offsety=-16,
							},
							
						};
						
						newbiecustom1=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_newtask_toequip,
								offsetx=-85,
								offsety=-155,
							},
						};
						
						medicinelist=
						{
							type="LISTBOX",
							rect={3,-1,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_ware_medicine,
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
					},
				};
				
				waretab=
				{
					type="TABWIN",
					rect={33,69,216,210},									
					tabrect={52,-1,53,22},
					tabcover="res/uires/waredlg/warebtn.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_ware,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							RequestNewbieHelp(help_waredlg_equip,0);
							RequestNewbieHelp(help_waredlg_medicine,0);
							if Win_IsVisible("UI.gameui.waredlg") then
								RequestNewbieHelp(help_waredlg_ware);
							end;
						end;
						end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_waredlg_ware,
								offsetx=-94,
								offsety=-16,
							},
							
						};
						
						newbiecustom1=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_newtask_toequip,
								offsetx=-135,
								offsety=-162,
							},
							
						};
						
						warelist=
						{
							type="LISTBOX",
							rect={3,-1,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_ware_ware,
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};
				
				
				equiptab=
				{
					type="TABWIN",
					rect={33,69,216,210},									
					tabrect={106,-1,53,22},
					tabcover="res/uires/waredlg/equipbtn.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=2,
					tabstop=2,	
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_equip,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							RequestNewbieHelp(help_waredlg_medicine,0);
							RequestNewbieHelp(help_waredlg_ware,0);
							RequestNewbieHelp(help_waredlg_equip);
							QueryNewbieNextStep(301);
						end;
						end;
						
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_waredlg_equip,
								offsetx=-85,
								offsety=-13,
							},
							
						};
						
						newbiecustom2=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_newtask_equip,
								offsetx=-136,
								offsety=-155,
							},
							
						};
						
						equiplist=
						{
							type="LISTBOX",
							rect={3,-1,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_ware_equip,
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
					},
				};
			},
			
		};
		
		storedlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 262, 363 },
			captionrect = { 67,22,100,12 },
			bkimage="res/uires/storedlg/storedlgbk.gsa",
			moveable=1,					
			visible=0,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.storedlg",false);
				end;
			
			OnSelfShow=function()
					   					   
					local money=GetMoney(0);
					local assets=GetFmAssets();
					local gold=math.floor(money/1000000);
					local silver=math.floor((money-gold*1000000)/1000);
					local copper=money-gold*1000000-silver*1000;
					Win_SetText("UI.gameui.storedlg.goldedit",gold);
					Win_SetText("UI.gameui.storedlg.silveredit",silver);
					Win_SetText("UI.gameui.storedlg.copperedit",copper);	
					Win_SetText("UI.gameui.storedlg.fmassets",assets);
					
					Win_ShowWidget("UI.gameui.storedlg.cashbtn",false);
					end;
					   
					   
			OnSelfHide=function()
					CloseStore(0);
					end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 233,19,23,22 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 212,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				savebtn = 
				{
					type = "BUTTON",
					rect = { 207, 293, 45, 20 },
					bkimage="res/uires/storedlg/savebtn.gsa",		
					
					OnClick=function()							
						local captxt=Win_GetText("UI.gameui.storedlg");
						local var=GetGameVar("storecash");
						if (captxt=="家族仓库")and(var==0) then
						SetGameVar("storecash",1);
						Win_ShowMsgBox("家族仓库只能存入,不能取出.您确定要存入吗?","系统消息",ui_msgid_yesno,"UI.gameui.storedlg.savebtn");
						else
						Win_SetValue("UI.gameui.moneyinputdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
						end;
						
					OnMsgBoxOk=function()						
						Win_SetValue("UI.gameui.moneyinputdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
				},
				
				cashbtn = 
				{
					type = "BUTTON",
					rect = { 214, 293, 22, 22 },
					bkimage="res/uires/newcommon/cashbtn.gsa",		
					
					OnClick=function()	
						Win_SetValue("UI.gameui.moneyinputdlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);	
						end;
				},
				
				savecashbtn=
				{
					type = "BUTTON",
					rect = { 207, 315, 45, 20 },
					bkimage="res/uires/storedlg/savecashbtn.gsa",		
					
					OnClick=function()							
						local captxt=Win_GetText("UI.gameui.storedlg");
						local var=GetGameVar("storecash");
						if (captxt=="家族仓库")and(var==0) then
						SetGameVar("storecash",1);
						Win_ShowMsgBox("家族仓库只能存入,不能取出.您确定要存入吗?","系统消息",ui_msgid_yesno,"UI.gameui.storedlg.savecashbtn");
						else
						Win_SetValue("UI.gameui.moneyinputdlg",3,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
						end;
						
					OnMsgBoxOk=function()						
						Win_SetValue("UI.gameui.moneyinputdlg",3,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
				},
				
				goldedit=
				{
					type="LABEL",
					rect={45,298,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={91,298,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={138,298,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				fmassets=
				{
					type="LABEL",
					rect={118,319,60,12},
					captionrect={12,0,36,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				storetab1=
				{
					type="TABWIN",
					rect={35,65,215,224},									
					tabrect={0,1,23,22},
					tabcover="res/uires/storedlg/storetab1.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_store,
					itemdragflag=-1,
					
					
					children=
					{
						
						list=
						{
							type="LISTBOX",
							rect={2,7,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_store,
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};
				
				storetab2=
				{
					type="TABWIN",
					rect={35,65,215,224},									
					tabrect={23,1,23,22},
					tabcover="res/uires/storedlg/storetab2.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_store,
					itemdragflag=-1,
					
					children=
					{
						
						list=
						{
							type="LISTBOX",
							rect={2,7,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_store,
							indexoffset=25,	
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};
				
				storetab3=
				{
					type="TABWIN",
					rect={35,65,215,224},									
					tabrect={46,1,23,22},
					tabcover="res/uires/storedlg/storetab3.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_store,
					itemdragflag=-1,
					
					
					children=
					{
						
						list=
						{
							type="LISTBOX",
							rect={2,7,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_store,
							indexoffset=50,	
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};
				
				storetab4=
				{
					type="TABWIN",
					rect={35,65,215,224},									
					tabrect={69,1,23,22},
					tabcover="res/uires/storedlg/storetab4.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_store,
					itemdragflag=-1,
					
					
					children=
					{
						
						list=
						{
							type="LISTBOX",
							rect={2,7,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_store,
							indexoffset=75,	
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};
				
				storetab5=
				{
					type="TABWIN",
					rect={35,65,215,224},									
					tabrect={92,1,23,22},
					tabcover="res/uires/storedlg/storetab5.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_store,
					itemdragflag=-1,
					
					
					children=
					{
						
						list=
						{
							type="LISTBOX",
							rect={2,7,210,210},
							style=wgtstyle_systemdraw,
							extendstyle=listbox_style_itemheight_fix,
							itemwidth=36,
							itemheight=36,
							itemmarginh=3,
							itemmarginv=3,
							itemnum=25,	
							dragtype=ui_drag_type_store,
							indexoffset=100,	
							
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},--warelist
						
					},--waretab children
					
				};	
			},

		};

	
		
		--/仓库扩容
		storedlg0=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 339 },
			bkimage="res/uires/storedlg/basestoredlgbk.gsa",
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.storedlg0",false);
				end;
			
			OnSelfShow=function()
					local money=GetMoney(0);
					local gold=math.floor(money/1000000);
					local silver=math.floor((money-gold*1000000)/1000);
					local copper=money-gold*1000000-silver*1000;
					Win_SetText("UI.gameui.storedlg0.goldedit",gold);
					Win_SetText("UI.gameui.storedlg0.silveredit",silver);
					Win_SetText("UI.gameui.storedlg0.copperedit",copper);	
					Win_SetPos("UI.gameui.storedlg0",exstorerect.w,exstorerect.y);
					Win_SetFocus("UI.gameui.storedlg0");
					
					if GetScreenType() ~= 0 then
						exstorerect.w = 766;
						exstorerect.y = 15;
					end;
					
					exstorepos=
					{
						0,	0,	0,	0,	0,	0,	0
					};
					end;
					   
			OnSelfHide=function()
					Win_ShowWidget("UI.gameui.storedlg1",false);
					Win_ShowWidget("UI.gameui.storedlg2",false);
					Win_ShowWidget("UI.gameui.storedlg3",false);
					Win_ShowWidget("UI.gameui.storedlg4",false);
					Win_ShowWidget("UI.gameui.storedlg5",false);
					Win_ShowWidget("UI.gameui.storedlg6",false);
					Win_ShowWidget("UI.gameui.storedlg7",false);
					CloseStore(1);
					end;
			
			OnOpenExstore=function(id)
				local emptypos = 0;
				local i;
				local upnum=0;
				local downnum=0;
				local bupline = 0;
				local widgetpath = "UI.gameui.storedlg"..id;
				
				Win_SetPos("UI.gameui.storedlg0",exstorerect.w,exstorerect.y);
				Win_SetFocus("UI.gameui.storedlg0");
					
				for i=1, 7 do
					if emptypos==0 and exstorepos[i] == 0 then
						emptypos = i;
						exstorepos[i] = id; 
						if i== 1 or i==3 or i==5 or i==7 then
							bupline = 1;
						else
							bupline = 0;
						end;
					end;
					
					if exstorepos[i] ~= 0 then
						if i== 1 or i==3 or i==5 or i==7 then
						upnum = upnum + 1;
						else
						downnum = downnum + 1;
						end;
					end;
				end;
				
				Win_SetValue(widgetpath, emptypos, value_channel_customindex);
				
				local winrect = Win_GetRect(widgetpath,value_channel_winrect);
				local basewinrect = Win_GetRect("UI.gameui.storedlg0",value_channel_winrect);
				if bupline ~= 0 then
					local alignwidth = (upnum*winrect.w-exstorerect.w)/(upnum-1);
					if emptypos == 1 then
						Win_AlignWidget(widgetpath,"UI.gameui.storedlg0",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
					else
						if alignwidth > 0 then
							Win_AlignWidget("UI.gameui.storedlg"..exstorepos[1],"UI.gameui.storedlg0",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
							
							for j=3, emptypos do
								Win_AlignWidget("UI.gameui.storedlg"..exstorepos[j],"UI.gameui.storedlg"..exstorepos[j-2],aligntype_winrect,alignstyle_left_out+alignstyle_top_in,alignwidth,0);
								j = j+1;
							end;
						else
							Win_AlignWidget(widgetpath,"UI.gameui.storedlg"..exstorepos[emptypos-2],aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
						end;
					end;
				else
					local alignwidth = (downnum*winrect.w-exstorerect.w)/(downnum-1);
					if emptypos == 2 then
						Win_AlignWidget(widgetpath,"UI.gameui.storedlg0",aligntype_winrect,alignstyle_left_out+alignstyle_bottom_out,0,winrect.h-basewinrect.h);
					else
						if alignwidth > 0 then
							Win_AlignWidget("UI.gameui.storedlg"..exstorepos[2],"UI.gameui.storedlg0",aligntype_winrect,alignstyle_left_out+alignstyle_bottom_out,0,winrect.h-basewinrect.h);
							
							for j=4, emptypos do
								Win_AlignWidget("UI.gameui.storedlg"..exstorepos[j],"UI.gameui.storedlg"..exstorepos[j-2],aligntype_winrect,alignstyle_left_out+alignstyle_top_in,alignwidth,0);
								j = j+1;
							end;
						else
							Win_AlignWidget(widgetpath,"UI.gameui.storedlg"..exstorepos[emptypos-2],aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
						end;
					end;
				end;
				
				for k=1,7 do
					if Win_IsVisible("UI.gameui.storedlg"..exstorepos[8-k]) then 
						Win_SetFocus("UI.gameui.storedlg"..exstorepos[8-k]); 
					end;
				end;
				Win_SetFocus("UI.gameui.storedlg0"); 
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				--整理按钮
				tidybtn= 
				{
					type = "BUTTON",
					rect = { 181,309,69,24 },
					bkimage="res/uires/storedlg/tidybtn.gsa",
					
					OnClick=function()
						TidyPack(ui_drag_type_store);
					end;
				};
				
				savebtn = 
				{
					type = "BUTTON",
					rect = { 168, 260, 22, 22 },
					bkimage="res/uires/newcommon/savebtn.gsa",		
					
					OnClick=function()							
						local captxt=Win_GetText("UI.gameui.storedlg0");
						local var=GetGameVar("storecash");
						if (captxt=="家族仓库")and(var==0) then
						SetGameVar("storecash",1);
						Win_ShowMsgBox("家族仓库只能存入,不能取出.您确定要存入吗?","系统消息",ui_msgid_yesno,"UI.gameui.storedlg.savebtn");
						else
						Win_SetValue("UI.gameui.moneyinputdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
						end;
						
					OnMsgBoxOk=function()						
						Win_SetValue("UI.gameui.moneyinputdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);
						end;
					
					
				},
				
				cashbtn = 
				{
					type = "BUTTON",
					rect = { 191, 260, 22, 22 },
					bkimage="res/uires/newcommon/cashbtn.gsa",		
					
					OnClick=function()	
						Win_SetValue("UI.gameui.moneyinputdlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.moneyinputdlg",true);	
						end;
					
							
				},
				
				
				
				goldedit=
				{
					type="LABEL",
					rect={37,265,42,12},
					captionrect={12,0,30,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0;
				},
				
				silveredit=
				{
					type="LABEL",
					rect={79,265,42,12},
					captionrect={12,0,30,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0;
				},
				
				copperedit=
				{
					type="LABEL",
					rect={121,265,42,12},
					captionrect={12,0,30,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0;
				},
				
				list=
				{
					type="LISTBOX",
					rect={35,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=0,
				},
				
				exstorebtn1=
				{
					type="BUTTON",
					rect={40,310,22,23},
					bkimage="res/uires/storedlg/exstore1btn.gsa",
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg1") then
						Win_ShowWidget("UI.gameui.storedlg1",true);
						Win_SetFocus("UI.gameui.storedlg1");
						else
						Win_ShowWidget("UI.gameui.storedlg1",false);
						end;
						end;
				};
				
				exstorebtn2=
				{
					type="BUTTON",
					rect={69,310,22,23},
					bkimage="res/uires/storedlg/exstore2btn.gsa",
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg2") then
						Win_ShowWidget("UI.gameui.storedlg2",true);
						Win_SetFocus("UI.gameui.storedlg2");
						else
						Win_ShowWidget("UI.gameui.storedlg2",false);
						end;
						end;
				};
				
				exstorebtn3=
				{
					type="BUTTON",
					rect={98,310,22,23},
					bkimage="res/uires/storedlg/exstore3btn.gsa",
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg3") then
						Win_ShowWidget("UI.gameui.storedlg3",true);
						Win_SetFocus("UI.gameui.storedlg3");
						else
						Win_ShowWidget("UI.gameui.storedlg3",false);
						end;
						end;
				};
				
				exstorebtn4=
				{
					type="BUTTON",
					rect={127,310,22,23},
					bkimage="res/uires/storedlg/exstore4btn.gsa",
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg4") then
						Win_ShowWidget("UI.gameui.storedlg4",true);
						Win_SetFocus("UI.gameui.storedlg4");
						else
						Win_ShowWidget("UI.gameui.storedlg4",false);
						end;
						end;
				};
				
				exstorebtn5=
				{
					type="BUTTON",
					rect={156,310,22,23},
					bkimage="res/uires/storedlg/exstore5btn.gsa",
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg5") then
						Win_ShowWidget("UI.gameui.storedlg5",true);
						Win_SetFocus("UI.gameui.storedlg5");
						else
						Win_ShowWidget("UI.gameui.storedlg5",false);
						end;
						end;
				};
				
				exstorebtn6=
				{
					type="BUTTON",
					rect={159,307,26,26},
					bkimage="res/uires/storedlg/exstore6btn.gsa",
					framescheme={{2,1,0,3}},
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg6") then
						Win_ShowWidget("UI.gameui.storedlg6",true);
						Win_SetFocus("UI.gameui.storedlg6");
						else
						Win_ShowWidget("UI.gameui.storedlg6",false);
						end;
						end;
				};
				
				exstorebtn7=
				{
					type="BUTTON",
					rect={188,307,26,26},
					bkimage="res/uires/storedlg/exstore7btn.gsa",
					framescheme={{2,1,0,3}},
					enable=0,
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.storedlg7") then
						Win_ShowWidget("UI.gameui.storedlg7",true);
						Win_SetFocus("UI.gameui.storedlg7");
						else
						Win_ShowWidget("UI.gameui.storedlg7",false);
						end;
						end;
				};
				
				openallexstoredlgbtn=
				{
					type="BUTTON",
					rect={79,283,86,24},
					bkimage="res/uires/storedlg/openallstoredlgbtn.gsa",
					
					OnClick=function()
						exstorepos={0,0,0,0,0,0,0};
						Win_ShowWidget("UI.gameui.storedlg1",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn1"));
						Win_ShowWidget("UI.gameui.storedlg2",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn2"));
						Win_ShowWidget("UI.gameui.storedlg3",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn3"));
						Win_ShowWidget("UI.gameui.storedlg4",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn4"));
						Win_ShowWidget("UI.gameui.storedlg5",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn5"));
						Win_ShowWidget("UI.gameui.storedlg6",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn6"));
						Win_ShowWidget("UI.gameui.storedlg7",Win_IsEnabled("UI.gameui.storedlg0.exstorebtn7"));
						
						if Win_IsVisible("UI.gameui.storedlg7") then Win_SetFocus("UI.gameui.storedlg7"); end;
						if Win_IsVisible("UI.gameui.storedlg6") then Win_SetFocus("UI.gameui.storedlg6"); end;
						if Win_IsVisible("UI.gameui.storedlg5") then Win_SetFocus("UI.gameui.storedlg5"); end;
						if Win_IsVisible("UI.gameui.storedlg4") then Win_SetFocus("UI.gameui.storedlg4"); end;
						if Win_IsVisible("UI.gameui.storedlg3") then Win_SetFocus("UI.gameui.storedlg3"); end;
						if Win_IsVisible("UI.gameui.storedlg2") then Win_SetFocus("UI.gameui.storedlg2"); end;
						if Win_IsVisible("UI.gameui.storedlg1") then Win_SetFocus("UI.gameui.storedlg1"); end;
						if Win_IsVisible("UI.gameui.waredlg")   then Win_SetFocus("UI.gameui.waredlg"); end;
						Win_SetFocus("UI.gameui.storedlg0");
						--Win_SetFocus("UI.gameui.storedlg2");
						
						end;
				};
				
				closeallexstoredlgbtn=
				{
					type="BUTTON",
					rect={167,284,86,24},
					bkimage="res/uires/storedlg/closeallstoredlgbtn.gsa",

					OnClick=function()
						if Win_IsVisible("UI.gameui.storedlg1") then Win_ShowWidget("UI.gameui.storedlg1",false); end;
						if Win_IsVisible("UI.gameui.storedlg2") then Win_ShowWidget("UI.gameui.storedlg2",false); end;
						if Win_IsVisible("UI.gameui.storedlg3") then Win_ShowWidget("UI.gameui.storedlg3",false); end;
						if Win_IsVisible("UI.gameui.storedlg4") then Win_ShowWidget("UI.gameui.storedlg4",false); end;
						if Win_IsVisible("UI.gameui.storedlg5") then Win_ShowWidget("UI.gameui.storedlg5",false); end;
						if Win_IsVisible("UI.gameui.storedlg6") then Win_ShowWidget("UI.gameui.storedlg6",false); end;
						if Win_IsVisible("UI.gameui.storedlg7") then Win_ShowWidget("UI.gameui.storedlg7",false); end;
						end;
				};
			},
		};
		
		storedlg1=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 266},
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel1.gsa",
			coverpicpos={14,18,16,16},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(1);
				Win_SetFocus("UI.gameui.storedlg1");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg1", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={36,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=25,
				},
			},
		};
		
		storedlg2=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 266},
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel2.gsa",
			coverpicpos={14,18,16,16},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(2);
				Win_SetFocus("UI.gameui.storedlg2");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg2", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={36,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=50,
				},
			},
		};
		
		storedlg3=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 266},
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel3.gsa",
			coverpicpos={14,18,16,16},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(3);
				Win_SetFocus("UI.gameui.storedlg3");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg3", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={36,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=75,
				},
			},
		};
		
		storedlg4=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 266},
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel4.gsa",
			coverpicpos={14,18,16,16},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(4);
				Win_SetFocus("UI.gameui.storedlg4");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg4", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={36,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=100,
				},
			},
		};
		
		storedlg5=
		{
			type = "DIALOG",
			rect = { 0, 0, 258, 266},
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel5.gsa",
			coverpicpos={14,18,16,16},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(5);
				Win_SetFocus("UI.gameui.storedlg5");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg5", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 232,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 210,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={36,48,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=125,
				},
			},
		};
		
		storedlg6=
		{
			type = "DIALOG",
			rect = { 0, 0, 223, 269 },
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel6.gsa",
			coverpicpos={12,13,14,13},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(6);
				Win_SetFocus("UI.gameui.storedlg6");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg6", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 198,17,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 177,17,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={14,52,200,200},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=2,
					itemmarginv=2,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=150,
				},
			},
		};
		
		storedlg7=
		{
			type = "DIALOG",
			rect = { 0, 0, 223, 269 },
			bkimage="res/uires/storedlg/exstoredlgbk.gsa",
			coverpic="res/uires/storedlg/exstorelabel7.gsa",
			coverpicpos={12,13,14,13},
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			
			dragindex=-1,
			dragtype=ui_drag_type_store,
			itemdragflag=-1,
			
			updatemute=1,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnSelfShow=function()
				UI.children.gameui.children.storedlg0.OnOpenExstore(7);
				Win_SetFocus("UI.gameui.storedlg7");
				end;
			
			OnSelfHide=function()	
				local index = Win_GetValue("UI.gameui.storedlg7", value_channel_customindex);
					if index > 0 then	exstorepos[index] = 0; end;
				end;
			
			children = 
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 198,17,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 177,17,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("仓库界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={14,52,200,200},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=2,
					itemmarginv=2,
					itemnum=25,	
					dragtype=ui_drag_type_store,
					tipwidget="UI.gameui.ScrnTooltip",
					indexoffset=175,
				},
			},
		};
		--仓库扩容/
		
		-- 察看玩家信息
		exequipdlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 307, 453},
			captionrect={58,24,156,14},
			textsize=14,
			textfont=1,	
			drawcolor = { 241, 202, 65, 255 },
			bkimage="res/uires/equipdlg/exequipdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			tabstop=2,
			visible=0,		
			updatemute=1,
				
			
			--Win_SetValue("UI.gameui.exequipdlg.equiptab.itemweapon",1.2,value_channel_timerspace);

			
			
			--OnTimer=function()
			--	Win_ShowWidget("UI.gameui.recycledlg.itembelt.effectwgt",false);
			--end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.exequipdlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.exequipdlg",false);
				end;
			
			OnSelfShow=function()
				--Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweapon.effct1",true);		
				if Win_IsVisible("UI.gameui.equipdlg") then
				Win_AlignWidget("UI.gameui.equipdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_AlignWidget("UI.gameui.exequipdlg","UI.gameui.equipdlg",aligntype_winrect,alignstyle_top_in+alignstyle_right_out);
				else
				Win_AlignWidget("UI.gameui.exequipdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
								
				if Win_IsVisible("UI.gameui.exequipdlg.equiptab") then
					if (TheOthersEquipIsAwake(cs_pos_head) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemheadEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemheadEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemheadEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_hand) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemhandEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemhandEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemhandEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_dress) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemdressEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemdressEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemdressEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_foot) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemfootEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfootEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfootEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_weapon) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemweaponEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweaponEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweaponEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_face) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemfaceEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfaceEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfaceEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_jewery) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemjeweryEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemjeweryEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemjeweryEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_pack) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itempackEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itempackEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itempackEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_ring) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemringEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemringEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemringEffect",false);
					end;
					
					if (TheOthersEquipIsAwake(cs_pos_honor) == true) then 			
						--特效
						if Win_IsVisible("UI.gameui.exequipdlg.itemhonorEffect") == false then
							Win_ShowWidget("UI.gameui.exequipdlg.itemhonorEffect",true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.itemhonorEffect",false);
					end;
				end;
				
				local otherInfo=GetOtherPlayerInfo();
				if otherInfo~=nil then
				
				bufinfo=Win_GetCustomBuffer("UI.gameui.exequipdlg.equiptab.charactor");
				bufinfo.race=otherInfo.race;			   
				bufinfo.gender=otherInfo.gender;
				bufinfo.suitid=otherInfo.suitid;			   
				bufinfo.hair=otherInfo.HAIR;		   
				Win_SetCustomBuffer("UI.gameui.exequipdlg.equiptab.charactor",bufinfo);
				
				local showtitle="";
				if otherInfo.racename~="" then
				showtitle="等级 "..otherInfo.level.." "..(otherInfo.racename)..":"..(otherInfo.name);
				else
				showtitle=otherInfo.name;
				end;
				
				local point = GetOtherPlayerAchievePoint(otherInfo.name);
				Win_SetText("UI.gameui.exequipdlg.achievepoint",point);
				
				local rttitle, rttips = ClipString(showtitle, 23);
				
				if (rttips~="") then
					Win_EnableWidget("UI.gameui.exequipdlg.captionfortip",true);
				else
					Win_EnableWidget("UI.gameui.exequipdlg.captionfortip",false);
				end;
				
				Win_SetText("UI.gameui.exequipdlg.captionfortip",rttips,value_channel_tiptext);
				Win_SetText("UI.gameui.exequipdlg",rttitle );	
				
				if (otherInfo.family ~= "") then
				Win_SetText("UI.gameui.exequipdlg.title","家族: "..otherInfo.family);
				else
				Win_SetText("UI.gameui.exequipdlg.title","");
				end;
				
				Win_SetText("UI.gameui.exequipdlg.reputation",otherInfo.HONOR);					 
							 
				--左边
				Win_SetText("UI.gameui.exequipdlg.STR",otherInfo.STR);	
				Win_SetText("UI.gameui.exequipdlg.AGI",otherInfo.AGI);	
				Win_SetText("UI.gameui.exequipdlg.DEX",otherInfo.DEX);	
				Win_SetText("UI.gameui.exequipdlg.VIT",otherInfo.VIT);	
				Win_SetText("UI.gameui.exequipdlg.INT",otherInfo.INT);	
				Win_SetText("UI.gameui.exequipdlg.SPI",otherInfo.SPI);	
				
				--右边
				Win_SetText("UI.gameui.exequipdlg.MaxATK", otherInfo.MAXATK);
				Win_SetText("UI.gameui.exequipdlg.MinATK", otherInfo.MINATK);			 
				Win_SetText("UI.gameui.exequipdlg.Def", otherInfo.DEF);	
				Win_SetText("UI.gameui.exequipdlg.Matk",otherInfo.MATK);	
				Win_SetText("UI.gameui.exequipdlg.Mdef",otherInfo.MDEF);	
				Win_SetText("UI.gameui.exequipdlg.Hit", otherInfo.HITRATE);	
				end;
				
				SetGlobalQuery(GlobalQuery_OtherEquip,1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_OtherEquip,0);
				end;
				
			OnUpdateValue=function()
				if Win_IsChecked("UI.gameui.exequipdlg.talismantab") then
					local ret = GetTalismanInfo(1);
					local str = tostring(ret);
					local exist_1 = string.find(str, "1");
					local exist_2 = string.find(str, "2");
					local exist_3 = string.find(str, "3");
					local exist_4 = string.find(str, "4");
					local exist_5 = string.find(str, "5");
					if exist_1 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.goldposeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.goldposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.goldposeffect", false);
					end;
					if exist_2 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.woodposeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.woodposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.woodposeffect", false);
					end;
					if exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.waterposeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.waterposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.waterposeffect", false);
					end;
					if exist_4 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.fireposeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.fireposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.fireposeffect", false);
					end;
					if exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.soilposeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.soilposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.soilposeffect", false);
					end;
					if exist_1 ~= nil and exist_2 ~= nil and exist_3 ~= nil and exist_4 ~= nil and exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.specialeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.specialeffect", true);
						end;
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.totaleffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.totaleffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.specialeffect", false);
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.totaleffect", false);
					end;
					
					if exist_1 ~= nil and exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.gold_watereffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.gold_watereffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.gold_watereffect", false);
					end;
					
					if exist_2 ~= nil and exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.water_woodeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.water_woodeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.water_woodeffect", false);
					end;
					
					if exist_2 ~= nil and exist_4 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.water_fireeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.water_fireeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.water_fireeffect", false);
					end;
					
					if exist_4 ~= nil and exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.fire_soileffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.fire_soileffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.fire_soileffect", false);
					end;
					
					if exist_5 ~= nil and exist_1 ~= nil then
						if not Win_IsVisible("UI.gameui.exequipdlg.talismantab.soil_goldeffect") then
							Win_ShowWidget("UI.gameui.exequipdlg.talismantab.soil_goldeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.exequipdlg.talismantab.soil_goldeffect", false);
					end;
				end;				
			end;
			
			children=
			{
				captionfortip=
				{
					type = "LABEL",
					rect={58,24,156,14},
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					style=wgtstyle_clipself,
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 278,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 254,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("装备");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				equiptab=
				{
					type="TABWIN",
					rect={36,89,257,198},
					tabrect={-2,-2,72,22},
					tabcover="res/uires/equipdlg/equiptab.gsa",
					tabwintype=tabwin_type_up,
					bkimage="res/uires/equipdlg/equiptabbk.gsa",
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=1,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							--RequestNewbieHelp(help_equipdlg_attr,0);
							RequestNewbieHelp(help_equipdlg_equip);
							
							if Win_IsVisible("UI.gameui.exequipdlg.AwakeEquipListLeft") == false or Win_IsVisible("UI.gameui.exequipdlg.AwakeEquipListRight") == false then 
								Win_ShowWidget("UI.gameui.exequipdlg.AwakeEquipListLeft",true);
								Win_ShowWidget("UI.gameui.exequipdlg.AwakeEquipListRight",true);																						
							end;	

							if (TheOthersEquipIsAwake(cs_pos_head) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemheadEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemheadEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemheadEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_hand) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemhandEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemhandEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemhandEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_dress) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemdressEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemdressEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemdressEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_foot) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemfootEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfootEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfootEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_weapon) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemweaponEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweaponEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweaponEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_face) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemfaceEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfaceEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfaceEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_jewery) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemjeweryEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemjeweryEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemjeweryEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_pack) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itempackEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itempackEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itempackEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_ring) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.equiptab.itemringEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemringEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemringEffect",false);
							end;
							
							if (TheOthersEquipIsAwake(cs_pos_honor) == true) then 			
								--特效
								if Win_IsVisible("UI.gameui.exequipdlg.itemhonorEffect") == false then
									Win_ShowWidget("UI.gameui.exequipdlg.itemhonorEffect",true);
								end;
							else
								Win_ShowWidget("UI.gameui.exequipdlg.itemhonorEffect",false);
							end;
						else
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemheadEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemhandEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemdressEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfootEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemweaponEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemfaceEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemjeweryEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itempackEffect",false);
							Win_ShowWidget("UI.gameui.exequipdlg.equiptab.itemringEffect",false);
						end;					
					end;
					
					children=
					{
						--角色示意图
						charactor = 
						{
							type = "WIDGET",
							rect = {71,-15,121,142},
							edgecolor={0,0,0,0},											
							style=wgtstyle_renderbuffer,
							custombuffer=custom_buffer_otherstate,
							enable=0,
						},
							
						--帽子
						itemhead=
						{								
							type="WIDGET",
							rect={7,5,30,30},
							groupid=0,
							groupstop=0,
							dragindex=cs_pos_head,
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
																				
						},
						
						itemheadEffect =
						{
							type = "WIDGET",
							rect={22,40,1,1},							
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;												
						},	
						
						
						--手套
						itemhand=
						{								
							type="WIDGET",
							rect={7,44,30,30},
							groupid=0,
							groupstop=6,
							dragindex=cs_pos_hand,								
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						itemhandEffect =
						{
							type = "WIDGET",
							rect={21,79,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},		
						
						--服装
						itemdress=
						{
								
							type="WIDGET",
							rect={7,83,30,30},
							groupid=0,
							groupstop=1,
							dragindex=cs_pos_dress,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						itemdressEffect =
						{
							type = "WIDGET",
							rect={21,117,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},	
						
						--鞋子
						itemfoot=
						{
							type="WIDGET",
							rect={7,122,30,30},
							groupid=0,
							groupstop=7,
							dragindex=cs_pos_foot,							
							dragtype=ui_drag_type_equipother,					
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						
						itemfootEffect =
						{
							type = "WIDGET",
							rect={21,155,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},	
						
						
						--武器
						itemweapon=
						{								
							type="WIDGET",
							rect={7,160,30,30},
							groupid=0,
							groupstop=4,
							dragindex=cs_pos_weapon,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																							
													
						},
						
						itemweaponEffect =
						{
							type = "WIDGET",
							rect={21,194,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},	
						
						
						--面饰
						itemface=
						{
								
							type="WIDGET",
							rect={219,5,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_face,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",										
													
						},
						
						itemfaceEffect =
						{
							type = "WIDGET",
							rect={233,40,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},	
						
						--项链
						itemjewery=
						{
								
							type="WIDGET",
							rect={219,44,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_jewery,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						
							
						itemjeweryEffect =
						{
							type = "WIDGET",
							rect={233,79,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},
						
						
						--背包
						itempack=
						{								
							type="WIDGET",
							rect={219,83,30,30},		
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_pack,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						itempackEffect =
						{
							type = "WIDGET",
							rect={233,117,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},	
						
						
						--戒指
						itemring=
						{								
							type="WIDGET",
							rect={219,122,30,30},		
							groupid=0,
							groupstop=5,
							dragindex=cs_pos_ring,								
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						itemringEffect =
						{
							type = "WIDGET",
							rect={233,156,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
						},
						
						
						--盾牌
						itemguard=
						{								
							type="WIDGET",							
							rect={219,160,30,30},							
							groupid=0,
							groupstop=3,
							dragindex=cs_pos_guard,							
							dragtype=ui_drag_type_equipother,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						pointfire1= 
						{
							type = "WIDGET",
							rect = { 78,12,42,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
						},
						pointfire2= 
						{
							type = "WIDGET",
							rect = { 90,12,12,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
							enable = 0;
						},
						pointfire3= 
						{
							type = "WIDGET",
							rect = { 102,12,12,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
							enable = 0;
						},
					};
				};
				

				AwakeEquipListLeft=
				{
					type="LISTBOX",
					rect={-6,88,30,200},

					children=
					{
						--帽子
						AwakeitemheadBtn=
						{
							type="WIDGET",
							rect={0,5,30,30},
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_head,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,								
								};
							},
						},
						
						--手套
						AwakeitemhandBtn=
						{
								
							type="WIDGET",
							rect={0,45,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,						
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_hand,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,									
								};
							},
						},
										
						--服装
						AwakeitemdressBtn=
						{
								
							type="WIDGET",
							rect={0,84,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_dress,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",
									updatemute=1,
									initlayer=1,									
								};
							},
						},
						
						--鞋子
						AwakeitemfootBtn=
						{
								
							type="WIDGET",
							rect={0,123,30,30},						
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",							
							updatemute=1,
							initlayer = -1,		
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_foot,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,											
								};
							},
						},

						--武器
						AwakeitemweaponBtn=
						{
								
							type="WIDGET",
							rect={0,162,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",												
							updatemute=1,
							initlayer = -1,
						
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_weapon,									
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",										
									updatemute=1,
									initlayer=1,	
								};
							},
						},		
					},					
				};
					
				AwakeEquipListRight=
				{
					type="LISTBOX",
					rect={302,88,30,160},
					
					children=
					{
						--面饰
						AwakeitemfaceBtn=
						{
								
							type="WIDGET",
							rect={0,5,30,30},						
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,		
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_face,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,															
								};
							},
						},
						
						--项链
						AwakeitemjeweryBtn=
						{
								
							type="WIDGET",
							rect={0,45,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_jewery,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	
								};
							},
						},
						
						--背包
						AwakeitempackBtn=
						{
								
							type="WIDGET",
							rect={0,84,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_pack,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	
								};
							},
						},
						
						
						--戒指
						AwakeitemringBtn=
						{
								
							type="WIDGET",
							rect={0,123,30,30},								
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,						
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_ring,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	
								};
							},
						},
						
						--法宝
						AwaketalismanBtn=
						{
							type="WIDGET",
							rect={-308,325,30,30},								
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_honor,							
									dragtype=ui_drag_type_othersawakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	
								},
							},
						},		
					},
				};
				
				
				--法宝
				talismantab=
				{
					type="TABWIN",
					rect={33,88,264,206},
					tabrect={73,-2,72,22},
					tabcover="res/uires/equipdlg/talismantab.gsa",
					bkimage="res/uires/equipdlg/talismanbk.gsa",
					bkimagepos={2, 2},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=0,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if Win_IsVisible("UI.gameui.exequipdlg.AwakeEquipListLeft") == true or Win_IsVisible("UI.gameui.exequipdlg.AwakeEquipListRight") == true then 
							Win_ShowWidget("UI.gameui.exequipdlg.AwakeEquipListLeft",false);
							Win_ShowWidget("UI.gameui.exequipdlg.AwakeEquipListRight",false);
						end;
					end;
					
					children=
					{
						goldpos=
						{
							type="WIDGET",
							rect={119,13,36,36},										
							dragtype=ui_drag_type_othertalisman,
							dragindex=cs_talisman_jin,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_jin);
							end;
						},
						
						goldposeffect =
						{
							type = "WIDGET",
							rect={137,31,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						woodpos=
						{
							type="WIDGET",
							rect={163,145,36,36},																	
							dragtype=ui_drag_type_othertalisman,
							dragindex=cs_talisman_mu,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_mu);
							end;
						},
						
						woodposeffect =
						{
							type = "WIDGET",
							rect={181,163,1,1};							
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						waterpos=
						{
							type="WIDGET",
							rect={194,66,36,36},										
							dragtype=ui_drag_type_othertalisman,
							dragindex=cs_talisman_shui,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_shui);
							end;
						},
						
						waterposeffect =
						{
							type = "WIDGET",
							rect={212,84,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						firepos=
						{
							type="WIDGET",
							rect={74,146,36,36},										
							dragtype=ui_drag_type_othertalisman,
							dragindex=cs_talisman_huo,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_huo);
							end;
						},
						
						fireposeffect =
						{
							type = "WIDGET",
							rect={92,164,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						soilpos=
						{
							type="WIDGET",
							rect={43,65,36,36},										
							dragtype=ui_drag_type_othertalisman,
							dragindex=cs_talisman_tu,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_tu);
							end;
						},
						
						soilposeffect =
						{
							type = "WIDGET",
							rect={61,83,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						specialskill=
						{
							type="WIDGET",
							rect={118,86,36,36},										
							dragtype=ui_drag_type_othertalismanskill,
							dragindex=0,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
						},
						
						specialeffect=
						{
							type = "WIDGET",
							rect={136,104,1,1};
							effect={{name="TFX9303.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						totaleffect=
						{
							type = "WIDGET",
							rect={136,104,1,1};
							effect={{name="TFX9314.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						gold_watereffect=
						{
							type = "WIDGET",
							rect={174,55,1,1};
							effect={{name="TFX9309.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						water_woodeffect=
						{
							type = "WIDGET",
							rect={197,123,1,1};
							effect={{name="TFX9310.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						water_fireeffect=
						{
							type = "WIDGET",
							rect={136,166,1,1};
							effect={{name="TFX9311.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						fire_soileffect=
						{
							type = "WIDGET",
							rect={77,123,1,1};
							effect={{name="TFX9312.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						soil_goldeffect=
						{
							type = "WIDGET",
							rect={99,55,1,1};
							effect={{name="TFX9313.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
					},
				},
				
				--荣誉勋章
				itemhonor=
				{
						
					type="WIDGET",							
					rect={38,417,30,30},							
					dragindex=cs_pos_honor,							
					dragtype=ui_drag_type_equipother,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				itemhonorEffect =
				{
					type = "WIDGET",
					rect={50,451,1,1},
					effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
					visible=0;
				},	
						
				--称号
				title = 
				{
					type = "LABEL",
					rect={41,49,172,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					style=wgtstyle_clipself,
					enable=0;					
				},
				
				--成就
				achievepoint = 
				{
					type = "LABEL",
					rect = { 125,410,122,12 },
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12;
					enable=0;
				},
				
				--名誉
				reputation = 
				{
					type = "LABEL",
					rect = { 125,435,122,12 },
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12;
					enable=0;
				},
				--左边
				STR = 
				{
					type = "LABEL",
					rect = { 42,343,106,16 },
					captionrect = { 30,2,76,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响攻击力\n及最大负重";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.exequipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.exequipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.exequipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.exequipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							  
				},
				
				DEX = 
				{
					type = "LABEL",
					rect = { 42,383,106,16 },
					captionrect = { 30,2,76,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响命中";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.exequipdlg.Hit",color,value_channel_color_draw);
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.exequipdlg.Hit",color,value_channel_color_draw);
							 end;

					
				},
				
				AGI = 
				{
					type = "LABEL",
					rect = { 42,363,106,16 },
					captionrect = { 30,2,76,12 },					
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响防御";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.exequipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.exequipdlg.Def",color,value_channel_color_draw);
							 end;
				},
				
				VIT = 
				{
					type = "LABEL",
					rect = { 179,343,106,16 },
					captionrect = { 30,2,76,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响生命力最大值";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				INT = 
				{
					type = "LABEL",
					rect = { 179,363,106,16 },
					captionrect = { 30,2,76,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法攻击力";		
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.exequipdlg.Matk",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.exequipdlg.Matk",color,value_channel_color_draw); 							 
							 end;

					
				},
				
				SPI = 
				{
					type = "LABEL",
					rect = { 179,383,106,16 },
					captionrect = { 30,2,76,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法防御力以及\n法力点数最大值",
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.exequipdlg.Mdef",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.exequipdlg.Mdef",color,value_channel_color_draw); 							 
							 end;

				},
				
				--右边
				MaxATK = 
				{
					type = "LABEL",
					rect = {36,299,93,16},
					captionrect = { 53,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n大物理攻击力",
				},			
				
				MinATK = 
				{
					type = "LABEL",
					rect = { 36,314,93,16},
					captionrect = { 53,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,											
					tiptext="角色当前的最\n小物理攻击力",
				},
				
				Def = 
				{
					type = "LABEL",
					rect = { 146,299,70,16},
					captionrect = { 30,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响怪物物理\n攻击的命中率",
					
				},
				
				Matk = 
				{
					type = "LABEL",
					rect = {222,299,70,16},
					captionrect = {30,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响魔法技\n能伤害力",
					
				},
				
				Mdef = 
				{
					type = "LABEL",
					rect = {222,314,70,16},
					captionrect = {30,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响对魔法攻\n击的抵抗力",
					
				},
				
				Hit = 
				{
					type = "LABEL",
					rect = {146,314,70,16},
					captionrect = {30,2,40,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响攻击\n的准确率",
					
				},
			};--exequipdlg children
			
		};--exequipdlg 玩家在游戏中的状态
		
		yesnodialog=
		{
			type = "DIALOG",
			rect = { 0, 0, 246, 148},
			textsize=12,
			textstyle=dt_left;
			bkimage="res/uires/gameui/yesnodlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_customclose + wgtstyle_alphawin,
			
			OnOk=function()
				IGameDlgSendResult(1);
				Win_ShowWidget("UI.gameui.yesnodialog",false);
			end;
			
			OnCancel=function()
				IGameDlgSendResult(0);
				Win_ShowWidget("UI.gameui.yesnodialog",false);
			end;
			
			children=
			{
				textlabel=
				{
					type="LABEL",
					rect = { 4, 37, 240,72 },
					textsize=12,
					rowspace=4,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
					richmode=ui_richmode_color+ui_richmode_hlink,
					enable=1,		
					initlayer=0;
					pluslayer=0;
					minheight=72;
					ysizeable=1;
				};

				okbtn=
				{
					type="BUTTON",
					rect={22, 115,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},				
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={156, 115,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},				
				},
			};
		};
		
		changeequipdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 272, 302},
			captionrect={56,22,140,12},
			textsize=12,
			textfont=1,			
			bkimage="res/uires/equipdlg/changeequipdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_customclose,
			tabstop=2,
			visible=0,	
			updatemute=1,			
			
			OnSelfShow=function()
				if Win_IsVisible("UI.gameui.equipdlg") then
					Win_AlignWidget("UI.gameui.changeequipdlg","UI.gameui.equipdlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
					end;
				end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.changeequipdlg",false);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.changeequipdlg",false);
				end;
			
			children=
			{
				statusbtn=
				{
					type="WIDGET",
					rect = {7, 9, 30, 30},
					bkimage="res/uires/waredlg/chgwearonekeybk.gsa",
					enable = 1,
					dragtype=ui_drag_type_chgwearonekey,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					visible = 0,
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 241,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 219,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("一键换装");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				contain=
				{
					type="CONTAINER",
					rect={34,52,226,199},
					
					children=
					{
						--角色示意图
						charactor = 
						{
							type = "WIDGET",
							rect = {52,8,120,143},
							edgecolor={0,0,0,0},											
							style=wgtstyle_renderbuffer+wgtstyle_static+wgtstyle_clipself;
							custombuffer=custom_buffer_chgcharacter,
							updatemute=1,
						},
						
						--帽子
						itemhead=
						{
							type="WIDGET",
							rect={11,5,30,30},
							groupid=0,
							groupstop=0,
							dragindex=cs_pos_head,
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--手套
						itemhand=
						{
								
							type="WIDGET",
							rect={11,44,30,30},
							groupid=0,
							groupstop=6,
							dragindex=cs_pos_hand,								
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
										
						--服装
						itemdress=
						{
								
							type="WIDGET",
							rect={11,84,30,30},
							groupid=0,
							groupstop=1,
							dragindex=cs_pos_dress,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--鞋子
						itemfoot=
						{
								
							type="WIDGET",
							rect={11,123,30,30},
							groupid=0,
							groupstop=7,
							dragindex=cs_pos_foot,							
							dragtype=ui_drag_type_chgequiped,					
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--面饰
						itemface=
						{
								
							type="WIDGET",
							rect={184,5,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_face,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--项链
						itemjewery=
						{
								
							type="WIDGET",
							rect={184,44,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_jewery,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--背包
						itempack=
						{
								
							type="WIDGET",
							rect={184,84,30,30},		
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_pack,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						
						--戒指
						itemring=
						{
								
							type="WIDGET",
							rect={184,123,30,30},		
							groupid=0,
							groupstop=5,
							dragindex=cs_pos_ring,								
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						--武器
						itemweapon=
						{
								
							type="WIDGET",
							rect={11,161,30,30},
							groupid=0,
							groupstop=4,
							dragindex=cs_pos_weapon,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
									
						--盾牌
						itemguard=
						{
								
							type="WIDGET",							
							rect={184,161,30,30},							
							groupid=0,
							groupstop=3,
							dragindex=cs_pos_guard,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						--荣誉勋章
						itemhonor=
						{
								
							type="WIDGET",							
							rect={98,161,30,30},							
							dragindex=cs_pos_honor,							
							dragtype=ui_drag_type_chgequiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},						
					};
				};
				
				setbtn=
				{
					type="BUTTON",
					rect={48, 262, 90, 28},
					bkimage="res/uires/equipdlg/setchgwearbtn.gsa",
					OnClick=function()
						SetChgWearsOneKey();
					end;
				};
				
				changebtn=
				{
					type="BUTTON",
					rect={157,262,90,28},
					bkimage="res/uires/equipdlg/changeequipbtn.gsa",
					tiptext="换装快捷键为Alt+X",
					OnClick=function()
						ChangeWearsOneKey();
					end;
				};
				

			};
		};
		
		equipdlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 304, 628},
			captionrect={46,52,254,12},
			textsize=12,
			textstyle=dt_left;
			bkimage="res/uires/equipdlg/equipdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_customclose + wgtstyle_alphawin,
			tabstop=2,
			visible=0,	
			soundid={-1, -1, -1, -1, 1006, 1001},

			
			mornitor={value_channel_dragging},
			
			OnUpdate=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1101");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1102");
				UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep1102");
			end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.equipdlg",false);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.equipdlg",false);
				Win_ShowWidget("UI.gameui.equipdlg.talismanswitchdlg", false);
				local x,y = Win_GetPos("UI.gameui.equipdlg.itemhonor");
				Win_SetPos("UI.gameui.equipdlg.AwakeEquipListRight.AwaketalismanBtn",x - 50,y - 30);
				end;
			
			OnSelfHide=function()
				ConfirmUsePoints(false)
				if Win_IsVisible("UI.gameui.titledlg") then
				Win_ShowWidget("UI.gameui.titledlg",false);
				end;
				
				if Win_IsChecked("UI.gameui.equipdlg.equiptab") then
					RequestNewbieHelp(help_equipdlg_equip,0);
				elseif Win_IsChecked("UI.gameui.equipdlg.attrtab") then
					--RequestNewbieHelp(help_equipdlg_attr,0);
				end;
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1101");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1102");
				UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep1102");
				
				if Win_IsVisible("UI.gameui.recycledlg") then
					Win_ShowWidget("UI.gameui.recycledlg",false);
				end;
				
				-- haifenghe
				if Win_IsVisible("UI.gameui.timelimiteddlg") then
					Win_ShowWidget("UI.gameui.timelimiteddlg", false);
				end;
			end;
			
			OnSelfShow=function()
				PushNewbieTips(37);
				if Win_IsVisible("UI.gameui.exequipdlg") then
					Win_AlignWidget("UI.gameui.equipdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
					Win_AlignWidget("UI.gameui.exequipdlg","UI.gameui.equipdlg",aligntype_winrect,alignstyle_top_in+alignstyle_right_out);
				else
					Win_AlignWidget("UI.gameui.equipdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
				
				Win_SelectSelf("UI.gameui.equipdlg.equiptab");
				
				QueryNewbieNextStep(1101);
				UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep3");
				
				Win_SetCheck("UI.gameui.equipdlg.viptitlecheck",UpdateShowVipTitleInfo());
				
				local vipinfo = GetVipInfo();
				if vipinfo.RealVip==1 then
					Win_EnableWidget("UI.gameui.equipdlg.viptitlecheck",true);
				else
					Win_EnableWidget("UI.gameui.equipdlg.viptitlecheck",false);
				end;
				
				local bshow = GetSelfWingShow();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showhidewing",bshow==0);
				bshow = GetSelfRingSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showringsoul",bshow==0);
				bshow = GetSelfWingSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showwingsoul",bshow==0);
				bshow = GetSelfShoeRing();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showshoering",bshow==0);
				bshow = GetSelfNeckRingSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showneckring",bshow==0);				
				bshow = GetSelfCapSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showcapsoul",bshow==0);
				bshow = GetSelfFaceSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showfacesoul",bshow==0);
				bshow = GetSelfClothSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showclothsoul",bshow==0);
				bshow = GetSelfHonorSoul();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showhonorsoul",bshow==0);
				bshow = GetBlessShow();
				Win_SetCheck("UI.gameui.equipdlg.equiptab.showblesseffect",bshow==0);
				if 1 == GetSwitchTalisman() then
					Win_SetCoverPic("UI.gameui.equipdlg.equiptab","");
					Win_SetCoverPic("UI.gameui.equipdlg.attrtab","");
					Win_SetCoverPic("UI.gameui.equipdlg.talismantab","");
				elseif 0 == GetSwitchTalisman() and 2 == Win_GetSelect("UI.gameui.equipdlg", 0) then
					Win_SetCoverPic("UI.gameui.equipdlg.talismantab","res/uires/equipdlg/cover.gsa");
				end;
				
				if global_data.recycle_btn_chk==true then
					Recycle_checkShowDlg();
				end;
				
				---[[ 时装 by haifenghe
				if global_data.timelimited_btn_chk == true then
					TimeLimited_ShowDlg();
				end;
				--]]

				--觉醒界面更新
				if Win_IsVisible("UI.gameui.equipdlg") then
					UI.children.gameui.UpdateAwakeEquipDlg();
				end;
			end;
			
			OnUpdateValue=function()
				if Win_IsChecked("UI.gameui.equipdlg.talismantab") then
					local ret = GetTalismanInfo(0);
					local str = tostring(ret);
					local exist_1 = string.find(str, "1");
					local exist_2 = string.find(str, "2");
					local exist_3 = string.find(str, "3");
					local exist_4 = string.find(str, "4");
					local exist_5 = string.find(str, "5");
					if exist_1 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.goldposeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.goldposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.goldposeffect", false);
					end;
					if exist_2 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.woodposeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.woodposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.woodposeffect", false);
					end;
					if exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.waterposeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.waterposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.waterposeffect", false);
					end;
					if exist_4 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.fireposeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.fireposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.fireposeffect", false);
					end;
					if exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.soilposeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.soilposeffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.soilposeffect", false);
					end;
					if exist_1 ~= nil and exist_2 ~= nil and exist_3 ~= nil and exist_4 ~= nil and exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.specialeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.specialeffect", true);
						end;
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.totaleffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.totaleffect", true);
						end;
					else 
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.specialeffect", false);
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.totaleffect", false);
					end;
					
					if exist_1 ~= nil and exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.gold_watereffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.gold_watereffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.gold_watereffect", false);
					end;
					
					if exist_2 ~= nil and exist_3 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.water_woodeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.water_woodeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.water_woodeffect", false);
					end;
					
					if exist_2 ~= nil and exist_4 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.water_fireeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.water_fireeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.water_fireeffect", false);
					end;
					
					if exist_4 ~= nil and exist_5 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.fire_soileffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.fire_soileffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.fire_soileffect", false);
					end;
					
					if exist_5 ~= nil and exist_1 ~= nil then
						if not Win_IsVisible("UI.gameui.equipdlg.talismantab.soil_goldeffect") then
							Win_ShowWidget("UI.gameui.equipdlg.talismantab.soil_goldeffect", true);
						end;
					else
						Win_ShowWidget("UI.gameui.equipdlg.talismantab.soil_goldeffect", false);
					end;
				end;
				
				if Win_GetMouseWgtPath() ~= "UI.gameui.equipdlg.talismanswitchdlg" and Win_GetMouseWgtPath() ~= "UI.gameui.equipdlg.itemhonor" 
				   and Win_GetMouseWgtPath() ~= "UI.gameui.equipdlg.talismanswitchdlg.oldtalisman" and Win_GetMouseWgtPath() ~= "UI.gameui.equipdlg.talismanswitchdlg.newtalisman" then
					Win_ShowWidget("UI.gameui.equipdlg.talismanswitchdlg", false);
					local x,y = Win_GetPos("UI.gameui.equipdlg.itemhonor");
					Win_SetPos("UI.gameui.equipdlg.AwakeEquipListRight.AwaketalismanBtn",x - 44,y - 30);
				end;
				
				if 2 == Win_GetSelect("UI.gameui.equipdlg", 0) and 0 == GetSwitchTalisman() then
					Win_SetCoverPic("UI.gameui.equipdlg.talismantab","res/uires/equipdlg/cover.gsa");
				else
					Win_SetCoverPic("UI.gameui.equipdlg.talismantab","");
				end; 
			end;
				

		   --图片
			---[[SetAwakeEquipPic = function(path,name)
				--str = string.format("res/awakeEquipicon/Tf_S"..name..".gsa");
				--Win_SetText(path, str, value_channel_backpic);
			--end;
			--]]
			children=
			{
				AwakeEquipListLeft=
				{
					type="LISTBOX",
					rect={-7,126,30,200},

					children=
					{
						--帽子
						AwakeitemheadBtn=
						{
							type="WIDGET",
							rect={0,5,30,30},
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_head,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,	
										
									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_head);
									end;							
								};
							},
						},
						
						--手套
						AwakeitemhandBtn=
						{
								
							type="WIDGET",
							rect={0,45,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,						
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_hand,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,	
										
									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_hand);
									end;								
								};
							},
						},
										
						--服装
						AwakeitemdressBtn=
						{
								
							type="WIDGET",
							rect={0,84,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,	
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_dress,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",
									updatemute=1,
									initlayer=1,	
										
									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_dress);
									end;								
								};
							},
						},
						
						--鞋子
						AwakeitemfootBtn=
						{
								
							type="WIDGET",
							rect={0,123,30,30},						
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",							
							updatemute=1,
							initlayer = -1,		
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_foot,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,
									tipwidget="UI.gameui.ScrnTooltip",									
									updatemute=1,
									initlayer=1,	
										
									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_foot);
									end;										
								};
							},
						},

						--武器
						AwakeitemweaponBtn=
						{
								
							type="WIDGET",
							rect={0,162,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",												
							updatemute=1,
							initlayer = -1,
						
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_weapon,									
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",										
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_weapon);
									end;
								};
							},
						},					
					},
				};
				
				AwakeEquipListRight=
				{
					type="LISTBOX",
					rect={303,126,30,160},
					
					children=
					{
						--面饰
						AwakeitemfaceBtn=
						{
								
							type="WIDGET",
							rect={0,5,30,30},						
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,		
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_face,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_face);
									end;							
									
								};
							},
						},
						
						--项链
						AwakeitemjeweryBtn=
						{
								
							type="WIDGET",
							rect={0,45,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_jewery,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_jewery);
									end;
								};
							},
						},
						
						--背包
						AwakeitempackBtn=
						{
								
							type="WIDGET",
							rect={0,84,30,30},							
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_pack,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_pack);
									end;
								};
							},
						},
						
						
						--戒指
						AwakeitemringBtn=
						{
								
							type="WIDGET",
							rect={0,123,30,30},								
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,						
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_ring,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_ring);
									end;
								};
							},
						},
						
						--法宝
						AwaketalismanBtn=
						{
							type="WIDGET",
							rect={-312,271,30,30},								
							bkimage= "res/uires/equipdlg/awakeEquipBG.gsa",
							updatemute=1,
							initlayer = -1,
							
							children={
								AwakeEquipPicBG=
								{	
									type="BUTTON",
									rect={0,0,30,30};
									dragindex=cs_pos_honor,							
									dragtype=ui_drag_type_awakeequiped,
									style=wgtstyle_renderitem,	
									tipwidget="UI.gameui.ScrnTooltip",											
									updatemute=1,
									initlayer=1,	

									OnDBClick=function()
										UnLoadAwakeEquip(cs_pos_honor);
									end;							
								};
							},
						},
						
					},
				};
				
				equiptab=
				{
					type="TABWIN",
					rect={35,125,257,198},
					tabrect={-2,-2,72,22},
					tabcover="res/uires/equipdlg/equiptab.gsa",
					tabwintype=tabwin_type_up,
					bkimage="res/uires/equipdlg/equiptabbk.gsa",
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=1,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							--RequestNewbieHelp(help_equipdlg_attr,0);
							RequestNewbieHelp(help_equipdlg_equip);							
						end;
						Win_SetCoverPic("UI.gameui.equipdlg.talismantab","");
					end;
					
					OnMsgBoxOk=function()
						SendOpenMsg();
					end;
				
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_equipdlg_equip,
								offsetx=-101,
								offsety=-130,
							},
						};
						
						--角色示意图
						charactor = 
						{
							type = "WIDGET",
							rect = {70,12,121,142},
							edgecolor={0,0,0,0},											
							style=wgtstyle_renderbuffer+wgtstyle_static+wgtstyle_clipself;
							custombuffer=custom_buffer_character,
							updatemute=1,
						},
						
						
						showrecycledlg = 
						{
							type = "BUTTON",
							rect={156,13,20,15};
							bkimage="res/uires/recycle/recyclebtn.gsa",
							tiptext="是否显示轮回界面",
							bkimagepos={0,-2};
							visible=1,
							
							OnClick=function(bcheck)
								if global_data.recycle_btn_chk==false then
									Recycle_checkShowDlg();
								else
									Win_ShowWidget("UI.gameui.recycledlg",false);
									global_data.recycle_btn_chk = false;
								end;
							end;						    
						},
						---[[ 时装 by haifenghe
						showtimelimiteddlg = 
						{
							type = "BUTTON",
							rect={188,164,20,15};
							bkimage="res/uires/recycle/timelimitedbtn.gsa",
							tiptext="是否显示时装界面",
							bkimagepos={0,-2};
							visible=1,
							
							OnClick=function(bcheck)
								if global_data.timelimited_btn_chk == false then
									TimeLimited_ShowDlg();
									global_data.timelimited_btn_chk = true;
								else
									Win_ShowWidget("UI.gameui.timelimiteddlg", false);
									global_data.timelimited_btn_chk = false;
								end;
							end;
						},
						--]]
						
						--haifenghe
						showblesseffect = 
						{
							type = "CHECK",
							rect={192,10,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的祝福套装特效",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetBlessHide(0);
								else
									SetBlessHide(1);
								end;
							end;
						},
						
						pointfire1= 
						{
							type = "WIDGET",
							rect = { 78,12,42,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
						},
						pointfire2= 
						{
							type = "WIDGET",
							rect = { 90,12,12,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
							enable = 0;
						},
						pointfire3= 
						{
							type = "WIDGET",
							rect = { 102,12,12,13 },
							--bkimage="res/texticon/246.gsa",
							--effectpicpos={0,0},
							--drawflag=drawflag_draw_effect,
							enable = 0;
						},
						
						showhidewing = 
						{
							type = "CHECK",
							rect={192,78,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的背包",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfWingShow(0);
								else
									SetSelfWingShow(1);
								end;
							end;						    
						},	
						showwingsoul = 
						{
							type = "CHECK",
							rect={192,98,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的羽灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfWingSoul(0);
								else
									SetSelfWingSoul(1);
								end;
							end;						    
						},
						showringsoul = 
						{
							type = "CHECK",
							rect={192,123,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的戒灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfRingSoul(0);
								else
									SetSelfRingSoul(1);
								end;
							end;						    
						},
						
						
						showshoering = 
						{
							type = "CHECK",
							rect={44,123,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的鞋灵和脚印",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfShoeRing(0);
								else
									SetSelfShoeRing(1);
								end;
							end;						    
						},
						
						showcapsoul = 
						{
							type = "CHECK",
							rect={44,13,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的帽灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfCapSoul(0);
								else
									SetSelfCapSoul(1);
								end;
							end;						    
						},
						
						showfacesoul = 
						{
							type = "CHECK",
							rect={192,30,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的面灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfFaceSoul(0);
								else
									SetSelfFaceSoul(1);
								end;
							end;						    
						},
						
						showclothsoul = 
						{
							type = "CHECK",
							rect={44,85,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的衣灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfClothSoul(0);
								else
									SetSelfClothSoul(1);
								end;
							end;						    
						},
						
						showhonorsoul = 
						{
							type = "CHECK",
							rect={44,166,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的法宝灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfHonorSoul(0);
								else
									SetSelfHonorSoul(1);
								end;
							end;						    
						},
						
						showneckring = 
						{
							type = "CHECK",
							rect={192,52,20,15};
							bkimage="res/uires/newcommon/checkbox.gsa",
							tiptext="是否显示自己的项灵",
							bkimagepos={0,-2};
							visible=1,
							
							OnCheck=function(bcheck)
								if bcheck == 1 then
									SetSelfNeckRingSoul(0);
								else
									SetSelfNeckRingSoul(1);
								end;
							end;						    
						},
						
						changetab=
						{
							type="BUTTON",
							rect={80,153,20,20},
							bkimage="res/uires/equipdlg/changebtn.gsa",
							--style=wgtstyle_alphawin,
							soundid={1003},
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.changeequipdlg",true);
								end;
						};
						
						awakeequipbtn=
						{
							type="BUTTON",
							rect={101,150,76,28},
							bkimage="res/uires/equipdlg/awakeequipbtn.gsa",
							--style=wgtstyle_alphawin,
							soundid={1003},
							
							OnClick=function()
								if Win_IsVisible("UI.gameui.equipdlg.AwakeEquipListLeft") == false and Win_IsVisible("UI.gameui.equipdlg.AwakeEquipListRight") == false then
									Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",true);
									Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",true);
								else
									Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
									Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
								end;
							end;
						};
						
						magicstorebtn=
						{
							type="BUTTON",
							rect={75,175,103,28},
							bkimage="res/uires/equipdlg/magicstorebtn.gsa",
							--style=wgtstyle_alphawin,
							soundid={1003},
							
							OnClick=function()
								-- 变装动作状态禁止打开魔法衣橱
								if IsPlayerInAvatarActStatus() == 0 then
									if IsOpenMagicStore() == 1 then 
										--Win_ShowWidget("UI.gameui.magicstoredlg",true);
										SendOpenMsg();
									else
										Win_ShowMsgBox("魔法衣橱是用来收集和展示变装的系统，开启魔法衣橱需扣除10个魔法衣橱钥匙，是否确认开启？","系统消息",ui_msgid_yesno,"UI.gameui.equipdlg.equiptab");
									end;								
								end;
							end;
						};
				
						--帽子
						itemhead=
						{
							type="WIDGET",
							rect={7,5,30,30},
							groupid=0,
							groupstop=0,
							dragindex=cs_pos_head,
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,										
						},
						
						itemheadEffect =
						{
							type = "WIDGET",
							rect={22,40,1,1},							
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;							
							initlayer=11;					
						},								
		
						--手套
						itemhand=
						{
								
							type="WIDGET",
							rect={7,45,30,30},
							groupid=0,
							groupstop=6,
							dragindex=cs_pos_hand,								
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						itemhandEffect =
						{
							type = "WIDGET",
							rect={21,79,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},
										
						--服装
						itemdress=
						{
								
							type="WIDGET",
							rect={7,84,30,30},
							groupid=0,
							groupstop=1,
							dragindex=cs_pos_dress,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						itemdressEffect =
						{
							type = "WIDGET",
							rect={21,117,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--鞋子
						itemfoot=
						{
								
							type="WIDGET",
							rect={7,123,30,30},
							groupid=0,
							groupstop=7,
							dragindex=cs_pos_foot,							
							dragtype=ui_drag_type_equiped,					
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},

					    itemfootEffect =
						{
							type = "WIDGET",
							rect={21,155,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--武器
						itemweapon=
						{
								
							type="WIDGET",
							rect={7,162,30,30},
							groupid=0,
							groupstop=4,
							dragindex=cs_pos_weapon,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
													
						},
						
						itemweaponEffect =
						{
							type = "WIDGET",
							rect={21,194,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--面饰
						itemface=
						{
								
							type="WIDGET",
							rect={219,5,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_face,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem ,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						itemfaceEffect =
						{
							type = "WIDGET",
							rect={233,40,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--项链
						itemjewery=
						{
								
							type="WIDGET",
							rect={219,45,30,30},
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_jewery,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						itemjeweryEffect =
						{
							type = "WIDGET",
							rect={233,79,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--背包
						itempack=
						{
								
							type="WIDGET",
							rect={219,84,30,30},		
							groupid=0,
							groupstop=2,
							dragindex=cs_pos_pack,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
						
						itempackEffect =
						{
							type = "WIDGET",
							rect={233,117,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--戒指
						itemring=
						{
								
							type="WIDGET",
							rect={219,123,30,30},		
							groupid=0,
							groupstop=5,
							dragindex=cs_pos_ring,								
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
					
						itemringEffect =
						{
							type = "WIDGET",
							rect={233,156,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						--盾牌
						itemguard=
						{
								
							type="WIDGET",							
							rect={219,162,30,30},							
							groupid=0,
							groupstop=3,
							dragindex=cs_pos_guard,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
							updatemute=1,
						},
					};
					
				};
				
				attrtab=
				{
					type="TABWIN",
					rect={35,125,257,198},
					tabrect={72,-2,72,22},
					tabcover="res/uires/equipdlg/attrtab.gsa",
					bkimage="res/uires/equipdlg/secattrbk.gsa",
					bkimagepos={2, 2},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=0,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							RequestNewbieHelp(help_equipdlg_equip,0);
							if(bcheck == 1) then 
								Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
								Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
							end;
							--RequestNewbieHelp(help_equipdlg_attr);
						end;
						Win_SetCoverPic("UI.gameui.equipdlg.talismantab","");
					end;
					
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_equipdlg_attr,
								offsetx=-202,
								offsety=-113,
							},
							
						};
						
						hurtabsorb=
						{
							type="LABEL",
							rect={11,11,135,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11物理伤害吸收：/C00当角色受\n到普通攻击和物理属性的\n技能攻击的时候，所吸收\n掉的伤害数值与百分比；";
							updatemute=1,
						};
						
						mhurtabsorb=
						{
							type="LABEL",
							rect={11,35,135,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11魔法伤害吸收：/C00当角色受\n到魔法属性的技能攻击的\n时候，所吸收掉的伤害数\n值与百分比；";
							updatemute=1,
						};
						
						critical=
						{
							type="LABEL",
							rect={11,58,110,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11物理爆击率：/C00表示获得2倍\n以上物理伤害的概率。";
							updatemute=1,
						};
						
						mcritical=
						{
							type="LABEL",
							rect={11,81,110,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11魔法爆击率：/C00表示获得2倍\n以上魔法伤害的概率。";
							updatemute=1,
						};
						
						finalhit=
						{
							type="LABEL",
							rect={11,105,110,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11命中率：/C00物理攻\n击击中敌人的概率。";
							updatemute=1,
						};
						
						finalflee=
						{
							type="LABEL",
							rect={11,128,110,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11闪躲率：/C00可以降\n低敌人命中自己的概率";
							updatemute=1,
						};
						
						mspd=
						{
							type="LABEL",
							rect={11,152,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11移动速度：/C00角色每秒钟可\n以走过的屏幕像素距离。";
							updatemute=1,
						};
						
						aspd=
						{
							type="LABEL",
							rect={11,178,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11攻击速度：/C00角色每秒钟可\n攻击的次数。";
							updatemute=1,
						};
						
						firedamage=
						{
							type="LABEL",
							rect={150,11,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11火焰伤害：/C00造成火焰伤害\n的能力。";
							updatemute=1,
						};
						
						icedamage=
						{
							type="LABEL",
							rect={150,35,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11冰冻伤害：/C00造成冰冻伤害\n的能力。";
							updatemute=1,
						};
						
						thunderdamage=
						{
							type="LABEL",
							rect={150,58,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11雷电伤害：/C00造成雷电伤害\n的能力。";
							updatemute=1,
						};
						
						darkdamage=
						{
							type="LABEL",
							rect={150,81,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11黑暗伤害：/C00造成黑暗伤害\n的能力。";
							updatemute=1,
						};
						
						refire=
						{
							type="LABEL",
							rect={150,105,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11火焰抗性：/C00表示受到火焰\n伤害时的防御能力会换算\n为火焰抗性百分比。";
							updatemute=1,
						};
						
						reice=
						{
							type="LABEL",
							rect={150,128,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11冰冻抗性：/C00表示受到冰冻\n伤害时的防御能力会换算\n为冰冻抗性百分比。";
							updatemute=1,
						};
						
						rethunder=
						{
							type="LABEL",
							rect={150,152,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11雷电抗性：/C00表示受到雷电\n伤害时的防御能力会换算\n为雷电抗性百分比。";
							updatemute=1,
						};
						
						redark=
						{
							type="LABEL",
							rect={150,178,90,12},
							textsize=12;
							textstyle=dt_right;
							richmode=ui_richmode_color,
							tiptext="/C11黑暗抗性：/C00表示受到暗黑\n伤害时的防御能力会换算\n为暗黑抗性百分比。";
							updatemute=1,
						};				
					};
				};
				
				--新旧法宝切换弹出框
				talismanswitchdlg=
				{
					type="DIALOG",
					rect={-24,395,46,88},
					bkimage="res/uires/equipdlg/talismanswitch.gsa",
					visible=0,	
					
					children=
					{
						oldtalisman=
						{						
							type="WIDGET",							
							rect={5,5,33,33},							
							dragindex=cs_pos_honor,							
							dragtype=ui_drag_type_equiped,
							style=wgtstyle_renderitem,							
							tipwidget="UI.gameui.ScrnTooltip",	
							
							OnRClick=function()
								SwitchTalisman(0);
							end;
						},
						
						itemtalismanEffect =
						{
							type = "WIDGET",
							rect={22,43,1,1},
							effect={{name="TFX8150.eff", x=0, y=0, loop=1, delay=0}},
							visible=0;
							initlayer=11;
						},	
						
						newtalisman=
						{						
							type="WIDGET",							
							rect={5,46,33,33},							
							dragindex=0,							
							dragtype=ui_drag_type_switchnewtalisman,
							style=wgtstyle_renderitem,
							tiptext="右键点击可在普通法宝和五行法宝之间切换",
							
							OnRClick=function()
								SwitchTalisman(1);
								Win_SelectSelf("UI.gameui.equipdlg.talismantab");
							end;
						},
					};
				},

				--法宝
				talismantab=
				{
					type="TABWIN",
					rect={29,126,264,206},
					tabrect={152,-2,72,22},
					tabcover="res/uires/equipdlg/talismantab.gsa",
					bkimage="res/uires/equipdlg/talismanbk.gsa",
					bkimagepos={2, 2},
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=0,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if(bcheck == 1) then 
							Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
							Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
						end;
						if 0 == GetSwitchTalisman() then
							Win_SetCoverPic("UI.gameui.equipdlg.talismantab","res/uires/equipdlg/cover.gsa");
						end;
					end;
					
					children=
					{
						goldpos=
						{
							type="WIDGET",
							rect={119,13,36,36},										
							dragtype=ui_drag_type_talisman,
							dragindex=cs_talisman_jin,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_jin);
							end;
						},
						
						goldposeffect =
						{
							type = "WIDGET",
							rect={137,31,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						woodpos=
						{
							type="WIDGET",
							rect={163,145,36,36},																	
							dragtype=ui_drag_type_talisman,
							dragindex=cs_talisman_mu,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_mu);
							end;
						},
						
						woodposeffect =
						{
							type = "WIDGET",
							rect={181,163,1,1};							
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						waterpos=
						{
							type="WIDGET",
							rect={194,66,36,36},										
							dragtype=ui_drag_type_talisman,
							dragindex=cs_talisman_shui,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_shui);
							end;
						},
						
						waterposeffect =
						{
							type = "WIDGET",
							rect={212,84,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						firepos=
						{
							type="WIDGET",
							rect={74,146,36,36},										
							dragtype=ui_drag_type_talisman,
							dragindex=cs_talisman_huo,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_huo);
							end;
						},
						
						fireposeffect =
						{
							type = "WIDGET",
							rect={92,164,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						soilpos=
						{
							type="WIDGET",
							rect={43,65,36,36},										
							dragtype=ui_drag_type_talisman,
							dragindex=cs_talisman_tu,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function()
								ActiveTalisman(cs_talisman_tu);
							end;
						},
						
						soilposeffect =
						{
							type = "WIDGET",
							rect={61,83,1,1};
							effect={{name="TFX9302.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						specialskill=
						{
							type="WIDGET",
							rect={118,86,36,36},										
							dragtype=ui_drag_type_talismanskill,
							dragindex=0,
							style=wgtstyle_renderitem + wgtstyle_effect,
							tipwidget="UI.gameui.ScrnTooltip",
						},
						
						specialeffect=
						{
							type = "WIDGET",
							rect={136,104,1,1};
							effect={{name="TFX9303.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;			
						},
						
						totaleffect=
						{
							type = "WIDGET",
							rect={136,104,1,1};
							effect={{name="TFX9314.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						gold_watereffect=
						{
							type = "WIDGET",
							rect={174,55,1,1};
							effect={{name="TFX9309.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						water_woodeffect=
						{
							type = "WIDGET",
							rect={197,123,1,1};
							effect={{name="TFX9310.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						water_fireeffect=
						{
							type = "WIDGET",
							rect={136,166,1,1};
							effect={{name="TFX9311.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						fire_soileffect=
						{
							type = "WIDGET",
							rect={77,123,1,1};
							effect={{name="TFX9312.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
						
						soil_goldeffect=
						{
							type = "WIDGET",
							rect={99,55,1,1};
							effect={{name="TFX9313.eff", x=0, y=0, loop=1, delay=0}},					
							visible=0;	
							initlayer=11;
						},
					},
				},
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 276,18,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 254,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.equipdlg.equiptab") then
							RequestNewbieHelp(help_equipdlg_equip,-1);
						elseif Win_IsChecked("UI.gameui.equipdlg.attrtab") then
							--RequestNewbieHelp(help_equipdlg_attr,-1);
							GameUILogInfo("此功能暂时没有开放！");
						end;
						--[[
						local helpid=GetHelpID("装备");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				baowubtn=
				{
					type="BUTTON",
					rect={253,101,45,20},
					bkimage="res/uires/guzhenxunbao/zhanhunbtn.gsa",	
					--style=wgtstyle_alphawin,
					
					OnClick=function()
						local canopen = CanOpenBaoWuSys();
						if canopen == 1 then
							Win_ShowWidget("UI.gameui.BWrongliandlg", true);
							Win_SetFocus("UI.gameui.BWrongliandlg");
						else
							GameUILogInfo("等级不足30级,无法使用该系统");
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={206,461,43,23},
					bkimage="res/uires/equipdlg/affirmbtn.gsa",	
					--style=wgtstyle_alphawin,
					
					OnClick=function()
						ConfirmUsePoints(true);
						UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1102");
						UI.children.gameui.children.ExSysInputTip.OnCloseByName("SysHelpStep1102");
						end;
				};
				
				restorebtn=
				{
					type="BUTTON",
					rect={252,461,43,23},
					bkimage="res/uires/equipdlg/restorebtn.gsa",
					--style=wgtstyle_alphawin,
					
					OnClick=function()
						ConfirmUsePoints(false);
						UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1102");
						end;
				};

				assignbtn=
				{
					type="BUTTON",
					rect={206,435,90,28},
					bkimage="res/uires/equipdlg/assignbtn.gsa",
					--style=wgtstyle_alphawin,
					
					OnClick=function()
						DistributePoints(false);
						QueryNewbieNextStep(1102);
						end;
				};
								
							
				pkskillbtn=
				{
					type="BUTTON",
					rect={204,530,90,28},
					bkimage="res/uires/equipdlg/pkbtn.gsa",
					--style=wgtstyle_alphawin,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.pkskilldlg") then 
							Win_ShowWidget("UI.gameui.pkskilldlg", false);
						else
							Win_ShowWidget("UI.gameui.pkskilldlg", true);
							Win_SetFocus("UI.gameui.pkskilldlg");
						end;
					end;
				};
				
				
				--荣誉勋章
				itemhonor=
				{						
					type="WIDGET",							
					rect={37,446,33,33},													
					dragindex=0,							
					dragtype=ui_drag_type_switchtalisman,
					style=wgtstyle_renderitem,
					tipwidget="法宝",
					
					OnMouseIn=function()
						Win_ShowWidget("UI.gameui.equipdlg.talismanswitchdlg", true);
						local x,y = Win_GetPos("UI.gameui.equipdlg.itemhonor");
						Win_SetPos("UI.gameui.equipdlg.AwakeEquipListRight.AwaketalismanBtn",x - 90,y - 40);						
					end;			
											
				},
				
				titlesetbtn = 
				{
					type = "CHECK",
					rect={205,69,90,28};
					bkimage="res/uires/equipdlg/titlesetbtn.gsa",
					tiptext="设置称号显示方式",
					extendstyle=ui_btn_style_none,
					framescheme={{0,1,2,3},{0, 0, 0, 0}},
					
					OnClick=function()								    
						    if  Win_IsChecked("UI.gameui.equipdlg.titlesetbtn")  then
						    Win_ShowWidget("UI.gameui.titledlg",true);
						    Win_ActiveSelf("UI.gameui.titledlg");
						    else 
						    Win_ShowWidget("UI.gameui.titledlg",false);
						    end;						     
						    end;
						    
				},
				
				--称号
				title = 
				{
					type = "LABEL",
					rect={46,77,146,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					textstyle=dt_left,
					enable=1;					
				},
				--名誉
				reputation = 
				{
					type = "LABEL",
					rect = { 77,493,82,12 },
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12;
					enable=1;
				},
				
				--善恶
				goodness = 
				{
					type = "LABEL",
					rect = { 207,493,82,12 },
					drawcolor = { 255, 255, 255, 255 },		
					textstyle=dt_center,
					textsize=12;
					enable=1;
					--caption="0",
				},
				
				--配偶姓名
				matename = 
				{
					type = "LABEL",
					rect = { 94,559,66,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				--亲密度
				friendliness = 
				{
					type = "LABEL",
					rect = { 223,559,66,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				
				--经验
				experience = 
				{
					type = "LABEL",
					rect = { 79,580,205,12},
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				
				--个人贡献
				contribute = 
				{
					type = "LABEL",
					rect = { 220,513,66,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				
				--政绩
				officecarrerctr =
				{
					type = "LABEL",
					rect = { 126,469,66,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;				
				},
				
				--个人威望
				prestige = 
				{
					type = "LABEL",
					rect = { 94,513,66,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},				
				
				--竞技称号
				arenatitle=
				{
					type = "LABEL",
					rect = { 94,537,106,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				--秀出竞技称号
				arenatitlecheck= 
				{
					type = "CHECK",
					rect={28,603,95,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					visible=1,
					tiptext="仙阶称号和竞技称号不可同时使用";
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							if Win_IsChecked("UI.gameui.equipdlg.showgodstepecheck") then
								Win_SetCheck("UI.gameui.equipdlg.showgodstepecheck",false);
								SetPlayerGodLevelTitle(0);
							end;		
							
							UI.children.gameui.OnShowArenaTitle(1);
							
						else
							UI.children.gameui.OnShowArenaTitle(0);
						end;
					end;		
				},
				
				--显示仙阶
				showgodstepecheck= 
				{
					type = "CHECK",
					rect={122,603,64,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					visible=1,
					tiptext="仙阶称号和竞技称号不可同时使用";
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							Win_SetCheck("UI.gameui.equipdlg.arenatitlecheck",false);
							SetPlayerGodLevelTitle(1);
							UI.children.gameui.OnShowArenaTitle(0);
						else
							SetPlayerGodLevelTitle(0);
						end;
					end;		
				},
				viptitlecheck= 
				{
					type = "CHECK",
					rect={191,603,95,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					visible=1,
					dragindex = 1;
					dragtype=ui_drag_type_viptitle,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnClick=function()
						local bcheck = Win_IsChecked("UI.gameui.equipdlg.viptitlecheck");
						UpdateShowVipTitleInfo(bcheck);
					end;		
				},
				--左边
				--剩余点数
				point = 
				{
					type = "LABEL",
					rect = {158,446,42,12 },
					drawcolor = { 255, 255, 255, 255 },								
					tiptext="用于升级的剩余点数";
					textsize=12;					
				},
				
				pointfire= 
				{
					type = "LABEL",
					rect = { 141,446,16,16 },
					effectpic="res/uires/common/pointfire.gsa",
					effectpicpos={-2,-14},
					drawflag=drawflag_draw_effect,
				},
				
				--力量
				STRLabel = 
				{
					type = "LABEL",
					rect = { 43,380,30,16 },
					tiptext="影响物理攻击力和负重能力";	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				STR = 
				{
					type = "LABEL",
					rect = { 73,380,36,16 },
					captionrect = { 0,1,36,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响物理攻击力和负重能力";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							  
				},
				
				DEXLabel = 
				{
					type = "LABEL",
					rect = { 43,420,30,16 },
					tiptext="影响物理防御能力";	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				--灵巧
				DEX = 
				{
					type = "LABEL",
					rect = { 73,420,36,16 },
					captionrect = { 0,1,36,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响物理防御能力";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;

					
				},
				
				AGILabel = 
				{
					type = "LABEL",
					rect = { 43,400,30,16 },
					tiptext="影响物理暴击等级";	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				--敏捷
				AGI = 
				{
					type = "LABEL",
					rect = { 73,400,36,16 },
					captionrect = { 0,2,36,12 },					
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响物理暴击等级";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
				},
				
				VITLabel = 
				{
					type = "LABEL",
					rect = { 175,380,30,16 },
					tiptext="影响生命值上限";	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				--体质
				VIT = 
				{
					type = "LABEL",
					rect = { 205,380,36,16 },
					captionrect = { 0,2,36,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响生命值上限";	
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
				},
				
				INTLabel = 
				{
					type = "LABEL",
					rect = { 175,400,30,16 },
					tiptext="影响魔法攻击力";		
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				--智慧
				INT = 
				{
					type = "LABEL",
					rect = { 205,400,36,16 },
					captionrect = { 0,2,36,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法攻击力";		
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 							 
							 end;

					
				},
				
				SPILabel = 
				{
					type = "LABEL",
					rect = { 175,420,30,16 },
					tiptext="影响法力值上限、魔法暴击等级和魔法防御力",
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				};
				
				--精神
				SPI = 
				{
					type = "LABEL",
					rect = { 205,420,36,16 },
					captionrect = { 0,1,36,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响法力值上限、魔法暴击等级和魔法防御力",
					textsize=12,	
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					textstyle=dt_right;
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 							 
							 end;

				},
				
				--右边
				MaxATK = 
				{
					type = "LABEL",
					rect = {43,353,90,16},
					captionrect = { 56,2,30,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n大物理攻击力",
					textstyle=dt_right;
				},
				
				MinATK = 
				{
					type = "LABEL",
					rect = { 43,338,90,16},
					captionrect = { 56,2,30,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,											
					tiptext="角色当前的最\n小物理攻击力",
					textstyle=dt_right;
				},
				
				Def = 
				{
					type = "LABEL",
					rect = { 145,338,60,16},
					captionrect = { 28,2,32,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响对物理攻\n击的抵抗力",
					textstyle=dt_right;
					
				},
				
				Matk = 
				{
					type = "LABEL",
					rect = {228,338,60,16},
					captionrect = { 15,2,42,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响魔法技\n能伤害力",
					textstyle=dt_right;
					
				},
				
				
				Mdef = 
				{
					type = "LABEL",
					rect = {228,353,60,16},
					captionrect = { 15,2,42,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响对魔法攻\n击的抵抗力",
					textstyle=dt_right;
					
				},
				
				Hit = 
				{
					type = "LABEL",
					rect = {145,353,60,16},
					captionrect = { 28,2,32,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响攻击\n的准确率",
					textstyle=dt_right;
					
				},
				
				
				
				--SPIN按钮区

				--STR
				strspinup=
				{
					type="SPIN",
					rect={119,379,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",
					tiptext="影响攻击力\n及最大负重";	
					textsize=12,
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.STR=1;
						QueryNewbieNextStep(1102);
						end;
				};
				
				strspindn=
				{
					type="SPIN",
					rect={138,379,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",
					tiptext="影响攻击力\n及最大负重";	
					textsize=12,
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.equipdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.STR=-1;
						end;
				};
					
				
				--AGI
				agispinup=
				{
					type="SPIN",
					rect={119,399,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",		
					tiptext="影响物理暴击等级";	
					textsize=12,	
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
						g_PlayerInfo.AGI=1;		
						QueryNewbieNextStep(1102);						
						end;
				};
				
				agispindn=
				{
					type="SPIN",
					rect={138, 399,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",		
					tiptext="影响物理暴击等级";	
					textsize=12,	
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
						g_PlayerInfo.AGI=-1;									
						end;
				};
				
						
				--DEX
				dexspinup=
				{
					type="SPIN",
					rect={119,419,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",		
					tiptext="影响物理防御能力";	
					textsize=12,	
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnClick=function()
						g_PlayerInfo.DEX=1;		
						QueryNewbieNextStep(1102);
						end;
				};
				
				dexspindn=
				{
					type="SPIN",
					rect={138,419,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",		
					tiptext="影响物理防御能力";	
					textsize=12,	
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Def",color,value_channel_color_draw);
							 end;
							 
					OnClick=function()
						g_PlayerInfo.DEX=-1;									
						end;
				};
						
				
				--VIT
				vitspinup=
				{
					type="SPIN",
					rect={251,379,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					tiptext="影响生命力最大值";	
					textsize=12,	
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
						g_PlayerInfo.VIT=1;			
						QueryNewbieNextStep(1102);
						end;
				};
				
				vitspindn=
				{
					type="SPIN",
					rect={270,379,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					tiptext="影响生命力最大值";	
					textsize=12,	
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
						g_PlayerInfo.VIT=-1;																		
						end;
				};
				
				
				--INT
				intspinup=
				{
					type="SPIN",
					rect={251,399,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					tiptext="影响魔法攻击力";		
					textsize=12,	
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 							 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.INT=1;		
						QueryNewbieNextStep(1102);
						end;
				};
				
				intspindn=
				{
					type="SPIN",
					rect={270,399,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					tiptext="影响魔法攻击力";		
					textsize=12,	
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Matk",color,value_channel_color_draw); 							 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.INT=-1;																		
						end;
				};
							
				
				--SPI
				spispinup=
				{
					type="SPIN",
					rect={251,419,22,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					tiptext="影响魔法防御力以及\n法力点数最大值",
					textsize=12,	
					tippos={-67,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 							 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.SPI=1;		
						QueryNewbieNextStep(1102);
						end;
					
				};
				
				spispindn=
				{
					type="SPIN",
					rect={270,419,22,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					tiptext="影响魔法防御力以及\n法力点数最大值",
					textsize=12,	
					tippos={-87,-6,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.equipdlg.Mdef",color,value_channel_color_draw); 							 
							 end;
							 
					OnClick=function()
						g_PlayerInfo.SPI=-1;																		
						end;
					
				};
		

			};--equipdlg children
			
		};--equipdlg 玩家在游戏中的状态
		

		titledlg=
		{
			type="DIALOG",
			rect = {0,0,98,188},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_popup+wgtstyle_topmost,
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/newcommon/patchupleft.gsa",
			patchupright="res/uires/newcommon/patchupright.gsa",
			patchdownleft="res/uires/newcommon/patchdownleft.gsa",
			patchdownright="res/uires/newcommon/patchdownright.gsa",
			
			patchmiddle="res/uires/newcommon/patchmiddle.gsa",
			
			patchupmiddle="res/uires/newcommon/patchupmiddle.gsa",
			patchdownmiddle="res/uires/newcommon/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/newcommon/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/newcommon/patchrightmiddle.gsa",

			
			mornitor={value_channel_visible},
					
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.titledlg")  then
						if Win_IsChecked("UI.gameui.equipdlg.titlesetbtn")  then
						Win_SetCheck("UI.gameui.equipdlg.titlesetbtn",false);									
						end;
					end;
					end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.titledlg","UI.gameui.equipdlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,0,12);
				Win_AlignWidget("UI.gameui.titledlg.tasktitledlg","UI.gameui.titledlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,0,24);
				Win_AlignWidget("UI.gameui.titledlg.honortitledlg","UI.gameui.titledlg",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,0,84);
				Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
				Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
				Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
				
				
				local nMaxIdx=GetPlayerTitle();
				
				if nMaxIdx==1 then
				Win_SelectSelf("UI.gameui.titledlg.Jobcheck");
				elseif nMaxIdx==2 then
				Win_SelectSelf("UI.gameui.titledlg.Taskcheck");
				elseif nMaxIdx==3 then
				Win_SelectSelf("UI.gameui.titledlg.Mastercheck");
				elseif nMaxIdx==4 then
				Win_SelectSelf("UI.gameui.titledlg.Unioncheck");
				elseif nMaxIdx==5 then
				Win_SelectSelf("UI.gameui.titledlg.Honorcheck");
				elseif nMaxIdx==7 then
				Win_SelectSelf("UI.gameui.titledlg.shenghuocheck");
				elseif nMaxIdx==8 then
				Win_SelectSelf("UI.gameui.titledlg.naturecheck");
				elseif nMaxIdx==6 then
				Win_SelectSelf("UI.gameui.titledlg.marriagecheck");
				else 
				Win_SelectSelf("UI.gameui.titledlg.Hidecheck");
				end;
				end;
					
			children=
			{
				Jobcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="职业称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Jobcheck")  then
						      SetPlayerTitle(1);						      
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						     end;
						      
				};
				
				Taskcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="任务称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Taskcheck")  then
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",true);
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};
				
				Mastercheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="师徒称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Mastercheck")  then
						      SetPlayerTitle(3);						      
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};
				
				Unioncheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,68,90,16};
					captionrect={24,2,54,12},
					caption="家族称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=3,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Unioncheck")  then
						      SetPlayerTitle(4);						      
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};
				
				Honorcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,88,90,16};
					captionrect={24,2,54,12},
					caption="荣誉称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=4,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Honorcheck")  then
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",true);
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};
				
                                marriagecheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,108,90,16};
					captionrect={24,2,54,12},
					caption="亲密称号",
                                        drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=5,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.marriagecheck")  then
						      SetPlayerTitle(6);						      
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};

				
				shenghuocheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,128,90,16};
					captionrect={24,2,54,12},
					caption="圣火称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=6,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.titledlg.shenghuocheck")  then
						      SetPlayerTitle(7);						      
						end;
						Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						end;
				};
				
				naturecheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,148,90,16};
					drawcolor={229,183,83,255},
					captionrect={24,2,54,12},
					caption="属性称号",
					textsize=12,
					groupid=0,
					groupstop=7,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.titledlg.naturecheck")  then
						       Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",true);						      
						       Win_SetFocus("UI.gameui.titledlg.naturetitledlg");
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      end;
				};
				
				Hidecheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,168,90,16};
					captionrect={24,2,54,12},
					caption="隐藏称号",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=8,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						      if Win_IsChecked("UI.gameui.titledlg.Hidecheck")  then
						      SetPlayerTitle(9);						      
						      end;
						      Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);
						      Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);
						      end;
				};
				
				tasktitledlg=
				{
					type="DIALOG",
					rect = {0,0,126,179},	
					visible=0,
					initlayer=65535,
					textsize=12,
					textfont=1,
					textstyle=dt_center,
					
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/newcommon/patchupleft.gsa",
					patchupright="res/uires/newcommon/patchupright.gsa",
					patchdownleft="res/uires/newcommon/patchdownleft.gsa",
					patchdownright="res/uires/newcommon/patchdownright.gsa",

					patchmiddle="res/uires/newcommon/patchmiddle.gsa",
					
					patchupmiddle="res/uires/newcommon/patchupmiddle.gsa",
					patchdownmiddle="res/uires/newcommon/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/newcommon/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/newcommon/patchrightmiddle.gsa",
					
					updatemute=1,
					
					OnSelfShow=function()
						local nMaxIdx,nSubIdx,nTaskNum,titles=GetPlayerTitle();
						Win_EnableWidget("UI.gameui.titledlg.tasktitledlg.okbtn",(nTaskNum>0));
						Win_EnableWidget("UI.gameui.titledlg.tasktitledlg.delbtn",(nTaskNum>0));
						
						Win_SetValue("UI.gameui.titledlg.tasktitledlg.titlelist",nTaskNum,value_channel_item_num);
						for i=1,nTaskNum do									  
						Win_SetText("UI.gameui.titledlg.tasktitledlg.titlelist",titles[i],value_channel_itemtext,i-1);
						end;
						Win_SetValue("UI.gameui.titledlg.tasktitledlg.titlelist",nSubIdx-1,value_channel_sel);
						
						Win_SetFocus("UI.gameui.titledlg.tasktitledlg.titlelist");
						end;					  
							
								
					children=
					{	
						okbtn = 
						{
							type = "BUTTON",
							rect = { 6,152,43,23 },
							bkimage="res/uires/equipdlg/okbtn.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.titledlg.tasktitledlg",false);					
								local sel=Win_GetValue("UI.gameui.titledlg.tasktitledlg.titlelist",value_channel_sel);
								SetPlayerTitle(2,sel+1);
								end;
						};
						
						delbtn = 
						{
							type = "BUTTON",
							rect = { 52,152,43,23 },
							bkimage="res/uires/equipdlg/delbtn.gsa",
							
							OnClick=function()
								Win_ShowMsgBox("您确定要删除该称号吗？","系统消息",ui_msgid_yesno,"UI.gameui.titledlg.tasktitledlg.delbtn");
								end;
							
							OnMsgBoxOk=function()
								local sel=Win_GetValue("UI.gameui.titledlg.tasktitledlg.titlelist",value_channel_sel);
								DelPlayerTaskTitle(sel+1);
							end;								
						};
				
				
						titlelist=
						{
							type="LISTBOX",
							rect={7,7,100,140},					
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							
							textsize=12,
							ysizeable=1,
																		
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							itemselback="res/uires/equipdlg/itemsel.gsa",
							itemdrawcolor={229,183,83,255},
							itemselcolor={255,255,255,255};
														
							children=	
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={102,9,11,140},
									captionrect={3,0,6,140},
									style=wgtstyle_vertical,					
									bkcolor={0,0,0,255},
									edgecolor={128,128,128,255},						
									pagesize=8,
									marginh=3,
									marginv=0,
									extendstyle=scrollbar_auto_disable + scrollbar_auto_hide,
									drawflag=drawflag_caption_fill,
									updatemute=1,
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,11,15},
											bkimage="res/uires/equipdlg/exslidebtn.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,15,11},
											bkimage="res/uires/equipdlg/exupbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,15,11},
											bkimage="res/uires/equipdlg/exdownbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
							
								};--scroll
							};
							
						},--list		
							
					};
					
				};
				
				honortitledlg=
				{
					type="DIALOG",
					rect = {0,0,126,179},	
					visible=0,
					initlayer=65535,
					textsize=12,
					textfont=1,
					textstyle=dt_center,
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/newcommon/patchupleft.gsa",
					patchupright="res/uires/newcommon/patchupright.gsa",
					patchdownleft="res/uires/newcommon/patchdownleft.gsa",
					patchdownright="res/uires/newcommon/patchdownright.gsa",
					
					patchmiddle="res/uires/newcommon/patchmiddle.gsa",
					
					patchupmiddle="res/uires/newcommon/patchupmiddle.gsa",
					patchdownmiddle="res/uires/newcommon/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/newcommon/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/newcommon/patchrightmiddle.gsa",
					
					updatemute=1,
					
					OnSelfShow=function()
						local nMaxIdx,nSubIdx,nTaskNum,titles,tips=GetPlayerTitle(1);
						Win_EnableWidget("UI.gameui.titledlg.honortitledlg.okbtn",(nTaskNum>0));
						Win_EnableWidget("UI.gameui.titledlg.honortitledlg.delbtn",(nTaskNum>0));
						
						Win_SetValue("UI.gameui.titledlg.honortitledlg.titlelist",nTaskNum,value_channel_item_num);
						for i=1,nTaskNum do									  
						Win_SetText("UI.gameui.titledlg.honortitledlg.titlelist",titles[i],value_channel_itemtext,i-1);
						Win_SetText("UI.gameui.titledlg.honortitledlg.titlelist",tips[i],value_channel_tiptext,i-1);
						end;
						Win_SetValue("UI.gameui.titledlg.honortitledlg.titlelist",nSubIdx-1,value_channel_sel);
						
						Win_SetFocus("UI.gameui.titledlg.honortitledlg.titlelist");
						end;					  
							
								
					children=
					{	
						okbtn = 
						{
							type = "BUTTON",
							rect = { 6,152,43,23 },
							bkimage="res/uires/equipdlg/okbtn.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.titledlg.honortitledlg",false);					
								local sel=Win_GetValue("UI.gameui.titledlg.honortitledlg.titlelist",value_channel_sel);
								SetPlayerTitle(5,sel+1);
								end;
						};
						
						delbtn = 
						{
							type = "BUTTON",
							rect = { 52,152,43,23 },
							bkimage="res/uires/equipdlg/delbtn.gsa",
							
							OnClick=function()
								Win_ShowMsgBox("您确定要删除该称号吗？","系统消息",ui_msgid_yesno,"UI.gameui.titledlg.honortitledlg.delbtn");
								end;
							
							OnMsgBoxOk=function()
								local sel=Win_GetValue("UI.gameui.titledlg.honortitledlg.titlelist",value_channel_sel);
								DelPlayerHonorTitle(sel+1);
								end;
						};
				
				
						titlelist=
						{
							type="LISTBOX",
							rect={7,7,100,140},					
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							
							textsize=12,
							ysizeable=1,
																		
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							itemselback="res/uires/equipdlg/itemsel.gsa",
							itemdrawcolor={229,183,83,255},
							itemselcolor={255,255,255,255};
														
							children=	
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={102,9,13,140},
									captionrect={3,0,6,140},
									style=wgtstyle_vertical,					
									bkcolor={0,0,0,255},
									edgecolor={128,128,128,255},						
									pagesize=8,
									marginh=3,
									marginv=0,
									extendstyle=scrollbar_auto_disable + scrollbar_auto_hide,
									drawflag=drawflag_caption_fill,
									updatemute=1,
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,11,15},
											bkimage="res/uires/equipdlg/exslidebtn.gsa",
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,15,11},
											bkimage="res/uires/equipdlg/exupbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,15,11},
											bkimage="res/uires/equipdlg/exdownbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
							
								};--scroll
							};
							
						},--list		
							
					};
					
				};
				naturetitledlg=
				{
					type="DIALOG",
					rect = {0,0,460,318},
					bkimage="res/uires/equipdlg/naturetitledlgbk.gsa",
					visible=0,
					initlayer=65535,
					textsize=12,
					textfont=1,
					textstyle=dt_center,
					moveable=1,
					
					bkcolor={16,16,16,196},					
					
					updatemute=1,
					
					OnSelfShow=function()
						local nMaxIdx,nSubIdx,nTaskNum,titles=GetPlayerTitle(2);
						Win_EnableWidget("UI.gameui.titledlg.naturetitledlg.okbtn",(nTaskNum>0));
						--Win_EnableWidget("UI.gameui.titledlg.naturetitledlg.delbtn",(nTaskNum>0));
						
						Win_SetText("UI.gameui.titledlg.naturetitledlg.titlenum", nTaskNum);
						
						Win_SetValue("UI.gameui.titledlg.naturetitledlg.titlelist",nTaskNum,value_channel_item_num);
						for i=1,nTaskNum do									  
						Win_SetText("UI.gameui.titledlg.naturetitledlg.titlelist",titles[i],value_channel_itemtext,i-1);
						end;
						Win_SetValue("UI.gameui.titledlg.naturetitledlg.titlelist",nSubIdx-1,value_channel_sel);
						
						local info=GetNatureTitleInfo(nSubIdx-1);
						Win_SetText("UI.gameui.titledlg.naturetitledlg.naturelabel", info.natureability);
						Win_SetText("UI.gameui.titledlg.naturetitledlg.textlabel", info.naturedesc);
						Win_SetText("UI.gameui.titledlg.naturetitledlg.timelabel", info.naturetime);
						
						Win_SetFocus("UI.gameui.titledlg.naturetitledlg.titlelist");
					end;	
					
				
					children=
					{	
						titlenum= 
						{
							type = "LABEL",
							rect={174,60,68,12},
							drawcolor = { 255, 255, 255, 255 },
							textsize=12,
							enable=0,
							textstyle=dt_left,
						},
						
						helplink= 
						{
							type = "BUTTON",
							rect = { 408,18,22,23 },
							bkimage="res/uires/newcommon/helpicon.gsa",
							
							OnClick=function()
							end;
						};
						
						okbtn = 
						{
							type = "BUTTON",
							rect = { 197,282,90,30 },
							bkimage="res/uires/equipdlg/natureokbtn.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);					
								local sel=Win_GetValue("UI.gameui.titledlg.naturetitledlg.titlelist",value_channel_sel);
								SetPlayerTitle(8,sel+1);
							end;
						};
						
						cancelbtn = 
						{
							type = "BUTTON",
							rect = { 430,18,22,23 },
							bkimage="res/uires/newcommon/miniclose.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.titledlg.naturetitledlg",false);					
							end;
						};
						
						naturelabel=
						{
							type="LABEL",
							rect={280,73,160,90},
							textsize=12,
							textstyle=dt_left+dt_top,
							richmode=ui_richmode_all,
							drawcolor={255,255,255,255},
							visible=1,
							caption="",
						};
						textlabel=
						{
							type="LABEL",
							rect={280,185,160,50},
							textsize=12,
							textstyle=dt_left+dt_top,
							richmode=ui_richmode_all,
							drawcolor={255,255,255,255},
							visible=1,
							caption="",
						};
						timelabel=
						{
							type="LABEL",
							rect={280,257,160,17},
							textsize=12,
							textstyle=dt_left+dt_top,
							richmode=ui_richmode_all,
							drawcolor={255,255,255,255},
							visible=1,
							caption="",
						};
				
						titlelist=
						{
							type="LISTBOX",
							rect={40,76,212,200},					
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
							
							textsize=12,
							ysizeable=1,
																		
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							--itemselback="res/uires/common/itemsel.gsa",
							--itemdrawback="res/uires/equipdlg/titleline.gsa",
							--itemdrawpos={0,18,0,0},
							itemdrawback="res/uires/cdkeydlg/itembk.gsa",
							itemselback="res/uires/cdkeydlg/itemsel.gsa",
							itemdrawpos={-11,9,205,16},
							itemselpos={-19, -8,205,16};
									
							OnValueChange=function(sel)
								if sel >= 0 then
									local info=GetNatureTitleInfo(sel);
									Win_SetText("UI.gameui.titledlg.naturetitledlg.naturelabel", info.natureability);
									Win_SetText("UI.gameui.titledlg.naturetitledlg.textlabel", info.naturedesc);
									Win_SetText("UI.gameui.titledlg.naturetitledlg.timelabel", info.naturetime);
								end;
							end;
							
							children=	
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={213,18,20,154},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
																		
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,						
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
									};--children
								};
							};
							
						},--list		
							
					};
				};
			
			};
		};
			
		-- 幸运轮盘
		lotterydlg=
		{
			type = "DIALOG",
			rect = { 100, 100, 299, 366},
			style=wgtstyle_topmost+wgtstyle_alphawin;--wgtstyle_customclose +
			visible=0;
			moveable=1,
			bkimage="res/uires/rewarddlg/lotterydlgbk.gsa",
			IsFive=0;
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.lotterydlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				DoDlgLockPlayer(1);
				Win_ShowWidget("UI.gameui.lotterydlg.startbtn", true);
				Win_ShowWidget("UI.gameui.lotterydlg.stopbtn", false);
				Win_ShowWidget("UI.gameui.lotterydlg.eff1", false);
				Win_ShowWidget("UI.gameui.lotterydlg.eff2", true);
				LotteryDraw_Init();	-- 打开窗口的时候才装在图资源
				
				for i=1,12 do
					local desc=LotteryDraw_GetObjTip(i);
					if desc~=nil then
						Win_SetText("UI.gameui.lotterydlg.obj"..i,desc,value_channel_tiptext);
					end;				
				end;
			end;
			
			OnSelfHide=function()
				Win_ShowWidget("UI.gameui.lotterydlg.eff1", false);
				Win_ShowWidget("UI.gameui.lotterydlg.eff2", false);
				DoDlgLockPlayer(0);
				LotteryDraw_Destroy();	--关闭窗口的时候释放图资源
			end;

			children=
			{
				tooltip=
				{
					type = "LABEL",
					rect={-100,-100,24,12},		
					drawcolor = { 255, 255, 255, 255 },		
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					maxwidth=200,
					sizeable=1,	
					visible=0,
					marginh=12,
					marginv=6,
					textsize=12,
					textfont=0,
					rowspace=4,
					initlayer=systooltip_layer,
					style=wgtstyle_vertical+wgtstyle_clipself,		
					richmode=ui_richmode_color,
					alphaspeed=0.1,		
					edgecheck=edge_check_show+edge_check_auto,
					
					patchrect={3,3,3,2},	
					patchdrawtype=patch_draw_type_scale,					
						
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					
				};	
						
				closebtn = 
				{
					type = "BUTTON",
					rect = { 270,20,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				--轮盘针
				pointer = 
				{
					type = "WIDGET",
					rect = {90,103,137,139},
					edgecolor={0,0,0,0},											
					style=wgtstyle_renderbuffer+wgtstyle_static;
					custombuffer=custom_buffer_lotterypointer,
					initlayer=0;
					--bkimage="res/uires/rewarddlg/pointer.gsa",
				},
				
				lightlabel= 
				{
					type = "LABEL",
					rect={22,35,272,272};
					bkimage="res/uires/rewarddlg/light.gsa",
					initlayer=1;
					enable=1;
				},
				
				eff1 = 
				{
					type = "BUTTON",
					rect = {155,284,30,30},
					style=wgtstyle_effect + wgtstyle_alphawin+wgtstyle_static;
					effect={{name="TFX9150.eff", x=0, y=0, loop=0, delay=0}},
					initlayer=2;
				},
				
				eff2 = 
				{
					type = "WIDGET",
					rect = {153,275,30,30},
					style=wgtstyle_effect + wgtstyle_alphawin+wgtstyle_static;
					effect={{name="TFX9148.eff", x=0, y=0, loop=1, delay=0}},
					initlayer=3;
				},
				
				goldedit=
				{
					type="LABEL",
					rect={110,308,48,12},
					textsize=12,
					bkcolor={0,0,0,0},
					textstyle=dt_center;
					enable=0,				
				},
				
				silveredit=
				{
					type="LABEL",
					rect={155,308,48,12},
					textsize=12,
					bkcolor={0,0,0,0},
					textstyle=dt_center;
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={205,308,48,12},
					textsize=12,
					bkcolor={0,0,0,0},
					textstyle=dt_center;
					enable=0,
				},
				
				FiveTxt= 
				{
					type = "LABEL",
					rect={235,68,48,12};
					textsize=12;
					enable=1;
					visible=1;
					textstyle=dt_center;
					caption="五倍奖励";
				},
				
				--[[bowlderlabel= 
				{
					type = "LABEL",
					rect={90,308,48,12};
					textsize=12;
					enable=0;
					textstyle=dt_center;
					caption="";
				},

				activelabel= 
				{
					type = "LABEL",
					rect={235,308,48,12};
					textsize=12;
					enable=0;
					textstyle=dt_center;
					caption="";
				},]]--
				
				-- 12个生肖物品的提示tip
				obj1 = 
				{
					type = "WIDGET",
					rect = {145,67,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="老鼠";
				},				
				
				obj2 = 
				{
					type = "WIDGET",
					rect = {190,80,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="黄牛";
				},					
				obj3 = 
				{
					type = "WIDGET",
					rect = {224,113,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="白虎";
				},					
				obj4 = 
				{
					type = "WIDGET",
					rect = {237,159,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="小兔";
				},					
				obj5 = 
				{
					type = "WIDGET",
					rect = {224,205,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="金龙";
				},	
				obj6 = 
				{
					type = "WIDGET",
					rect = {191,239,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="青蛇";
				},	
				obj7 = 
				{
					type = "WIDGET",
					rect = {144,251,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="黑马";
				},	
				obj8 = 
				{
					type = "WIDGET",
					rect = {98,238,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="青羊";
				},					
				obj9 = 
				{
					type = "WIDGET",
					rect = {65,204,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="石猴";
				},					
				obj10 = 
				{
					type = "WIDGET",
					rect = {53,158,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="小鸡";
				},					
				obj11= 
				{
					type = "WIDGET",
					rect = {65,113,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="老狗";
				},					
				obj12= 
				{
					type = "WIDGET",
					rect = {99,79,30,30},
					--style=wgtstyle_static;
					tipwidget="UI.gameui.lotterydlg.tooltip",
					tiptext="老猪";
				},					
				--
				
						
				startbtn= 
				{
					type = "BUTTON",
					rect = { 44,329,86,24 },
					bkimage="res/uires/rewarddlg/startbtn.gsa",
					tiptext="每一次转动轮盘需要消耗5金币";
					
					OnClick=function()
						--[[local activeval = GetActiveVal();
						local bowlder = GetMyJude();

						if bowlder < 100 then
							Win_ShowMsgBox("转动一次幸运轮盘需要花费100彩玉，您的身上彩玉数量不足，是否现在充值？", "系统消息", ui_msgid_yesno, "UI.gameui.lotterydlg.startbtn");
							return;
						end;
						
						if (activeval < 30) then
							Win_ShowMsgBox("转动一次幸运轮盘需要消耗30点活跃值，您积累的活跃值数量不足，请多完成悬赏任务积累活跃值.", "系统消息", ui_msgid_close);
							return;
						end;]]--
						
						local usedslot = GetNumUsedSlot(ui_drag_type_ware_ware);
						if ( usedslot >= 25) then
							Win_ShowMsgBox("收集品栏空间不足，无法添加奖品.", "系统消息", ui_msgid_close);						
						else
							LotteryDraw_StartTurn(UI.children.gameui.children.lotterydlg.IsFive);
							Win_ShowWidget("UI.gameui.lotterydlg.startbtn", false);
							Win_ShowWidget("UI.gameui.lotterydlg.stopbtn", true);
							Win_EnableWidget("UI.gameui.lotterydlg.stopbtn", false);
							Win_SetValue("UI.gameui.lotterydlg.stopbtn",1,value_channel_timerspace);	-- 3秒后才能结束旋转

							for i=1,12 do
								Win_EnableWidget("UI.gameui.lotterydlg.obj"..i, false);
							end;
						end;
					end;
					
					OnMsgBoxOk=function()
						--向服务器发送充值消息
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				
				stopbtn= 
				{
					type = "BUTTON",
					rect = { 44,329,86,24 },
					bkimage="res/uires/rewarddlg/stopbtn.gsa",
					visible=0;
					tiptext="停止旋转",
					
					OnTimer=function()
						Win_SetValue("UI.gameui.lotterydlg.stopbtn",-1,value_channel_timerspace);
						Win_EnableWidget("UI.gameui.lotterydlg.stopbtn", true);
					end;
					
					OnClick=function()
						LotteryDraw_StopTurn();
						Win_EnableWidget("UI.gameui.lotterydlg.stopbtn", false);
					end;
				};
				
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 193,329,86,24 },
					bkimage="res/uires/rewarddlg/closebtn.gsa",
					defaultcancel=1,
				};
			};
		};
		
				
			
		-- npc 悬赏任务列表dlg
		rewarddlg= 
		{
			type = "DIALOG",
			rect = { 100, 100, 311, 477},
			style=wgtstyle_topmost+wgtstyle_alphawin;--wgtstyle_customclose +
			visible=0;
			moveable=1,
			bkimage="res/uires/rewarddlg/rewarddlg.gsa",
			
			OnUpdateList=function()
				local num=GetRewardTaskNum(0);
				local oldsel=Win_GetValue("UI.gameui.rewarddlg.tasklist.singlelist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
					oldsel=-1;
				end;
				
				Win_SetValue("UI.gameui.rewarddlg.tasklist.singlelist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.rewarddlg.tasklist.singlelist",oldsel,value_channel_sel);				

				num=GetRewardTaskNum(1);
				oldsel=Win_GetValue("UI.gameui.rewarddlg.tasklist.multilist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
					oldsel=-1;
				end;
				
				Win_SetValue("UI.gameui.rewarddlg.tasklist.multilist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.rewarddlg.tasklist.multilist",oldsel,value_channel_sel);				
				
				Win_ReAlignChild("UI.gameui.rewarddlg.tasklist");
				Win_AjustSelf("UI.gameui.rewarddlg.tasklist");
				Win_SetValue("UI.gameui.rewarddlg.tasklist",1,value_channel_update_dirty);								
				
				UI.children.gameui.children.rewarddlg.OnUpdateChild();
			end;
			
			OnUpdateChild=function()
				local sel = false;

				local num=Win_GetValue("UI.gameui.rewarddlg.tasklist.singlelist",value_channel_item_num);
				local cursel=Win_GetValue("UI.gameui.rewarddlg.tasklist.singlelist",value_channel_sel);
				if (0<=cursel) and (cursel<num)  then 	--检测单人任务
					local desc=GetRewardTaskDesc(0, cursel);
					
					Win_SetText("UI.gameui.rewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00"..desc);
					Win_SetValue("UI.gameui.rewarddlg.tasklist",0,value_channel_customtype);
					Win_SetValue("UI.gameui.rewarddlg.tasklist",cursel,value_channel_customindex);
					
					local finish, grade = GetRewardTaskInfo(0, cursel);
					
					if grade == 0 then
						Win_SetText("UI.gameui.rewarddlg.upgradecast", "50彩玉");
					elseif grade == 1 then 
						Win_SetText("UI.gameui.rewarddlg.upgradecast", "100彩玉");
					else
						Win_SetText("UI.gameui.rewarddlg.upgradecast", "50彩玉");
					end;

					Win_SetText("UI.gameui.rewarddlg.modifycast", "50彩玉");
					Win_SetText("UI.gameui.rewarddlg.resetcast", "150彩玉");
				
					Win_EnableWidget("UI.gameui.rewarddlg.upgradebtn", grade ~= 2 );
					Win_EnableWidget("UI.gameui.rewarddlg.modifybtn", true);
					Win_EnableWidget("UI.gameui.rewarddlg.acceptbtn", true);
					
					sel = true;

					Win_SetValue("UI.gameui.rewarddlg.tasklist.multilist",-1,value_channel_sel);
				else	-- 检测多人任务选择
					num=Win_GetValue("UI.gameui.rewarddlg.tasklist.multilist",value_channel_item_num);
					cursel=Win_GetValue("UI.gameui.rewarddlg.tasklist.multilist",value_channel_sel);
					if (0<=cursel) and (cursel<num)  then 
						local desc=GetRewardTaskDesc(1, cursel);
						
						Win_SetText("UI.gameui.rewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00"..desc);
						Win_SetValue("UI.gameui.rewarddlg.tasklist",1,value_channel_customtype);
						Win_SetValue("UI.gameui.rewarddlg.tasklist",cursel,value_channel_customindex);
	
						local finish, grade = GetRewardTaskInfo(1, cursel);
						
						if grade == 0 then
							Win_SetText("UI.gameui.rewarddlg.upgradecast", "100彩玉");
						elseif grade == 1 then 
							Win_SetText("UI.gameui.rewarddlg.upgradecast", "200彩玉");
						else
							Win_SetText("UI.gameui.rewarddlg.upgradecast", "50彩玉");
						end;
	
						Win_SetText("UI.gameui.rewarddlg.modifycast", "50彩玉");
						
						Win_EnableWidget("UI.gameui.rewarddlg.upgradebtn", grade ~= 2 );
						Win_EnableWidget("UI.gameui.rewarddlg.modifybtn", true);
						Win_EnableWidget("UI.gameui.rewarddlg.acceptbtn", true);
	
						sel = true;
					end;
				end;

				if (sel==false) then
					Win_SetText("UI.gameui.rewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00");
					Win_SetValue("UI.gameui.rewarddlg.tasklist",-1,value_channel_customtype);
					Win_SetValue("UI.gameui.rewarddlg.tasklist",-1,value_channel_customindex);

					Win_EnableWidget("UI.gameui.rewarddlg.upgradebtn", false);
					Win_EnableWidget("UI.gameui.rewarddlg.modifybtn", false);
					Win_EnableWidget("UI.gameui.rewarddlg.acceptbtn", false);
					
					Win_SetText("UI.gameui.rewarddlg.upgradecast", "50彩玉");
					Win_SetText("UI.gameui.rewarddlg.modifycast", "50彩玉");
				end;

				Win_SetText("UI.gameui.rewarddlg.resetcast", "150彩玉");
			end;
			
			OnSelfShow=function()
				UI.children.gameui.children.rewarddlg.OnUpdateList();
				Win_AlignWidget("UI.gameui.rewarddlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				DoDlgLockPlayer(1);
			end;
			
			OnSelfHide=function()
				DoDlgLockPlayer(0);
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 283,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 261,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				title= 
				{
					type = "LABEL",
					rect={36,48,259,21};
					--bkimage="res/uires/rewarddlg/title.gsa",
					adornpic={"res/uires/rewarddlg/title.gsa", "res/uires/rewarddlg/title2.gsa"},
					adornpicpos={{0,0}, {171, 0}},
					enable=0;
				},
				
				tasklist=
				{
					type="WIDGETLIST",
					rect={36,70,234,178},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					primaryscroll="UI.gameui.rewarddlg.vscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					children=
					{
						singlelabel= 
						{
							type = "LABEL",
							rect={0,0,234,12};
							textsize=12;
							enable=0;
							textstyle=dt_left;
							richmode=ui_richmode_all,
							caption="/C25/F01单人任务:";
							groupstop=0;
						},
						
						singlelist=
						{
							type="LISTBOX",
							rect={0,0,234,187};
							dragtype=ui_drag_type_reward,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_auto_comfort+listbox_style_itemheight_fix,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,

							groupstop=1;
							
							itemselback="res/uires/rewarddlg/itemsel2.gsa",	
							itemselpos={20,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							ysizeable=1,
							updatemute=1,
							
							OnValueChange=function(sel)
								Win_SetValue("UI.gameui.rewarddlg.tasklist.multilist",-1,value_channel_sel);
								UI.children.gameui.children.rewarddlg.OnUpdateChild();
							end;
						};
						
						multilabel= 
						{
							type = "LABEL",
							rect={0,0,234,12};
							textsize=12;
							enable=0;
							bkimage="res/uires/rewarddlg/line.gsa",
							bkimagepos={-100, -5};
							richmode=ui_richmode_all,
							caption="/C25/F01多人任务:";
							textstyle=dt_left;
							
							groupstop=2;
						},
						
						multilist=
						{
							type="LISTBOX",
							rect={0,0,234,187};
							dragtype=ui_drag_type_reward_team,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_auto_comfort+listbox_style_itemheight_fix,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemselback="res/uires/rewarddlg/itemsel2.gsa",	
							itemselpos={20,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							ysizeable=1,
							updatemute=1,
							
							groupstop=3;
							
							OnValueChange=function(sel)
								Win_SetValue("UI.gameui.rewarddlg.tasklist.singlelist",-1,value_channel_sel);
								UI.children.gameui.children.rewarddlg.OnUpdateChild();
							end;
						};
					},
				},--list
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={276,88,20,139},					
					style=wgtstyle_vertical+wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;	
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
														
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					buddywidget="UI.gameui.rewarddlg.tasklist",

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary+wgtstyle_alignfollow,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							style=wgtstyle_alignfollow,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				taskinfolabel= 
				{
					type = "LABEL",
					rect={36,257,262,80};
					textsize=12;
					enable=0;
					textstyle=dt_left;
					richmode=ui_richmode_all,
					caption="/C25/F01任务详细信息：";
					rowspace=4,
				},
				
				upgradecast= 
				{
					type = "LABEL",
					rect={171,348,60,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;
					textstyle=dt_right;
					caption="50 彩玉";
				},
				
				modifycast= 
				{
					type = "LABEL",
					rect={171,375,60,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;
					textstyle=dt_right;
					caption="50 彩玉";
				},				
				
				resetcast= 
				{
					type = "LABEL",
					rect={171,400,60,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;
					textstyle=dt_right;
					caption="50 彩玉";
				},				
				
				bowlderedit=
				{
					type="LABEL",
					rect={96,426,60,12},
					textsize=12,	
					textstyle=dt_center,
					drawcolor = { 255, 255, 255, 255 },
					caption="99999";
					enable=0,
				};	
				
				upgradebtn= 
				{
					type = "BUTTON",
					rect = { 31,341,97,24 },
					bkimage="res/uires/rewarddlg/upgradebtn.gsa",
					
					OnClick=function()
						local bowlder = GetMyJude();
						if (bowlder >= 50) then
						        local drag= Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customtype);
						        local index = Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customindex);
						        RewardTaskCmd(1, drag, index);
						else
							local tx = Win_GetText("UI.gameui.rewarddlg.upgradecast");
							Win_ShowMsgBox("提升悬赏等级需要"..tx.."，您的彩玉不足，是否现在充值？", "系统消息", ui_msgid_yesno, "UI.gameui.rewarddlg.upgradebtn");
						end;
					end;
					
					OnMsgBoxOk=function()
						--向服务器发送充值消息
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};

				modifybtn= 
				{
					type = "BUTTON",
					rect = { 31,367,97,24 },
					bkimage="res/uires/rewarddlg/modifybtn.gsa",
					
					OnClick=function()
						local bowlder = GetMyJude();
						if (bowlder >= 50) then
							local drag= Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customtype);
							local index = Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customindex);
							RewardTaskCmd(2, drag, index);
						else
							local tx = Win_GetText("UI.gameui.rewarddlg.modifycast");
							Win_ShowMsgBox("提升悬赏等级需要"..tx.."，您的彩玉不足，是否现在充值？", "系统消息", ui_msgid_yesno, "UI.gameui.rewarddlg.modifybtn");
						end;
					end;
					
					OnMsgBoxOk=function()
						--向服务器发送充值消息
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				resetbtn= 
				{
					type = "BUTTON",
					rect = { 31,393,97,24 },
					bkimage="res/uires/rewarddlg/resetbtn.gsa",
					
					OnClick=function()
						local bowlder = GetMyJude();
						if (bowlder >= 50) then
							local drag= Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customtype);
							local index = Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customindex);
							RewardTaskCmd(5, drag, index);
						else
							local tx = Win_GetText("UI.gameui.rewarddlg.resetcast");
							Win_ShowMsgBox("提升悬赏等级需要"..tx.."，您的彩玉不足，是否现在充值？", "系统消息", ui_msgid_yesno, "UI.gameui.rewarddlg.resetbtn");
						end;
					end;
					
					OnMsgBoxOk=function()
						--向服务器发送充值消息
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				acceptbtn= 
				{
					type = "BUTTON",
					rect = { 31,445,86,24 },
					bkimage="res/uires/rewarddlg/acceptbtn.gsa",
					
					OnClick=function()
						local drag= Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customtype);
						local index = Win_GetValue("UI.gameui.rewarddlg.tasklist",value_channel_customindex);
						RewardTaskCmd(3, drag, index);
					end;
				};
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 213,445,86,24 },
					bkimage="res/uires/rewarddlg/closebtn.gsa",
					defaultcancel=1,
				};
			};
		};
			

		-- 我的悬赏任务列表dlg
		myrewarddlg= 
		{
			type = "DIALOG",
			rect = { 400, 100, 364, 345},
			style=wgtstyle_topmost+wgtstyle_alphawin;--wgtstyle_customclose +
			visible=0;
			moveable=1,
			bkimage="res/uires/rewarddlg/myrewaeddlg.gsa",
			
			OnUpdateList=function()
				local num=GetRewardTaskNum(2);
				local oldsel=Win_GetValue("UI.gameui.myrewarddlg.tasklist.singlelist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
					oldsel=-1;
				end;
				
				Win_SetValue("UI.gameui.myrewarddlg.tasklist.singlelist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.myrewarddlg.tasklist.singlelist",oldsel,value_channel_sel);
				

				num=GetRewardTaskNum(3);
				oldsel=Win_GetValue("UI.gameui.myrewarddlg.tasklist.multilist",value_channel_sel);
				if (oldsel<0) or (oldsel>=num)  then 
					oldsel=-1;
				end;
				
				Win_SetValue("UI.gameui.myrewarddlg.tasklist.multilist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.myrewarddlg.tasklist.multilist",oldsel,value_channel_sel);				

				Win_ReAlignChild("UI.gameui.myrewarddlg.tasklist");
				Win_AjustSelf("UI.gameui.myrewarddlg.tasklist");
				Win_SetValue("UI.gameui.myrewarddlg.tasklist",1,value_channel_update_dirty);								
			
				UI.children.gameui.children.myrewarddlg.OnUpdateChild();
			end;

			OnUpdateChild=function()
				local sel = false;

				local num=Win_GetValue("UI.gameui.myrewarddlg.tasklist.singlelist",value_channel_item_num);
				local cursel=Win_GetValue("UI.gameui.myrewarddlg.tasklist.singlelist",value_channel_sel);
				if (0<=cursel) and (cursel<num)  then 	-- 检测单人任务
					local desc=GetRewardTaskDesc(2, cursel);
					Win_SetText("UI.gameui.myrewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00"..desc);
					Win_SetValue("UI.gameui.myrewarddlg.tasklist",2,value_channel_customtype);
					Win_SetValue("UI.gameui.myrewarddlg.tasklist",cursel,value_channel_customindex);
					
					local finish, grade = GetRewardTaskInfo(2, cursel);
					
					Win_EnableWidget("UI.gameui.myrewarddlg.getbtn", finish);
					Win_EnableWidget("UI.gameui.myrewarddlg.carrybtn", true);
					
					sel = true;

					Win_SetValue("UI.gameui.myrewarddlg.tasklist.multilist",-1,value_channel_sel);
				else	-- 检测多人任务
					num=Win_GetValue("UI.gameui.myrewarddlg.tasklist.multilist",value_channel_item_num);
					cursel=Win_GetValue("UI.gameui.myrewarddlg.tasklist.multilist",value_channel_sel);
					if (0<=cursel) and (cursel<num)  then 
						local desc=GetRewardTaskDesc(3, cursel);
						Win_SetText("UI.gameui.myrewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00"..desc);
						Win_SetValue("UI.gameui.myrewarddlg.tasklist",3,value_channel_customtype);
						Win_SetValue("UI.gameui.myrewarddlg.tasklist",cursel,value_channel_customindex);
	
						local finish, grade = GetRewardTaskInfo(3, cursel);
	
						Win_EnableWidget("UI.gameui.myrewarddlg.getbtn", finish);
						Win_EnableWidget("UI.gameui.myrewarddlg.carrybtn", true);
						
						sel = true;
					end;
				end;
				
				if (sel==false) then
					Win_SetText("UI.gameui.myrewarddlg.taskinfolabel","/C25/F01任务详细信息：\n/C00/F00");
					Win_SetValue("UI.gameui.myrewarddlg.tasklist",-1,value_channel_customtype);
					Win_SetValue("UI.gameui.myrewarddlg.tasklist",-1,value_channel_customindex);
					Win_EnableWidget("UI.gameui.myrewarddlg.getbtn", false);
					Win_EnableWidget("UI.gameui.myrewarddlg.carrybtn", false);
				end;
			end;
			
			OnSelfShow=function()
				UI.children.gameui.children.myrewarddlg.OnUpdateList();
				Win_AlignWidget("UI.gameui.myrewarddlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				DoDlgLockPlayer(1);
			end;
			
			OnSelfHide=function()
				DoDlgLockPlayer(0);
			end;

			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 335,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 313,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				title= 
				{
					type = "LABEL",
					rect={36,48,259,21};
					--bkimage="res/uires/rewarddlg/title.gsa",
					adornpic={"res/uires/rewarddlg/title.gsa", "res/uires/rewarddlg/title2.gsa", "res/uires/rewarddlg/title3.gsa"},
					adornpicpos={{0,0}, {171, 0}, {233, 0}},
					enable=0;
				},
				
				tasklist=
				{
					type="WIDGETLIST",
					rect={36,70,289,150},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					primaryscroll="UI.gameui.myrewarddlg.vscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					children=
					{
						singlelabel= 
						{
							type = "LABEL",
							rect={0,0,289,12};
							textsize=12;
							enable=0;
							textstyle=dt_left;
							richmode=ui_richmode_all,
							caption="/C25/F01单人任务:";
							groupstop=0;
						},
						
						singlelist=
						{
							type="LISTBOX",
							rect={0,0,289,187};
							dragtype=ui_drag_type_myreward,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_auto_comfort+listbox_style_itemheight_fix,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,

							groupstop=1;
							
							itemselback="res/uires/rewarddlg/itemsel2.gsa",	
							itemselpos={20,2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							ysizeable=1,
							updatemute=1,
							
							OnValueChange=function(sel)
								Win_SetValue("UI.gameui.myrewarddlg.tasklist.multilist",-1,value_channel_sel);
								UI.children.gameui.children.myrewarddlg.OnUpdateChild();
							end;
						};
						
						multilabel= 
						{
							type = "LABEL",
							rect={0,0,289,12};
							textsize=12;
							enable=0;
							bkimage="res/uires/rewarddlg/line.gsa",
							bkimagepos={-100, -5};
							richmode=ui_richmode_all,
							caption="/C25/F01多人任务:";
							textstyle=dt_left;
							
							groupstop=2;
						},
						
						multilist=
						{
							type="LISTBOX",
							rect={0,0,289,187};
							dragtype=ui_drag_type_myreward_team,
							itemnum=0,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
							ajustflag=rect_flag_window+rect_flag_client;				
							extendstyle=listbox_style_auto_comfort+listbox_style_itemheight_fix,
							itemdragflag=-1,
							
							itemheight=24,
							itemmarginv=0,
							itemmarginh=0,
							
							itemselback="res/uires/rewarddlg/itemsel2.gsa",	
							itemselpos={20, 2,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
							
							ysizeable=1,
							updatemute=1,
							
							groupstop=3;
							
							OnValueChange=function(sel)
								Win_SetValue("UI.gameui.myrewarddlg.tasklist.singlelist",-1,value_channel_sel);
								UI.children.gameui.children.myrewarddlg.OnUpdateChild();
							end;
						};
					},
				},--list
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={330,87,20,113},					
					style=wgtstyle_vertical+wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;	
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
														
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					buddywidget="UI.gameui.myrewarddlg.tasklist",

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary+wgtstyle_alignfollow,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							style=wgtstyle_alignfollow,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				
				taskinfolabel= 
				{
					type = "LABEL",
					rect={36,229,316,80};
					textsize=12;
					enable=0;
					textstyle=dt_left;
					richmode=ui_richmode_all,
					caption="/C25/F01任务详细信息：";
					rowspace=4,
				},

				carrybtn= 
				{
					type = "BUTTON",
					rect = { 31,313,86,24 },
					bkimage="res/uires/rewarddlg/carrybtn.gsa",
					tiptext="每一次传送需要花费50银";
					
					OnClick=function()
						local drag= Win_GetValue("UI.gameui.myrewarddlg.tasklist",value_channel_customtype);
						local index = Win_GetValue("UI.gameui.myrewarddlg.tasklist",value_channel_customindex);
						Win_ShowWidget("UI.gameui.myrewarddlg", false);
						RewardTaskCmd(6, drag, index);
					end;
				};

				getbtn= 
				{
					type = "BUTTON",
					rect = { 152,313,86,24 },
					bkimage="res/uires/rewarddlg/getbtn.gsa",
					
					OnClick=function()
						local drag= Win_GetValue("UI.gameui.myrewarddlg.tasklist",value_channel_customtype);
						local index = Win_GetValue("UI.gameui.myrewarddlg.tasklist",value_channel_customindex);
						RewardTaskCmd(4, drag, index);
					end;
				};

				exitbtn= 
				{
					type = "BUTTON",
					rect = { 269,313,86,24 },
					bkimage="res/uires/rewarddlg/closebtn.gsa",
					defaultcancel=1,
				};
			};
		};
			
		

		-- 宠物资质鉴定dlg
		petidentifydlg=
		{
			type = "DIALOG",
			rect = { 600, 450, 249, 262},
			style=wgtstyle_topmost+wgtstyle_alphawin;--wgtstyle_customclose +
			bkimage="res/uires/petdlg/petidentifydlg.gsa",
			moveable=1,
			tabstop=2,
			visible=0,	
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",false);
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",false);
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",false);
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",false);
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",false);
				Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",false);
				
				if Win_IsVisible("UI.gameui.petdlg") then
					Win_AlignWidget("UI.gameui.petidentifydlg", "UI.gameui.petdlg", aligntype_winrect,alignstyle_right_out+alignstyle_bottom_in);
				end;
				DoDlgLockPlayer(1);
			end;
			
			OnSelfHide=function()
				ClosePetIdentify();
				DoDlgLockPlayer(0);
				if Win_IsVisible("UI.gameui.petdlg") then
					Win_ShowWidget("UI.gameui.petdlg",false);
				end;
			end;
			
			OnMsg=function(mode)
				local pet = GetIndentifyPet();
				
				if mode ==0 then -- 鉴定结果，
					Win_ShowWidget("UI.gameui.petidentifydlg.effect",true);
					
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",false);
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",false);
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",false);
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",false);
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",false);
					Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",false);
					
					if pet.bStrPer > 0 then
						Win_SetText("UI.gameui.petidentifydlg.wilist.STR", "/C25力量:/C00   "..(pet.bStrPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.AGI", "/C25敏捷:/C00   "..(pet.bAgiPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.DEX", "/C25灵巧:/C00   "..(pet.bDexPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.VIT", "/C25体质:/C00   "..(pet.bVitPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.INT", "/C25智慧:/C00   "..(pet.bIntPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.SPI", "/C25精神:/C00   "..(pet.bSpiPer*4));
					else
						Win_SetText("UI.gameui.petidentifydlg.wilist.STR", "/C25力量:/C00   ");	
						Win_SetText("UI.gameui.petidentifydlg.wilist.AGI", "/C25敏捷:/C00   ");	
						Win_SetText("UI.gameui.petidentifydlg.wilist.DEX", "/C25灵巧:/C00   ");	
						Win_SetText("UI.gameui.petidentifydlg.wilist.VIT", "/C25体质:/C00   ");	
						Win_SetText("UI.gameui.petidentifydlg.wilist.INT", "/C25智慧:/C00   ");	
						Win_SetText("UI.gameui.petidentifydlg.wilist.SPI", "/C25精神:/C00   ");	
					end;
					
					Win_SetValue("UI.gameui.petidentifydlg.wilist",1,value_channel_timerspace);
				else
					Win_SetValue("UI.gameui.petidentifydlg.wilist",-1,value_channel_timerspace);
					
					Win_ShowWidget("UI.gameui.petidentifydlg.effect",false);
	
					if pet.bStrPer > 0 then
						Win_SetText("UI.gameui.petidentifydlg.wilist.STR", "/C25力量:/C00   "..(pet.bStrPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.AGI", "/C25敏捷:/C00   "..(pet.bAgiPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.DEX", "/C25灵巧:/C00   "..(pet.bDexPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.VIT", "/C25体质:/C00   "..(pet.bVitPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.INT", "/C25智慧:/C00   "..(pet.bIntPer*4));
						Win_SetText("UI.gameui.petidentifydlg.wilist.SPI", "/C25精神:/C00   "..(pet.bSpiPer*4));
						
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",true);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",true);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",true);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",true);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",true);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",true);
					else
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",false);
					end;
				end;
				
				Win_SetValue("UI.gameui.petidentifydlg",-1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.petidentifydlg.identifybtn", pet.bStrPer == 0);
			end;

			OnTimer=function()	-- 延迟3秒disalble按钮,避免不停的频繁鉴定.
				Win_EnableWidget("UI.gameui.petidentifydlg.identifybtn", true);
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 220,20,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 198,20,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				pet=
				{
						
					type="WIDGET",
					rect={56,78,32,32},
					groupid=0,
					groupstop=1,
					dragindex=0,							
					dragtype=ui_drag_type_pets_identify,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				wilist=
				{
						
					type="WIDGET",
					rect={109,95,120,118},
					style=wgtstyle_clipchild_window,	

					OnTimer=function()
						local panelrect = Win_GetRect("UI.gameui.petidentifydlg.wilist", value_channel_winrect);
						local t=1;
						
						if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.STR") == false) then
							Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",true);
		
							Win_SetValue("UI.gameui.petidentifydlg.wilist",t,value_channel_timerspace);
							return;
						end;
						
						if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.AGI")==false) then
							Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",true);
							
							Win_SetValue("UI.gameui.petidentifydlg.wilist",t,value_channel_timerspace);
							return;
						end;
		
						if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.DEX")==false) then
							Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",true);
		
							Win_SetValue("UI.gameui.petidentifydlg.wilist",t,value_channel_timerspace);
							return;
						end;
		
						if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.VIT")==false) then
							Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",true);
		
							Win_SetValue("UI.gameui.petidentifydlg.wilist",t,value_channel_timerspace);
							return;
						end;
		
						if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.INT")==false) then
							Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",true);
		
							Win_SetValue("UI.gameui.petidentifydlg.wilist",t,value_channel_timerspace);
							return;
						end;
		
						--if (Win_IsVisible("UI.gameui.petidentifydlg.wilist.SPI")==false) then
							
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",true);
		
						Win_ShowWidget("UI.gameui.petidentifydlg.effect",false);
						Win_SetValue("UI.gameui.petidentifydlg.wilist",-1,value_channel_timerspace);
					end;

					children=
					{
						STR= --力量
						{
							type = "LABEL",
							rect={3,5,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25力量:/C0012345(12345)";
							alphaspeed=0.1,
							alphafactor=0.0,
							visible=0;
						},
						
						AGI= --敏捷
						{
							type = "LABEL",
							rect={3,24,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25敏捷:/C0012345(12345)";
							visible=0;
							alphaspeed=0.1,
							alphafactor=0.0,
						},
						
						DEX= --灵巧
						{
							type = "LABEL",
							rect={3, 43,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25灵巧:/C0012345(12345)";
							visible=0;
							alphaspeed=0.1,
							alphafactor=0.0,
						},
						
						VIT= --体质
						{
							type = "LABEL",
							rect={3,62,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25体质:/C0012345(12345)";
							visible=0;
							alphaspeed=0.1,
							alphafactor=0.0,
						},
						
						INT= --智慧
						{
							type = "LABEL",
							rect={3,81,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25智慧:/C0012345(12345)";
							visible=0;
							alphaspeed=0.1,
							alphafactor=0.0,
						},
						
						SPI= --精神
						{
							type = "LABEL",
							rect={3,100,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							--caption="/C25精神:/C0012345(12345)";
							visible=0;
							alphaspeed=0.1,
							alphafactor=0.0,
						},				
					};
				},

				effect= 
				{
					type = "WIDGET",
					rect={70,200,1,1};
					effect={{name="TFX9149.eff", x=0, y=0, loop=1, delay=0}},					
					visible=0;
				};

				identifybtn= 
				{
					type = "BUTTON",
					rect = { 44,229,69,24 },
					bkimage="res/uires/petdlg/identifybtn.gsa",
					
					OnClick=function()
						PetIdentify();
						Win_EnableWidget("UI.gameui.petidentifydlg.identifybtn", false);
						Win_SetValue("UI.gameui.petidentifydlg",3,value_channel_timerspace);
					end;
				};

				exitbtn= 
				{
					type = "BUTTON",
					rect = { 160,229,69,24 },
					bkimage="res/uires/newcommon/clearbtn.gsa";
					OnClick=function()
						ClosePetIdentify();
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.STR",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.AGI",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.DEX",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.VIT",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.INT",false);
						Win_ShowWidget("UI.gameui.petidentifydlg.wilist.SPI",false);
					end;
				};
			};
		};
		
		--宠物
		petdlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 271+166, 529},
			bkimage="res/uires/petdlg/petdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_customclose +wgtstyle_alphawin;--+wgtstyle_clipchild_window,
			tabstop=2,
			visible=0,	
			mornitor={value_channel_dragging},
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnUpdate=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1301");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1302");
				end;
			
			ShowSkillDlg=function(show)
				Win_ShowWidget("UI.gameui.petdlg.petskillbox",show);				 
				Win_ShowWidget("UI.gameui.petdlg.petintelligencedlg",false);		
				
				local panelrect = Win_GetRect("UI.gameui.petdlg", value_channel_winrect);

				if (show==true) then
					Win_SetSize("UI.gameui.petdlg",271+166,529);
					--Win_SetSize
					--Win_ExtendEdge("UI.gameui.petdlg",271+166-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
				else
					--Win_ExtendEdge("UI.gameui.petdlg",271-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
					Win_SetSize("UI.gameui.petdlg",271,529);
				end;
			end;
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.petdlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.petdlg",false);
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.petdlg.ShowSkillDlg(true);
				
				local bshowpet=GetGameVar("showpet");
				Win_SetCheck("UI.gameui.petdlg.ShowPetcheck",(bshowpet==1));
				Win_AlignWidget("UI.gameui.petdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				local bPetMaster = GetPetMasterStatus();
				if bPetMaster == 0 then
					Win_ShowWidget("UI.gameui.petdlg.petmaster", false);
				else
					Win_ShowWidget("UI.gameui.petdlg.petmaster", true);
				end;
				
				RequestNewbieHelp(help_petdlg);
				QueryNewbieNextStep(1301);
				
				if IsCurPetSecondGen() ~= 0 then
					Win_SetCapture("UI.gameui.petdlg","QQ宝贝宠(二代宠物)");
				else
					Win_SetCapture("UI.gameui.petdlg","QQ宝贝宠");
				end;
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep13");
				UI.children.gameui.children.petstatusbar.children.peteffect.OnCloseEffect();
				
				if IsInRegisterOperation() == 1 then
					UI.children.gameui.children.petdlg.ShowSkillDlg(false);
					Win_AlignWidget("UI.gameui.petdlg","UI.gameui.registerpetdlg",aligntype_winrect,alignstyle_bottom_in+alignstyle_right_out);
				end;	
				
				if Win_IsVisible("UI.gameui.petidentifydlg") then
					Win_AlignWidget("UI.gameui.petidentifydlg", "UI.gameui.petdlg", aligntype_winrect,alignstyle_right_out+alignstyle_bottom_in);
				end;
				
				local MyPetShow = IsMyPetEffShow();
				if MyPetShow == 1 then
					if not Win_IsVisible("UI.gameui.petdlg.showeffect") then
							Win_ShowWidget("UI.gameui.petdlg.showeffect", true);
					end;
				else 
					Win_ShowWidget("UI.gameui.petdlg.showeffect", false);
				end;
			end;
			
			OnSelfHide=function()
				if Win_IsEnabled("UI.gameui.petdlg.nickname") then
					local petinfo = GetMainPetInfo();
					if petinfo ~= nil then
						Win_SetText("UI.gameui.petdlg.nickname",petinfo.nickname);
					else
						Win_SetText("UI.gameui.petdlg.nickname","");
					end;
								
				Win_EnableWidget("UI.gameui.petdlg.nickname",false);
				end;
			
				if Win_IsVisible("UI.gameui.petidentifydlg") then
					Win_ShowWidget("UI.gameui.petidentifydlg",false);
				end;
				
				RequestNewbieHelp(help_petdlg,0);
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1301");
				UI.children.gameui.children.SysInputTip.OnCloseByName("SysHelpStep1302");
			end;
			
			UpdateEffect=function()
				local MyPetShow = IsMyPetEffShow();
				if MyPetShow == 1 then
					if not Win_IsVisible("UI.gameui.petdlg.showeffect") then
							Win_ShowWidget("UI.gameui.petdlg.showeffect", true);
					end;
				else 
					Win_ShowWidget("UI.gameui.petdlg.showeffect", false);
				end;
			end;
			
			children=
			{
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_petdlg,
						offsetx=-50,
						offsety=15,
					},
					
				};
				
				showeffect =
				{
					type = "WIDGET",
					rect={96,255,1,1};
					effect={{name="TFX9854.eff", x=0, y=0, loop=1, delay=0}},					
					visible=0;	
					initlayer=11;			
				},
				
				closebtn = 
				{
					type = "BUTTON",
					rect = { 243,21,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 220,21,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_petdlg,-1);
						--[[local helpid=GetHelpID("宠物界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);]]
						end;
				};	
				
				petmaster=
				{
					type="WIDGET",
					rect = {12, 15, 26, 26},
					bkimage="res/uires/petdlg/petmaster.gsa",
					enable = 1,
					dragtype=ui_drag_type_petmaster,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
					visible = 1,
				};
				
				ShowPetcheck= 
				{
					type = "CHECK",
					rect={37,507,69,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					tiptext="设置是否\n秀出宠物",
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						SetGameVar("showpet",1);
						else
						SetGameVar("showpet",0);
						end;						
						end;		
				};

				OpenBeHidecheckbk= 
				{
					type = "WIDGET",
					rect = { 157,507,0,0 },
					bkimage="res/uires/petdlg/OpenBeHidecheckbk.gsa";
					style=wgtstyle_renderitem,
					dragtype=-1,
					dragindex=-1,
					visible=1,
					initlayer=101;
					updatemute=1,				
				};
				
				OpenBeHidecheck= 
				{
					type = "CHECK",
					rect={139,508,128,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					tiptext="是否开启不可屏蔽功能",
					initlayer=102;
					
					OnCheck=function(bcheck, bchecked)
						if bcheck ~= bchecked then
							if bcheck==1 then
								SetPetCanNotHide(0);
							else
								SetPetCanNotHide(1);
							end;						
						end;		
					end;
				};			
				
				nicknamebtn=
				{
					type="BUTTON",
					rect={218,51,42,20},
					bkimage="res/uires/petdlg/nicknamebtn.gsa",

					tiptext="点击设置\n宠物称号",
					
					OnClick=function()
						if Win_IsEnabled("UI.gameui.petdlg.nickname") then
						Win_EnableWidget("UI.gameui.petdlg.nickname",false);
						txt=Win_GetText("UI.gameui.petdlg.nickname");
						SetPetNickName(txt);						
						elseif g_PetInfo~=nil then					
						Win_EnableWidget("UI.gameui.petdlg.nickname",true);
						Win_SetFocus("UI.gameui.petdlg.nickname");
						end;						
						end;					
				};
				
				intelligencebtn=
				{
					type="BUTTON",
					rect={131,384,42,20},
					bkimage="res/uires/petdlg/intelligencebtn.gsa",
					visible=1;

					OnClick=function()
						Win_ToggleWidget("UI.gameui.petdlg.petintelligencedlg",0);
					end;					
				};	

				confirmbtn=
				{
					type="BUTTON",
					rect={175,382,42,20},
					bkimage="res/uires/petdlg/okbtn.gsa",
					visible=0;

					OnClick=function()
					end;					
				};			
				
				cancelbtn=
				{
					type="BUTTON",
					rect={218,382,42,20},
					bkimage="res/uires/petdlg/cancelbtn.gsa",
					visible=0;

					OnClick=function()
					end;					
				};				
				--宠物
				charactor = 
				{
					type = "WIDGET",
					rect = {56,131,83,96},
					edgecolor={0,0,0,0},											
					style=wgtstyle_static+wgtstyle_renderbuffer,
					custombuffer=custom_buffer_pet,
				},
					
					
				--宠物列表
				pet1=
				{
						
					type="WIDGET",
					rect={69,449,32,32},
					groupid=0,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_pets,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
																		
				},
				
				pet2=
				{
						
					type="WIDGET",
					rect={106,449,32,32},
					groupid=0,
					groupstop=6,
					dragindex=1,								
					dragtype=ui_drag_type_pets,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
											
				},
								
				pet3=
				{
						
					type="WIDGET",
					rect={144,449,32,32},
					groupid=0,
					groupstop=1,
					dragindex=2,							
					dragtype=ui_drag_type_pets,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
											
				},
				
				pet4=
				{
						
					type="WIDGET",
					rect={182,449,32,32},
					groupid=0,
					groupstop=7,
					dragindex=3,							
					dragtype=ui_drag_type_pets,					
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",

											
				},
				
				
				pet5=
				{
						
					type="WIDGET",
					rect={220,449,32,32},
					groupid=0,
					groupstop=4,
					dragindex=4,							
					dragtype=ui_drag_type_pets,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
											
				},
				
				--名称
				prename= 
				{
					type = "LABEL",
					rect={37,57,58,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;
				},
				
				nickname = 
				{
					type = "EDIT",
					rect={107,57,96,12};
					bkimage="res/uires/petdlg/nicknameedit.gsa",
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkimagepos={-11,-6},
					framescheme={{0,1,0,1,0,1,0,0},},
					drawcolor= { 255, 255, 255, 255 },
					graycolor= { 255, 255, 255, 255 },
					textsize=12;
					maxchar=11;
					enable=1;
											
					OnEnter=function()
						UI.children.gameui.children.petdlg.children.nicknamebtn.OnClick();
						end;
					
				},
				
				--pp果实
				pppoint = 
				{
					type = "LABEL",
					rect={195,407,40,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},	

				--pp果实
				newpppoint = 
				{
					type = "LABEL",
					rect={38,490,230,12};
					drawcolor = { 221, 189, 119, 255 },
					textsize=12;
					textstyle=dt_left;
					enable=1;					
				},				
								
				--生命
				life = 
				{
					type = "LABEL",
					rect={79,88,72,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},
				
				--法力
				magic = 
				{
					type = "LABEL",
					rect={201,88,52,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},
				
				--等级
				level = 
				{
					type = "LABEL",
					rect={197,114,18,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},
				
				--饥渴
				starve = 
				{
					type = "LABEL",
					rect={206,133,48,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},
				
				--信任
				trust = 
				{
					type = "LABEL",
					rect={206,153,48,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},
				
				--食性
				habit = 
				{
					type = "LABEL",
					rect={222,111,16,16};
					bkimage="res/uires/petdlg/habit.gsa",										
					framescheme={{0},{1},{2},{3}},
					enable=1;
					
				},

				
				--性别
				gender = 
				{
					type = "LABEL",
					rect={240,111,16,16};
					bkimage="res/uires/petdlg/gender.gsa",
					framescheme={{0},{1},{2},},
					enable=1;					
				},
				
				
				--装备
				petequip1=
				{
						
					type="WIDGET",
					rect={174,177,30,30},										
					dragtype=ui_drag_type_curpetequip,
					dragindex=cs_pos_pethead,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip2=
				{
						
					type="WIDGET",
					rect={220,177,30,30},										
					dragtype=ui_drag_type_curpetequip,
					dragindex=cs_pos_petbody,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip3=
				{
						
					type="WIDGET",
					rect={174,220,30,30},										
					dragtype=ui_drag_type_curpetequip,
					dragindex=cs_pos_petaccout,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip4=
				{
						
					type="WIDGET",
					rect={220,220,30,30},										
					dragtype=ui_drag_type_curpetequip,
					dragindex=cs_pos_petspecial,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},			
				
				--经验
				experience = 
				{
					type = "LABEL",
					rect = { 92,426,125,12 },
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=1;
				},
				
				--左边
				--剩余点数
				point = 
				{
					type = "LABEL",
					rect = { 105,388,28,12 },
					drawcolor = { 255, 255, 255, 255 },								
					tiptext="用于升级的剩余点数";
					textsize=12;					
					enable=0;
				},
				
				pointfire= 
				{
					type = "LABEL",
					rect = { 90,388,16,16 },
					effectpic="res/uires/common/pointfire.gsa",
					effectpicpos={-5,-15},
					drawflag=drawflag_draw_effect,
				},
				
				--力量
				STR = 
				{
					type = "LABEL",
					rect={32,323,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响攻击力\n及最大负重";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},					
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
						 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
						 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
						 end;				
				},
				
				-- 敏捷
				AGI = 
				{
					type = "LABEL",
					rect={32,343,69,16};
					captionrect = { 34,2,35,12 },					
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响防御";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},					
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;				
				},
				
				-- 灵巧
				DEX = 
				{
					type = "LABEL",
					rect={32,363,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响命中";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;						
				},

				-- 体质
				VIT = 
				{
					type = "LABEL",
					rect={148,323,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响生命力最大值";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				-- 智慧
				INT = 
				{
					type = "LABEL",
					rect={148,343,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法攻击力";		
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},

					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;						
				},
				
				-- 精神
				SPI = 
				{
					type = "LABEL",
					rect={148,363,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法防御力以及\n法力点数最大值",
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},

					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;		
				},
				
				--右边
				MaxATK = 
				{
					type = "LABEL",
					rect={158,271,90,12},
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n大物理攻击力",
				},			
				
				MinATK = 
				{
					type = "LABEL",
					rect={35,271,90,12},
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n小物理攻击力",
				},			

				Def = 
				{
					type = "LABEL",
					rect={35,286,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响怪物物理\n攻击的命中率",
				},
				
				Hit = 
				{
					type = "LABEL",
					rect={35,301,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响攻击\n的准确率",
					
				},
				
				Matk = 
				{
					type = "LABEL",
					rect={158,286,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响魔法技\n能伤害力",
					
				},
				
				Mdef = 
				{
					type = "LABEL",
					rect={158,301,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响对魔法攻\n击的抵抗力",
					
				},
				
							
				
				--SPIN按钮区

				--STR
				strspinup=
				{
					type="SPIN",
					rect={103,324,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响攻击力\n及最大负重";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
							 end;				

					 OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.STR=g_PetInfo.STR+1;
							end;
							end;
							end;
				},
				
				strspindn=
				{
					type="SPIN",
					rect={122,324,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响攻击力\n及最大负重";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
							 color=GetColorIndex(0,255,0);
							 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
							 end;
							 
					OnMouseOut=function()
							 color=GetColorIndex(255,255,255);
							 Win_SetValue("UI.gameui.petdlg.MaxATK",color,value_channel_color_draw);
							 Win_SetValue("UI.gameui.petdlg.MinATK",color,value_channel_color_draw); 
							 end;				

					 OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.STR=g_PetInfo.STR+1;
							end;
							end;
							end;
				},					
				
				--AGI
				agispinup=
				{
					type="SPIN",
					rect={103,344,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",		
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响防御";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;		

					 OnClick=function()
						if g_PetInfo~=nil then
						if g_PetInfo.POINTS > 0 then
						g_PetInfo.POINTS=g_PetInfo.POINTS-1;
						g_PetInfo.AGI=g_PetInfo.AGI+1;									
						end;
						end;
						end;
				},
				
				agispindn=
				{
					type="SPIN",
					rect={122,344,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",		
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响防御";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Def",color,value_channel_color_draw);
						 end;		

					 OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.AGI=g_PetInfo.AGI+1;									
							end;
							end;
							end;
				},
				
				--DEX
				dexspinup=
				{
					type="SPIN",
					rect={103,364,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响命中";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;						
					
					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.DEX=g_PetInfo.DEX+1;																		
							end;
							end;
							end;
				},
				
				dexspindn=
				{
					type="SPIN",
					rect={122,364,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响命中";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Hit",color,value_channel_color_draw);
						 end;						

					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.DEX=g_PetInfo.DEX+1;																		
							end;
							end;
							end;
				},	
				
				--VIT
				vitspinup=
				{
					type="SPIN",
					rect={219,324,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响生命力最大值";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.VIT=g_PetInfo.VIT+1;																		
							end;
							end;
							end;
				},
				
				vitspindn=
				{
					type="SPIN",
					rect={238,324,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响生命力最大值";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.VIT=g_PetInfo.VIT+1;																		
							end;
							end;
							end;
				},				
				
				--INT
				intspinup=
				{
					type="SPIN",
					rect={219,344,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响魔法攻击力";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
										
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;						

					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.INT=g_PetInfo.INT+1;																		
							end;
							end;
							end;	
				},
				
				intspindn=
				{
					type="SPIN",
					rect={238,344,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响魔法攻击力";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
										
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Matk",color,value_channel_color_draw);
						 end;						

					OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.INT=g_PetInfo.INT+1;																		
							end;
							end;
							end;	
				},				
				
				--SPI
				spispinup=
				{
					type="SPIN",
					rect={219,364,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					tiptext="影响魔法防御力以及\n法力点数最大值",
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;		

					 OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.SPI=g_PetInfo.SPI+1;																		
							end;
							end;
							end;
				},	
				
				spispindn=
				{
					type="SPIN",
					rect={238,364,20,19},
					bkimage="res/uires/newcommon/minusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=1,
					visible=0;
					tiptext="影响魔法防御力以及\n法力点数最大值",
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
					
					OnMouseIn=function()
						 color=GetColorIndex(0,255,0);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;
							 
					OnMouseOut=function()
						 color=GetColorIndex(255,255,255);
						 Win_SetValue("UI.gameui.petdlg.Mdef",color,value_channel_color_draw);
						 end;		

					 OnClick=function()
							if g_PetInfo~=nil then
							if g_PetInfo.POINTS > 0 then
							g_PetInfo.POINTS=g_PetInfo.POINTS-1;
							g_PetInfo.SPI=g_PetInfo.SPI+1;																		
							end;
							end;
							end;
				},					

				-- 宠物的资质dlg
				petintelligencedlg=
				{
					type = "WIDGET",
					rect = { 271, 180, 144, 160},
					style=wgtstyle_static;
					bkimage="res/uires/petdlg/intelligencedlg.gsa",
					visible=0,	
					
					children=
					{
						closebtn = 
						{
							type = "BUTTON",
							rect = { 118,5,22,23 },
							bkimage="res/uires/newcommon/miniclose.gsa",
							defaultcancel=1,
							 OnClick=function()
								Win_ShowWidget("UI.gameui.petdlg.petintelligencedlg", false);
							 end;
						},
						
						STR= --力量
						{
							type = "LABEL",
							rect={14,38,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25力量:/C0012345(12345)";
						},
						
						AGI= --敏捷
						{
							type = "LABEL",
							rect={14,57,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25敏捷:/C0012345(12345)";
						},
						
						DEX= --灵巧
						{
							type = "LABEL",
							rect={14,76,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25灵巧:/C0012345(12345)";
						},
						
						VIT= --体质
						{
							type = "LABEL",
							rect={14,95,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25体质:/C0012345(12345)";
						},
						
						INT= --智慧
						{
							type = "LABEL",
							rect={14,114,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25智慧:/C0012345(12345)";
						},
						
						SPI= --精神
						{
							type = "LABEL",
							rect={14,133,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25精神:/C0012345(12345)";
						},
					};
				};
				
				petskillbox= 
				{
					type = "WIDGET",
					rect={271,339,166,187};
					style=wgtstyle_static;
					adornpic={"res/uires/petdlg/petskilldlg.gsa", "res/uires/petdlg/petskilldlg_fight.gsa"},
					adornpicpos={{0, 0}, {0, 114}},

					children=
					{
						itempetskill0=
						{
								
							type="WIDGET",
							rect={8,31,36,36},
							dragindex=0,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill1=
						{
								
							type="WIDGET",
							rect={46,31,36,36},
							dragindex=1,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill2=
						{
								
							type="WIDGET",
							rect={84,31,36,36},
							dragindex=2,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill3=
						{
								
							type="WIDGET",
							rect={122,31,36,36},
							dragindex=3,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill4=
						{
								
							type="WIDGET",
							rect={8,71,36,36},
							dragindex=4,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill5=
						{
								
							type="WIDGET",
							rect={46,71,36,36},
							dragindex=5,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill6=
						{
								
							type="WIDGET",
							rect={84,71,36,36},
							dragindex=6,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill7=
						{
								
							type="WIDGET",
							rect={122,71,36,36},
							dragindex=7,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill8=
						{
								
							type="WIDGET",
							rect={8,144,36,36},
							dragindex=8,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill9=
						{
								
							type="WIDGET",
							rect={46,144,36,36},
							dragindex=9,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill10=
						{
								
							type="WIDGET",
							rect={84,144,36,36},
							dragindex=10,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill11=
						{
								
							type="WIDGET",
							rect={122,144,36,36},
							dragindex=11,
							dragtype=ui_drag_type_skill_pet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
					};-- petskillsbox
				}; 
			};--petdlg children
			
		};--petdlg 玩家在游戏中的状态
		
		--其他玩家宠物
		otherpetdlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 271+166, 529},
			bkimage="res/uires/petdlg/petdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_customclose +wgtstyle_alphawin;--+wgtstyle_clipchild_window,
			tabstop=2,
			visible=0,	
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.otherpetdlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.otherpetdlg",false);
				end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.otherpetdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.otherpetdlg.petintelligencedlg",false);
				
				if IsCurPetSecondGen() ~= 0 then
					Win_SetCapture("UI.gameui.otherpetdlg","QQ宝贝宠(二代宠物)");
				else
					Win_SetCapture("UI.gameui.otherpetdlg","QQ宝贝宠");
				end;
				
				g_PetInfo=GetOtherPet();				
				
				if g_PetInfo~=nil then	
				
				Win_SetText("UI.gameui.otherpetdlg.prename",g_PetInfo.prename);
				
				if not Win_IsEnabled("UI.gameui.otherpetdlg.nickname") then
				Win_SetText("UI.gameui.otherpetdlg.nickname",g_PetInfo.nickname);
				end;
				
				Win_SetText("UI.gameui.otherpetdlg.life", g_PetInfo.CURHP);
				Win_SetText("UI.gameui.otherpetdlg.magic", g_PetInfo.CURSP);
				Win_SetText("UI.gameui.otherpetdlg.starve", g_PetInfo.STARVE);
				Win_SetText("UI.gameui.otherpetdlg.trust", g_PetInfo.TRUST);
				
				--Win_ShowWidget("UI.gameui.otherpetdlg.habit",true);
				Win_ShowWidget("UI.gameui.otherpetdlg.gender",true);			
				Win_SetValue("UI.gameui.otherpetdlg.habit",   g_PetInfo.HABIT-1,value_channel_framescheme);
				Win_SetValue("UI.gameui.otherpetdlg.gender", g_PetInfo.gender,value_channel_framescheme);
				
				Win_SetText("UI.gameui.otherpetdlg.STR",g_PetInfo.STR);	
				Win_SetText("UI.gameui.otherpetdlg.AGI",g_PetInfo.AGI);
				Win_SetText("UI.gameui.otherpetdlg.DEX",g_PetInfo.DEX);				
				Win_SetText("UI.gameui.otherpetdlg.VIT",g_PetInfo.VIT);	
				Win_SetText("UI.gameui.otherpetdlg.INT",g_PetInfo.INT);	
				Win_SetText("UI.gameui.otherpetdlg.SPI",g_PetInfo.SPI);
				
				Win_SetText("UI.gameui.otherpetdlg.pppoint",g_PetInfo.pppoint);
				Win_SetText("UI.gameui.otherpetdlg.newpppoint",g_PetInfo.newppPoint);
				
				--[[
				Win_SetText("UI.gameui.otherpetdlg.MaxATK", g_PetInfo.MAXATK);
				Win_SetText("UI.gameui.otherpetdlg.MinATK", g_PetInfo.MINATK);
				Win_SetText("UI.gameui.otherpetdlg.Def", g_PetInfo.DEF);	
				Win_SetText("UI.gameui.otherpetdlg.Matk",g_PetInfo.MATK);	
				Win_SetText("UI.gameui.otherpetdlg.Mdef",g_PetInfo.MDEF);	
				Win_SetText("UI.gameui.otherpetdlg.Hit", g_PetInfo.HITRATE);	
				]]		
				
				if g_PetInfo.bStrPer > 0 then
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.STR", string.format("/C25力量:/C00  %-4d ( %d )", g_PetInfo.bStrPer*4, g_PetInfo.bStrMax*4));
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.AGI", string.format("/C25敏捷:/C00  %-4d ( %d )", g_PetInfo.bAgiPer*4, g_PetInfo.bAgiMax*4));
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.DEX", string.format("/C25灵巧:/C00  %-4d ( %d )", g_PetInfo.bDexPer*4, g_PetInfo.bDexMax*4));
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.VIT", string.format("/C25体质:/C00  %-4d ( %d )", g_PetInfo.bVitPer*4, g_PetInfo.bVitMax*4));
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.INT", string.format("/C25智慧:/C00  %-4d ( %d )", g_PetInfo.bIntPer*4, g_PetInfo.bIntMax*4));
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.SPI", string.format("/C25精神:/C00  %-4d ( %d )", g_PetInfo.bSpiPer*4, g_PetInfo.bSpiMax*4));
				else
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.STR", "/C25力量:/C00   ");	
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.AGI", "/C25敏捷:/C00   ");	
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.DEX", "/C25灵巧:/C00   ");	
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.VIT", "/C25体质:/C00   ");	
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.INT", "/C25智慧:/C00   ");	
					Win_SetText("UI.gameui.otherpetdlg.petintelligencedlg.SPI", "/C25精神:/C00   ");	
				end;
				
				Win_SetText("UI.gameui.otherpetdlg.point",g_PetInfo.POINTS);
				Win_ShowWidget("UI.gameui.otherpetdlg.pointfire",(g_PetInfo.POINTS>0));
			
				text=g_PetInfo.EXP;
				Win_SetText("UI.gameui.otherpetdlg.experience",text);
				
				Win_SetText("UI.gameui.otherpetdlg.level",g_PetInfo.LEVEL);		
				end;
				
				local OtherPetShow = IsOtherPetEffShow();
				if OtherPetShow == 1 then
					if not Win_IsVisible("UI.gameui.otherpetdlg.showeffect") then
							Win_ShowWidget("UI.gameui.otherpetdlg.showeffect", true);
					end;
				else 
					Win_ShowWidget("UI.gameui.otherpetdlg.showeffect", false);
				end;
			end;
			
			
			UpdateEffect=function()
				local OtherPetShow = IsOtherPetEffShow();
				if OtherPetShow == 1 then
					if not Win_IsVisible("UI.gameui.otherpetdlg.showeffect") then
							Win_ShowWidget("UI.gameui.otherpetdlg.showeffect", true);
					end;
				else 
					Win_ShowWidget("UI.gameui.otherpetdlg.showeffect", false);
				end;
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 243,21,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				showeffect =
				{
					type = "WIDGET",
					rect={96,255,1,1};
					effect={{name="TFX9854.eff", x=0, y=0, loop=1, delay=0}},					
					visible=0;	
					initlayer=11;			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 220,21,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						GameUILogInfo("此功能未开放!");
						end;
				};	
				
				ShowPetcheck= 
				{
					type = "CHECK",
					rect={37,507,69,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					tiptext="设置是否\n秀出宠物",
					enable=0,
				};
				
				nicknamebtn=
				{
					type="BUTTON",
					rect={218,51,42,20},
					bkimage="res/uires/petdlg/nicknamebtn.gsa",
					tiptext="点击设置\n宠物称号",
					enable=0,					
				};
				
				--宠物
				charactor = 
				{
					type = "WIDGET",
					rect = {56,131,83,96},
					edgecolor={0,0,0,0},											
					style=wgtstyle_static+wgtstyle_renderbuffer,
					custombuffer=custom_buffer_otherpet,
				},
					
				--名称
				prename= 
				{
					type = "LABEL",
					rect={37,57,58,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;
				},
				
				nickname = 
				{
					type = "LABEL",
					rect={107,57,96,12};
					bkimage="res/uires/petdlg/nicknameedit.gsa",
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkimagepos={-11,-6},
					framescheme={{0,1,0,1,0,1,0,0},},
					drawcolor= { 255, 255, 255, 255 },
					graycolor= { 255, 255, 255, 255 },
					textsize=12;
					maxchar=11;
					enable=0;
											
					OnEnter=function()
						UI.children.gameui.children.petdlg.children.nicknamebtn.OnClick();
						end;
					
				},
								
				intelligencebtn=
				{
					type="BUTTON",
					rect={131,384,42,20},
					bkimage="res/uires/petdlg/intelligencebtn.gsa",
					visible=1;

					OnClick=function()
						Win_ToggleWidget("UI.gameui.otherpetdlg.petintelligencedlg",0);
					end;					
				};	
				
				--pp果实
				pppoint = 
				{
					type = "LABEL",
					rect={195,407,40,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=1;					
				},	
					
				--pp果实
				newpppoint = 
				{
					type = "LABEL",
					rect={38,490,230,12};
					drawcolor = { 221, 189, 119, 255 },
					textsize=12;
					textstyle=dt_left;
					enable=1;					
				},	

				--生命
				life = 
				{
					type = "LABEL",
					rect={79,88,72,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;					
				},
				
				--法力
				magic = 
				{
					type = "LABEL",
					rect={201,88,52,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;					
				},
				
				--等级
				level = 
				{
					type = "LABEL",
					rect={197,114,18,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;					
				},
				
				--饥渴
				starve = 
				{
					type = "LABEL",
					rect={206,133,48,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;					
				},
				
				--信任
				trust = 
				{
					type = "LABEL",
					rect={206,153,48,12};
					drawcolor = { 255, 255, 255, 255 },
					textsize=12;
					enable=0;					
				},
				
				--食性
				habit = 
				{
					type = "LABEL",
					rect={222,111,16,16};
					bkimage="res/uires/petdlg/habit.gsa",										
					framescheme={{0},{1},{2},{3}},
					enable=0;
					visible=0,				
				},
				
				--性别
				gender = 
				{
					type = "LABEL",
					rect={240,111,16,16};
					bkimage="res/uires/petdlg/gender.gsa",
					framescheme={{0},{1},{2},},
					enable=0;					
				},

				--装备
				petequip1=
				{
						
					type="WIDGET",
					rect={174,177,30,30},										
					dragtype=ui_drag_type_otherpetequip,
					dragindex=cs_pos_pethead,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip2=
				{
						
					type="WIDGET",
					rect={220,177,30,30},										
					dragtype=ui_drag_type_otherpetequip,
					dragindex=cs_pos_petbody,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip3=
				{
						
					type="WIDGET",
					rect={174,220,30,30},										
					dragtype=ui_drag_type_otherpetequip,
					dragindex=cs_pos_petaccout,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				petequip4=
				{
						
					type="WIDGET",
					rect={220,220,30,30},										
					dragtype=ui_drag_type_otherpetequip,
					dragindex=cs_pos_petspecial,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				},
				
				--经验
				experience = 
				{
					type = "LABEL",
					rect = { 92,426,125,12},
					drawcolor = { 255, 255, 255, 255 },							
					textsize=12;
					textstyle=dt_center;
					enable=0;
				},
				
				--左边
				--剩余点数
				point = 
				{
					type = "LABEL",
					rect = { 105,388,28,12 },
					drawcolor = { 255, 255, 255, 255 },								
					tiptext="用于升级的剩余点数";
					textsize=12;					
					enable=0;
				},
				
				pointfire= 
				{
					type = "LABEL",
					rect = { 90,388,16,16 },
					effectpic="res/uires/common/pointfire.gsa",
					effectpicpos={-5,-15},
					drawflag=drawflag_draw_effect,
				},
				
				
				STR = 
				{
					type = "LABEL",
					rect={32,323,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响攻击力\n及最大负重";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},					
				},
				
				AGI = 
				{
					type = "LABEL",
					rect={32,343,69,16};
					captionrect = { 34,2,35,12 },					
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响防御";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},					
				},
				
				VIT = 
				{
					type = "LABEL",
					rect={148,323,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响生命力最大值";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				INT = 
				{
					type = "LABEL",
					rect={148,343,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法攻击力";		
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				DEX = 
				{
					type = "LABEL",
					rect={32,363,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响命中";	
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				SPI = 
				{
					type = "LABEL",
					rect={148,363,69,16};
					captionrect = { 34,2,35,12 },
					drawcolor = { 255, 255, 255, 255 },		
					tiptext="影响魔法防御力以及\n法力点数最大值",
					textsize=12,
					tippos={0,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				--右边
				MaxATK = 
				{
					type = "LABEL",
					rect={158,271,90,12},
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n大物理攻击力",
				},			
				
				MinATK = 
				{
					type = "LABEL",
					rect={35,271,90,12},
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="角色当前的最\n小物理攻击力",
				},			

				Def = 
				{
					type = "LABEL",
					rect={35,286,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响怪物物理\n攻击的命中率",
				},
				
				Hit = 
				{
					type = "LABEL",
					rect={35,301,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响攻击\n的准确率",
					
				},
				
				Matk = 
				{
					type = "LABEL",
					rect={158,286,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响魔法技\n能伤害力",
					
				},
				
				Mdef = 
				{
					type = "LABEL",
					rect={158,301,90,12};
					captionrect = { 53,0,35,12},
					drawcolor = { 255, 255, 255, 255 },		
					textsize=12,
					tiptext="影响对魔法攻\n击的抵抗力",
					
				},
							
				
				--SPIN按钮区

				--STR
				strspinup=
				{
					type="SPIN",
					rect={103,324,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响攻击力\n及最大负重";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
					
				
				--AGI
				agispinup=
				{
					type="SPIN",
					rect={103,344,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",		
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响防御";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
						
				--VIT
				vitspinup=
				{
					type="SPIN",
					rect={219,324,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响生命力最大值";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				
				--INT
				intspinup=
				{
					type="SPIN",
					rect={219,344,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响魔法攻击力";	
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				--DEX
				dexspinup=
				{
					type="SPIN",
					rect={103,364,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响命中";
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},
				
				--SPI
				spispinup=
				{
					type="SPIN",
					rect={219,364,20,19},
					bkimage="res/uires/newcommon/plusbtn.gsa",	
					bkimagepos={-2,-2};
					enable=0,
					tiptext="影响魔法防御力以及\n法力点数最大值",
					tippos={-89,-10,aligntype_winrect,alignstyle_left_out+alignstyle_top_in},
				},	

				-- 宠物的资质dlg
				petintelligencedlg=
				{
					type = "WIDGET",
					rect = { 271, 165, 144, 160},
					style=wgtstyle_static;
					bkimage="res/uires/petdlg/intelligencedlg.gsa",
					visible=0,	
					
					children=
					{
						closebtn = 
						{
							type = "BUTTON",
							rect = { 118,5,22,23 },
							bkimage="res/uires/newcommon/miniclose.gsa",
							defaultcancel=1,
							 OnClick=function()
								Win_ShowWidget("UI.gameui.otherpetdlg.petintelligencedlg", false);
							 end;
						},
						
						STR= --力量
						{
							type = "LABEL",
							rect={14,38,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25力量:/C0012345(12345)";
						},
						
						AGI= --敏捷
						{
							type = "LABEL",
							rect={14,57,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25敏捷:/C0012345(12345)";
						},
						
						DEX= --灵巧
						{
							type = "LABEL",
							rect={14,76,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25灵巧:/C0012345(12345)";
						},
						
						VIT= --体质
						{
							type = "LABEL",
							rect={14,95,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25体质:/C0012345(12345)";
						},
						
						INT= --智慧
						{
							type = "LABEL",
							rect={14,114,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25智慧:/C0012345(12345)";
						},
						
						SPI= --精神
						{
							type = "LABEL",
							rect={14,133,120,12};
							enable=0;
							textstyle=dt_left;
							textsize=12;
							richmode=ui_richmode_all,
							caption="/C25精神:/C0012345(12345)";
						},
					};
				};
				
				petskillbox= 
				{
					type = "WIDGET",
					rect={271,326,166,187};
					style=wgtstyle_static;
					adornpic={"res/uires/petdlg/petskilldlg.gsa", "res/uires/petdlg/petskilldlg_fight.gsa"},
					adornpicpos={{0, 0}, {0, 114}},

					children=
					{
						itempetskill0=
						{
								
							type="WIDGET",
							rect={8,31,36,36},
							dragindex=0,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill1=
						{
								
							type="WIDGET",
							rect={46,31,36,36},
							dragindex=1,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill2=
						{
								
							type="WIDGET",
							rect={84,31,36,36},
							dragindex=2,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill3=
						{
								
							type="WIDGET",
							rect={122,31,36,36},
							dragindex=3,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill4=
						{
								
							type="WIDGET",
							rect={8,71,36,36},
							dragindex=4,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill5=
						{
								
							type="WIDGET",
							rect={46,71,36,36},
							dragindex=5,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill6=
						{
								
							type="WIDGET",
							rect={84,71,36,36},
							dragindex=6,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill7=
						{
								
							type="WIDGET",
							rect={122,71,36,36},
							dragindex=7,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill8=
						{
								
							type="WIDGET",
							rect={8,144,36,36},
							dragindex=8,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill9=
						{
								
							type="WIDGET",
							rect={46,144,36,36},
							dragindex=9,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill10=
						{
								
							type="WIDGET",
							rect={84,144,36,36},
							dragindex=10,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
						
						itempetskill11=
						{
								
							type="WIDGET",
							rect={122,144,36,36},
							dragindex=11,
							dragtype=ui_drag_type_skill_otherpet,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",																		
						};
					};-- petskillsbox
				}; 		
			};--otherpetdlg children
			
		};--petdlg 玩家在游戏中的状态
		
		--宠物唤醒
		petwakedlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 280, 330},
			bkimage="res/uires/petdlg/petwakedlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,	
			updatemute=1,
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 252,20,23,22 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 230,20,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("宠物唤醒");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};			
				
				cancelbtn=
				{
					type="BUTTON",
					rect={120,298,69,24},
					bkimage="res/uires/newcommon/closebtn.gsa",					
					defaultcancel=1,    
				};
				
				petlist=
				{
					type="WIDGETLIST",
					rect={35,68,244,234},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_pets_wake,
					dragindex=-1,
					itemmarginh=4,
					itemmarginv=4,
					itemnum=5;
					
					template={"res/uires/petitem.lua"};
					
					children={},
				},--list
			}
		};
		
		--宠物培育信息栏
		petfosterinfodlg=
		{
			type = "DIALOG",
			rect={0,0,352,274},
			bkimage="res/uires/petdlg/petfosterinfodlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			
			OnCancel=function()
				       ClearRegPetInfo();
				       end;
			OnSelfShow=function()
				LockPlayer(1);
			end;	
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 324,19,23,22 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					OnClick=function()
						ClearRegPetInfo();
						end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 302,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("登记宠物信息");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};

				allinfotab=
				{
					type="TABWIN",
					rect={34,65,307,168},
					tabrect={2,0,82,22},
					tabcover="res/uires/petdlg/allinfobtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=0,
					tabstop=0,
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					soundid={1003},
					checked=1,
					
					children=
					{
						titlepic=
						{
							type="BUTTON", 
							rect={281,0,23,21},
							bkimage="res/uires/petdlg/petfosterinfotitile2.gsa",
						};
						
						registerpetbtn=
						{
							type="BUTTON",
							rect={158,175,69,24},
							bkimage="res/uires/petdlg/registerpetbtn.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.petfosterinfodlg", false);
								Win_ShowWidget("UI.gameui.registerpetdlg", true);
								end;
						};
						
						cancelbtn=
						{
							type = "BUTTON",
							rect={238,175,69,24},
							bkimage="res/uires/newcommon/cancelbtn2.gsa",
							OnClick=function()
								Win_ShowWidget("UI.gameui.petfosterinfodlg", false);
								ClearRegPetInfo();
								end;
						};
						
						prepagebtn=
						{
							type="BUTTON",
							rect={-2,175,69,24},
							bkimage="res/uires/petdlg/prepage.gsa",
							
							OnClick=function()
								DecreasePageNum();
								end;
						};
						
						nextpagebtn=
						{
							type="BUTTON",
							rect = { 78,175,69,24 },
							bkimage="res/uires/petdlg/nextpage.gsa",
							OnClick=function()
								IncreasePageNum();
								end;	
						
						};
						
						petkindbtn=
						{
							type="BUTTON",
							bkimage="res/uires/petdlg/petkindbtn.gsa",
							rect={0,0,81,21},
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(0, 0);
								end;
						};
						
						petownerbtn=
						{
							type="BUTTON",
							rect={81,0,80,21},
							bkimage="res/uires/petdlg/petownerbtn.gsa",
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(0, 1);
								end;
						};
						
						petsexbtn=
						{
							type="BUTTON",
							rect={161,0,60,21},
							bkimage="res/uires/petdlg/petsexbtn.gsa",
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(0, 2);
								end;
						};
						
						petlevelbtn=
						{
							type="BUTTON",
							rect={221,0,60,21},
							bkimage="res/uires/petdlg/petlevelbtn.gsa",
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(0, 3);
								end;
						};
						
						fosterinfolist=
						{
							type="LISTBOX",
							rect={2,22,284,144},	
							style=wgtstyle_clipself+wgtstyle_renderitem+wgtstyle_vertical,		
							extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
							dragtype=ui_drag_type_allfosterinfolist,
							itemselback="res/uires/family/detailitemsel.gsa",
							--itemselpos={36,26,276,146},
							itemwidth=281,
							itemheight=21,
							itemmarginh=0,
							itemmarginv=0,	
							textsize=12,
							updatemute=1,
							tipwidget="UI.gameui.ScrnTooltip",
							
							OnRClick=function(idx)							
								local matename = GetMateName(idx);
								if matename ~= nil then
									UI.children.gameui.OnOpenPlayerMenu(matename);
									end;
								end;
								
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={283,17,20,108},					
									style=wgtstyle_vertical+wgtstyle_ajustfollow,
									ajustflag=rect_flag_window+rect_flag_client;	
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=36,
									pagesize=8,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
																		
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,						
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
									};--children
								};
							};
						};	
					};
				};
				
				myinfotab=
				{
					type="TABWIN",
					rect={34,65,307,168},
					tabrect={85,0,82,22},
					tabcover="res/uires/petdlg/myinfobtn.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=1,
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					initlayer=msgbox_layer-2,
					soundid={1003},
					checked=0,
				
					OnCheck=function(bchecked)
					if bchecked ~= 0 then
						local count=GetPetRegInfoCount(1);
						Win_SetValue("UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist", count, value_channel_item_num);
						end;
						end;
						
					children=
					{
						titlepic=
						{
							type="BUTTON", 
							rect={201,0,103,21},
							bkimage="res/uires/petdlg/petfosterinfotitile1.gsa",
						};
						
						cancelallbtn=
						{
							type="BUTTON",
							rect={24,175,86,24},
							bkimage="res/uires/petdlg/cancelallregister.gsa",
							
							OnClick=function()
								Win_ShowMsgBox("您确定要撤销登记所有宠物吗？","系统消息",ui_msgid_yesno,"UI.gameui.petfosterinfodlg.myinfotab.cancelallbtn");
								end;
							
							OnMsgBoxOk=function()
								CancelPetReg(1);
								Win_SetValue("UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist",  0, value_channel_item_num);
								Win_EnableWidget("UI.gameui.petfosterinfodlg.allinfotab.registerpetbtn", true);
								end;
						};
						
						cancelbtn=
						{
							type = "BUTTON",
							rect = { 200,175,86,24 },
							bkimage="res/uires/newcommon/cancelsmallbtn.gsa",
							OnClick=function()
								Win_ShowWidget("UI.gameui.petfosterinfodlg", false);
								end;
						};
						
						petkindbtn=
						{
							type="BUTTON",
							bkimage="res/uires/petdlg/petkindbtn.gsa",
							rect={0,0,81,21},
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(1, 0);
								local count = GetPetRegInfoCount(1);
								Win_SetValue("UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist",  count, value_channel_item_num);
								end;
						};
						
						petsexbtn=
						{
							type="BUTTON",
							rect={81,0,60,21},
							bkimage="res/uires/petdlg/petsexbtn.gsa",
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(1, 2);
								local count = GetPetRegInfoCount(1);
								Win_SetValue("UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist",  count, value_channel_item_num);
								end;
						};
						
						petlevelbtn=
						{
							type="BUTTON",
							rect={141,0,60,21},
							bkimage="res/uires/petdlg/petlevelbtn.gsa",
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							OnClick=function()
								SortPetRegInfo(1, 3);
								local count = GetPetRegInfoCount(1);
								Win_SetValue("UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist",  count, value_channel_item_num);
								end;
						};
						
						fosterinfolist=
						{
							type="WIDGETLIST",
							rect={2,22,280,144},	
							style=wgtstyle_clipself+wgtstyle_renderitem+wgtstyle_vertical,		
							extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
							itemselback="res/uires/family/detailitemsel.gsa",
 							updatemute=1,
							primaryscroll="UI.gameui.petfosterinfodlg.myinfotab.rightscroll",
							itemmarginh=0,
							itemmarginv=0,
							template={"res/uires/petfosterinfo.lua"},
							
							children={},
						};
						
						rightscroll=
						{
					
							type="SCROLLBAR",
							rect={285,39,20,108},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.petfosterinfodlg.myinfotab.fosterinfolist",
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
			
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,																
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
			};
		};
		
		--登记宠物信息
		registerpetdlg = 
		{
			type = "DIALOG",
			rect = { 0, 0, 265, 199},			
			bkimage="res/uires/petdlg/registerpetinfobkg.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_alphawin,
			tabstop=2,
			visible=0,	
			updatemute=1,
			
			OnSelfShow = function()
				SetRegisterPetState(1);
				Win_ShowWidget("UI.gameui.petdlg", true);
				UI.children.gameui.children.petdlg.ShowSkillDlg(false);

				Win_AlignWidget("UI.gameui.petdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_right_out+alignstyle_top_in, 212, 0);
				Win_AlignWidget("UI.gameui.registerpetdlg","UI.gameui.petdlg",aligntype_winrect,alignstyle_bottom_in+alignstyle_left_out);
				LockPlayer(1);
				end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel = function()
				SetRegisterPetState(0);
				ClearRegPetPack();
				Win_ShowWidget("UI.gameui.petdlg", false);
				Win_ShowWidget("UI.gameui.petfosterinfodlg", true);
			end;
				
			children = 
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 235,20,23,22 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					OnClick=function()
						SetRegisterPetState(0);
						ClearRegPetPack();
						Win_ShowWidget("UI.gameui.petdlg", false);
						Win_ShowWidget("UI.gameui.petfosterinfodlg", true);
					end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 213,20,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("登记宠物信息");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};	
				
				--宠物列表
				pet1=
				{
					type="WIDGET",
					rect={55,62,32,32},
					groupid=1,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_registerpet,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				pet2=
				{
					type="WIDGET",
					rect={127,62,32,32},
					groupid=1,
					groupstop=6,
					dragindex=1,								
					dragtype=ui_drag_type_registerpet,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
								
				pet3=
				{
					type="WIDGET",
					rect={197,62,32,32},
					groupid=1,
					groupstop=1,
					dragindex=2,							
					dragtype=ui_drag_type_registerpet,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				pet4=
				{
					type="WIDGET",
					rect={93,117,32,32},
					groupid=1,
					groupstop=7,
					dragindex=3,							
					dragtype=ui_drag_type_registerpet,	
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				pet5=
				{
					type="WIDGET",
					rect={163,117,32,32},
					groupid=1,
					groupstop=4,
					dragindex=4,							
					dragtype=ui_drag_type_registerpet,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				registerbtn = 
				{
					type = "BUTTON",
					rect = {62,165,69,24},
					bkimage="res/uires/petdlg/registerpetbtn.gsa",
					
					OnClick = function()
						Win_ShowMsgBox("您确定要登记宠物吗？","系统消息",ui_msgid_yesno,"UI.gameui.registerpetdlg.registerbtn");
					end;
					
					OnMsgBoxOk = function()
						--state表示验证状态，0成功，1超过宠物登记的300上线，2超过一个玩家只能登记5只的上线
						local state = ConfirmPetsRegister();
						if state == 1 then
						Win_ShowMsgBox("登记的宠物超过300只了！","系统消息",ui_msgid_affirm,"UI.gameui.registerpetdlg.registerbtn");
						elseif state == 2 then
						Win_ShowMsgBox("您登记的宠物超过5只了！","系统消息",ui_msgid_affirm,"UI.gameui.registerpetdlg.registerbtn");
						elseif state == 3 then
						Win_ShowMsgBox("请在登记宠物信息对话框中至少放入一只宠物！","系统消息",ui_msgid_affirm,"UI.gameui.registerpetdlg.registerbtn");
						else
						RegPetFoster();
 						UI.children.gameui.children.registerpetdlg.children.cancelbtn.OnClick();
						end;
					end;
				};
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = { 160,165,69,24 },
					bkimage="res/uires/newcommon/cancelbtn2.gsa",
					defaultcancel=1,
					
					OnClick=function()
						SetRegisterPetState(0);
						ClearRegPetPack();
						Win_ShowWidget("UI.gameui.petdlg", false);
						Win_ShowWidget("UI.gameui.registerpetdlg", false);	
						Win_ShowWidget("UI.gameui.petfosterinfodlg", true);
					end;
				};
			};
		};

		--宠物培育
		petfosterdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 280, 314},
			bkimage="res/uires/petdlg/petfosterdlgbk.gsa",
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			tabstop=2,
			visible=0,	
			updatemute=1,
			
			OnSelfShow=function()
				local fostertype = Win_GetValue("UI.gameui.petfosterdlg",value_channel_customtype);
				if fostertype == 0 then
					Win_ShowWidget("UI.gameui.petfosterdlg.affirmbtn",false);
					Win_ShowWidget("UI.gameui.petfosterdlg.fosterbtn",false);
					Win_ShowWidget("UI.gameui.petfosterdlg.cancelbtn",false);
					Win_ShowWidget("UI.gameui.petfosterdlg.singlefosterbtn",true);
					Win_ShowWidget("UI.gameui.petfosterdlg.singlecancelbtn",true);
				else
					Win_ShowWidget("UI.gameui.petfosterdlg.singlefosterbtn",false);
					Win_ShowWidget("UI.gameui.petfosterdlg.singlecancelbtn",false);
					Win_ShowWidget("UI.gameui.petfosterdlg.affirmbtn",true);
					Win_ShowWidget("UI.gameui.petfosterdlg.fosterbtn",true);
					Win_ShowWidget("UI.gameui.petfosterdlg.cancelbtn",true);
				end;
				
				Win_AlignWidget("UI.gameui.petfosterdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_ShowWidget("UI.gameui.petdlg",true);
				UI.children.gameui.children.petdlg.ShowSkillDlg(false);
				Win_AlignWidget("UI.gameui.petdlg","UI.gameui.petfosterdlg",aligntype_winrect,alignstyle_top_in+alignstyle_right_out);
				
				LockPlayer(1);
				end;
				
			OnSelfHide=function()
				CancelPetFoster();
				LockPlayer(0);
				end;
			
			OnCancel=function()
				CancelPetFoster();
				Win_ShowWidget("UI.gameui.petfosterdlg",false);
				end;
			
			children=
			{
				otherpet=
				{
					type="WIDGET",
					rect={40,55,32,31},
					dragindex=0,
					dragtype=ui_drag_type_petfoster,
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_petfoster_other_head,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				mypet=
				{
					type="WIDGET",
					rect={160,55,32,31},
					dragindex=1,
					dragtype=ui_drag_type_petfoster,
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_petfoster_my_head,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				otherpetinfo=
				{
					type="LABEL",
					rect={81,62,59,20},
					textsize=12,
					visible=0,
					
					OnSelfShow=function()
						local info = GetFosterPetInfo(0);
						if info ~= nil then
							Win_SetText("UI.gameui.petfosterdlg.otherpetinfo.level","LV"..info.level);
							if (info.habit > 0) then
								Win_ShowWidget("UI.gameui.petfosterdlg.otherpetinfo.habit",true);
								Win_SetValue("UI.gameui.petfosterdlg.otherpetinfo.habit", info.habit-1,value_channel_framescheme);
							else
								Win_ShowWidget("UI.gameui.petfosterdlg.otherpetinfo.habit",false);
							end;
							
							Win_SetValue("UI.gameui.petfosterdlg.otherpetinfo.gender", info.gender,value_channel_framescheme);
						else
							Win_SetText("UI.gameui.petfosterdlg.otherpetinfo.level","");
							Win_SetValue("UI.gameui.petfosterdlg.otherpetinfo.habit", 0,value_channel_framescheme);
							Win_SetValue("UI.gameui.petfosterdlg.otherpetinfo.gender", 0,value_channel_framescheme);
						end;
						end;
					
					children=
					{
						--等级
						level = 
						{
							type = "LABEL",
							rect={6,4,25,12};
							drawcolor = { 255, 255, 255, 255 },
							textsize=12;
							textstyle=dt_center+dt_vcenter;
							enable=1;					
						},
						
						--食性
						habit = 
						{
							type = "LABEL",
							rect={36,2,16,16};
							bkimage="res/uires/petdlg/habit.gsa",										
							framescheme={{0},{1},{2},{3}},
							enable=1;
							
						},
						
						--性别
						gender = 
						{
							type = "LABEL",
							rect={52,2,16,16};
							bkimage="res/uires/petdlg/gender.gsa",
							framescheme={{0},{1},{2},},
							enable=1;					
						},
					};					
				};
				
				mypetinfo=
				{
					type="LABEL",
					rect={201,62,58,20},
					textsize=12,
					visible=0,
					
					OnSelfShow=function()
						local info = GetFosterPetInfo(1);
						if info ~= nil then
							Win_SetText("UI.gameui.petfosterdlg.mypetinfo.level","LV"..info.level);
							Win_SetValue("UI.gameui.petfosterdlg.mypetinfo.habit", info.habit-1,value_channel_framescheme);
							Win_SetValue("UI.gameui.petfosterdlg.mypetinfo.gender", info.gender,value_channel_framescheme);
						else
							Win_SetText("UI.gameui.petfosterdlg.mypetinfo.level","");
							Win_SetValue("UI.gameui.petfosterdlg.mypetinfo.habit", 0,value_channel_framescheme);
							Win_SetValue("UI.gameui.petfosterdlg.mypetinfo.gender", 0,value_channel_framescheme);
						end;
						end;
					
					children=
					{
						--等级
						level = 
						{
							type = "LABEL",
							rect={6,4,25,12};
							drawcolor = { 255, 255, 255, 255 },
							textsize=12;
							textstyle=dt_center+dt_vcenter;
							enable=1;
						},
						
						--食性
						habit = 
						{
							type = "LABEL",
							rect={36,2,16,16};
							bkimage="res/uires/petdlg/habit.gsa",										
							framescheme={{0},{1},{2},{3}},
							enable=1;
							
						},
						
						--性别
						gender = 
						{
							type = "LABEL",
							rect={52,2,16,16};
							bkimage="res/uires/petdlg/gender.gsa",
							framescheme={{0},{1},{2},},
							enable=1;					
						},
					};		
				};
				
				otherpetpic= 
				{
					type="WIDGET",
					rect={47,96,85,99},
					edgecolor={0,0,0,0},											
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_petfoster_other,
					dragtype=ui_drag_type_petfoster,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				mypetpic= 
				{
					type="WIDGET",
					rect={173,96,86,99},
					edgecolor={0,0,0,0},											
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_petfoster_my,
					dragtype=ui_drag_type_petfoster,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				fosteritem=
				{
					type="WIDGET",
					rect={58,221,32,31},
					dragtype=ui_drag_type_petfosteritem,
					dragindex=0,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				timelabel=
				{
					type="LABEL",
					rect={157,215,67,14},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					tiptext="这里显示培育出来的二代宠物需要的培育时间",
				};
				
				goldlabel=
				{
					type="LABEL",
					rect={108,244,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12;
					textstyle=dt_center+dt_vcenter,
					tiptext="本次培育需要消费的金币数量",
				};
				
				silverlabel=
				{
					type="LABEL",
					rect={156,244,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12;
					textstyle=dt_center+dt_vcenter,
					enable=0;
				};
				
				copperlabel=
				{
					type="LABEL",
					rect={204,244,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12;
					textstyle=dt_center+dt_vcenter,
					enable=0;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={29,281,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					soundid={1005},			
					tiptext="点击后锁定参与培育的宠物",
					visible=0,
					
					OnClick=function()
						AffirmPetFoster();
						end;
				},
				
				fosterbtn=
				{
					
					type="BUTTON",
					rect={115,281,69,24},
					bkimage="res/uires/petdlg/fosterbtn.gsa",	
					soundid={1005},
					tiptext="点击后开始培育",
					visible=0,
					
					OnMsgBoxOk=function()
						PetFoster(1);
						Win_EnableWidget("UI.gameui.petfosterdlg.fosterbtn",false);
						end;
					
					OnClick=function()
						if (CanPetFoster(1) ~= 0) then
							Win_ShowMsgBox("本次培育之后要经过一段时间才能再次进行培育,你确认开始培育二代宠物吗?","系统消息",ui_msgid_yesno,"UI.gameui.petfosterdlg.fosterbtn");
						else
							Win_ShowMsgBox("参与培育的宠物不符合培育条件,请重新选择!");
						end;
						
						end;
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={200,281,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
					visible=0,
				},
				
				singlefosterbtn=
				{
					type="BUTTON",
					rect={50,281,69,24},
					bkimage="res/uires/petdlg/fosterbtn.gsa",	
					soundid={1005},
					tiptext="点击后开始培育",
					visible=0,
					
					OnMsgBoxOk=function()
						PetFoster(0);
						--Win_EnableWidget("UI.gameui.petfosterdlg.singlefosterbtn",false);
						end;
					
					OnClick=function()
						if (CanPetFoster(0) ~= 0) then
							Win_ShowMsgBox("本次培育之后要经过一段时间才能再次进行培育,你确认开始培育二代宠物吗?","系统消息",ui_msgid_yesno,"UI.gameui.petfosterdlg.singlefosterbtn");
						else
							Win_ShowMsgBox("参与培育的宠物不符合培育条件,请重新选择!");
						end;
						
						end;
				};
				
				singlecancelbtn=
				{
					type="BUTTON",
					rect={180,281,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
					visible=0,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={252,20,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helplink=
				{
					type = "BUTTON",
					rect = { 230,20,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("宠物培育");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};			
			};
		};
		
		
		--师徒
		masterlistdlg=
		{
				
			type="DIALOG",
			rect={0,0,439,449},
			captionrect={56,22,308,12},
			caption="师父登记列表",
			textsize=12,
			textfont=1,
			bkimage="res/uires/master/masterlistdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
						
			OnSelfShow=function()
				num=GetRegMItemCount();
				Win_SetValue("UI.gameui.masterlistdlg.masterlist",num,value_channel_item_num);
				SetGlobalQuery(GlobalQuery_RegMPList,1);
				end;			
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_RegMPList,0);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.masterlistdlg",false);
			       end;
			
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={413,18,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 392,18,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("师徒");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};			
							
				
				cancelbtn=
				{
					type="BUTTON",
					rect={353,420,70,22},
					bkimage="res/uires/common/closebtn.gsa",					
					defaultcancel=1,    
					updatemute=1,
				};
				
				
				showallbtn=
				{
					type="BUTTON",
					rect={20,420,90,22},
					bkimage="res/uires/master/showallbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						SearchRegMList(-1,"");
						end;
				};
				
				makemasterbtn=
				{
					type="BUTTON",
					rect={280,420,70,22},
					bkimage="res/uires/master/makemaster.gsa",
					updatemute=1,
					
					OnClick=function()
						cursel=Win_GetValue("UI.gameui.masterlistdlg.masterlist",value_channel_sel);
						local info=GetRegMItem(cursel);						
						if info~=nil then
						--MasterRequest(info.name);
						if info.name~="" then
							Win_SetText("UI.gameui.inputcontentdlg", info.name, value_channel_customname);
							Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "4");
							Win_SetText("UI.gameui.inputcontentdlg.title", "申请拜师");
							Win_ShowWidget("UI.gameui.inputcontentdlg", true);
						end;
						
						Win_ShowWidget("UI.gameui.masterlistdlg",false);
						end;
						end;
				};
				
				namebtn=
				{
					type="BUTTON",
					rect={18,48,70,12},
					caption="名字",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.namebtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.namebtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.namebtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
					
					OnClick=function()
						SortRegMList(0);
						end;
				};
				
				titlebtn=
				{
					type="BUTTON",
					rect={92,48,110,12},
					caption="称号",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.titlebtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.titlebtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.titlebtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
						
					OnClick=function()
						SortRegMList(1);
						end;
				};
				
				profbtn=
				{
					type="BUTTON",
					rect={203,48,45,12},
					caption="职业",
					textsize=12,					
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.profbtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.profbtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.profbtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
					OnClick=function()
						SortRegMList(2);
						end;
				};
				
				levelbtn=
				{
					type="BUTTON",
					rect={248,48,42,12},
					caption="等级",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.levelbtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.levelbtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.levelbtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
						
					OnClick=function()
						SortRegMList(3);
						end;
				};
				
				membtn=
				{
					type="BUTTON",
					rect={290,48,44,12},
					caption="徒弟",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.membtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.membtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.membtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
						
					OnClick=function()
						SortRegMList(4);
						end;
				};
				
				timebtn=
				{
					type="BUTTON",
					rect={336,48,68,12},
					caption="登记时间",
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,255,0},
					drawflag=drawflag_win_fill,
					mornitor={value_channel_clickdown},
					
					OnUpdate=function()						
						clickdnflag=Win_GetValue("UI.gameui.masterlistdlg.timebtn",value_channel_clickdown);
						if clickdnflag==1 then
						Win_SetValue("UI.gameui.masterlistdlg.timebtn",GetColorIndex(0,0,255,255),value_channel_color_back);
						else
						Win_SetValue("UI.gameui.masterlistdlg.timebtn",GetColorIndex(0,0,255,0),value_channel_color_back);
						end;
						end;
						
					OnClick=function()
						SortRegMList(5);
						end;
				};			
				
				
				findbtn=
				{
					type="BUTTON",
					rect={218,394,58,22},
					bkimage="res/uires/common/findbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						kwdtxt=Win_GetText("UI.gameui.masterlistdlg.keywordedit");
						if kwdtxt~="" then
						modetxt=Win_GetText("UI.gameui.masterlistdlg.modeedit");
						if modetxt=="师父称号" then
						SearchRegMList(1,kwdtxt);
						elseif modetxt=="师父职业" then
						SearchRegMList(2,kwdtxt);
						elseif modetxt=="师父等级" then
						SearchRegMList(3,kwdtxt);
						elseif modetxt=="徒弟人数" then
						SearchRegMList(4,kwdtxt);
						end;						
						end;
						end;
				};
				
				modebtn = 
				{
					type = "CHECK",
					rect = { 72,397,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					updatemute=1,
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.masterlistdlg.modebtn")  then
						Win_ShowWidget("UI.gameui.findmodedlg",true);
						else 
						Win_ShowWidget("UI.gameui.findmodedlg",false);
						end;						     
						end;					
				};
				
				pageprevbtn=
				{
					type="BUTTON",
					rect={288,394,44,22},
					bkimage="res/uires/master/pageprev.gsa",
					updatemute=1,
					
					OnClick=function()
						page=Win_GetValue("UI.gameui.masterlistdlg.masterlist",value_channel_page_v);
						Win_SetValue("UI.gameui.masterlistdlg.masterlist",page-1,value_channel_page_v);
						end;
					
				};
				
				pagenextbtn=
				{
					type="BUTTON",
					rect={388,394,44,22},
					bkimage="res/uires/master/pagenext.gsa",		
					updatemute=1,
					
					OnClick=function()
						page=Win_GetValue("UI.gameui.masterlistdlg.masterlist",value_channel_page_v);
						Win_SetValue("UI.gameui.masterlistdlg.masterlist",page+1,value_channel_page_v);
						end;
				};
				
				pageedit=
				{
					type="LABEL",	
					rect = { 340,398,42,12 },
					caption="0",
					textsize=12,
					textstyle=dt_center,
					drawcolor={255,255,255,255},
					enable=0,		
					updatemute=1,
				};
				
				modeedit=
				{
					type="LABEL",	
					rect = { 18,398,54,12 },
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
					caption="师父职业",
					enable=0,		
					updatemute=1,
				};
				
				keywordedit=
				{
					type="EDIT",	
					rect = { 98,398,114,12 },
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},	
					updatemute=1,
				};
				
				masterlist=
				{
					type="LISTBOX",
					rect={16,64,390,324},									
					itemnum=0,
					dragtype=ui_drag_type_masterreg,
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,	
					mousedelta=24,
					itemwidth=348,
					itemheight=21,
					itemmarginh=0,
					itemmarginv=0,					
					tipwidget="UI.gameui.ScrnTooltip",
                    
					mornitor={value_channel_page_v},
					
					OnUpdate=function()
						page=Win_GetValue("UI.gameui.masterlistdlg.masterlist",value_channel_page_v);
						Win_SetText("UI.gameui.masterlistdlg.pageedit",page);
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={398,-3,15,308},			
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
								
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
												
				},--list
				
			};
			
		};		
		
		
		
		masterinfodlg=
		{
				
			type="DIALOG",
			rect={0,0,262,282},
			captionrect={54,14,144,12},
			caption="个人介绍",
			textsize=12,
			textfont=1,
			bkimage="res/uires/master/masterinfodlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()	
				Win_SetText("UI.gameui.masterinfodlg.contentedit","");
				Win_SetFocus("UI.gameui.masterinfodlg.contentedit");
				end;
					   
					   
			OnOk=function()	
				infotxt=Win_GetText("UI.gameui.masterinfodlg.contentedit");				
				RegMIntroduce(infotxt);
				Win_ShowWidget("UI.gameui.masterinfodlg",false);
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.masterinfodlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.masterinfodlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.masterinfodlg",false);				     
			     end;
			
			children=
			{	
				closebtn=
				{
					type="BUTTON",
					rect={237,9,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 217,9,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("师徒");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={18,256,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={180,256,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={28,58,217,182},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=126,	
					
				};
			
			};
			
		};
			
		--家族
		familylistdlg=
		{
				
			type="DIALOG",
			rect={0,0,671,409},
			bkimage="res/uires/family/familylistdlg.gsa",
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.familylistdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetFocus("UI.gameui.familylistdlg.findedit");
				Win_SetValue("UI.gameui.familylistdlg.familylist",0,value_channel_sel);
				UI.children.gameui.children.familylistdlg.children.familylist.OnValueChange(0);
				SetGlobalQuery(GlobalQuery_FamilyList,1);
				end;
			
			OnSelfHide=function()
				CloseFmListPanel();
				SetGlobalQuery(GlobalQuery_FamilyList,0);
				end;
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
			       Win_ShowWidget("UI.gameui.familylistdlg",false);
			       end;
				
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={640,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					updatemute=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 617,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("家族列表界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				--关系
				relationbtn=
				{
					type="BUTTON",
					rect={33,45,32,21},
					bkimage="res/uires/family/relationbtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(0);
						end;
				};
				
				--名字
				namebtn=
				{
					type="BUTTON",
					rect={65,45,85,21},
					bkimage="res/uires/family/namebtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(1);
						end;
				};
				
				--等级
				levelbtn=
				{
					type="BUTTON",
					rect={150,45,39,21},
					bkimage="res/uires/family/levelbtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(2);
						end;
				};
				
				--人数
				popularbtn=
				{
					type="BUTTON",
					rect={189,45,39,21},
					bkimage="res/uires/family/popularbtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(3);
						end;
				};
				
				--威望
				newprestigebtn=
				{
					type="BUTTON",
					rect={270,45,59,21},
					bkimage="res/uires/family/newprestigebtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(8);
						end;
				};
				
				--声望
				prestigebtn=
				{
					type="BUTTON",
					rect={228,45,42,21},
					bkimage="res/uires/family/prestigebtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(4);
						end;
				};
				
				--财产
				fortunebtn=
				{
					type="BUTTON",
					rect={329,45,130,21},
					bkimage="res/uires/family/fortunebtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(5);
						end;
				};
				
				--家族资材
				assetsbtn=
				{
					type="BUTTON",
					rect={459,45,98,21},
					bkimage="res/uires/family/familyassets.gsa",
					
					OnClick=function()
						SetFamilySortType(7);
						end;
				};
				--创建时间
				timebtn=
				{
					type="BUTTON",
					rect={557,45,99,21},
					bkimage="res/uires/family/timebtn2.gsa",
					
					OnClick=function()
						SetFamilySortType(6);
						end;
				};
				
				findedit=
				{
					type="EDIT",
					rect={196,349,235,12},	
					textsize=12,
					textstyle=dt_left+dt_bottom,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					visible=1;
					updatemute=1,
				};
			
				findbtn=
				{
					type="BUTTON",
					rect={573,343,69,24},
					bkimage="res/uires/family/findbtn.gsa",	
					style=wgtstyle_alphawin,
					visible=1;			
					updatemute=1,
					
					OnClick=function()
						local txt=Win_GetText("UI.gameui.familylistdlg.findedit");
						    
						if txt~="" then
						local pos=FamilyFindByName(txt);
						local num=GetNumFamily();
						if pos>=0 and pos<num then
						Win_SetValue("UI.gameui.familylistdlg.familylist",num,value_channel_item_num);
						Win_SetValue("UI.gameui.familylistdlg.familylist",0,value_channel_sel);
						UI.children.gameui.children.familylistdlg.children.familylist.OnValueChange(0);
						else
						Win_ShowMsgBox("对不起，没有搜索到该名称的家族.","系统消息",ui_msgid_default);
						end;
						end;
						end;
				};
				
				joinbtn=
				{
					type="BUTTON",
					rect={43,373,86,24},
					bkimage="res/uires/family/joinbtn.gsa",
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
							Win_SetText("UI.gameui.inputcontentdlg", name, value_channel_customname);
							Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "3");
							Win_SetText("UI.gameui.inputcontentdlg.title", "申请加入家族");
							Win_ShowWidget("UI.gameui.inputcontentdlg", true);
						end;
					end;
					
					OnMsgBoxOk=function()
						name=Win_GetText("UI.gameui.familylistdlg.joinbtn",value_channel_customname);
						if name~="" then
						ApplyJoinFamily(name, "", "");
						end;
						end;
				};
				
				proclaimbtn=
				{
					type="BUTTON",
					rect={215,373,98,24},
					bkimage="res/uires/family/seeproclaimbtn.gsa",	
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
							Win_SetText("UI.gameui.familyproclaimdlg.proclaimedit","");
							Win_SetText("UI.gameui.familyproclaimdlg",name,value_channel_customstring);
							Win_ShowWidget("UI.gameui.familyproclaimdlg",true);
							Win_SetFocus("UI.gameui.familyproclaimdlg");
							SendQueryFamilyLogo(name); --获取宣言
						end;
					end;
				};				
				
				allybtn=
				{
					type="BUTTON",
					rect={374,373,86,24},
					bkimage="res/uires/family/allybtn.gsa",	
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
						Win_SetText("UI.gameui.familylistdlg.allybtn",name,value_channel_customname);
						Win_ShowMsgBox("您确定要和家族: "..name.."结盟吗?","系统消息",ui_msgid_yesno,"UI.gameui.familylistdlg.allybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						name=Win_GetText("UI.gameui.familylistdlg.allybtn",value_channel_customname);
						if name~="" then
						ChangeFamilyFlag(name,0);
						end;
						end;						    
				};
				
				cancelallybtn=
				{
					type="BUTTON",
					rect={374,373,86,24},
					bkimage="res/uires/family/cancelally.gsa",					
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
						Win_SetText("UI.gameui.familylistdlg.cancelallybtn",name,value_channel_customname);
						Win_ShowMsgBox("您确定要和家族: "..name.."取消盟友关系吗?","系统消息",ui_msgid_yesno,"UI.gameui.familylistdlg.cancelallybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						name=Win_GetText("UI.gameui.familylistdlg.cancelallybtn",value_channel_customname);
						if name~="" then
						ChangeFamilyFlag(name,2);
						end;
						end;						    
											    
				};
				
				enemybtn=
				{
					type="BUTTON",
					rect={565,373,86,24},
					bkimage="res/uires/family/enemybtn.gsa",	
					updatemute=1,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
						Win_SetText("UI.gameui.familylistdlg.enemybtn",name,value_channel_customname);
						Win_ShowMsgBox("您确定要和家族: "..name.."敌对吗?","系统消息",ui_msgid_yesno,"UI.gameui.familylistdlg.enemybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						name=Win_GetText("UI.gameui.familylistdlg.enemybtn",value_channel_customname);
						if name~="" then
						ChangeFamilyFlag(name,1);
						end;
						end;						    						    
				};
				
				cancelenemybtn=
				{
					type="BUTTON",
					rect={565,373,86,24},
					bkimage="res/uires/family/cancelenemy.gsa",	
					updatemute=1,					
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.familylistdlg.familylist",value_channel_sel);
						local name=GetFamilyListItemName(sel);
						if name~="" then
						Win_SetText("UI.gameui.familylistdlg.cancelenemybtn",name,value_channel_customname);
						Win_ShowMsgBox("您确定要和家族: "..name.."取消敌对关系吗?","系统消息",ui_msgid_yesno,"UI.gameui.familylistdlg.cancelenemybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						name=Win_GetText("UI.gameui.familylistdlg.cancelenemybtn",value_channel_customname);
						if name~="" then
						ChangeFamilyFlag(name,2);
						end;
						end;						    						    
				};
							
				familylist=
				{
					type="LISTBOX",
					rect={35,67,607,270},
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_familylist,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={20, 2, 460, 228},
					itemwidth=440,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					textsize=12,				
					updatemute=1,
					
					primaryscroll="UI.gameui.familylistdlg.familyscroll",
					
					OnValueChange=function(sel)
						if sel >= 0 then
							local info=GetFamilyInfo(sel);
							if info.status==0 then
							Win_ShowWidget("UI.gameui.familylistdlg.allybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.enemybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelallybtn",true);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelenemybtn",false);
							elseif info.status==1 then
							Win_ShowWidget("UI.gameui.familylistdlg.allybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.enemybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelallybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelenemybtn",true);
							else
							Win_ShowWidget("UI.gameui.familylistdlg.allybtn",true);
							Win_ShowWidget("UI.gameui.familylistdlg.enemybtn",true);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelallybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelenemybtn",false);
							end;
						else
							Win_ShowWidget("UI.gameui.familylistdlg.allybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.enemybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelallybtn",false);
							Win_ShowWidget("UI.gameui.familylistdlg.cancelenemybtn",false);
						end;
						end;
				},--list
				
				familyscroll=
				{
			
					type="SCROLLBAR",
					rect={635,85,20,233},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size,--+scrollbar_auto_hide,
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					minbtnsize=16,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.familylistdlg.familylist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
			};
			
		};		
		
		--家族查询窗口
		familyquerydlg=
		{
			type="DIALOG",
			rect={0,0,300,204},
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			bkimage="res/uires/family/familyquerydlg.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter + alignstyle_vcenter,	
			visible=0,	
			moveable=1,
			updatemute=1,			
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.familyquerydlg");
				
				-- show窗口的时候所有内容清空， show后查询
				Win_EnableWidget("UI.gameui.familyquerydlg.joinbtn",false);
				Win_EnableWidget("UI.gameui.familyquerydlg.proclaimbtn",false);
				
				Win_ShowWidget("UI.gameui.familyquerydlg.allybtn",false);
				Win_ShowWidget("UI.gameui.familyquerydlg.enemybtn",false);
				Win_ShowWidget("UI.gameui.familyquerydlg.cancelallybtn",false);
				Win_ShowWidget("UI.gameui.familyquerydlg.cancelenemybtn",false);
		
				Win_SetText("UI.gameui.familyquerydlg.namelabel","");
				Win_SetText("UI.gameui.familyquerydlg.popularlabel","");
				Win_SetText("UI.gameui.familyquerydlg.levellabel","");
				Win_SetText("UI.gameui.familyquerydlg.prestigelabel","");
				Win_SetText("UI.gameui.familyquerydlg.gradelabel","");
				
				Win_ShowWidget("UI.gameui.familyquerydlg.realationlabel",false);
				
				Win_SetText("UI.gameui.familyquerydlg.goldlabel","");
				Win_SetText("UI.gameui.familyquerydlg.silverlabel","");
				Win_SetText("UI.gameui.familyquerydlg.copperlabel","");
				Win_SetText("UI.gameui.familyquerydlg.createtmabel","");
				
				Win_SetText("UI.gameui.familyquerydlg","",value_channel_customstring);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.familyquerydlg",false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={271,7,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					updatemute=1,
				},	
				
				--家族名称
				namelabel=
				{
					type="LABEL",
					rect={72,41,116,12},
					textsize=12,
					textstyle=dt_left,
					enable=0,					
				};
				
				--人数
				popularlabel=
				{
					type="LABEL",
					rect={230,41,59,12},
					textsize=12,
					enable=0,					
				};
				
				--等级
				levellabel=
				{
					type="LABEL",
					rect={50,66,34,12},
					textsize=12,
					enable=1,					
				};
				
				--声望
				prestigelabel=
				{
					type="LABEL",
					rect={124,66,64,12},
					textsize=12,
					enable=0,					
				};
				
				--排名
				gradelabel=
				{
					type="LABEL",
					rect={230,66,59,12},
					textsize=12,
					enable=0,					
				};
				
				--关系
				realationlabel=
				{
					type="LABEL",
					rect={249,85,17,16},
					bkimage="res/uires/family/relation.gsa",
					framescheme={{0},{1},{2},},
					enable=0,					
				};
				
				--金
				goldlabel=
				{
					type="LABEL",
					rect={48,89,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				--银
				silverlabel=
				{
					type="LABEL",
					rect={95,89,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				--铜
				copperlabel=
				{
					type="LABEL",
					rect={142,89,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				--创建时间
				createtmabel=
				{
					type="LABEL",
					rect={72,115,108,12},
					textsize=12,
					enable=0,					
				};
				
				--威望
				newprestigelabel=
				{
					type="LABEL",
					rect={230,115,64,12},
					textsize=12,
					enable=0,					
				};				
				
				proclaimbtn=
				{
					type="BUTTON",
					rect={163,143,98,24},
					bkimage="res/uires/family/seeproclaimbtn.gsa",	
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						-- 这里双层保护， 一个使用familyquery出来的logo初始化，然后send， 如果当前已经有了所有的家族列表，就会去发消息查询最新的
						-- 当玩家没有打开过家族列表的时候，SendQueryFamilyLogo是无效的
						local text=Win_GetText("UI.gameui.familyquerydlg",value_channel_customstring);
						local fm = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						Win_SetText("UI.gameui.familyproclaimdlg",fm,value_channel_customstring);
						
						Win_SetText("UI.gameui.familyproclaimdlg.proclaimedit", text);
						Win_ShowWidget("UI.gameui.familyproclaimdlg",true);
						Win_SetFocus("UI.gameui.familyproclaimdlg");
						SendQueryFamilyLogo(fm); --获取宣言
					end;
				};
				
				joinbtn=
				{
					type="BUTTON",
					rect={29,142,86,24},
					bkimage="res/uires/family/joinbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
							Win_SetText("UI.gameui.inputcontentdlg", name, value_channel_customname);
							Win_SetText("UI.gameui.inputcontentdlg.dlgtype", "3");
							Win_SetText("UI.gameui.inputcontentdlg.title", "申请加入家族");
							Win_ShowWidget("UI.gameui.inputcontentdlg", true);
						end;
					end;
					
					OnMsgBoxOk=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
						ApplyJoinFamily(name, "", "");
						end;
						end;
				};

				allybtn=
				{
					type="BUTTON",
					rect={30,171,86,24},
					bkimage="res/uires/family/allybtn.gsa",	
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
							Win_ShowMsgBox("您确定要和家族: "..name.."结盟吗?","系统消息",ui_msgid_yesno,"UI.gameui.familyquerydlg.allybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						local playername = Win_GetText("UI.gameui.familyquerydlg.namelabel", value_channel_customstring);
						if playername~="" then
							ModifyFamilyFlag(playername,0);
						end;
						end;						    
				};
				
				cancelallybtn=
				{
					type="BUTTON",
					rect={30,171,86,24},
					bkimage="res/uires/family/cancelally.gsa",					
					updatemute=1,
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
							Win_ShowMsgBox("您确定要和家族: "..name.."取消盟友关系吗?","系统消息",ui_msgid_yesno,"UI.gameui.familyquerydlg.cancelallybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						local playername = Win_GetText("UI.gameui.familyquerydlg.namelabel", value_channel_customstring);
						if playername~="" then
							ModifyFamilyFlag(playername,2);
						end;
						end;						    
											    
				};
				
				enemybtn=
				{
					type="BUTTON",
					rect={170,172,86,24},
					bkimage="res/uires/family/enemybtn.gsa",	
					updatemute=1,
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
						Win_SetText("UI.gameui.familyquerydlg.enemybtn",name,value_channel_customname);
							Win_ShowMsgBox("您确定要和家族: "..name.."敌对吗?","系统消息",ui_msgid_yesno,"UI.gameui.familyquerydlg.enemybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						local playername = Win_GetText("UI.gameui.familyquerydlg.namelabel", value_channel_customstring);
						if playername~="" then
							ModifyFamilyFlag(playername,1);
						end;
						end;						    						    
				};
				
				cancelenemybtn=
				{
					type="BUTTON",
					rect={170,172,86,24},
					bkimage="res/uires/family/cancelenemy.gsa",	
					updatemute=1,					
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.familyquerydlg.namelabel");
						if name~="" then
							Win_ShowMsgBox("您确定要和家族: "..name.."取消敌对关系吗?","系统消息",ui_msgid_yesno,"UI.gameui.familyquerydlg.cancelenemybtn");
						end;
						end;
					
					OnMsgBoxOk=function()
						local playername = Win_GetText("UI.gameui.familyquerydlg.namelabel", value_channel_customstring);
						if playername~="" then
							ModifyFamilyFlag(playername,2);
						end;
						end;						    						    
				};
			};
		};
		
		--家族贡献排名
		familyWCContriRankdlg=
		{
			type="DIALOG",
			rect={0,0,311,381},
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			bkimage="res/uires/family/familyWCContriRankdlg.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter + alignstyle_vcenter,	
			visible=0,	
			moveable=1,
			updatemute=1,
			bkimagepos={-10,-7},
			
			OnSelfShow=function()
				local count, selfRank, selfScore = GetWCContriRankInfo();
				Win_SetFocus("UI.gameui.familyWCContriRankdlg");
			 	Win_SetValue("UI.gameui.familyWCContriRankdlg.familylist",count,value_channel_item_num);
				if selfRank == 0 then
					Win_SetText("UI.gameui.familyWCContriRankdlg.Ranklabel", "没有排名");
				else
					Win_SetText("UI.gameui.familyWCContriRankdlg.Ranklabel", selfRank);
				end;
				Win_SetText("UI.gameui.familyWCContriRankdlg.Scorelabel", selfScore);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.familyWCContriRankdlg",false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={289,25,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					updatemute=1,
				},
				
				Ranklabel=
				{
					type="LABEL",
					rect={131,62,60,20};
					textsize=12;
				};
				
				Scorelabel=
				{
					type="LABEL",
					rect={194,62,45,20};
					textsize=12;
				};
				
				familylist=
				{
					type="LISTBOX",
					rect={48,109,240,270},
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_familywccontriranklist,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 236, 228},
					itemwidth=236,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					textsize=12,				
					updatemute=1,
					
					primaryscroll="UI.gameui.familyWCContriRankdlg.familyscroll",
				},--list
				
				familyscroll=
				{
			
					type="SCROLLBAR",
					rect={286,125,20,233},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size,--+scrollbar_auto_hide,
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					minbtnsize=16,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.familyWCContriRankdlg.familylist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		
		--家族宣言察看窗口
		familyproclaimdlg=
		{
			type="DIALOG",
			rect={0,0,305,195},
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter + alignstyle_vcenter,	
			bkimage="res/uires/family/familyproclaimdlg.gsa",
			visible=0,	
			updatemute=1,			
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.familyproclaimdlg",false);
			end;
		
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={271,7,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					updatemute=1,
				},	
				
				exitbtn=
				{
					type="BUTTON",
					rect={116,163,69,24},
					bkimage="res/uires/family/closebtn.gsa",
					updatemute=1,
					defaultcancel=1,
				};
				
				proclaimedit=
				{
					type="MULTIEDIT",
					rect={8,33,282,128},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=500,
					editable=0,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={262,19,20,90},
							style=wgtstyle_vertical,
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
						
							extendstyle=scrollbar_blockbtn_auto_size + scrollbar_auto_hide,							
							minbtnsize=16,
							pagesize=1,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,	
																
							OnSelfShow=function()
								local panelrect = Win_GetRect("UI.gameui.familyproclaimdlg.proclaimedit", value_channel_captionrect);
								if (panelrect.w == 282) then
									Win_SetRect("UI.gameui.familyproclaimdlg.proclaimedit", 0, 0, 282-20, 128, value_channel_captionrect);
									Win_SetValue("UI.gameui.familyproclaimdlg.proclaimedit",1,value_channel_update_dirty);
								end;
							end;
							OnSelfHide=function()
								local panelrect = Win_GetRect("UI.gameui.familyproclaimdlg.proclaimedit", value_channel_captionrect);
								if (panelrect.w < 282) then
									Win_SetRect("UI.gameui.familyproclaimdlg.proclaimedit", 0, 0, 282, 128, value_channel_captionrect);
									Win_SetValue("UI.gameui.familyproclaimdlg.proclaimedit",1,value_channel_update_dirty);
								end;
							end;

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,		
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								
								};--spindown
							};--children
						};--scroll
					};
				};				
			},
		};			
		
		--caption="创建家族",
		familycreatedlg=
		{
			type="DIALOG",
			rect={0,0,279,424},
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			bkimage="res/uires/family/familycreatedlg.gsa",
			visible=0,	
			updatemute=1,			
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.familycreatedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetText("UI.gameui.familycreatedlg.nameedit","");		
				Win_SetFocus("UI.gameui.familycreatedlg.nameedit");
				end;
			
			OnOk=function()	
				name=Win_GetText("UI.gameui.familycreatedlg.nameedit");
				proclaim=Win_GetText("UI.gameui.familycreatedlg.proclaimedit");
				
				if name=="" then
				Win_ShowMsgBox("请您输入家族名称!");
				else
				FamilyCreate(name,proclaim,0,""); 
				Win_ShowWidget("UI.gameui.familycreatedlg",false);
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.familycreatedlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.familycreatedlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.familycreatedlg",false);				     
			     end;
			     
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={250,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 228,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("建立家族界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				nameedit=
				{
					type="EDIT",
					rect={44,76,214,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,										
				},

				
				proclaimedit=
				{
					type="MULTIEDIT",
					rect={42,187,196,188},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=500,						

					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={195,17,20,152},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							updatemute=1,

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};

					
				};
				
				totemlabel=
				{
					type="LABEL",
					rect={45,121,36,36},
					enable=0,					
				},
				
				totembtn=
				{
					type="CHECK",
					rect={89,138,42,22},
					framescheme={{0, 1, 2, 3},{0, 0, 0, 3}};
					bkimage="res/uires/family/listbtn.gsa",
					enable=0,
				},				
				
				affirmbtn=
				{
					type="BUTTON",
					rect={47,389,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={185,389,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			},
			
		};
		
		--caption="家族关系",
		familyrelationdlg=
		{
				
			type="DIALOG",
			rect={0,0,343,450},
			bkimage="res/uires/family/familyrelationdlg.gsa",
			moveable=1,	
			style=wgtstyle_topmost,
			visible=0,
			updatemute=1,
						
			OnSelfHide=function()
				CloseFmRelationPanel();
				end;
			
			OnSelfShow=function()
				UI.children.gameui.children.familyrelationdlg.UpdateFamilyRelation();
				Win_AlignWidget("UI.gameui.familyrelationdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetFocus("UI.gameui.familyrelationdlg");
				end;
				
			UpdateFamilyRelation=function()
				OpenFmRelationPanel();				
				local info=GetFamilyDetialInfo(-1);
				if info~=nil then
				--allylist
				oldsel=Win_GetSelect("UI.gameui.familyrelationdlg.allylist",0);
				
				if oldsel>=num then
				oldsel=info.allycount-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.familyrelationdlg.allylist",info.allycount,value_channel_item_num);
				Win_SetSelect("UI.gameui.familyrelationdlg.allylist",0,oldsel);
				
				--enemylist
				oldsel=Win_GetSelect("UI.gameui.familyrelationdlg.enemylist",0);
				
				if oldsel>=num then
				oldsel=info.hoscount-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.familyrelationdlg.enemylist",info.hoscount,value_channel_item_num);
				Win_SetSelect("UI.gameui.familyrelationdlg.enemylist",0,oldsel);
				
				end;
				end;
			
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={315,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 293,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族关系界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				allylist=
				{
					type="WIDGETLIST",
					rect={35,84,275,152},			
					style=wgtstyle_clipchild_window+wgtstyle_vertical,
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,					
					itemmarginh=0,
					itemmarginv=0,

					primaryscroll="UI.gameui.familyrelationdlg.allyscroll",
					template={"res/uires/allyitem.lua"};
					
					children={},
					
				},--list
				
				allyscroll=
				{
			
					type="SCROLLBAR",
					rect={310,101,20,116},		
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.familyrelationdlg.allylist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				enemylist=
				{
					type="WIDGETLIST",
					rect={35,285,275,152},			
					style=wgtstyle_clipchild_window+wgtstyle_vertical,
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,					
					itemmarginh=0,
					itemmarginv=0,

					primaryscroll="UI.gameui.familyrelationdlg.enemyscroll",
					template={"res/uires/enemyitem.lua"};
					
					children={},
					
				},--list
				
				enemyscroll=
				{
			
					type="SCROLLBAR",
					rect={310,301,20,117},		
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.familyrelationdlg.enemylist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
								
			};
			
		};		
		
		
		familydetaildlg=
		{
				
			type="DIALOG",
			rect={186,94,405,551},
			captionrect={56,13,278,12},
			--caption="家族管理",
			--textsize=12,
			--textfont=1,
			bkimage="res/uires/family/familydetaildlg.gsa",
			bkimagepos={-1,-1},
			moveable=1,	
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			visible=0,	
			updatemute=1,			
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.familydetaildlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.familydetaildlg",false);
				end;
				
			OnEscape=function()
				Win_EndWidget("UI.gameui.familydetaildlg",false);
				end;
			
			OnSelfShow=function()
				BeginStudy();
				UpdateUltimateNum();
				UI.children.gameui.OnFmSkillUpdate();
				UpdateMyFamilyInfo();
				PushNewbieTips(40);
				UI.children.gameui.children.familydetaildlg.UpdateFamilyDetail();
				Win_AlignWidget("UI.gameui.familydetaildlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);				
				Win_SetFocus("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist");
				
				Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.containscroll",100,value_channel_maxvalue);
				Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.containscroll",0,value_channel_pos);
				
				Win_SetValue("UI.gameui.familydetaildlg.familynote.containscroll",100,value_channel_maxvalue);
				Win_SetValue("UI.gameui.familydetaildlg.familynote.containscroll",0,value_channel_pos);
				
				RequestNewbieHelp(help_familydetaildlg);
				RequestNewbieHelp(help_family_skill);
				
				SetGlobalQuery(GlobalQuery_FmStudySkill,1);
				
				local checked = GetRemind();
				if checked == 0 then checked = false end;
				Win_SetCheck("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.showremindcheck",checked);
				end;
				
			OnSelfHide=function()
				RequestNewbieHelp(help_familydetaildlg,0);
				SetGlobalQuery(GlobalQuery_FmStudySkill,0);
				end;
				
			UpdateFamilyDetail=function()
				local oldsel=Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
				local memname = GetFamilyMemberListItemName(oldsel);
				
				local info=GetFamilyDetialInfo(-1);
				if info~=nil then				
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.namelabel",info.name);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.levellabel",info.level);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.gradelabel",info.grade);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.prestigelabel",info.prestige);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.popularlabel",info.popular);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.goldlabel",info.gold);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.silverlabel",info.silver);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.copperlabel",info.copper);
					Win_SetText("UI.gameui.familydetaildlg.activitymanager.proclaimedit",info.notice);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.newprestigelabel",info.fmprestige);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.familypropertylabel",info.fmProperty);
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.familypropertyaddlimitlabel",info.fmAssitLimit);
					
					local visible = Win_GetValue("UI.gameui.familydetaildlg.activitymanager.proclaimedit",value_channel_editable);
					if visible == 0 then
						Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",info.logo);
					end;
				
					oldsel=-1;
					for i=0,info.memcount-1 do
						local meminfo=GetFamilyMemInfo(-1,i);
						if meminfo~=nil then
							if meminfo.name==memname then
								oldsel=i;
								break;
							end;
						end;				
					end;
				
					if oldsel<0 then 
						oldsel=0;
					end;	
					local onlyshowonline = IsFmlShowOnline();
					if onlyshowonline ~= 0 then
						local ionlinecount = GetFmlOnlineCount();
						Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist", ionlinecount, value_channel_item_num);
						Win_SetValue("UI.gameui.familydetaildlg.familynote.detailcontain.listcontain.detaillist", ionlinecount, value_channel_item_num);
					else 
						Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",info.memcount,value_channel_item_num);
						Win_SetValue("UI.gameui.familydetaildlg.familynote.detailcontain.listcontain.detaillist",info.memcount,value_channel_item_num);
					end;
					
					--Win_SetSelect("UI.gameui.familydetaildlg.detaillist",0,oldsel);
					--Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",oldsel,value_channel_sel);
					
					--Win_SetValue("UI.gameui.familydetaildlg.familynote.detailcontain.listcontain.detaillist",50,value_channel_item_num);
					
					local onlinenum = GetOnlineMemNum();
					Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.numinfo", onlinenum.."/"..info.memnum);
				end;				
				
				UI.children.gameui.children.familydetaildlg.UpdateBtnState();
				
				UI.children.gameui.children.familydetaildlg.children.familynote.UpdateBtnState();
				UI.children.gameui.children.familydetaildlg.children.activitymanager.UpdateBtnState();
			end;
			
			UpdateBtnState=function()
				local nRight=GetMyRightInFamily();				
				--只要在家族中
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.relationbtn",(nRight>-1));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.refreshbtn",(nRight>-1));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.quitbtn",(nRight>-1));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.onlyshowinlinecheck",(nRight>-1));
				--自己是族长
				--Win_EnableWidget("UI.gameui.familydetaildlg.resistcheck",(nRight==1));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.jobcustombtn",(nRight==1));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",(nRight==1));
				--自己是族长或者长老
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.resistcheck",((nRight==1) or (nRight==2)));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.proclaimbtn",((nRight==1) or (nRight==2)));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.jobofferbtn",((nRight==1) or (nRight==2)));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.jobfirebtn",((nRight==1) or (nRight==2)));
				Win_EnableWidget("UI.gameui.familydetaildlg.fmmgrtab.kickbtn",((nRight==1) or (nRight==2)));

				--是否可以转让与中止转让
				Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",false);
				Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobstopsellbtn",false);
				if nRight==1 then
					local nJobSelStatus = IsJobSeling();
					if nJobSelStatus ~= 0 then
						Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",false);
						Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobstopsellbtn",true);
					else
						Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobstopsellbtn",false);
						Win_ShowWidget("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",true);
					end;
				end;
				
				local bcanjoin = IsJoinDeny();
				if bcanjoin ~= 0 then
					if not Win_IsChecked("UI.gameui.familydetaildlg.fmmgrtab.resistcheck") then
						Win_SetCheck("UI.gameui.familydetaildlg.fmmgrtab.resistcheck",true);
					end;
				else
					if Win_IsChecked("UI.gameui.familydetaildlg.fmmgrtab.resistcheck") then
						Win_SetCheck("UI.gameui.familydetaildlg.fmmgrtab.resistcheck",false);
					end;
				end;
				
				end;
				
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={378,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					style=wgtstyle_alphawin;
					defaultcancel=1,
				},	
				
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 356,18,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					style=wgtstyle_alphawin;
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.familydetaildlg.fmmgrtab") then
							if Win_IsVisible("UI.gameui.familydetaildlg") then
								RequestNewbieHelp(help_familydetaildlg,-1);
							end;
						elseif Win_IsChecked("UI.gameui.familydetaildlg.fmskilltab") then
							if Win_IsVisible("UI.gameui.familydetaildlg") then
								RequestNewbieHelp(help_family_skill,-1);
							end;
						end;
						--[[
						local helpid=GetHelpID("家族管理界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};
				
				fmmgrtab=
				{
					type="TABWIN",
					rect={30,63,366,485},
					tabrect={5,0,82,22},
					tabcover="res/uires/family/fmmgrtab.gsa",
					tabwintype=tabwin_type_up,
					bkimage="res/uires/family/fmmgrtabbk.gsa",
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					style=wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;
					checked=1,
					initlayer=msgbox_layer-2,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							--RequestNewbieHelp(help_equipdlg_attr,0);
							RequestNewbieHelp(help_equipdlg_equip);
						end;
						end;
					
					children=
					{				
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_familydetaildlg,
								offsetx=-89,
								offsety=38,
							},
							
						};
						
						numinfo=
						{
							type="LABEL",
							rect={233,9,65,12},
							captionrect={0,0,50,12},
							textstyle=dt_center+dt_vcenter,
							textsize=12,
							enable=0,
						};
						
						onlyshowinlinecheck=
						{
							type="CHECK",
							rect = {134,214,70,18},
							bkimage = "res/uires/newcommon/checkbox.gsa",	
							bkimagepos={-2,-3},
							OnCheck=function(bcheck)
								SetFamilyDetailOnline(bcheck);
								UI.children.gameui.children.familydetaildlg.UpdateFamilyDetail();	
							end;
						},
						
						-- 家族威望
						newprestigelabel=
						{
							type="LABEL",
							rect={72,28,150,12},
							textsize=12,
							textstyle=dt_left,
							enable=0,					
						};
						
						namelabel=
						{
							type="LABEL",
							rect={72,9,150,12},
							textsize=12,
							textstyle=dt_left,
							enable=0,					
						};
						
						levellabel=
						{
							type="LABEL",
							rect={43,88,58,12},
							textsize=12,
							enable=0,					
						};
						
						gradelabel=
						{
							type="LABEL",
							rect={144,88,58,12},
							textsize=12,
							enable=0,					
						};
						
						prestigelabel=
						{
							type="LABEL",
							rect={43,107,60,12},
							textsize=12,
							enable=0,					
						};
						
						popularlabel=
						{
							type="LABEL",
							rect={243,88,60,12},
							textsize=12,
							enable=0,					
						};
						
						goldlabel=
						{
							type="LABEL",
							rect={145,107,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/gold.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,					
						},
						
						silverlabel=
						{
							type="LABEL",
							rect={193,107,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/silver.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,
						},
						
						copperlabel=
						{
							type="LABEL",
							rect={241,107,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/copper.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,
						},
						
						totemlabel=
						{
							type="LABEL",
							rect={316,27,36,36},
							enable=0,					
						};				
						familypropertylabel=
						{
							type="LABEL",
							rect={73,46,150,12},
							textsize=12,
							textstyle=dt_left,
							enable=0,					
						};
						
						familypropertyaddlimitlabel=
						{
							type="LABEL",
							rect={208,68,80,12},
							textsize=12,
							textstyle=dt_left,
							enable=0,					
						};
						
						resistcheck= 
						{
							type = "CHECK",
							rect={10,214,118,18};
							bkimage = "res/uires/newcommon/checkbox.gsa",	
							bkimagepos={-2,-1},
							
							OnClick=function()
								local bcheck = Win_IsChecked("UI.gameui.familydetaildlg.fmmgrtab.resistcheck");
								local nRight=GetMyRightInFamily();	
								if ((nRight==1) or (nRight==2)) then
									if bcheck~=false then
										FamMemJoinSet(1);
									else
										FamMemJoinSet(0);
									end;
									end;
								Win_SetCheck("UI.gameui.familydetaildlg.fmmgrtab.resistcheck",bcheck==false);
								end;
						};
						
						relationbtn=
						{
							type="BUTTON",
							rect={200,206,90,28},
							bkimage="res/uires/family/relationbtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.familyrelationdlg",true);
								Win_SetFocus("UI.gameui.familyrelationdlg");						
								end;
							
						};
						
						proclaimbtn=
						{
							type="BUTTON",
							rect={280,206,90,28},
							bkimage="res/uires/family/proclaimbtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								if Win_GetText("UI.gameui.familydetaildlg.fmmgrtab.namelabel")~="" then
								local beditable=Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",value_channel_editable);
								if beditable==1 then
								local proclaimtxt=Win_GetText("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit");
								UpdateFamilyLogo(proclaimtxt);
								Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",0,value_channel_editable);
								else
								Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",1,value_channel_editable);
								Win_SetFocus("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit");
								end;
								end;
								end;
						};
						
						jobcustombtn=
						{
							type="BUTTON",
							rect={277,430,90,28},
							bkimage="res/uires/family/jobcustombtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.jobcustomdlg",true);						
								end;
							
						};
						
						jobofferbtn=
						{
							type="BUTTON",
							rect={2,430,90,28},
							bkimage="res/uires/family/jobofferbtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								local sel = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
								local name=GetFamilyMemberListItemName(sel);
								if name~="" then						
								Win_SetText("UI.gameui.jobofferdlg",name,value_channel_customname);
								Win_ShowWidget("UI.gameui.jobofferdlg",true);
								Win_SetFocus("UI.gameui.jobofferdlg");
								end;
								end;

							
						};
						
						jobfirebtn=
						{
							type="BUTTON",
							rect={95,430,90,28},
							bkimage="res/uires/family/jobfirebtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()						
								local sel = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
								local name=GetFamilyMemberListItemName(sel);
								if name~="" then
								Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.jobfirebtn",name,value_channel_customname);
								Win_ShowMsgBox("您确定要解除成员: "..name.."的职务吗?","系统消息",ui_msgid_yesno,"UI.gameui.familydetaildlg.fmmgrtab.jobfirebtn");
								end;
								end;
								
							OnMsgBoxOk=function()
								name=Win_GetText("UI.gameui.familydetaildlg.fmmgrtab.jobfirebtn",value_channel_customname);
								if name~="" then
								ReleasePosFamily(name);
								end;
								end;
							
						};
						
						jobsellbtn=
						{
							type="BUTTON",
							rect={187,430,90,28},
							bkimage="res/uires/family/jobsellbtn2.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								local sel = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
								local name=GetFamilyMemberListItemName(sel);
								if name~="" then
								Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",name,value_channel_customname);
								Win_ShowMsgBox("您确定要转让职位给成员: "..name.."吗?","系统消息",ui_msgid_yesno,"UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn");
								end;
								end;
								
							OnMsgBoxOk=function()
								name=Win_GetText("UI.gameui.familydetaildlg.fmmgrtab.jobsellbtn",value_channel_customname);
								if name~="" then
								TransferPosFamily(name);
								end;
								end;			
							
						};
						
						jobstopsellbtn=
						{
							type="BUTTON",
							rect={187,430,90,28},
							bkimage="res/uires/family/jobstopsellbtn.gsa",
							style=wgtstyle_alphawin;
							visible=0,
							
							OnClick=function()
								Win_ShowMsgBox("您确定要中止转让职位吗?","系统消息",ui_msgid_yesno,"UI.gameui.familydetaildlg.fmmgrtab.jobstopsellbtn");
								end;
								
							OnMsgBoxOk=function()
								FamStopTransfer();
								end;			
							
						};
						
						kickbtn=
						{
							type="BUTTON",
							rect={2,456,90,28},
							bkimage="res/uires/family/kickbtn.gsa",	
							style=wgtstyle_alphawin;
							
							OnClick=function()
								local sel = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
								local name=GetFamilyMemberListItemName(sel);
								if name~="" then
								Win_SetText("UI.gameui.familydetaildlg.fmmgrtab.kickbtn",name,value_channel_customname);
								Win_ShowMsgBox("您确定要开除成员: "..name.."吗?","系统消息",ui_msgid_yesno,"UI.gameui.familydetaildlg.fmmgrtab.kickbtn");
								end;
								end;
								
							OnMsgBoxOk=function()
								name=Win_GetText("UI.gameui.familydetaildlg.fmmgrtab.kickbtn",value_channel_customname);
								if name~="" then
								KickOutFamily(name);
								end;
								end;		
						};
						
						
						refreshbtn=
						{
							type="BUTTON",
							rect={95,456,90,28},
							bkimage="res/uires/family/refreshbtn.gsa",	
							style=wgtstyle_alphawin;
							
							OnClick=function()
								UpdateMyFamilyInfo(true);
								end;
						};
						
						quitbtn=
						{
							type="BUTTON",
							rect={277,456,90,28},
							bkimage="res/uires/family/quitbtn.gsa",
							style=wgtstyle_alphawin;

							OnClick=function()
								Win_ShowMsgBox("您确定要退出家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.familydetaildlg.fmmgrtab.quitbtn");
								end;
							
							OnMsgBoxOk=function()
								QuitFamily();
								Win_ShowWidget("UI.gameui.familydetaildlg",false);
								end;
						};
						
						proclaimedit=
						{
							type="MULTIEDIT",
							rect={9,124,352,79},	
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
							textsize=12,
							rowspace=4,
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
							maxchar=500,
							editable=0,
							richflag=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={335,18,20,45},
									style=wgtstyle_vertical,
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
									extendstyle=scrollbar_blockbtn_auto_size + scrollbar_auto_hide,							
									minbtnsize=16,
									pagesize=1,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,	
																		
									OnSelfShow=function()
										local panelrect = Win_GetRect("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit", value_channel_captionrect);
										if (panelrect.w == 352) then
											Win_SetRect("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit", 0, 0, 352-20, 79, value_channel_captionrect);
											Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",1,value_channel_update_dirty);
										end;
									end;
									OnSelfHide=function()
										local panelrect = Win_GetRect("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit", value_channel_captionrect);
										if (panelrect.w < 352) then
											Win_SetRect("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit", 0, 0, 352, 79, value_channel_captionrect);
											Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.proclaimedit",1,value_channel_update_dirty);
										end;
									end;

									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,		
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};				
						
						containscroll=
						{
							type="SCROLLBAR",
							rect={27,406,317,20},	
							patchupleft="res/uires/newcommon/hscroll_bk.gsa",
							patchupmiddle="res/uires/newcommon/hscroll_bk.gsa",
							patchupright="res/uires/newcommon/hscroll_bk.gsa",	
							extendstyle=scrollbar_blockbtn_auto_size,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							OnValueChange=function(pos)
								local x = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain",value_channel_winrect,0);
								local w1 = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain",value_channel_winrect,2);
								local w2 = Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain",value_channel_winrect,2);
								local offset = (w2-w1)*pos/100;
								Win_SetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain",x-offset,value_channel_winrect,0);
								end;
								
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,80,20},
									patchupleft="res/uires/newcommon/hblockleft.gsa",
									patchupmiddle="res/uires/newcommon/hblockmid.gsa",
									patchupright="res/uires/newcommon/hblockright.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_vcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/rightbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/leftbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_left_out+alignstyle_vcenter,	
									marginh=0,
									marginv=0,
								};--spindown
								
							};--children
							
						};--scroll
						
						detailscroll=
						{
							type="SCROLLBAR",
							rect={344,260,20,128},	
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",

							OnSelfShow=function()
								UI.children.gameui.children.familydetaildlg.children.fmmgrtab.children.detailcontain.UpdateScroll();
							end;
							OnSelfHide=function()
								UI.children.gameui.children.familydetaildlg.children.fmmgrtab.children.detailcontain.UpdateScroll();
							end;

							OnValueChange=function(pos)
							--	UI.children.gameui.children.familydetaildlg.children.detailcontain.UpdateScroll();
							end;					

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,
								};--blockbtn
								
								spinup=
								{
									type="SPIN",
									rect={0,0,20,20},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,20},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll
						
						detailcontain=
						{
							type="CONTAINER",
							rect={9,240,348,160},
							style=wgtstyle_clipchild_window;
							initlayer=msgbox_layer-1,
							pluslayer=0,		
							
							UpdateScroll=function()
								local panelrect = Win_GetRect("UI.gameui.familydetaildlg.fmmgrtab.detailcontain", value_channel_winrect);
								local scrollrect = Win_GetRect("UI.gameui.familydetaildlg.fmmgrtab.containscroll", value_channel_winrect);
								
								if Win_IsVisible("UI.gameui.familydetaildlg.fmmgrtab.detailscroll") then
									Win_ExtendEdge("UI.gameui.familydetaildlg.fmmgrtab.detailcontain",335-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
									--Win_ExtendEdge("UI.gameui.familydetaildlg.containscroll",320-45-scrollrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
								else
									Win_ExtendEdge("UI.gameui.familydetaildlg.fmmgrtab.detailcontain",350-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
									--Win_ExtendEdge("UI.gameui.familydetaildlg.containscroll",320-scrollrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
								end;
							end;

							children=
							{
								listcontain=
								{
									type="CONTAINER",
									rect={0,-1,590,160},
									style=wgtstyle_clipchild_window;
									
									children=
									{
										titlepic=
										{
											type="LABEL",
											rect={0,0,590,21},
											bkimage="res/uires/family/titlepic.gsa",
											initlayer=0;
											enable=0;
										};
										
										detaillist=
										{
											type="LISTBOX",
											rect={0,21,590,148},	
											style=wgtstyle_clipself,		
											extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix+listbox_style_rightbtnsel,
											dragtype=ui_drag_type_familymemberlist,
											itemdrawback="res/uires/family/detailitembk.gsa",
											itemdrawpos={0,20, 0, 0};
											itemselback="res/uires/family/detailitemsel.gsa",
											itemselpos={30, 2, 336, 18},
											itemwidth=590,
											itemheight=23,
											itemmarginh=0,
											itemmarginv=0,	
											textsize=12,				
											updatemute=1,
											
											primaryscroll="UI.gameui.familydetaildlg.fmmgrtab.detailscroll",
											
											OnSelfShow=function()
												--UI.children.gameui.children.familydetaildlg.children.detailcontain.UpdateScroll();
												UI.children.gameui.children.familydetaildlg.children.fmmgrtab.children.detailcontain.UpdateScroll();
											end;

											OnRClick=function(idx)
												if idx>=0 then
													local meminfo=GetFamilyMemInfo(-1,idx);
													if meminfo~=nil then
														if (meminfo.name~="")and(meminfo.name~=g_PlayerInfo.name) then
															Win_SetValue("UI.gameui.friendmenudlg",1,value_channel_customtype);
															Win_SetText("UI.gameui.friendmenudlg",meminfo.name,value_channel_customname);
															Win_SetValue("UI.gameui.friendmenudlg",1,value_channel_update_dirty);
															Win_ShowWidget("UI.gameui.friendmenudlg",true);
															Win_SetFocus("UI.gameui.friendmenudlg");
														end;
													end;
												end;
											end;
											
											OnDBClick=function()
												local selIdx=Win_GetValue("UI.gameui.familydetaildlg.fmmgrtab.detailcontain.listcontain.detaillist",value_channel_sel);
												if selIdx >= 0 then
													local bdyinfo=GetFamilyMemInfo(-1,selIdx);
													if bdyinfo~=nil then
														if bdyinfo.name~="" and bdyinfo.name~=g_PlayerInfo.name then
															if bdyinfo.bonline ~= 0 then
																GossipTalk(bdyinfo.name);
															else
																GameUILogInfo("对方不在线，不能启动私聊");
															end;
														end;
													end;
												end;
											end;
											
										},--list
										
										namebtn=
										{
											type="BUTTON",
											rect={25,0,77,21},
											bkimage="res/uires/family/namebtn.gsa",
											--caption="姓名",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(0);
												end;
										};
										
										profbtn=
										{
											type="BUTTON",
											rect={102,0,56,21},
											bkimage="res/uires/family/profbtn.gsa",
											--caption="职业",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(4);
												end;
										};
										
										playerlevelbtn=
										{
											type="BUTTON",
											rect={159,0,56,21},
											bkimage="res/uires/family/playerlevelbtn.gsa",
											--caption="等级",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(5);
												end;
										};
										
										positionbtn=
										{
											type="BUTTON",
											rect={215,0,57,21},
											bkimage="res/uires/family/positionbtn.gsa",
											--caption="职位",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(1);
												end;
										};
										
										prestigebtn=
										{
											type="BUTTON",
											rect={272,0,57,21},
											bkimage="res/uires/family/prestigebtn.gsa",
											--caption="威望",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(7);
												end;
										};										
										
										
										levelbtn=
										{
											type="BUTTON",
											rect={329,0,57,21},
											bkimage="res/uires/family/levelbtn.gsa",
											--caption="级别",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(2);
												end;
										};
										
										contributebtn=
										{
											type="BUTTON",
											bkimage="res/uires/family/contributebtn.gsa",
											rect={386,0,57,21},
											--caption="贡献",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(3);
												end;
										};
										
										timebtn=
										{
											type="BUTTON",
											rect={443,0,63,21},
											bkimage="res/uires/family/timebtn.gsa",
											--caption="在线时长",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(6);
												end;
										};
										
										fmassetsbtn=
										{
											type="BUTTON",
											rect={506,0,84,21},
											bkimage="res/uires/family/fmassetsbtn.gsa",
											--caption="家族资材贡献",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(8);
												end;
										};
									};					
								};
							};
						};
					};						
				};
				fmskilltab=
				{
					type="TABWIN",
					rect={29,61,368,486},							
					tabrect={92,0,82,20},
					tabcover="res/uires/family/fmskilltab.gsa",
					bkimage="res/uires/family/fmskilltabbk.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=1,
					tabstop=0,
					soundid={1003},
					checked=0,
					visible=1,
					updatemute=1,
					
					dragindex=-1,
					dragtype=ui_drag_type_skill_main,
					itemdragflag=-1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab",value_channel_customtype);
						local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab",value_channel_customid);
						Win_SetValue("UI.gameui.familydetaildlg",dgtype,value_channel_customtype);
						Win_SetValue("UI.gameui.familydetaildlg",dgindex,value_channel_customid);
						local stop = Win_GetValue("UI.gameui.familydetaildlg",value_channel_customindex);
						--if stop ~= 0 then
						Win_SetValue("UI.gameui.familydetaildlg",0,value_channel_customindex);
						UI.children.gameui.OnFmSkillUpdate();
						--end;
						end;
						if bcheck ~= 0 then
							RequestNewbieHelp(help_family_skill);
						end;
						UI.children.gameui.OnFmTabQMSkillUpdate();
						UI.children.gameui.children.familydetaildlg.children.fmskilltab.UpdateFamilyInfo();
						UI.children.gameui.children.familydetaildlg.children.fmskilltab.children.houseskillcontain.UpdateStartActive();
						
						--local getRemind = GetRemind();
						--debug_message(getRemind);
						--Win_SetCheck("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.showremindcheck",getRemind);
					end;

					UpdateFamilyInfo=function()
						local myselfinfo = GetSelfFamilyInfo();
						if myselfinfo ~= nil then
							Win_SetText("UI.gameui.familydetaildlg.fmskilltab.personalproperty",myselfinfo.assets);
							Win_SetText("UI.gameui.familydetaildlg.fmskilltab.personalprestige",myselfinfo.prestige);
							Win_SetText("UI.gameui.familydetaildlg.fmskilltab.goldlabel",myselfinfo.gold);
							Win_SetText("UI.gameui.familydetaildlg.fmskilltab.silverlabel",myselfinfo.sliver);
							Win_SetText("UI.gameui.familydetaildlg.fmskilltab.copperlabel",myselfinfo.copper);
						end;
					end;
						

						
					children=
					{
						newbiecustom=
						{
							type="WIDGET",
							rect={0,0,1,1},
							style=wgtstyle_renderbuffer,
							initlayer=msgbox_layer-1,
							custombuffer=custom_buffer_newbiehelp,
							buffervalue =
							{
								drawtype=help_family_skill,
								offsetx=-125,
								offsety=-10,
							},
							
						};
						
						cancelbtn = 
						{
							type = "BUTTON",
							rect = { 275,458,90,28 },
							bkimage="res/uires/taskdlg/closebtn.gsa",
							OnClick=function()
								Win_ShowWidget("UI.gameui.familydetaildlg",false);
							end;
						},	

						-- 剩余终极技能点数
						remainnumlabel=
						{
							type="LABEL",
							rect={261,120,57,12},
							textsize=12,
							textstyle=dt_left,
							enable=0,					
						};					
						skillcontain=
						{
							type = "WIDGETLIST",
							rect = { 27,12,332,268},
							style=wgtstyle_clipchild_window;
							--primaryscroll="UI.gameui.familydetaildlg.fmskilltab.skillscroll",
							
							children=
							{

								allskills=
								{
									type = "WIDGET",
									rect = { 0,0,310,268 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
									--custombuffer=custom_buffer_fmskilltree,
									updatemute=1,
									
									children=
									{
										--[[
										varrow=
										{
											type = "WIDGET",
											rect = { 155,20,23,322 },
											bkimage="res/uires/skilldlg/vArrow.gsa";
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=1,
											updatemute=1,
										},	
										]]
										harrow=
										{
											type = "WIDGET",
											rect = { 174,162,77,21 },
											bkimage="res/uires/skilldlg/hArrow.gsa";
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
										},
										
										
										
										infolabel=
										{
											type = "LABEL",
											rect = { 18,70,190,40 },
											caption="尚未就职，无可用主修技能!",
											textsize=12,											
											visible=0,
											updatemute=1,
										},
										
										skill1=
										{
											type = "WIDGET",
											rect = { 43,17,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 115,17,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
										
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill2",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill3=
										{
											type = "WIDGET",
											rect = { 189,17,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill3",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill4=
										{
											type = "WIDGET",
											rect = { 261,17,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill4",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill5=
										{
											type = "WIDGET",
											rect = { 28,76,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill5",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill6=
										{
											type = "WIDGET",
											rect = { 74,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,							
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill6",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill7=
										{
											type = "WIDGET",
											rect = { 132,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill7",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill7",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill7",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill8=
										{
											type = "WIDGET",
											rect = { 190,66,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill8",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill8",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill8",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill9=
										{
											type = "WIDGET",
											rect = { 16,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill9",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill9",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill9",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill10=
										{
											type = "WIDGET",
											rect = { 74,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill10",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill10",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill10",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill11=
										{
											type = "WIDGET",
											rect = { 132,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill11",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill11",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill11",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill12=
										{
											type = "WIDGET",
											rect = { 190,122,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill12",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill12",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill12",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill13=
										{
											type = "WIDGET",
											rect = { 16,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill13",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill13",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill13",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill14=
										{
											type = "WIDGET",
											rect = { 74,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill14",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill14",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill14",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},	
										},
										
										skill15=
										{
											type = "WIDGET",
											rect = { 132,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill15",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill15",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill15",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill16=
										{
											type = "WIDGET",
											rect = { 190,178,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill16",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill16",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill16",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill17=
										{
											type = "WIDGET",
											rect = { 16,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill17",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill17",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill17",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill18=
										{
											type = "WIDGET",
											rect = { 74,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",	
											dragtype=-1,
											dragindex=-1,
											visible=0,	
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill18",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill18",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill18",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill19=
										{
											type = "WIDGET",
											rect = { 132,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill19",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill19",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill19",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill20=
										{
											type = "WIDGET",
											rect = { 190,234,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill20",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill20",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill20",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill21=
										{
											type = "WIDGET",
											rect = { 16,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill21",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill21",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill21",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill22=
										{
											type = "WIDGET",
											rect = { 74,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill22",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill22",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill22",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill23=
										{
											type = "WIDGET",
											rect = { 132,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill23",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill23",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill23",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill24=
										{
											type = "WIDGET",
											rect = { 190,290,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill24",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill24",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill24",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
										skill25=
										{
											type = "WIDGET",
											rect = { 16,346,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill25",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill25",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.skillcontain.allskills.skill25",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												},
												
											},
										},
										
									};
								};
							};

						};
						personalproperty=
						{
							type="LABEL",
							rect={83,440,45,12},
							textsize=12,
							enable=0,					
						},
						
						personalprestige=
						{
							type="LABEL",
							rect={216,440,45,12},
							textsize=12,
							enable=0,
						},
						
						goldlabel=
						{
							type="LABEL",
							rect={40,466,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/gold.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,					
						},
						
						silverlabel=
						{
							type="LABEL",
							rect={88,466,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/silver.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,
						},
						
						copperlabel=
						{
							type="LABEL",
							rect={136,466,48,12},
							captionrect={12,0,36,12},
							bkimage="res/uires/common/copper.gsa",
							bkimagepos={2,0},
							textsize=12,	
							bkcolor={0,0,0,0},
							--enable=0,
						},
						--[[
						skillscroll=
						{
					
							type="SCROLLBAR",
							rect={324,56,20,322},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.familydetaildlg.fmskilltab.skillcontain",
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
						]]
						houseskillcontain=
						{
							type = "WIDGETLIST",
							rect = { 28,295,332,129},
							style=wgtstyle_clipchild_window;
							--primaryscroll="UI.gameui.familydetaildlg.fmskilltab.skillscroll",
							
							OnSelfShow=function()
								UpdateStartActive();
							end;
							
							UpdateStartActive=function()
								local hasActive1 = GetActive(0);
								local hasActive2 = GetActive(1);
								if hasActive1 == true then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.startQMSkillBtn",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1",true);
								else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.startQMSkillBtn",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1",false);
								end;
								
								
								if hasActive2 == true then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.startQMSkillBtn2",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2",true);
								else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.startQMSkillBtn2",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2",false);
								end;								--SetQMSkillGridItem();			
							end;
							

							
							ShowEffect=function(id,isshow)
								if id == 13501 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;
								elseif id == 13502 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;
								elseif id == 13503 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;
								elseif id == 13504 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;
								elseif id == 13505 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;
								elseif id == 13506 then
								    if isshow == 0 then
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",false);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",false);
								    else
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill1.effect",true);
									Win_ShowWidget("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.setskill2.effect",true);
								    end;								    
								end;
							end;
							
							children=
							{

								allhouseskills=
								{
									type = "WIDGET",
									rect = { 0,0,310,129 },										
									style=wgtstyle_renderbuffer+wgtstyle_clipchild_window+wgtstyle_static,
								
									children=
									{
									
										skill1=
										{
											type = "WIDGET",
											rect = { 22,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													visible=0,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill1",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill1",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill1",value_channel_customtype);
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												};
												
											};
										},
										
										skill2=
										{
											type = "WIDGET",
											rect = { 84,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill2",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill2",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill2",value_channel_customtype)
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												};
												
											};
										},
										skill3=
										{
											type = "WIDGET",
											rect = { 147,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill3",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill3",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill3",value_channel_customtype)
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												};
												
											};
										},									
										skill4=
										{
											type = "WIDGET",
											rect = { 209,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill4",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill4",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill4",value_channel_customtype)
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												};
												
											};
										},									
										skill5=
										{
											type = "WIDGET",
											rect = { 266,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											visible=0,
											updatemute=1,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill5",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill5",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill5",value_channel_customtype)
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
														end;
												};
												
											};
										},									
										skill6=
										{
											type = "WIDGET",
											rect = { 274,4,36,36 },
											bkimage="res/uires/skilldlg/skillrect.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=-1,
											dragindex=-1,
											updatemute=1,
											visible=0,
											
											children=
											{
											
												upgradebtn= 
												{
													type = "BUTTON",
													rect = { -9,25,22,19 },
													bkimage="res/uires/newcommon/plusbtn.gsa",	
													tiptext="学习",
													updatemute=1,
													
													OnClick=function()
														local dgtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill6",value_channel_dragtype);
														local dgindex = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill6",value_channel_dragindex);
														if dgtype==ui_drag_type_skill_life then
														dgindex = dgindex+1;
														end;
														
														local customtype = Win_GetValue("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.skill6",value_channel_customtype)
														if customtype==0 then
														SkillLearn(dgtype,dgindex);
														else
														SkillUpgrade(dgtype,dgindex);
														end;
														
													end;
												};
												
											};
										},									
									
										setskill1=
										{
											type = "WIDGET",
											rect = { 96,64,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=0,
											visible=1,
											updatemute=1,
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};											
											
										},
										
										setskill2=
										{
											type = "WIDGET",
											rect = { 180,64,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=1,
											visible=0,
											updatemute=1,	
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};											
										},
										
										setskill3=
										{
											type = "WIDGET",
											rect = { 118,73,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=0,
											visible=0,
											updatemute=1,	
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};
										},
										
										setskill4=
										{
											type = "WIDGET",
											rect = {170,73,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=0,
											visible=0,
											updatemute=1,
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};											
										},
										
										setskill5=
										{
											type = "WIDGET",
											rect = { 222,73,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=0,
											visible=0,
											updatemute=1,	
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};
										},
										
										setskill6=
										{
											type = "WIDGET",
											rect = { 274,73,36,36 },
											bkimage="res/uires/sysoption/qmskillitembkg.gsa";
											bkimagepos={-3,-3},
											framescheme={{0},{1}},
											style=wgtstyle_renderitem,
											tipwidget="UI.gameui.ScrnTooltip",
											dragtype=ui_drag_type_qmskilllist,
											dragmode=1,	-- 延迟拖拉
											dragindex=0,
											visible=0,
											updatemute=1,
											visible=0,
											
											children=
											{	
												effect= 
												{
													type = "WIDGET",
													rect={18,36,1,1};
													effect={{name="TFX9257.eff", x=0, y=0, loop=1, delay=0}},					
													visible=0;
												};	
											};
										};										
									
										showremindcheck=
										{
											type="CHECK";
											rect={180,106,15,15};
											bkimage="res/uires/newcommon/checkbox.gsa",
											tiptext="",
											bkimagepos={0,-2};
											visible=1,
											checked=GetRemind(),
											bcheck=1,
											
											--OnInitUpdate=function()
												--Win_SetCheck("UI.gameui.familydetaildlg.fmskilltab.houseskillcontain.allhouseskills.showremindcheck",checked);
											--end;
											
											
											OnClick=function()
												local c = GetRemind();
												if(c == 1) then c = 0;
												else c = 1;
												end;
												SetRemindQMSkillMessage(c);
											end;
											
										};
										
										startQMSkillBtn=
										{
											type="BUTTON";
											rect = { 96,64,36,36 },
											bkimage="res/uires/gameui/startQMSkill.gsa";
											tiptext="您可以点击我来开启技能拦7天，7天内可随意使用上\n面您已经学习过的技能，只要将奇门技能拖入即可";
											OnClick=function()
												ActiveQMSkillItem();
											end;
										};
										
										startQMSkillBtn2=
										{
											type="BUTTON";
											rect = { 180,64,36,36 },
											bkimage="res/uires/gameui/startQMSkill.gsa";
											tiptext="您可以点击我来开启技能拦7天，7天内可随意使用上\n面您已经学习过的技能，只要将奇门技能拖入即可";
											OnClick=function()
												ActiveQMSkillItem2();
											end;
										};
									};										

								};
							};
						};
					};
				};
				
				familynote=
				{
					type="TABWIN",
					rect={29,61,368,486},							
					tabrect={179,0,82,20},
					tabcover="res/uires/family/activitymanager.gsa",
					--bkimage="res/uires/family/fmskilltabbk.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=2,
					tabstop=0,
					soundid={1003},
					checked=0,
					visible=1,
					updatemute=1,
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							RequestNewbieHelp(help_equipdlg_equip);
						end;
					end;
					
					
					
					UpdateBtnState=function()
						local nRight=GetMyRightInFamily();				
						--只要在家族中
						Win_EnableWidget("UI.gameui.familydetaildlg.familynote.exportbtn",(nRight>-1));
					end;
					
					children=
					{
						containscroll=
						{
							type="SCROLLBAR",
							rect={23,424,325,20},	
							patchupleft="res/uires/newcommon/hscroll_bk.gsa",
							patchupmiddle="res/uires/newcommon/hscroll_bk.gsa",
							patchupright="res/uires/newcommon/hscroll_bk.gsa",	
							extendstyle=scrollbar_blockbtn_auto_size,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							OnValueChange=function(pos)
								local x = Win_GetValue("UI.gameui.familydetaildlg.familynote.detailcontain",value_channel_winrect,0);
								local w1 = Win_GetValue("UI.gameui.familydetaildlg.familynote.detailcontain",value_channel_winrect,2);
								local w2 = Win_GetValue("UI.gameui.familydetaildlg.familynote.detailcontain.listcontain",value_channel_winrect,2);
								local offset = (w2-w1)*pos/100;
								Win_SetValue("UI.gameui.familydetaildlg.familynote.detailcontain.listcontain",x-offset,value_channel_winrect,0);
								end;
								
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,80,20},
									patchupleft="res/uires/newcommon/hblockleft.gsa",
									patchupmiddle="res/uires/newcommon/hblockmid.gsa",
									patchupright="res/uires/newcommon/hblockright.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_vcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/rightbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/leftbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_left_out+alignstyle_vcenter,	
									marginh=0,
									marginv=0,
								};--spindown
								
							};--children
							
						};--scroll
						
						detailscroll=
						{
							type="SCROLLBAR",
							rect={340,23,20,382},	
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.familydetaildlg.familynote.detailcontain.listcontain.detaillist",

							OnSelfShow=function()
								UI.children.gameui.children.familydetaildlg.children.familynote.children.detailcontain.UpdateScroll();
							end;
							OnSelfHide=function()
								UI.children.gameui.children.familydetaildlg.children.familynote.children.detailcontain.UpdateScroll();
							end;

							OnValueChange=function(pos)
							--	UI.children.gameui.children.familydetaildlg.children.detailcontain.UpdateScroll();
							end;					

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,46},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,
								};--blockbtn
								
								spinup=
								{
									type="SPIN",
									rect={0,0,20,20},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,20},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll
						
						detailcontain=
						{
							type="CONTAINER",
							rect={2,3,364,420},
							style=wgtstyle_clipchild_window;
							initlayer=msgbox_layer-1,
							pluslayer=0,
							
							UpdateScroll=function()
								local panelrect = Win_GetRect("UI.gameui.familydetaildlg.familynote.detailcontain", value_channel_winrect);
								local scrollrect = Win_GetRect("UI.gameui.familydetaildlg.familynote.containscroll", value_channel_winrect);
								
								if Win_IsVisible("UI.gameui.familydetaildlg.familynote.detailscroll") then
									Win_ExtendEdge("UI.gameui.familydetaildlg.familynote.detailcontain",344-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
								else
									Win_ExtendEdge("UI.gameui.familydetaildlg.familynote.detailcontain",364-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
								end;
							end;

							children=
							{
								listcontain=
								{
									type="CONTAINER",
									rect={0,-1,690,420},
									style=wgtstyle_clipchild_window;
									
									children=
									{
										titlepic=
										{
											type="LABEL",
											rect={0,0,690,21},
											bkimage="res/uires/family/titlepic.gsa",
											initlayer=0;
											enable=0;
										};
										
										detaillist=
										{
											type="LISTBOX",
											rect={0,21,690,400},	
											style=wgtstyle_clipself,		
											extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix+listbox_style_rightbtnsel,
											dragtype=ui_drag_type_familymanagerlist,
											itemdrawback="res/uires/family/detailitembk.gsa",
											itemdrawpos={0,20, 0, 0};
											itemselback="res/uires/family/detailitemsel.gsa",
											--itemselpos={30, 2, 336, 18},
											itemselpos={0, 2, 336, 18},
											itemwidth=590,
											itemheight=23,
											itemmarginh=0,
											itemmarginv=0,	
											textsize=12,				
											updatemute=1,
											
											primaryscroll="UI.gameui.familydetaildlg.familynote.detailscroll",
											
											OnSelfShow=function()
												--UI.children.gameui.children.familydetaildlg.children.detailcontain.UpdateScroll();
											end;
											
										},--list
										
										namebtn=
										{
											type="BUTTON",
											--rect={25,0,67,21},
											rect={0,0,67,21},
											bkimage="res/uires/family/fnamebtn.gsa",
											--caption="姓名",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(0);
												end;
										};
										
										profbtn=
										{
											type="BUTTON",
											--rect={92,0,41,21},
											rect={67,0,41,21},
											bkimage="res/uires/family/fprofesstionbtn.gsa",
											--caption="职业",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(4);
												end;
										};
										

										positionbtn=
										{
											type="BUTTON",
											--rect={133,0,61,21},
											rect={108,0,61,21},
											bkimage="res/uires/family/fpositionbtn.gsa",
											--caption="职位",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(1);
												end;
										};
										
										playerlevelbtn=
										{
											type="BUTTON",
											--rect={194,0,36,21},
											rect={169,0,36,21},
											bkimage="res/uires/family/fplayerlevelbtn.gsa",
											--caption="等级",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(5);
												end;
										};
										
										
										lastonlinebtn=
										{
											type="BUTTON",
											--rect={230,0,84,21},
											rect={205,0,84,21},
											bkimage="res/uires/family/flastonline.gsa",
											--caption="最后上线",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(9);
												end;
										};										
										
										

										
										entretimebtn=
										{
											type="BUTTON",
											bkimage="res/uires/family/fentretimebtn.gsa",
											--rect={314,0,83,21},
											rect={289,0,83,21},
											--caption="加入家族时间",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(10);
												end;
										};
										
										prestigeaddbtn=
										{
											type="BUTTON",
											--rect={397,0,78,21},
											rect={372,0,78,21},
											bkimage="res/uires/family/fprestigeaddbtn.gsa",
											--caption="本周威望增长",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(11);
												end;
										};
										
										fmassetsaaddbtn=
										{
											type="BUTTON",
											--rect={475,0,78,21},
											rect={450,0,78,21},
											bkimage="res/uires/family/fmassetsaaddbtn.gsa",
											--caption="本周资材增长",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(12);
												end;
										};
										
										catchthiefbtn=
										{
											type="BUTTON",
											--rect={553,0,42,21},
											rect={528,0,42,21},
											bkimage="res/uires/family/fcatchthief.gsa",
											--caption="抓小偷",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(13);
												end;
										};
										
										wushuangfieldbtn=
										{
											type="BUTTON",
											--rect={595,0,55,21},
											rect={570,0,55,21},
											bkimage="res/uires/family/fwushuangfieldbtn.gsa",
											--caption="无双战场",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(14);
												end;
										};
										
										cocktailpartybtn=
										{
											type="BUTTON",
											--rect={650,0,31,21},
											rect={625,0,31,21},
											bkimage="res/uires/family/fcocktailpartybtn.gsa",
											--caption="酒会",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(15);
												end;
										};
										
										fishingbtn=
										{
											type="BUTTON",
											--rect={681,0,34,21},
											rect={656,0,34,21},
											bkimage="res/uires/family/ffishingbtn.gsa",
											--caption="钓鱼",
											initlayer=msgbox_layer-1,
											pluslayer=0,
											
											OnClick=function()
												SetFamilyDetailSortType(16);
												end;
										};
									};					
								};
							};
						};
						
						exportbtn=
						{
							type="BUTTON",
							rect={270,445,90,28},
							bkimage="res/uires/family/exportbtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								WriteToFile();
							end;
							
						};
					};
				};
				
				activitymanager=
				{
					type="TABWIN",
					rect={29,61,368,486},							
					tabrect={266,0,82,20},
					tabcover="res/uires/family/fmnote.gsa",
					--bkimage="res/uires/family/fmskilltabbk.gsa",
					tabwintype=tabwin_type_up,
					groupid=0,
					groupstop=3,
					tabstop=0,
					soundid={1003},
					checked=0,
					visible=1,
					updatemute=1,
					
					UpdateBtnState=function()
						local nRight=GetMyRightInFamily();				
						--只要在家族中
						Win_EnableWidget("UI.gameui.familydetaildlg.activitymanager.modiproclaimbtn",(nRight == 1 or nRight == 2));
						Win_EnableWidget("UI.gameui.familydetaildlg.activitymanager.confirmmodibtn",(nRight == 1 or nRight == 2));
					end;
					
					children=
					{
						proclaimedit=
						{
							type="MULTIEDIT",
							rect={9,5,352,408},	
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_noitem,
							textsize=12,
							rowspace=4,
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
							maxchar=960,
							editable=0,
							richflag=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={336,18,20,378},
									style=wgtstyle_vertical,
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
									extendstyle=scrollbar_blockbtn_auto_size + scrollbar_auto_hide,							
									minbtnsize=16,
									pagesize=1,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,	
																		
									OnSelfShow=function()
										local panelrect = Win_GetRect("UI.gameui.familydetaildlg.activitymanager.proclaimedit", value_channel_captionrect);
										if (panelrect.w == 352) then
											Win_SetRect("UI.gameui.familydetaildlg.activitymanager.proclaimedit", 0, 0, 352-20, 408, value_channel_captionrect);
											Win_SetValue("UI.gameui.familydetaildlg.activitymanager.proclaimedit",1,value_channel_update_dirty);
										end;
									end;
									OnSelfHide=function()
										local panelrect = Win_GetRect("UI.gameui.familydetaildlg.activitymanager.proclaimedit", value_channel_captionrect);
										if (panelrect.w < 352) then
											Win_SetRect("UI.gameui.familydetaildlg.activitymanager.proclaimedit", 0, 0, 352, 408, value_channel_captionrect);
											Win_SetValue("UI.gameui.familydetaildlg.activitymanager.proclaimedit",1,value_channel_update_dirty);
										end;
									end;

									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,		
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};
						
						modiproclaimbtn=
						{
							type="BUTTON",
							rect={173,446,90,28},
							bkimage="res/uires/family/modiproclaimbtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								Win_SetValue("UI.gameui.familydetaildlg.activitymanager.proclaimedit",1,value_channel_editable);
								Win_SetFocus("UI.gameui.familydetaildlg.activitymanager.proclaimedit");
							end;
							
						};
						
						confirmmodibtn=
						{
							type="BUTTON",
							rect={275,446,90,28},
							bkimage="res/uires/family/confirmmodibtn.gsa",
							style=wgtstyle_alphawin;
							
							OnClick=function()
								local noticetxt=Win_GetText("UI.gameui.familydetaildlg.activitymanager.proclaimedit");
								UpdateFamilyNotice(noticetxt);
								Win_SetValue("UI.gameui.familydetaildlg.activitymanager.proclaimedit",0,value_channel_editable);
							end;
							
						};
					};
	
				};
			};
			
		};		
		
		
		inputstashpassdlg=
		{
			type = "DIALOG",
			rect={0,0,207,114},
			bkimage="res/uires/family/inputstashpassdlg.gsa",
			textstyle=dt_left+dt_center,
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=0,
			visible=0,
			updatemute=1,
			initlayer=msgbox_layer-1,
			pluslayer=0,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.inputstashpassdlg",false);
				end;
			
			OnOk=function()
				local editwgt="UI.gameui.inputstashpassdlg.pswedit";
				local editwgtvalue=Win_GetValue("UI.gameui.inputstashpassdlg.pswedit",value_channel_captionsize);
				if (editwgtvalue > 5)  and (editwgtvalue < 13) then 
					--SetSecuLock(npara,editwgt1,editwgt2);				
					Win_ShowWidget("UI.gameui.inputstashpassdlg",false);
				else
					Win_ShowMsgBox("密码长度不正确，请输入6-12位密码");
					Win_SetText("UI.gameui.inputstashpassdlg.pswedit","");
				end;
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.inputstashpassdlg",true);
				end;
				
			OnSelfShow=function()
				Win_SetText("UI.gameui.inputstashpassdlg.pswedit","");
				Win_SetFocus("UI.gameui.inputstashpassdlg.pswedit");
				end;
				
			OnGainFocus=function()
				Win_SetFocus("UI.gameui.inputstashpassdlg.pswedit");
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={181,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 161,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					enable=0,
					
					OnClick=function()
						local helpid=GetHelpID("输入仓库密码");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				pswedit=
				{
					type="EDIT",
					rect={29,54,154,12},		
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
				},
			};
		};
		
		--caption="自定职位",
		jobcustomdlg=
		{
				
			type="DIALOG",
			rect={0,0,299,238},
			bkimage="res/uires/family/jobcustomdlg.gsa",
			adornpic={"res/uires/family/title_jobcustomdlg.gsa"},
			adornpicpos={{106,17}},
			moveable=1,	
			style=wgtstyle_topmost,
			visible=0,	
			updatemute=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				UI.children.gameui.children.jobcustomdlg.UpdateJobCustom();
				Win_SetFocus("UI.gameui.jobcustomdlg");
				end;
				
			UpdateJobCustom=function()
				
				num,customnum,cannum=GetPosNumFamily();
				oldsel=Win_GetSelect("UI.gameui.jobcustomdlg.customlist",0);
				
				if oldsel>=customnum then
				oldsel=customnum-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.jobcustomdlg.customlist",customnum,value_channel_item_num);
				Win_SetSelect("UI.gameui.jobcustomdlg.customlist",0,oldsel);
				
				Win_EnableWidget("UI.gameui.jobcustomdlg.jobdelbtn",(customnum>0));
				Win_EnableWidget("UI.gameui.jobcustomdlg.jobrightbtn",(customnum>0));
								
				end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={271,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 249,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族新增职位界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				jobnewbtn=
				{
					type="BUTTON",
					rect={28,206,86,24},
					bkimage="res/uires/family/jobnewbtn.gsa",
					
					OnClick=function()						
						nRight=GetMyRightInFamily();
						if nRight>-1 then
						Win_ShowWidget("UI.gameui.jobrightdlg",true);
						
						Win_SetText("UI.gameui.jobrightdlg","新增职位", value_channel_customstring);
						Win_SetText("UI.gameui.jobrightdlg","res/uires/family/title_jobrightdlg.gsa",value_channel_adornpic);
						Win_SetValue("UI.gameui.jobrightdlg",100,value_channel_adornpicposx,0);
						
						Win_EnableWidget("UI.gameui.jobrightdlg.nameedit",true);
						Win_SetText("UI.gameui.jobrightdlg.nameedit","");
						Win_SetFocus("UI.gameui.jobrightdlg.nameedit");						
						end;
						end;
					
											    
				};
				
				jobdelbtn=
				{
					type="BUTTON",
					rect={116,206,86,24},
					bkimage="res/uires/family/jobdelbtn.gsa",					
					
					OnClick=function()
						num,customnum,cannum=GetPosNumFamily();
						nRight=GetMyRightInFamily();
						if (nRight>-1) and (customnum>0) then
						cursel=Win_GetSelect("UI.gameui.jobcustomdlg.customlist",0);
						if cursel>-1 then
						wgtpath="UI.gameui.jobcustomdlg.customlist.jobcustomitem"..cursel;
						if Win_IsExist(wgtpath) then
						jobname=Win_GetText(wgtpath..".jobname");
						if jobname~="" then
						Win_SetText("UI.gameui.jobcustomdlg.jobdelbtn",jobname,value_channel_customname);
						Win_ShowMsgBox("您确定要删除职务: "..jobname.."吗?","系统消息",ui_msgid_yesno,"UI.gameui.jobcustomdlg.jobdelbtn");
						end;
						end;
						end;						
						end;
						end;
					
					OnMsgBoxOk=function()
						jobname=Win_GetText("UI.gameui.jobcustomdlg.jobdelbtn",value_channel_customname);
						if jobname~="" then
						DelPosFamily(jobname);
						end;
						end;
				};
				
				jobrightbtn=
				{
					type="BUTTON",
					rect={204,206,86,24},
					bkimage="res/uires/family/jobrightbtn.gsa",					
					
					OnClick=function()
						nRight=GetMyRightInFamily();
						if nRight>-1 then
						cursel=Win_GetSelect("UI.gameui.jobcustomdlg.customlist",0);
						if cursel>-1 then
						wgtpath="UI.gameui.jobcustomdlg.customlist.jobcustomitem"..cursel;
						if Win_IsExist(wgtpath) then
						jobname=Win_GetText(wgtpath..".jobname");
						if jobname~="" then
						Win_SetText("UI.gameui.jobrightdlg",jobname,value_channel_customname);
						Win_ShowWidget("UI.gameui.jobrightdlg",true);
						
						Win_SetText("UI.gameui.jobrightdlg","职位权限设置", value_channel_customstring);
						Win_SetText("UI.gameui.jobrightdlg","res/uires/family/title_jobmgrrightdlg.gsa",value_channel_adornpic);
						Win_SetValue("UI.gameui.jobrightdlg",84,value_channel_adornpicposx,0);
						
						Win_SetText("UI.gameui.jobrightdlg.nameedit",jobname);
						Win_EnableWidget("UI.gameui.jobrightdlg.nameedit",false);						
						end;
						end;
						end;						
						end;
						end;
				};
				
				customlist=
				{
					type="WIDGETLIST",
					rect={34,68,233,133},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,					
					itemmarginh=0,
					itemmarginv=0,

					primaryscroll="UI.gameui.jobcustomdlg.customscroll",
					template={"res/uires/jobcustomitem.lua"};
					
					children={},
					
				},--list
				
				customscroll=
				{
			
					type="SCROLLBAR",
					rect={266,86,20,95},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.jobcustomdlg.customlist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll		
				
			};
			
		};		
		
		
		jobrightdlg=
		{
			type="DIALOG",
			rect={0,0,267,386},
			bkimage="res/uires/family/jobrightdlg.gsa",
			adornpic={"res/uires/family/title_jobrightdlg.gsa"},
			adornpicpos={{100,17}},
			moveable=1,
			style=wgtstyle_topmost+wgtstyle_customclose,
			visible=0,	
			updatemute=1,
						
			OnSelfShow=function()
				
				num,rightnum=GetRightNumFamily();
				oldsel=Win_GetSelect("UI.gameui.jobrightdlg.rightlist",0);
				
				if oldsel>=rightnum then
				oldsel=rightnum-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.jobrightdlg.rightlist",rightnum,value_channel_item_num);
				Win_SetSelect("UI.gameui.jobrightdlg.rightlist",0,oldsel);
				
				Win_AlignWidget("UI.gameui.jobrightdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);				
				Win_SetFocus("UI.gameui.jobrightdlg");
				
				end;
					   
					   
			OnOk=function()	
				jobname=Win_GetText("UI.gameui.jobrightdlg.nameedit");
				right=Win_GetValue("UI.gameui.jobrightdlg.descriptedit",value_channel_customid);
				title=Win_GetText("UI.gameui.jobrightdlg", value_channel_customstring);
				
				if jobname=="" then
				Win_ShowMsgBox("请您输入职位名称!");
				elseif title=="新增职位" then
				DefinePosFamily(jobname,right); 
				Win_ShowWidget("UI.gameui.jobrightdlg",false);
				else
				UpdatePosFamily(jobname,right);
				Win_ShowWidget("UI.gameui.jobrightdlg",false);
				end;			  
				
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.jobrightdlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.jobrightdlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.jobrightdlg",false);				     
			     end;
			     
			children=
			{
			
				closebtn=
				{
					type="BUTTON",
					rect={238,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 217,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("职位");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				nameedit=
				{
					type="EDIT",
					rect={44,78,200,12},						
					textstyle=dt_left+dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12;
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=30,										
				},

				
				descriptedit=
				{
					type="MULTIEDIT",
					rect={41,263,214,86},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					textstyle=dt_left,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={223,197,146, 255},
					editable=0,
				};
				
				rightlist=
				{
					type="WIDGETLIST",
					rect={42,120,185,119},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,					
					itemmarginh=0,
					itemmarginv=0,

					primaryscroll="UI.gameui.jobrightdlg.rightscroll",
					template={"res/uires/jobrightitem.lua"};
					
					children={},
					
				},--list
				
				rightscroll=
				{
			
					type="SCROLLBAR",
					rect={227,137,20,83},		
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.jobrightdlg.rightlist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",							
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll	
				
				affirmbtn=
				{
					type="BUTTON",
					rect={44,353,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={169,353,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			},
			
		};
		
		--caption="授予职位",
		jobofferdlg=
		{
			type="DIALOG",
			rect={0,0,299,238},
			bkimage="res/uires/family/jobcustomdlg.gsa",
			adornpic={"res/uires/family/title_jobofferdlg.gsa"},
			adornpicpos={{106,17}},
			moveable=1,	
			style=wgtstyle_topmost,
			visible=0,	
			updatemute=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				
				num,customnum,cannum=GetPosNumFamily();
				oldsel=Win_GetSelect("UI.gameui.jobofferdlg.offerlist",0);
				
				if oldsel>=cannum then
				oldsel=cannum-1;
				end;
				
				if oldsel<0 then
				oldsel=0;
				end;
				
				Win_SetValue("UI.gameui.jobofferdlg.offerlist",cannum,value_channel_item_num);
				Win_SetSelect("UI.gameui.jobofferdlg.offerlist",0,oldsel);
				
				Win_EnableWidget("UI.gameui.jobofferdlg.affirmbtn",(cannum>0));
				
				Win_SetFocus("UI.gameui.jobofferdlg");
				end;
			
			OnOk=function()
				local name=Win_GetText("UI.gameui.jobofferdlg",value_channel_customname);
				if name~="" then								
				cursel=Win_GetSelect("UI.gameui.jobofferdlg.offerlist",0);
				if cursel>-1 then
				wgtpath="UI.gameui.jobofferdlg.offerlist.jobofferitem"..cursel;
				if Win_IsExist(wgtpath) then
				jobname=Win_GetText(wgtpath..".jobname");
				if jobname~="" then
				ConferPosFamily(name,jobname);				
				end;
				end;
				end;				
				end;
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={271,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 249,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("职位");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={55,206,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={186,206,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				offerlist=
				{
					type="WIDGETLIST",
					rect={34,68,233,133},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,
					extendstyle=wgtlist_style_wheel+wgtlist_style_enum_item,					
					itemmarginh=0,
					itemmarginv=0,

					primaryscroll="UI.gameui.jobofferdlg.offerscroll",
					template={"res/uires/jobofferitem.lua"};
					
					children={},
					
				},--list
				
				offerscroll=
				{
			
					type="SCROLLBAR",
					rect={266,86,20,95},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.jobofferdlg.offerlist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
						};--spindown
						
					};--children
					
				};--scroll				
				
			};
			
		};		
		
		--财产安全
		--设定财产安全锁密码
		fortunepswsetdlg=
		{
		
			type="DIALOG",
			rect={0,0,319,210},
			bkimage="res/uires/fortunedlg/fortunedlg.gsa",
			captionrect={80,10,162,18},
			caption="设定财产安全锁密码",
			textstyle=dt_center,
			textsize=12,
			textfont=1,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fortunepswsetdlg",false);
				end;
			
			OnOk=function()
				local npara=Win_GetValue("UI.gameui.fortunepswsetdlg",value_channel_customid);
				local editwgt1="UI.gameui.fortunepswsetdlg.pswedit";
				local editwgt2="UI.gameui.fortunepswsetdlg.confirmpswedit";
				local editwgtvalue1=Win_GetValue("UI.gameui.fortunepswsetdlg.pswedit",value_channel_captionsize);
				local editwgtvalue2=Win_GetValue("UI.gameui.fortunepswsetdlg.confirmpswedit",value_channel_captionsize);
				
				if (editwgtvalue1 > 5)  and  (editwgtvalue2 > 5) and (editwgtvalue1 < 13)  and  (editwgtvalue2 < 13) then 
				SetSecuLock(npara,editwgt1,editwgt2);				
				Win_ShowWidget("UI.gameui.fortunepswsetdlg",false);
				else
				Win_ShowMsgBox("密码长度不正确，请输入6-12位密码");
				Win_SetText("UI.gameui.fortunepswsetdlg.pswedit","");
				Win_SetText("UI.gameui.fortunepswsetdlg.confirmpswedit","");
				end;
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.fortunepswsetdlg",true);
				end;
				
			OnSelfShow=function()
				StartLocalOnceCheck();
				EnableKeyCrypt(1);
				Win_SetFocus("UI.gameui.fortunepswsetdlg.pswedit");
				end;
			
			OnTab=function()
				if Win_IsFocused("UI.gameui.fortunepswsetdlg.pswedit") then
				Win_SetFocus("UI.gameui.fortunepswsetdlg.confirmpswedit");
				else
				Win_SetFocus("UI.gameui.fortunepswsetdlg.pswedit");
				end;
				end;
				
			OnSelfHide=function()
				EnableKeyCrypt(0);
				Win_SetText("UI.gameui.fortunepswsetdlg.pswedit", "");
				Win_SetText("UI.gameui.fortunepswsetdlg.confirmpswedit", "");
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswsetdlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswsetdlg");
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={284,5,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				pswlabel=
				{
					type="LABEL",
					captionrect={34,45,250,33},
					caption="欢迎设定“财产安全锁”密码！请输入6－12位\n字符的字母和数字组合：",
					textsize=12,
					rowspace=4,
				},
				
				confirmpswlabel=
				{
					type="LABEL",
					captionrect={32,108,250,33},--{37,108,240,24},
					caption="请再次输入以确定您的“财产安全锁”密码：",
					textsize=12,
					rowspace=4,
					
				},
				
				pswedit=
				{
					type="EDIT",
					rect={42,83,151,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswsetdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				confirmpswedit=
				{
					type="EDIT",
					rect={42,139,151,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswsetdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={61,179,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={188,179,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			};
		};
		
		--修改财产安全锁密码
		fortunepswchangedlg=
		{
			type="DIALOG",
			rect={0,0,319,210},
			bkimage="res/uires/fortunedlg/fortunedlg.gsa",
			captionrect={80,10,162,18},
			caption="修改财产安全锁密码",
			textstyle=dt_center,
			textsize=12,
			textfont=1,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fortunepswchangedlg",false);
				end;
			
			OnOk=function()
				local npara=Win_GetValue("UI.gameui.fortunepswchangedlg",value_channel_customid);
				local editwgt1="UI.gameui.fortunepswchangedlg.oldpswedit";
				local editwgt2="UI.gameui.fortunepswchangedlg.newpswedit";
				local editwgt3="UI.gameui.fortunepswchangedlg.confirmnewpswedit";
				
				local editwgtvalue1=Win_GetValue("UI.gameui.fortunepswchangedlg.oldpswedit",value_channel_captionsize);
				local editwgtvalue2=Win_GetValue("UI.gameui.fortunepswchangedlg.newpswedit",value_channel_captionsize);
				local editwgtvalue3=Win_GetValue("UI.gameui.fortunepswchangedlg.confirmnewpswedit",value_channel_captionsize);
				
				if (editwgtvalue1 > 5)  and  (editwgtvalue2 > 5) and  (editwgtvalue3 > 5) 
				   and (editwgtvalue1 < 13)  and  (editwgtvalue2 < 13) and  (editwgtvalue3 < 13) then 
				ResetSecuLock(npara,editwgt1,editwgt2,editwgt3);
				Win_ShowWidget("UI.gameui.fortunepswchangedlg",false);
				else
				Win_ShowMsgBox("密码长度不正确，请输入6-12位密码");
				Win_SetText("UI.gameui.fortunepswchangedlg.oldpswedit","");
				Win_SetText("UI.gameui.fortunepswchangedlg.newpswedit","");
				Win_SetText("UI.gameui.fortunepswchangedlg.confirmnewpswedit","");
				end;
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.fortunepswchangedlg",true);
				end;
				
			OnSelfShow=function()
				StartLocalOnceCheck();
				EnableKeyCrypt(1);
				Win_SetFocus("UI.gameui.fortunepswchangedlg.oldpswedit");
				end;
			
			OnTab=function()
				if Win_IsFocused("UI.gameui.fortunepswchangedlg.oldpswedit") then
				Win_SetFocus("UI.gameui.fortunepswchangedlg.newpswedit");
				else if Win_IsFocused("UI.gameui.fortunepswchangedlg.newpswedit") then
				Win_SetFocus("UI.gameui.fortunepswchangedlg.confirmnewpswedit");
				else
				Win_SetFocus("UI.gameui.fortunepswchangedlg.oldpswedit");
				end;
				end;
				end;
				
			OnSelfHide=function()
				EnableKeyCrypt(0);
				Win_SetText("UI.gameui.fortunepswchangedlg.oldpswedit","");
				Win_SetText("UI.gameui.fortunepswchangedlg.newpswedit", "");
				Win_SetText("UI.gameui.fortunepswchangedlg.confirmnewpswedit", "");
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswchangedlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswchangedlg");
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={284,5,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				oldpswlabel=
				{
					type="LABEL",
					captionrect={34,37,240,33},
					caption="请输入现有的“财产安全锁”密码(6-12位)：",
					textsize=12,
					rowspace=4,
				},
				
				newpswlabel=
				{
					type="LABEL",
					captionrect={34,79,228,33},
					caption="请输入新的“财产安全锁”密码(6-12位)：",
					textsize=12,
					rowspace=4,
					
				},
				
				confirmnewpswlabel=
				{
					type="LABEL",
					captionrect={34,121,168,33},
					caption="请再次输入新的密码(6-12位)：",
					textsize=12,
					rowspace=4,
				},
				
				oldpswedit=
				{
					type="EDIT",
					rect={41,63,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswchangedlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				newpswedit=
				{
					type="EDIT",
					rect={41,105,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswchangedlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				confirmnewpswedit=
				{
					type="EDIT",
					rect={41,147,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswchangedlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={61,179,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={188,179,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			};
		};
		
		--输入财产安全锁密码
		fortunepswinputdlg=
		{
			type="DIALOG",
			rect={0,0,319,210},
			bkimage="res/uires/fortunedlg/fortunedlg.gsa",
			captionrect={80,10,162,18},
			caption="申请离线后自动锁定角色",
			textstyle=dt_center,
			textsize=12,
			textfont=1,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fortunepswinputdlg",false);
				local npara=Win_GetValue("UI.gameui.fortunepswinputdlg",value_channel_customid);
				VerifySecuLock(npara,0);
				end;

				
			OnOk=function()
				local npara=Win_GetValue("UI.gameui.fortunepswinputdlg",value_channel_customid);
				local editwgtvalue=Win_GetValue("UI.gameui.fortunepswinputdlg.fortunepswedit",value_channel_captionsize);
				
				if (editwgtvalue > 5) and (editwgtvalue < 13) then 
				VerifySecuLock(npara,1,"UI.gameui.fortunepswinputdlg.fortunepswedit");
				Win_ShowWidget("UI.gameui.fortunepswinputdlg",false);
				else
				Win_ShowMsgBox("密码长度不正确，请输入6-12位密码");
				Win_SetText("UI.gameui.fortunepswinputdlg.fortunepswedit","");
				end;
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.fortunepswinputdlg",true);
				end;
				
			OnSelfShow=function()
				StartLocalOnceCheck();
				EnableKeyCrypt(1);
				Win_SetFocus("UI.gameui.fortunepswinputdlg.fortunepswedit");
				end;
			
			OnGainFocus=function()
				Win_SetFocus("UI.gameui.fortunepswinputdlg.fortunepswedit");
				end;
				
			OnSelfHide=function()
				EnableKeyCrypt(0);
				Win_SetText("UI.gameui.fortunepswinputdlg.fortunepswedit", "");
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswinputdlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("fortunepswinputdlg");
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={284,5,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				infolabel=
				{
					type="LABEL",
					captionrect={34,47,252,48},
					caption="开通“离线后自动锁定角色”功能后，您的角色在下线之后5分钟会被系统自动锁定。\n请先输入财产安全锁密码，以进行身份确认",
					textsize=12,
					rowspace=4,
					richmode=ui_richmode_all,
				},
								
				fortunepswedit=
				{
					type="EDIT",
					rect={57,120,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",					
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,

					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"fortunepswinputdlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={61,179,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={188,179,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			};
		};

		
		--开通手机保密业务
		mobilesecapplydlg=
		{
			type="DIALOG",
			rect={0,0,319,210},
			bkimage="res/uires/fortunedlg/fortunedlg.gsa",
			captionrect={80,10,162,18},
			caption="开通手机保密业务",
			textstyle=dt_center,
			textsize=12,
			textfont=1,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnOk=function()
				local editwgtvalue1=Win_GetValue("UI.gameui.mobilesecapplydlg.fortunepswedit",value_channel_captionsize);
				local editwgtvalue2=Win_GetValue("UI.gameui.mobilesecapplydlg.confirmcodeedit",value_channel_captionsize);
				
				if ((editwgtvalue1 > 5) and (editwgtvalue2 > 5)) then 
				Win_ShowWidget("UI.gameui.mobilesecapplydlg",false);
				else
				Win_ShowMsgBox("密码长度不正确，请输入6-12位密码");
				Win_SetText("UI.gameui.mobilesecapplydlg.fortunepswedit","");
				Win_SetText("UI.gameui.mobilesecapplydlg.confirmcodeedit","");
				end;
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.mobilesecapplydlg",false);
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.mobilesecapplydlg",true);
				end;
				
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.mobilesecapplydlg.fortunepswedit");
				end;
			
			OnTab=function()
				if Win_IsFocused("UI.gameui.mobilesecapplydlg.fortunepswedit") then
				Win_SetFocus("UI.gameui.mobilesecapplydlg.confirmcodeedit");
				else
				Win_SetFocus("UI.gameui.mobilesecapplydlg.fortunepswedit");
				end;
				end;
				
			OnSelfHide=function()
				Win_SetText("UI.gameui.mobilesecapplydlg.fortunepswedit", "");
				Win_SetText("UI.gameui.mobilesecapplydlg.confirmcodeedit", "");
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("mobilesecapplydlg");
				end;
			
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("mobilesecapplydlg");
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={284,5,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				fortunepswlabel=
				{
					type="LABEL",
					captionrect={34,37,216,33},
					caption="请输入财产安全密码，以进行身份确认：",
					textsize=12,
					rowspace=4,
				},
				
				confirmcodelabel=
				{
					type="LABEL",
					captionrect={34,85,252,48},
					caption="请输入您所接收到的幻想密保验证码，进行角色与手机的绑定：[如需重新获取验证码，请发送短信AAAA到1111111（移动用户）、412414142（联通用户）]",
					textsize=12,
					rowspace=4,
					
				},
				
				fortunepswedit=
				{
					type="EDIT",
					rect={41,62,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"mobilesecapplydlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				confirmcodeedit=
				{
					type="EDIT",
					rect={41,148,155,18},		
					bkimage="res/uires/fortunedlg/fortunepswedit.gsa",	
					bkimagepos={-6,0},
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"mobilesecapplydlg","已达到密码最大长度",2);
								end;
							end;
						end;
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={61,179,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={188,179,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
			};
		};

		stoprecordwgt=
		{
			type="WIDGET",
			rect={250, 200, 315, 145},
			style=wgtstyle_alphawin,
			bkimage="res/uires/gameui/recordwgtbk.gsa",
			textstyle=dt_center+dt_vcenter,
			enable=1,
			visiable=0,
			initlayer=msgbox_layer-1,
			moveable=0,
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.stoprecordwgt");
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={288,18,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				};	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 269,18,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					OnClick=function()
						local helpid=GetHelpID("自由幻想录像");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				stopbtn=
				{
					type = "BUTTON",
					rect = { 30,113,90,22 },
					bkimage="res/uires/gameui/endrecordbtn.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.chatbar.stoprecord", false);
						Win_ShowWidget("UI.gameui.stoprecordwgt", false);
						StopRecord(0);
					end;
				};
				
				stopandsavebtn=
				{
					type="BUTTON",
					rect={ 202, 113, 90, 22},
					bkimage="res/uires/gameui/saverecordbtn.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.chatbar.stoprecord", false);
						Win_ShowWidget("UI.gameui.stoprecordwgt", false);
						StopRecord(1); --参数表示保存
					end;
				};
				
				textlable=
				{
					type="LABEL",
					rect={18, 46 ,277, 50},
					textsize=12,
					caption="    正在录像中, 如果您当前不想录像请点击停止按扭以终止录像; 如果您想保存录像请点击停止并保存按扭.";
				};
			};
		};
		
		--pipo626 宠物经验卡
		petexpcardwgt=
		{
			type="WIDGET",
			rect={58,106,18,18},					
			style=wgtstyle_alphawin,
			dragindex=0,
			dragtype=ui_drag_type_petexpcard,
			tipwidget="UI.gameui.ScrnTooltip",
			--bkimage="res/uires/gameui/petexpbk200.gsa",
			enable=1,
			visiable=0,
		},
		
		--robin 密码卡修改级别dlg， 界面更新2008-08-21
		resetsecucarddlg=
		{
			type="DIALOG",
			rect={0,0,309,407},
			bkimage="res/uires/secu/secucardmodifylevel.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			initlayer=msgbox_layer-1,
			moveable=0,
			visible=0,
			
			OnSelfShow=function()
				StartLocalOnceCheck();
				EnableKeyCrypt(1);
				
				LockPlayer(1);
				local info = GetSecuInfo();
				Win_SetSelect("UI.gameui.resetsecucarddlg",0,info.level);
				
				for i=1, 8 do
					Win_SetText("UI.gameui.resetsecucarddlg.edit"..i, "");
				end;
				Win_SetFocus("UI.gameui.resetsecucarddlg.edit1");	
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.resetsecucarddlg",false);
			end;
				
			OnOk=function()
				local pwdtext = "";
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit1")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit2")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit3")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit4")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit5")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit6")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit7")
				pwdtext = pwdtext..Win_GetText("UI.gameui.resetsecucarddlg.edit8");
				
				if pwdtext == "" then
					Win_ShowMsgBox("请输入正确的密码卡信息!","系统消息",ui_msgid_default,"UI.gameui.resetsecucarddlg");
					return;
				end;
				
				local info = GetSecuInfo();
				local sel = Win_GetSelect("UI.gameui.resetsecucarddlg",0);
				if sel == info.level then
					Win_ShowMsgBox("请更改您的财产安全锁等级!","系统消息",ui_msgid_default,"UI.gameui.resetsecucarddlg");
					return;
				else
					ResetSecuCardData(sel, pwdtext);
				end;	
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
				EnableKeyCrypt(0);
			end;
			
			
			children=
			{
				level1= 
				{
					type = "CHECK",
					rect={70,202,63,18};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
				};
				
				level2= 
				{
					type = "CHECK",
					rect={70,255,63,18};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
				};
				
				level3= 
				{
					type = "CHECK",
					rect={70,310,113,18};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
				};
				
				
				label1=
				{
					type="LABEL",
					rect={98,121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label2=
				{
					type="LABEL",
					rect={123, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label3=
				{
					type="LABEL",
					rect={148, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label4=
				{
					type="LABEL",
					rect={174, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label5=
				{
					type="LABEL",
					rect={198, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label6=
				{
					type="LABEL",
					rect={223, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label7=
				{
					type="LABEL",
					rect={249, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				label8=
				{
					type="LABEL",
					rect={273, 121, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					caption="2A",
					enable=1,
				};
				
				edit1=
				{
					type = "EDIT",
					rect={98, 159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit2");
								end;
							end;
						return 0;
						end;
				};
				edit2=
				{
					type = "EDIT",
					rect={123,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit3");
								end;
							end;
						return 0;
						end;
				};
				edit3=
				{
					type = "EDIT",
					rect={148,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit4");
								end;
							end;
						return 0;
						end;
				};
				edit4=
				{
					type = "EDIT",
					rect={174,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit5");
								end;
							end;
						return 0;
						end;
				};
				edit5=
				{
					type = "EDIT",
					rect={198,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit6");
								end;
							end;
						return 0;
						end;
				};
				edit6=
				{
					type = "EDIT",
					rect={223,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit7");
								end;
							end;
						return 0;
						end;
				};
				edit7=
				{
					type = "EDIT",
					rect={249,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.resetsecucarddlg.edit8");
								end;
							end;
						return 0;
						end;
				};
				edit8=
				{
					type = "EDIT",
					rect={273,159,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={193,372,86,24},
					bkimage="res/uires/secu/cancelbtn.gsa",
					defaultcancel=1,
				};
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={279,19,22,23};
					defaultcancel=1,					
				};
				
				completebtn=
				{
					type="BUTTON",
					rect={52,372,86,24},
					bkimage="res/uires/secu/completebtn.gsa",
					defaultok=1,
				};
				
			};
		};
		
		--密保卡下解除操作锁定。 界面更新 2008-08-21
		inputsecucarddlg=
		{
			type="DIALOG",
			rect={0,0,309,184},
			bkimage="res/uires/secu/inputsecucardbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=0,
			visible=0,
			initlayer=msgbox_layer-2,
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.inputsecucarddlg",false);
			end;
				
			OnOk=function()
				local pwdtext = "";
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit1")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit2")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit3")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit4")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit5")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit6")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit7")
				pwdtext = pwdtext..Win_GetText("UI.gameui.inputsecucarddlg.edit8");
			
				if pwdtext == "" then
					Win_ShowMsgBox("请输入正确的密码卡信息!","系统消息",ui_msgid_default,"UI.gameui.inputsecucarddlg");
					return;
				end;
				
				SendSecuCardData(pwdtext);
			end;
			
			OnSelfShow=function()
				StartLocalOnceCheck();
				EnableKeyCrypt(1);
				
				Win_SetCapture("UI.gameui.inputsecucarddlg");
				for i=1, 8 do
					Win_SetText("UI.gameui.inputsecucarddlg.edit"..i, "");
				end;
				Win_SetFocus("UI.gameui.inputsecucarddlg.edit1");		
			end;
			
			OnSelfHide=function()
				--LockPlayer(0);
				EnableKeyCrypt(0);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={280,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="关闭",
				};	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 234,10,20,19 },
					visible=0;
					bkimage="res/uires/gameui/helpicon.gsa",
					OnClick=function()
						local helpid=GetHelpID("解除操作锁定");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={49,150,86,24},
					bkimage="res/uires/secu/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={191,150,86,24},
					bkimage="res/uires/secu/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				};
				
				edit1=
				{
					type = "EDIT",
					rect={98,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit2");
								end;
							end;
						return 0;
						end;
				};
				edit2=
				{
					type = "EDIT",
					rect={124,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit3");
								end;
							end;
						return 0;
						end;
				};
				edit3=
				{
					type = "EDIT",
					rect={149,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit4");
								end;
							end;
						return 0;
						end;
				};
				edit4=
				{
					type = "EDIT",
					rect={174,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit5");
								end;
							end;
						return 0;
						end;
				};
				edit5=
				{
					type = "EDIT",
					rect={198,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit6");
								end;
							end;
						return 0;
						end;
				};
				edit6=
				{
					type = "EDIT",
					rect={224,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit7");
								end;
							end;
						return 0;
						end;
				};
				edit7=
				{
					type = "EDIT",
					rect={249,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 1 then
								Win_SetFocus("UI.gameui.inputsecucarddlg.edit8");
								end;
							end;
						return 0;
						end;
				};
				edit8=
				{
					type = "EDIT",
					rect={274,120,20,12},
					captionrect={4,0,20,12},
					editmethod=ui_editmethod_number,
					textsize=12,
					maxchar=2,
				};
				
				label1=
				{
					type="LABEL",
					rect={98, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label2=
				{
					type="LABEL",
					rect={124, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label3=
				{
					type="LABEL",
					rect={149, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label4=
				{
					type="LABEL",
					rect={174, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label5=
				{
					type="LABEL",
					rect={198, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label6=
				{
					type="LABEL",
					rect={224, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label7=
				{
					type="LABEL",
					rect={249, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
				label8=
				{
					type="LABEL",
					rect={274, 83, 20, 12},
					textsize=12,	
					textstyle=dt_center,
					enable=1,
				};
			};
		};
		
		--点卡寄售
		--实体卡寄售
		consignrealcarddlg=
		{
			type="DIALOG",
			rect={0,0,397,415},
			bkimage="res/uires/cardconsign/carddlg.gsa",
			adornpic={"res/uires/cardconsign/realcarddlg_title.gsa", "res/uires/cardconsign/realcarddlg.gsa"},
			adornpicpos={{163,19}, {32,308}},
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnMsgBoxCancel=function()				
				Win_SetFocus("UI.gameui.consignrealcarddlg.cardidedit");
				end;
			
			OnMsgBoxOk=function()
				local gold=Win_GetValue("UI.gameui.consignrealcarddlg.goldedit");
				local silver=Win_GetValue("UI.gameui.consignrealcarddlg.silveredit");
				local copper=Win_GetValue("UI.gameui.consignrealcarddlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				
				local cardid=Win_GetValue("UI.gameui.consignrealcarddlg.cardidedit");				
				EndConsign(0,true,money,cardid,"UI.gameui.consignrealcarddlg.cardpwdedit");
				Win_ShowWidget("UI.gameui.consignrealcarddlg",false);
				end;
			
			OnSelfHide=function()
				EndConsign(0,false);
				
				UI.children.gameui.children.SysInputTip.OnCloseByName("consignrealcarddlg");
				end;
				
			OnClick=function()
				UI.children.gameui.children.SysInputTip.OnCloseByName("consignrealcarddlg");
				end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.consignrealcarddlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.consignrealcarddlg.goldedit",0);
				Win_SetValue("UI.gameui.consignrealcarddlg.silveredit",0);
				Win_SetValue("UI.gameui.consignrealcarddlg.copperedit",0);
				Win_SetFocus("UI.gameui.consignrealcarddlg.goldedit");
				end;
				
			OnOk=function()
				local gold=Win_GetValue("UI.gameui.consignrealcarddlg.goldedit");
				local silver=Win_GetValue("UI.gameui.consignrealcarddlg.silveredit");
				local copper=Win_GetValue("UI.gameui.consignrealcarddlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				local mymoney=GetMoney();
				
				local totalfee=money/100;
				if totalfee<2000 then 
				totalfee=2000;
				elseif totalfee>50000 then 
				totalfee=50000; 
				end;
				
				local cardid=Win_GetText("UI.gameui.consignrealcarddlg.cardidedit");
				local cardpwd=Win_GetText("UI.gameui.consignrealcarddlg.cardpwdedit");
				local cardidlen=string.len(cardid);
				local cardpwdlen=string.len(cardpwd);
				local num,svrnum,newnum,sysnum=GetNumMail();
				
				if money>100000000 then
				Win_ShowMsgBox("很抱歉！您设定的寄售价格超出上限/C22100个金币/C00。请重新设定！","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.affirmbtn");
				elseif money==0 then
				Win_ShowMsgBox("很抱歉！寄售价格不能设置为0。请重新设定！","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.goldedit");
				elseif mymoney<totalfee then
				Win_ShowMsgBox("很抱歉！您身上的钱不够支付寄售押金！","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.closebtn");
				elseif cardidlen<8 then
				Win_ShowMsgBox("抱歉！实体卡的号码位数分为8位与9位两种,请确保您输入的号码与卡上的号码完全一致!","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.cardidedit");
				elseif cardpwdlen<12 then
				Win_ShowMsgBox("很抱歉！您输入的密码不是12位数字!","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.cardpwdedit");
				elseif sysnum>=30 then
				Win_ShowMsgBox("您的邮箱中已经有30封未阅读的系统邮件了，系统向您送出的新邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_default,"UI.gameui.consignrealcarddlg.closebtn");
				elseif sysnum>=25 then
				Win_ShowMsgBox("您的邮箱中有大量的未读系统邮件，您可携带的系统邮件为30封，在30封以后，系统向您送出的邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_yesno,"UI.gameui.consignrealcarddlg");
				else				
				Win_ShowMsgBox("请确定您输入的寄售价格是否正确？","系统消息",ui_msgid_yesno,"UI.gameui.consignrealcarddlg");
				end;
				end;
				
			OnCancel=function()				
				Win_ShowWidget("UI.gameui.consignrealcarddlg",false);				
				end;		
						
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={367,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					
					OnMsgBoxCancel=function()
						Win_ShowWidget("UI.gameui.consignrealcarddlg",false);
						end;
				},	
				
				affirmbtn=
				{
					type="BUTTON",
					rect={291,323,86,24},
					bkimage="res/uires/newcommon/affirmsmallbtn.gsa",
					defaultok=1,
					soundid={1005},	

					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.goldedit");
						end;		
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={291,366,86,24},
					bkimage="res/uires/newcommon/cancelsmallbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				cardidedit=
				{
					type="EDIT",
					rect={99,321,165,18},
					captionrect={0,2,165,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,
					textsize=12,
					maxchar=9,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.cardidedit");
						end;
					
					OnTab=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.cardpwdedit");
						end;
				},
				
				cardpwdedit=
				{
					type="EDIT",
					rect={99,347,165,18},
					captionrect={0,2,165,12},
					editmethod=ui_editmethod_number+ui_editmethod_coder,
					textsize=12,
					maxchar=12,
					
					OnChar=function()
						local widgetpath = Win_GetHotPath();
						if widgetpath ~= "" then
							local size = Win_GetValue(widgetpath,value_channel_captionsize);
							if size >= 12 then
								UI.children.gameui.children.SysInputTip.OnOpenInputTip(widgetpath,"consignrealcarddlg","已达到密码最大长度",2);
								end;
							end;
						end;
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.cardpwdedit");
						end;
					
					OnTab=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.goldedit");
						end;
				},
				
				goldedit=
				{
					type="EDIT",
					rect={111,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=9999,
					minvalue=0,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.goldedit");
						end;
					
					OnTab=function()
						Win_SetFocus("UI.gameui.consignrealcarddlg.silveredit");
						end;
					
				},
				
				silveredit=
				{
					type="EDIT",
					rect={158,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.consignrealcarddlg.copperedit");
						   end;					
					
				},
				
				copperedit=
				{
					type="EDIT",
					rect={206,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.consignrealcarddlg.cardidedit");
						   end;
				},
				
				label1=
				{
					type="LABEL",
					rect={43,54,331,245},
					caption="/C18在您开始寄售之前，请留意以下的温馨提示：\n1、点卡寄售会收取1%的押金（不足2个银币时，按2个银币收取；超过50个银币时，按50个银币收取）。如果寄售物品成功卖出，押金会予以退还。\n2、点击寄售有一定时限，如果超过6小时仍然无人购买，则寄售失败，点卡会退还给您。\n3、点卡的寄售价格上限为100金，请设定一个合理的寄售价格，这样有利于提高寄售的成功率。在寄售之前，您可以参考交易平台上的市价。\n4、点卡交易平台容量有限，如果容量已满，则无法接受新的寄售申请。\n/C25特别提示：\n每位玩家身上可携带的金钱数量有限的，超出的部分会在下线5分钟后消失。\n现在，请输入卡号、密码和寄售价格，开始寄售吧！请注意保管好您的卡号和密码。";
					richmode=ui_richmode_color,
					enable=0,
					textsize=12,
					textstyle=dt_left;
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					rowspace=3;
				}
			};
		};
		
		--绑定卡寄售
		consignbindcarddlg=
		{
			type="DIALOG",
			rect={0,0,397,415},
			bkimage="res/uires/cardconsign/carddlg.gsa",
			adornpic={"res/uires/cardconsign/bindcarddlg_title.gsa", "res/uires/cardconsign/bindcarddlg.gsa"},
			adornpicpos={{163,19}, {32,308}},
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.consignbindcarddlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",0);
				Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",0);
				Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",0);
				
				local nIdx=-1;
				local i=0;
				for i=0,4 do
				local money=GetConsignPrice(1,i);
				Win_EnableWidget("UI.gameui.consignbindcarddlg.cardbtn"..i,(money>0));
				if money>0 then
				nIdx=i;
				end;
				end;
				
				Win_SetSelect("UI.gameui.consignbindcarddlg",0,nIdx);
				Win_EnableWidget("UI.gameui.consignbindcarddlg.affirmbtn",(nIdx>=0));
				Win_EnableWidget("UI.gameui.consignbindcarddlg.goldedit",(nIdx>=0));
				Win_EnableWidget("UI.gameui.consignbindcarddlg.silveredit",(nIdx>=0));
				Win_EnableWidget("UI.gameui.consignbindcarddlg.copperedit",(nIdx>=0));
								
				Win_SetFocus("UI.gameui.consignbindcarddlg.goldedit");
				end;
			
			OnSelfHide=function()
				EndConsign(1,false);
				end;
			
			OnMsgBoxCancel=function()				
				Win_SetFocus("UI.gameui.consignbindcarddlg.goldedit");
				end;
						
			OnMsgBoxOk=function()
				local gold=Win_GetValue("UI.gameui.consignbindcarddlg.goldedit");
				local silver=Win_GetValue("UI.gameui.consignbindcarddlg.silveredit");
				local copper=Win_GetValue("UI.gameui.consignbindcarddlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				
				local cursel=Win_GetSelect("UI.gameui.consignbindcarddlg",0);
				EndConsign(1,true,money,cursel);
				Win_ShowWidget("UI.gameui.consignbindcarddlg",false);
				end;
			
			OnOk=function()
				if Win_IsEnabled("UI.gameui.consignbindcarddlg.affirmbtn") then
				local gold=Win_GetValue("UI.gameui.consignbindcarddlg.goldedit");
				local silver=Win_GetValue("UI.gameui.consignbindcarddlg.silveredit");
				local copper=Win_GetValue("UI.gameui.consignbindcarddlg.copperedit");
				local money=gold*1000000+silver*1000+copper;
				local mymoney=GetMoney();
				local num,svrnum,newnum,sysnum=GetNumMail();
				
				local totalfee=money/100;
				if totalfee<2000 then 
				totalfee=2000;
				elseif totalfee>50000 then 
				totalfee=50000; 
				end;
				
				if money>100000000 then
				Win_ShowMsgBox("很抱歉！您设定的寄售价格超出上限/C22100个金币/C00。请重新设定！","系统消息",ui_msgid_default,"UI.gameui.consignbindcarddlg.affirmbtn");
				elseif money==0 then
				Win_ShowMsgBox("很抱歉！寄售价格不能设置为0。请重新设定！","系统消息",ui_msgid_default,"UI.gameui.consignbindcarddlg.goldedit");
				elseif mymoney<totalfee then
				Win_ShowMsgBox("很抱歉！您身上的钱不够支付寄售押金！","系统消息",ui_msgid_default,"UI.gameui.consignbindcarddlg.closebtn");
				elseif sysnum>=30 then
				Win_ShowMsgBox("您的邮箱中已经有30封未阅读的系统邮件了，系统向您送出的新邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_default,"UI.gameui.consignbindcarddlg.closebtn");				
				elseif sysnum>=25 then
				Win_ShowMsgBox("您的邮箱中有大量的未读系统邮件，您可携带的系统邮件为30封，在30封以后，系统向您送出的邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_yesno,"UI.gameui.consignbindcarddlg");
				else			
				Win_ShowMsgBox("请确定您输入的寄售价格是否正确？","系统消息",ui_msgid_yesno,"UI.gameui.consignbindcarddlg");
				end;
				end;
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.consignbindcarddlg",false);
				end;
						
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={367,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					
					OnMsgBoxCancel=function()
						Win_ShowWidget("UI.gameui.consignbindcarddlg",false);
						end;
				},	
				
				affirmbtn=
				{
					type="BUTTON",
					rect={291,323,86,24},
					bkimage="res/uires/newcommon/affirmsmallbtn.gsa",
					defaultok=1,
					soundid={1005},	

					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignbindcarddlg.goldedit");
						end;						
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={291,366,86,24},
					bkimage="res/uires/newcommon/cancelsmallbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				
				cardbtn0=
				{
					type="CHECK",
					rect={79,319,32,32},
					style=wgtstyle_renderitem,
					extendstyle=ui_btn_style_radio;
					dragtype=ui_drag_type_consign_acccard,
					dragindex=0,
					groupid=0,
					groupstop=0,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local money=GetConsignPrice(1,0);
						local gold=math.floor(money/1000000);
						local silver=math.floor((money-gold*1000000)/1000);
						local copper=money-gold*1000000-silver*1000;
						Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",gold);
						Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",silver);
						Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",copper);						
						end;
						end;		
				};
				
				cardbtn1=
				{
					type="CHECK",
					rect={118,319,32,32},
					style=wgtstyle_renderitem,
					extendstyle=ui_btn_style_radio;
					dragtype=ui_drag_type_consign_acccard,
					dragindex=1,
					groupid=0,
					groupstop=1,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local money=GetConsignPrice(1,1);
						local gold=math.floor(money/1000000);
						local silver=math.floor((money-gold*1000000)/1000);
						local copper=money-gold*1000000-silver*1000;
						Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",gold);
						Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",silver);
						Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",copper);						
						end;
						end;
				};
				
				cardbtn2=
				{
					type="CHECK",
					rect={157,319,32,32},
					style=wgtstyle_renderitem,
					extendstyle=ui_btn_style_radio;
					dragtype=ui_drag_type_consign_acccard,
					dragindex=2,
					groupid=0,
					groupstop=2,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local money=GetConsignPrice(1,2);
						local gold=math.floor(money/1000000);
						local silver=math.floor((money-gold*1000000)/1000);
						local copper=money-gold*1000000-silver*1000;
						Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",gold);
						Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",silver);
						Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",copper);						
						end;
						end;
				};
				
				cardbtn3=
				{
					type="CHECK",
					rect={196,319,32,32},
					style=wgtstyle_renderitem,
					extendstyle=ui_btn_style_radio;
					dragtype=ui_drag_type_consign_acccard,
					dragindex=3,
					groupid=0,
					groupstop=3,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local money=GetConsignPrice(1,3);
						local gold=math.floor(money/1000000);
						local silver=math.floor((money-gold*1000000)/1000);
						local copper=money-gold*1000000-silver*1000;
						Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",gold);
						Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",silver);
						Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",copper);						
						end;
						end;
				};
				
				cardbtn4=
				{
					type="CHECK",
					rect={236,319,32,32},
					style=wgtstyle_renderitem,
					extendstyle=ui_btn_style_radio;
					dragtype=ui_drag_type_consign_acccard,
					dragindex=4,
					groupid=0,
					groupstop=4,
					
					OnCheck=function(bcheck)
						if bcheck==1 then
						local money=GetConsignPrice(1,4);
						local gold=math.floor(money/1000000);
						local silver=math.floor((money-gold*1000000)/1000);
						local copper=money-gold*1000000-silver*1000;
						Win_SetValue("UI.gameui.consignbindcarddlg.goldedit",gold);
						Win_SetValue("UI.gameui.consignbindcarddlg.silveredit",silver);
						Win_SetValue("UI.gameui.consignbindcarddlg.copperedit",copper);						
						end;
						end;
				};
				
				goldedit=
				{
					type="EDIT",
					rect={103,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=180,
					minvalue=0,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignbindcarddlg.goldedit");
						end;
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.consignbindcarddlg.silveredit");
						   end;
				},
				
				silveredit=
				{
					type="EDIT",
					rect={150,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.consignbindcarddlg.copperedit");
						   end;					
					
				},
				
				copperedit=
				{
					type="EDIT",
					rect={198,378,48,12},
					captionrect={16,0,32,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					editmethod=ui_editmethod_number+ui_editmethod_value,							
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					
					OnTab=function()
						   Win_SetFocus("UI.gameui.consignbindcarddlg.goldedit");
						   end;
				},
				
				label1=
				{
					type="LABEL",
					rect={43,54,331,245},
					caption="/C18在您开始寄售之前，请留意以下的温馨提示：\n1、点卡寄售会收取1%的押金（不足2个银币时，按2个银币收取；超过50个银币时，按50个银币收取）。如果寄售物品成功卖出，押金会予以退还。\n2、点击寄售有一定时限，如果超过6小时仍然无人购买，则寄售失败，点卡会退还给您。\n3、点卡的寄售价格上限为100金，请设定一个合理的寄售价格，这样有利于提高寄售的成功率。在寄售之前，您可以参考交易平台上的市价。\n4、点卡交易平台容量有限，如果容量已满，则无法接受新的寄售申请。\n/C25特别提示：\n每位玩家身上可携带的金钱数量有限的，超出的部分会在下线5分钟后消失。\n游戏中有五种面值的绑定卡，点卡下面对应的是您目前所有的卡数，请选择您想寄售的绑定卡和价格，每次只能寄售一张。";
					richmode=ui_richmode_color,
					enable=0,
					textsize=12,
					textstyle=dt_left;
					bkcolor={0,0,0,0},
					drawcolor={230,176,86,255},					
					rowspace=3;
				}
			};
		};
		
		--点卡寄售
		--caption="点卡交易平台",
		consignpointcarddlg=
		{
			type="DIALOG",
			rect={0,0,292,340},
			bkimage="res/uires/cardconsign/pointcarddlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			moveable=1,
			visible=0,
							
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.consignpointcarddlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.consignpointcarddlg.pageedit",1);
				Win_SetValue("UI.gameui.consignpointcarddlg.list",0,value_channel_indexoffset);
				Win_SetValue("UI.gameui.consignpointcarddlg.list",0,value_channel_sel,1);
				Win_SetFocus("UI.gameui.consignpointcarddlg");
				end;
			
			OnSelfHide=function()
				EndConsign(2,false);
				end;
			
			OnMsgBoxCancel=function()
				Win_SetFocus("UI.gameui.consignpointcarddlg");
				end;
			
			OnMsgBoxOk=function()
				local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
				local sel=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_sel);
				EndConsign(2,true,offset+sel);
				end;
				
			OnOk=function()
				local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
				local sel=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_sel);
				
				local price=0;
				if sel>=0 then
				price=GetConsignPrice(2,offset+sel);
				end;
				
				local mymoney=GetMoney();
				local num,svrnum,newnum,sysnum=GetNumMail();
				
				if price<=0 then
				Win_ShowMsgBox("很抱歉! 您必须选择一个寄售卡!","系统消息",ui_msgid_yesno);
				elseif mymoney<price then
				Win_ShowMsgBox("很抱歉！您身上的钱不够购买这张点卡！","系统消息",ui_msgid_default,"UI.gameui.consignpointcarddlg.closebtn");
				elseif sysnum>=30 then
				Win_ShowMsgBox("您的邮箱中已经有30封未阅读的系统邮件了，系统向您送出的新邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_default,"UI.gameui.consignpointcarddlg.closebtn");								
				elseif sysnum>=25 then
				Win_ShowMsgBox("您的邮箱中有大量的未读系统邮件，您可携带的系统邮件为30封，在30封以后，系统向您送出的邮件将被忽略，请清理邮箱以确保不会因此损失系统向您寄出的财物。","系统消息",ui_msgid_yesno,"UI.gameui.consignpointcarddlg");
				else
				Win_ShowMsgBox("您确认要购买这张寄售卡吗？","系统消息",ui_msgid_yesno,"UI.gameui.consignpointcarddlg");
				end;
				
				end;
				
			OnCancel=function()								
				Win_ShowWidget("UI.gameui.consignpointcarddlg",false);
				end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={264,24,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					updatemute=1,
					
					OnMsgBoxCancel=function()
						Win_SetFocus("UI.gameui.consignpointcarddlg");
						end;
				},	
				
				affirmbtn=
				{
					type="BUTTON",
					rect={212,308,69,24},
					bkimage="res/uires/cardconsign/buybtn.gsa",
					defaultok=1,
					soundid={1005},		
					updatemute=1,
				},
				
				helpbtn=
				{
					type="BUTTON",
					rect={242,24,23,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="游戏帮助",
					updatemute=1,
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("帮助界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				list=
				{
					type="LISTBOX",
					rect={63,60,210,210},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=36,
					itemheight=36,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=25,	
					dragtype=ui_drag_type_consign_list,
					
					tipwidget="UI.gameui.ScrnTooltip",
					
					mornitor={value_channel_indexoffset};
					OnUpdate=function()
						local sel=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_sel);
						if sel>=0 then
						local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
						local page=math.floor(offset/25);
						Win_SetValue("UI.gameui.consignpointcarddlg.pageedit",page+1);												
						local price=GetConsignPrice(2,offset+sel);
						local gold=math.floor(price/1000000);
						local silver=math.floor((price-gold*1000000)/1000);
						local copper=price-gold*1000000-silver*1000;
						Win_SetText("UI.gameui.consignpointcarddlg.goldlabel",gold);
						Win_SetText("UI.gameui.consignpointcarddlg.silverlabel",silver);
						Win_SetText("UI.gameui.consignpointcarddlg.copperlabel",copper);						
						Win_EnableWidget("UI.gameui.consignpointcarddlg.affirmbtn",(price>0));					
						end;
						end;
						
					OnValueChange=function(sel)
						if sel>=0 then
						local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
						local price=GetConsignPrice(2,offset+sel);
						local gold=math.floor(price/1000000);
						local silver=math.floor((price-gold*1000000)/1000);
						local copper=price-gold*1000000-silver*1000;
						Win_SetText("UI.gameui.consignpointcarddlg.goldlabel",gold);
						Win_SetText("UI.gameui.consignpointcarddlg.silverlabel",silver);
						Win_SetText("UI.gameui.consignpointcarddlg.copperlabel",copper);						
						Win_EnableWidget("UI.gameui.consignpointcarddlg.affirmbtn",(price>0));
						end;
						end;
				},
				
				pageupbtn=
				{
					type="BUTTON",
					rect={56,310,42,20},
					bkimage="res/uires/cardconsign/pageupbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
						if offset>=25 then
						offset=offset-25;
						end;
						Win_SetValue("UI.gameui.consignpointcarddlg.list",offset,value_channel_indexoffset);						    						
						end;
				},
				
				pagedownbtn=
				{
					type="BUTTON",
					rect={147,310,42,20},
					bkimage="res/uires/cardconsign/pagedownbtn.gsa",
					updatemute=1,
										
					OnClick=function()
						local offset=Win_GetValue("UI.gameui.consignpointcarddlg.list",value_channel_indexoffset);
						if offset<=75 then
						offset=offset+25;
						end;						
						Win_SetValue("UI.gameui.consignpointcarddlg.list",offset,value_channel_indexoffset);						    						
						end;
				},
				
				pageedit=
				{								
					type="EDIT",
					rect={105,315,38,12},
					drawcolor={230,176,86,255},
					editmethod=ui_editmethod_number+ui_editmethod_value,
					style=wgtstyle_advance,
					enable=0;
					maxvalue=5,
					minvalue=1,
					value=1,
					textsize=12,		
					textstyle=dt_center;
					updatemute=1,
				};
				
				goldlabel=
				{
					type="LABEL",
					rect={102,279,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					drawcolor={230,176,86,255},
					maxvalue=9999,
					minvalue=0,
					enable=0,
					updatemute=1,
				},
				
				silverlabel=
				{
					type="LABEL",
					rect={150,279,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					enable=0,
					updatemute=1,
				},
				
				copperlabel=
				{
					type="LABEL",
					rect={198,279,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					drawcolor={230,176,86,255},					
					maxvalue=999,
					minvalue=0,
					enable=0,
					updatemute=1,
				},
			};
		};

		--充值消息对话框
--[[		oweoptdlg=
		{
			type="DIALOG",
			rect={0,0,413,128},
			bkimage="res/uires/chargedlg/chargedlgbk.gsa",
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_vcenter+alignstyle_hcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			initlayer=msgbox_layer,
			visible=0,	
			updatemute=1,			

			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.oweoptdlg",false);
				end;
				
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.oweoptdlg");
				Win_SetCapture("UI.gameui.oweoptdlg");
				end;
			
			OnSelfHide=function()
				local bNeedShowAdver = Win_GetValue("UI.gameui.oweoptdlg",value_channel_customtype);
				if bNeedShowAdver == 1 then
				Win_SetValue("UI.gameui",10,value_channel_timerspace);
				Win_SetValue("UI.gameui.oweoptdlg",0,value_channel_customtype);
				end;
				end;
			
			children=
			{
				infolabel=
				{
					type="LABEL",
					captionrect={29,18,348,48},
					caption="很抱歉，您已经超过10级，需要通过付费充值，获得足够的点数才能继续游戏。如果确认已充值，请在15分钟后重试。您希望现在就过去充值吗？",
					textsize=12,
					rowspace=4,
				};
			
				gotopagebtn=
				{
					type="BUTTON",
					rect={25,97,107,22},
					bkimage="res/uires/chargedlg/gotopagebtn.gsa",
					soundid={1005},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(1);
						end;
				};
			
				gotoconsignbtn=
				{
					type="BUTTON",
					rect={140,97,107,22},
					bkimage="res/uires/chargedlg/gotoconsignbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(0);						
						end;
				};
			
				chargelaterbtn=
				{
					type="BUTTON",
					rect={293,97,90,22},
					bkimage="res/uires/chargedlg/chargelaterbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(2);						
						end;
				};
			};
		};
		
	]]	
		--新的充值界面
		oweoptdlg=
		{
			type="DIALOG";
			rect={19,83,345,212};
			bkimage="res/uires/chargedlg/oweoptdlgbk.gsa";
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,	
			alignstyle=alignstyle_vcenter+alignstyle_hcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			initlayer=msgbox_layer,
			visible=0,	
			updatemute=1,		
			
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.oweoptdlg",false);
				end;
				
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.oweoptdlg");
				Win_SetCapture("UI.gameui.oweoptdlg");
				end;
			
			OnSelfHide=function()
				local bNeedShowAdver = Win_GetValue("UI.gameui.oweoptdlg",value_channel_customtype);
				if bNeedShowAdver == 1 then
				Win_SetValue("UI.gameui",10,value_channel_timerspace);
				Win_SetValue("UI.gameui.oweoptdlg",0,value_channel_customtype);
				end;
				end;

			children=
			{
				telbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/telbtn.gsa";
					rect={20,157,79,39};
					tiptext="先将电话与QQ号码绑定，然后拨打热线16885887\n（部分地区请以当地号码为准）,为您的QQ幻想\n充值吧！各地热线陆续开通，敬请Q民关注！点\n击将弹出页面。";
					
					OnClick=function()
						EndOweOpt(3);
						end;
				};

				ebankbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/ebankbtn.gsa";
					rect={98,157,79,39};
					tiptext="通过网上银行充值QQ幻想，可以让您足不出户，\n一分钟完成充值，并且还有九折优惠等着您。目\n前支持中国银联银行卡、各种网上银行支付。点\n击将弹出页面。";
					
					OnClick=function()
						EndOweOpt(4);
						end;
				};

				qqcardbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/qqcardbtn.gsa";
					rect={176,157,79,39};
					tiptext="包括三种面值：10元QQ卡(100点Q点数)；15元QQ\n卡(150点Q点数)；30元+2元QQ卡(300+20点Q点数)。\n实物卡可在您身边的便利店、书报亭、软件店垂询\n购买。点击将弹出页面。";
					
					OnClick=function()
						EndOweOpt(5);
						end;
				};

				qbbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/qbbtn.gsa";
					rect={254,157,79,39};
					tiptext="Q哥Q妹可以把QQ个人帐户中的Q币直接兑换成Q点，\n进入QQ幻想美丽的网络世界进行游戏。每个QQ帐\n号可兑换的Q点每个月总额为100点，对应10Q币，\n玩家可根据需要分次或者一次性兑换。点击将弹\n出页面。";
					
					OnClick=function()
						EndOweOpt(6);
						end;
				};
				
				gotoconsignbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/exgotoconsignbtn.gsa";
					rect={28,115,90,22};
					soundid={1005};
					tiptext="当你的帐号没点的时候，你可以选择 “进入寄售\n小岛”，寄售小岛是不扣点的，里面包含仓库管理\n员、点卡交易公证员，以及一个杂货售卖NPC。寄售\n小岛内可以免费摆摊。点击将弹出页面。";
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(0);
						end;
				};

				gotopagebtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/exgotopagebtn.gsa";
					rect={131,115,90,22};
					soundid={1005};
					tiptext="这里有更多的充值方式，以及详尽的说明。\n欢迎点击。";
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(1);
						end;
				};

				chargelaterbtn=
				{
					type="BUTTON";
					bkimage="res/uires/chargedlg/exchargelaterbtn.gsa";
					rect={236,115,90,22};
					soundid={1005};
					tiptext="退回角色选择界面";
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.oweoptdlg",false);
						EndOweOpt(2);
						end;
				};

			};
		};
		
		--公用对话
		facedlg=
		{
			type="DIALOG",
			rect={0,20,129, 148},	
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			
			mornitor={value_channel_visible},
	
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.facedlg")  then
						bdyname=Win_GetText("UI.gameui.facedlg",value_channel_customname);
						if (bdyname~="") then
						btnname=bdyname..".facebtn";						
						if Win_IsChecked(btnname) then
						Win_SetCheck(btnname,false);									
						end;
						end;
					end;
					end;	
			
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.facedlg",false);
				       bdyname=Win_GetText("UI.gameui.facedlg",value_channel_customname);
				       if (bdyname~="") then
				       editname=bdyname..".contentedit";
				       Win_SetFocus(editname);
				       end;
				       end;
					
		
			OnOk=function()
				Win_ShowWidget("UI.gameui.facedlg",false);
				local txt=Win_GetText("UI.gameui.facedlg.facelist",value_channel_seltext);
				local bdyname=Win_GetText("UI.gameui.facedlg",value_channel_customname);
				if (bdyname~="") then				
				local editname=bdyname..".contentedit";
				Win_OnInsert(editname,txt);
				Win_SetFocus(editname);
				end;
				end;
			
			children=
			{
				--上页按钮
				prepagebtn = 
				{
					type = "BUTTON",
					rect = {32, 127, 28, 16 },
					bkimage="res/uires/common/prepage.gsa",					
					extendstyle=ui_btn_style_popupmsg,
					tiptext="上页",	
					updatemute=1,
					
					OnClick=function()
						    local page=Win_GetValue("UI.gameui.facedlg.facelist",value_channel_page_v);
						    Win_SetValue("UI.gameui.facedlg.facelist",page-1,value_channel_page_v);						    
						    end;	
				};
				
				--下页按钮
				nextpagebtn = 
				{
					type = "BUTTON",
					rect = { 96, 127, 28, 16 },
					bkimage="res/uires/common/nextpage.gsa",
					extendstyle=ui_btn_style_popupmsg,
					tiptext="下页",	
					updatemute=1,
					
					OnClick=function()
						    local page=Win_GetValue("UI.gameui.facedlg.facelist",value_channel_page_v);
						    Win_SetValue("UI.gameui.facedlg.facelist",page+1,value_channel_page_v);						    
						    end;				
				};



				pageedit=
				{								
					type="EDIT",
					rect={62,129,32,14},
					captionrect={1,1,30,12},
					drawcolor={255,255,255,255},
					editmethod=ui_editmethod_number+ui_editmethod_value,
					style=wgtstyle_advance,
					editable=0,									
					maxvalue=10,
					minvalue=1,
					value=1,
					textsize=12,
					updatemute=1,
				};
				
				facelist=
				{
					type="LISTBOX",
					rect={4,6,120, 120},	
					
					style=wgtstyle_none,							
					extendstyle=listbox_style_itemheight_fix+listbox_style_richtext,
					richmode=ui_richmode_all,
					richflag=1,
					itemwidth=24,
					itemheight=24,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=156,
					
					itemfocuscolor={0,0,0,0},
					itemseledgecolor={255,255,255,255},
					itemedgecolor={0,0,0,0},
					
					mornitor={value_channel_page_v};
					OnUpdate=function()
						local page=Win_GetValue("UI.gameui.facedlg.facelist",value_channel_page_v);
						Win_SetValue("UI.gameui.facedlg.pageedit",page+1);
						end;
					
					itemtext=
					{
						"/1","/2","/3","/4","/5","/6","/7","/8",
						"/9","/10","/11","/12","/13","/14","/15","/16",
						"/17","/18","/19","/20","/21","/22","/23","/24",
						"/25","/26","/27","/28","/29","/30","/31","/32",
						"/33","/34","/35","/36","/37","/38","/39","/40",
						"/41","/42","/43","/44","/45","/46","/47","/48",
						"/49","/50","/51","/52","/53","/54","/55","/56",
						"/57","/58","/59","/60","/61","/62","/63","/64",
						"/65","/66","/67","/68","/69","/70","/71","/72",
						"/73","/74","/75","/76","/77","/78","/79","/80",
						"/81","/82","/83","/84","/85","/86","/87","/88",
						"/89","/90","/91","/92","/93","/94","/95","/96",
						"/97","/98","/99","/100","/101","/102","/103","/104",
						"/105","/106","/107","/108","/109","/110","/111","/112",
						"/113","/114","/115","/116","/117","/118","/119","/120",
						"/121","/122","/123","/124","/125","/126","/127","/128",
						"/129","/130","/131","/132","/133","/134","/135","/136",
						"/137","/138","/139","/140","/141","/142","/143","/144",
						"/145","/146","/147","/148","/149","/150","/151","/152",
						"/153","/154","/155","/156",
					},
					
					itemtip=
					{
						"惊讶 /jy /C04/1","撇嘴 /pz /C04/2","色 /se /C04/3","发呆 /fd /C04/4","得意 /dy /C04/5","流泪 /ll /C04/6","害羞 /hx /C04/7","闭嘴 /bz /C04/8",
						"睡 /shui /C04/9","大哭 /dk /C04/10","尴尬 /gg /C04/11","发怒 /fn /C04/12","调皮 /tp /C04/13","呲牙 /cy /C04/14","微笑 /wx /C04/15","难过 /ng /C04/16",
						"酷 /kuk /C04/17","非典 /feid /C04/18","抓狂 /zk /C04/19","吐 /tu /C04/20","偷笑 /tx /C04/21","可爱 /ka /C04/22","白眼 /baiy /C04/23","傲慢 /am /C04/24",
						"饥饿 /jie /C04/25","困 /kun /C04/26","惊恐 /jk /C04/27","流汗 /lh /C04/28","憨笑 /hanx /C04/29","大兵 /db /C04/30","奋斗 /fendou /C04/31","咒骂 /zhm /C04/32",
						"疑问 /yiw /C04/33","嘘 /xu /C04/34","晕 /yun /C04/35","折磨 /zhem /C04/36","衰 /shuai /C04/37","骷髅 /kl /C04/38","敲打 /qiao /C04/39","再见 /zj /C04/40",
						"闪人 /shan /C04/41","发抖 /fad /C04/42","爱情 /aiq /C04/43","跳 /tiao /C04/44","找 /zhao /C04/45","美眉 /mm /C04/46","猪头 /zt /C04/47","猫咪 /maom /C04/48",
						"小狗 /xg /C04/49","拥抱 /yb /C04/50","钱 /qianc /C04/51","灯泡 /dp /C04/52","酒杯 /bei /C04/53","蛋糕 /dg /C04/54","闪电 /shd /C04/55","炸弹 /zhd /C04/56",
						"刀 /dao /C04/57","足球 /zq /C04/58","音乐 /yy /C04/59","便便 /bb /C04/60","咖啡 /kf /C04/61","饭 /fan /C04/62","药丸 /yw /C04/63","玫瑰 /mg /C04/64",
						"凋谢 /dx /C04/65","吻 /wen /C04/66","爱心 /xin /C04/67","心碎 /xs /C04/68","会议 /hy /C04/69","礼物 /lw /C04/70","电话 /dh /C04/71","时间 /sj /C04/72",
						"邮件 /yj /C04/73","电视 /ds /C04/74","太阳 /ty /C04/75","月亮 /yl /C04/76","强 /qiang /C04/77","弱 /ruo /C04/78","握手 /ws /C04/79","胜利 /shl /C04/80",
						"多多 /dd /C04/81","美女 /mn /C04/82","汉良 /hl /C04/83","毛毛 /mamao /C04/84","Q仔 /qz /C04/85","飞吻 /fw /C04/86","怄火 /oh /C04/87","白酒 /bj /C04/88",
						"汽水 /qsh /C04/89","西瓜 /xig /C04/90","下雨 /xy /C04/91","多云 /duoy /C04/92","雪人 /xr /C04/93","星星 /xixing /C04/94","女 /nv /C04/95","男 /nan /C04/96",
						"冷汗 /lengh /C04/97","擦汗 /ch /C04/98","抠鼻 /kb /C04/99","鼓掌 /gz /C04/100","糗大了 /qd /C04/101","左哼哼 /zhh /C04/102","右哼哼 /yhh /C04/103","哈欠 /hq /C04/104",
						"鄙视 /bs /C04/105","委屈 /wq /C04/106","快哭了 /kk /C04/107","阴险 /yx /C04/108","亲亲 /qq /C04/109","吓 /xia /C04/110","可怜 /kel /C04/111","菜刀 /cd /C04/112",
						"西瓜 /xig /C04/113","啤酒 /pj /C04/114","篮球 /lq /C04/115","乒乓 /pp /C04/116","咖啡 /kf /C04/117","瓢虫 /pch /C04/118","抱拳 /bq /C04/119","勾引 /gy /C04/120",
						"拳头 /qt /C04/121","差劲 /cj /C04/122","爱你 /aini /C04/123","NO /no /C04/124","OK /ok /C04/125","转圈 /zhq /C04/126","羊眨眼 /yzy /C04/127","羊愤怒 /yfn /C04/128",
						"羊发呆 /yfd /C04/129","羊调皮 /ytp /C04/130","羊忘形 /ywx /C04/131","羊努力 /ynl /C04/132","羊撇嘴 /ypz /C04/133","羊瞌睡 /yks /C04/134","羊抓狂 /yzk /C04/135","羊咆哮 /ypx /C04/136",
						"羊可怜 /ykl /C04/137","羊卖萌 /ymm /C04/138","羊喷嚏 /ypt /C04/139","羊鄙视 /ybs /C04/140","羊开心 /yks /C04/141","羊闭眼 /yby /C04/142","羊星星眼 /yxxy /C04/143","羊痛哭 /ytk /C04/144",
						"羊吐舌 /yts /C04/145","羊天真 /ytz /C04/146","羊鬼脸 /ygl /C04/147","羊阴险 /yyx /C04/148","羊亲亲 /yqq /C04/149","羊黑线 /yhx /C04/150","羊纠结 /yjj /C04/151","羊汗水 /yhs /C04/152",
						"羊惊讶 /yjy /C04/153","羊得意 /ydy /C04/154","羊憨厚 /yhh /C04/155","羊欢迎 /yhy /C04/156",
					},
					
					OnRClick=function()
						       Win_ShowWidget("UI.gameui.facedlg",false);
						       bdyname=Win_GetText("UI.gameui.facedlg",value_channel_customname);
						       if (bdyname~="") then
						       editname=bdyname..".contentedit";
						       Win_SetFocus(editname);
						       end;
						       end;
						       
					OnClick=function()
						Win_EndWidget("UI.gameui.facedlg",true);
						end;
					
					
					
				};
	
			
			};
		
		};

		
		colordlg=
		{
			type="DIALOG",
			rect={200,200,102, 74},	
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,	
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			
			mornitor={value_channel_visible},
	
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.colordlg")  then
						bdyname=Win_GetText("UI.gameui.colordlg",value_channel_customname);
						if (bdyname~="") then
						btnname=bdyname..".colorbtn";						
						if Win_IsChecked(btnname) then
						Win_SetCheck(btnname,false);									
						end;
						end;
					end;
					end;	
			
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.colordlg",false);
				       bdyname=Win_GetText("UI.gameui.colordlg",value_channel_customname);
				       if (bdyname~="") then
				       editname=bdyname..".contentedit";
				       Win_SetFocus(editname);
				       end;
				       end;
			
		
			OnSelfShow=function()
					  num,colors=GetCtrlTextColor();
					  colors[1]=GetColorIndex(255,255,255,255);
					  Win_SetValue("UI.gameui.colordlg.colorlist",num,value_channel_item_num);
					  for i=0,num-1 do					  
					  Win_SetValue("UI.gameui.colordlg.colorlist",colors[i+1],value_channel_itemcolor,i);
					  end;
					  end;
					  
			children=
			{
				colorlist=
				{
					type="LISTBOX",
					rect={6,6,90, 64},	
					style=wgtstyle_none,							
					extendstyle=listbox_style_itemheight_fix+listbox_style_colorlist,					
					itemwidth=22,
					itemheight=10,
					itemmarginh=3,
					itemmarginv=3,
					itemnum=0,
					itemdrawback="res/uires/gameui/coloredge.gsa",
					itemdrawpos={-1,-2,0,0},
					updatemute=1,
					
					OnRClick=function()
						       Win_ShowWidget("UI.gameui.colordlg",false);
						       bdyname=Win_GetText("UI.gameui.colordlg",value_channel_customname);
						       if (bdyname~="") then
						       editname=bdyname..".contentedit";
						       Win_SetFocus(editname);
						       end;
						       end;
						       
					OnValueChange=function(sel)
								 Win_ShowWidget("UI.gameui.colordlg",false);								 
								 bdyname=Win_GetText("UI.gameui.colordlg",value_channel_customname);
								 if (bdyname~="") then
								 editname=bdyname..".contentedit";
								 Win_EditSetColor(editname,sel);
								 Win_SetFocus(editname);
								 end;
								 end;		
				};
			};
		
		};
		
		mandlg=
		{
			type="DIALOG",
			rect={0,0,122,86},	
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
	
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.mandlg")  then
						bdyname=Win_GetText("UI.gameui.mandlg",value_channel_customname);
						if (bdyname~="") then
						btnname=bdyname..".manbtn";						
						if Win_IsChecked(btnname) then
						Win_SetCheck(btnname,false);									
						end;
						end;
					end;
					end;	
			
			
			OnRClick=function()
			       Win_ShowWidget("UI.gameui.mandlg",false);
			       bdyname=Win_GetText("UI.gameui.mandlg",value_channel_customname);
			       if bdyname~="" then
			       editname=bdyname..".manedit";
			       Win_SetFocus(editname);
			       end;
			       end;
					
			OnSelfShow=function()
				bdyname=Win_GetText("UI.gameui.mandlg",value_channel_customname);
				if bdyname~="" then
				editname=bdyname..".manedit";				
				oldtxt=Win_GetText(editname);
				num,names,flags=GmBuddyGetAll(oldtxt);
				Win_SetValue("UI.gameui.mandlg.manlist",num,value_channel_item_num);
				for i=0,num-1 do								
				Win_SetText("UI.gameui.mandlg.manlist",names[i+1],value_channel_itemtext,i);
				if flags[i+1]==1 then
				Win_SetValue("UI.gameui.mandlg.manlist",i,value_channel_sel);
				end;
				end;
				end;
				
				end;			
			
			OnSelfHide=function()
				bdyname=Win_GetText("UI.gameui.mandlg",value_channel_customname);
				if bdyname~="" then
				editname=bdyname..".manedit";
				num,vectxt=Win_GetTable("UI.gameui.mandlg.manlist",value_channel_seltext);
				wholetxt="";
				for i=0,num-1 do
				if i==0 then
				wholetxt=vectxt[i];
				else
				wholetxt=wholetxt..";"..vectxt[i];
				end;
				end;
				Win_SetText(editname,wholetxt);
				Win_SetFocus(editname);				
				end;				
				end;	
				
			children=
			{
				manlist=
				{
					type="LISTBOX",
					rect={0,3,122,80},
					clientrect={14,0,100,80},
					style=wgtstyle_vertical+wgtstyle_popup+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_multi_sel+listbox_style_wheel,	
					textsize=12,
												
					itemnum=0,									
					itemheight=20,
					itemwidth=100,
					itemmarginv=0,
					itemmarginh=0,						
					
					itemselback="res/uires/common/checkbox.gsa",
					itemselpos={-8,0,0,-1},
					
					updatemute=1,
					
					
					OnRClick=function()
						       Win_ShowWidget("UI.gameui.mandlg",false);
						       bdyname=Win_GetText("UI.gameui.mandlg",value_channel_customname);
						       if bdyname~="" then
						       editname=bdyname..".manedit";
						       Win_SetFocus(editname);
						       end;
						       end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,50},
							style=wgtstyle_vertical,					
							bkcolor={255,255,255,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,		
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
					
						};--scroll
					};
				};
			};
		
		};
		
		neighbordlg=
		{
			type="DIALOG",
			rect={0,0,126,128},	
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
	
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.neighbordlg")  then
						bdyname=Win_GetText("UI.gameui.neighbordlg",value_channel_customname);
						if (bdyname~="") then
						btnname=bdyname..".neighborbtn";						
						if Win_IsChecked(btnname) then
						Win_SetCheck(btnname,false);									
						end;
						end;
					end;
					end;	
			
			
			OnRClick=function()
				       Win_ShowWidget("UI.gameui.neighbordlg",false);				       
				       end;
					
			OnSelfShow=function()
				bdyname=Win_GetText("UI.gameui.neighbordlg",value_channel_customname);
				if bdyname~="" then
				editname=bdyname..".neighboredit";
				oldtxt=Win_GetText(editname);
				
				num,names,flags=GetNeighborList(oldtxt);
				Win_SetValue("UI.gameui.neighbordlg.neighborlist",num,value_channel_item_num);
				for i=0,num-1 do		
				Win_SetText("UI.gameui.neighbordlg.neighborlist",names[i+1],value_channel_itemtext,i);
				if flags[i+1]==1 then
				Win_SetValue("UI.gameui.neighbordlg.neighborlist",i,value_channel_sel);
				end;
				end;
				
				end;
				end;	
			
			OnSelfHide=function()
				bdyname=Win_GetText("UI.gameui.neighbordlg",value_channel_customname);
				if bdyname~="" then
				editname=bdyname..".neighboredit";
				num,vectxt=Win_GetTable("UI.gameui.neighbordlg.neighborlist",value_channel_seltext);
				wholetxt="";
				for i=0,num-1 do
				if i==0 then
				wholetxt=vectxt[i];
				else
				wholetxt=wholetxt..";"..vectxt[i];
				end;
				end;
				Win_SetText(editname,wholetxt);
				end;
				end;	
					
			children=
			{
				neighborlist=
				{
					type="LISTBOX",
					rect={5,3,100,122},
					clientrect={12,0,88,122},					
					style=wgtstyle_vertical+wgtstyle_popup+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix+listbox_style_multi_sel,	
												
					itemnum=0,									
					itemheight=20,
					itemwidth=88,
					itemmarginv=0,
					itemmarginh=0,						
					
					itemselback="res/uires/common/checkbox.gsa",
					itemselpos={-12,0,0,-1},
					
					textsize=12,
					
					updatemute=1,
										
					OnRClick=function()
						       Win_ShowWidget("UI.gameui.neighbordlg",false);
						       bdyname=Win_GetText("UI.gameui.neighbordlg",value_channel_customname);
						       if bdyname~="" then
						       editname=bdyname..".neighboredit";
						       Win_SetFocus(editname);
						       end;
						       end;
						       
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,80},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,							
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,	
								};--spindown
								
							};--children
					
						};--scroll
					};
				
				};
			};
		
		};
		
		chaterdlg=
		{
			type="WIDGETLIST",
			rect={0,0,16,16},
			style=wgtstyle_popup+wgtstyle_topmost,
			visible=0,
			sizeable=1,
			edgecheck=edge_check_show+edge_check_auto,
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.chaterdlg")  then											
				if Win_IsChecked("UI.gameui.chatbar.inputbar.chaterbtn") then
				Win_SetCheck("UI.gameui.chatbar.inputbar.chaterbtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()						
				local seltext=Win_GetText("UI.gameui.chatbar.inputbar.chateredit");
				local num,tgts,descs,kwds1,kwds2=GetChatGoal();
				local oldsel=0;				
				
				Win_SetValue("UI.gameui.chaterdlg.chaterlist",num,value_channel_item_num);
				for i=1,num do				
				Win_SetText("UI.gameui.chaterdlg.chaterlist",descs[i],value_channel_itemtext,i-1);
				if seltext==tgts[i] then
				oldsel=i-1;
				end;
				end;				
				
				Win_SetValue("UI.gameui.chaterdlg.chaterlist",oldsel,value_channel_sel);
				
				Win_AlignWidget("UI.gameui.chaterdlg","UI.gameui.chatbar.inputbar.chaterbtn",aligntype_winrect,alignstyle_top_out+alignstyle_left_in,-20,2);
				Win_SetFocus("UI.gameui.chaterdlg.chaterlist");
				Win_AjustSelf("UI.gameui.chaterdlg");
				end;		  
				
			OnOk=function()
				local seltxt="";
				local cursel=Win_GetValue("UI.gameui.chaterdlg.chaterlist",value_channel_sel)+1;
				
				local num,tgts,descs,kwds1,kwds2=GetChatGoal();
				
				for i=1,num do									  						
				if cursel==i then
				seltxt=tgts[i];						
				end;
				end;								
				
				if seltxt~="" then									
				Win_SetText("UI.gameui.chatbar.inputbar.chateredit",seltxt);
				end;						
				Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
				end;		
				
			children=
			{
				chaterlist=
				{
					type="LISTBOX",
					rect={6,3,100,220},					
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
					richmode=ui_richmode_color,
					
					textsize=12,
					ysizeable=1,
						
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
					
					primaryscroll="UI.gameui.chaterdlg.chaterlist.vscroll",
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,
						
					OnClick=function()
						Win_EndWidget("UI.gameui.chaterdlg",true);
						end;
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={0,12,20,68},					
							style=wgtstyle_vertical,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							buddywidget="UI.gameui.chaterdlg.chaterlist",
							minbtnsize=18,
							pagesize=8,
							marginh=1,
							marginv=0,	
							updatemute=1,									

							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
--[[						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,68},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,20},
									bkimage="res/uires/common/slidebtn.gsa",
									bkimagepos={2,0},
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
										
								};--spindown
								
							};--children
					
						};--scroll
						--]]
					};
					
				},--list		
					
			};
		};
		
		findmodedlg=
		{
			type="MENU",
			rect={0,0,98,0},
			style=wgtstyle_popup+wgtstyle_topmost;			
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor = { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			visible=0,
				
			mornitor={value_channel_visible},
			
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.findmodedlg")  then											
				if Win_IsChecked("UI.gameui.masterlistdlg.modebtn") then
				Win_SetCheck("UI.gameui.masterlistdlg.modebtn",false);									
				end;						
				end;
				end;	

			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.findmodedlg","UI.gameui.masterlistdlg.modebtn",aligntype_winrect,alignstyle_top_out+alignstyle_left_in,-40,2);
				Win_SetFocus("UI.gameui.findmodedlg");
				end;	

			children=
			{
				profbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="师父职业",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=0,
					updatemute=1,
				     
					OnClick=function()
						Win_ShowWidget("UI.gameui.findmodedlg",false);
						Win_SetText("UI.gameui.masterlistdlg.modeedit","师父职业");	
						end;
				
				};
				
				levelbtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="师父等级",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
				        groupstop=1,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.findmodedlg",false);
						Win_SetText("UI.gameui.masterlistdlg.modeedit","师父等级");	
						end;
				};
				
				titlebtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="师父称号",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=2,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.findmodedlg",false);
						Win_SetText("UI.gameui.masterlistdlg.modeedit","师父称号");	
						end;
				};
				
				membtn=
				{
					type="BUTTON",
					rect={4,0,90,22},
					captionrect={0,5,90,12},
					textsize=12,
					caption="徒弟人数",
					bkimagepos={0,4},
					bkimage="res/uires/gameui/menubtn.gsa",
					framescheme={{0,0,-1,-1}},
					drawflag=drawflag_hotcaption,
					drawcolor={255,255,255,255},
					focuscolor={255,255,255,255},
					groupstop=3,
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.findmodedlg",false);
						Win_SetText("UI.gameui.masterlistdlg.modeedit","徒弟人数");	
						end;
				};
				
			};
		
		};
		
		filterdlg=
		{
			type="DIALOG",
			rect = {0,0,98,205},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			soundid={-1,-1,-1,-1,1004,1004},
			style=wgtstyle_popup+wgtstyle_topmost,
			
			bkcolor={16,16,16,196},					
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,			
	
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
					
			OnUpdate=function()
					if not Win_IsVisible("UI.gameui.filterdlg")  then
						if Win_IsChecked("UI.gameui.chatbar.filterbtn")  then
						Win_SetCheck("UI.gameui.chatbar.filterbtn",false);									
						end;
					end;
					end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.filterdlg","UI.gameui.chatbar.filterbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,0,-120);
				filterinfo1,filterinfo2,filterinfo3,filterinfo4,filterinfo5,filterinfo6,filterinfo7,filterinfo8,filterinfo9,filterinfo10,filterinfo11,filterinfo12=GetChannelFilter();
								
				--Win_SetCheck("UI.gameui.filterdlg.newbiecheck",(filterinfo3==1));
				Win_SetCheck("UI.gameui.filterdlg.teamcheck",(filterinfo4==1));
				Win_SetCheck("UI.gameui.filterdlg.mastercheck",(filterinfo5==1));
				Win_SetCheck("UI.gameui.filterdlg.unioncheck",(filterinfo6==1));
				Win_SetCheck("UI.gameui.filterdlg.whispercheck",(filterinfo7==1));
				Win_SetCheck("UI.gameui.filterdlg.nearbycheck",(filterinfo8==1));
				Win_SetCheck("UI.gameui.filterdlg.worldcheck",(filterinfo9==1));
				Win_SetCheck("UI.gameui.filterdlg.citycheck",(filterinfo10==1));
				Win_SetCheck("UI.gameui.filterdlg.playersyscheck",(filterinfo11==1));
				Win_SetCheck("UI.gameui.filterdlg.fightteamcheck",(filterinfo12==1));
				end;
				
			OnSelfHide=function(bshow)
				if bshow==1 then				
				local filterinfo1=0;
				local filterinfo2=0;
				local filterinfo3=0;
				local filterinfo4=0;
				local filterinfo5=0;
				local filterinfo6=0;
				local filterinfo7=0;
				local filterinfo8=0;
				local filterinfo9=0;				
				local filterinfo10=0;	
				local filterinfo11=0;	
				local filterinfo12=0;	
				local filterinfo13=0;

				if Win_IsChecked("UI.gameui.filterdlg.playersyscheck") then
					filterinfo11=1;
				end;				
				
				if Win_IsChecked("UI.gameui.filterdlg.citycheck") then
				filterinfo10=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.teamcheck") then
				filterinfo4=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.mastercheck") then
				filterinfo5=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.unioncheck") then
				filterinfo6=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.whispercheck") then
				filterinfo7=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.nearbycheck") then
				filterinfo8=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.worldcheck") then
				filterinfo9=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.fightteamcheck") then
				filterinfo12=1;
				end;
				
				if Win_IsChecked("UI.gameui.filterdlg.matchcheck") then
				filterinfo13=1;
				end;
				
				SetChannelFilter(filterinfo1,filterinfo2,filterinfo3,filterinfo4,filterinfo5,filterinfo6,filterinfo7,filterinfo8,filterinfo9,filterinfo10,filterinfo11,filterinfo12,filterinfo13);
				end;
				end;
					
			children=
			{
				citycheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="城市消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				teamcheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="队伍消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				mastercheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="师徒消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				unioncheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,68,90,16};
					captionrect={24,2,54,12},
					caption="家族消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				whispercheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,88,90,16};
					captionrect={24,2,54,12},
					caption="密 语",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				nearbycheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,108,90,16};
					captionrect={24,2,54,12},
					caption="附近消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				worldcheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,128,90,16};
					captionrect={24,2,54,12},
					caption="世界消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				playersyscheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,148,90,16};
					captionrect={24,2,54,12},
					caption="系统消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				fightteamcheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,168,90,16};
					captionrect={24,2,54,12},
					caption="战队消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				matchcheck=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,188,90,16};
					captionrect={24,2,54,12},
					caption="战场消息",
					framescheme = {{1,1,1,1},{0,0,0,0}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
			};
		};
		
		
		mapfilterdlg=
		{
			type="DIALOG",
			rect = {0,0,98,92},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_popup+wgtstyle_topmost,
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor={16,16,16,196},					
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,			
	
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
					
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.mapfilterdlg")  then
					if Win_IsChecked("UI.gameui.sketchbar.sketchmap.filterbtn")  then
					Win_SetCheck("UI.gameui.sketchbar.sketchmap.filterbtn",false);									
					end;
				end;
				end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.mapfilterdlg","UI.gameui.sketchbar.sketchmap.filterbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
				check1, check2, check3, check4 = GetMapFilter();
				Win_SetCheck("UI.gameui.mapfilterdlg.check1",check1==1);
				Win_SetCheck("UI.gameui.mapfilterdlg.check2",check2==1);
				Win_SetCheck("UI.gameui.mapfilterdlg.check3",check3==1);
				Win_SetCheck("UI.gameui.mapfilterdlg.check4",check4==1);
				end;
				
			OnSelfHide=function(bshow)
				if bshow==1 then				
				local check1=0;
				local check2=0;
				local check3=0;
				local check4=0;
				
				if Win_IsChecked("UI.gameui.mapfilterdlg.check1") then
				check1=1;
				end;
				
				if Win_IsChecked("UI.gameui.mapfilterdlg.check2") then
				check2=1;
				end;
				
				if Win_IsChecked("UI.gameui.mapfilterdlg.check3") then
				check3=1;
				end;
				
				if Win_IsChecked("UI.gameui.mapfilterdlg.check4") then
				check4=1;
				end;
				
				SetMapFilter(check1,check2,check3,check4);
				end;
				end;
					
			children=
			{
				check1=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="NPC 图标",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				check2=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="怪物图标",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				check3=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="队友图标",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};			

				check4=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,68,90,16};
					captionrect={24,2,54,12},
					caption="其他玩家",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};							
			};
		};
		
		--add by joeyxiong[2011-01-01]特效过滤
		effectfilterdlg=
		{
			type="DIALOG",
			rect = {0,0,98,72},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_popup+wgtstyle_topmost,
			soundid={-1,-1,-1,-1,1004,1004},
			
			bkcolor={16,16,16,196},					
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,			
	
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			mornitor={value_channel_visible},
					
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.effectfilterdlg")  then
					if Win_IsChecked("UI.gameui.sketchbar.sketchmap.performbtn")  then
						Win_SetCheck("UI.gameui.sketchbar.sketchmap.performbtn",false);									
					end;
				end;
			end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.effectfilterdlg","UI.gameui.sketchbar.sketchmap.performbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
				check1, check2, check3 = GetEffectFilter();
				Win_SetCheck("UI.gameui.effectfilterdlg.check1",check1==1);
				Win_SetCheck("UI.gameui.effectfilterdlg.check2",check2==1);
				Win_SetCheck("UI.gameui.effectfilterdlg.check3",check3==1);
			end;
				
			OnSelfHide=function(bshow)
				if bshow==1 then				
				local check1=0;
				local check2=0;
				local check3=0;
				
				if Win_IsChecked("UI.gameui.effectfilterdlg.check1") then
				check1=1;
				end;
				
				if Win_IsChecked("UI.gameui.effectfilterdlg.check2") then
				check2=1;
				end;
				
				if Win_IsChecked("UI.gameui.effectfilterdlg.check3") then
				check3=1;
				end;
							
				SetEffectFilter(check1,check2,check3);
				end;
			end;
			
			children=
			{
				check1=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="人物特效",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				check2=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="幻神特效",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};
				
				check3=
				{
					type="CHECK";
					bkimage="res/uires/common/checkradio.gsa";
					bkimagepos={4,3},
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="怪物特效",
					framescheme = {{0,0,0,0},{1,1,1,1}},
					textsize=12,
					updatemute=1,
					soundid={1005,1003},
				};							
			};
		};
		
		npcdlg=
		{
		
			type="SYSDIALOG",			
			rect={0,190,-1,-1},			
			captionrect={28,9,372,12},
			dragrect={0,0,0,0},		
			bkimage="res/uires/sysdlg/npcdlgbk.gsa",			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter,	
			visible=0,	
			marginh=5,
			marginv=5,
			textsize=12,
			style=wgtstyle_topmost+wgtstyle_customclose,
			updatemute=1,
			
			
			OptionSelOk=function()
				local hot=Win_GetValue("UI.gameui.npcdlg.optionlist",value_channel_hot);
				local result="select="..hot;
				NpcDialog(result);
				end;
						
			EditInputOk=function()
				local editvalue1=Win_GetText("UI.gameui.npcdlg.inputlist.input1");
				local editvalue2=Win_GetText("UI.gameui.npcdlg.inputlist.input2");
				local editvalue3=Win_GetText("UI.gameui.npcdlg.inputlist.input3");
				local editvalue4=Win_GetText("UI.gameui.npcdlg.inputlist.input4");
				NpcDialog(editvalue1,editvalue2,editvalue3,editvalue4);
				end;
						
			
			SentenceOk=function()
				local result="";
				NpcDialog(result);				 	   
				end;
					   
			NoGoOnOk=function()
				NpcDialog();	
				Win_ShowWidget("UI.gameui.npcdlg",false);					
				end;
					   
			
			InitNpcOption=function()
				Win_ShowWidget("UI.gameui.npcdlg.optionlist",true);
				Win_ShowWidget("UI.gameui.npcdlg.inputlist",false);
				
				local dlginfo,options=GetCurDlgInfo();						  
				local noption=dlginfo.noption;
					
				Win_RemoveStyle("UI.gameui.npcdlg",wgtstyle_advance);
				Win_SetValue("UI.gameui.npcdlg.optionlist",noption,value_channel_item_num);
				
				for i = 1, noption, 1 do 	
				local txt=options[i];
				Win_SetText("UI.gameui.npcdlg.optionlist",txt,value_channel_itemtext,i-1);
				end;
				
				Win_SetValue("UI.gameui.npcdlg.optionlist",0,value_channel_sel);
								
				Win_SetFocus("UI.gameui.npcdlg.optionlist");					  
				end;
			
			InitNpcInput=function()
				Win_ShowWidget("UI.gameui.npcdlg.optionlist",false);
				Win_ShowWidget("UI.gameui.npcdlg.inputlist",true);
				
				local dlginfo,options,inputs=GetCurDlgInfo();
				Win_RemoveStyle("UI.gameui.npcdlg",wgtstyle_advance);
				
				local numinput=dlginfo.ninput;
				if numinput>4 then 
				numinput=4;
				end;
				
				local hgt=60+numinput*30;
				Win_SetSize("UI.gameui.npcdlg.inputlist",451,hgt);
				Win_RelativePos("UI.gameui.npcdlg.inputlist.affirmbtn",62,hgt-26);
				Win_RelativePos("UI.gameui.npcdlg.inputlist.cancelbtn",278,hgt-26);
								
				for i=1,4 do
				local labelwgt="UI.gameui.npcdlg.inputlist.inputname"..i;
				local editwgt="UI.gameui.npcdlg.inputlist.input"..i;
				
				if i>numinput then
				Win_ShowWidget(labelwgt,false);
				Win_ShowWidget(editwgt,false);
				else
				Win_ShowWidget(labelwgt,true);
				Win_ShowWidget(editwgt,true);
				
				local method=ui_editmethod_number;
				if inputs[i].inputtype==1 then
					if inputs[i].maxvalue > 0 then
					Win_SetValue(editwgt,inputs[i].maxvalue,value_channel_maxchar);
					else
					Win_SetValue(editwgt,32,value_channel_maxchar);
					end;
					
					if inputs[i].minvalue > 0 then
					Win_SetValue(editwgt,inputs[i].minvalue,value_channel_customindex);
					else 
					Win_SetValue(editwgt,0,value_channel_customindex);
					end;
					method=ui_editmethod_number+ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_symbol;
				else
					Win_SetValue(editwgt,0,value_channel_customindex);
					Win_SetValue(editwgt,inputs[i].maxvalue,value_channel_maxvalue);
					Win_SetValue(editwgt,inputs[i].minvalue,value_channel_minvalue);
				end;
				
				Win_SetValue(editwgt,method,value_channel_method);
				Win_SetText(labelwgt,inputs[i].showname);
				
				Win_AlignWidget(editwgt,labelwgt,aligntype_winrect,alignstyle_right_out,6,0);
				
				end;
					
				end;	
				
				Win_SetFocus("UI.gameui.npcdlg.inputlist.input1");			
				
				end;
				  
			
			InitNpcSentence=function()
				Win_ShowWidget("UI.gameui.npcdlg.optionlist",false);
				Win_ShowWidget("UI.gameui.npcdlg.inputlist",false);
				Win_AddStyle("UI.gameui.npcdlg",wgtstyle_advance);						  
				Win_SetFocus("UI.gameui.npcdlg");							
				end;
			InitNpcNoGoOn=function()
				Win_ShowWidget("UI.gameui.npcdlg.optionlist",false);
				Win_ShowWidget("UI.gameui.npcdlg.inputlist",false);
				Win_AddStyle("UI.gameui.npcdlg",wgtstyle_advance);					
				Win_SetFocus("UI.gameui.npcdlg");
				end;
						  
					   
			OnSelfShow=function()
					
				local dlginfo=GetCurDlgInfo();
				   
				local dlgtype=dlginfo.type;
		    				   
				Win_SetText("UI.gameui.npcdlg.infolist.sentence",dlginfo.sentence);
				Win_SetValue("UI.gameui.npcdlg.infolist",1,value_channel_update_dirty);
				   
				if dlgtype==0 then
				UI.children.gameui.children.npcdlg.InitNpcSentence();				 
				elseif dlgtype==1 then
				UI.children.gameui.children.npcdlg.InitNpcOption();
				elseif dlgtype==2 then
				UI.children.gameui.children.npcdlg.InitNpcInput();
				elseif dlgtype==3 then
				UI.children.gameui.children.npcdlg.InitNpcNoGoOn();
				end;
				   				   
				end;
			
			OnOk=function()
			     
			        local dlginfo=GetCurDlgInfo();
				local dlgtype=dlginfo.type;
									    
				if dlgtype==0 then
				UI.children.gameui.children.npcdlg.SentenceOk();				 
				elseif dlgtype==1 then
				UI.children.gameui.children.npcdlg.OptionSelOk();
				elseif dlgtype==2 then		 
				 UI.children.gameui.children.npcdlg.EditInputOk();
				elseif dlgtype==3 then
				UI.children.gameui.children.npcdlg.NoGoOnOk();
				end;

				end;
				 
			OnCancel=function()	
				Win_ShowWidget("UI.gameui.npcdlg",false);				 
				NpcDialog();			     
				end;
			
			
			
			children=
			{	
				closebtn=
				{
					type="BUTTON",
					rect={425,5,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 403,5,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("Npc对话界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				npcwin=
				{
				
					type="WIDGET",
					rect={0,-265,451,265},					
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragindex=0,
					dragtype=ui_drag_type_dlgnpcpic,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};
			
				infolist=
				{
					type="WIDGETLIST",
					rect={12,35,406,114},
															
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static+wgtstyle_vertical,
					
					primaryscroll="UI.gameui.npcdlg.vscroll",
					
										
					children=
					{
						--说明
						sentence=
						{
							
							type="LABEL",
							rect={12,35,406,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left+dt_top,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							richmode=ui_richmode_all,							
							drawcolor={255,255,255,255},
						},
						
						
					},-- children
					
				},
				
				
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={424,48,20,91},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
					
					buddywidget="UI.gameui.npcdlg.infolist",
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				inputlist=
				{
				
					type="WIDGET",
					rect={0,162,451,150},		
					updatemute=1,					
					
					patchupleft="res/uires/sysdlg/inputup.gsa",
					patchdownleft="res/uires/sysdlg/inputdn.gsa",
					patchleftmiddle="res/uires/sysdlg/inputmid.gsa",
				
					children=
					{
						affirmbtn=
						{
							type="BUTTON",
							rect={62,124,70,22},
							bkimage="res/uires/common/affirmbtn.gsa",
							soundid={1005},
							
							OnClick=function()
								for i=1,4 do
								local editwgt="UI.gameui.npcdlg.inputlist.input"..i;
								local minlen = Win_GetValue(editwgt,value_channel_customindex);
								local len = Win_GetValue(editwgt,value_channel_captionsize);
								if minlen > 0 and len < minlen then
								Win_ShowMsgBox("对不起，您输入的字符串长度不足"..minlen.."位。","系统消息",ui_msgid_default,editwgt);
								return;
								end;
								end;
							
								Win_EndWidget("UI.gameui.npcdlg",true);
								end;
						};
						
						cancelbtn=
						{
							type="BUTTON",
							rect={278,124,70,22},
							bkimage="res/uires/common/cancelbtn.gsa",
							soundid={1007},
							
							OnClick=function()
								Win_EndWidget("UI.gameui.npcdlg",false);
								end;
						};
						
						inputname1= 
						{			
							type = "LABEL",
							rect = { 14, 24, 36, 24 },
							captionrect = { 0, 7, 36, 12 },
							textsize=12,
							sizeable=1,
							maxwidth=800,
							minheight=24,
							enable=0,
						};
						
						inputname2= 
						{			
							type = "LABEL",
							rect = { 14, 54, 36, 24 },
							captionrect = { 0, 7, 36, 12 },							
							textsize=12,
							sizeable=1,
							maxwidth=800,
							enable=0,
						};
						
						inputname3= 
						{			
							type = "LABEL",
							rect = { 14, 84, 36, 24 },
							captionrect = { 0, 7, 36, 12 },							
							textsize=12,
							sizeable=1,
							maxwidth=800,
							enable=0,
						};
						
						inputname4= 
						{			
							type = "LABEL",
							rect = { 14, 114, 36, 24 },
							captionrect = { 0, 7, 36, 12 },							
							textsize=12,
							sizeable=1,
							maxwidth=800,
							enable=0,
						};
						
						input1= 
						{			
							type = "EDIT",
							rect = { 54, 24, 166, 24 },
							captionrect = { 5,7,156,12 },
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							bkimage="res/uires/sysdlg/editbk.gsa",							
							maxchar=32;					
							textsize=12;	
							
							OnMsgBoxOk=function()
								Win_SetFocus("UI.gameui.npcdlg.inputlist.input1");
								end;
						};
						
						input2= 
						{			
							type = "EDIT",
							rect = { 54, 54, 166, 24 },
							captionrect = { 5,7,156,12 },
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							bkimage="res/uires/sysdlg/editbk.gsa",							
							maxchar=32;					
							textsize=12;	

							OnMsgBoxOk=function()
								Win_SetFocus("UI.gameui.npcdlg.inputlist.input2");
								end;							
						};
						
						input3=
						{			
							type = "EDIT",
							rect = { 54, 84, 166, 24 },
							captionrect = { 5,7,156,12 },
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							bkimage="res/uires/sysdlg/editbk.gsa",							
							maxchar=32;					
							textsize=12;	
								
							OnMsgBoxOk=function()
								Win_SetFocus("UI.gameui.npcdlg.inputlist.input3");
								end;
						};
						
						input4= 
						{			
							type = "EDIT",
							rect = { 54, 114, 166, 24 },
							captionrect = { 5,7,156,12 },
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							bkimage="res/uires/sysdlg/editbk.gsa",							
							maxchar=32;					
							textsize=12;	

							OnMsgBoxOk=function()
								Win_SetFocus("UI.gameui.npcdlg.inputlist.input4");
								end;
						};
					}
					
				
				};
				
				optionlist=
				{
					type="LISTBOX",
					rect={0,162,451,8},
					clientrect={34,4,383,0},					
					--adornpic={"res/uires/sysdlg/optionbk.gsa"},
					--adornpicpos={{2,2}},
					
					style=wgtstyle_vertical,	
					extendstyle=listbox_style_auto_comfort+listbox_style_itemheight_fix+listbox_style_richtext,
					richmode=ui_richmode_all,
					
					ysizeable=1,
					minheight=80,
					
					itemheight=14,
					itemwidth=384,
					itemmarginh=0,
					itemmarginv=2,
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter+dt_magicedge;
																			
					itemfocusback="res/uires/sysdlg/selbk.gsa",
					itemfocuspos={-20,0,0,-1},
										
					bkcolor= { 26, 27, 22, 196 },
					patchrect={3,3,3,2},
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					
					updatemute=1,
			
					OnClick=function()
						local dlginfo=GetCurDlgInfo();
						local dlgtype=dlginfo.type;
		       
						if dlgtype==1 then							  
						UI.children.gameui.children.npcdlg.OptionSelOk();
						end;
						 
						end;			
				};		
				
			};			
		
			
		};--npcdlg
		
		-- 主控栏上的F1-F10快捷键，占用快捷键的前10个记录， 800， 1024均居中显示
		accelbar_main=
		{
			type="WIDGET",
			rect={0,0,1,64},
			aligntype=aligntype_father+aligntype_clientrect,
			alignstyle=alignstyle_bottom_in+alignstyle_hcenter,	

			bkimage="res/uires/accelbar/accelbarbk.gsa",
			bkimagepos={-418, 0};
			itemmarginv=0,
			itemmarginh=0,
			initlayer=0;
			pluslayer=0;
			moveable=0,
			visible=1,
			updatemute=1,

			children=
			{
				accelbarup=
				{
					type="LISTBOX",
					rect={-381,2,384,45},	
					clientrect={2,6,380,32},	
					coverpic="res/uires/accelbar/acceltext.gsa",
					coverpicpos={16,5},

					dragmode=1;	-- 延迟拖拉
					dragtype=ui_drag_type_accel,
					style=wgtstyle_systemdraw,
					visible=1,
					
					itemnum=10,
					itemmarginh=3,
					itemmarginv=0,
					itemheight=32,
					itemwidth=32,
					extendstyle=listbox_style_itemheight_fix,	
												
					tipwidget="UI.gameui.ScrnTooltip",
					
					updatemute=1,
					
					OnRClick=function(idx)
						if idx >= 0 and idx < 10 then
							SetDefaultSkill(idx, 0);
						end;
					end;
				};
			};
		};

		accelbar=
		{
			type="WIDGET",
			rect={0,0,1,45},
			style=wgtstyle_clipself;
			itemmarginv=0,
			itemmarginh=0,
			initlayer=0;
			pluslayer=0;
			moveable=0,
			visible=0,
			updatemute=1,

			OnInitUpdate=function()
				if GetGameVar("accelbarex") == 0 then -- 默认, 仅显示一页
					Win_SetValue("UI.gameui.accelbar.accelbarup",10,value_channel_indexoffset);
					Win_ShowWidget("UI.gameui.accelbar.accelbarup",true);
					Win_SetCheck("UI.gameui.accelbar.hideshowbtn", false);
				elseif GetGameVar("accelbarex") == 1 then -- 都不显示
					Win_SetValue("UI.gameui.accelbar.accelbarup",10,value_channel_indexoffset);
					Win_ShowWidget("UI.gameui.accelbar.accelbarup",false);
					Win_SetCheck("UI.gameui.accelbar.hideshowbtn", true);
				end;
									
				UI.children.gameui.children.accelbar.UpdatePageBtn();
				
				if GetScreenType() == 0 then
					--for 800 , design bottom controls
					Win_AlignWidget("UI.gameui.accelbar","UI.gameui.accelbar_main",aligntype_winrect,alignstyle_top_out+alignstyle_left_in,-387,6);			
					Win_RelativePos("UI.gameui.accelbar.accelbarup",-13, 0);
					Win_RelativePos("UI.gameui.accelbar.hideshowbtn",768, 20);
				else
					--for 1024, redesign bottom controls
					Win_AlignWidget("UI.gameui.accelbar","UI.gameui.accelbar_main",aligntype_winrect,alignstyle_top_out+alignstyle_left_in,-387,6);			
					Win_RelativePos("UI.gameui.accelbar.accelbarup",0, 0);
					Win_RelativePos("UI.gameui.accelbar.hideshowbtn",787, 40);
				end;	
				
				UI.children.gameui.children.accelbar.UpdateOtherctrl();

				QueryNewbieNextStep(10004);
			end;
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.accelbar",0,value_channel_customindex);
				
				Win_SetValue("UI.gameui.accelbar.accelbarup",10,value_channel_indexoffset);

				SetGlobalQuery(GlobalQuery_AccelBar,1);

				UI.children.gameui.children.accelbar.UpdatePageBtn();
				UI.children.gameui.children.accelbar.UpdateOtherctrl();
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_AccelBar,0);
			end;
			
			Update=function()
				if (GetGameVar("accelbarex")==1) then --隐藏的
					Win_SetText("UI.gameui.accelbar.hideshowbtn","显示快捷栏",value_channel_tiptext);
					Win_ShowWidget("UI.gameui.accelbar.accelbarup",false);
					Win_ShowWidget("UI.gameui.accelbar.nextprepagebtn",false);
					Win_SetCheck("UI.gameui.accelbar.hideshowbtn",true);
				else -- 显示
					Win_SetText("UI.gameui.accelbar.hideshowbtn","隐藏快捷栏",value_channel_tiptext);
					Win_ShowWidget("UI.gameui.accelbar.accelbarup",true);
					--Win_ShowWidget("UI.gameui.accelbar.nextprepagebtn",true);
					Win_SetCheck("UI.gameui.accelbar.hideshowbtn",false);
				end;
			end;			
			
			UpdatePageBtn=function()
				if (GetGameVar("accelbarold")==0) then -- page 1
					Win_SetText("UI.gameui.accelbar.nextprepagebtn","下一页(Alt+2)",value_channel_tiptext);
					Win_SetCheck("UI.gameui.accelbar.nextprepagebtn",false);
				else	-- page 2
					Win_SetText("UI.gameui.accelbar.nextprepagebtn","上一页(Alt+1)",value_channel_tiptext);
					Win_SetCheck("UI.gameui.accelbar.nextprepagebtn",true);
				end;
			end;
			
			UpdateOtherctrl=function()
				     --for 1280, redesign bootm controls
				     --modify by skyong 2010.6.23
				     if (GetGameVar("accelbarex")==1) then --隐藏的
						local panelrect1=Win_GetRect("UI.gameui.accelbar.accelbarup",value_channel_winrect);
						local panelrect2=Win_GetRect("UI.gameui.godaccelbar",value_channel_winrect);
						local panelrect3=Win_GetRect("UI.gameui.godaccelbar.hideshowbtn",value_channel_winrect);
						local panelrect4=Win_GetRect("UI.gameui.accelbar.hideshowbtn",value_channel_winrect);
						local globalrect = Win_GetRect("UI.gameui",value_channel_winrect);
						local ox = panelrect4.x - panelrect2.w - panelrect3.w;
						local oy = -globalrect.h + panelrect1.y +40;
						Win_AlignWidget("UI.gameui.godaccelbar", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,ox,oy);			
						
						panelrect1 = Win_GetRect("UI.gameui.godaccelbar.bar.skill5",value_channel_winrect);
						panelrect2 = Win_GetRect("UI.gameui.helpspritedlg",value_channel_winrect);
						if Win_IsVisible("UI.gameui.godaccelbar") then
							Win_AlignWidget("UI.gameui.helpspritedlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,panelrect1.x,oy-panelrect2.h/2);	
						else
							Win_AlignWidget("UI.gameui.helpspritedlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,panelrect1.x,oy);	
						end;
										
						panelrect1 = Win_GetRect("UI.gameui.godaccelbar.bar.attacknowbtn",value_channel_winrect);
						panelrect2 = Win_GetRect("UI.gameui.intonatebar",value_channel_winrect);
						local barypos = panelrect1.y - panelrect2.h+5;
						--barxpos = barxpos - panelrect1.w -9;
						barxpos = panelrect1.x - panelrect2.w / 2 - 25;

						Win_SetPos("UI.gameui.intonatebar", barxpos, barypos);
						Win_SetPos("UI.gameui.showgodbar", barxpos, barypos);
						Win_SetPos("UI.gameui.showitembar", barxpos, barypos);
						
						panelrect1 = Win_GetRect("UI.gameui.chatbar.filterbtn",value_channel_winrect);
						Win_AlignWidget("UI.gameui.chatbar", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,0,oy-10);

					else	
						local panelrect1=Win_GetRect("UI.gameui.accelbar.accelbarup",value_channel_winrect);
						local panelrect2=Win_GetRect("UI.gameui.godaccelbar",value_channel_winrect);
						local panelrect3=Win_GetRect("UI.gameui.godaccelbar.hideshowbtn",value_channel_winrect);
						local panelrect4=Win_GetRect("UI.gameui.accelbar.hideshowbtn",value_channel_winrect);	
						local globalrect = Win_GetRect("UI.gameui",value_channel_winrect);
						local ox = panelrect4.x - panelrect2.w - panelrect3.w;
						local oy = -globalrect.h + panelrect1.y;
						Win_AlignWidget("UI.gameui.godaccelbar", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,ox,oy);				

						panelrect1 = Win_GetRect("UI.gameui.godaccelbar.bar.skill5",value_channel_winrect);
						panelrect2 = Win_GetRect("UI.gameui.helpspritedlg",value_channel_winrect);
						if Win_IsVisible("UI.gameui.godaccelbar") then
							Win_AlignWidget("UI.gameui.helpspritedlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,panelrect1.x,oy-panelrect2.h/2);	
						else
							Win_AlignWidget("UI.gameui.helpspritedlg", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,panelrect1.x,oy);		
						end;

						panelrect1 = Win_GetRect("UI.gameui.godaccelbar.bar.attacknowbtn",value_channel_winrect);
						panelrect2 = Win_GetRect("UI.gameui.intonatebar",value_channel_winrect);
						local barypos = panelrect1.y - panelrect2.h + 5;
						--barxpos = barxpos - panelrect1.w - 9;
						barxpos = panelrect1.x - panelrect2.w / 2 - 25;
						Win_SetPos("UI.gameui.intonatebar", barxpos, barypos);
						Win_SetPos("UI.gameui.showgodbar", barxpos, barypos);
						Win_SetPos("UI.gameui.showitembar", barxpos, barypos);
						panelrect1 = Win_GetRect("UI.gameui.chatbar.filterbtn",value_channel_winrect);
						Win_AlignWidget("UI.gameui.chatbar", "UI.gameui",aligntype_winrect,alignstyle_left_in+alignstyle_bottom_in,0,oy-10);
					end;
			end;

			children=
			{
			
				CrossServeInfo=
				{
					type = "DIALOG",
					rect = {282,-117,290,100},
					bkimage="res/uires/gameui/hint.gsa",
					moveable=0,
					style=wgtstyle_topmost+wgtstyle_customclose +wgtstyle_alphawin,							
					visible=1,
					updatemute=1,
					alphafactor=1.0,
					bkcolor= { 26, 27, 22, 196 },
					patchrect={3,3,3,2},
					
					
					OnMsgBoxOk=function()
						CancelCrossServer();
						Win_SetCheck("UI.gameui.godaccelbar.CrossServeBtn",false);
					end;
	
					children = 
					{
						infotext1 = 
						{
							type = "LABEL",
							rect={53,7,200,20};
							drawcolor = { 255, 255, 0, 255 },			
							textsize=12;
							richmode=ui_richmode_color+ui_richmode_font,
							textstyle=dt_center+dt_vcenter;
							richmode=ui_richmode_all,
							caption="";
							enable=1;
						};
						
						infotext2 = 
						{
							type = "LABEL",
							rect={81,30,160,20};
							drawcolor = { 255, 255, 0, 255 },			
							textsize=12;
							richmode=ui_richmode_color+ui_richmode_font,
							textstyle=dt_left+dt_vcenter;
							richmode=ui_richmode_all,
							caption="";
							enable=1;
						};
						
						infotext3 = 
						{
							type = "LABEL",
							rect={81,53,160,20};
							drawcolor = { 255, 255, 0, 255 },			
							textsize=12;
							richmode=ui_richmode_color+ui_richmode_font,
							textstyle=dt_left+dt_vcenter;
							richmode=ui_richmode_all,
							caption="";
							enable=1;
							
							OnTimer=function()
								local retime = Win_GetText("UI.gameui.accelbar.CrossServeInfo.timetext12");
								local retime2 = retime + 1;
								if(retime2 > 0) then 								  								 
									local hours,minutes,second= 0,0,0;
				
									if retime2 >= 3600 then 					
										hours = math.floor(retime2/3600);
										minutes = math.floor(math.mod(retime2,3600)/60);
										second = math.mod(math.mod(retime2,3600),60);																			
									elseif retime2 >= 60 then
										minutes = math.floor(retime2/60);
										second = math.mod(retime2,60);		
									else 
										second = retime2; 
									end;
									
									if hours ~= 0 then 
										Win_SetText("UI.gameui.accelbar.CrossServeInfo.infotext3","/C17已等待时间: ".."/C20 " .. hours .."小时" .. minutes .. "分" .. second .. "秒");
									elseif minutes ~= 0 then
										Win_SetText("UI.gameui.accelbar.CrossServeInfo.infotext3","/C17已等待时间: ".."/C20 " .. minutes .. "分" .. second .. "秒");
									else 
										Win_SetText("UI.gameui.accelbar.CrossServeInfo.infotext3","/C17已等待时间: ".."/C20 " .. second .. "秒");
									end;
								
									Win_SetText("UI.gameui.accelbar.CrossServeInfo.timetext12",retime2);
									if Win_IsVisible("UI.gameui.accelbar.CrossServeInfo") == true then 
										Win_SetValue("UI.gameui.accelbar.CrossServeInfo.infotext3",1,value_channel_timerspace);
									end;								
								end;
							end;
						};
						
						timetext12=
						{
							type="LABEL",
							rect={193,150,70,20},
							editable=0,
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							drawcolor={255,255,255,255},
							visible=0;
						};		
						cancelbtn=
						{
							
							type="BUTTON",
							rect={112,75,70,22},
							bkimage="res/uires/common/cancelbtn.gsa",	
							defaultcancel=1,
							soundid={1007},
							updatemute=1,
							
							OnClick=function()
								Win_ShowMsgBox("确定取消跨服报名吗？","系统消息",ui_msgid_yesno,"UI.gameui.accelbar.CrossServeInfo");								
							end;
						},
					};			
				};
							
				
				hideshowbtn = 
				{
					type = "CHECK",
					rect={780,19,20,19};
					bkimage="res/uires/common/minize_updown_btn.gsa",
					framescheme={{4,5,6,7},{0,1,2,3}},
					tiptext="隐藏快捷栏",
					updatemute=1,
					visible=1,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.accelbar.hideshowbtn") then
							SetGameVar("accelbarex", 1);
						else
							SetGameVar("accelbarex",0);
						end;
						
						UI.children.gameui.OnUpdateSysMsgPos();
						UI.children.gameui.children.accelbar.Update();
						UI.children.gameui.OnNewbieHelpSysMsg();
						UI.children.gameui.children.accelbar.UpdateOtherctrl();
						UI.children.gameui.children.taskremindhintdlg.OnUpdate();
					end;
				};

				nextprepagebtn=
				{
					type="CHECK",
					rect={780,0,20,19};
					bkimage="res/uires/common/rightleft_btn.gsa",
					framescheme={{0,1,2,3},{4,5,6,7}},
					visible=0,
					tiptext="下一页(Alt+2)",
					enable=0;
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.accelbar.nextprepagebtn") then
							SetGameVar("accelbarold", 1); --2页
						else
							SetGameVar("accelbarold", 0); --1页
						end;

						UI.children.gameui.children.accelbar.UpdatePageBtn();
					end;
				};

				accelbarup=
				{
					type="LISTBOX",
					rect={0,0,780,40},	
					clientrect={1,4,780,32},	
					effectpicpos={-3,-2},
					groupid=0,
					groupstop=0,					
				
					coverpic="res/uires/accelbar/accelbar_text2.gsa",
					coverpicpos={7,5},
					
					dragmode=1;
					dragtype=ui_drag_type_accel,
					style=wgtstyle_systemdraw,
					
					itemnum=20,
					itemdrawback="res/uires/accelbar/singleblock.gsa",
					itemdrawpos={-4,-4,49,49},
		
					itemmarginh=3,
					itemmarginv=0,
					itemheight=32,
					itemwidth=33,
					extendstyle=listbox_style_itemheight_fix,	
												
					tipwidget="UI.gameui.ScrnTooltip",
					
					updatemute=1,
					
					OnRClick=function(idx)
						if idx >= 10 and idx < 30 then
							SetDefaultSkill(idx, 0);
						end;
					end;
				};
			}	

		};
		
		
		historybar=
		{
		
			type = "DIALOG",
			rect = { 0, 0, 608, 525 },
			captionrect={56,22,394,12},
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,			
			bkimage="res/uires/chatbar/historybar.gsa",
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			moveable=1,
			
			marginh=0,		
			marginv=0,
			visible=0,		
			updatemute=1,			
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.historybar",false);
				end;
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.historybar", "UI.gameui", aligntype_winrect, alignstyle_vcenter+alignstyle_hcenter);
				if Win_IsVisible("UI.gameui.historybar.lastchatlistdlg") then
					Win_ShowWidget("UI.gameui.historybar.lastchatlistdlg",false);
				end;
				end;
				
			OnSelfHide=function()
				if Win_IsChecked("UI.gameui.chatbar.viewbtn")  then
				Win_SetCheck("UI.gameui.chatbar.viewbtn",false);									
				end;
				end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={558,18,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 537,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("最近私聊玩家查询");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				systemtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={0,2,51,22},
					tabcover="res/uires/chatbar/systemtab.gsa",
					tabwintype=2,					
					groupid=0,
					groupstop=0,
					tabstop=0,
					prelayer=4,
					soundid={1003},
					checked=1,
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							magiccolor={0,0,0,128},
							linkcolor={100,165,245,255},
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									updatemute=1,									

									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};

							
						};
					};
				};
				
				matchtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={51,2,51,22},
					tabcover="res/uires/chatbar/matchtab.gsa",
					tabwintype=2,					
					groupid=0,
					groupstop=1,
					tabstop=1,
					prelayer=3,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							magiccolor={0,0,0,128},
							linkcolor={100,165,245,255},
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									updatemute=1,									

									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};

							
						};
					};
				};
				gmtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={102,2,51,22},
					tabcover="res/uires/chatbar/gmtab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=2,
					tabstop=2,
					prelayer=2,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},				
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};

						};
					};
				};
		
				citytab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={153,2,51,22},
					tabcover="res/uires/chatbar/citytab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=3,
					tabstop=3,
					prelayer=1,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,	
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};
				
				teamtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={204,2,51,22},
					tabcover="res/uires/chatbar/teamtab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=4,
					tabstop=4,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,	
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};
		
				mastertab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={255,2,51,22},
					tabcover="res/uires/chatbar/mastertab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=5,
					tabstop=5,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};
				
				uniontab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={306,2,51,22},
					tabcover="res/uires/chatbar/uniontab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=6,
					tabstop=6,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};
				
				whispertab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={357,2,51,22},
					tabcover="res/uires/chatbar/whispertab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=7,
					tabstop=7,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};
				
				nearbytab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={408,2,51,22},
					tabcover="res/uires/chatbar/nearbytab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=8,
					tabstop=8,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							};
						};
					};
				};
				
				worldtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={459,2,51,22},
					tabcover="res/uires/chatbar/worldtab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=9,
					tabstop=9,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 48, 0, 430, 430 },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,	
									updatemute=1,									

									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																				
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};	
				broadtab=
				{
					type="TABWIN",
					rect = { 32,64,514,438 },							
					tabrect={510,2,51,22},
					tabcover="res/uires/chatbar/broadtab.gsa",
					tabwintype=2,
					groupid=0,
					groupstop=10,
					tabstop=10,
					prelayer=0,
					soundid={1003},
					
					children=
					{
						historylist=
						{
							type = "TEXTLIST",
							rect = { 0,3,514,431 },
							clientrect = { 60, 0, 430, 430 },
							titlerect={-60,0,60,12},
							style=wgtstyle_clipself,
							extendstyle=textlist_style_none,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							mousedelta=18,
							richmode=ui_richmode_all,
							richflag=1,
							updatemute=1,
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={523,18,20,394},					
									style=wgtstyle_vertical,
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=18,
									pagesize=8,
									marginh=0,
									marginv=0,										
									updatemute=1,
									
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
						};
					};
				};	
				lastbtn=
				{
					type="BUTTON",
					rect={470,36,44,22},
					visible=0;
					bkimage="res/uires/chatbar/lastbtn.gsa",
					
					OnClick=function()
						if not Win_IsVisible("UI.gameui.historybar.lastchatlistdlg") then
							Win_ShowWidget("UI.gameui.historybar.lastchatlistdlg",true);
							Win_SetFocus("UI.gameui.historybar.lastchatlistdlg");
						else
							Win_ShowWidget("UI.gameui.historybar.lastchatlistdlg",false);
						end;
						end;
				};
	
				scrollcheck= 
				{
					type = "CHECK",
					rect={31,503,118,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",		
					bkimagepos={0,-2};
					caption="自动滚动";
					updatemute=1,
					textsize=12,
					textstyle=dt_left;
					captionrect={20, 1, 100, 16};
					bkcolor={0,0,0,0},
					drawcolor={221,198,149,255},
					checked=1;
				};
	
				lastchatlistdlg=
				{
					type="DIALOG",
					rect={284,28,183,222},
					captionrect={44,12,81,14},
					caption="最近私聊玩家",
					textfont=1,
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					bkimage="res/uires/chatbar/lastchatlistdlgbk.gsa",
					style=wgtstyle_topmost,
					initlayer=msgbox_layer-1,
					pluslayer=0,
					visible=0,
					
					OnSelfShow=function()
						local num = GetLastChatListNum();
						Win_SetValue("UI.gameui.historybar.lastchatlistdlg.playertab.playerlist",num,value_channel_item_num);
						Win_SetValue("UI.gameui.historybar.lastchatlistdlg.playertab.playerlist",0,value_channel_sel);
						end;
					
					children=
					{
						closebtn=
						{
							type="BUTTON",
							rect={157,10,20,19},
							bkimage="res/uires/common/miniclose.gsa",
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.historybar.lastchatlistdlg",false);
								end;
						},
						
						helplink= 
						{
							type = "BUTTON",
							rect = { 137,10,20,19 },
							bkimage="res/uires/gameui/helpicon.gsa",
							
							OnClick=function()
								local helpid=GetHelpID("最近私聊玩家查询");
								Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
								Win_ShowWidget("UI.gameui.helpwindlg",true);
								end;
						};
						
						playertab=
						{
							type="TABWIN",
							rect = {18,55,152,145},					
							tabrect={0,-1,50,23},
							tabcover="res/uires/chatbar/playertab.gsa",
							tabwintype=2,
							groupid=1,
							groupstop=0,
							tabstop=0,
							soundid={1003},
							checked=1,
							
							children=
							{
								playerlist=
								{
									type="LISTBOX",
									rect = { 0,0,152,145 },
									style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
									extendstyle=listbox_style_itemheight_fix,	
									dragtype=ui_drag_type_lastchatplayer,
									textsize=12,
				
									itemheight=20;
									itemmarginh=0,
									itemmarginv=0,
				
									bkcolor={0,0,0,0},
									edgecolor={0,0,0,0},
									focuscolor={0,0,0,0},	
									itembkcolor={0,0,0,0},					
									itemedgecolor={0,0,0,0},	
									itemfocuscolor={0,0,0,0},	
									
									itemdrawback="res/uires/cdkeydlg/itembk.gsa",
									itemselback="res/uires/cdkeydlg/itemsel.gsa",
									itemdrawpos={-11,9,205,16},
									itemselpos={-19, -11,205,16};
									
									OnRClick=function(idx)
										Win_SetValue("UI.gameui.historybar.lastchatlistdlg.playertab.playerlist",idx,value_channel_sel);
										UI.children.gameui.OnOpenPlayerMenu(GetLastChatListPlayer(idx));
										end;
								};
							};
						};
					};
				};
			};			
		};	
		
		--海选
		clockbar=
		{
			type="WIDGET",
			rect={621,173,64,80},
			effectpic="res/uires/wisdomcompete/clockeffect.gsa",
			initlayer=0;
			pluslayer=0;
			moveable=0,
			visible=0,
			style=wgtstyle_cleanwin,
			updatemute=1,
			autoadjust=autoadjust_center,
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.clockbar",0.1,value_channel_framespeed);
				end;
			
			children=
			{
				timelabel=
				{
					type="PICLABEL",
					rect={0,64,64,16},
					textstyle=dt_center+dt_vcenter,
					style=wgtstyle_cleanwin,
					fontpic="res/uires/common/fontpic.gsa",
					tiptext="答题时间统计",
				};
			};
		};
		
		questiondlg=
		{
			type="DIALOG";
			rect={98,94,331,341};
			captionrect={70,14,180,12},
			textstyle=dt_left,
			textfont=1,
			textsize=12,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself+wgtstyle_customclose,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			bkimage="res/uires/wisdomcompete/questiondlgbk.gsa",
			visible=0,	
			moveable=1,
			drawflag=drawflag_none,
			
			OnPlayQuestionTextEffect=function()
				local coloridx = Win_GetValue("UI.gameui.questiondlg.questionedit",value_channel_color_draw);
				local color = GetColorRGBA(coloridx);
				Win_SetValue("UI.gameui.questiondlg.questionedit",GetColorIndex(color.r,color.g,color.b,0),value_channel_customtype);
				Win_SetValue("UI.gameui.questiondlg",0.01,value_channel_timerspace);
				end;			
			
			OnTimer=function()
				local coloridx = Win_GetValue("UI.gameui.questiondlg.questionedit",value_channel_customtype);
				local color = GetColorRGBA(coloridx);
				if color.a < 252 then
				local newcolor = GetColorIndex(color.r,color.g,color.b,color.a+4);
				Win_SetValue("UI.gameui.questiondlg.questionedit",newcolor,value_channel_color_draw);
				Win_SetValue("UI.gameui.questiondlg.questionedit",newcolor,value_channel_customtype);
				Win_SetValue("UI.gameui.questiondlg",0.01,value_channel_timerspace);
				else
				Win_SetValue("UI.gameui.questiondlg",-1,value_channel_timerspace);
				end;
				end;
			
			
			OnCancel=function()
				local bclose = Win_GetValue("UI.gameui.questiondlg.closebtn",value_channel_customtype);
				if bclose ~= 0 then
					QuitQuestion();
					Win_ShowWidget("UI.gameui.questiondlg", false);
				else
					Win_ShowMsgBox("答题期间不允许关闭对话框！","系统消息",ui_msgid_close);
				end;
				end;
			
			children=
			{
				mideffect=
				{
					type="WIDGET";
					rect={169,236,2,2};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_answereffectm,
					initlayer=msgbox_layer,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={305,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 286,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("海选答题");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				questionedit=
				{
					type="MULTIEDIT",
					rect={38,52,243,102};
					textsize=16,
					textstyle=dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_copydisable,	
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,		

					primaryscroll="UI.gameui.questiondlg.questionscroll";
				};	
				
				questionscroll=
				{
			
					type="SCROLLBAR",
					rect={287,68,15,68},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.questiondlg.questionedit";
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,	
						};--spindown
						
					};--children
					
				};--scroll

				answerlist=
				{
					type="LISTBOX";
					rect={36,197,232,130};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_answerlist,
					itemtextstyle=dt_left+dt_vcenter+dt_magicedge;
					itemwidth=232,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=2,	
					textsize=12,	
					updatemute=1,
					
					OnClick=function(sel)
						if sel>=0 then
						SetAnswerOption(sel);
						end;
						end;
				};

				star0=
				{
					type="WIDGET";
					rect={270,197,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=0,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
										
					OnDBClick=function()
						UseAnswerStar(0);
						end;
				};

				star1=
				{
					type="WIDGET";
					rect={270,238,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=1,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnDBClick=function()
						UseAnswerStar(1);
						end;
				};

				star2=
				{
					type="WIDGET";
					rect={270,279,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=2,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnDBClick=function()
						UseAnswerStar(2);
						end;
				};

				numlabel=
				{
					type="LABEL",
					rect={60,173,41,12},
					textsize=12,
					textstyle=dt_center,
				};
				
				totalnumlabel=
				{
					type="LABEL",
					rect={145,173,41,12},
					textsize=12,
					textstyle=dt_center,
				};

				timelabel=
				{
					type="PICLABEL",
					rect={249,171,66,16},
					textstyle=dt_center,
					fontpic = "res/uires/common/fontpic.gsa",
				};

			};
		};
		
		finalquestiondlg=
		{
			type="DIALOG";
			rect={98,94,376,392};
			captionrect={86,14,180,12},
			textstyle=dt_left,
			textfont=1,
			textsize=12,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself+wgtstyle_customclose,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			bkimage="res/uires/wisdomcompete/finalquestiondlgbk.gsa",
			visible=0,	
			moveable=1,
			drawflag=drawflag_none,
			
			OnPlayQuestionTextEffect=function()
			
				Win_SetValue("UI.gameui.finalquestiondlg.answerlist",0,value_channel_customindex);
				
				local coloridx = Win_GetValue("UI.gameui.finalquestiondlg.questionedit",value_channel_color_draw);
				local color = GetColorRGBA(coloridx);
				Win_SetValue("UI.gameui.finalquestiondlg.questionedit",GetColorIndex(color.r,color.g,color.b,0),value_channel_customtype);
				Win_SetValue("UI.gameui.finalquestiondlg",0.01,value_channel_timerspace);
				end;	
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.finalquestiondlg.timelabel",0,value_channel_customtype);
				end;
			
			OnSetTime=function(timenum)
				local t=Win_GetValue("UI.gameui.finalquestiondlg.timelabel",value_channel_customtype);
				if t < 1 then
				Win_SetValue("UI.gameui.finalquestiondlg.timelabel",timenum*10,value_channel_customtype);
				Win_SetValue("UI.gameui.finalquestiondlg.progbar",timenum*10,value_channel_maxvalue);
				Win_SetValue("UI.gameui.finalquestiondlg.timelabel",0.1,value_channel_timerspace);
				Win_SetValue("UI.gameui.finalquestiondlg.progbar",0.1,value_channel_timerspace);
				Win_SetValue("UI.gameui.finalquestiondlg.timelabel",GetSysTime(),value_channel_customindex);
				Win_SetValue("UI.gameui.finalquestiondlg.timelabel",timenum*1000,value_channel_customid);
				
				end;
				end;
			
			OnTimer=function()
				local coloridx = Win_GetValue("UI.gameui.finalquestiondlg.questionedit",value_channel_customtype);
				local color = GetColorRGBA(coloridx);
				if color.a < 252 then
				local newcolor = GetColorIndex(color.r,color.g,color.b,color.a+4);
				Win_SetValue("UI.gameui.finalquestiondlg.questionedit",newcolor,value_channel_color_draw);
				Win_SetValue("UI.gameui.finalquestiondlg.questionedit",newcolor,value_channel_customtype);
				Win_SetValue("UI.gameui.finalquestiondlg",0.01,value_channel_timerspace);
				else
				Win_SetValue("UI.gameui.finalquestiondlg",-1,value_channel_timerspace);
				
				end;
				
				if color.a < 98 then
					Win_SetValue("UI.gameui.finalquestiondlg.answerlist",0,value_channel_customindex);
				else
					Win_SetValue("UI.gameui.finalquestiondlg.answerlist",1,value_channel_customindex);
				end;
				
				end;
			
			
			OnCancel=function()
				local bclose = Win_GetValue("UI.gameui.finalquestiondlg.closebtn",value_channel_customtype);
				if bclose == 0 then
					Win_ShowMsgBox("您确定要退出答题吗?","系统消息",ui_msgid_yesno,"UI.gameui.finalquestiondlg");
				else
					Win_ShowMsgBox("是否关闭对话框?","系统消息",ui_msgid_yesno,"UI.gameui.finalquestiondlg");
				end;
				end;
			
			OnMsgBoxOk=function()
				QuitQuestion();
				Win_ShowWidget("UI.gameui.finalquestiondlg", false);
				end;
			
			children=
			{
				mideffect=
				{
					type="WIDGET";
					rect={169,236,2,2};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_answereffectm,
					initlayer=msgbox_layer,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={351,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 331,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("海选答题");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				questionedit=
				{
					type="MULTIEDIT",
					rect={38,52,289,102};
					textsize=16,
					textstyle=dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_copydisable,	
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,		

					primaryscroll="UI.gameui.finalquestiondlg.questionscroll";
				};	
				
				questionscroll=
				{
			
					type="SCROLLBAR",
					rect={242,68,15,68},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.finalquestiondlg.questionedit";
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,	
						};--spindown
						
					};--children
					
				};--scroll

				
				star0=
				{
					type="WIDGET";
					rect={224,332,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=0,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
										
					OnDBClick=function()
						local benable = Win_GetValue("UI.gameui.finalquestiondlg.answerlist",value_channel_customindex);
						if benable~=0 then
							UseAnswerStar(0);
						else
							GameUILogInfo("此道具受时间限制,请稍后再试!");
						end;
						end;
				};

				star1=
				{
					type="WIDGET";
					rect={267,332,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=1,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnDBClick=function()
						local benable = Win_GetValue("UI.gameui.finalquestiondlg.answerlist",value_channel_customindex);
						if benable~=0 then
							UseAnswerStar(1);
						else
							GameUILogInfo("此道具受时间限制,请稍后再试!");
						end;
						end;
				};

				star2=
				{
					type="WIDGET";
					rect={310,332,36,36};
					style=wgtstyle_static+wgtstyle_colortest+wgtstyle_alphawin,
					dragtype=ui_drag_type_answer_star,
					dragindex=2,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnDBClick=function()
						local benable = Win_GetValue("UI.gameui.finalquestiondlg.answerlist",value_channel_customindex);
						if benable~=0 then
							UseAnswerStar(2);
						else
							GameUILogInfo("此道具受时间限制,请稍后再试!");
						end;
						end;
				};
				
				answerlist=
				{
					type="LISTBOX";
					rect={32,235,182,130};
					--style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_answerlist,
					itemtextstyle=dt_left+dt_vcenter+dt_magicedge;
					itemwidth=180,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=2,	
					textsize=12,	
					updatemute=1,
					
					OnClick=function(sel)
						local benable = Win_GetValue("UI.gameui.finalquestiondlg.answerlist",value_channel_customindex);
						
						if sel>=0 and benable~=0 then
						SetAnswerOption(sel);
						end;
						end;
				};
				
				progbar=
				{
					type="PROGRESSBAR",
					rect={26,172,248,15},
					progresscover="res/uires/wisdomcompete/progbar.gsa",
					enable=1,
					
					OnTimer=function()
						local t=Win_GetValue("UI.gameui.finalquestiondlg.timelabel",value_channel_customtype);
						if t > 0 then
						Win_SetValue("UI.gameui.finalquestiondlg.progbar",t-1,value_channel_pos);
						Win_SetValue("UI.gameui.finalquestiondlg.progbar",0.1,value_channel_timerspace);
						else
						Win_SetValue("UI.gameui.finalquestiondlg.progbar",0,value_channel_pos);
						Win_SetValue("UI.gameui.finalquestiondlg.progbar",-1,value_channel_timerspace);
						end;
						end;
				};
				
				rightnumlabel=
				{
					type="LABEL",
					rect={60,204,41,12},
					textsize=12,
					textstyle=dt_center,
				};
				
				wrongnumlabel=
				{
					type="LABEL",
					rect={147,204,41,12},
					textsize=12,
					textstyle=dt_center,
				};
				
				giveupnumlabel=
				{
					type="LABEL",
					rect={233,204,41,12},
					textsize=12,
					textstyle=dt_center,
				};
				
				scorelabel=
				{
					type="LABEL",
					rect={318,204,41,12},
					textsize=12,
					textstyle=dt_center,
				};
				
				timelabel=
				{
					type="LABEL",
					rect={288,174,66,14},
					textstyle=dt_center,
					textsize=12,
					
					OnTimer=function()
						local t=Win_GetValue("UI.gameui.finalquestiondlg.timelabel",value_channel_customtype);
						if t > 0 then
						tstart = Win_GetValue("UI.gameui.finalquestiondlg.timelabel",value_channel_customindex);
						tleft = Win_GetValue("UI.gameui.finalquestiondlg.timelabel",value_channel_customid);
						tend = GetSysTime();
						tdelta = tend - tstart;
						tleft = tleft - tdelta;
						Win_SetText("UI.gameui.finalquestiondlg.timelabel",math.floor(tleft/1000)+1);
						Win_SetValue("UI.gameui.finalquestiondlg.timelabel",math.floor(tleft/100),value_channel_customtype);
						Win_SetValue("UI.gameui.finalquestiondlg.timelabel",0.1,value_channel_timerspace);
						else
						Win_SetValue("UI.gameui.finalquestiondlg.timelabel",0,value_channel_customtype);
						Win_SetText("UI.gameui.finalquestiondlg.timelabel",0);
						Win_SetValue("UI.gameui.finalquestiondlg.timelabel",-1,value_channel_timerspace);
						end;
						end;
				};

				
				resultlabel=
				{
					type="WIDGET",
					rect={235,238,93,77},
					style=wgtstyle_renderbuffer+wgtstyle_clipself,
					custombuffer=custom_buffer_quesionscore,
				};
			};
		};
		
		answerhistorydlg=
		{
			type="DIALOG";
			rect={71,70,330,243};
			textstyle=dt_center,
			textfont=1,
			textsize=12,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself,			
			bkimage="res/uires/wisdomcompete/answerhistorydlgbk.gsa",
			moveable=1,
			visible=0,	
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.answerhistorydlg");
				end;
		
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={304,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 285,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("答题历史");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				content=
				{
					type="MULTIEDIT";
					rect={38,56,242,155};
					textsize=12,	
					textstyle=dt_left,
					editable=0,
					maxchar=20000,
					updatemute=1,
					
					
					primaryscroll="UI.gameui.answerhistorydlg.answerscroll",
				};
					
				answerscroll=
				{
			
					type="SCROLLBAR",
					rect={286,70,15,121},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.answerhistorydlg.content",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,	
						};--spindown
						
					};--children
					
				};--scroll
		
			};
		};
		
		answerresultrankdlg=
		{
			type="DIALOG";
			rect={72,85,423,283};
			--rect={72,85,423,477};
			textstyle=dt_center,
			textfont=1,
			textsize=12,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself,			
			bkimage="res/uires/wisdomcompete/answerresultrankdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_vcenter+alignstyle_hcenter,
			moveable=1,
			visible=0,	
			updatemute=1,
		
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={397,9,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 378,9,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("海选排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				myrank=
				{
					type="LABEL",
					rect={99,237,59,13},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				list=
				{
					type="LISTBOX";
					rect={35,75,340,133};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_answerresultlist,
					itemwidth=340,
					itemheight=25,
					itemmarginh=0,
					itemmarginv=4,	
					textsize=12,				
					updatemute=1,
					
					primaryscroll="UI.gameui.answerresultrankdlg.rankscroll",
				};
		
				--[[manifestoedit=
				{
					type="MULTIEDIT";
					rect={33,283,345,156};
					textsize=12,
					editable=0,
					
					primaryscroll="UI.gameui.answerresultrankdlg.manifestoscroll",
				};]]
				
				rankscroll=
				{
					type="SCROLLBAR",
					rect={384,68,15,118},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.answerresultrankdlg.list",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				--[[manifestoscroll=
				{
					type="SCROLLBAR",
					rect={383,298,15,123},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.answerresultrankdlg.manifestoedit",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				]]
			};
		};
		
		allanswerresultrankdlg=
		{
			type="DIALOG";
			rect={72,85,423,367};
			textstyle=dt_center,
			textfont=1,
			textsize=12,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself,			
			bkimage="res/uires/wisdomcompete/allanswerresultrankdlgbk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_vcenter+alignstyle_hcenter,
			moveable=1,
			visible=0,	
			updatemute=1,
		
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={398,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 379,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("海选排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				list=
				{
					type="LISTBOX";
					rect={35,75,340,260};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_allanswerresultlist,
					itemwidth=340,
					itemheight=25,
					itemmarginh=0,
					itemmarginv=4,	
					textsize=12,				
					updatemute=1,
					
					primaryscroll="UI.gameui.allanswerresultrankdlg.rankscroll",
				};
				
				rankscroll=
				{
					type="SCROLLBAR",
					rect={385,68,15,243},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.allanswerresultrankdlg.list",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};

		manifestoinfodlg=
		{
				
			type="DIALOG",
			rect={0,0,289,274},
			textsize=12,
			textfont=1,
			bkimage="res/uires/wisdomcompete/manifestoinfodlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()	
				Win_SetText("UI.gameui.manifestoinfodlg.contentedit","");
				Win_SetFocus("UI.gameui.manifestoinfodlg.contentedit");
				end;
					   
					   
			OnOk=function()	
				infotxt=Win_GetText("UI.gameui.manifestoinfodlg.contentedit");				
				--RegMIntroduce(infotxt);
				Win_ShowWidget("UI.gameui.manifestoinfodlg",false);
				end;			
								
			OnCancel=function()
			     Win_ShowWidget("UI.gameui.manifestoinfodlg",false);				     
			     end;
			     
			OnEnter=function()
			     Win_EndWidget("UI.gameui.manifestoinfodlg",true);				     
			     end;
			
			OnEscape=function()
			     Win_EndWidget("UI.gameui.manifestoinfodlg",false);				     
			     end;
			
			children=
			{	
				closebtn=
				{
					type="BUTTON",
					rect={263,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 244,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("至尊宣言");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={36,246,58,22},
					bkimage="res/uires/wisdomcompete/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},					
				},
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={204,246,58,22},
					bkimage="res/uires/wisdomcompete/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				},
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={28,62,244,158},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=126,	
					
				};
			
			};
			
		};
		
		--春节活动
		fmvoterankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmvoterankdlgbk.gsa";
			rect={0,0,347,309};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmvoterankdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fmvoterankdlg.fmlist",10,value_channel_item_num);
				Win_SetValue("UI.gameui.fmvoterankdlg.fmlist",0,value_channel_sel);
				
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.ranklabel","");
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.namelabel","");
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.numlabel","");
				Win_SetText("UI.gameui.fmvoterankdlg.myfm.ranklabel","");
				Win_SetText("UI.gameui.fmvoterankdlg.myfm.namelabel","");
				Win_SetText("UI.gameui.fmvoterankdlg.myfm.numlabel","");
				
				local info = GetFmVoteRankInfo(50);
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.ranklabel",info.rank);
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.namelabel",info.name);
				Win_SetText("UI.gameui.fmvoterankdlg.fivetyfm.numlabel",info.num);
				
				info = GetFmVoteRankInfo(0);
				if info.name == "" then
					Win_SetText("UI.gameui.fmvoterankdlg.myfm.namelabel","你未加入家族");
				else
					Win_SetText("UI.gameui.fmvoterankdlg.myfm.ranklabel",info.rank);
					Win_SetText("UI.gameui.fmvoterankdlg.myfm.namelabel",info.name);
					Win_SetText("UI.gameui.fmvoterankdlg.myfm.numlabel",info.num);
				end;
				end;

			children=
			{
				fmlist=
				{
					type="LISTBOX";
					rect={33,73,264,146};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fmvoteranklist,
					itemwidth=264,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fmvoterankdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={303,72,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmvoterankdlg.fmlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				fivetyfm=
				{
					type="WIDGET";
					rect={33,240,264,16};
					tiptext="第50名家族得票信息",

					children=
					{
						ranklabel=
						{
							type="LABEL";
							rect={2,1,34,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						namelabel=
						{
							type="LABEL";
							rect={36,1,101,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						numlabel=
						{
							type="LABEL";
							rect={138,1,125,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};
				};

				myfm=
				{
					type="WIDGET";
					rect={33,259,264,15};
					tiptext="本家族得票信息",
					
					children=
					{
						ranklabel=
						{
							type="LABEL";
							rect={2,1,34,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						namelabel=
						{
							type="LABEL";
							rect={36,1,101,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						numlabel=
						{
							type="LABEL";
							rect={138,1,125,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 301,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族得票排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		fmbonusrankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmbonusrankdlgbk.gsa";
			rect={0,0,347,290};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmbonusrankdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fmbonusrankdlg.fmlist",10,value_channel_item_num);
				Win_SetValue("UI.gameui.fmbonusrankdlg.fmlist",0,value_channel_sel);
				
				Win_SetText("UI.gameui.fmbonusrankdlg.myfm.ranklabel","");
				Win_SetText("UI.gameui.fmbonusrankdlg.myfm.namelabel","");
				Win_SetText("UI.gameui.fmbonusrankdlg.myfm.numlabel","");
				
				local info = GetFmBonusRankInfo(0);
				if info.name == "" then
					Win_SetText("UI.gameui.fmbonusrankdlg.myfm.namelabel","你未加入家族");
				else
					Win_SetText("UI.gameui.fmbonusrankdlg.myfm.ranklabel",info.rank);
					Win_SetText("UI.gameui.fmbonusrankdlg.myfm.namelabel",info.name);
					Win_SetText("UI.gameui.fmbonusrankdlg.myfm.numlabel",info.num);
				end;
				end;

			children=
			{
				fmlist=
				{
					type="LISTBOX";
					rect={35,73,264,146};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fmbonusranklist,
					itemwidth=264,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fmbonusrankdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={305,72,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmbonusrankdlg.fmlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				myfm=
				{
					type="WIDGET";
					rect={35,240,264,16};
					tiptext="本家族积分信息",

					children=
					{
						ranklabel=
						{
							type="LABEL";
							rect={2,1,34,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						namelabel=
						{
							type="LABEL";
							rect={36,1,101,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						numlabel=
						{
							type="LABEL";
							rect={138,1,125,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};
				};

				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 301,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族积分排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		
		--家族成员参赛资格设定
		fmmemlistdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmmemlistdlgbk.gsa";
			rect={43,110,337,299};
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmmemlistdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				local num = GetMyFamilyMemNum();
				local standbynum = GetActivityStandbyMemNum();
				Win_SetValue("UI.gameui.fmmemlistdlg.memlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.fmmemlistdlg.addlist",standbynum,value_channel_item_num);
				
				if num > 0 then
					Win_SetValue("UI.gameui.fmmemlistdlg.memlist",0,value_channel_sel);
				else
					Win_SetValue("UI.gameui.fmmemlistdlg.memlist",-1,value_channel_sel);
				end;
				if standbynum >0 then
					Win_SetValue("UI.gameui.fmmemlistdlg.addlist",0,value_channel_sel);
				else
					Win_SetValue("UI.gameui.fmmemlistdlg.addlist",-1,value_channel_sel);
				end;
				
				local reglimit = GetRegLimit();
				Win_SetText("UI.gameui.fmmemlistdlg.numlabel", standbynum.."/"..reglimit);
				
				SetGlobalQuery(GlobalQuery_FmMemRegDlg, 1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_FmMemRegDlg, 0);
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmmemlistdlg",false);
				end;

			children=
			{
				numlabel=
				{
					type="LABEL";
					rect={261,67,54,15};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				memlist=
				{
					type="LISTBOX";
					rect={33,75,75,161};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fmmemlistl,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 73, 20},
					itemwidth=75,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fmmemlistdlg.memscroll",
				};

				memscroll=
				{
					type="SCROLLBAR";
					rect={115,90,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmmemlistdlg.memlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				addlist=
				{
					type="LISTBOX";
					rect={216,98,75,139};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fmmemlistr,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 73, 20},
					itemwidth=75,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fmmemlistdlg.addscroll",
				};

				addscroll=
				{
					type="SCROLLBAR";
					rect={297,113,15,107};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmmemlistdlg.addlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				addbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_addbtn.gsa";
					rect={144,112,57,22};
					
					OnClick=function()
						local reglimit = GetRegLimit();
						local standbynum = Win_GetValue("UI.gameui.fmmemlistdlg.addlist",value_channel_item_num);
						if standbynum >= reglimit then
							Win_ShowMsgBox("已达到最大人数上限："..reglimit.."人");
						else
							local sel = Win_GetValue("UI.gameui.fmmemlistdlg.memlist",value_channel_sel);
							if sel >= 0 then
								local result = ActivityMemListOperate(0,sel);
								if result ~= 0 then
									local numr = GetActivityStandbyMemNum();
									Win_SetValue("UI.gameui.fmmemlistdlg.addlist",numr,value_channel_item_num);
									if numr > 0 then
										Win_SetValue("UI.gameui.fmmemlistdlg.addlist",numr-1,value_channel_sel);
									end;
									
									Win_SetText("UI.gameui.fmmemlistdlg.numlabel", numr.."/"..reglimit);
								else
									GameUILogInfo("该成员已经添加到列表！");
								end;
								
							else
								GameUILogInfo("请选择添加对象！");
							end;
						end;
						end;
				};

				delbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_delbtn.gsa";
					rect={143,173,57,22};
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.fmmemlistdlg.addlist",value_channel_sel);
						if sel >= 0 then
							local  result = ActivityMemListOperate(1,sel);
							if result ~= 0 then
								local numr = GetActivityStandbyMemNum();
								Win_SetValue("UI.gameui.fmmemlistdlg.addlist",numr,value_channel_item_num);
								
								local reglimit = GetRegLimit();
								Win_SetText("UI.gameui.fmmemlistdlg.numlabel", numr.."/"..reglimit);
							else
								GameUILogInfo("无法删除该对象！");
							end;
						else
							GameUILogInfo("请选择删除对象！");
						end;
						end;
				};

				affirmbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_affirmbtn.gsa";
					rect={59,256,58,22};
					defaultok=1;
					
					OnClick=function()
						AffirmActivityMemList();
						end;
				};

				cancelbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_cancelbtn.gsa";
					rect={223,257,58,22};
					defaultcancel=1;
				};
				closebtn=
				{
					type="BUTTON",
					rect={311,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 291,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族成员参赛资格");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		--新家族活动
		memcfgdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/memcfgdlgbk.gsa";
			rect={0,0,336,299};
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.memcfgdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				local num = GetFPMemNum();
				local standbynum = FPGetActivityStandbyMemNum();
				Win_SetValue("UI.gameui.memcfgdlg.memlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.memcfgdlg.addlist",standbynum,value_channel_item_num);
				
				if num > 0 then
					Win_SetValue("UI.gameui.memcfgdlg.memlist",0,value_channel_sel);
				else
					Win_SetValue("UI.gameui.memcfgdlg.memlist",-1,value_channel_sel);
				end;
				if standbynum >0 then
					Win_SetValue("UI.gameui.memcfgdlg.addlist",0,value_channel_sel);
				else
					Win_SetValue("UI.gameui.memcfgdlg.addlist",-1,value_channel_sel);
				end;
				
				local reglimit = FPGetRegLimit();
				Win_SetText("UI.gameui.memcfgdlg.numlabel", standbynum.."/"..reglimit);
				
				local fpbonus = FPGetRegMemBonus();
				Win_SetText("UI.gameui.memcfgdlg.scorelabel", fpbonus);
				
				Win_SetValue("UI.gameui.memcfgdlg.affirmbtn",0,value_channel_customindex);
				
				SetGlobalQuery(GlobalQuery_FPMemRegDlg, 1);
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_FPMemRegDlg, 0);
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.memcfgdlg",false);
				end;

			children=
			{
				displaycheck=
				{
					type="CHECK",
					rect = {138, 44, 70, 15},
					bkimage = "res/uires/common/checkbox.gsa",	
					bcheck=0,
					
					OnCheck=function(bcheck)
						SetFPMemOnline(bcheck);
						local num = GetFPMemNum();
						Win_SetValue("UI.gameui.memcfgdlg.memlist",num,value_channel_item_num);
						if num > 0 then
							Win_SetValue("UI.gameui.memcfgdlg.memlist",0,value_channel_sel);
						else
							Win_SetValue("UI.gameui.memcfgdlg.memlist",-1,value_channel_sel);
						end;
					end;
				},
				
				scorelabel=
				{
					type="LABEL";
					rect={167,82,36,15};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				numlabel=
				{
					type="LABEL";
					rect={286,43,38,15};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				memlist=
				{
					type="LISTBOX";
					rect={33,75,75,161};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fpmemlist,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 73, 20},
					itemwidth=75,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.memcfgdlg.memscroll",
				};

				memscroll=
				{
					type="SCROLLBAR";
					rect={115,90,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.memcfgdlg.memlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				addlist=
				{
					type="LISTBOX";
					rect={216,75,75,162};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fpregmemlist,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 73, 20},
					itemwidth=75,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.memcfgdlg.addscroll",
				};

				addscroll=
				{
					type="SCROLLBAR";
					rect={297,90,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.memcfgdlg.addlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				addbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_addbtn.gsa";
					rect={144,124,57,22};
					
					OnMsgBoxOk=function()
						local sel = Win_GetValue("UI.gameui.memcfgdlg.memlist",value_channel_sel);
						FPAddRegMemLimite();
						FPReqAddLimitMem(sel);
						end;
					
					OnClick=function()
						local reglimit = FPGetRegLimit();
						local standbynum = Win_GetValue("UI.gameui.memcfgdlg.addlist",value_channel_item_num);
						
						if standbynum >= reglimit then
							local fpbonus = FPGetRegMemBonus();
							if fpbonus <= 0 or reglimit >= 20 then--最大人数上限20人
								Win_ShowMsgBox("已达到最大人数上限："..reglimit.."人");
							else
								Win_ShowMsgBox("已达到人数上限"..reglimit.."人，是否用积分兑换人数上限？","系统消息",ui_msgid_yesno,"UI.gameui.memcfgdlg.addbtn");
							end;
						else
							local sel = Win_GetValue("UI.gameui.memcfgdlg.memlist",value_channel_sel);
							if sel >= 0 then
								local result = FPActivityMemListOperate(0,sel);
								if result ~= 0 then
									local numr = FPGetActivityStandbyMemNum();
									Win_SetValue("UI.gameui.memcfgdlg.addlist",numr,value_channel_item_num);
									if numr > 0 then
										Win_SetValue("UI.gameui.memcfgdlg.addlist",numr-1,value_channel_sel);
									end;
									
									Win_SetText("UI.gameui.memcfgdlg.numlabel", numr.."/"..reglimit);
								else
									GameUILogInfo("该成员已经添加到列表！");
								end;
								
							else
								GameUILogInfo("请选择添加对象！");
							end;
						end;
						end;
				};

				delbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_delbtn.gsa";
					rect={143,173,57,22};
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.memcfgdlg.addlist",value_channel_sel);
						if sel >= 0 then
							local  result = FPActivityMemListOperate(1,sel);
							if result ~= 0 then
								local numr = FPGetActivityStandbyMemNum();
								Win_SetValue("UI.gameui.memcfgdlg.addlist",numr,value_channel_item_num);
								
								local reglimit = FPGetRegLimit();
								Win_SetText("UI.gameui.memcfgdlg.numlabel", numr.."/"..reglimit);
							else
								GameUILogInfo("无法删除该对象！");
							end;
						else
							GameUILogInfo("请选择删除对象！");
						end;
						end;
				};

				affirmbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_affirmbtn.gsa";
					rect={59,256,58,22};
					defaultok=1;
					
					OnClick=function()
						local bhold = Win_GetValue("UI.gameui.memcfgdlg.affirmbtn",value_channel_customindex);
						if (bhold == 0) then
							Win_SetValue("UI.gameui.memcfgdlg.affirmbtn",1,value_channel_customindex);
							Win_SetValue("UI.gameui.memcfgdlg.affirmbtn",0.2,value_channel_timerspace);
							AffirmFPRegList();
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.memcfgdlg.affirmbtn",0,value_channel_customindex);
						end;
				};

				cancelbtn=
				{
					type="BUTTON";
					bkimage="res/uires/activity/fmmemlst_cancelbtn.gsa";
					rect={223,257,58,22};
					defaultcancel=1;
				};
				closebtn=
				{
					type="BUTTON",
					rect={311,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 291,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族成员参赛资格");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		
		--家族个人所得积分查询
		fmmembonusrankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmmembonusrankdlgbk.gsa";
			rect={0,0,287,251};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmmembonusrankdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				--Win_SetValue("UI.gameui.fmmembonusrankdlg.memlist",10,value_channel_item_num);
				--Win_SetValue("UI.gameui.fmmembonusrankdlg.memlist",0,value_channel_sel);
				
				end;

			children=
			{
				memlist=
				{
					type="LISTBOX";
					rect={35,73,204,146};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fmmembonusranklist,
					itemwidth=204,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					textsize=12,				

					primaryscroll="UI.gameui.fmmembonusrankdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={246,72,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmmembonusrankdlg.memlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				

				closebtn=
				{
					type="BUTTON",
					rect={262,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 242,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族个人积分排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		
		--家族所得票数
		myfmvotenumdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/myfmvotenumdlgbk.gsa";
			rect={0,0,227,251};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_SetText("UI.gameui.myfmvotenumdlg.fmnamelabel","");	
				Win_SetText("UI.gameui.myfmvotenumdlg.votenumlabel","");
				Win_SetText("UI.gameui.myfmvotenumdlg.fmnuminfolabel","");
				end;

			children=
			{
				fmnamelabel=
				{
					type="LABEL",
					rect={32,75,89,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				votenumlabel=
				{
					type="LABEL",
					rect={122,75,126,19},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				fmnuminfolabel=
				{
					type="LABEL",
					rect={31,116,218,16},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={253,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 233,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族所得票数");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		--家族投票兑换列表
		fmvoteexchgdlg=
		{
			type="DIALOG",
			rect={184,48,566,416},				
			bkimage="res/uires/activity/fmexchgdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmvoteexchgdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fmvoteexchgdlg.leftscroll",0,value_channel_pos);
				SetGlobalQuery(GlobalQuery_FmMemExchangeDlg,1);
				local num = GetExchangeItems();
				Win_SetValue("UI.gameui.fmvoteexchgdlg.leftlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.fmvoteexchgdlg.rightlist",0,value_channel_item_num);
				
				Win_EnableWidget("UI.gameui.fmvoteexchgdlg.exchangebtn",true);
				
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_FmMemExchangeDlg,0);
				EndFPExchange();
				end;
			
			OnOk=function()
				  AffirmFPExchange(); 
				  end;
				  
			OnCancel=function()
				  EndFPExchange(); 
				  end;

				  
			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 540,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 520,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族投票兑换界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				votebtn= 
				{
					type = "BUTTON",
					rect = {295,386,90,22},
					bkimage="res/uires/activity/exvotebtn.gsa",
					
					OnClick=function()
						FPVoteForFm();
						end;
				};
				
				exchangebtn= 
				{
					type = "BUTTON",
					rect = {390,386,90,22},
					bkimage="res/uires/activity/exexchangebtn.gsa",
					
					OnClick=function()
						  AffirmFPExchange(); 
						  Win_EnableWidget("UI.gameui.fmvoteexchgdlg.exchangebtn",false);
						  Win_SetValue("UI.gameui.fmvoteexchgdlg.exchangebtn",1,value_channel_timerspace);
						  end;
						
					OnTimer=function()
						Win_EnableWidget("UI.gameui.fmvoteexchgdlg.exchangebtn",true);
						end;
				},
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = {485,386,70,22},
					bkimage="res/uires/common/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				},

				leftlist=
				{
					type="WIDGETLIST",
					rect={32,45,228,331},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_buylist,
					dragindex=-1,
					primaryscroll="UI.gameui.fmvoteexchgdlg.leftscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/fmmemexchgiteml.lua"};
					
					children={},
					
				},--list
				
				leftscroll=
				{
			
					type="SCROLLBAR",
					rect={265,55,15,310},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmvoteexchgdlg.leftlist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				rightlist=
				{
					type="WIDGETLIST",
					rect={302,41,229,337},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_selbuylist,
					dragindex=-1,
					primaryscroll="UI.gameui.fmvoteexchgdlg.rightscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/fmmemexchgitemr.lua"};
					
					children={},
					
				},--list
				
				rightscroll=
				{
			
					type="SCROLLBAR",
					rect={543,51,15,312},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmvoteexchgdlg.rightlist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
						};--spindown
						
					};--children
					
				};--scroll
			},
		
		};
		
		
		--家族战场排名
		fmfieldrankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmfieldrankdlg.gsa";
			rect={0,0,361,318};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fmfieldrankdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fmfieldrankdlg.fmlist",10,value_channel_item_num);
				Win_SetValue("UI.gameui.fmfieldrankdlg.fmlist",0,value_channel_sel);
				
				Win_SetText("UI.gameui.fmfieldrankdlg.myfm.ranklabel","");
				Win_SetText("UI.gameui.fmfieldrankdlg.myfm.namelabel","");
				Win_SetText("UI.gameui.fmfieldrankdlg.myfm.numlabel","");
				
				local info = GetFPFieldRankInfo();
				if info.name == "" then
					Win_SetText("UI.gameui.fmfieldrankdlg.myfm.namelabel","你未加入家族");
				else
					Win_SetText("UI.gameui.fmfieldrankdlg.myfm.ranklabel",info.rank);
					Win_SetText("UI.gameui.fmfieldrankdlg.myfm.namelabel",info.name);
					Win_SetText("UI.gameui.fmfieldrankdlg.myfm.numlabel",info.num);
				end;
				end;

			children=
			{
				fmlist=
				{
					type="LISTBOX";
					rect={35,74,264,155};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fpfieldranklist,
					itemwidth=264,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fmfieldrankdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={305,74,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fmfieldrankdlg.fmlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				myfm=
				{
					type="WIDGET";
					rect={35,250,264,16};
					tiptext="本家族战场排名",

					children=
					{
						ranklabel=
						{
							type="LABEL";
							rect={2,1,34,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						namelabel=
						{
							type="LABEL";
							rect={36,1,101,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						numlabel=
						{
							type="LABEL";
							rect={138,1,125,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};
				};

				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 301,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族战场排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		--领地战投票查看
		landvoterankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/landvoterankdlgbk.gsa";
			rect={0,0,274,379};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				local info = GetLandVoteInfo();
				Win_SetText("UI.gameui.landvoterankdlg.lastweeklandFm", info.landername);
				Win_SetText("UI.gameui.landvoterankdlg.taxforfight", info.taxforfight);
				Win_SetText("UI.gameui.landvoterankdlg.myfmvotenum", info.selfvotenum);
				Win_SetValue("UI.gameui.landvoterankdlg.fmlist",info.listnum,value_channel_item_num);
				for i=1,info.listnum do
					local info2 = GetLandFmInfo(i-1);
					Win_SetText("UI.gameui.landvoterankdlg.fmlist.landvoterankitem"..tostring(i-1)..".NO_lbl", "第"..i.."名");
					Win_SetText("UI.gameui.landvoterankdlg.fmlist.landvoterankitem"..tostring(i-1)..".name_lbl", info2.faname);
					Win_SetText("UI.gameui.landvoterankdlg.fmlist.landvoterankitem"..tostring(i-1)..".votenum_lbl", info2.votenum.."票");
				end;
			end;

			children=
			{
				fmlist=
				{
					type="WIDGETLIST";
					rect={43,116,212,221};
					--style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					itemwidth=226,
					itemheight=16,
					itemmarginh=0,
					itemmarginv=2,	
					itemnum=11,
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter,
					
					template={"res/uires/landvoterankitem.lua"};
					
					children={},
				};

				lastweeklandFm=
				{
					type="LABEL",
					rect={120,50,140,16},
					visible=1,
					textsize=12,
					enable=1,
				},
				
				taxforfight=
				{
					type="LABEL",
					rect={120,70,54,16},
					visible=1,
					textsize=12,
					enable=1,
				},
				
				myfmvotenum=
				{
					type="LABEL",
					rect={158,349,92,16},
					visible=1,
					textsize=12,
					enable=1,
				},

				closebtn=
				{
					type="BUTTON",
					rect={246,22,20,19},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
			};
		};
		
		
		--领地战参战家族成员管理
		landfmmemmgrdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/landfmmemmgr.gsa";
			rect={0,0,502,349};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				local num1 = GetLandFmMemNum(0);
				local num2 = GetLandFmMemNum(1);
				local num3 = GetLandFmMemNum(2);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", num1, value_channel_item_num);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.battlememlist", num2, value_channel_item_num);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", num3, value_channel_item_num);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", -1, value_channel_sel);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.battlememlist", -1, value_channel_sel);
				Win_SetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", -1, value_channel_sel);
				for i=0, num1-1 do
					local info = GetLandFmMemInfo(0, i);
					-- 为保持列对齐，添加空字符
					local namespacenum = 14 - string.len(info.name);
					local profspacenum = 9 - string.len(info.prof);
					local namespace = "";
					local profspace = "";
					if namespacenum > 0 then
						namespace = string.format("%"..namespacenum.."s", "");
					end;
					if profspacenum > 0 then
						profspace = string.format("%"..profspacenum.."s", "");
					end;
					
					if info.isonline == 1 then
						Win_SetText("UI.gameui.landfmmemmgrdlg.memberlist", info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					else 
						Win_SetText("UI.gameui.landfmmemmgrdlg.memberlist", "/C18"..info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					end;
				end;
				
				for i=0, num2-1 do
					local info = GetLandFmMemInfo(1, i);
					local namespacenum = 14 - string.len(info.name);
					local profspacenum = 9 - string.len(info.prof);
					local namespace = "";
					local profspace = "";
					if namespacenum > 0 then
						namespace = string.format("%"..namespacenum.."s", "");
					end;
					if profspacenum > 0 then
						profspace = string.format("%"..profspacenum.."s", "");
					end;					
					if info.isonline == 1then
						Win_SetText("UI.gameui.landfmmemmgrdlg.battlememlist", info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					else 
						Win_SetText("UI.gameui.landfmmemmgrdlg.battlememlist", "/C18"..info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					end;
				end;
				for i=0, num3-1 do
					local info = GetLandFmMemInfo(2, i);
					local namespacenum = 14 - string.len(info.name);
					local profspacenum = 9 - string.len(info.prof);
					local namespace = "";
					local profspace = "";
					if namespacenum > 0 then
						namespace = string.format("%"..namespacenum.."s", "");
					end;
					if profspacenum > 0 then
						profspace = string.format("%"..profspacenum.."s", "");
					end;						
					if info.isonline == 1 then
						Win_SetText("UI.gameui.landfmmemmgrdlg.supplymemlist", info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					else 
						Win_SetText("UI.gameui.landfmmemmgrdlg.supplymemlist", "/C18"..info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
					end;
				end;

				Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn1", false);
				Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn1", false);
				Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn2", false);
				Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn2", false);
				local bshow = GetIsShowOfflineMem();
				if bshow == 1 then
					Win_SetCheck("UI.gameui.landfmmemmgrdlg.offlinememcheck", true);
				else 
					Win_SetCheck("UI.gameui.landfmmemmgrdlg.offlinememcheck", false);
				end;
				
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.addbtn2", false);
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.delbtn2", false);
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.supplymemlist", false);
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.supplynamebtn", false);
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.supplyprofbtn", false);
				Win_ShowWidget("UI.gameui.landfmmemmgrdlg.supplylevelbtn", false);
			end;
			
			UpdateShow=function()
				if Win_GetValue("UI.gameui.landfmmemmgrdlg.memberlist", value_channel_sel) ~= -1 then
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn1", true);
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn2", true);
				else 
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn1", false);
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn2", false);
				end;
				if Win_GetValue("UI.gameui.landfmmemmgrdlg.battlememlist", value_channel_sel) ~= -1 then
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn1", true);
				else 
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn1", false);
				end;
				if Win_GetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", value_channel_sel) ~= -1 then
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn2", true);
				else 
					Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn2", false);
				end;
			end;

			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={472,20,20,19},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				},
				
				--显示离线成员
				offlinememcheck= 
				{
					type = "CHECK",
					rect={41,314,95,16};
					bkimage = "res/uires/newcommon/checkbox.gsa",
					bkimagepos={0,-2};
					visible=1,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.landfmmemmgrdlg.offlinememcheck") then
							SwithcIsShowOfflineMem(1);
						else 
							SwithcIsShowOfflineMem(0);
						end;
				
						Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", 0, value_channel_item_num);
						local num = GetLandFmMemNum(0);
						Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", num, value_channel_item_num);
						for i=0, num-1 do
							local info = GetLandFmMemInfo(0, i);
							local namespacenum = 14 - string.len(info.name);
							local profspacenum = 9 - string.len(info.prof);
							local namespace = "";
							local profspace = "";
							if namespacenum > 0 then
								namespace = string.format("%"..namespacenum.."s", "");
							end;
							if profspacenum > 0 then
								profspace = string.format("%"..profspacenum.."s", "");
							end;								
							if info.isonline == 1 then
								Win_SetText("UI.gameui.landfmmemmgrdlg.memberlist", info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
							else
								Win_SetText("UI.gameui.landfmmemmgrdlg.memberlist", "/C18"..info.name..namespace..info.prof..profspace..info.level,value_channel_itemtext,i);
							end;
						end;
						local sel = Win_GetValue("UI.gameui.landfmmemmgrdlg.memberlist", value_channel_sel);
						if sel >= num and num > 0 then
							Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", 0, value_channel_sel);
						elseif num == 0 then
							Win_SetValue("UI.gameui.landfmmemmgrdlg.memberlist", -1, value_channel_sel);
							Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn1", false);
							Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn2", false);
						end;
					end;		
				},
				
				addbtn1=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/addbtn.gsa";
					rect={224,102,73,28};
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.landfmmemmgrdlg.memberlist", value_channel_sel);
						AddLandMember(sel, 0);
						Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn1", false);
					end;
				};
				
				delbtn1=
				{
					type="BUTTON"; 
					bkimage="res/uires/teamdlg/delbtn.gsa";
					rect={224,146,73,28};
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.landfmmemmgrdlg.battlememlist", value_channel_sel);
						DelLandMember(sel, 0);
						Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn1", false);
					end;
				};
				
				addbtn2=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/addbtn.gsa";
					rect={224,230,73,28};
					visiable=0,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.landfmmemmgrdlg.memberlist", value_channel_sel);
						AddLandMember(sel, 1);
						Win_EnableWidget("UI.gameui.landfmmemmgrdlg.addbtn2", false);
					end;
				};
				
				delbtn2=
				{
					type="BUTTON";
					bkimage="res/uires/teamdlg/delbtn.gsa";
					rect={224,274,73,28};
					visiable=0,
					
					OnClick=function()
						local sel = Win_GetValue("UI.gameui.landfmmemmgrdlg.supplymemlist", value_channel_sel);
						DelLandMember(sel, 1);
						Win_EnableWidget("UI.gameui.landfmmemmgrdlg.delbtn2", false);
					end;
				};
				-- 家族成员列表
				memberlist=
				{
					type="LISTBOX";
					rect={40,93,176,215};	
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix+listbox_style_richtext,
					itemdragflag=-1,
					itemheight=22,
					itemmarginv=0,
					itemmarginh=0,
					itemdrawback="res/uires/activity/split.gsa",
					itemdrawpos={0, 22, 0, 0},
					itemselback="res/uires/activity/select.gsa",
					itemselpos={0,3,0,0},	
					updatemute=1,
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter,
					richmode=ui_richmode_color,
					
					OnClick=function()
						UI.children.gameui.children.landfmmemmgrdlg.UpdateShow();
					end;
					
					children=
					{
						vscroll=
						{					
							type="SCROLLBAR",
							rect={155,19,20,176},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown								
							};--children							
						};--scroll					
					};					
				},--list
				-- 家族成员列表表头
				fmnamebtn=
				{
					type="BUTTON",
					rect={40,71,77,21},
					bkimage="res/uires/activity/fmmemname.gsa",
					--caption="姓名",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(0, 0);
					end;
				};
				
				fmprofbtn=
				{
					type="BUTTON",
					rect={115,71,56,21},
					bkimage="res/uires/activity/fmmemprof.gsa",
					--caption="职业",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(0, 1);
					end;
				};
				
				fmlevelbtn=
				{
					type="BUTTON",
					rect={157,71,56,21},
					bkimage="res/uires/activity/fmmemlevel.gsa",
					--caption="等级",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(0, 2);
					end;
				};
				
				--参战成员
				battlememlist=
				{
					type="LISTBOX";
					rect={304,93,176,105};	
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix+listbox_style_richtext,
					itemdragflag=-1,
					itemheight=22,
					itemmarginv=0,
					itemmarginh=0,
					itemdrawback="res/uires/activity/split.gsa",
					itemdrawpos={0, 22, 0, 0},
					itemselback="res/uires/activity/select.gsa",
					itemselpos={0,3,0,0},	
					updatemute=1,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					richmode=ui_richmode_color,
					
					OnClick=function()
						UI.children.gameui.children.landfmmemmgrdlg.UpdateShow();
					end;
					
					children=
					{
						vscroll=
						{					
							type="SCROLLBAR",
							rect={155,19,20,72},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
																
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown								
							};--children							
						};--scroll					
					};					
				},--list
						
				-- 参战成员列表表头
				battlenamebtn=
				{
					type="BUTTON",
					rect={304,71,77,21},
					bkimage="res/uires/activity/fmmemname.gsa",
					--caption="姓名",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(1, 0);
					end;
				};
				
				battleprofbtn=
				{
					type="BUTTON",
					rect={380,71,56,21},
					bkimage="res/uires/activity/fmmemprof.gsa",
					--caption="职业",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(1, 1);
					end;
				};
				
				battlelevelbtn=
				{
					type="BUTTON",
					rect={422,71,56,21},
					bkimage="res/uires/activity/fmmemlevel.gsa",
					--caption="等级",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					
					OnClick=function()
						SortLandFmMemInfo(1, 2);
					end;
				};
				
				--补给队员
				supplymemlist=
				{
					type="LISTBOX";
					rect={311,250,163,57};	
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix+listbox_style_richtext,
					itemdragflag=-1,
					itemheight=22,
					itemmarginv=0,
					itemmarginh=0,
					itemdrawback="res/uires/activity/split.gsa",
					itemdrawpos={0, 22, 0, 0},
					itemselback="res/uires/activity/select.gsa",
					itemselpos={0,3,0,0},	
					updatemute=1,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					richmode=ui_richmode_color,
					visiable=0,
					
					OnClick=function()
						UI.children.gameui.children.landfmmemmgrdlg.UpdateShow();
					end;
				},
				
				-- 补给成员列表表头
				supplynamebtn=
				{
					type="BUTTON",
					rect={311,226,77,21},
					bkimage="res/uires/activity/fmmemname.gsa",
					--caption="姓名",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					visiable=0,
					
					OnClick=function()
						SortLandFmMemInfo(2, 0);
					end;
				};
				
				supplyprofbtn=
				{
					type="BUTTON",
					rect={386,226,56,21},
					bkimage="res/uires/activity/fmmemprof.gsa",
					--caption="职业",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					visiable=0,
					
					OnClick=function()
						SortLandFmMemInfo(2, 1);
					end;
				};
				
				supplylevelbtn=
				{
					type="BUTTON",
					rect={428,226,56,21},
					bkimage="res/uires/activity/fmmemlevel2.gsa",
					--caption="等级",
					initlayer=msgbox_layer-1,
					pluslayer=0,
					visiable=0,
					
					OnClick=function()
						SortLandFmMemInfo(2, 2);
					end;
				};			
			},
		},
		
		fpbonusrankdlg=
		{
			type="DIALOG";
			bkimage="res/uires/activity/fmbonusrankdlgbk.gsa";
			rect={0,0,347,290};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fpbonusrankdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fpbonusrankdlg.fmlist",10,value_channel_item_num);
				Win_SetValue("UI.gameui.fpbonusrankdlg.fmlist",0,value_channel_sel);
				
				Win_SetText("UI.gameui.fpbonusrankdlg.myfm.ranklabel","");
				Win_SetText("UI.gameui.fpbonusrankdlg.myfm.namelabel","");
				Win_SetText("UI.gameui.fpbonusrankdlg.myfm.numlabel","");
				
				local info = GetFPBonusRankInfo();
				if info.name == "" then
					Win_SetText("UI.gameui.fpbonusrankdlg.myfm.namelabel","你未加入家族");
				else
					Win_SetText("UI.gameui.fpbonusrankdlg.myfm.ranklabel",info.rank);
					Win_SetText("UI.gameui.fpbonusrankdlg.myfm.namelabel",info.name);
					Win_SetText("UI.gameui.fpbonusrankdlg.myfm.numlabel",info.num);
				end;
				end;

			children=
			{
				fmlist=
				{
					type="LISTBOX";
					rect={35,73,264,146};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fpbonusranklist,
					itemwidth=264,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					itemnum=10,
					textsize=12,				

					primaryscroll="UI.gameui.fpbonusrankdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={305,72,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fpbonusrankdlg.fmlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				myfm=
				{
					type="WIDGET";
					rect={35,240,264,16};
					tiptext="本家族积分信息",

					children=
					{
						ranklabel=
						{
							type="LABEL";
							rect={2,1,34,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						namelabel=
						{
							type="LABEL";
							rect={36,1,101,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};

						numlabel=
						{
							type="LABEL";
							rect={138,1,125,13};
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};
				};

				closebtn=
				{
					type="BUTTON",
					rect={321,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 301,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("家族积分排名");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		--非家族战场战场结束界面
		fieldfinishdlg=
		{
			type="DIALOG";
			bkimage="res/uires/arenadlg/fieldfinishdlg.gsa";
			rect={0,0,395,253};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=0,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				local num = Win_GetValue("UI.gameui.fieldfinishdlg.memlist",value_channel_item_num);
				if num > 0 then
					Win_SetValue("UI.gameui.fieldfinishdlg.memlist",0,value_channel_sel);
					end;
				LockPlayer(1);
				
				if IsInBattle() ~= 0 then
					Win_SetText("UI.gameui.fieldfinishdlg","res/uires/arenadlg/exfieldfinishdlg.gsa",value_channel_backpic);
				else
					Win_SetText("UI.gameui.fieldfinishdlg","res/uires/arenadlg/fieldfinishdlg.gsa",value_channel_backpic);
				end;
				
				end;
				
			OnSelfHide=function()
				if not Win_IsEnabled("UI.gameui.sketchbar.sketchmap.fieldmgrbtn") then
					LeaveBattle();
					end;
				LockPlayer(0);
				end;

			children=
			{
				memlist=
				{
					type="LISTBOX";
					rect={33,73,317,146};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_fieldfinishlist,
					itemwidth=317,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					textsize=12,				

					primaryscroll="UI.gameui.fieldfinishdlg.vscroll",
				};

				vscroll=
				{
					type="SCROLLBAR";
					rect={357,72,15,130};
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fieldfinishdlg.memlist",
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};

				

				closebtn=
				{
					type="BUTTON",
					rect={370,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink=
				{
					type = "BUTTON",
					rect = { 350,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("战场结束界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		--非家族战场奖励兑换界面
		fieldexchgdlg=
		{
			type="DIALOG",
			rect={0,0,283,360},				
			bkimage="res/uires/arenadlg/fieldexchgdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.fieldexchgdlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.fieldexchgdlg.leftscroll",0,value_channel_pos);
				SetGlobalQuery(GlobalQuery_FieldExchangeDlg,1);
				end;
			
			OnSelfHide=function()
				BattleCancelExchange();
				SetGlobalQuery(GlobalQuery_FieldExchangeDlg,0);
				end;
			
			children = 
			{	
				title=
				{
					type="LABEL",
					rect={66,21,65,13},
					textsize=12,
					textfont=1,
					drawcolor={249,203,43,255},
					textstyle=dt_right+dt_vcenter,
					enable = 0;
				};
				
				name=
				{
					type="LABEL",
					rect={63,310,32,14},
					textsize=12,
					textstyle=dt_center+dt_vcenter+dt_magicedge,
					enable = 0;
				};
				
				honor=
				{
					type="LABEL",
					rect={163,310,60,14},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					enable = 0;
				};
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 258,18,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 238,18,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("战场奖励兑换界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				leftlist=
				{
					type="WIDGETLIST",
					rect={16,51,235,247},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					--dragtype=ui_drag_type_fieldexchg,
					--dragindex=-1,
					primaryscroll="UI.gameui.fieldexchgdlg.leftscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/fieldexchgitem.lua"};
					
					children={},
					
				},--list
				
				leftscroll=
				{
			
					type="SCROLLBAR",
					rect={259,63,15,222},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.fieldexchgdlg.leftlist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				exchangebtn= 
				{
					type = "BUTTON",
					rect = {49,330,90,22},
					bkimage="res/uires/activity/exchangebtn.gsa",
					
					OnClick=function()
						BattleExchange();
						Win_EnableWidget("UI.gameui.fieldexchgdlg.exchangebtn",false);
						Win_SetValue("UI.gameui.fieldexchgdlg.exchangebtn",1,value_channel_timerspace);
						end;
						
					OnTimer=function()
						Win_EnableWidget("UI.gameui.fieldexchgdlg.exchangebtn",true);
						end;
				},
				
				cancelbtn =
				{
					type = "BUTTON",
					rect = {170,330,70,22},
					bkimage="res/uires/common/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				},
			
			},
		
		};
		
		
		--兑换界面
		exchangedlg=
		{
			type="DIALOG",
			rect={184,48,566,416},				
			bkimage="res/uires/activity/exchangedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.exchangedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.exchangedlg.leftscroll",0,value_channel_pos);
				SetGlobalQuery(GlobalQuery_ExchangeDlg,1);
				local num = GetExchangeItems();
				Win_SetValue("UI.gameui.exchangedlg.leftlist",num,value_channel_item_num);
				Win_SetValue("UI.gameui.exchangedlg.rightlist",0,value_channel_item_num);
				Win_SetText("UI.gameui.exchangedlg.totalbonuslabel",0);
				Win_SetText("UI.gameui.exchangedlg.weightlabel",0);
				
				local bonus = GetBonus(0);
				Win_SetText("UI.gameui.exchangedlg.mybonuslabel",bonus);
				Win_SetText("UI.gameui.exchangedlg.totalbonuslabel",0);
				Win_EnableWidget("UI.gameui.exchangedlg.exchangebtn",true);
				
				end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_ExchangeDlg,0);
				EndExchangeDlg();
				end;
			
			OnOk=function()
				local mode = Win_GetValue("UI.gameui.exchangedlg",value_channel_customindex);
				  ConfirmExchange(mode); 
				  end;
				  
			OnCancel=function()
				local mode = Win_GetValue("UI.gameui.exchangedlg",value_channel_customindex);
				  CancelExchange(mode); 
				  end;

				  
			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 540,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 520,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("奖品兑换界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				exchangebtn= 
				{
					type = "BUTTON",
					rect = {296,388,90,22},
					bkimage="res/uires/activity/exchangebtn.gsa",
					
					OnClick=function()
						local mode = Win_GetValue("UI.gameui.exchangedlg",value_channel_customindex);
						  ConfirmExchange(mode); 
						  Win_EnableWidget("UI.gameui.exchangedlg.exchangebtn",false);
						  Win_SetValue("UI.gameui.exchangedlg.exchangebtn",1,value_channel_timerspace);
						  end;
						
					OnTimer=function()
						Win_EnableWidget("UI.gameui.exchangedlg.exchangebtn",true);
						end;
				},
				
				clearbtn = 
				{
					type = "BUTTON",
					rect = {386,388,70,22},
					bkimage="res/uires/activity/clearbtn.gsa",
					
					OnClick=function()
						    local rst = ClearExchangeList();
						    if rst ~= 0 then
							Win_SetValue("UI.gameui.exchangedlg.rightlist",0,value_channel_item_num);
							Win_SetText("UI.gameui.exchangedlg.totalbonuslabel",0);
							Win_SetText("UI.gameui.exchangedlg.weightlabel",0);
						    end;
						    end;
				},
				
				cancelbtn = 
				{
					type = "BUTTON",
					rect = {487,388,70,22},
					bkimage="res/uires/common/closebtn.gsa",
					defaultcancel=1,
					soundid={1001},
				},

				mybonuslabel=
				{
					type="LABEL",
					rect={360,371,60,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=1,
				},
				
				weightedit=
				{
					type="LABEL",
					rect={481,371,72,12},						
					textsize=12,
					enable=1,
				},
				
				totalbonuslabel=
				{
					type="LABEL",
					rect={360,346,60,12},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=1,
				},
				
				weightlabel=
				{
					type="LABEL",
					rect={504,346,48,12},						
					textsize=12,
					enable=1,
				},
				
				leftlist=
				{
					type="WIDGETLIST",
					rect={32,45,228,331},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_buylist,
					dragindex=-1,
					primaryscroll="UI.gameui.exchangedlg.leftscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/exchgiteml.lua"};
					
					children={},
					
				},--list
				
				leftscroll=
				{
			
					type="SCROLLBAR",
					rect={265,55,15,310},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.exchangedlg.leftlist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				rightlist=
				{
					type="WIDGETLIST",
					rect={303,39,229,297},
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_selbuylist,
					dragindex=-1,
					primaryscroll="UI.gameui.exchangedlg.rightscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/exchgitemr.lua"};
					
					children={},
					
				},--list
				
				rightscroll=
				{
			
					type="SCROLLBAR",
					rect={543,50,15,268},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.exchangedlg.rightlist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
						};--spindown
						
					};--children
					
				};--scroll
			},
		
		};
		
		
		--查询兑换奖品界面
		viewexchangedlg=
		{
			type="DIALOG",
			rect={0,0,292,416},				
			bkimage="res/uires/activity/viewexchangedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.viewexchangedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.viewexchangedlg.leftscroll",0,value_channel_pos);
				local num = GetExchangeItems();
				Win_SetValue("UI.gameui.viewexchangedlg.leftlist",num,value_channel_item_num);
				SetGlobalQuery(GlobalQuery_ViewExchangeDlg,1);
				end;
			
			OnSelfHide=function()
				EndExchangeDlg();
				SetGlobalQuery(GlobalQuery_ViewExchangeDlg,0);
				end;
			
			OnCancel=function()
				local mode = Win_GetValue("UI.gameui.viewexchangedlg",value_channel_customindex);
				  CancelExchange(mode); 
				  end;

			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 266,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 246,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("查询奖品兑换界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				leftlist=
				{
					type="WIDGETLIST",
					rect={30,45,228,331},	
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_buylist,
					dragindex=-1,
					primaryscroll="UI.gameui.viewexchangedlg.leftscroll",
					itemmarginh=4,
					itemmarginv=4,
					
					template={"res/uires/viewexchgitem.lua"};
					
					children={},
					
				},--list
				
				leftscroll=
				{
			
					type="SCROLLBAR",
					rect={265,55,15,310},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.viewexchangedlg.leftlist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			},
		
		};
		
		--充值界面
		chongzhidlg=
		{
			type="DIALOG",
			rect={0,0,691,590},
			bkimage="res/uires/common/chongzhi.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			initlayer=msgbox_layer-1,
			moveable=0,
			visible=0,
			
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.chongzhidlg",false);
				CloseRequireExchgBowlder();
			end;
			
			
			children=
			{
				cancelbtn=
				{
					type="BUTTON",
					rect={666,3,20,19},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				weblabel=
				{
					type="LABEL";
					rect={330,7,330,13};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					caption="/C11/<http=\"http://ffo.qq.com/comm-htdocs/pay/new_index.htm?t=ffo\">若充值页面无法打开，请点击网页充值(适度娱乐理性消费)",
					richmode=ui_richmode_color+ui_richmode_hlink,
					enable=1,
				};
			};
		};
		
		--近期热点
		hotnewsdlg=
		{
			type="DIALOG",
			rect={0,0,537,409},
			bkimage="res/uires/common/hotnews.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			initlayer=msgbox_layer-1,
			moveable=0,
			visible=0,
			
			OnSelfShow=function()
				RequireExchgBowlder2();
				local status = GetNewsDlgStatus();
				if status == 1 then
					Win_SetCheck("UI.gameui.hotnewsdlg.popnewdlgbtn",true);
				else 
					Win_SetCheck("UI.gameui.hotnewsdlg.popnewdlgbtn",false);
				end;
				
				Win_SetValue("UI.gameui.hotnewsdlg",30,value_channel_timerspace);
				Win_SetValue("UI.gameui.hotnewsdlg.timetxt",1,value_channel_timerspace);
				
				Win_SetText("UI.gameui.hotnewsdlg.timetxt2",30);
				
				Win_SetCapture("UI.gameui.hotnewsdlg");
				Win_SetFocus("UI.gameui.hotnewsdlg");
			end;
			
			OnSelfHide=function()
				Win_SetValue("UI.gameui.hotnewsdlg",-1,value_channel_timerspace);
				Win_SetValue("UI.gameui.hotnewsdlg.timetxt",-1,value_channel_timerspace);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.hotnewsdlg",false);
				Win_SetValue("UI.gameui.hotnewsdlg",-1,value_channel_timerspace);
				Win_SetValue("UI.gameui.hotnewsdlg.timetxt",-1,value_channel_timerspace);
				CloseRequireExchgBowlder2();
			end;
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.hotnewsdlg",false);
				Win_SetValue("UI.gameui.hotnewsdlg",-1,value_channel_timerspace);
				Win_SetValue("UI.gameui.hotnewsdlg.timetxt",-1,value_channel_timerspace);				
				CloseRequireExchgBowlder2();
			end;
			
			
			children=
			{
				cancelbtn=
				{
					type="BUTTON",
					rect={508,20,20,19},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				popnewdlgbtn=
				{
					type="CHECK";
					rect={38,378,140,18};
					bkimage="res/uires/common/checkbox.gsa";
					bkimagepos={0,2},
					textsize=12,
					drawcolor={255,255,0,255},
					caption="不再弹出近期热点";
					checked=0;
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.hotnewsdlg.popnewdlgbtn") then
							SaveShowNesDlg(1);
						else
							SaveShowNesDlg(0);
						end;
					end;
				};
				
				timetxt=
				{
					type="LABEL",
					rect={400,378,100,17},
					editable=0,
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					drawcolor={255,255,255,255},
					caption = "";
					visible=1;
					
					OnTimer=function()
						local retime = Win_GetText("UI.gameui.hotnewsdlg.timetxt2");
						local retime2 = retime - 1;
						Win_SetText("UI.gameui.hotnewsdlg.timetxt","还有"..retime2.."秒关闭");
						Win_SetText("UI.gameui.hotnewsdlg.timetxt2",retime2);
						
						if Win_IsVisible("UI.gameui.hotnewsdlg") == true then 
							Win_SetValue("UI.gameui.hotnewsdlg.timetxt",1,value_channel_timerspace);
						end;
					end;
				};
				
				timetxt2=
				{
					type="LABEL",
					rect={0,378,100,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
					visible=0;
				};
			};
		};
		
		exchgbowlderdlg=
		{
			type="DIALOG";
			bkimage="res/uires/rackdlg/exchgbowlderdlgbk.gsa";
			rect={0,0,368,537};
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",1,value_channel_minvalue);
				Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",999999-GetMyJude(),value_channel_maxvalue);
				Win_SetText("UI.gameui.exchgbowlderdlg.inputpoint","");
				Win_SetFocus("UI.gameui.exchgbowlderdlg.inputpoint");
				
				end;
			
			OnSelfHide=function()
				if GetGlobalQuery(GlobalQuery_ShopDlg)~=0 then
					Win_ShowWidget("UI.gameui.shopdlg",true);
					Win_SetFocus("UI.gameui.shopdlg");
--~ 				elseif GetGlobalQuery(GlobalQuery_SellJude)~=0  then
--~ 					Win_ShowWidget("UI.gameui.selljudedlg",true);
--~ 					Win_SetFocus("UI.gameui.selljudedlg");
--~ 				elseif GetGlobalQuery(GlobalQuery_BuyJude)~=0  then
--~ 					Win_ShowWidget("UI.gameui.buyjudedlg",true);
--~ 					Win_SetFocus("UI.gameui.buyjudedlg");
--~ 				elseif GetGlobalQuery(GlobalQuery_CancelSellJude)~=0  then
--~ 					Win_ShowWidget("UI.gameui.cancelselljudedlg",true);
--~ 					Win_SetFocus("UI.gameui.cancelselljudedlg");
				end;
			end;
				
			OnMsgBoxOk=function()
				local point = Win_GetValue("UI.gameui.exchgbowlderdlg",value_channel_customindex);
				local sel = Win_GetSelect("UI.gameui.exchgbowlderdlg",0);
				BowlderChange(point, sel);
				Win_ShowWidget("UI.gameui.exchgbowlderdlg",false);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.exchgbowlderdlg",false);
				end;
	
			children=
			{
				QPcheck= 
				{
					type = "CHECK",
					rect={52,148,63,14};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					checked=1,
					--adornpic={"res/uires/common/boxbk.gsa"},
					--adornpicpos={{-3,-2}},
					
					OnCheck=function(bchecked)
						Win_ShowWidget("UI.gameui.exchgbowlderdlg.QPlabel", bchecked~=0);
						
						if bchecked ~= 0 then
							local leftpoint = Win_GetValue("UI.gameui.exchgbowlderdlg.leftpoint",value_channel_customindex);
							if leftpoint > 10000 then
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",10000,value_channel_maxvalue);
							else
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",leftpoint,value_channel_maxvalue);
							end;
							
							local value = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_value);
							local maxvalue = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_maxvalue);
							if value > maxvalue then
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",maxvalue,value_channel_value);
							end;
						end;
						end;
				};
				
				QBcheck= 
				{
					type = "CHECK",
					rect={52,167,63,14};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					--adornpic={"res/uires/common/boxbk.gsa"},
					--adornpicpos={{-3,-2}},
					
					OnCheck=function(bchecked)
						Win_ShowWidget("UI.gameui.exchgbowlderdlg.QBlabel", bchecked~=0);
						
						if bchecked ~= 0 then
							local qbleftpoint = Win_GetValue("UI.gameui.exchgbowlderdlg.qbleftpoint",value_channel_customindex);
							if qbleftpoint > 240 then
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",240,value_channel_maxvalue);
							else
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",qbleftpoint,value_channel_maxvalue);
							end;
							
							local value = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_value);
							local maxvalue = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint",value_channel_maxvalue);
							if value > maxvalue then
								Win_SetValue("UI.gameui.exchgbowlderdlg.inputpoint",maxvalue,value_channel_value);
							end;
						end;					
						end;
				};
				
				
				QPlabel=
				{
					type="WIDGET",
					rect={155,190,20,11},
					bkimage="res/uires/rackdlg/qp.gsa",					
					visible=0,
				};
				
				QBlabel=
				{
					type="WIDGET",
					rect={155,191,20,11},
					bkimage="res/uires/rackdlg/qb.gsa",				
					visible=0,
				};
				
				inputpoint=
				{
					type="EDIT",
					rect={198,192,90,12},
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_number+ui_editmethod_value,	
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				leftpoint=
				{
					type="LABEL",
					rect={120,147,55,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				rate=
				{
					type="LABEL",
					rect={231,147,78,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				qbleftpoint=
				{
					type="LABEL",
					rect={120,166,55,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				qbrate=
				{
					type="LABEL",
					rect={231,166,78,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				maxqplabel=
				{
					type="LABEL",
					rect={120,213,60,17},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					drawcolor={255,255,255,255},
					caption="10000",
				};
				
				maxqblabel=
				{
					type="LABEL",
					rect={222,213,60,17},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					drawcolor={255,255,255,255},
					caption="240",
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={69,236,69,24},
					drawflag=drawflag_draw_effect;
					bkimage="res/uires/rackdlg/exaffirmbtn.gsa",
					effectpic="res/uires/rackdlg/effectrect.gsa",
					effectpicpos={-2,-2},
					soundid={1005},
					
					OnClick=function()
						local point = Win_GetText("UI.gameui.exchgbowlderdlg.inputpoint");
						if point == "" then
							Win_ShowMsgBox("请正确输入兑换点数！");
						end;
						
						point = Win_GetValue("UI.gameui.exchgbowlderdlg.inputpoint");
						if point == 0 then
							Win_ShowMsgBox("请正确输入兑换点数！");
						else
							Win_SetValue("UI.gameui.exchgbowlderdlg",point,value_channel_customindex);
							Win_ShowMsgBox("您确定要兑换彩玉吗？","系统消息",ui_msgid_yesno,"UI.gameui.exchgbowlderdlg");
						end;
						
						end;
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={249,236,69,24},
					bkimage="res/uires/rackdlg/excancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				freshbtn=
				{
					type="BUTTON",
					rect={159,236,69,24},
					bkimage="res/uires/rackdlg/freshbtn.gsa",
					soundid={1005},
				};
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={339,20,20,19};
					defaultcancel=1,					
				};
				
				chargeqpbtn=
				{
					type="BUTTON",
					rect={69,326,86,24},
					bkimage="res/uires/rackdlg/chargeqpbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						ChargeQPoint(0);
						end;
				};
				
				qb2qpbtn=
				{
					type="BUTTON",
					rect={232,326,86,24},
					bkimage="res/uires/rackdlg/qb2qpbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						ChargeQPoint(1);
						end;
				};
				
				regqqvip=
				{
					type="BUTTON",
					rect={263,367,86,24},
					bkimage="res/uires/rackdlg/reqqvipbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						ChargeQPoint(2);
					end;
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={316,20,20,19};
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("兑换彩玉查询");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				urllabel=
				{
					type="LABEL",
					rect={204,439,90,12},
					caption="/C13/<http=\"http://ffo.qq.com/new/service/rules.htm\">《玩家协议》/<>";
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_hlink,
					textstyle=dt_left,
					enable=1,
				};
				
				wangyinrebatebtn=
				{
					type="BUTTON",
					rect={69,80,86,24},
					--drawflag=drawflag_draw_effect;
					bkimage="res/uires/rackdlg/wangyinrebatebtn.gsa",
					--effectpic="res/uires/rackdlg/effectrect.gsa",
					effectpicpos={-2,-2},
					soundid={1005},
					
					OnClick=function()
						OpenIE("http://ffo.qq.com/comm-htdocs/pay///?t=ffo#2")
					end;
				},
				
				caifutongrebatebtn=
				{
					type="BUTTON",
					rect={242,80,86,24},
					--drawflag=drawflag_draw_effect;
					bkimage="res/uires/rackdlg/caifutongrebatebtn.gsa",
					--effectpic="res/uires/rackdlg/effectrect.gsa",
					effectpicpos={-2,-2},
					soundid={1005},
					
					OnClick=function()
						OpenIE("http://ffo.qq.com/comm-htdocs/pay///?t=ffo#1")
					end;
				},
			};
		};

		--不足彩玉的兑换框
		exchgbowlderdlg2=
		{
			type="DIALOG";
			bkimage="res/uires/rackdlg/exchgbowlderdlgbk2.gsa";
			rect={0,0,241,244};
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.exchgbowlderdlg2.inputpoint",1,value_channel_minvalue);
				Win_SetValue("UI.gameui.exchgbowlderdlg2.inputpoint",999999-GetMyJude(),value_channel_maxvalue);
				Win_SetText("UI.gameui.exchgbowlderdlg2.inputpoint","");
				Win_SetFocus("UI.gameui.exchgbowlderdlg2.inputpoint");
				
				end;
			
			OnSelfHide=function()
				if Win_IsVisible("UI.gameui.shopdlg") then
					Win_SetFocus("UI.gameui.shopdlg");
				else
					Win_ShowWidget("UI.gameui.shopdlg",true);
					Win_SetFocus("UI.gameui.shopdlg");
				end;
				
				end;
				
			OnMsgBoxOk=function()
				local point = Win_GetValue("UI.gameui.exchgbowlderdlg2",value_channel_customindex);
				BowlderChange(point);
				Win_ShowWidget("UI.gameui.exchgbowlderdlg2",false);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.exchgbowlderdlg2",false);
				end;
	
			children=
			{
				inputpoint=
				{
					type="EDIT",
					rect={104,95,111,12},
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod = ui_editmethod_number+ui_editmethod_value,	
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				leftpoint=
				{
					type="LABEL",
					rect={127,126,90,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				rate=
				{
					type="LABEL",
					rect={95,154,122,17},
					editable=0,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={42,217,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					soundid={1005},
					
					OnClick=function()
						local point = Win_GetText("UI.gameui.exchgbowlderdlg2.inputpoint");
						if point == "" then
							Win_ShowMsgBox("请正确输入兑换点数！");
						end;
						
						point = Win_GetValue("UI.gameui.exchgbowlderdlg2.inputpoint");
						if point == 0 then
							Win_ShowMsgBox("请正确输入兑换点数！");
						else
							Win_SetValue("UI.gameui.exchgbowlderdlg2",point,value_channel_customindex);
							Win_ShowMsgBox("您确定要兑换彩玉吗？","系统消息",ui_msgid_yesno,"UI.gameui.exchgbowlderdlg2");
						end;
						
						end;
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={147,217,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={216,10,20,19};
					defaultcancel=1,					
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={196,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("兑换彩玉查询");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
			};
		};
		
		--寄售彩玉
		selljudedlg=
		{
			type="DIALOG";
			bkimage="res/uires/judedlg/selljudedlgbk.gsa";
			rect={0,0,461,328};
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetText("UI.gameui.selljudedlg.introduction", "1、彩玉寄售手续费用为寄售总价的1%，无论彩玉是否售出，手续费用照常收取。\n2、彩玉的寄售时间为24小时，如果到时间彩玉没有售出，请到彩玉交易公证员处领取退还的彩玉。\n3、彩玉单价指的是1彩玉需要兑换的游戏币价格。单笔寄售最小额为100彩玉。\n4、售出彩玉获得的游戏币会通过邮件方式通知，请到彩玉交易公证员处领取。\n5、每个角色允许同时寄售不超过5笔彩玉。");
				
				local money=GetMoney();
				local gold=math.floor(money/1000000);
				local silver=math.floor((money-gold*1000000)/1000);
				local copper=money-gold*1000000-silver*1000;
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.selljudedlg.mytotalmoney.copperlabel",copper);	
				
				local bowlder = GetMyJude();
				Win_SetText("UI.gameui.selljudedlg.mytotaljude",bowlder.."/999999");					
				if bowlder > 10000 then
					Win_SetValue("UI.gameui.selljudedlg.judenum", 10000, value_channel_maxvalue);
				else
					Win_SetValue("UI.gameui.selljudedlg.judenum", bowlder, value_channel_maxvalue);
				end;
				
				Win_SetValue("UI.gameui.selljudedlg.judenum",0);	
				Win_SetValue("UI.gameui.selljudedlg.myjudeprice.silveredit",0);	
				Win_SetValue("UI.gameui.selljudedlg.myjudeprice.copperedit",0);	
				
				Win_SetFocus("UI.gameui.selljudedlg.judenum");
				
				SetGlobalQuery(GlobalQuery_SellJude, 1);
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
				SetGlobalQuery(GlobalQuery_SellJude, 0);
				EndConsign(0,false);
			end;
			
			OnCancel=function()
				CloseBowlderDlg(1);
			end;			
			
			children=
			{
				suggestedprice=
				{
					type="LABEL",
					rect={153,73,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
					};					
				};
				
				judenum=
				{
					type="EDIT",
					rect={153,104,110,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					drawcolor={255,255,255,255},
					textsize=12,
					mornitor={value_channel_value},
					
					OnValueChange=function()
						local judenum=Win_GetValue("UI.gameui.selljudedlg.judenum");						
						local silver=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.silveredit");
						local copper=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.copperedit");
						local totalprice=judenum*(silver*1000+copper);
						local totalgold=math.floor(totalprice/1000000);
						local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
						local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
						Win_SetText("UI.gameui.selljudedlg.totalprice.goldlabel", totalgold);
						Win_SetText("UI.gameui.selljudedlg.totalprice.silverlabel", totalsilver);
						Win_SetText("UI.gameui.selljudedlg.totalprice.copperlabel", totalcopper);
						
						local commissioncharge=math.floor(totalprice/100);
						local comgold=math.floor(commissioncharge/1000000);
						local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
						local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
						if commissioncharge>GetMoney() then
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", "/C20"..comgold);
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
						else
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", comgold);
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", comsilver);
							Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", comcopper);
						end;
					end;
				};
				
				myjudeprice=
				{
					type="LABEL",
					rect={153,137,110,12},
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							bkimage="res/uires/common/gold.gsa",
							captionrect={12,0,24,12},
							textsize=12,
							caption="0",
							textstyle=dt_left+dt_vcenter,
							
							OnClick=function()
								Win_SetFocus("UI.gameui.selljudedlg.myjudeprice.silveredit");
							end;
						};
						
						silveredit=
						{
							type="EDIT",
							rect={36,0,36,12},
							bkimage="res/uires/common/silver.gsa",
							captionrect={12,0,24,12},
							editmethod=ui_editmethod_number+ui_editmethod_value,							
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							textsize=12,									
							maxvalue=999,
							minvalue=0,
							mornitor={value_channel_value},
							
							OnValueChange=function()
								local judenum=Win_GetValue("UI.gameui.selljudedlg.judenum");
								local silver=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.silveredit");
								local copper=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.copperedit");
								local totalprice=judenum*(silver*1000+copper);
								local totalgold=math.floor(totalprice/1000000);
								local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
								local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
								Win_SetText("UI.gameui.selljudedlg.totalprice.goldlabel", totalgold);
								Win_SetText("UI.gameui.selljudedlg.totalprice.silverlabel", totalsilver);
								Win_SetText("UI.gameui.selljudedlg.totalprice.copperlabel", totalcopper);
								
								local commissioncharge=math.floor(totalprice/100);
								local comgold=math.floor(commissioncharge/1000000);
								local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
								local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
								if commissioncharge>GetMoney() then
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", "/C20"..comgold);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
								else
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", comgold);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", comsilver);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", comcopper);
								end;
							end;							
						};
						
						copperedit=
						{
							type="EDIT",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							editmethod=ui_editmethod_number+ui_editmethod_value,							
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							textsize=12,									
							maxvalue=999,
							minvalue=0,	
							mornitor={value_channel_value},
							
							OnValueChange=function()
								local judenum=Win_GetValue("UI.gameui.selljudedlg.judenum");
								local silver=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.silveredit");
								local copper=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.copperedit");
								local totalprice=judenum*(silver*1000+copper);
								local totalgold=math.floor(totalprice/1000000);
								local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
								local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
								Win_SetText("UI.gameui.selljudedlg.totalprice.goldlabel", totalgold);
								Win_SetText("UI.gameui.selljudedlg.totalprice.silverlabel", totalsilver);
								Win_SetText("UI.gameui.selljudedlg.totalprice.copperlabel", totalcopper);
								
								local commissioncharge=math.floor(totalprice/100);
								local comgold=math.floor(commissioncharge/1000000);
								local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
								local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
								if commissioncharge>GetMoney() then
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", "/C20"..comgold);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
								else
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.goldlabel", comgold);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.silverlabel", comsilver);
									Win_SetText("UI.gameui.selljudedlg.commissioncharge.copperlabel", comcopper);
								end;
							end;								
						};
					};
				};
				
				totalprice=
				{
					type="LABEL",
					rect={153,169,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							enable=1,
							maxvalue=999,
							minvalue=0,
							textstyle=dt_center+dt_vcenter,							
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
							maxvalue=999,
							minvalue=0,
							textstyle=dt_center+dt_vcenter,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
							maxvalue=999,
							minvalue=0,	
							textstyle=dt_center+dt_vcenter,
						};
					};					
				};
				
				commissioncharge=
				{
					type="LABEL",
					rect={153,200,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							enable=1,
							richmode=ui_richmode_color,	
							maxvalue=2000,
							minvalue=0,
							textstyle=dt_center+dt_vcenter,								
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
							richmode=ui_richmode_color,
							maxvalue=999,
							minvalue=0,
							textstyle=dt_center+dt_vcenter,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
							richmode=ui_richmode_color,
							maxvalue=999,
							minvalue=0,
							textstyle=dt_center+dt_vcenter,
						};
					};					
				};
				
				mytotalmoney=
				{
					type="LABEL",
					rect={128,263,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,							
							enable=0,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=0,
						};
					};					
				};
				
				mytotaljude=
				{
					type="LABEL",
					rect={125,291,110,12},
					textsize=12,
					enable=0,
				};
				
				introduction=
				{
					type="LABEL",
					rect={284,72,155,208},
					textsize=12,
					rowspace=1;
					drawcolor={220,200,147,255},
					textstyle=dt_left+dt_top,
					enable=0,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={431,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",

					OnClick=function()
						CloseBowlderDlg(1);
					end;
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={409,19,22,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("寄售彩玉");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={282,287,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					soundid={1005},					
					
					OnClick=function()
						local judenum=Win_GetValue("UI.gameui.selljudedlg.judenum");
						if judenum<100 then
							Win_ShowMsgBox("单笔寄售最小额为100彩玉！", "系统消息", ui_msgid_affirm, "UI.gameui.selljudedlg.affirmbtn");
							return;
						end;
						
						local mysilver = Win_GetValue("UI.gameui.selljudedlg.myjudeprice.silveredit");
						local mycopper=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.copperedit");
						if mysilver == 0 and mycopper == 0 then
							Win_ShowMsgBox("彩玉单价不可以为0！", "系统消息", ui_msgid_affirm, "UI.gameui.selljudedlg.affirmbtn");
							return;
						end;
						
						local totalprice=judenum*(mysilver*1000+mycopper);
						local commissioncharge=math.floor(totalprice/100);
						if commissioncharge>GetMoney() then
							Win_ShowMsgBox("您的游戏币不足以缴纳手续费，不能寄售彩玉！", "系统消息", ui_msgid_affirm, "UI.gameui.selljudedlg.affirmbtn");
							return;
						end;
						
						Win_ShowMsgBox("您确定寄售彩玉？", "系统消息", ui_msgid_yesno, "UI.gameui.selljudedlg.affirmbtn");
					end;
					
					OnMsgBoxOk=function()
						--向服务器发送寄售消息
						local judenum=Win_GetValue("UI.gameui.selljudedlg.judenum");
						local mysilver=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.silveredit");
						local mycopper=Win_GetValue("UI.gameui.selljudedlg.myjudeprice.copperedit");
						local myprice=mysilver*1000+mycopper;
						SellBowlder(judenum, myprice);
						CloseBowlderDlg(1);
					end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={369,287,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					soundid={1007},
					
					OnClick=function()
						CloseBowlderDlg(1);
					end;
				};
				
				exchangejudebtn=
				{
					type="BUTTON",
					rect={60,223,86,24},
					bkimage="res/uires/judedlg/exchangejudebtn.gsa",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.hotnewsdlg") == true then
							Win_ShowWidget("UI.gameui.hotnewsdlg", false);
							CloseRequireExchgBowlder2();
						end;
						
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				
				historypricebtn=
				{
					type="BUTTON",
					rect={172,223,86,24},
					bkimage="res/uires/judedlg/historypricebtn.gsa",
				};
			};
		};
		
		--购买彩玉
		buyjudedlg=
		{
			type="DIALOG";
			bkimage="res/uires/judedlg/buyjudedlgbk.gsa";
			adornpic={"res/uires/judedlg/label_buyjude.gsa", "res/uires/judedlg/label_buyjude_info.gsa"},
			adornpicpos={{187,17},{334, 50}},
			rect={0,0,459,328};
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetText("UI.gameui.buyjudedlg.introduction", "1、购买的彩玉会通过邮件方式发送给您。\n2、购买彩玉系统收取购买总价1%的手续费用。\n3、系统会根据您输入的购买价格自动搜索所有价格小于等于购买价格的彩玉进行购买，并且优先购买价格最低的彩玉。\n4、如果匹配购买价格的彩玉数量不足，则系统会自动成交价格匹配的部分彩玉。");
				
				local money=GetMoney();
				local gold=math.floor(money/1000000);
				local silver=math.floor((money-gold*1000000)/1000);
				local copper=money-gold*1000000-silver*1000;
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.buyjudedlg.mytotalmoney.copperlabel",copper);	
				
				local bowlder = GetMyJude();
				Win_SetText("UI.gameui.buyjudedlg.mytotaljude",bowlder.."/999999");					
				
				SetGlobalQuery(GlobalQuery_BuyJude, 1);
				
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
				SetGlobalQuery(GlobalQuery_BuyJude, 0);
				EndConsign(0,false);
			end;
			
			OnCancel=function()
				CloseBowlderDlg(2);
			end;
			
			children=
			{
				introduction=
				{
					type="LABEL",
					rect={284,71,154,210},
					textsize=12,
					rowspace=1;
					drawcolor={220,200,147,255},
					textstyle=dt_left+dt_top,
					enable=0,
				};
				
				buyjudeinfolist=
				{
					type="WIDGETLIST",
					rect={42,75,233,182},	
					style=wgtstyle_clipself+wgtstyle_renderitem+wgtstyle_vertical,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					itemselback="res/uires/family/detailitemsel.gsa",			
					updatemute=1,
					itemmarginh=0,
					itemmarginv=0,
					template={"res/uires/buyjudeinfo.lua"},
					
					children={},
				};
				
				mytotalmoney=
				{
					type="LABEL",
					rect={120,269,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
					};					
				};
				
				mytotaljude=
				{
					type="LABEL",
					rect={120,295,110,12},
					textsize=12,
					enable=0,
				};

				closebtn=
				{
					type="BUTTON",
					rect={431,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					
					OnClick=function()
						CloseBowlderDlg(2);
					end;
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={409,19,23,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("购买彩玉");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				exchangejudebtn=
				{
					type="BUTTON",
					rect={355,288,86,24},
					bkimage="res/uires/judedlg/exchangejudebtn.gsa",
					
					OnClick=function()
						--Win_ShowWidget("UI.gameui.buyjudedlg",false);
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				
				historypricebtn=
				{
					type="BUTTON",
					rect={258,288,86,24},
					bkimage="res/uires/judedlg/historypricebtn.gsa",
				};
			};
		};
		
		--确认购买彩玉
		confirmbuyjudedlg=
		{
			type="DIALOG";
			bkimage="res/uires/judedlg/confirmbuyjudedlgbk.gsa";
			rect={0,0,267,207};
			initlayer=msgbox_layer,
			style=wgtstyle_topmost+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.confirmbuyjudedlg", false);
			end;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.confirmbuyjudedlg");
				Win_SetFocus("UI.gameui.confirmbuyjudedlg");
				Win_SetText("UI.gameui.confirmbuyjudedlg.judenum", 0);
				Win_SetFocus("UI.gameui.confirmbuyjudedlg.judenum");
			end;
			
			OnSelfHide=function()
				Win_SetFocus("UI.gameui.buyjudedlg");
			end;
			
			children=
			{
				judenum=
				{
					type="EDIT",
					rect={118,56,36,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					drawcolor={255,255,255,255},
					textsize=12,
					minvalue=1,
					maxvalue=9999,
					mornitor={value_channel_value},
					
					OnValueChange=function()
						local judenum=Win_GetValue("UI.gameui.confirmbuyjudedlg.judenum");
						local silver=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
						local copper=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.copperedit");
						
						local totalprice=judenum*(silver*1000+copper);
						local commissioncharge=math.floor(totalprice/100);
						local comgold=math.floor(commissioncharge/1000000);
						local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
						local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
						if commissioncharge>GetMoney() then
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", "/C20"..comgold);
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
						else
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", comgold);
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", comsilver);
							Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", comcopper);
						end;
						
						local totalprice=totalprice+commissioncharge;
						local totalgold=math.floor(totalprice/1000000);
						local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
						local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
						if totalprice>9999999999 then
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20".."9999");
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20".."999");
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20".."999");
						elseif totalprice>GetMoney() then
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20"..totalgold);
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20"..totalsilver);
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20"..totalcopper);		
						else
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", totalgold);
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", totalsilver);
							Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", totalcopper);				
						end;

					end;	
				};
				

				myjudeprice=
				{
					type="LABEL",
					rect={118,81,110,12},
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							bkimage="res/uires/common/gold.gsa",
							captionrect={12,0,24,12},
							textsize=12,
							caption="0",
							textstyle=dt_left+dt_vcenter,
							
							OnClick=function()
								Win_SetFocus("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
							end;
						};
						
						silveredit=
						{
							type="EDIT",
							rect={36,0,36,12},
							bkimage="res/uires/common/silver.gsa",
							captionrect={12,0,24,12},
							editmethod=ui_editmethod_number+ui_editmethod_value,							
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							textsize=12,									
							maxvalue=999,
							minvalue=0,
							mornitor={value_channel_value},
							
							OnValueChange=function()
								local judenum=Win_GetValue("UI.gameui.confirmbuyjudedlg.judenum");
								local silver=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
								local copper=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.copperedit");
								
								local totalprice=judenum*(silver*1000+copper);
								local commissioncharge=math.floor(totalprice/100);
								local comgold=math.floor(commissioncharge/1000000);
								local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
								local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
								if commissioncharge>GetMoney() then
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", "/C20"..comgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
								else
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", comgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", comsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", comcopper);
								end;
								
								local totalprice=totalprice+commissioncharge;
								local totalgold=math.floor(totalprice/1000000);
								local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
								local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
								if totalprice>9999999999 then
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20".."9999");
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20".."999");
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20".."999");
								elseif totalprice>GetMoney() then
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20"..totalgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20"..totalsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20"..totalcopper);		
								else
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", totalgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", totalsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", totalcopper);				
								end;
							end;							
						};
						
						copperedit=
						{
							type="EDIT",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							editmethod=ui_editmethod_number+ui_editmethod_value,							
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							textsize=12,									
							maxvalue=999,
							minvalue=0,	
							mornitor={value_channel_value},
							
							OnValueChange=function()
								local judenum=Win_GetValue("UI.gameui.confirmbuyjudedlg.judenum");
								local silver=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
								local copper=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.copperedit");
								
								local totalprice=judenum*(silver*1000+copper);
								local commissioncharge=math.floor(totalprice/100);
								local comgold=math.floor(commissioncharge/1000000);
								local comsilver=math.floor((commissioncharge-comgold*1000000)/1000);
								local comcopper=commissioncharge-comgold*1000000-comsilver*1000;
								if commissioncharge>GetMoney() then
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", "/C20"..comgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", "/C20"..comsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", "/C20"..comcopper);
								else
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.goldlabel", comgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.silverlabel", comsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.commissioncharge.copperlabel", comcopper);
								end;
								
								local totalprice=totalprice+commissioncharge;
								local totalgold=math.floor(totalprice/1000000);
								local totalsilver=math.floor((totalprice-totalgold*1000000)/1000);
								local totalcopper=totalprice-totalgold*1000000-totalsilver*1000;
								if totalprice>9999999999 then
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20".."9999");
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20".."999");
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20".."999");
								elseif totalprice>GetMoney() then
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", "/C20"..totalgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", "/C20"..totalsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", "/C20"..totalcopper);		
								else
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.goldlabel", totalgold);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.silverlabel", totalsilver);
									Win_SetText("UI.gameui.confirmbuyjudedlg.totalprice.copperlabel", totalcopper);				
								end;
							end;									
						};
					};
				};
				
				commissioncharge=
				{
					type="LABEL",
					rect={118,112,110,12},
					enable=0;
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							richmode=ui_richmode_color,	
							textstyle=dt_center+dt_vcenter,
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,
							richmode=ui_richmode_color,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							richmode=ui_richmode_color,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
					};					
				};
				
				totalprice=
				{
					type="LABEL",
					rect={118,138,110,12},
					enable=0;
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							richmode=ui_richmode_color,	
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							textstyle=dt_center+dt_vcenter,
							richmode=ui_richmode_color,	
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							richmode=ui_richmode_color,	
							enable=1,
						};
					};					
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={238,20,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={217,20,23,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("购买彩玉");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={56,175,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					soundid={1005},	
					
					OnClick=function()
						local judenum = Win_GetValue("UI.gameui.confirmbuyjudedlg.judenum");
						if judenum == 0 then
							Win_ShowMsgBox("彩玉数量不可以为0！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmbuyjudedlg.affirmbtn");
							return;
						end;
						
						local mysilver = Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
						local mycopper=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.copperedit");
						if mysilver == 0 and mycopper == 0 then
							Win_ShowMsgBox("彩玉单价不可以为0！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmbuyjudedlg.affirmbtn");
							return;
						end;
						
						local totalprice=judenum*(mysilver*1000+mycopper);
						local commissioncharge=math.floor(totalprice/100);
						local totalprice=totalprice+commissioncharge;
						if totalprice>GetMoney() then
							Win_ShowMsgBox("您的游戏币不足，不能购买彩玉！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmbuyjudedlg.affirmbtn");
							return;
						elseif totalprice>999999999 then
							Win_ShowMsgBox("您的总花费达到系统上限1000金币，不能购买彩玉！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmbuyjudedlg.affirmbtn");
							return;
						end;
						
						local num, numvalid, numnew, numvalidsys = GetNumMail();
						if numvalidsys > 25 then 
							Win_ShowMsgBox("系统邮件超过25封，无法购买彩玉，请整理系统邮件后再试！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmbuyjudedlg.affirmbtn");
							return;
						end;
						
						Win_ShowMsgBox("您确定购买彩玉？", "系统消息", ui_msgid_yesno, "UI.gameui.confirmbuyjudedlg.affirmbtn");
					end;
					
					OnMsgBoxOk=function()
						local judenum=Win_GetValue("UI.gameui.confirmbuyjudedlg.judenum");
						local silver=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.silveredit");
						local copper=Win_GetValue("UI.gameui.confirmbuyjudedlg.myjudeprice.copperedit");
						local price=silver*1000+copper;
						BuyBowlder(judenum, price);
						Win_ShowWidget("UI.gameui.confirmbuyjudedlg", false);
						CloseBowlderDlg(2);
					end;

				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={166,175,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				};
			};
		};
		--撤消寄售彩玉
		cancelselljudedlg=
		{
			type="DIALOG";
			bkimage="res/uires/judedlg/buyjudedlgbk.gsa";
			adornpic={"res/uires/judedlg/label_cancelselljude.gsa", "res/uires/judedlg/label_cancelselljude_info.gsa"},
			adornpicpos={{187,17},{334, 50}},
			rect={0,0,459,328};
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetText("UI.gameui.cancelselljudedlg.introduction", "1、撤回寄售的彩玉不会退还寄售手续费用。\n2、撤回后你需要在我这里领取撤回的彩玉。");
				
				local money=GetMoney();
				local gold=math.floor(money/1000000);
				local silver=math.floor((money-gold*1000000)/1000);
				local copper=money-gold*1000000-silver*1000;
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.goldlabel",gold);
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.silverlabel",silver);
				Win_SetText("UI.gameui.cancelselljudedlg.mytotalmoney.copperlabel",copper);	
				
				local bowlder = GetMyJude();
				Win_SetText("UI.gameui.cancelselljudedlg.mytotaljude",bowlder.."/999999");					

				SetGlobalQuery(GlobalQuery_CancelSellJude, 1);
				
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
				EndConsign(0,false);
				SetGlobalQuery(GlobalQuery_CancelSellJude, 0);
			end;
			
			OnCancel=function()
				CloseBowlderDlg(3);
			end;
			
			children=
			{
				introduction=
				{
					type="LABEL",
					rect={284,71,154,210},
					textsize=12,
					rowspace=1;
					textstyle=dt_left+dt_top,
					drawcolor={220,200,147,255},
					enable=0,
				};
				
				cancelselljudeinfolist=
				{
					type="WIDGETLIST",
					rect={42,75,233,182},	
					style=wgtstyle_clipself+wgtstyle_renderitem+wgtstyle_vertical,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					itemselback="res/uires/family/detailitemsel.gsa",			
					updatemute=1,
					itemmarginh=0,
					itemmarginv=0,
					template={"res/uires/cancelselljudeinfo.lua"},
					
					children={},
				};
										
				mytotalmoney=
				{
					type="LABEL",
					rect={120,269,110,12},
					enable=0,
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							bkcolor={0,0,0,0},
							enable=1,
						};
					};					
				};
				
				mytotaljude=
				{
					type="LABEL",
					rect={120,295,110,12},
					textsize=12,
					enable=0,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={431,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",

					OnClick=function()
						CloseBowlderDlg(3);
					end;
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={409,19,23,22};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("撤消寄售彩玉");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				exchangejudebtn=
				{
					type="BUTTON",
					rect={355,288,86,24},
					bkimage="res/uires/judedlg/exchangejudebtn.gsa",
					
					OnClick=function()
						--Win_ShowWidget("UI.gameui.cancelselljudedlg",false);
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
					end;
				};
				
				historypricebtn=
				{
					type="BUTTON",
					rect={258,288,86,24},
					bkimage="res/uires/judedlg/historypricebtn.gsa",
				};
			};
		};
		
		--确认撤消寄售彩玉
		confirmcancelselljudedlg=
		{
			type="DIALOG";
			bkimage="res/uires/judedlg/confirmcancelselljudedlgbk.gsa";
			rect={0,0,267,207};
			style=wgtstyle_topmost+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.confirmcancelselljudedlg", false);
			end;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.confirmcancelselljudedlg");
				Win_SetFocus("UI.gameui.confirmcancelselljudedlg");
			end;
			
			OnSelfHide=function()
				Win_SetFocus("UI.gameui.cancelselljudedlg");
			end;
			
			children=
			{
				judenum=
				{
					type="LABEL",
					rect={118,59,36,12},
					style=dt_center,
					textsize=12,
					enable=0;
				};
				
				myjudeprice=
				{
					type="LABEL",
					rect={118,86,110,12},
					enable=0;
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							caption="0",
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
					};	
				};
				totalprice=
				{
					type="LABEL",
					rect={118,116,110,12},
					enable=0;
					
					children=
					{
						goldlabel=
						{
							type="LABEL",
							rect={0,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/gold.gsa",
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=1,					
						};
						
						silverlabel=
						{
							type="LABEL",
							rect={36,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/silver.gsa",
							textsize=12,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
						
						copperlabel=
						{
							type="LABEL",
							rect={72,0,36,12},
							captionrect={12,0,24,12},
							bkimage="res/uires/common/copper.gsa",
							textsize=12,	
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
					};					
				};
				
				consigntime=
				{
					type="LABEL",
					rect={118,145,110,12},
					enable=0;
					
					children=
					{
						hour=
						{
							type="LABEL",
							rect={0,0,36,12},
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
						minute=
						{
							type="LABEL",
							rect={36,0,36,12},
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
						second=
						{
							type="LABEL",
							rect={72,0,36,12},
							textsize=12,
							textstyle=dt_center+dt_vcenter,
							enable=1,
						};
					};
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={238,20,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,					
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={217,20,23,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("撤消寄售彩玉");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={56,175,69,24},
					bkimage="res/uires/newcommon/affirmbtn.gsa",
					--defaultok=1,
					soundid={1005},	

					OnMsgBoxOk=function()
						local seqno=Win_GetValue("UI.gameui.confirmcancelselljudedlg.affirmbtn", value_channel_customindex);
						CancelSellBowlder(seqno);
						Win_ShowWidget("UI.gameui.confirmcancelselljudedlg", false);
						CloseBowlderDlg(3);
					end;
					
					OnClick=function()
						local num, numvalid, numnew, numvalidsys = GetNumMail();
						if numvalidsys > 25 then 
							Win_ShowMsgBox("系统邮件超过25封，无法撤消寄售彩玉，请整理系统邮件后再试！", "系统消息", ui_msgid_affirm, "UI.gameui.confirmcancelselljudedlg.affirmbtn");
							return;
						end;
						
						Win_ShowMsgBox("您确定撤消寄售彩玉？", "系统消息", ui_msgid_yesno, "UI.gameui.confirmcancelselljudedlg.affirmbtn");
					end;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={166,175,69,24},
					bkimage="res/uires/newcommon/cancelbtn2.gsa",	
					defaultcancel=1,
					soundid={1007},
				};
			};
		};
		--神奇烟火
		magicfiredlg=
		{
			type="DIALOG";
			bkimage="res/uires/rackdlg/magicfiredlgbk.gsa";
			rect={0,0,359,372};
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			moveable=1,
			visible=0,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.magicfiredlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				
				Win_SetValue("UI.gameui.magicfiredlg.firelist",64,value_channel_item_num);
				Win_SetValue("UI.gameui.magicfiredlg",1,value_channel_customindex);
				Win_SetValue("UI.gameui.magicfiredlg",1,value_channel_customtype);
				UI.children.gameui.children.magicfiredlg.SetSelFire(1);
				
				for i=0,63 do
					Win_SetText("UI.gameui.magicfiredlg.firelist.fireitem"..i,"",value_channel_effectpic);
					Win_SetValue("UI.gameui.magicfiredlg.firelist.fireitem"..i,0,value_channel_customindex);
					SetFireType(i,0);
				end;
				
				end;
			
			OnOk=function()
				AffirmFireType();
				end;
			
			SetSelFire=function(idx)
				Win_SetText("UI.gameui.magicfiredlg.fire1","",value_channel_backpic);
				Win_SetText("UI.gameui.magicfiredlg.fire2","",value_channel_backpic);
				Win_SetText("UI.gameui.magicfiredlg.fire3","",value_channel_backpic);
				Win_SetText("UI.gameui.magicfiredlg.fire1","点击选择心形烟火",value_channel_tiptext);
				Win_SetText("UI.gameui.magicfiredlg.fire2","点击选择星形烟火",value_channel_tiptext);
				Win_SetText("UI.gameui.magicfiredlg.fire3","点击选择圆形烟火",value_channel_tiptext);
				
				if idx == 1 then
					Win_SetText("UI.gameui.magicfiredlg.fire1","res/uires/rackdlg/selbk.gsa",value_channel_backpic);
					Win_SetText("UI.gameui.magicfiredlg.fire1","点击取消选择心形烟火",value_channel_tiptext);
				elseif idx == 2 then
					Win_SetText("UI.gameui.magicfiredlg.fire2","res/uires/rackdlg/selbk.gsa",value_channel_backpic);
					Win_SetText("UI.gameui.magicfiredlg.fire2","点击取消选择星形烟火",value_channel_tiptext);
				elseif idx == 3 then
					Win_SetText("UI.gameui.magicfiredlg.fire3","res/uires/rackdlg/selbk.gsa",value_channel_backpic);
					Win_SetText("UI.gameui.magicfiredlg.fire3","点击取消选择圆形烟火",value_channel_tiptext);
				end;
				end;
				
			children=
			{
				firelist=
				{
					type="WIDGETLIST";
					rect={34,71,240,240};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					itemwidth=20,
					itemheight=20,
					itemmarginh=1,
					itemmarginv=1,	
					itemnum=64,
					
					template={"res/uires/fireitem.lua"};
					children={},
				};

				fire1=
				{
					type="WIDGET";
					drawflag=drawflag_draw_effect;
					effectpic="res/uires/common/fireeffect1.gsa";
					effectpicpos={2,2};
					rect={299,88,29,29};
					bkimagepos={2,2},
					tiptext="点击取消选择心形烟火",
					
					OnClick=function()
						local clickedidx = Win_GetValue("UI.gameui.magicfiredlg",value_channel_customindex);
						if clickedidx == 1 then
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(0);
						else
							Win_SetValue("UI.gameui.magicfiredlg",1,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",1,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(1);
						end;
						end;
				};

				fire2=
				{
					type="WIDGET";
					drawflag=drawflag_draw_effect;
					effectpic="res/uires/common/fireeffect2.gsa";
					effectpicpos={2,2};
					rect={299,176,29,29};
					bkimagepos={2,2},
					tiptext="点击选择星形烟火",
					
					OnClick=function()
						local clickedidx = Win_GetValue("UI.gameui.magicfiredlg",value_channel_customindex);
						if clickedidx == 2 then
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(0);
						else
							Win_SetValue("UI.gameui.magicfiredlg",2,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",2,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(2);
						end;
						end;
				};

				fire3=
				{
					type="WIDGET";
					drawflag=drawflag_draw_effect;
					effectpic="res/uires/common/fireeffect3.gsa";
					effectpicpos={2,2};
					rect={299,258,29,29};
					bkimagepos={2,2},
					tiptext="点击选择圆形烟火",
					
					OnClick=function()
						local clickedidx = Win_GetValue("UI.gameui.magicfiredlg",value_channel_customindex);
						if clickedidx == 3 then
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",0,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(0);
						else
							Win_SetValue("UI.gameui.magicfiredlg",3,value_channel_customtype);
							Win_SetValue("UI.gameui.magicfiredlg",3,value_channel_customindex);
							UI.children.gameui.children.magicfiredlg.SetSelFire(3);
						end;
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={67,326,57,22},
					bkimage="res/uires/rackdlg/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},				
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={240,325,57,22},
					bkimage="res/uires/rackdlg/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},				
				},
				
				closebtn=
				{
					type="BUTTON",
					rect={333,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,					
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 313,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("神奇烟火");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};

			};
		};
		
		--选择竞技场界面
		selectarenadlg=
		{
			type="DIALOG";
			rect={0,0,626,435};
			bkimage="res/uires/arenadlg/selectarenadlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,		
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,		
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.selectarenadlg.arenalist",0,value_channel_customindex);
				Win_SetText("UI.gameui.selectarenadlg.arenalist","",value_channel_customname);
				
				local num = GetListArenaCount();
				if num > 0 then
				Win_SetValue("UI.gameui.selectarenadlg.arenalist",0,value_channel_sel);
				else 
				Win_SetValue("UI.gameui.selectarenadlg.arenalist",-1,value_channel_sel);
				SetCurArenaMap(0);
				end;
				
				if num > 0 then
				local arena = GetListArenaInfo(0);
				SetCurArenaMap(arena.mapid);
				local arenainfo = GetArenaMapInfo(1,arena.arenaid);
				if arenainfo.athnum >= 1 and arenainfo.athnum <= 10 then
				Win_SetValue("UI.gameui.selectarenadlg.arenainfo",math.floor((arenainfo.athnum-1)/2),value_channel_framescheme)
				else
				Win_SetValue("UI.gameui.selectarenadlg.arenainfo",4,value_channel_framescheme)
				end;
				
				local canenter = CanEnterArena(0);
				Win_EnableWidget("UI.gameui.selectarenadlg.enterbtn", canenter~=0);
				Win_EnableWidget("UI.gameui.selectarenadlg.watchbtn", arena.bfighting==0);
				
				else
				Win_EnableWidget("UI.gameui.selectarenadlg.enterbtn", false);
				Win_EnableWidget("UI.gameui.selectarenadlg.watchbtn", false);
				end;
				
				local cancreate = CanCreateArena();
				Win_EnableWidget("UI.gameui.selectarenadlg.createbtn", cancreate~=0);
				
				UI.children.gameui.CloseMainLabelBK();
								
				if IsShowMatchArena() then
					Win_ShowWidget("UI.gameui.selectarenadlg.ShowMatchArenaBtn", false);
					Win_ShowWidget("UI.gameui.selectarenadlg.CancelShowMatchArenaBtn", true);
				else
					Win_ShowWidget("UI.gameui.selectarenadlg.ShowMatchArenaBtn", true);
					Win_ShowWidget("UI.gameui.selectarenadlg.CancelShowMatchArenaBtn", false);
				end;
										
				local selecttab = Win_GetValue("UI.gameui.selectarenadlg", value_channel_customid);
				if selecttab == 1 then
					Win_SelectSelf("UI.gameui.selectarenadlg.newbietab");
				elseif selecttab == 2 then
					Win_SelectSelf("UI.gameui.selectarenadlg.lowtab");
				elseif selecttab == 3 then
					Win_SelectSelf("UI.gameui.selectarenadlg.midtab");
				elseif selecttab == 4 then
					Win_SelectSelf("UI.gameui.selectarenadlg.hightab");
					--Win_BringToTop("UI.gameui.selectarenadlg.hightiplabel");	
				elseif selecttab == 5 then
					Win_SelectSelf("UI.gameui.selectarenadlg.freetab");
				else
					Win_SelectSelf("UI.gameui.selectarenadlg.newbietab");
				end;
				
				SetGlobalQuery(GlobalQuery_ArenaListDlg,1);				
			end;
			
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_ArenaListDlg,0);
				end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.selectarenadlg",false);
				ExitArenaList();
				end;
			
			children=
			{
				yellowbar=
				{
					type="LABEL",
					rect={425,73,23,21},
					bkimage="res/uires/arenadlg/yellowbar.gsa",
				};
				
				arenaidbtn=
				{
					type="BUTTON",
					rect={53,73,102,21},
					bkimage="res/uires/arenadlg/arenabtn.gsa",
					
					OnClick=function()
						SetArenaSortType(0);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
					end;
				};
				
				levelbtn=
				{
					type="BUTTON",
					rect={155,73,45,21},
					bkimage="res/uires/arenadlg/levelbtn.gsa",
					
					OnClick=function()
						SetArenaSortType(1);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
						end;
				};
				
				mapidbtn=
				{
					type="BUTTON",
					rect={200,73,53,21},
					bkimage="res/uires/arenadlg/mapbtn.gsa",
					
					OnClick=function()
						SetArenaSortType(2);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
						end;
				};
				
				memnumbtn=
				{
					type="BUTTON",
					rect={253,73,46,21},
					bkimage="res/uires/arenadlg/numbtn.gsa",

					OnClick=function()
						SetArenaSortType(3);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
						end;
				};
				
				ownerbtn=
				{
					type="BUTTON",
					rect={299,73,65,21},
					bkimage="res/uires/arenadlg/ownerbtn.gsa",
					
					OnClick=function()
						SetArenaSortType(4);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
						end;
				};
				
				modebtn=
				{
					type="BUTTON",
					rect={364,73,61,21},
					bkimage="res/uires/arenadlg/modebtn.gsa",
					
					OnClick=function()
						SetArenaSortType(5);
						UI.children.gameui.children.selectarenadlg.children.arenalist.OnUpdate();
						end;
				};
				
				arenalist=
				{
					type="LISTBOX";
					rect={54,95,372,316};
					style=wgtstyle_clipself,		
					extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix,
					dragtype=ui_drag_type_arenalist,
					itemselback="res/uires/family/detailitemsel.gsa",
					itemselpos={0, 2, 394, 16},
					itemdrawback="res/uires/teamdlg/itembk.gsa",	
					itemdrawpos={0,22,0,0},
					itemwidth=358,
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,	
					textsize=12,				
					mornitor={value_channel_item_num};
					tipwidget="UI.gameui.ScrnTooltip",
					
					primaryscroll="UI.gameui.selectarenadlg.arenascroll",
					
					OnUpdate=function()
						local pos = Win_GetValue("UI.gameui.selectarenadlg.arenascroll",value_channel_pos);
						
						local sel = Win_GetValue("UI.gameui.selectarenadlg.arenalist",value_channel_customindex);
						local name = Win_GetText("UI.gameui.selectarenadlg.arenalist",value_channel_customname);
						if name ~= "" then
							local namesel = GetArenaListIndexByName(name);
							if namesel >= 0 then sel = namesel; end;
						end;
						local num = Win_GetValue("UI.gameui.selectarenadlg.arenalist",value_channel_item_num);
						
						if num > 0 then
							if sel < num then
								if sel >= 0 then
								Win_SetValue("UI.gameui.selectarenadlg.arenalist",sel,value_channel_sel);
								UI.children.gameui.children.selectarenadlg.children.arenalist.OnValueChange(sel);
								else
								Win_SetValue("UI.gameui.selectarenadlg.arenalist",0,value_channel_sel);
								UI.children.gameui.children.selectarenadlg.children.arenalist.OnValueChange(0);
								end;
							else
								Win_SetValue("UI.gameui.selectarenadlg.arenalist",num-1,value_channel_sel);
								UI.children.gameui.children.selectarenadlg.children.arenalist.OnValueChange(num-1);
							end;
						else
							Win_SetValue("UI.gameui.selectarenadlg.arenalist",0,value_channel_sel);
							if not Win_IsVisible("UI.gameui.createarenadlg") then
								SetCurArenaMap(0);
							end;

						end;
						 
						Win_SetValue("UI.gameui.selectarenadlg.arenascroll",pos,value_channel_pos);
						
						end;
					
					OnValueChange=function(sel)
						if Win_IsVisible("UI.gameui.createarenadlg") then
							return;
						end;
						
						if sel>=0 then
						Win_SetValue("UI.gameui.selectarenadlg.arenalist",sel,value_channel_customindex);
						local arena = GetListArenaInfo(sel);
						Win_SetText("UI.gameui.selectarenadlg.arenalist",arena.name,value_channel_customname);
						SetCurArenaMap(arena.mapid);
						local arenainfo = GetArenaMapInfo(1,arena.arenaid);
						if arenainfo.athnum >= 1 and arenainfo.athnum <= 10 then
						Win_SetValue("UI.gameui.selectarenadlg.arenainfo",math.floor((arenainfo.athnum-1)/2),value_channel_framescheme)
						else
						Win_SetValue("UI.gameui.selectarenadlg.arenainfo",4,value_channel_framescheme)
						end;
						
						local canenter = CanEnterArena(sel);
						Win_EnableWidget("UI.gameui.selectarenadlg.enterbtn", canenter~=0);
						Win_EnableWidget("UI.gameui.selectarenadlg.watchbtn", arena.bfighting==0);
						end;
						end;
				},--list
				
				arenascroll=
				{
					type="SCROLLBAR",
					rect={428,115,20,273},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.selectarenadlg.arenalist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				newbietab=
				{
					type="TABWIN",
					rect={54,95,0,0},									
					tabrect={-30,62,28,62},
					tabcover="res/uires/arenadlg/newbietab.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					tiptext="勇士1 - 勇士5",
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							SetSelectArenaList(1);
							Win_SetValue("UI.gameui.selectarenadlg", 1, value_channel_customid);
						end;
					end;
				};
				
				lowtab=
				{
					type="TABWIN",
					rect={54,157,0,0},					
					tabrect={-30,61,28,62},
					tabcover="res/uires/arenadlg/lowtab.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					tiptext="勇士5 - 英雄1",
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							SetSelectArenaList(2);
							Win_SetValue("UI.gameui.selectarenadlg", 2, value_channel_customid);
						end;
					end;
				};
				
				midtab=
				{
					type="TABWIN",
					rect={54,218,0,0},									
					tabrect={-30,61,28,62},
					tabcover="res/uires/arenadlg/midtab.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					tiptext="勇士9 - 至尊9",
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							SetSelectArenaList(3);
							Win_SetValue("UI.gameui.selectarenadlg", 3, value_channel_customid);
						end;
					end;
				};
				--[[
				hightiplabel=
				{
					type="LABEL",
					rect={25,279,28,62},
					tiptext="进入时间为每周六的13:30-14:30",
					style=wgtstyle_autoactive,
				};
				]]
				hightab=
				{
					type="TABWIN",
					rect={54,279,0,0},									
					tabrect={-30,61,28,62},
					tabcover="res/uires/arenadlg/happytab.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					tiptext="进入时间为每周六的13:30-14:30,\n其他开放时间请关注游戏活动",
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							-- 欢乐场开放时间每周六13:30 - 14:30
							--local serverWeek, serverMinites = GetServerWeekMinites();
							--if serverWeek == 6 and serverMinites >= (13*60+30) and serverMinites <= (14*60+30) then
								SetSelectArenaList(4);
								Win_SetValue("UI.gameui.selectarenadlg", 4, value_channel_customid);								
							--else
							--	Win_SetCheck("UI.gameui.selectarenadlg.hightab", false);
							--end
						end;
					end;
				};				
				
				freetab=
				{
					type="TABWIN",
					rect={54,340,0,0},									
					tabrect={-30,61,28,62},
					tabcover="res/uires/arenadlg/freetab.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					tiptext="无进入限制",
					
					OnCheck=function(bcheck)
						if bcheck ~= 0 then
							SetSelectArenaList(5);
							Win_SetValue("UI.gameui.selectarenadlg", 5, value_channel_customid);
						end;
					end;
				};
				
				sketchmap=
				{
					type="WIDGET";
					rect={464,101,115,116};
					clientrect = { 0,0,115,116 },
					style=wgtstyle_renderbuffer+wgtstyle_clipself,
					custombuffer=custom_buffer_arenamap,		
				};

				arenainfo=
				{
					type="LABEL";
					rect={491,237,58,22};
					framescheme={{0},{1},{2},{3},{4}},
					bkimage="res/uires/arenadlg/arenainfobtn.gsa",
					visible=1,
				};

				--快速匹配
				ShowMatchArenaBtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/matchbtn.gsa";
					rect={479,305,86,24};
					soundid={1006};
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.selectarenadlg.ShowMatchArenaBtn", false);
						Win_ShowWidget("UI.gameui.selectarenadlg.CancelShowMatchArenaBtn", true);
						ShowMatchArena(true);
					end;	
				};
				
				CancelShowMatchArenaBtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/cancelmatchbtn.gsa";
					rect={479,305,86,24};
					soundid={1006};
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.selectarenadlg.ShowMatchArenaBtn", true);
						Win_ShowWidget("UI.gameui.selectarenadlg.CancelShowMatchArenaBtn", false);
						ShowMatchArena(false);
					end;	
				};
				
				createbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/createbtn.gsa";
					rect={468,343,42,20};
					soundid={1006};
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.selectarenadlg",false);
						Win_ShowWidget("UI.gameui.createarenadlg",true);
						Win_SetValue("UI.gameui.arenadlg.chatbar.syschatpanel.chatlist",0,value_channel_item_num);
						Win_SetValue("UI.gameui.arenadlg.chatbar.chatpanel.chatlist",0,value_channel_item_num);	
						end;
					
					OnMouseIn=function()
						local cancreate = CanCreateArena();
						Win_EnableWidget("UI.gameui.selectarenadlg.createbtn", cancreate~=0);
						end;
				};

				watchbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/watchbtn.gsa";
					rect={533,343,42,20};
					soundid={1006};
					
					OnClick=function()
						local sel  = Win_GetValue("UI.gameui.selectarenadlg.arenalist",value_channel_sel);
						WatchArena(sel);
						Win_SetValue("UI.gameui.arenadlg.chatbar.syschatpanel.chatlist",0,value_channel_item_num);
						Win_SetValue("UI.gameui.arenadlg.chatbar.chatpanel.chatlist",0,value_channel_item_num);	
						end;
				};

				enterbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/enterbtn.gsa";
					rect={468,373,42,20};
					soundid={1006};
					
					OnClick=function()
						local sel  = Win_GetValue("UI.gameui.selectarenadlg.arenalist",value_channel_sel);
						local ret = EnterArena(sel);
						if ret == 1 then
							Win_SetValue("UI.gameui.arenadlg.chatbar.syschatpanel.chatlist",0,value_channel_item_num);
							Win_SetValue("UI.gameui.arenadlg.chatbar.chatpanel.chatlist",0,value_channel_item_num);	
						end;
					end;
				};

				exitbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/exitbtn.gsa";
					rect={533,373,42,20};
					soundid={1006};
					defaultcancel=1;
				};

				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa",
					rect={572,21,22,23};
					defaultcancel=1;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 551,21,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("选择竞技场");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		--创建竞技场
		createarenadlg=
		{
			type="DIALOG";
			bkimage="res/uires/arenadlg/createarenadlgbk.gsa",
			rect={75,31,423,347};
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself+wgtstyle_customclose,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,	

			OnSelfShow=function()
				Win_SetText("UI.gameui.createarenadlg.nameedit","");
				Win_SetText("UI.gameui.createarenadlg.mapedit", "");
				Win_SetFocus("UI.gameui.createarenadlg.nameedit");
				
				local arenainfo = GetArenaMapInfo(0,0);
				if arenainfo.mapid ~= 0 then
					Win_SetText("UI.gameui.createarenadlg.mapedit", arenainfo.mapname);
					SetCurArenaMap(arenainfo.mapid);
					Win_SetValue("UI.gameui.createarenadlg.arenainfo",math.floor((arenainfo.athnum-1)/2),value_channel_framescheme);
					
					Win_SetValue("UI.gameui.createarenadlg.minleveledit",arenainfo.minlevel);
					--Win_SetValue("UI.gameui.createarenadlg.minleveledit",arenainfo.minlevel,value_channel_minvalue);
					--Win_SetValue("UI.gameui.createarenadlg.minleveledit",arenainfo.maxlevel,value_channel_maxvalue);
					
					Win_SetValue("UI.gameui.createarenadlg.maxleveledit",arenainfo.maxlevel);
					--Win_SetValue("UI.gameui.createarenadlg.maxleveledit",arenainfo.minlevel,value_channel_minvalue);
					--Win_SetValue("UI.gameui.createarenadlg.maxleveledit",arenainfo.maxlevel,value_channel_maxvalue);
					
					Win_SetText("UI.gameui.createarenadlg.mapdesclabel", "          "..arenainfo.mapdesc);
				end;
			end;
			
			OnEnter=function()
				if Win_IsEnabled("UI.gameui.createarenadlg.createbtn") then
				UI.children.gameui.children.createarenadlg.children.createbtn.OnClick();
				end;
				end;
			
			OnEscape=function()
				UI.children.gameui.children.createarenadlg.children.returnbtn.OnClick();
				end;
			
			OnClick=function()
				Win_SetFocus("UI.gameui.createarenadlg.nameedit");
				end;

			children=
			{
				sketchmap=
				{
					type="WIDGET";
					bkimage="res/uires/titleui/mainlogo.gsa";
					rect={274,65,113,115};
					clientrect = { 0,0,113,115 },
					style=wgtstyle_renderbuffer+wgtstyle_clipself,
					custombuffer=custom_buffer_arenamap,	
				};
				
				arenainfo=
				{
					type="LABEL";
					rect={298,188,58,22};
					bkimage="res/uires/arenadlg/arenainfobtn.gsa",
					framescheme={{0},{1},{2},{3},{4}},
					visible=1,
				};

				nameedit=
				{
					type="EDIT";
					rect={135,66,120,12},
					focuscolor = { 0, 0, 0, 255 },
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					maxchar=16,
					editable=1,
				
					OnValueChange=function()
						local txt = Win_GetText("UI.gameui.createarenadlg.nameedit");
						if txt ~= "" then
						Win_EnableWidget("UI.gameui.createarenadlg.createbtn",true);
						else
						Win_EnableWidget("UI.gameui.createarenadlg.createbtn",false);
						end;
						end;
				};

				mapedit=
				{
					type="EDIT";
					rect={135,101,100,12};
					textsize=12;
					style=dt_vcenter+dt_center;
				};
				
				maplistbtn = 
				{
					type = "CHECK",
					rect = {238,99,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.createarenadlg.maplistbtn")  then
						Win_SetValue("UI.gameui.listdlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.listdlg",true);
						else 
						Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.listdlg",false);
						end;						     
						end;						
				},	
				
				minleveledit=
				{
					type="EDIT";
					rect={135,137,120,12};
					textsize=12;
					style=dt_vcenter+dt_center;
					editmethod = ui_editmethod_number+ui_editmethod_value,
					editable=1,
				};
				
--~ 				minlevellistbtn = 
--~ 				{
--~ 					type = "CHECK",
--~ 					rect = {208,161,16,16 },
--~ 					bkimage = "res/uires/common/dropbtn.gsa",	
--~ 					bkimagepos={1,2},
--~ 					extendstyle=ui_btn_style_none,
--~ 					
--~ 					OnClick=function()
--~ 						if  Win_IsChecked("UI.gameui.createarenadlg.minlevellistbtn")  then
--~ 						Win_SetValue("UI.gameui.listdlg",2,value_channel_customtype);
--~ 						Win_ShowWidget("UI.gameui.listdlg",true);
--~ 						else 
--~ 						Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
--~ 						Win_ShowWidget("UI.gameui.listdlg",false);
--~ 						end;						     
--~ 						end;						
--~ 				},	
				
				maxleveledit=
				{
					type="EDIT";
					rect={135,171,120,12};
					textsize=12;
					style=dt_vcenter+dt_center;
					editmethod = ui_editmethod_number+ui_editmethod_value,	
					editable=1,
				};
				
--~ 				maxlevellistbtn = 
--~ 				{
--~ 					type = "CHECK",
--~ 					rect = {207,211,16,16 },
--~ 					bkimage = "res/uires/common/dropbtn.gsa",	
--~ 					bkimagepos={1,2},
--~ 					extendstyle=ui_btn_style_none,
--~ 					
--~ 					OnClick=function()
--~ 						if  Win_IsChecked("UI.gameui.createarenadlg.maxlevellistbtn")  then
--~ 						Win_SetValue("UI.gameui.listdlg",3,value_channel_customtype);
--~ 						Win_ShowWidget("UI.gameui.listdlg",true);
--~ 						else 
--~ 						Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
--~ 						Win_ShowWidget("UI.gameui.listdlg",false);
--~ 						end;						     
--~ 						end;						
--~ 				},	
				
				mapdesclabel=
				{
					type = "LABEL",
					rect={63,224,325,70},
					textsize=12,
					textstyle=dt_left,
				};
				
				createbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/createbtnbig.gsa";
					rect={81,300,86,24};
					soundid={1006};
					
					OnClick=function()
						local name = Win_GetText("UI.gameui.createarenadlg.nameedit");
						local mapid = Win_GetText("UI.gameui.createarenadlg.mapedit");
						local minlevel = Win_GetValue("UI.gameui.createarenadlg.minleveledit");
						local maxlevel = Win_GetValue("UI.gameui.createarenadlg.maxleveledit");
						if name == "" then
							Win_ShowMsgBox("请输入竞技场名称！");
						else
							CreateArena(name, mapid, minlevel, maxlevel);
						end;
					end;
				};

				returnbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/returnbtn.gsa";
					rect={286,300,86,24};
					soundid={1006};
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.createarenadlg",false);
						Win_ShowWidget("UI.gameui.selectarenadlg",true);
						end;
				};
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa",
					rect={387,23,22,23};
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.createarenadlg",false);
						Win_ShowWidget("UI.gameui.selectarenadlg",true);
					end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 366,23,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("创建竞技场");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			
			};
		};
		
		--竞技场创建界面列表选择
		listdlg=
		{
			type="DIALOG",
			rect={0,0,106,105},
			style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_clipself,
			edgecheck=edge_check_show+edge_check_auto,
			visible=0,
			initlayer=msgbox_layer;
			
			bkcolor= { 26, 27, 22, 196 },
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			sizeable=1,
						
			mornitor={value_channel_visible},
					
			OnUpdate=function()
				local customtype = Win_GetValue("UI.gameui.listdlg",value_channel_customtype);
				
				--竞技场地图列表
				if customtype == 1 then
				
				if not Win_IsVisible("UI.gameui.createarenadlg")  then											
				if Win_IsChecked("UI.gameui.createarenadlg.maplistbtn") then
				Win_SetCheck("UI.gameui.createarenadlg.maplistbtn",false);									
				end;						
				end;
				
				--竞技场最底等级列表
				elseif customtype == 2 then
				
				if not Win_IsVisible("UI.gameui.createarenadlg")  then											
				if Win_IsChecked("UI.gameui.createarenadlg.minlevellistbtn") then
				Win_SetCheck("UI.gameui.createarenadlg.minlevellistbtn",false);									
				end;						
				end;
				
				--竞技场最高等级列表
				elseif customtype == 3 then
				
				if not Win_IsVisible("UI.gameui.createarenadlg")  then											
				if Win_IsChecked("UI.gameui.createarenadlg.maxlevellistbtn") then
				Win_SetCheck("UI.gameui.createarenadlg.maxlevellistbtn",false);									
				end;						
				end;
				
				--竞技界面聊天对象
				elseif customtype == 4 then
				
				if not Win_IsVisible("UI.gameui.arenadlg") then
				if Win_IsChecked("UI.gameui.arenadlg.chatbar.inputbar.chaterbtn") then
				Win_SetCheck("UI.gameui.arenadlg.chatbar.inputbar.chaterbtn",false);
				end;
				end;
				
				--投票确认
				elseif customtype == 5 then
				
				if not Win_IsVisible("UI.gameui.voteaffirmdlg") then
				if Win_IsChecked("UI.gameui.voteaffirmdlg.menubtn") then
				Win_SetCheck("UI.gameui.voteaffirmdlg.menubtn", false);
				end;
				end;
				
				--added by qjb 装备强化
				elseif customtype == 30000 then
					if Win_IsChecked("UI.gameui.armspiritdlg.typebtn") then
						Win_SetCheck("UI.gameui.armspiritdlg.typebtn", false);
					end;
				elseif customtype == 30001 then
					if Win_IsChecked("UI.gameui.armspiritdlg.levelbtn") then
						Win_SetCheck("UI.gameui.armspiritdlg.levelbtn", false);
					end;
				end;
				
				end;
				
			AlignWinRect=function(num)
				local itemnum = 5;
				if num < itemnum then itemnum = num; end;
				Win_SetValue("UI.gameui.listdlg.list",itemnum*20,value_channel_winrect,3);
				Win_SetValue("UI.gameui.listdlg",itemnum*20+5,value_channel_winrect,3);
				end;

			OnSelfShow=function()
				local customtype = Win_GetValue("UI.gameui.listdlg",value_channel_customtype);
				
				--竞技场地图列表
				if customtype == 1 then
				
				local tgt,num=GetArenaCreateInfo(0);
				Win_SetValue("UI.gameui.listdlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.listdlg.list",tgt[i],value_channel_itemtext,i-1);
				end;				
				
				UI.children.gameui.children.listdlg.AlignWinRect(num);
				
				Win_AlignWidget("UI.gameui.listdlg","UI.gameui.createarenadlg.maplistbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				--竞技场最底等级列表
				elseif customtype == 2 then
				local tgt,num=GetArenaCreateInfo(1);
				Win_SetValue("UI.gameui.listdlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.listdlg.list",tgt[i],value_channel_itemtext,i-1);
				end;		
				
				UI.children.gameui.children.listdlg.AlignWinRect(num);
				
				Win_AlignWidget("UI.gameui.listdlg","UI.gameui.createarenadlg.minlevellistbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				--竞技场最高等级列表
				elseif customtype == 3 then
				local tgt,num=GetArenaCreateInfo(2);
				Win_SetValue("UI.gameui.listdlg.list",num,value_channel_item_num);
				for i=1,num do									  
				Win_SetText("UI.gameui.listdlg.list",tgt[i],value_channel_itemtext,i-1);
				end;		
				
				UI.children.gameui.children.listdlg.AlignWinRect(num);
				
				Win_AlignWidget("UI.gameui.listdlg","UI.gameui.createarenadlg.maxlevellistbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				--竞技场聊天对象
				elseif customtype == 4 then
				Win_SetValue("UI.gameui.listdlg.list",2,value_channel_item_num);
				Win_SetText("UI.gameui.listdlg.list","/C11所有人",value_channel_itemtext,0);
				Win_SetText("UI.gameui.listdlg.list","/C17盟友",value_channel_itemtext,1);
				UI.children.gameui.children.listdlg.AlignWinRect(2);
				Win_AlignWidget("UI.gameui.listdlg","UI.gameui.arenadlg.chatbar.inputbar.chaterbtn",aligntype_winrect,alignstyle_right_in+alignstyle_top_out);
				
				--投票确认
				elseif customtype == 5 then
				local info, num=GetVoteInfo()
				Win_SetValue("UI.gameui.listdlg.list",num,value_channel_item_num);
				for i=1, num do
				Win_SetText("UI.gameui.listdlg.list",i,value_channel_itemtext,i-1);
				end;
				UI.children.gameui.children.listdlg.AlignWinRect(num);
				Win_AlignWidget("UI.gameui.listdlg","UI.gameui.voteaffirmdlg.menubtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				--装备升级多选
				elseif customtype == 200 then
					nameTable = {GetCanUpdateEquip()};
					local num = table.getn(nameTable);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1,num do
						Win_SetText("UI.gameui.listdlg.list", nameTable[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.newarmupddlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);				
				
				--新装备强化系统
				elseif customtype == 201 then
					local num = 13;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "显示全部", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "矿石", value_channel_itemtext, 1);
					Win_SetText("UI.gameui.listdlg.list", "卡片", value_channel_itemtext, 2);
					Win_SetText("UI.gameui.listdlg.list", "法宝", value_channel_itemtext, 3);
					Win_SetText("UI.gameui.listdlg.list", "其它", value_channel_itemtext, 4);
					Win_SetText("UI.gameui.listdlg.list", "变装", value_channel_itemtext, 5);
					Win_SetText("UI.gameui.listdlg.list", "装备", value_channel_itemtext, 6);
					Win_SetText("UI.gameui.listdlg.list", "戒灵外形", value_channel_itemtext, 7);
					Win_SetText("UI.gameui.listdlg.list", "一次性圣化", value_channel_itemtext, 8);
					Win_SetText("UI.gameui.listdlg.list", "鞋魄合成", value_channel_itemtext, 9);
					Win_SetText("UI.gameui.listdlg.list", "羽灵外形", value_channel_itemtext, 10);
					Win_SetText("UI.gameui.listdlg.list", "项灵外形", value_channel_itemtext, 11);
					Win_SetText("UI.gameui.listdlg.list", "帽灵外形", value_channel_itemtext, 12);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.newcomposedlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 202 then
					local num = 2;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "显示可以合成", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "显示全部", value_channel_itemtext, 1);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.newcomposedlg.showbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 203 then
					local info, num=GetBurrowTypeInfo();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i-1], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.queryburrowdlg.alltab.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 204 then
					local typetxt = Win_GetText("UI.gameui.queryburrowdlg.alltab.typeedit");
					local info, num=GetBurrowLevelInfo(typetxt);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i-1], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.queryburrowdlg.alltab.levelbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 205 then
					local imin, imax = GetAutoForgeLevel();
					local num = imax-imin+1;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=imin, imax do
						Win_SetText("UI.gameui.listdlg.list", i, value_channel_itemtext, i-imin);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.autoforgedlg.levellistbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 206 then
					local num = 3;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "显示所有物品", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "显示已研究", value_channel_itemtext, 1);
					Win_SetText("UI.gameui.listdlg.list", "显示可研究", value_channel_itemtext, 2);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.Babaozhairesearchdlg.Showbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 207 then
					local num = GetFamilyItemTypeNum() + 1;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "显示全部", value_channel_itemtext, 0);
					for i=1, num do
						TypeName = GetFamilyItemType(i - 1);
						Win_SetText("UI.gameui.listdlg.list", TypeName, value_channel_itemtext, i);
					end;

					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.BabaozhaiBuydlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				elseif customtype == 208 then
					local num = 2;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "显示可以购买", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "显示全部", value_channel_itemtext, 1);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.BabaozhaiBuydlg.showbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				--added by qjb 装备强化
				elseif customtype == 30000 then
					local num = GetArmSpiritTypeNum(0);
					if num == 0 then
						Win_SetCheck("UI.gameui.armspiritdlg.typebtn", false);
						Win_ShowWidget("UI.gameui.listdlg",false);
					else
						Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
						for i=1, num do
							itemName = GetArmSpiritTypeName(0, i-1)
							Win_SetText("UI.gameui.listdlg.list", itemName, value_channel_itemtext, i-1);
						end;
						UI.children.gameui.children.listdlg.AlignWinRect(num);
						Win_AlignWidget("UI.gameui.listdlg","UI.gameui.armspiritdlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
					end;
				elseif customtype == 30001 then
					local num = GetArmSpiritTypeNum(1);
					if num == 0 then
						Win_SetCheck("UI.gameui.armspiritdlg.levelbtn", false);
						Win_ShowWidget("UI.gameui.listdlg",false);
					else
						Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
						for i=1, num do
							itemName = GetArmSpiritTypeName(1, i-1)
							Win_SetText("UI.gameui.listdlg.list", itemName, value_channel_itemtext, i-1);
						end;
						UI.children.gameui.children.listdlg.AlignWinRect(num);
						Win_AlignWidget("UI.gameui.listdlg","UI.gameui.armspiritdlg.levelbtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
					end;
		
			
				--设置自动补给补血道具选项1
				elseif customtype == 101 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn1", false);
				
				--设置自动补给补血道具选项1
				elseif customtype == 102 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlistbtn2", false);
					
				--设置自动补给补血百分比选项1
				elseif customtype == 103 then
					local filter = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel2");
					local info, num = GetAutoItemListItem(customtype-100, filter);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn1", false);
					
				--设置自动补给补血百分比选项2
				elseif customtype == 104 then
					local filter = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel1");
					local info, num = GetAutoItemListItem(customtype-100, filter);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrybtn2", false);
					
				--设置自动补给补法道具选项1
				elseif customtype == 105 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn1", false);
				
				--设置自动补给补法道具选项1
				elseif customtype == 106 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlistbtn2", false);
					
				--设置自动补给补法百分比选项1
				elseif customtype == 107 then
					local filter = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel2");
					local info, num = GetAutoItemListItem(customtype-100, filter);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn1", false);
					
				--设置自动补给补法百分比选项2
				elseif customtype == 108 then
					local filter = Win_GetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel1");
					local info, num = GetAutoItemListItem(customtype-100, filter);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrybtn2", false);
				
				-- 设置幻神的生命自动补给生命百分比选择
				elseif customtype == 111 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.hpentrybtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.hpentrybtn1", false);
				
				--设置幻神的生命自动补给道具选择
				elseif customtype == 112 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.hpitemlistbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.hpitemlistbtn1", false);
					
				--设置幻神的法力百分比选择
				elseif customtype == 113 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.spentrybtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.spentrybtn1", false);
					
				--设置幻神的法力自动补给道具选择
				elseif customtype == 114 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.spitemlistbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.spitemlistbtn1", false);
					
				--设置幻神的疲劳值百分比选择
				elseif customtype == 115 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.tiredentrybtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.tiredentrybtn1", false);
				
				--设置幻神的疲劳值自动补给道具选择
				elseif customtype == 116 then
					local info, num = GetAutoItemListItem(customtype-100);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.godautosupplydlg.tireditemlistbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.godautosupplydlg.tireditemlistbtn1", false);
					
				--技能栏扩展	
				elseif customtype == 121 then
					Win_SetValue("UI.gameui.listdlg.list", 6, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "关闭", value_channel_itemtext, 0);
					for i=1,5 do
						Win_SetText("UI.gameui.listdlg.list", "开启"..i.."个", value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(6);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.extendskilltab.extendbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab.extendbtn1", false);
				elseif customtype == 122 then
					Win_SetValue("UI.gameui.listdlg.list", 6, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "关闭", value_channel_itemtext, 0);
					for i=1,5 do
						Win_SetText("UI.gameui.listdlg.list", "开启"..i.."个", value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(6);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.extendskilltab.extendbtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab.extendbtn2", false);
				elseif customtype == 123 then
					Win_SetValue("UI.gameui.listdlg.list", 6, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "关闭", value_channel_itemtext, 0);
					for i=1,5 do
						Win_SetText("UI.gameui.listdlg.list", "开启"..i.."个", value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(6);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sysconfigdlg.extendskilltab.extendbtn3",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab.extendbtn3", false);	

				--设置目标副本	
				elseif customtype == 131 then
					local num = TeamPlat_GetNumPWorld();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", TeamPlat_GetPWorldNameAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.playertargetdlg.extendbtn1",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.playertargetdlg.extendbtn1", false);
						
				elseif customtype == 132 then
					local num = TeamPlat_GetNumPWorld();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", TeamPlat_GetPWorldNameAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.playertargetdlg.extendbtn2",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.playertargetdlg.extendbtn2", false);
				elseif customtype == 133 then
					local num = TeamPlat_GetNumPWorld();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", TeamPlat_GetPWorldNameAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.playertargetdlg.extendbtn3",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.playertargetdlg.extendbtn3", false);
				elseif customtype == 141 then
					local num = Mt_GetYHFDifNum();
					nTemp = num+1;
					Win_SetValue("UI.gameui.listdlg.list", nTemp, value_channel_item_num);
					
					Win_SetText("UI.gameui.listdlg.list", "全部", value_channel_itemtext, 0);
					
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", Mt_GetYHFDifAt(i), value_channel_itemtext, i+1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(nTemp);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.multiteamlistdlg.typebtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.multiteamlistdlg.typebtn", false);	
				elseif customtype == 142 then
					local num = Mt_GetYHFDifNum();
					
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", Mt_GetYHFDifAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.createmultiteamdlg.typebtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.createmultiteamdlg.typebtn", false);	
					
					--阵眼宠物
				elseif customtype == 151 then							
					local loadPetNum ,count= GetMyPetCount();
					Win_SetValue("UI.gameui.listdlg.list",count + 1 - loadPetNum, value_channel_item_num);
					
					local index = 0;
					for i = 0, 5 do
						if(GetPetNameAt(i) ~= nil) then 
							Win_SetText("UI.gameui.listdlg.list", GetPetNameAt(i), value_channel_itemtext, index);
							index = index + 1;
						end;
					end;
					
					if(GetPetCircleIsCanUnload(0)) then
						Win_SetText("UI.gameui.listdlg.list","卸下当前宠物", value_channel_itemtext,index);
					end;
					
					UI.children.gameui.children.listdlg.AlignWinRect(index + 1);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.petcircledlg.choosepetbtn_center.centerBtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.petcircledlg.choosepetbtn_center.centerBtn", false);	
					--上
				elseif customtype == 152 then
					local loadPetNum ,count= GetMyPetCount();
					Win_SetValue("UI.gameui.listdlg.list",count + 1 - loadPetNum, value_channel_item_num);
					
					local index = 0;
					for i = 0, 5  do
						if(GetPetNameAt(i) ~= nil) then 
							Win_SetText("UI.gameui.listdlg.list", GetPetNameAt(i), value_channel_itemtext, index);
							index = index + 1;
						end;
					end;
					
					if(GetPetCircleIsCanUnload(1)) then
						Win_SetText("UI.gameui.listdlg.list","卸下当前宠物", value_channel_itemtext,index );
					end;
					
					UI.children.gameui.children.listdlg.AlignWinRect(index + 1);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.petcircledlg.choosepetbtn_up.UpBtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.petcircledlg.choosepetbtn_up.UpBtn", false);	
					--右
				elseif customtype == 153 then
					local loadPetNum ,count= GetMyPetCount();
					Win_SetValue("UI.gameui.listdlg.list",count + 1 - loadPetNum, value_channel_item_num);
					
					local index = 0;
					for i = 0, 5  do
						if(GetPetNameAt(i) ~= nil) then 
							Win_SetText("UI.gameui.listdlg.list", GetPetNameAt(i), value_channel_itemtext, index);
							index = index + 1;
						end;
					end;
					
					if(GetPetCircleIsCanUnload(2)) then
						Win_SetText("UI.gameui.listdlg.list","卸下当前宠物", value_channel_itemtext,index );
					end;
					
					UI.children.gameui.children.listdlg.AlignWinRect(index + 1);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.petcircledlg.choosepetbtn_right.RightBtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.petcircledlg.choosepetbtn_right.RightBtn", false);	
					--下
				elseif customtype == 154 then
					local loadPetNum ,count= GetMyPetCount();
					Win_SetValue("UI.gameui.listdlg.list",count + 1 - loadPetNum, value_channel_item_num);
					
					local index = 0;
					for i = 0, 5  do
						if(GetPetNameAt(i) ~= nil) then 
							Win_SetText("UI.gameui.listdlg.list", GetPetNameAt(i), value_channel_itemtext, index);
							index = index + 1;
						end;
					end;
					
					if(GetPetCircleIsCanUnload(3)) then
						Win_SetText("UI.gameui.listdlg.list","卸下当前宠物", value_channel_itemtext,index );
					end;
					
					UI.children.gameui.children.listdlg.AlignWinRect(index + 1);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.petcircledlg.choosepetbtn_down.DownBtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.petcircledlg.choosepetbtn_down.DownBtn", false);	
					--左
				elseif customtype == 155 then
					local loadPetNum ,count= GetMyPetCount();
					Win_SetValue("UI.gameui.listdlg.list",count + 1 - loadPetNum, value_channel_item_num);
					
					local index = 0;
					for i = 0, 5  do
						if(GetPetNameAt(i) ~= nil) then 
							Win_SetText("UI.gameui.listdlg.list", GetPetNameAt(i), value_channel_itemtext, index);
							index = index + 1;
						end;
					end;
					
					if(GetPetCircleIsCanUnload(4)) then
						Win_SetText("UI.gameui.listdlg.list","卸下当前宠物", value_channel_itemtext,index);
					end;
					
					UI.children.gameui.children.listdlg.AlignWinRect(index + 1);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.petcircledlg.choosepetbtn_left.LeftBtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.petcircledlg.choosepetbtn_left.LeftBtn", false);
				--查询镶嵌卡片
				elseif customtype == 401 then
					--获取装备类型并显示
					local tgt,num=GetBurrowTypeInfo();
					Win_SetValue("UI.gameui.listdlg.list",num,value_channel_item_num);
					for i=0,num-1 do									  
					Win_SetText("UI.gameui.listdlg.list",tgt[i],value_channel_itemtext,i);
					end;				
					Win_AlignWidget("UI.gameui.listdlg","UI.gameui.querysculpdlg.typebtn",aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
					Win_SetCheck("UI.gameui.querysculpdlg.typebtn", false);
				
                                --求婚对象
				elseif customtype == 501 then
					local info, num = GetFriendsList();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.proposemarriagedlg.friendslistbtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				
				--婚礼类型	
				elseif customtype==502 then
					local info, num = GetMarriageConfig("求婚方式");
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.proposemarriagedlg.marriagetypelistbtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
	
				--设置婚礼日期
				elseif customtype == 503 then
					local info, num = GetValidDate();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_One.date_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
	
					Win_SetCheck("UI.gameui.marriagePreparedlg_One.date_btn", false);
				--设置婚礼时刻
				elseif customtype == 504 then
					local dat = Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl");
					local info, num = GetValidTime(dat);
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_One.hour_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_One.hour_btn", false);
				--设置迎亲方式
				elseif customtype == 505 then
					local info, num = GetMarriageStyle();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_Two.style_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_Two.style_btn", false);
				--设置迎亲地图
				elseif customtype == 506 then
					local info, num = GetMarriageConfig("婚礼地图");
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_One.map_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_One.map_btn", false);
				--设置迎亲礼服
				elseif customtype == 507 then
					local info, num = GetFulldress();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_Two.fulldress_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_Two.fulldress_btn", false);
				--设置聘礼
				elseif customtype == 508 then
					local num = 3;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "不需要", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "普通聘礼", value_channel_itemtext, 1);
					Win_SetText("UI.gameui.listdlg.list", "豪华聘礼", value_channel_itemtext, 2);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_Three.gift_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_Three.gift_btn", false);
				--设置迎亲随从数量
				elseif customtype == 509 then
					local num = 5;
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "2", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "3", value_channel_itemtext, 1);
					Win_SetText("UI.gameui.listdlg.list", "4", value_channel_itemtext, 2);
					Win_SetText("UI.gameui.listdlg.list", "5", value_channel_itemtext, 3);
					Win_SetText("UI.gameui.listdlg.list", "6", value_channel_itemtext, 4);
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.marriagePreparedlg_Three.cortegenum_btn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.marriagePreparedlg_Three.cortegenum_btn", false);
                --升级宝典
				elseif customtype == 601 then
					local info,num = GetLevelUpHelperList();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.integdlg.upbibpanel.levellistbtn",
						aligntype_winrect,alignstyle_left_in+alignstyle_bottom_out);
				--组队副本列表
				elseif customtype == 602 then
					local num = TeamPlat_GetNumPWorld();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", TeamPlat_GetPWorldNameAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.exteamconfigdlg.publishtargetbtn",
						aligntype_winrect,alignstyle_left_in+alignstyle_bottom_out);
				elseif customtype == 603 then
					local num = TeamPlat_GetNumPWorld();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i = 0, num-1 do
						Win_SetText("UI.gameui.listdlg.list", TeamPlat_GetPWorldNameAt(i), value_channel_itemtext, i);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.updateteamcfgdlg.publishtargetbtn",
						aligntype_winrect,alignstyle_left_in+alignstyle_bottom_out);
				-- 修罗场级别
				elseif customtype == 604 then
					Win_SetValue("UI.gameui.listdlg.list", 5, value_channel_item_num);
					Win_SetText("UI.gameui.listdlg.list", "初级斗士", value_channel_itemtext, 0);
					Win_SetText("UI.gameui.listdlg.list", "中级斗士", value_channel_itemtext, 1);
					Win_SetText("UI.gameui.listdlg.list", "高级斗士", value_channel_itemtext, 2);
					Win_SetText("UI.gameui.listdlg.list", "顶级斗士", value_channel_itemtext, 3);
					Win_SetText("UI.gameui.listdlg.list", "修罗斗士", value_channel_itemtext, 4);
					UI.children.gameui.children.listdlg.AlignWinRect(5);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.suratoplistdlg.levellistbtn",
						aligntype_winrect, alignstyle_right_out+alignstyle_top_in);
						
					Win_SetCheck("UI.gameui.suratoplistdlg.levellistbtn", false);	
				elseif customtype == 701 then
					local info, num = GetSendFlowerFriendsList();
					Win_SetValue("UI.gameui.listdlg.list", num, value_channel_item_num);
					for i=1, num do
						Win_SetText("UI.gameui.listdlg.list", info[i], value_channel_itemtext, i-1);
					end;
					UI.children.gameui.children.listdlg.AlignWinRect(num);
					Win_AlignWidget("UI.gameui.listdlg", "UI.gameui.sendflowerdlg.selectfriendbtn",
						aligntype_winrect,alignstyle_right_out+alignstyle_top_in);
				end;
				
				Win_SetFocus("UI.gameui.listdlg.list");
			end;		

			OnSelfHide=function()
				Win_SetValue("UI.gameui.listdlg.list",0,value_channel_item_num);
	
				local customtype = Win_GetValue("UI.gameui.listdlg",value_channel_customtype);
						
					--竞技场地图列表
					if customtype == 1 then
						Win_SetCheck("UI.gameui.createarenadlg.maplistbtn",false);
					--竞技场最底等级列表
					elseif customtype == 2 then
						Win_SetCheck("UI.gameui.createarenadlg.minlevellistbtn",false);
					--竞技场最高等级列表
					elseif customtype == 3 then
						Win_SetCheck("UI.gameui.createarenadlg.maxlevellistbtn",false);
					--竞技场聊天对象
					elseif customtype == 4 then
						Win_SetCheck("UI.gameui.arenadlg.chatbar.inputbar.chaterbtn",false);
					--投票确认
					elseif customtype == 5 then
						Win_SetCheck("UI.gameui.voteaffirmdlg.menubtn",false);
					
					--added by qjb 装备强化
					elseif customtype == 30000 then
						Win_SetCheck("UI.gameui.armspiritdlg.typebtn", false);
					elseif customtype == 30001 then
						Win_SetCheck("UI.gameui.armspiritdlg.levelbtn", false);
					
					--新装备强化系统
					elseif customtype == 200 then
						Win_SetCheck("UI.gameui.newarmupddlg.typebtn", false);
					elseif customtype == 201 then
						Win_SetCheck("UI.gameui.newcomposedlg.typebtn", false);
					elseif customtype == 202 then
						Win_SetCheck("UI.gameui.newcomposedlg.showbtn", false);
					elseif customtype == 203 then
						Win_SetCheck("UI.gameui.queryburrowdlg.alltab.typebtn", false);
					elseif customtype == 204 then
						Win_SetCheck("UI.gameui.queryburrowdlg.alltab.levelbtn", false);
					elseif customtype == 205 then
						Win_SetCheck("UI.gameui.autoforgedlg.levellistbtn", false);
					elseif customtype == 206 then
						Win_SetCheck("UI.gameui.Babaozhairesearchdlg.Showbtn", false);
					elseif customtype == 207 then
						Win_SetCheck("UI.gameui.BabaozhaiBuydlg.typebtn", false);
					elseif customtype == 208 then
						Win_SetCheck("UI.gameui.BabaozhaiBuydlg.showbtn", false);
					--查询镶嵌卡片
					elseif customtype == 401 then
						Win_SetCheck("UI.gameui.querysculpdlg.typebtn", false);
                                        --求婚对象
					elseif customtype == 501 then
						Win_SetCheck("UI.gameui.proposemarriagedlg.friendslistbtn", false);
					--婚礼类型
					elseif customtype == 502 then
						Win_SetCheck("UI.gameui.proposemarriagedlg.marriagetypelistbtn", false);
					--升级宝典
					elseif customtype == 601 then
						Win_SetCheck("UI.gameui.integdlg.upbibpanel.levellistbtn",false);
					-- 修罗场级别
					elseif customtype == 604 then
						Win_SetCheck("UI.gameui.suratoplistdlg.levellistbtn", false);
					end;
				end;
				
			children=
			{
				list=
				{
					type="LISTBOX",
					rect={0,3,106,100},
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
					richmode=ui_richmode_color,
					textsize=12,
					sizeable=1,
					
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemfocusback="res/uires/common/itemsel.gsa",
					
					updatemute=1,
					
					OnClick=function()
						local txt=Win_GetText("UI.gameui.listdlg.list",value_channel_seltext);
						local option=Win_GetValue("UI.gameui.listdlg.list",value_channel_sel);
						
						local customtype = Win_GetValue("UI.gameui.listdlg",value_channel_customtype);
						
						if txt~="" then	
							--竞技场地图列表
							if customtype == 1 then
								local arenainfo = GetArenaMapInfo(0,option);
								if arenainfo.mapid ~= 0 then
									Win_SetText("UI.gameui.createarenadlg.mapedit", arenainfo.mapname);
									SetCurArenaMap(arenainfo.mapid);
									Win_SetValue("UI.gameui.createarenadlg.arenainfo",math.floor((arenainfo.athnum-1)/2),value_channel_framescheme);
									
									Win_SetText("UI.gameui.createarenadlg.minleveledit",arenainfo.minlevel);
									--Win_SetValue("UI.gameui.createarenadlg.minleveledit",arenainfo.minlevel,value_channel_minvalue);
									
									Win_SetText("UI.gameui.createarenadlg.maxleveledit",arenainfo.maxlevel);
									--Win_SetValue("UI.gameui.createarenadlg.maxleveledit",arenainfo.maxlevel,value_channel_maxvalue);
									Win_SetText("UI.gameui.createarenadlg.mapdesclabel", "          "..arenainfo.mapdesc);
								end;

							--竞技场最底等级列表
							elseif customtype == 2 then
							Win_SetText("UI.gameui.createarenadlg.minleveledit",txt);
							SetMinArenaLevel(txt);
							
							--竞技场最高等级列表
							elseif customtype == 3 then
							Win_SetText("UI.gameui.createarenadlg.maxleveledit",txt);
							SetMaxArenaLevel(txt);
							
							--竞技场界面聊天对象
							elseif customtype == 4 then
							if option == 0 then
							Win_SetText("UI.gameui.arenadlg.chatbar.inputbar.chateredit","所有人");
							else
							Win_SetText("UI.gameui.arenadlg.chatbar.inputbar.chateredit","盟友");
							end;
							
							-- 装备升级多选
							elseif customtype == 200 then
								--Win_SetText("UI.gameui.newarmupddlg.typelabel",txt);
								ChoseUpdateEquip(option);							
							
							--新装备强化系统
							elseif customtype == 201 then
								Win_SetText("UI.gameui.newcomposedlg.typelabel",txt);
								SetCombineType(option, -1);						
							elseif customtype == 202 then
								Win_SetText("UI.gameui.newcomposedlg.showlabel",txt);
								if option == 0 then
									Win_EnableWidget("UI.gameui.newcomposedlg.affirmbtn", true);
								else
									Win_EnableWidget("UI.gameui.newcomposedlg.affirmbtn", false);
								end;
								
								SetCombineType(-1, option);
							elseif customtype == 203 then
								Win_SetText("UI.gameui.queryburrowdlg.alltab.typeedit", txt);
								Win_SetText("UI.gameui.queryburrowdlg.alltab.leveledit", "1");
								QueryBurrowUpdate(txt, "1");
								
							elseif customtype == 204 then
								Win_SetText("UI.gameui.queryburrowdlg.alltab.leveledit", txt);
								local typetxt = Win_GetText("UI.gameui.queryburrowdlg.alltab.typeedit");
								QueryBurrowUpdate(typetxt, txt);
							elseif customtype == 205 then
								Win_SetText("UI.gameui.autoforgedlg.levellabel", txt);								
							elseif customtype == 206 then
								Win_SetText("UI.gameui.Babaozhairesearchdlg.Showlabel",txt);
								UpdateBBZRrchList(option);	
							elseif customtype == 207 then
								Win_SetText("UI.gameui.BabaozhaiBuydlg.typelabel",txt);
								UpdateBBZBuyList(option - 1, -1);						
							elseif customtype == 208 then
								Win_SetText("UI.gameui.BabaozhaiBuydlg.showlabel",txt);
								if option == 0 then
									Win_EnableWidget("UI.gameui.BabaozhaiBuydlg.affirmbtn", true);
								else
									Win_EnableWidget("UI.gameui.BabaozhaiBuydlg.affirmbtn", true);
								end;
								UpdateBBZBuyList(-2, option);								
							--added by qjb 装备强化
							elseif customtype == 30000 then
								Win_SetText("UI.gameui.armspiritdlg.typelabel",txt);
								SetArmSpiritType(0,option)
								typetxt, leveltxt = GetCurArmSpiritTypeLevelName()
								Win_SetText("UI.gameui.armspiritdlg.typelabel",typetxt);
								Win_SetText("UI.gameui.armspiritdlg.levellabel",leveltxt);
							elseif customtype == 30001 then
								Win_SetText("UI.gameui.armspiritdlg.levellabel",txt);
								SetArmSpiritType(1,option)
							
							--投票确认
							elseif customtype == 5 then
							Win_SetText("UI.gameui.voteaffirmdlg.votenumedit",txt);
							
							elseif customtype == 101 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel1", string.sub(txt, 5));
							elseif customtype == 102 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpitemlabel2", string.sub(txt, 5));
							elseif customtype == 103 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel1", txt);
							elseif customtype == 104 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.hpentrylabel2", txt);
								
							elseif customtype == 105 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel1", string.sub(txt, 5));
							elseif customtype == 106 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spitemlabel2", string.sub(txt, 5));
							elseif customtype == 107 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel1", txt);
							elseif customtype == 108 then
								Win_SetText("UI.gameui.sysconfigdlg.autosupplytab.autosupplydlg.spentrylabel2", txt);
								
							-- god 
							elseif customtype == 111 then	--设置幻神的生命自动补给生命百分比选择
								Win_SetText("UI.gameui.godautosupplydlg.hpentrylabel1", txt);
							elseif customtype == 112 then	-- 设置幻神的生命自动补给道具选择
								Win_SetText("UI.gameui.godautosupplydlg.hpitemlabel1", string.sub(txt, 5));
							elseif customtype == 113 then	-- 设置幻神的法力百分比选择
								Win_SetText("UI.gameui.godautosupplydlg.spentrylabel1", txt);
							elseif customtype == 114 then	-- 设置幻神的法力自动补给道具选择
								Win_SetText("UI.gameui.godautosupplydlg.spitemlabel1", string.sub(txt, 5));
							elseif customtype == 115 then	--设置幻神的疲劳值百分比选择
								Win_SetText("UI.gameui.godautosupplydlg.tiredentrylabel1", txt);
							elseif customtype == 116 then	--设置幻神的疲劳值自动补给道具选择
								Win_SetText("UI.gameui.godautosupplydlg.tireditemlabel1", string.sub(txt, 5));
							elseif customtype == 121 then
								Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel1", txt);					
							elseif customtype == 122 then
								Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel2", txt);
							elseif customtype == 123 then
								Win_SetText("UI.gameui.sysconfigdlg.extendskilltab.extendlabel3", txt);	
							elseif customtype == 131 then
								Win_SetText("UI.gameui.playertargetdlg.extendlabel1", txt);
								Win_SetValue("UI.gameui.playertargetdlg.extendlabel1",option,value_channel_customindex);
							elseif customtype == 132 then
								Win_SetText("UI.gameui.playertargetdlg.extendlabel2", txt);
								Win_SetValue("UI.gameui.playertargetdlg.extendlabel2",option,value_channel_customindex);
							elseif customtype == 133 then
								Win_SetText("UI.gameui.playertargetdlg.extendlabel3", txt);	
								Win_SetValue("UI.gameui.playertargetdlg.extendlabel3",option,value_channel_customindex);
							elseif customtype == 141 then
								Win_SetText("UI.gameui.multiteamlistdlg.typelabel", txt);	
								Win_SetValue("UI.gameui.multiteamlistdlg.typelabel",option,value_channel_customindex);
								SetMtTeamType(0,option, txt);
							elseif customtype == 142 then
								Win_SetText("UI.gameui.createmultiteamdlg.typelabel", txt);	
								Win_SetValue("UI.gameui.createmultiteamdlg.typelabel",option,value_channel_customindex);
								SetMtTeamType(1,option, txt);
							elseif customtype == 151 then
								Win_SetValue("UI.gameui.petcircledlg.choosepetbtn_center.centerBtn",option,value_channel_customindex);
								if(PetCircleIsCanLoad(0) ~= nil and PetCircleIsCanLoad(0) == 1) then
									Win_ShowMsgBox("切换(卸载)上阵宠物会使已生效的属性失效，确定更换(卸载)上阵宠物吗","系统消息",ui_msgid_yesno,"UI.gameui.petcircledlg");
								elseif(PetCircleIsCanLoad(0) ~= nil and PetCircleIsCanLoad(0) == 2) then
									LoadPetCircle(0,option);
								end;
							elseif customtype == 152 then
								Win_SetValue("UI.gameui.petcircledlg.choosepetbtn_up.UpBtn",option,value_channel_customindex);
								if(PetCircleIsCanLoad(1) ~= nil and PetCircleIsCanLoad(1) == 1) then
									Win_ShowMsgBox("切换(卸载)上阵宠物会使已生效的属性失效，确定更换(卸载)上阵宠物吗","系统消息",ui_msgid_yesno,"UI.gameui.petcircledlg");
								elseif(PetCircleIsCanLoad(1) ~= nil and PetCircleIsCanLoad(1) == 2) then
									LoadPetCircle(1,option);
								end;
							elseif customtype == 153 then
								Win_SetValue("UI.gameui.petcircledlg.choosepetbtn_right.RightBtn",option,value_channel_customindex);
								if(PetCircleIsCanLoad(2) ~= nil and PetCircleIsCanLoad(2) == 1) then
									Win_ShowMsgBox("切换(卸载)上阵宠物会使已生效的属性失效，确定更换(卸载)上阵宠物吗","系统消息",ui_msgid_yesno,"UI.gameui.petcircledlg");
								elseif(PetCircleIsCanLoad(2) ~= nil and PetCircleIsCanLoad(2) == 2) then
									LoadPetCircle(2,option);
								end;
							elseif customtype == 154 then
								Win_SetValue("UI.gameui.petcircledlg.choosepetbtn_down.DownBtn",option,value_channel_customindex);
								if(PetCircleIsCanLoad(3) ~= nil and PetCircleIsCanLoad(3) == 1) then
									Win_ShowMsgBox("切换(卸载)上阵宠物会使已生效的属性失效，确定更换(卸载)上阵宠物吗","系统消息",ui_msgid_yesno,"UI.gameui.petcircledlg");
								elseif(PetCircleIsCanLoad(3) ~= nil and PetCircleIsCanLoad(3) == 2) then
									LoadPetCircle(3,option);
								end;
							elseif customtype == 155 then
								Win_SetValue("UI.gameui.petcircledlg.choosepetbtn_left.LeftBtn",option,value_channel_customindex);
								if(PetCircleIsCanLoad(4) ~= nil and PetCircleIsCanLoad(4) == 1) then
									Win_ShowMsgBox("切换(卸载)上阵宠物会使已生效的属性失效，确定更换(卸载)上阵宠物吗","系统消息",ui_msgid_yesno,"UI.gameui.petcircledlg");
								elseif(PetCircleIsCanLoad(4) ~= nil and PetCircleIsCanLoad(4) == 2) then
									LoadPetCircle(4,option);
								end;
							--查询镶嵌卡片
							elseif customtype == 401 then
								Win_SetText("UI.gameui.querysculpdlg.typeedit", txt);
								--获取该装备可镶嵌的卡片
								local cardName, numCards  = GetArmCardList(txt);
								Win_SetValue("UI.gameui.querysculpdlg.list", numCards, value_channel_item_num);
								for i=1, numCards do
									Win_SetText("UI.gameui.querysculpdlg.list", cardName[i], value_channel_itemtext, i-1);
								end;

                                                        --求婚对象
							elseif customtype == 501 then
								Win_SetText("UI.gameui.proposemarriagedlg.lovername", txt);
							
							--婚礼类型
							elseif customtype == 502 then
								local money, bowlder = GetMarriageMoney("求婚方式", txt);
								if money == 0  and bowlder ~= 0 then
									-- 花费彩玉
									if bowlder > GetMyJude() then
										Win_SetText("UI.gameui.proposemarriagedlg.cost", "/C20"..bowlder.."彩玉");
										Win_EnableWidget("UI.gameui.proposemarriagedlg.affirmbtn", false);
									else
										Win_SetText("UI.gameui.proposemarriagedlg.cost", bowlder.."彩玉");
										Win_EnableWidget("UI.gameui.proposemarriagedlg.affirmbtn", true);
									end;
									Win_SetText("UI.gameui.proposemarriagedlg.marriagetype", txt);
									local info = GetEffectInfo("求婚方式", txt);
									Win_SetText("UI.gameui.proposemarriagedlg.effectintro", info);
								elseif money ~= 0 and bowlder ==0 then
									--花费金钱
									local silver = money / 1000;
									if money > GetMoney() then
										Win_SetText("UI.gameui.proposemarriagedlg.cost", "/C20"..silver.."银");
										Win_EnableWidget("UI.gameui.proposemarriagedlg.affirmbtn", false);
									else
										Win_SetText("UI.gameui.proposemarriagedlg.cost", silver.."银");
										Win_EnableWidget("UI.gameui.proposemarriagedlg.affirmbtn", true);
									end;
									Win_SetText("UI.gameui.proposemarriagedlg.marriagetype", txt);
									local info = GetEffectInfo("求婚方式", txt);
									Win_SetText("UI.gameui.proposemarriagedlg.effectintro", info);
								end;
							--设置婚礼日期
							elseif customtype == 503 then
								--if txt ~= Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl") then
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
								--end;
								Win_SetText("UI.gameui.marriagePreparedlg_One.date_lbl",txt);
								local hour = Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl");
								if hour ~= "" and not CheckTime(txt, hour) then
									Win_SetText("UI.gameui.marriagePreparedlg_One.hour_lbl", "");
								end;
								
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",true);

							--设置婚礼时刻
							elseif customtype == 504 then
								--if txt ~= Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl") then
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
								--end;
								Win_SetText("UI.gameui.marriagePreparedlg_One.hour_lbl",txt);
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",true);
								
							--设置迎亲地图
							elseif customtype == 506 then
								Win_SetText("UI.gameui.marriagePreparedlg_One.map_lbl",txt);
								local num = Win_GetValue("UI.gameui.marriagePreparedlg_One.common_edt"); --请柬数量
								local money = GetMarriageMoney("请帖", "普通请帖");
								local totalfee = num * money;  --总的费用
								local curfee =  GetMarriageMoney("婚礼地图", txt) + totalfee;
								local gold=math.floor(curfee/1000000);
								local silver=math.floor((curfee-gold*1000000)/1000);
								local copper=math.floor(curfee-gold*1000000-silver*1000);
								if curfee > GetMoney() then
									Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", "/C20"..tostring(gold));
									Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", "/C20"..tostring(silver));
									Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", "/C20"..tostring(copper));
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
								else
									Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", tostring(gold));
									Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", tostring(silver));
									Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", tostring(copper));
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", true);
								end;
								
								ibowlder = MapMoney(txt);
								ibowlder2 = 0;
								
								if txt == "传统婚礼地图" then
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk",false);
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.canzhuo_chk",false);
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk",false);
									Win_SetCheck("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk",false);
									Win_SetCheck("UI.gameui.marriagePreparedlg_One.canzhuo_chk",false);
									Win_SetCheck("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk",false);
								else
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk",true);
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.canzhuo_chk",true);
									Win_EnableWidget("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk",true);
								end;
								
								if Win_IsChecked("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk") then
									jiuzhuo = 1;
								else
									jiuzhuo = 0;
								end;
						
								if Win_IsChecked("UI.gameui.marriagePreparedlg_One.canzhuo_chk") then
									canzhuo = 1;
								else
									canzhuo = 0;
								end;
						
								if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk") then
									hongbaozhuo = 1;
								else
									hongbaozhuo = 0;
								end;
						
								local ibowlder2 = ComputeMoney(jiuzhuo,canzhuo,hongbaozhuo);
						
								ibowlder = ibowlder + ibowlder2;
						
								if GetMyJude() < ibowlder then
									Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel","/C20"..ibowlder);
								else
									Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel",ibowlder);
								end;
								
							elseif customtype == 601 then
								local info = GetIthLevelHelperInfo(option);
								local intdlg = UI.children.gameui.children.integdlg;
								intdlg.children.upbibpanel.SetContent(info);
							--组队副本列表
							elseif customtype == 602 then
								UI.children.gameui.children.exteamconfigdlg.children.publishtargetbtn.UpdateValue(option);
							elseif customtype == 603 then
								UI.children.gameui.children.updateteamcfgdlg.children.publishtargetbtn.UpdateValue(option);
							-- 修罗场级别
							elseif customtype == 604 then
								UI.children.gameui.children.suratoplistdlg.children.levellistbtn.UpdateValue(option);
							elseif customtype == 701 then
								Win_SetText("UI.gameui.sendflowerdlg.name", txt);
							end;
						end;
						
						Win_ShowWidget("UI.gameui.listdlg",false);
						
						end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={0,0,12,70},
							style=wgtstyle_vertical,					
							bkcolor={0,0,0,255},
							edgecolor={128,128,128,255},						
							pagesize=8,
							marginh=3,
							marginv=0,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							extendstyle=scrollbar_auto_hide,
							drawflag=drawflag_win_fill,
							updatemute=1,
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,		
								};--blockbtn
										
					
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
										
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
										
								};--spindown
										
							};--children
					
						};--scroll
					};
					
				};--list	
			};
		};
		
		--pipo arena
		arenascoredlg=
		{
			type="DIALOG";
			rect={503,96,120,50};
			style=wgtstyle_none;
			enable=0;
			initlayer=0,
			pluslayer=0,
			autoadjust=autoadjust_center,
			
			children=
			{
				homescore=
				{
					type="LABEL";
					rect={0,0,120,25};
					textsize=12;
					drawcolor={255, 0, 0, 255};
					textstyle=dt_vcenter+dt_left;
				};
				awayscore=
				{
					type="LABEL";
					rect={0,25,120,25};
					textsize=12;
					drawcolor={0, 255, 255, 255};
					textstyle=dt_vcenter+dt_left;
				};
			};
		};
		
		arenadlg=
		{
			type="DIALOG";
			bkimage="res/uires/arenadlg/arenadlgbk.gsa",
			rect={129,58,694,449};
			captionrect={65,30,563,23},
			caption="竞技场名称",
			textstyle=dt_center+dt_vcenter,
			textfont=1,
			textsize=16,						
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_clipself+wgtstyle_customclose+wgtstyle_effect,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,	
			
			OnSelfShow=function()
				--Win_AlignWidget("UI.gameui.arenadlg.chatbar.chatpanel","UI.gameui.arenadlg.chatbar",aligntype_winrect,alignstyle_top_out,-5,-24);
				--Win_AlignWidget("UI.gameui.arenadlg.chatbar.syschatpanel","UI.gameui.arenadlg.chatbar",aligntype_winrect,alignstyle_top_out,-5,-238);
				
				local arena = GetArenaInfo();
				local arenamapinfo = GetArenaMapInfo(1,arena.arenaid);
				local caption = math.floor(arenamapinfo.athnum/2).."vs"..math.floor(arenamapinfo.athnum/2).." ".. arena.minlevel.."-"..arena.maxlevel.."级别竞技场: "..arena.name;
				Win_SetText("UI.gameui.arenadlg",caption,value_channel_caption);
				Win_SetValue("UI.gameui.arenadlg",1,value_channel_customtype);
				--Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", IsArenaOwner()~=0);
				Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", IsArenaOwner()~=0 and IsMatchArena()==0);
				
				--GM观战比赛用房间具有特殊权限
				if (ArenaGetMyActionType()~=0 and IsGm()~=0 and IsMatchArena()~=0) then
					Win_EnableWidget("UI.gameui.arenadlg.toggleaudiencechatbtn", true);
				end;
				
				Win_SetFocus("UI.gameui.arenadlg.chatbar.inputbar.contentedit");
				
				Win_ShowWidget("UI.gameui.arenadlg.chatbar.inputbar.chaterbtn",ArenaGetMyActionType()~=1);
				Win_SetText("UI.gameui.arenadlg.chatbar.inputbar.chateredit","所有人");
				
				UI.children.gameui.CloseMainLabelBK();
				
				Win_SetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",1,value_channel_customtype);
				
				Win_ShowWidget("UI.gameui.arenadlg.preparebtn", true);
				Win_ShowWidget("UI.gameui.arenadlg.cancelpreparebtn", false);
				
				Win_SetText("UI.gameui.arenadlg.happybeannum", g_PlayerInfo.leftpkdou);
				
				SetGlobalQuery(GlobalQuery_ArenaDlg,1);
			end;
			
			OnClick=function()
				Win_SetFocus("UI.gameui.arenadlg.chatbar.inputbar.contentedit");
				end;
			
			OnSelfHide=function()	
				SetGlobalQuery(GlobalQuery_ArenaDlg,0);
				end;
			
			OnEnter=function()
				UI.children.gameui.children.arenadlg.children.chatbar.children.inputbar.children.sendbtn.OnClick();
				end;
			
			children=
			{
				--剩余欢乐豆
				happybeannum=
				{
					type="LABEL",
					rect={335,65,70,15},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
					--enable=0;
				};
				
				toggleaudiencechatbtn=
				{
					type="CHECK";
					rect={71,63,177,18};
					bkimage="res/uires/common/checkbox.gsa";
					bkimagepos={0,2},
					checked=1;
					
					OnClick=function()
						local bcheck = Win_IsChecked("UI.gameui.arenadlg.toggleaudiencechatbtn");
						ToggleAudienceChat();
						Win_SetCheck("UI.gameui.arenadlg.toggleaudiencechatbtn",bcheck~=1);
						end;
				};

				happyteamname=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/hostteambtn.gsa";
					rect={60,92,86,24};
					framescheme={{0,1,2,2}},
					tiptext="点击换队";
					
					OnClick=function()
						if ArenaGetMyActionType()==1 then
							ChangeMyArenaTeam();
						else
							local info = GetMyArenaTeamInfo();
							if info.teamidx ~= 0 then
							ChangeMyArenaTeam();
							end;
						end;
						end;
				};

				fatasyteamname=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/visitingteambtn.gsa";
					rect={59,252,86,24};
					framescheme={{0,1,2,2}},
					tiptext="点击换队";
					
					OnClick=function()
						if ArenaGetMyActionType()==1 then
							ChangeMyArenaTeam();
						else
							local info = GetMyArenaTeamInfo();
							if info.teamidx ~= 1 then
							ChangeMyArenaTeam();
							end;
						end;
						end;
				};

				hostteamleaderlabel=
				{
					type="WIDGET",
					rect={68,131,13,7},
					bkimage="res/uires/arenadlg/teamleaderlabel.gsa",
				};
				
				happyteammemlist=
				{
					type="WIDGETLIST";
					rect={84,121,366,116};
					style=wgtstyle_vertical,
					itemmarginv=2,
					itemmarginh=0,
					
					template={"res/uires/arenamemberh.lua"};
					children={},
				};

				visitingteamleaderlabel=
				{
					type="WIDGET",
					rect={68,292,13,7},
					bkimage="res/uires/arenadlg/teamleaderlabel.gsa",
				};
				
				fantasyteammemlist=
				{
					type="WIDGETLIST";
					rect={84,282,366,116};
					style=wgtstyle_vertical,
					itemmarginv=2,
					itemmarginh=0,
					
					template={"res/uires/arenamemberf.lua"};
					children={},
				};

				audiencenumlabel=
				{
					type="LABEL";
					rect={518,63,77,16};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};

--~ 				watchobjectlabel=
--~ 				{
--~ 					type="LABEL";
--~ 					rect={504,45,72,15};
--~ 					textsize=12,
--~ 					textstyle=dt_center+dt_vcenter,
--~ 				};

				startbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/startbtn.gsa";
					rect={74,404,86,24};
					tiptext="开始竞技";
					
					OnClick=function()
						StartArena();
					end;
						
				};
				
				preparebtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/preparebtn.gsa";
					rect={211,404,86,24};
					tiptext="准备竞技";
					
					OnClick=function()
						PrepareArena(1);
					end;
				};
				
				cancelpreparebtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/cancelpreparebtn.gsa";
					rect={211,404,86,24};
					tiptext="取消准备竞技";
					
					OnClick=function()
						PrepareArena(0);
					end;
				};

				exitbtn=
				{
					type="BUTTON";
					bkimage="res/uires/arenadlg/exitarenabtn.gsa";
					rect={349,404,86,24};
					tiptext="退出竞技场";
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.arenadlg",false);
						ExitArena();
						Win_ShowWidget("UI.gameui.selectarenadlg",true);
						end;
				};

				chatbar=
				{
					type="WIDGET";
					rect={460,82,192,341};
					style=wgtstyle_areawake,
						
					children=
					{
						syschatpanel=
						{
							type="WIDGET",
							rect = { 0, 0, 192, 61},
							--aligntype=aligntype_father+aligntype_winrect,
							--alignstyle=alignstyle_top_out,
							style=wgtstyle_cleanwin,					
					
							children=
							{
								chatlist=
								{
									type = "TEXTLIST",
									rect = { 0, 0, 192, 61  },
									clientrect = { 48, 0, 144, 61  },
									titlerect={-48,0,48,12},
									style=wgtstyle_clipself+wgtstyle_ajustfollow,
									extendstyle=textlist_style_delayscroll,
									scrollspeed=100000,
									rowspace=6,
									textsize=12,
									textstyle=dt_left+dt_magicedge,
									groupid=0,
									ajustflag=rect_flag_window+rect_flag_client;
									magiccolor={0,0,0,128},
									linkcolor={100,100,255,255},
									mousedelta=18,
									richmode=ui_richmode_icon+ui_richmode_color+ui_richmode_hlink,
									richflag=1,
									initlayer=0,
									pluslayer=0,
									updatemute=1,
									textfont=1,
									
									OnDBClick=function(idx,wparam,lparam)
										if idx>=0 then
										local nflag=GetBitAnd(wparam,32);
										if nflag~=0 then
										local listname="UI.gameui.arenadlg.chatbar.syschatpanel.chatlist";
										local datachannel=value_channel_itemtext;
										local linetext=Win_GetText(listname,datachannel,idx);
										local msg,sender=GetNeatChatMsg(linetext);
										if (msg~="") then
										Win_OnInsert("UI.gameui.arenadlg.chatbar.inputbar.contentedit",msg);										
										end;
										end;
										end;
										end;
								};
							};
						};
						
						chatpanel=
						{
							type="WIDGET",
							rect = { 0,72,192,244},
							--aligntype=aligntype_father+aligntype_winrect,
							--alignstyle=alignstyle_top_out,
							style=wgtstyle_cleanwin,					
					
							children=
							{
								chatlist=
								{
									type = "TEXTLIST",
									rect = { -2, 0, 192, 244  },
									clientrect = { 48, 0, 144,244  },
									titlerect={-48,0,48,12},
									style=wgtstyle_clipself+wgtstyle_ajustfollow,
									extendstyle=textlist_style_delayscroll,
									scrollspeed=100000,
									rowspace=6,
									textsize=12,
									textstyle=dt_left+dt_magicedge,
									groupid=0,
									ajustflag=rect_flag_window+rect_flag_client;
									magiccolor={0,0,0,128},
									linkcolor={100,100,255,255},
									mousedelta=18,
									richmode=ui_richmode_icon+ui_richmode_color+ui_richmode_hlink,
									richflag=1,
									initlayer=0,
									pluslayer=0,
									updatemute=1,
									
									OnDBClick=function(idx,wparam,lparam)
										if idx>=0 then
										local nflag=GetBitAnd(wparam,32);
										if nflag~=0 then
										local listname="UI.gameui.arenadlg.chatbar.chatpanel.chatlist";
										local datachannel=value_channel_itemtext;
										local linetext=Win_GetText(listname,datachannel,idx);
										local msg,sender=GetNeatChatMsg(linetext);
										if (msg~="") then
										Win_OnInsert("UI.gameui.arenadlg.chatbar.inputbar.contentedit",msg);										
										end;
										end;
										end;
										end;
										
									children=
									{
										vscroll=
										{
									
											type="SCROLLBAR",
											rect={5,-51,13,207},
											captionrect={4,0,5,207},
											pattern=wgtpattern_rawvisible+wgtpattern_alphavisible,
											style=wgtstyle_vertical+wgtstyle_ajustfollow,					
											ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
											bkcolor={0,0,0,128},
											edgecolor={128,128,128,255},						
											pagesize=8,
											marginh=3,
											marginv=0,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_right_out+alignstyle_vcenter,	
											extendstyle=scrollbar_auto_hide,
											drawflag=drawflag_caption_fill,
											updatemute=1,
										
											OnSelfShow=function()
												Win_AlignWidget("UI.gameui.arenadlg.chatbar.chatpanel.chatlist.vscroll","UI.gameui.arenadlg.chatbar.chatpanel.chatlist",aligntype_winrect,alignstyle_top_in+alignstyle_right_out,3,17);
												end;
											
											
											OnEdgeAjust=function(x,y,w,h)
												Win_ReAlignChild("UI.gameui.arenadlg.chatbar.chatpanel.chatlist.vscroll");
												end;
											
											children=
											{
												blockbtn=
												{
													type="BUTTON",
													rect={0,0,15,36},
													patchupleft="res/uires/patch/blockup.gsa",
													patchleftmiddle="res/uires/patch/blockmid.gsa",
													patchdownleft="res/uires/patch/blockdn.gsa",	
													moveable=1,
													aligntype=aligntype_father+aligntype_clientrect,
													alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																						
													
												};--blockbtn
												
							
												spinup=
												{
													type="SPIN",
													rect={0,0,22,21},
													bkimage="res/uires/common/upbtn.gsa",
													style=wgtstyle_primary,
													textstyle=1,		
													aligntype=aligntype_father+aligntype_winrect,
													alignstyle=alignstyle_top_out+alignstyle_hcenter,	
													marginh=0,
													marginv=0,							
													
												};--spinup
												
												spindown=
												{
													type="SPIN",
													rect={0,0,22,21},
													bkimage="res/uires/common/downbtn.gsa",	
													aligntype=aligntype_father+aligntype_winrect,
													alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
													marginh=0,
													marginv=0,
												};--spindown	
												
											};--children
									
										};--scroll
									};
								};
							};
						};
						
						inputbar=
						{
							type="WIDGET",
							rect = { 2,325,193,20 },
							updatemute=1,
							
							children=
							{
								chateredit=
								{
									type="EDIT",	
									rect = { 2,3,36,12 },
									editable=1,
									extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
									textsize=12,
									textstyle=dt_left+dt_vcenter,
									drawcolor={255,255,255,255},
									caption="所有人",
									editable=0,
									
									OnKeyDown=function(wparam,lparam,bvirtual)
										local nResult=0;
										if (wparam==38) then
										Win_SetCheck("UI.gameui.chatbar.inputbar.chaterbtn",true);
										Win_ShowWidget("UI.gameui.chaterdlg",true);
										nResult=1;
										end;
										return nResult;								
										end;
									
									OnTab=function()
										Win_SetFocus("UI.gameui.arenadlg.chatbar.inputbar.contentedit");
										end;
								},
								
								
								chaterbtn = 
								{
									type = "CHECK",
									rect = { 37,0,16,16 },
									bkimage = "res/uires/common/dropbtn.gsa",	
									bkimagepos={1,2},
									extendstyle=ui_btn_style_none,
									
									OnClick=function()
										     if  Win_IsChecked("UI.gameui.arenadlg.chatbar.inputbar.chaterbtn")  then
										     Win_SetValue("UI.gameui.listdlg",4,value_channel_customtype);
										     Win_ShowWidget("UI.gameui.listdlg",true);
										     else 
										     Win_ShowWidget("UI.gameui.listdlg",false);
										     end;						     
										     end;						
								},	
								
								contentedit=
								{
								
									type = "RICHEDIT",
									rect = { 62,3,117,12 },				
									drawcolor={255,255,255,255},	
									focuscolor={255,255,255,255},	
									--advertise="按回车键输入聊天信息....",
									textsize=12,
									textstyle=dt_left+dt_vcenter,
									richmode=ui_richmode_font+ui_richmode_color,							
									drawflag=drawflag_focuscaption,
									extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
									maxchar=120,
									
									OnTab=function()
										Win_SetFocus("UI.gameui.arenadlg.chatbar.inputbar.chateredit");
										end;
								};
								
								sendbtn = 
								{
									type = "CHECK",
									rect={241,1,16,16},
									bkimage="res/uires/chatbar/sendbtn.gsa",
									extendstyle=ui_btn_style_none,
									visible=0,
									
									OnClick=function()
										local bcantalk = Win_GetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",value_channel_customtype);
										if (bcantalk~=0) then
										local txt=Win_GetText("UI.gameui.arenadlg.chatbar.inputbar.contentedit");
										local goal=Win_GetText("UI.gameui.arenadlg.chatbar.inputbar.chateredit");
										if goal ~= "" and txt ~= "" then
										ArenaChat(goal,txt);			
										Win_SetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",0,value_channel_customtype);
										Win_SetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",1,value_channel_timerspace);
										end;
										else
										UI.children.gameui.OnArenaTalkInfo("/C22对不起,发送聊天信息失败,发送请不要太频繁","/C22【系统】","/C22对不起,发送聊天信息失败,发送请不要太频繁");
										end;
										
										Win_SetText("UI.gameui.arenadlg.chatbar.inputbar.contentedit","");
										end;
									
									OnTimer=function()
										Win_SetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",1,value_channel_customtype);
										Win_SetValue("UI.gameui.arenadlg.chatbar.inputbar.sendbtn",-1,value_channel_timerspace);
										end;
								};	
								
								facebtn = 
								{
									type = "CHECK",
									rect={178,1,16,16},
									bkimage="res/uires/chatbar/facebtn.gsa",
									extendstyle=ui_btn_style_none,
									framescheme={{0,0,0,0,0,0,0,0},{1,1,1,1,1,1,1,1}},
									
									OnClick=function()
										     if  Win_IsChecked("UI.gameui.arenadlg.chatbar.inputbar.facebtn")  then
										     Win_SetText("UI.gameui.facedlg","UI.gameui.arenadlg.chatbar.inputbar",value_channel_customname);
										     Win_AlignWidget("UI.gameui.facedlg","UI.gameui.arenadlg.chatbar.inputbar.facebtn",aligntype_winrect,alignstyle_top_out+alignstyle_left_in);
										     Win_ShowWidget("UI.gameui.facedlg",true);
										     Win_SetFocus("UI.gameui.facedlg.facelist");
										     end;						     
										     end;
								};								
							};
						};
		
					};
				};
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa",
					rect={648,27,22,23 };
					
					OnClick=function()
						Win_ShowMsgBox("关闭对话框将会退出竞技场,您确定要关闭吗？","系统消息",ui_msgid_yesno,"UI.gameui.arenadlg.closebtn");
						end;
					
					OnMsgBoxOk=function()
						Win_ShowWidget("UI.gameui.arenadlg",false);
						ExitArena();
						Win_ShowWidget("UI.gameui.selectarenadlg",true);
						end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 627,27,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("创建竞技场");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		
		
		
		
		ScreenEffectBuffer=
		{
			type="WIDGET",
			rect={0,0,1,1},
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			style=wgtstyle_renderbuffer,
			custombuffer=custom_buffer_screeneffect,
			visible=0,
		};
		
		ExitArenaBtn=
		{
			type="BUTTON",
			rect={376,465,31,40},
			framescheme={{0,1,1,1}},
			bkimage="res/uires/arenadlg/arenaexitbtn.gsa",	
			initlayer=msgbox_layer;
			pluslayer=0;
			moveable=0,
			tiptext="退出观战",
			visible=0,
			
			OnSelfShow=function()
				if GetScreenType()~=0 then
					Win_SetPos("UI.gameui.ExitArenaBtn",500,633);
				end;
				end;
			
			OnClick=function()
				Win_ShowMsgBox("您确定要退出竞技场吗？","系统消息",ui_msgid_yesno,"UI.gameui.ExitArenaBtn");
				end;
			
			OnMsgBoxOk=function()
				ExitArena();
				Win_ShowWidget("UI.gameui.ExitArenaBtn",false);
				end;
		};
		
		
		ExitHorseBtn=
		{
			type="BUTTON",
			rect={376,465,30,28},
			framescheme={{0,1,1,1}},
			bkimage="res/uires/gameui/leavehorse.gsa",	
			initlayer=msgbox_layer;
			pluslayer=0;
			moveable=0,
			tiptext="退出多人坐骑",
			visible=0,
			
			OnSelfShow=function()
				if GetScreenType()~=0 then
					Win_SetPos("UI.gameui.ExitHorseBtn",500,633);
				end;
				end;
			
			OnClick=function()
				Win_ShowMsgBox("您确定要退出多人坐骑吗？","系统消息",ui_msgid_yesno,"UI.gameui.ExitHorseBtn");
				end;
			
			OnMsgBoxOk=function()
				ExitHorseStat();
				Win_ShowWidget("UI.gameui.ExitHorseBtn",false);
				end;
		};	
			
		ExitAvatarActBtn=
		{
			type="BUTTON",
			rect={376,465,110,28},
			framescheme={{0,1,1,1}},
			bkimage="res/uires/gameui/exitavataract.gsa",	
			initlayer=msgbox_layer;
			pluslayer=0;
			moveable=0,
			tiptext="取消变装动作",
			visible=0,
			
			OnSelfShow=function()
				if GetScreenType()~=0 then
					Win_SetPos("UI.gameui.ExitAvatarActBtn",500,633);
				end;
			end;
			
			OnClick=function()
				Win_ShowMsgBox("您确定要取消变装动作吗？", "系统消息", ui_msgid_yesno, "UI.gameui.ExitAvatarActBtn");
			end;
			
			OnMsgBoxOk=function()
				ExitAvatarActState();
				Win_ShowWidget("UI.gameui.ExitAvatarActBtn",false);
			end;
		};	
		
		ShowWingBtn=
		{
			type="BUTTON",
			rect={376,465,30,28},
			framescheme={{0,1,1,1}},
			bkimage="res/uires/gameui/showwing.gsa",	
			initlayer=msgbox_layer;
			pluslayer=0;
			moveable=0,
			tiptext="显示同骑背包",
			visible=0,
			
			OnSelfShow=function()
				if GetScreenType()~=0 then
					Win_SetPos("UI.gameui.ShowWingBtn",500,633);
				end;
			end;
			
			OnClick=function()
				Win_ShowMsgBox("您确定要显示同骑背包吗？","系统消息",ui_msgid_yesno,"UI.gameui.ShowWingBtn");
			end;
			
			OnMsgBoxOk=function()
				ShowHideWing(1);
				Win_ShowWidget("UI.gameui.ShowWingBtn",false);
			end;
		};
		
		HideWingBtn=
		{
			type="BUTTON",
			rect={376,465,30,28},
			framescheme={{0,1,1,1}},
			bkimage="res/uires/gameui/hidewing.gsa",	
			initlayer=msgbox_layer;
			pluslayer=0;
			moveable=0,
			tiptext="隐藏同骑背包",
			visible=0,
			
			OnSelfShow=function()
				if GetScreenType()~=0 then
					Win_SetPos("UI.gameui.HideWingBtn",500,633);
				end;
			end;
			
			OnClick=function()
				Win_ShowMsgBox("您确定要隐藏同骑背包吗？","系统消息",ui_msgid_yesno,"UI.gameui.HideWingBtn");
			end;
			
			OnMsgBoxOk=function()
				ShowHideWing(0);
				Win_ShowWidget("UI.gameui.HideWingBtn",false);
			end;
		};		
		arenacountdowneffect=
		{
			type="DIALOG",
			rect={0,0,50,50},
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			effectpic="res/uires/arenadlg/countdowneffect.gsa",
			initlayer=0;
			pluslayer=0;
			moveable=0,
			visible=0,
			style=wgtstyle_cleanwin,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.arenacountdowneffect",0,value_channel_customtype);
				Win_SetValue("UI.gameui.arenacountdowneffect",1,value_channel_framespeed);
				end;
			
			OnTimer=function()
				local closetype = Win_GetValue("UI.gameui.arenacountdowneffect",value_channel_customtype);
				if (closetype==1) then
					Win_ShowWidget("UI.gameui.arenacountdowneffect",false);
					Win_SetValue("UI.gameui.arenacountdowneffect",-1,value_channel_timerspace);
				else
					local curframe = Win_GetValue("UI.gameui.arenacountdowneffect",value_channel_effectframe);
					if (curframe==9) then
					Win_SetValue("UI.gameui.arenacountdowneffect",1,value_channel_customtype);
					Win_SetValue("UI.gameui.arenacountdowneffect",0.8,value_channel_timerspace);
					else
					Win_SetValue("UI.gameui.arenacountdowneffect",0.1,value_channel_timerspace);
					end;
				end;
				end;
		};
		
		
		votedlg=
		{
			type="DIALOG",
			rect={0,0,448,407},
			bkimage="res/uires/votedlg/votedlgbk.gsa",
			captionrect={52,11,326,19},
			textsize=12,
			textfont=1,
			textstyle=dt_center+dt_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			moveable=1,
			visible=0,	
			updatemute=1,
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.votedlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.votedlg",0,value_channel_customtype);
				end;
			
			OnSelfHide=function()
				CloseVoteDlg();
				end;
			
			OnCancel=function()
				local t = Win_GetValue("UI.gameui.votedlg",value_channel_customtype);
				if t==0 then
				Win_ShowWidget("UI.gameui.votedlg",false);
				end;
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa",
					rect={422,10,20,19};
					defaultcancel=1;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 402,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("投票系统");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				descedit=
				{
					type="MULTIEDIT",
					rect={36,53,365,110};
					textsize=12,
					textstyle=dt_vcenter,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel+edit_style_copydisable,	
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					editable=0,		

					primaryscroll="UI.gameui.votedlg.descscroll";
				};	
				
				descscroll=
				{
			
					type="SCROLLBAR",
					rect={409,69,15,73},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.votedlg.descedit";
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,	
						};--spindown
						
					};--children
					
				};--scroll

			
				
				votebtns=
				{
					type="WIDGETLIST";
					rect={26,175,406,214};
					itemmarginv=2,
					itemmarginh=1,
					style=wgtstyle_none,
					
					template={"res/uires/votebtnitem.lua"};
					children={},
				};
			};
		};
		
		
		voteaffirmdlg=
		{
			type="MESSAGEBOX",
			rect = { 0, 0, 312, 122 },	
			bkimage="res/uires/votedlg/voteaffirmdlgbk.gsa",
			captionrect = { 0, 0, 0, 0 },	
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			initlayer=msgbox_layer,
			style=wgtstyle_topmost;
			visible=0,
			defaultendok=0,
			updatemute=1,
				
			--[[OnCaptureRelay=function()
				Win_SetCapture();
				end;]]
			
			OnSelfShow=function()
				--Win_SetCapture("UI.gameui.voteaffirmdlg");
				Win_SetFocus("UI.gameui.voteaffirmdlg.votenumedit");
				Win_SetText("UI.gameui.voteaffirmdlg.votenumedit",1);
				local info, num = GetVoteInfo();
				Win_ShowWidget("UI.gameui.voteaffirmdlg.menubtn",num>1);
				Win_SetValue("UI.gameui.votedlg",1,value_channel_customtype);
				Win_SetValue("UI.gameui.voteaffirmdlg.votenumedit",1,value_channel_minvalue);
				Win_SetValue("UI.gameui.voteaffirmdlg.votenumedit",num,value_channel_maxvalue);
				end;
			
			OnSelfHide=function()
				Win_SetValue("UI.gameui.votedlg",0,value_channel_customtype);
				end;
			
			children=
			{									
				sentence=
				{
					type="LABEL",
					rect = { 30,32,260,52 },
					captionrect = { 0,0,260,52 },
					textsize=12,
					rowspace=4,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
					richmode=ui_richmode_color+ui_richmode_hlink,
					enable=1,		
					initlayer=0;
					pluslayer=0;
				},
				
				commomvotebtn=
				{
					type="BUTTON",
					rect={19,92,90,22},
					bkimage="res/uires/votedlg/commomvotebtn.gsa";
					soundid={1007},
					
					OnClick=function()
						local txt = Win_GetText("UI.gameui.voteaffirmdlg.votenumedit");
						if txt=="" then
							GameUILogInfo("请先输入投票数目！");
						else
							local num = Win_GetValue("UI.gameui.voteaffirmdlg.votenumedit");
							local idx = Win_GetValue("UI.gameui.voteaffirmdlg",value_channel_customindex);
							local flag,num = Vote(0,idx,num);
							
							if flag == 2 then
								Win_ShowWidget("UI.gameui.voteaffirmdlg",false);
								Win_ShowWidget("UI.gameui.votedlg",false);
							elseif flag == 1 then
								Win_ShowMsgBox("对不起，您已经达到今天最大投票数！");
							elseif flag == 0 then
								Win_ShowMsgBox("您当前最大的普通可投票数目为:"..num);
							end;
							
						end;
						end;
				};
				
				vipvotebtn=
				{
					type="BUTTON",
					rect={110,92,90,22},
					bkimage="res/uires/votedlg/vipvotebtn.gsa";
					soundid={1007},
					
					OnClick=function()
						local txt = Win_GetText("UI.gameui.voteaffirmdlg.votenumedit");
						if txt=="" then
							GameUILogInfo("请先输入投票数目！");
						else
							local num = Win_GetValue("UI.gameui.voteaffirmdlg.votenumedit");
							local idx = Win_GetValue("UI.gameui.voteaffirmdlg",value_channel_customindex);
							local flag,num = Vote(1,idx,num);
							
							if flag == 2 then
								Win_ShowWidget("UI.gameui.voteaffirmdlg",false);
								Win_ShowWidget("UI.gameui.votedlg",false);
							elseif flag == 1 then
								Win_ShowMsgBox("对不起，您已经达到今天最大投票数！");
							elseif flag == 0 then
								Win_ShowMsgBox("您当前最大的VIP可投票数目为:"..num);
							end;
						end;
						end;
				};
				
				votenumedit=
				{
					type="EDIT",
					rect={210,98,60,13},
					editable=1,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					drawcolor={255,255,255,255},
					editmethod=ui_editmethod_number+ui_editmethod_value,
				};
				
				menubtn=
				{
					type = "CHECK",
					rect = {269,96,16,16},
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					visible=0,
					initlayer=msgbox_layer-1,
					
					OnClick=function()
						local info, num = GetVoteInfo();
						Win_SetValue("UI.gameui.listdlg",5,value_channel_customtype);
						Win_ShowWidget("UI.gameui.listdlg",true);
						end;
				};
				
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa",
					rect={287,6,20,19};
					defaultcancel=1;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 267,6,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					enable=0,
					
					OnClick=function()
						local helpid=GetHelpID("投票系统");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		
		};
		
		chatbar=
		{
		
			type = "WIDGET",
			rect = { 0, 476, 418, 30 },	
			initlayer=0,
			pluslayer=0,
			style=wgtstyle_areawake,
			autoadjust = autoadjust_left+autoadjust_bottom,
						
			OnEnter=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
				
			OnInitUpdate=function()
				if GetScreenType()==0 then  -- 800时候调整高度
					local panelrect=Win_GetRect("UI.gameui.chatbar.actionpanel",value_channel_winrect);
					Win_ExtendEdge("UI.gameui.chatbar.actionpanel",44-panelrect.h,edge_flag_up,rect_flag_window+rect_flag_client+rect_flag_caption);
					
					panelrect=Win_GetRect("UI.gameui.chatbar.chatpanel",value_channel_winrect);
					Win_ExtendEdge("UI.gameui.chatbar.chatpanel",80-panelrect.h,edge_flag_up,rect_flag_window+rect_flag_client+rect_flag_caption);
					
					Win_AlignWidget("UI.gameui.chatbar.actionpanel","UI.gameui.chatbar.chatpanel",aligntype_winrect,alignstyle_top_out,0,1);						

					panelrect=Win_GetRect("UI.gameui.chatbar.resizepanel",value_channel_winrect);
					Win_ExtendEdge("UI.gameui.chatbar.resizepanel",115-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client+rect_flag_caption);
					
					-- 定位广告栏
					local w = 300;
					local h = 55;
					Win_SetSize("UI.gameui.chatbar.broadcastwidget", w, h);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",w,value_channel_dragrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",h,value_channel_dragrect,3);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",w,value_channel_winrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",h,value_channel_winrect,3);
					
					Win_SetSize("UI.gameui.chatbar.broadcastwidget.broadcast", w-8, h-8);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_captionrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_clientrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_winrect,2);
				else
					local w = 384;
					local h = 75;
					-- 定位广告栏
					Win_SetSize("UI.gameui.chatbar.broadcastwidget",  w, h);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",w,value_channel_dragrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",h,value_channel_dragrect,3);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",w,value_channel_winrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget",h,value_channel_winrect,3);
					
					Win_SetSize("UI.gameui.chatbar.broadcastwidget.broadcast", w-8, h-8);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_captionrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_clientrect,2);
					Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",w-8,value_channel_winrect,2);
				end;

				UI.children.gameui.children.chatbar.children.broadcastwidget.OnUpdatePos();
			end;
				     
			children=
			{
				broadcastwidget=
				{
					type="WIDGET",
					rect = { 24, -204, 384, 75 },	

					style=wgtstyle_cleanwin+wgtstyle_alphawin+wgtstyle_clipself;--+wgtstyle_clipchild_window;
					visible=0;
					alphafactor=1.0;
					alphaspeed=0.1;
					updatemute=1,

					bkcolor={0,0,0,33},					
					patchrect={7,8,7,6},	
					patchdrawtype=patch_draw_type_scale,					

					patchupleft="res/uires/newcommon/patchupleft2.gsa",
					patchupright="res/uires/newcommon/patchupright2.gsa",
					patchdownleft="res/uires/newcommon/patchdownleft2.gsa",
					patchdownright="res/uires/newcommon/patchdownright2.gsa",
					
					patchupmiddle="res/uires/newcommon/patchupmiddle2.gsa",
					patchdownmiddle="res/uires/newcommon/patchdownmiddle2.gsa",
					patchleftmiddle="res/uires/newcommon/patchleftmiddle2.gsa",
					patchrightmiddle="res/uires/newcommon/patchrightmiddle2.gsa",
					
					patchmiddle="res/uires/newcommon/patchmiddle2.gsa",
					
					OnTimer=function()
						local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget", value_channel_customindex);
						local panelrect=Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
						
						if val >= 0 and val < 10 then
							local w = panelrect.w * val/10;
							Win_SetValue("UI.gameui.chatbar.broadcastwidget",w,value_channel_winrect,2);
						
							Win_SetValue("UI.gameui.chatbar.broadcastwidget",0.001,value_channel_timerspace);
							Win_SetValue("UI.gameui.chatbar.broadcastwidget", val+1, value_channel_customindex);
						elseif val == 10 then
							Win_SetValue("UI.gameui.chatbar.broadcastwidget",panelrect.w,value_channel_winrect,2);
							Win_SetValue("UI.gameui.chatbar.broadcastwidget",30,value_channel_timerspace);
							Win_SetValue("UI.gameui.chatbar.broadcastwidget", val+1, value_channel_customindex);
						else
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget", false);
							Win_SetValue("UI.gameui.chatbar.broadcastwidget",-1,value_channel_timerspace);
							
							--关闭天使恶魔顶端特效
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget.animeff1", false);
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget.animeff2", false);
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget.animeff3", false);
						end;
					end;
					
					OnSelfShow=function()
						Win_SetValue("UI.gameui.chatbar.broadcastwidget",0.001,value_channel_timerspace);

						Win_SetValue("UI.gameui.chatbar.broadcastwidget", 0, value_channel_customindex);
						Win_SetValue("UI.gameui.chatbar.broadcastwidget",0,value_channel_winrect,2);

					end;
						
					OnSelfHide=function()
					end;
					
					OnTelRadio=function(channel, datachannel, linedata)
						Win_ShowWidget("UI.gameui.chatbar.broadcastwidget", false);
					
						-- 当chatpanle隐藏的时候，一起隐藏，不显示不接受这个
						if Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
							Win_SetValue("UI.gameui.chatbar.broadcastwidget.broadcast",0,value_channel_item_num);

							linedata.caption=linedata.strdata..linedata.caption;
							Win_SetTable("UI.gameui.chatbar.broadcastwidget.broadcast",datachannel,linedata);
							
							-- 隐藏其他特效，显示当前特效[joeyxiong 14/04/2011]
							local catcamp = 1; -- 无阵营
							local eff = {"broadeff1", "blackeff1", "whiteeff1", "broadeff2", "blackeff2", "whiteeff2", "animeff1", 
							"animeff2","animeff3","animeff4","animeff5","animeff6","animeff7","animeff8","anim_dm_8","anim_dm","anim_elf_8",
							"anim_elf","anim_cai_8","anim_cai","anim_nian_8","anim_nian","anim_zhang_8","anim_zhang","anim_zhao_8","anim_zhao","anim_gfs_8","anim_gfs","anim_bfm_8","anim_bfm"};
							
							if channel== 16384 then
								catcamp = 3; -- 天使
							elseif channel== 32768 then
								catcamp = 2; -- 恶魔
							elseif channel == 36864 then
								catcamp = 6; -- 修罗
							elseif channel == 65536 then
								catcamp = 8; -- 黄金龙
							elseif channel == 69632 then
								capcamp = 10; -- 黄金凤
							end;
							
							--GameUILogInfo(capcamp);
							
							local effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[catcamp + 3];
									
							if GetScreenType()==0 then  -- 800时候调整大小
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[catcamp];
							end;
							
							if GetScreenType()~= 0 and channel == 36864 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[9];
							end;
							
							if GetScreenType()== 0 and channel == 36864 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[10];
							end;
							
							--1024*768和1280*800下黄金龙特效
							if GetScreenType() ~= 0 and channel == 65536 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[11];
							end;
							
							--800*600下黄金龙特效
							if GetScreenType()== 0 and channel == 65536 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[12];
							end;
							
							--1024*768和1280*800下黄金凤特效
							if GetScreenType() ~= 0 and channel == 69632 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[13];
							end;
							
							--800*600下黄金凤特效
							if GetScreenType()== 0 and channel == 69632 then
								effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[14];
							end;
							
							if channel == 69633 then
								if GetScreenType() == 0 then --800*600下恶魔王子特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[15];
								else  --1024*768和1280*800下恶魔王子特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[16];
								end;
							end;
							
							if channel == 69634 then
								if GetScreenType() == 0 then --800*600下精灵仙子特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[17];
								else  --1024*768和1280*800下精灵仙子特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[18];
								end;
							end;
							
							if channel == 69635 then
								if GetScreenType() == 0 then --800*600下财源广进特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[19];
								else  --1024*768和1280*800下财源广进特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[20];
								end;
							end;
							
							if channel == 69636 then
								if GetScreenType() == 0 then --800*600下年年有余特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[21];
								else  --1024*768和1280*800下年年有余特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[22];
								end;
							end;
							
							if channel == 69637 then
								if GetScreenType() == 0 then --800*600下张灯结彩特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[23];
								else  --1024*768和1280*800下张灯结彩特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[24];
								end;
							end;
							
							if channel == 69638 then
								if GetScreenType() == 0 then --800*600下招财进宝特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[25];
								else  --1024*768和1280*800下招财进宝特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[26];
								end;
							end;							
							
							if channel == 69639 then
								if GetScreenType() == 0 then --800*600下高富帅特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[27];
								else  --1024*768和1280*800下高富帅特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[28];
								end;
							end;
							
							if channel == 69640 then
								if GetScreenType() == 0 then --800*600下白富美特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[29];
								else  --1024*768和1280*800下白富美特效
									effwidget = "UI.gameui.chatbar.broadcastwidget." .. eff[30];
								end;
							end;
							
							for i = 1, table.getn(eff) do
								Win_ShowWidget("UI.gameui.chatbar.broadcastwidget." ..eff[i], false);
							end;
							
							--显示边框特效
							Win_ShowWidget(effwidget, true);
							
							--显示顶端动画
							if catcamp == 2 then
								Win_ShowWidget("UI.gameui.chatbar.broadcastwidget." ..eff[8], true);
							elseif catcamp == 3 then
								Win_ShowWidget("UI.gameui.chatbar.broadcastwidget." ..eff[7], true);
							--elseif catcamp == 4 then
								--Win_ShowWidget("UI.gameui.chatbar.broadcastwidget." ..eff[9], true);
							end;
							
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget", true);
						end;
					end;
					
					OnUpdatePos=function()
						if Win_IsVisible("UI.gameui.chatbar.actionpanel") then
							Win_AlignWidget("UI.gameui.chatbar.broadcastwidget","UI.gameui.chatbar.actionpanel",aligntype_winrect,alignstyle_top_out + alignstyle_left_in,0,1);						
						else
							Win_AlignWidget("UI.gameui.chatbar.broadcastwidget","UI.gameui.chatbar.chatpanel",aligntype_winrect,alignstyle_top_out+alignstyle_left_in,0,1);						
						end;
					end;
				     
					children=
					{
						--天使广播顶端动画特效
						animeff1 = 
						{
							type = "WIDGET",
							rect = {0, -2, 1, 1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9477.eff", x=105, y=0, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", 0, value_channel_winrect,0);	
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff1", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								if val < 60 then
									local w = (panelrect.w - 160) * val / 60;
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", w, value_channel_winrect, 0);
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", 0.5, value_channel_timerspace);
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", val+1, value_channel_customindex);
								else
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", (panelrect.w-160), value_channel_winrect, 0);
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff1", -1, value_channel_timerspace);
								end;
							end;
						},
						
						--恶魔广播顶端动画特效
						animeff2 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9478.eff", x=105, y=0, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff2", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								if val < 60 then
									local w = (panelrect.w - 160) * val / 60;
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", w, value_channel_winrect, 0);
								
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", 0.5, value_channel_timerspace);
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", val+1, value_channel_customindex);
								else
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", (panelrect.w-160), value_channel_winrect, 0);
									Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff2", -1, value_channel_timerspace);
								end;
							end;							
						},
						
						--修罗广播顶端动画特效
						animeff3 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9500.eff", x=208, y=65, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff3", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", -1, value_channel_timerspace);
								--end;
							end;							
						},
						
						--修罗广播顶端动画特效800*600
						animeff4 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9501.eff", x=168, y=51, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff4", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", -1, value_channel_timerspace);
								--end;
							end;							
						},
						
						--黄金龙广播顶端动画特效
						animeff5 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9543.eff", x=216, y=65, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff5", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", -1, value_channel_timerspace);
								--end;
							end;							
						},
						
						--黄金龙广播顶端动画特效800*600
						animeff6 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9512.eff", x=173, y=51, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff6", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff6", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff6",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff6", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", -1, value_channel_timerspace);
								--end;
							end;							
						},
						
						--黄金凤广播顶端动画特效
						animeff7 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9548.eff", x=199, y=76, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff5",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff5", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", -1, value_channel_timerspace);
								--end;
							end;							
						},
						
						--黄金凤广播顶端动画特效800*600
						animeff8 = 
						{
							type = "WIDGET",
							rect = {0,-7,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9513.eff", x=173, y=72, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.animeff8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);

								--if val < 60 then
									--local w = (panelrect.w - 160) * val / 60;
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", w, value_channel_winrect, 0);
								
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", 0.5, value_channel_timerspace);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff3", val+1, value_channel_customindex);
								--else
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", (panelrect.w-160), value_channel_winrect, 0);
									--Win_SetValue("UI.gameui.chatbar.broadcastwidget.animeff4", -1, value_channel_timerspace);
								--end;
							end;							
						},						
						
						
						--恶魔王子喇叭 特效
						anim_dm = 
						{
							type = "WIDGET",
							rect = {-2,-22,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9674.eff", x=199, y=76, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_dm", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;							
						},
						--恶魔王子喇叭 特效800*600
						anim_dm_8 = 
						{
							type = "WIDGET",
							rect = {-2,-22,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9674.eff", x=173, y=72, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_dm_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_dm_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;							
						},	
						
						--精灵仙子喇叭 特效
						anim_elf = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9675.eff", x=204, y=76, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_elf", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;							
						},
						--精灵仙子喇叭 特效800*600
						anim_elf_8 = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9675.eff", x=173, y=72, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_elf_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_elf_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;							
						},	
						
						--财源广进
						anim_cai = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9821.eff", x=210, y=76, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_cai", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--财源广进 800*600
						anim_cai_8 = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9816.eff", x=160, y=70, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_cai_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_cai_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--年年有余
						anim_nian = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9822.eff", x=218, y=96, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_nian", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--年年有余 800*600
						anim_nian_8 = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9817.eff", x=173, y=80, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_nian_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_nian_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--张灯结彩
						anim_zhang = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9824.eff", x=218, y=88, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--张灯结彩 800*600
						anim_zhang_8 = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9818.eff", x=173, y=72, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_zhang_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--白富美
						anim_bfm = 
						{
							type = "WIDGET",
							rect = {5,10,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9982.eff", x=218, y=66, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--白富美 800*600
						anim_bfm_8 = 
						{
							type = "WIDGET",
							rect = {5,15,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9982.eff", x=173, y=60, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_bfm_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--高富帅
						anim_gfs = 
						{
							type = "WIDGET",
							rect = {5,10,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9981.eff", x=218, y=66, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--高富帅 800*600
						anim_gfs_8 = 
						{
							type = "WIDGET",
							rect = {5,15,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9981.eff", x=173, y=60, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_gfs_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--招财进宝
						anim_zhao = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9823.eff", x=218, y=66, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--招财进宝 800*600
						anim_zhao_8 = 
						{
							type = "WIDGET",
							rect = {5,-24,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9819.eff", x=173, y=60, loop=1, delay=0}},
							visible=0;
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao_8", 0.5, value_channel_timerspace);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao_8", 0, value_channel_customindex);
								Win_SetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao_8",0,value_channel_winrect,0);								
							end;
							
							OnTimer=function()
								local val = Win_GetValue("UI.gameui.chatbar.broadcastwidget.anim_zhao_8", value_channel_customindex);
								local panelrect = Win_GetRect("UI.gameui.chatbar.broadcastwidget",value_channel_dragrect);
							end;
						},
						
						--普通广播边框特效[800]
						broadeff1 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9168.eff", x=150, y=29, loop=1, delay=0}},
							visible=0;
						},
						
						--普通广播边框特效[1024]
						broadeff2 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9167.eff", x=191, y=67, loop=1, delay=0}},
							visible=0;
						},
						
						--天使广播边框特效[800]
						whiteeff1 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9479.eff", x=150, y=29, loop=1, delay=0}},
							visible=0;
						},
						
						--天使广播边框特效[1024]
						whiteeff2 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9480.eff", x=192, y=48, loop=1, delay=0}},
							visible=0;
						},
						
						--恶魔广播边框特效[800]
						blackeff1 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9481.eff", x=150, y=29, loop=1, delay=0}},
							visible=0;
						},
						
						--恶魔广播边框特效[1024]
						blackeff2 = 
						{
							type = "WIDGET",
							rect = {0,0,1,1},
							style=wgtstyle_effect+wgtstyle_alphawin+wgtstyle_cleanwin;
							effect={{name="TFX9482.eff", x=191, y=48, loop=1, delay=0}},
							visible=0;
						},
						
						broadcast=
						{
							type = "TEXTLIST",
							rect = { 4, 2, 397, 170 },	
							style=wgtstyle_cleanwin,
							
							rowspace=4,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							
							--ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
							magiccolor={0,0,0,128},
							linkcolor={100,100,255,255},
							richmode=ui_richmode_icon+ui_richmode_color+ui_richmode_hlink,
							richflag=1,
							initlayer=0,
							pluslayer=0,
									
							visible=1;
						};
					};
				};
			
				resizepanel=
				{
					type="WIDGET",
					rect = { 210, -174, 200, 210 },					
					edgethick=4,
					ajustedge=edge_flag_right;
					ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
					style=wgtstyle_cleanwin,
					initlayer=0,
					pluslayer=0,
							
					minwidth=10;
					maxwidth=400;
					
					alphafactor=1.0;
					alphaspeed=0.1;
					
					updatemute=1,
					
					mornitor={{value_channel_winrect,2}},
					
					OnUpdate=function()
						local panelrect=Win_GetRect("UI.gameui.chatbar.resizepanel",value_channel_winrect);
						local panelrect2=Win_GetRect("UI.gameui.chatbar.actionpanel",value_channel_winrect);
						local panelrect3=Win_GetRect("UI.gameui.chatbar.chatpanel",value_channel_winrect);
						local panelrect4=Win_GetRect("UI.gameui.chatbar.inputbar",value_channel_winrect);
						
						local delta = (384 + (panelrect.w-200) - panelrect2.w);
						
						Win_ExtendEdge("UI.gameui.chatbar.actionpanel",delta,edge_flag_right,rect_flag_window+rect_flag_client+rect_flag_caption);
						Win_AlignWidget("UI.gameui.chatbar.actionpanel.actionlist.vscroll","UI.gameui.chatbar.actionpanel.actionlist", aligntype_winrect, alignstyle_right_out+alignstyle_vcenter);
						
						Win_ExtendEdge("UI.gameui.chatbar.chatpanel",delta,edge_flag_right,rect_flag_window+rect_flag_client+rect_flag_caption);
						Win_AlignWidget("UI.gameui.chatbar.chatpanel.chatlist.vscroll","UI.gameui.chatbar.chatpanel.chatlist", aligntype_winrect, alignstyle_right_out+alignstyle_vcenter);
						
						Win_ExtendEdge("UI.gameui.chatbar.inputbar",delta,edge_flag_right,rect_flag_window+rect_flag_client+rect_flag_caption);
						Win_ExtendEdge("UI.gameui.chatbar.inputbar.contentedit",delta,edge_flag_right,rect_flag_window+rect_flag_client+rect_flag_caption);
					end;
					
					OnUpdateHeight=function()
						local panelrect=Win_GetRect("UI.gameui.chatbar.resizepanel",value_channel_winrect);
						local panelrect2=Win_GetRect("UI.gameui.chatbar.actionpanel",value_channel_winrect);
						local panelrect3=Win_GetRect("UI.gameui.chatbar.chatpanel",value_channel_winrect);
						local panelrect4=Win_GetRect("UI.gameui.chatbar.inputbar",value_channel_winrect);
						
						local h = panelrect2.h + panelrect3.h + panelrect4.h + 4;
						
						Win_ExtendEdge("UI.gameui.chatbar.resizepanel",h-panelrect.h,edge_flag_up,rect_flag_window+rect_flag_client+rect_flag_caption);

						-- 定位广告栏
						UI.children.gameui.children.chatbar.children.broadcastwidget.OnUpdatePos();
					end;
					
					OnSelfShow=function()
						local var=GetGameVar("chatfade");
						if var==1 then
							Win_EnableWidget("UI.gameui.chatbar.resizepanel", true);
						else
							Win_EnableWidget("UI.gameui.chatbar.resizepanel", false);
						end;
					end;
				};

				actionpanel=
				{
					type="WIDGET",
					rect = { 24, -174, 384, 62 },					
			
					edgethick=4,
					ajustedge=edge_flag_up;
					ajustflag=rect_flag_window+rect_flag_client;
					style=wgtstyle_cleanwin,
							
					minheight=33;
					maxheight=150;
					
					alphafactor=1.0;
					alphaspeed=0.1;

					bkcolor={0,0,0,33},					
					patchrect={7,8,7,6},	
					patchdrawtype=patch_draw_type_scale,					
					
					patchupleft="res/uires/newcommon/patchupleft2.gsa",
					patchupright="res/uires/newcommon/patchupright2.gsa",
					patchdownleft="res/uires/newcommon/patchdownleft2.gsa",
					patchdownright="res/uires/newcommon/patchdownright2.gsa",
					
					patchupmiddle="res/uires/newcommon/patchupmiddle2.gsa",
					patchdownmiddle="res/uires/newcommon/patchdownmiddle2.gsa",
					patchleftmiddle="res/uires/newcommon/patchleftmiddle2.gsa",
					patchrightmiddle="res/uires/newcommon/patchrightmiddle2.gsa",
					
					patchmiddle="res/uires/newcommon/patchmiddle2.gsa",
					
					updatemute=1,
					
					mornitor={{value_channel_winrect,1}},
					
					OnUpdate=function()
						UI.children.gameui.children.chatbar.children.resizepanel.OnUpdateHeight();
					end;
					
					OnSelfShow=function()
						SetGameVar("actionmsg",1);
						local var=GetGameVar("chatfade");
						if var==0 then						
						Win_SetValue("UI.gameui.chatbar.actionpanel",alpha_state_decrease,value_channel_alphastate);
						end;
						
						Win_SetValue("UI.gameui.chatbar.splitbtn",0,value_channel_framescheme);	
						
						-- 定位广告栏
						UI.children.gameui.children.chatbar.children.broadcastwidget.OnUpdatePos();
						end;
						
					OnSelfHide=function()
						SetGameVar("actionmsg",0);
						end;
					
					children=
					{
						actionlist=
						{
							type = "TEXTLIST",
							rect = { 2,3, 369, 56  },
							clientrect = { 48, 0, 319, 56  },
							titlerect={-48,0,48,12},							
							style=wgtstyle_clipself+wgtstyle_ajustfollow+wgtstyle_cleanwin,
							extendstyle=textlist_style_delayscroll,
							scrollspeed=100000,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
							magiccolor={0,0,0,128},
							linkcolor={100,100,255,255},
							mousedelta=18,
							richmode=ui_richmode_icon+ui_richmode_color+ui_richmode_hlink,
							richflag=1,
							updatemute=1,
													
							OnDBClick=function(idx,wparam,lparam)
								if idx>=0 then
								local nflag=GetBitAnd(wparam,32);
								if nflag~=0 then
								local listname="UI.gameui.chatbar.actionpanel.actionlist";
								local datachannel=value_channel_itemtext;
								local linetext=Win_GetText(listname,datachannel,idx);
								local msg,sender=GetNeatChatMsg(linetext);
								if (msg~="") then
								Win_OnInsert("UI.gameui.chatbar.inputbar.contentedit",msg);										
								end;
								end;
								end;
								end;

							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={0,-2,10,42},
									captionrect={3,0,4,44},
									pattern=wgtpattern_rawvisible+wgtpattern_alphavisible,
									style=wgtstyle_vertical+wgtstyle_ajustfollow,					
									ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
									bkcolor={0,0,0,128},
									pagesize=8,
									marginh=0,
									marginv=0,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									extendstyle=scrollbar_auto_hide,
									drawflag=drawflag_caption_fill,
									updatemute=1,
									
									minwidth=10;
									maxwidth=10;
									
									OnEdgeAjust=function(x,y,w,h)
										Win_ReAlignChild("UI.gameui.chatbar.actionpanel.actionlist.vscroll");
										end;
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,10,16},
											bkimage="res/uires/chatbar/minislidebtn.gsa",
											bkimagepos={0,0},
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,10,6},
											bkimage="res/uires/chatbar/miniupbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,10,6},
											bkimage="res/uires/chatbar/minidnbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
																	
										};--spindown
										
									};--children
							
								};--scroll
							};	
						};
						
					};
				};
				
				chatpanel=
				{
					type="WIDGET",
					rect = { 24, -111, 384, 118 },
					--aligntype=aligntype_father+aligntype_winrect,
					--alignstyle=alignstyle_top_out,
					style=wgtstyle_cleanwin,					
			
					--edgethick=4,
					ajustedge=edge_flag_up;
					ajustflag=rect_flag_window+rect_flag_client;
					
					minheight=33;
					maxheight=190;
					
					alphafactor=1.0;
					alphaspeed=0.1;

					bkcolor={0,0,0,33},					
					patchrect={7,8,7,6},
					patchdrawtype=patch_draw_type_scale,					

					patchupleft="res/uires/newcommon/patchupleft2.gsa",
					patchupright="res/uires/newcommon/patchupright2.gsa",
					patchdownleft="res/uires/newcommon/patchdownleft2.gsa",
					patchdownright="res/uires/newcommon/patchdownright2.gsa",
					
					patchupmiddle="res/uires/newcommon/patchupmiddle2.gsa",
					patchdownmiddle="res/uires/newcommon/patchdownmiddle2.gsa",
					patchleftmiddle="res/uires/newcommon/patchleftmiddle2.gsa",
					patchrightmiddle="res/uires/newcommon/patchrightmiddle2.gsa",
					
					patchmiddle="res/uires/newcommon/patchmiddle2.gsa",
					
					mornitor={{value_channel_alphafactor},{value_channel_winrect,1}},
					
					OnUpdate=function()
						if Win_IsVisible("UI.gameui.chatbar.actionpanel") then
						local alphafactor=Win_GetValue("UI.gameui.chatbar.chatpanel",value_channel_alphafactor);
						Win_SetValue("UI.gameui.chatbar.actionpanel",alphafactor,value_channel_alphafactor);
						end;
						Win_AlignWidget("UI.gameui.chatbar.actionpanel","UI.gameui.chatbar.chatpanel",aligntype_winrect,alignstyle_top_out,0,1);
						UI.children.gameui.children.chatbar.children.resizepanel.OnUpdateHeight();
						end;
					
					OnSelfShow=function()						
						local var=GetGameVar("chatfade");
						if var==0 then						
						Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_decrease,value_channel_alphastate);
						end;

						-- 定位广告栏
						UI.children.gameui.children.chatbar.children.broadcastwidget.OnUpdatePos();
						end;
											
					children=
					{
						chatlist=
						{
							type = "TEXTLIST",
							rect = { 2,3, 369, 112  },
							clientrect = { 48, 0, 319, 112  },
							titlerect={-48,0,48,12},
							style=wgtstyle_clipself+wgtstyle_ajustfollow+wgtstyle_cleanwin,
							extendstyle=textlist_style_delayscroll,
							scrollspeed=100000,
							rowspace=6,
							textsize=12,
							textstyle=dt_left+dt_magicedge,
							groupid=0,
							ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
							magiccolor={0,0,0,128},
							linkcolor={100,100,255,255},
							mousedelta=18,
							richmode=ui_richmode_icon+ui_richmode_color+ui_richmode_hlink,
							richflag=1,
							initlayer=0,
							pluslayer=0,
							updatemute=1,
															
							OnDBClick=function(idx,wparam,lparam)
								if idx>=0 then
								local nflag=GetBitAnd(wparam,32);
								if nflag~=0 then
								local listname="UI.gameui.chatbar.chatpanel.chatlist";
								local datachannel=value_channel_itemtext;
								local linetext=Win_GetText(listname,datachannel,idx);
								local msg,sender=GetNeatChatMsg(linetext);
								if (msg~="") then
								Win_OnInsert("UI.gameui.chatbar.inputbar.contentedit",msg);										
								end;
								end;
								end;
								end;
								
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={0,-2,10,100},
									captionrect={3,0,4,102},
									pattern=wgtpattern_rawvisible+wgtpattern_alphavisible,
									style=wgtstyle_vertical+wgtstyle_ajustfollow,					
									ajustflag=rect_flag_window+rect_flag_client+rect_flag_caption;
									bkcolor={0,0,0,128},
									edgecolor={128,128,128,255},						
									pagesize=8,
									marginh=0,
									marginv=0,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									extendstyle=scrollbar_auto_hide,
									drawflag=drawflag_caption_fill,
									updatemute=1,
									
									minwidth=10;
									maxwidth=10;
									
									OnEdgeAjust=function(x,y,w,h)
										Win_ReAlignChild("UI.gameui.chatbar.chatpanel.chatlist.vscroll");
										end;
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,10,16},
											bkimage="res/uires/chatbar/minislidebtn.gsa",
											bkimagepos={0,0},
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,10,6},
											bkimage="res/uires/chatbar/miniupbtn.gsa",
											style=wgtstyle_primary+wgtstyle_alignfollow,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,10,6},
											bkimage="res/uires/chatbar/minidnbtn.gsa",	
											style=wgtstyle_alignfollow,
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
							
								};--scroll
							};
						};
					};
				};
				
				inputbar=
				{
					type="WIDGET",
					rect = { 24, 6, 384, 23 },
					patchupleft="res/uires/chatbar/inputbar.gsa",
					patchupmiddle="res/uires/chatbar/inputbar_mid.gsa",
					patchupright="res/uires/chatbar/inputbar_right.gsa",
					
					updatemute=1,
					
					children=
					{
						chateredit=
						{
							type="EDIT",	
							rect = { 8,7,26,12 },
							editable=1,
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							drawcolor={255,255,255,255},
							caption="附近",
							
							OnKeyDown=function(wparam,lparam,bvirtual)
								local nResult=0;
								if (wparam==38) then
								Win_SetCheck("UI.gameui.chatbar.inputbar.chaterbtn",true);
								Win_ShowWidget("UI.gameui.chaterdlg",true);
								nResult=1;
								end;
								return nResult;								
								end;
							
							--OnTab=function()
							--	Win_SetFocus("UI.gameui.chatbar.inputbar.contentedit");
							--	end;
						},
						
						
						chaterbtn = 
						{
							type = "CHECK",
							rect = { 35,4,16,16 },
							bkimage = "res/uires/chatbar/dropselbtn.gsa",	
							bkimagepos={1,2},
							extendstyle=ui_btn_style_none,
							framescheme={{1},{0}},
							
							OnClick=function()
								     if  Win_IsChecked("UI.gameui.chatbar.inputbar.chaterbtn")  then
								     Win_ShowWidget("UI.gameui.chaterdlg",true);
								     else 
								     Win_ShowWidget("UI.gameui.chaterdlg",false);
								     end;						     
								     end;						
						},	
						
						contentedit=
						{
						
							type = "RICHEDIT",
							rect = { 76,6,296,12 },							
							drawcolor={255,255,255,255},	
							focuscolor={255,255,255,255},	
							--advertise="按回车键输入聊天信息....",
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							richmode=ui_richmode_font+ui_richmode_color,							
							drawflag=drawflag_focuscaption,
							extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
							maxchar=120,
							
							--OnTab=function()
							--	Win_SetFocus("UI.gameui.chatbar.inputbar.chateredit");
							--	end;
						};
						
						sendbtn = 
						{
							type = "CHECK",
							rect={380,10,16,16},
							bkimage="res/uires/chatbar/sendbtn.gsa",
							extendstyle=ui_btn_style_none,
							tiptext="Ctrl+Enter/Alt+S",
							visible=0;
							
							OnClick=function()
								     UI.children.gameui.OnAccel_AccelSend();					     
								     end;
						};	
						
						facebtn = 
						{
							type = "CHECK",
							rect={60,4,16,16},
							bkimage="res/uires/chatbar/facebtn.gsa",
							extendstyle=ui_btn_style_none,
							framescheme={{0,1,2,1},{0,0,0,0}},
							tiptext="Alt+B",
							
							OnClick=function()
								     if  Win_IsChecked("UI.gameui.chatbar.inputbar.facebtn")  then
								     Win_SetText("UI.gameui.facedlg","UI.gameui.chatbar.inputbar",value_channel_customname);
								     Win_AlignWidget("UI.gameui.facedlg","UI.gameui.chatbar.inputbar.facebtn",aligntype_winrect,alignstyle_top_out+alignstyle_left_in);
								     Win_ShowWidget("UI.gameui.facedlg",true);
								     Win_SetFocus("UI.gameui.facedlg.facelist");
								     end;						     
								     end;
						};								
					};
				};
				
				
				stoprecord=
				{
					type = "BUTTON",
					rect = { 0,-138, 24, 24 },
					bkimage = "res/uires/chatbar/stoprecordbtn.gsa",
					tiptext="自由幻想录像",
					visible=0,
					
					OnClick=function()
						--Win_ShowMsgBox("您确认要结束并保存录像吗？","系统消息",ui_msgid_yesno,"UI.gameui.chatbar.stoprecord");
						Win_ShowWidget("UI.gameui.stoprecordwgt", true);
						end;
					
					--OnMsgBoxOk=function()
					--	StopRecord();
					--	Win_ShowWidget("UI.gameui.chatbar.stoprecord",false);
					--	end;
				};
				
				qqbroadcastbtn = 
				{
					type = "CHECK",
					rect = { 0,-168, 24, 24 },
					bkimage = "res/uires/chatbar/qqbroadcast.gsa",
					tiptext="QQ电台",
					framespeed=0.72;
					visible=0,
					updatemute=1,

					--[[OnCheck=function(bcheck)
						if bcheck==1 then
							QQBroadcastPlay();
						else
							QQBroadcastStop();
						end;						
						end;]]
					
					OnCheck=function(bcheck)
						Win_ShowWidget("UI.gameui.qqradiodlg",bcheck~=0);
						end;
				};
				
				filterbtn = 
				{
					type = "CHECK",
					rect = { 0,-113, 24, 24 },
					bkimage = "res/uires/chatbar/filterbtn.gsa",
					extendstyle=ui_btn_style_none,
					tiptext="过滤聊天信息",	
					updatemute=1,
					framescheme={{1},{0}},
						
					OnClick=function()								    
						local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
						if nameflag=="actionfilter" then
						Win_ShowWidget("UI.gameui.ScrnTutortip",false);
						end;
						
						if  Win_IsChecked("UI.gameui.chatbar.filterbtn")  then
						Win_ShowWidget("UI.gameui.filterdlg",true);
						Win_ActiveSelf("UI.gameui.filterdlg");
						else 
						Win_ShowWidget("UI.gameui.filterdlg",false);
						end;						     
						end;
				};

				splitbtn = 
				{
					type = "BUTTON",
					rect = { 0,-89, 24, 24 },
					bkimage = "res/uires/chatbar/splitbtn.gsa",
					extendstyle=ui_btn_style_none,
					--framescheme={{0,2,1,1},{0,2,0,2,0,2,0,2}},
					tiptext="切换行为信息显示",
					updatemute=1,
										
					OnClick=function()
						local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
						if nameflag=="actionopen" then
						Win_ShowWidget("UI.gameui.ScrnTutortip",false);
						end;
						
						if Win_IsVisible("UI.gameui.chatbar.actionpanel") then
						Win_ShowWidget("UI.gameui.chatbar.actionpanel",false);
						else
						Win_ShowWidget("UI.gameui.chatbar.actionpanel",true);
						if not Win_IsVisible("UI.gameui.chatbar.chatpanel") then
							--Win_ShowWidget("UI.gameui.chatbar.chatpanel",true);
							UI.children.gameui.children.chatbar.children.sizebtn.OnClick();
						end;
						end;
						UI.children.gameui.children.chatbar.children.broadcastwidget.OnUpdatePos();
						end;
				};
						
				viewbtn= 
				{
					type = "CHECK",
					rect = { 0,-64, 24, 24 },
					bkimage = "res/uires/chatbar/viewbtn.gsa",
					extendstyle=ui_btn_style_none,
					tiptext="聊天信息查看面板",
					updatemute=1,
					framescheme={{1},{0}},
					
					OnClick=function()								    
						local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
						if nameflag=="actionview" then
						Win_ShowWidget("UI.gameui.ScrnTutortip",false);
						end;
						
						if  Win_IsChecked("UI.gameui.chatbar.viewbtn")  then
						Win_ShowWidget("UI.gameui.historybar",true);
						Win_ActiveSelf("UI.gameui.historybar");
						else 
						Win_ShowWidget("UI.gameui.historybar",false);
						end;						     
						end;				
				};
				

				
				clearbtn = 
				{
					type = "BUTTON",
					rect = { 0,-41, 24, 24 },
					bkimage = "res/uires/chatbar/clearbtn.gsa",	
					extendstyle=ui_btn_style_none,
					tiptext="清空聊天窗口信息",
					updatemute=1,
					
					OnClick=function()
						local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
						if nameflag=="actionclear" then
						Win_ShowWidget("UI.gameui.ScrnTutortip",false);
						end;
						
						Win_SetValue("UI.gameui.chatbar.chatpanel.chatlist",0,value_channel_item_num);
						Win_SetValue("UI.gameui.chatbar.actionpanel.actionlist",0,value_channel_item_num);
						end;
				};
				
				lockbtn = 
				{
					type = "BUTTON",
					rect = { 0,-18, 24, 24 },
					bkimage = "res/uires/chatbar/lockbtn.gsa",
					customstate=0,
					extendstyle=ui_btn_style_none,
					tiptext="关闭聊天背景",
					updatemute=1,
					
					OnClick=function()
						local var=GetGameVar("chatfade");
						if var==1 then
						SetGameVar("chatfade",0);
						Win_SetText("UI.gameui.chatbar.lockbtn","开启聊天背景",value_channel_tiptext);
						
						if Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
							Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_decrease,value_channel_alphastate);
						end;
						
						Win_EnableWidget("UI.gameui.chatbar.resizepanel", false);
						else
						SetGameVar("chatfade",1);
						Win_SetText("UI.gameui.chatbar.lockbtn","关闭聊天背景",value_channel_tiptext);

						if Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
							Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_increase,value_channel_alphastate);
						end;
						
						Win_EnableWidget("UI.gameui.chatbar.resizepanel", true);
						end;
						end;
				};
				
				sizebtn = 
				{
					type = "BUTTON",
					rect = { 2,7, 20, 19 },
					--bkimage = "res/uires/chatbar/sizebtn.gsa",	
					bkimage="res/uires/common/minize_rightleft_btn.gsa",
					framescheme={{4,4,5,5,6,6,7,7},{0,0,1,1,2,2,3,3}},
					curscheme=0,				
					extendstyle=ui_btn_style_none,
					tiptext="缩进/弹出聊天窗口",
					updatemute=1,
					
					OnClick=function()
						local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
						if nameflag=="actionsize" then
							Win_ShowWidget("UI.gameui.ScrnTutortip",false);
						end;
						
						local panelrect=Win_GetRect("UI.gameui.chatbar.chatpanel",value_channel_winrect);
						
						if not Win_IsVisible("UI.gameui.chatbar.chatpanel")  then
							Win_SetValue("UI.gameui.chatbar.sizebtn",0,value_channel_framescheme);						
							Win_ShowWidget("UI.gameui.chatbar.chatpanel",true);						
							local var=GetGameVar("actionmsg");						
							Win_ShowWidget("UI.gameui.chatbar.actionpanel",(var==1));
							
							local var=GetGameVar("chatfade");
							if var==0 then				
								Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_decrease,value_channel_alphastate);
							else
								Win_SetValue("UI.gameui.chatbar.chatpanel",alpha_state_increase,value_channel_alphastate);
							end;
						else
							Win_SetValue("UI.gameui.chatbar.sizebtn",1,value_channel_framescheme);						
							Win_ShowWidget("UI.gameui.chatbar.chatpanel",false);
							local var=GetGameVar("actionmsg");
							Win_ShowWidget("UI.gameui.chatbar.actionpanel",false);
							Win_ShowWidget("UI.gameui.chatbar.broadcastwidget",false);
							SetGameVar("actionmsg",var);
						end;

						end;
				};
				
				
				
			};			
		
		};	

		--caption="QQ电台",
		qqradiodlg=
		{
			type="DIALOG",
			rect={0,0,427,362},
			bkimage="res/uires/qqradio/qqradiodlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			moveable=1,
			visible=0,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.qqradiodlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				Win_SetValue("UI.gameui.qqradiodlg.voiceslider",100,value_channel_maxvalue);
				
				Win_SetValue("UI.gameui.qqradiodlg.menutab1",-1,value_channel_customindex);
				Win_SetCheck("UI.gameui.qqradiodlg.menutab1",true);
				Win_SetCheck("UI.gameui.qqradiodlg.menutab2",false);
				Win_SetCheck("UI.gameui.qqradiodlg.menutab3",false);
				
				local text = Win_GetText("UI.gameui.qqradiodlg",value_channel_customtext);
				local len = Win_GetValue("UI.gameui.qqradiodlg",value_channel_customid);
				if text=="" and len == 0 then
				UI.children.gameui.children.qqradiodlg.OnShowBulletin("请选择频道",60);
				end;
				
				--关闭第三个频道
				Win_ShowWidget("UI.gameui.qqradiodlg.broadcastbtn3",false);
				Win_ShowWidget("UI.gameui.qqradiodlg.menutab3",false);
				
				end;
			
			OnSelfHide=function()
				if Win_IsChecked("UI.gameui.chatbar.qqbroadcastbtn") then
					Win_SetCheck("UI.gameui.chatbar.qqbroadcastbtn",false);
				end;
				end;
			
			OnShowBulletin=function(msg,len)
				Win_SetText("UI.gameui.qqradiodlg",msg,value_channel_customtext);
				Win_SetValue("UI.gameui.qqradiodlg",len,value_channel_customid);
				
				if msg~="" and len>0 then
				UI.children.gameui.children.qqradiodlg.children.broadcastlabel.ShowBulletin(msg,len);
				else
				Win_SetValue("UI.gameui.qqradiodlg",0,value_channel_customindex);
				end;
				
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={398,19,23,22};
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 376,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("QQ电台");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
				
				broadcastlabel=
				{
					type="LABEL",
					rect={42,50,191,20},
					style=wgtstyle_clipself+wgtstyle_clipchild_window,
					
					--滚动公告
					ShowBulletin=function(msg,len)
						Win_ClearPathPoint("UI.gameui.qqradiodlg.broadcastlabel.movelabel");
						if (msg~="" and len>0) then
						Win_SetText("UI.gameui.qqradiodlg.broadcastlabel.movelabel",msg);
						Win_SetValue("UI.gameui.qqradiodlg.broadcastlabel.movelabel",len,value_channel_winrect,2);
						local winrect = Win_GetRect("UI.gameui.qqradiodlg.broadcastlabel",value_channel_winrect);
						Win_SetPos("UI.gameui.qqradiodlg.broadcastlabel.movelabel",winrect.x+winrect.w,winrect.y);
						Win_PushPathPoint("UI.gameui.qqradiodlg.broadcastlabel.movelabel",winrect.x-len,winrect.y);
						end;
						end;

					children=
					{
						movelabel=
						{
							type = "LABEL",
							rect= {193,43,400,20},
							textsize=12,
							textstyle=dt_left+dt_vcenter,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_vcenter,	
							drawcolor={249,203,43,255},
							pathspeed=50,
							
							mornitor={value_channel_winrect},
					
							OnUpdate=function()
								local msg = Win_GetText("UI.gameui.qqradiodlg",value_channel_customtext);
								local len = Win_GetValue("UI.gameui.qqradiodlg",value_channel_customid);
								
								if msg~="" and len>0 then
								Win_ClearPathPoint("UI.gameui.qqradiodlg.broadcastlabel.movelabel");
								local fwinrect = Win_GetRect("UI.gameui.qqradiodlg.broadcastlabel",value_channel_winrect);
								local winrect = Win_GetRect("UI.gameui.qqradiodlg.broadcastlabel.movelabel",value_channel_winrect);
								Win_SetPos("UI.gameui.qqradiodlg.broadcastlabel.movelabel",winrect.x,fwinrect.y);
								Win_PushPathPoint("UI.gameui.qqradiodlg.broadcastlabel.movelabel",fwinrect.x-len,fwinrect.y);
								
								if winrect.x + winrect.w - 1 < fwinrect.x then
								UI.children.gameui.children.qqradiodlg.children.broadcastlabel.ShowBulletin(msg,len);
								end;
								
								end;
								
								end;
						};
					};					
				};
				
				equalizer=
				{
					type="WIDGET",
					rect={257,52,146+3,36+7},
					style=wgtstyle_renderbuffer+wgtstyle_clipself,
					custombuffer=custom_buffer_equalizer,
				};
					
				voiceslider=
				{
					type="SCROLLBAR",
					rect={65,74,169,14},
					range={1,100},					
				
					OnValueChange=function(pos)
						QQBroadcastChangeVoice(pos);
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,26,16},	
							bkimage="res/uires/newcommon/hblock.gsa",
							bkimagepos={0,0},
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
						};
					};
				};
				
				
				broadcastbtn1=
				{
					type="BUTTON",
					rect={43,165,24,24},
					bkimage="res/uires/qqradio/broadcastupbtn.gsa",
					
					OnClick=function()
						local showtype = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn1",value_channel_customtype);
						if showtype==0 then
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn1",1,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn1","res/uires/qqradio/broadcastdownbtn.gsa",value_channel_backpic);
						
						local showtype2 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn2",value_channel_customtype);
						local showtype3 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn3",value_channel_customtype);
						if showtype2 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn2.OnClick();
						elseif showtype3 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn3.OnClick();
						end;
						
						local setpetnum = GetGameVar("SetPetNum");
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", var);
						Win_SetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						local voice = GetGameVar("music");
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",voice,value_channel_customid);
						SetGameVar("music",0);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",1,value_channel_customindex);
						
						QQBroadcastPlay(0);
						--QQBroadcastShowEqualizer(1);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","res/uires/qqradio/broadcastbtneffect.gsa",value_channel_effectpic);
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("您正在收听的是综艺之声频道",150);
						
						else
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn1",0,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn1","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
						--QQBroadcastShowEqualizer(0);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","",value_channel_effectpic);
						QQBroadcastStop();
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("请选择播放频道",100);
						local voice = Win_GetValue("UI.gameui.qqradiodlg.voiceslider",value_channel_customid);
						SetGameVar("music",voice);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",10,value_channel_customindex);
						
						local setpetnum = Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",value_channel_customid);
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", setpetnum);
						Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						end;
						end;
				};
				
				broadcastbtn2=
				{
					type="BUTTON",
					rect={43,205,24,24},
					bkimage="res/uires/qqradio/broadcastupbtn.gsa",
					
					OnClick=function()
						local showtype = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn2",value_channel_customtype);						
						if showtype==0 then
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn2",1,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn2","res/uires/qqradio/broadcastdownbtn.gsa",value_channel_backpic);
						
						local showtype1 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn1",value_channel_customtype);
						local showtype3 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn3",value_channel_customtype);
						if showtype1 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn1.OnClick();
						elseif showtype3 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn3.OnClick();
						end;
						
						local voice = GetGameVar("music");
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",voice,value_channel_customid);
						SetGameVar("music",0);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",1,value_channel_customindex);
						QQBroadcastPlay(1);
						--QQBroadcastShowEqualizer(1);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","res/uires/qqradio/broadcastbtneffect.gsa",value_channel_effectpic);
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("您正在收听的是幻想之声频道",150);
						
						
						local setpetnum = GetGameVar("SetPetNum");
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", var);
						Win_SetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						else
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn2",0,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn2","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
						--QQBroadcastShowEqualizer(0);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","",value_channel_effectpic);
						QQBroadcastStop();
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("请选择播放频道",100);
						local voice = Win_GetValue("UI.gameui.qqradiodlg.voiceslider",value_channel_customid);
						SetGameVar("music",voice);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",0,value_channel_customindex);
						
						local setpetnum = Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",value_channel_customid);
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", setpetnum);
						Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						end;
						end;
				};
				
				broadcastbtn3=
				{
					type="BUTTON",
					rect={32,214,24,24},
					bkimage="res/uires/qqradio/broadcastupbtn.gsa",
					
					OnClick=function()
						local showtype = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn3",value_channel_customtype);
						if showtype==0 then
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn3",1,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn3","res/uires/qqradio/broadcastdownbtn.gsa",value_channel_backpic);
						
						local showtype1 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn1",value_channel_customtype);
						local showtype2 = Win_GetValue("UI.gameui.qqradiodlg.broadcastbtn2",value_channel_customtype);
						if showtype1 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn1.OnClick();
						elseif showtype2 == 1 then
						UI.children.gameui.children.qqradiodlg.children.broadcastbtn2.OnClick();
						end;
						
						local voice = GetGameVar("music");
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",voice,value_channel_customid);
						SetGameVar("music",0);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",1,value_channel_customindex);
						QQBroadcastPlay(2);		
						--QQBroadcastShowEqualizer(1);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","res/uires/qqradio/broadcastbtneffect.gsa",value_channel_effectpic);
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("您正在收听的是音乐娱乐频道",150);
						
						local setpetnum = GetGameVar("SetPetNum");
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", var);
						Win_SetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						else
						Win_SetValue("UI.gameui.qqradiodlg.broadcastbtn3",0,value_channel_customtype);
						Win_SetText("UI.gameui.qqradiodlg.broadcastbtn3","res/uires/qqradio/broadcastupbtn.gsa",value_channel_backpic);
						--QQBroadcastShowEqualizer(0);
						Win_SetText("UI.gameui.chatbar.qqbroadcastbtn","",value_channel_effectpic);
						QQBroadcastStop();
						--UI.children.gameui.children.qqradiodlg.OnShowBulletin("请选择播放频道",100);
						local voice = Win_GetValue("UI.gameui.qqradiodlg.voiceslider",value_channel_customid);
						SetGameVar("music",voice);
						Win_SetValue("UI.gameui.qqradiodlg.voiceslider",0,value_channel_customindex);
						
						local setpetnum = Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",value_channel_customid);
						SetGameVar("SetPetNum",setpetnum);
						Win_SetText("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.petNumtxt", setpetnum);
						Win_GetValue("UI.gameui.sysconfigdlg.displaysettab.displaysetdlg.PetNumslider",setpetnum,value_channel_customid);
						
						end;
						end;
				};
				
				menutab1=
				{
					type="TABWIN",
					rect={139,138,244,203},
					tabrect={13,20,77,34},
					tabcover="res/uires/qqradio/ZYZStab.gsa",
					tabwintype=tabwin_type_left,
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},	
					--checked=1,
					
					OnCheck=function(bcheck)
						if bcheck~=0 then
							local idx = Win_GetValue("UI.gameui.qqradiodlg.menutab1",value_channel_customindex);
							if idx~=0 then
							Win_SetValue("UI.gameui.qqradiodlg.menutab1",0,value_channel_customindex);
							QQBroadcastLoadPlaybill(0);
							local num = QQBroadcastGetPlaybillCount();
							Win_SetValue("UI.gameui.qqradiodlg.menutab1.menulist",num,value_channel_item_num);
							end;
						end;
						end;
				
					children=
					{
						menulist=
						{
							type="LISTBOX",
							rect={2,2,240,199},
							visible=1,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself,	
							extendstyle=listbox_style_itemheight_fix+listbox_style_enum_item+listbox_style_richtext+listbox_style_wheel,
							richmode=ui_richmode_all,
							dragtype=ui_drag_type_radiomenu,
							updatemute=1,
							
							itemheight=14,
							itemwidth=240,
							textsize=12,
							itemtextstyle=dt_left+dt_vcenter;
							
							--itemselback="res/uires/common/itemsel.gsa",	
							--itemselpos={0,0,0,0},	
							
							--tipwidget="UI.gameui.ScrnTooltip",
	
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={251,18,20,164},
									style=wgtstyle_vertical,					
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=16,
									pagesize=1,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
	
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
					};		
				};
				menutab2=
				{
					type="TABWIN",
					rect={139,138,244,203},
					tabrect={13,60,77,34},
					tabcover="res/uires/qqradio/HXZStab.gsa",
					tabwintype=tabwin_type_left,
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},	
					checked=0,
				
					OnCheck=function(bcheck)
						if bcheck~=0 then
							local idx = Win_GetValue("UI.gameui.qqradiodlg.menutab1",value_channel_customindex);
							if idx~=1 then
							Win_SetValue("UI.gameui.qqradiodlg.menutab1",1,value_channel_customindex);
							QQBroadcastLoadPlaybill(1);
							local num = QQBroadcastGetPlaybillCount();
							Win_SetValue("UI.gameui.qqradiodlg.menutab2.menulist",num,value_channel_item_num);
							end;
						end;
						end;

					children=
					{
						menulist=
						{
							type="LISTBOX",
							rect={2,2,240,199},
							visible=1,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself,	
							extendstyle=listbox_style_itemheight_fix+listbox_style_enum_item+listbox_style_richtext+listbox_style_wheel,
							richmode=ui_richmode_all,
							dragtype=ui_drag_type_radiomenu,
							updatemute=1,
							
							itemheight=14,
							itemwidth=240,
							textsize=12,
							itemtextstyle=dt_left+dt_vcenter;
							
							--itemselback="res/uires/common/itemsel.gsa",	
							--itemselpos={0,0,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
	
							OnValueChange=function()
								local sel=Win_GetValue("UI.gameui.qqradiodlg.menutab2.menulist",value_channel_sel);
								
								end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={251,18,20,164},
									style=wgtstyle_vertical,					
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=16,
									pagesize=1,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
	
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
					};		
				};
			
				menutab3=
				{
					type="TABWIN",
					rect={137,138,244,203},
					tabrect={15,60,77,34},
					tabcover="res/uires/qqradio/YYYLtab.gsa",
					tabwintype=tabwin_type_left,
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},	
					checked=0,
					
					OnCheck=function(bcheck)
						if bcheck~=0 then
							local idx = Win_GetValue("UI.gameui.qqradiodlg.menutab1",value_channel_customindex);
							if idx~=2 then
							Win_SetValue("UI.gameui.qqradiodlg.menutab1",2,value_channel_customindex);
							QQBroadcastLoadPlaybill(2);
							local num = QQBroadcastGetPlaybillCount();
							Win_SetValue("UI.gameui.qqradiodlg.menutab3.menulist",num,value_channel_item_num);
							end;
						end;
						end;

					children=
					{
						menulist=
						{
							type="LISTBOX",
							rect={2,2,240,201},
							visible=1,
							style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself,	
							extendstyle=listbox_style_itemheight_fix+listbox_style_enum_item+listbox_style_richtext+listbox_style_wheel,
							richmode=ui_richmode_all,
							dragtype=ui_drag_type_radiomenu,
							updatemute=1,
							
							itemheight=14,
							itemwidth=240,
							textsize=12,
							itemtextstyle=dt_left+dt_vcenter;
							
							--itemselback="res/uires/common/itemsel.gsa",	
							--itemselpos={0,0,0,0},	
							
							tipwidget="UI.gameui.ScrnTooltip",
	
							OnValueChange=function()
								local sel=Win_GetValue("UI.gameui.qqradiodlg.menutab1.menulist",value_channel_sel);
								
								end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={252,20,20,164},
									style=wgtstyle_vertical,					
									patchupleft="res/uires/newcommon/vscroll_bk.gsa",
									patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
									patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
								
									extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
									minbtnsize=16,
									pagesize=1,
									marginh=0,
									marginv=0,	
									visible=1,	
									updatemute=1,
	
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,20,26},
											patchupleft="res/uires/newcommon/vblocktop.gsa",
											patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
											patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,20,19},
											bkimage="res/uires/newcommon/downbtn.gsa",												
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
									
								};--scroll
							
							};
							
						};		
					};		
				};
			};
		};
		
		
		qqlivedlg=
		{
			type="DIALOG";
			bkimage="res/uires/qqradio/qqlivedlg.gsa";
			caption="QQ直播";
			captionrect={52,13,248,12};
			rect={48,88,368,328};
			textfont=1;
			textsize=12;
			textstyle=dt_center+dt_vcenter;
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			mornitor={{value_channel_winrect,0}},
					
			OnUpdate=function()
				UI.children.gameui.children.qqlivedlg.children.display.OnUpdate();
				end;
			
			OnSelfShow=function()
				Win_SetValue("UI.gameui.qqlivedlg",0.2,value_channel_timerspace);
				end;
			
			OnTimer=function()
				local x,y=Win_GetPos("UI.gameui.qqlivedlg.display");
				InitQQLive(x,y);
				Win_SetValue("UI.gameui.qqlivedlg",-1,value_channel_timerspace);
				end;
				
			OnSelfHide=function()
				QuitQQLive();
				end;

			children=
			{
				display=
				{
					type="WIDGET";
					bkimage="res/uires/titleui/mainlogo.gsa";
					rect={23,39,332,273};
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_qqlive,
					mornitor={{value_channel_winrect,1}},
					
					OnUpdate=function()
						local x,y=Win_GetPos("UI.gameui.qqlivedlg.display");
						SetQQLivePos(x,y);
						end;
				};
				
				closebtn = 
				{
					type = "BUTTON",
					rect={342,10,20,19};
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect={322,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("QQ直播");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
				};
			};
		};
		
		teambar=
		{
			type="WIDGET",
			rect={0,150,155,0},
			style=wgtstyle_cleanwin,
			pluslayer=0,		
			updatemute=1,
			
			bkcolor={0,0,0,33},					
			patchrect={7,8,7,6},
			patchdrawtype=patch_draw_type_scale,			
			
			patchupleft="res/uires/newcommon/patchupleft2.gsa",
			patchupright="res/uires/newcommon/patchupright2.gsa",
			patchdownleft="res/uires/newcommon/patchdownleft2.gsa",
			patchdownright="res/uires/newcommon/patchdownright2.gsa",
			
			patchupmiddle="res/uires/newcommon/patchupmiddle2.gsa",
			patchdownmiddle="res/uires/newcommon/patchdownmiddle2.gsa",
			patchleftmiddle="res/uires/newcommon/patchleftmiddle2.gsa",
			patchrightmiddle="res/uires/newcommon/patchrightmiddle2.gsa",
			
			--patchmiddle="res/uires/newcommon/patchmiddle2.gsa",
			  
			UpdateTeamBar=function()
				
				for i=1,4 do
				local btnname="UI.gameui.teambar.teambtn"..i;
					Win_ShowWidget(btnname,false);				 
				end;
				
				local teaminfo=TeamGetInfo();								
				  
				local btnidx=0;
				for i=1,teaminfo.nmember do
					local buddyinfo=TeamGetMember(i-1);
					
					if (buddyinfo.name~=g_PlayerInfo.name) and (buddyinfo.name~="") then
						btnidx=btnidx+1;
						if btnidx > 4 then
							break;
						end;
						
						local btnname="UI.gameui.teambar.teambtn"..btnidx;	
						
						for j=0, 5 do
							Win_SetValue("UI.gameui.teambar.teambtn"..btnidx..".list.teamlabel"..btnidx..j, i-1, value_channel_customtype);
						end;						
				
						--local bufinfo=Win_GetCustomBuffer(btnname);
						--bufinfo.index=i-1;
						--Win_SetCustomBuffer(btnname,bufinfo);
				
						Win_SetValue(btnname..".memberHP", buddyinfo.maxhp,value_channel_maxvalue);
						Win_SetValue(btnname..".memberHP",buddyinfo.hp,value_channel_pos);
						
						local scheme=math.floor(buddyinfo.hp*3/buddyinfo.maxhp);
						Win_SetValue(btnname..".memberHP", scheme,value_channel_framescheme);
			
						Win_SetValue(btnname..".memberMP", buddyinfo.maxmp,value_channel_maxvalue);
						Win_SetValue(btnname..".memberMP",buddyinfo.mp,value_channel_pos);
						
						if buddyinfo.lhlevel > 0 then
							Win_ShowWidget(btnname..".lhlevel",true); 
							Win_SetText(btnname..".lhlevel",buddyinfo.lhlevel);
						else
							Win_ShowWidget(btnname..".lhlevel",false); 
							Win_SetText(btnname..".lhlevel","0");
						end;

						Win_SetText(btnname,buddyinfo.name,value_channel_customname);
						
						Win_SetText(btnname..".name",buddyinfo.name,value_channel_caption);
						local prof=string.sub(buddyinfo.profname, 1, 2);
						Win_SetText(btnname..".title",prof.."/"..buddyinfo.level,value_channel_caption);

						--离线的时候显示灰色背景， 同时隐藏血条，蓝条
						if buddyinfo.isonline ~= 0 then
							Win_SetValue(btnname, 0,value_channel_framescheme);
							Win_ShowWidget(btnname..".memberHP",true);	 
							Win_ShowWidget(btnname..".memberMP",true);	 
						else
							Win_SetValue(btnname, 1,value_channel_framescheme);
							Win_ShowWidget(btnname..".memberHP",false);	 
							Win_ShowWidget(btnname..".memberMP",false);	 
						end;
				
						if buddyinfo.isonline ~= 0 and  buddyinfo.hp==0 and buddyinfo.maxhp==0 then
							Win_SetText(btnname,buddyinfo.name.." 不在该线",value_channel_tiptext);
						elseif buddyinfo.isonline ~= 0 then
							Win_SetText(btnname,(buddyinfo.name).."  "..buddyinfo.level.."级 "..buddyinfo.profname.."\n生命："..(buddyinfo.hp).."/"..(buddyinfo.maxhp).."\n法力："..(buddyinfo.mp).."/"..(buddyinfo.maxmp),value_channel_tiptext);
						else
							Win_SetText(btnname,buddyinfo.name.." 离线",value_channel_tiptext);
						end;
						
						if buddyinfo.isleader ~= 0 then
							Win_ShowWidget(btnname..".leaderlabel",true);	 
						else
							Win_ShowWidget(btnname..".leaderlabel",false);	 
						end;
				
						Win_ShowWidget(btnname,true);	 
					end;
				end;
				
				if btnidx > 0 then
					
					--if Win_IsChecked("UI.gameui.teambtn") then
					Win_ShowWidget("UI.gameui.teambar",true);	 

					local h = 10 + btnidx * 42;
					Win_SetValue("UI.gameui.teambar", h,value_channel_winrect, 3);
				else
					Win_ShowWidget("UI.gameui.teambar",false);	 
				end;
				  
				end;
				
			children=
			{
				teambtn1=
				{
					type="WIDGET",
					rect={3,5,128,24},		
					bkimage="res/uires/statusbar/teammember_bk.gsa",
					framescheme={{0},{1}},
					updatemute=1,
					visible=0;
			
					OnRClick=function()							
					       matename=Win_GetText("UI.gameui.teambar.teambtn1",value_channel_customname);		
					       UI.children.gameui.OnOpenPlayerMenu(matename);
					       end;
					       
					OnClick=function()
						matename=Win_GetText("UI.gameui.teambar.teambtn1",value_channel_customname);
						ToggleMateMic(matename);
						TeamSelectMember(matename);
						end;	  	
					
					OnDBClick=function()
						UI.children.gameui.CloseMainLabelBK();
						local matename=Win_GetText("UI.gameui.teambar.teambtn1",value_channel_customname);
						TeamDBClickMember(matename);
						end;

					children=
					{
						list=
						{
							type="WIDGETLIST",
							rect={27, 26, 102,15},
							style=wgtstyle_none,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/teamlabel1.lua"};
							children={},
						}; --list
				
						-- 职业等级
						title=
						{
							type="LABEL",
							rect={3,6,39,12},
							textsize=12,
							drawcolor={249,203,43,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
						};
						
						--名称显示
						name=
						{
							type="LABEL",
							rect={43,1,84,19},
							enable=1,		
							textsize=12,
							drawcolor={255,255,255,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
							initlayer=msgbox_layer-1;
						};
						
						memberHP=
						{
							type="PROGRESSBAR",
							rect={43,1,84,19},
							progresscover="res/uires/statusbar/teammember_hp.gsa",
							framescheme={{0},{1},{2}},
							enable=0,
						};
									
						memberMP=
						{
							type="PROGRESSBAR",
							rect={43,20,84,3},
							progresscover="res/uires/statusbar/teammember_mp.gsa",
							enable=0,
						};	
						
						leaderlabel=
						{
							type="LABEL",
							rect={2,-8,15,15},
							bkimage="res/effect/paopao_tleaderflag.gsa",
							enable=0;
							visible=0;
						};
						
						lhlevel=
						{
							type="LABEL",
							rect={128,0,25,24},
							captionrect={0,5,24,12},
							drawcolor={249,203,43,255},
							bkimage="res/uires/gameui/thlhlvlbk.gsa",
							textsize=12,
							caption="0";
						};
					};
				};
			
				teambtn2=
				{
					type="WIDGET",
					rect={3,47,128,24},		
					bkimage="res/uires/statusbar/teammember_bk.gsa",
					framescheme={{0},{1}},
					updatemute=1,
					visible=0;
			
					OnRClick=function()							
					       matename=Win_GetText("UI.gameui.teambar.teambtn2",value_channel_customname);		
					       UI.children.gameui.OnOpenPlayerMenu(matename);
					       end;
					       
					OnClick=function()
						matename=Win_GetText("UI.gameui.teambar.teambtn2",value_channel_customname);
						ToggleMateMic(matename);
						TeamSelectMember(matename);
						end;	  	
					
					OnDBClick=function()
						UI.children.gameui.CloseMainLabelBK();
						local matename=Win_GetText("UI.gameui.teambar.teambtn2",value_channel_customname);
						TeamDBClickMember(matename);
						end;

					children=
					{
						list=
						{
							type="WIDGETLIST",
							rect={27, 26, 102,15},
							style=wgtstyle_none,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/teamlabel2.lua"};
							children={},
						}; --list
						
						-- 职业等级
						title=
						{
							type="LABEL",
							rect={3,6,39,12},
							textsize=12,
							drawcolor={249,203,43,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
						};
						
						--名称显示
						name=
						{
							type="LABEL",
							rect={43,1,84,19},
							enable=1,		
							textsize=12,
							drawcolor={255,255,255,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
							initlayer=msgbox_layer-1;
						};
						
						memberHP=
						{
							type="PROGRESSBAR",
							rect={43,1,84,19},
							progresscover="res/uires/statusbar/teammember_hp.gsa",
							framescheme={{0},{1},{2}},
							enable=0,
						};
									
						memberMP=
						{
							type="PROGRESSBAR",
							rect={43,20,84,3},
							progresscover="res/uires/statusbar/teammember_mp.gsa",
							enable=0,
						};			
						leaderlabel=
						{
							type="LABEL",
							rect={2,-8,15,15},
							bkimage="res/effect/paopao_tleaderflag.gsa",
							enable=0;
							visible=0;
						};
						
						lhlevel=
						{
							type="LABEL",
							rect={128,0,25,24},
							captionrect={0,5,24,12},
							drawcolor={249,203,43,255},
							bkimage="res/uires/gameui/thlhlvlbk.gsa",
							textsize=12,
							caption="0";
						};
					};
				};
			
			
				teambtn3=
				{
					type="WIDGET",
					rect={3,89,128,24},		
					bkimage="res/uires/statusbar/teammember_bk.gsa",
					framescheme={{0},{1}},
					updatemute=1,
					visible=0;
			
					OnRClick=function()							
					       matename=Win_GetText("UI.gameui.teambar.teambtn3",value_channel_customname);		
					       UI.children.gameui.OnOpenPlayerMenu(matename);
					       end;
					       
					OnClick=function()
						matename=Win_GetText("UI.gameui.teambar.teambtn3",value_channel_customname);
						ToggleMateMic(matename);
						TeamSelectMember(matename);
						end;	  	
					
					OnDBClick=function()
						UI.children.gameui.CloseMainLabelBK();
						local matename=Win_GetText("UI.gameui.teambar.teambtn3",value_channel_customname);
						TeamDBClickMember(matename);
						end;

					children=
					{
						list=
						{
							type="WIDGETLIST",
							rect={27, 26, 102,15},
							style=wgtstyle_none,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/teamlabel3.lua"};
							children={},
						}; --list
						
						-- 职业等级
						title=
						{
							type="LABEL",
							rect={3,6,39,12},
							textsize=12,
							drawcolor={249,203,43,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
						};
						
						--名称显示
						name=
						{
							type="LABEL",
							rect={43,1,84,19},
							enable=1,		
							textsize=12,
							drawcolor={255,255,255,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
							initlayer=msgbox_layer-1;
						};
						
						memberHP=
						{
							type="PROGRESSBAR",
							rect={43,1,84,19},
							progresscover="res/uires/statusbar/teammember_hp.gsa",
							framescheme={{0},{1},{2}},
							enable=0,
						};
									
						memberMP=
						{
							type="PROGRESSBAR",
							rect={43,20,84,3},
							progresscover="res/uires/statusbar/teammember_mp.gsa",
							enable=0,
						};			
						leaderlabel=
						{
							type="LABEL",
							rect={2,-8,15,15},
							bkimage="res/effect/paopao_tleaderflag.gsa",
							enable=0;
							visible=0;
						};
						
						lhlevel=
						{
							type="LABEL",
							rect={128,0,25,24},
							captionrect={0,5,24,12},
							drawcolor={249,203,43,255},
							bkimage="res/uires/gameui/thlhlvlbk.gsa",
							textsize=12,
							caption="0";
						};
					};
				};
			
			
				teambtn4=
				{
					type="WIDGET",
					rect={3,136,128,24},		
					bkimage="res/uires/statusbar/teammember_bk.gsa",
					framescheme={{0},{1}},
					updatemute=1,
					visible=0;
			
					OnRClick=function()							
					       matename=Win_GetText("UI.gameui.teambar.teambtn4",value_channel_customname);		
					       UI.children.gameui.OnOpenPlayerMenu(matename);
					       end;
					       
					OnClick=function()
						matename=Win_GetText("UI.gameui.teambar.teambtn4",value_channel_customname);
						ToggleMateMic(matename);
						TeamSelectMember(matename);
						end;	  	
					
					OnDBClick=function()
						UI.children.gameui.CloseMainLabelBK();
						local matename=Win_GetText("UI.gameui.teambar.teambtn4",value_channel_customname);
						TeamDBClickMember(matename);
						end;

					children=
					{
						list=
						{
							type="WIDGETLIST",
							rect={27, 26, 102,15},
							style=wgtstyle_none,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/teamlabel4.lua"};
							children={},
						}; --list
						
						-- 职业等级
						title=
						{
							type="LABEL",
							rect={3,6,39,12},
							textsize=12,
							drawcolor={249,203,43,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
						};
						
						--名称显示
						name=
						{
							type="LABEL",
							rect={43,1,84,19},
							enable=1,		
							textsize=12,
							drawcolor={255,255,255,255},
							textstyle=dt_center+dt_vcenter,
							enable=0;
							initlayer=msgbox_layer-1;
						};
						
						memberHP=
						{
							type="PROGRESSBAR",
							rect={43,1,84,19},
							progresscover="res/uires/statusbar/teammember_hp.gsa",
							framescheme={{0},{1},{2}},
							enable=0,
						};
									
						memberMP=
						{
							type="PROGRESSBAR",
							rect={43,20,84,3},
							progresscover="res/uires/statusbar/teammember_mp.gsa",
							enable=0,
						};					
						leaderlabel=
						{
							type="LABEL",
							rect={2,-8,15,15},
							bkimage="res/effect/paopao_tleaderflag.gsa",
							enable=0;
							visible=0;
						};
						
						lhlevel=
						{
							type="LABEL",
							rect={128,0,25,24},
							captionrect={0,5,24,12},
							drawcolor={249,203,43,255},
							bkimage="res/uires/gameui/thlhlvlbk.gsa",
							textsize=12,
							caption="0";
						};
					};
				};
			};
		};
		
		lhexperiencebar=
		{
			type="PROGRESSBAR",
			rect={0,0,800,8},
			bkimage="res/uires/statusbar/lhexpbarbk.gsa",
			progresscover="res/uires/statusbar/lhexpbar.gsa",
			pluslayer=0;
			initlayer=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_bottom_in,
			framescheme={{0},{1},{2}},
			marginv=-10,
			
			children=
			{
				effect=
				{
					type="WIDGET",
					rect={0,0,800,8},
					bkimage="res/uires/statusbar/expeffect.gsa",
					visible=0,
					framespeed=0.3;
					
					OnSelfShow=function()
						if GetScreenType() == 1 then
							Win_SetText("UI.gameui.lhexperiencebar.effect","res/uires/statusbar/expeffect1024x768.gsa",value_channel_effectpic);
						elseif GetScreenType() == 2 then
							Win_SetText("UI.gameui.lhexperiencebar.effect","res/uires/statusbar/expeffect1280x800.gsa",value_channel_effectpic);
						else
							Win_SetText("UI.gameui.lhexperiencebar.effect","res/uires/statusbar/expeffect800x600.gsa",value_channel_effectpic);
						end;
						Win_SetValue("UI.gameui.lhexperiencebar.effect",newtask_showtime,value_channel_timerspace);
					end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.lhexperiencebar.effect",-1,value_channel_timerspace);
						Win_ShowWidget("UI.gameui.lhexperiencebar.effect",false);
					end;
				};
			};
		};
		
		experiencebar=
		{
			type="PROGRESSBAR",
			rect={0,0,800,8},
			bkimage="res/uires/statusbar/expbarbk.gsa",
			progresscover="res/uires/statusbar/expbar.gsa",
			pluslayer=0;
			initlayer=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_bottom_in,
			framescheme={{0},{1},{2}},
			
			children=
			{
				effect=
				{
					type="WIDGET",
					rect={0,0,800,8},
					bkimage="res/uires/statusbar/expeffect.gsa",
					visible=0,
					framespeed=0.3;
					
					OnSelfShow=function()
						if GetScreenType() == 1 then
							Win_SetText("UI.gameui.experiencebar.effect","res/uires/statusbar/expeffect1024x768.gsa",value_channel_effectpic);
						elseif GetScreenType() == 2 then
							Win_SetText("UI.gameui.experiencebar.effect","res/uires/statusbar/expeffect1280x800.gsa",value_channel_effectpic);
						else
							Win_SetText("UI.gameui.experiencebar.effect","res/uires/statusbar/expeffect800x600.gsa",value_channel_effectpic);
						end;
						Win_SetValue("UI.gameui.experiencebar.effect",newtask_showtime,value_channel_timerspace);
					end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.experiencebar.effect",-1,value_channel_timerspace);
						Win_ShowWidget("UI.gameui.experiencebar.effect",false);
					end;
				};
			};
		};
		
		--pipo712 
		hidestatusbarbtn=
		{
			type="CHECK",
			rect={0,67,20,19},
			bkimage="res/uires/common/minize_rightleft_btn.gsa",
			framescheme={{4,4,5,5,6,6,7,7},{0,0,1,1,2,2,3,3},},
			tiptext="隐藏头像",
			initlayer=1,
			OnClick=function()
				if Win_IsVisible("UI.gameui.statusbar") then
					Win_ShowWidget("UI.gameui.statusbar", false);
					Win_ShowWidget("UI.gameui.ministatusbar", true);
					Win_SetText("UI.gameui.hidestatusbarbtn","显示头像",value_channel_tiptext);
			
					Win_SetPos("UI.gameui.selflabelbar",27,42);
					Win_SetPos("UI.gameui.timebar", 112, 67);
				else
					Win_ShowWidget("UI.gameui.statusbar", true);
					Win_ShowWidget("UI.gameui.ministatusbar", false);
					Win_SetText("UI.gameui.hidestatusbarbtn","隐藏头像",value_channel_tiptext);
					
					Win_SetPos("UI.gameui.selflabelbar",101,48);
					Win_SetPos("UI.gameui.timebar", 173, 67);					
				end;
			end;
		};
		
		teambtn=
		{
			type="CHECK",
			rect={0,128,20,19},
			bkimage="res/uires/common/minize_rightleft_btn.gsa",
			framescheme={{0,0,1,1,2,2,3,3},{4,4,5,5,6,6,7,7}},
			tiptext="切换队伍显示",
			visible=0,
			
			OnTimer=function()
				Win_SetValue("UI.gameui.teambtn",-1,value_channel_timerspace);
				Win_ShowWidget("UI.gameui.teambtn.noticelabel",false);		
				end;
			
			OnClick=function()
				Win_SetValue("UI.gameui.teambtn",-1,value_channel_timerspace);
				Win_ShowWidget("UI.gameui.teambtn.noticelabel",false);		
				end;
			
			OnCheck=function(bcheck)
				if bcheck==1 then
				Win_ClearPathPoint("UI.gameui.teambar");
				Win_PushPathPoint("UI.gameui.teambar",0,150);
				else
				Win_ClearPathPoint("UI.gameui.teambar");
				Win_PushPathPoint("UI.gameui.teambar",-180,150);
				end;
				end;				
			
			children=
			{
				noticelabel=
				{
					type="LABEL",
					rect={0,0,24,24},
					effectpic="res/uires/statusbar/teambtn.gsa",					
					enable=0,
					visible=0,
					updatemute=1,
				};
				
				voicesetbtn=
				{
					type="BUTTON",
					rect={24,0,24,24},
					bkimage="res/uires/teamdlg/voicesetbtn.gsa",
					tiptext="激活队伍语音聊天",
					visible=0,		
					updatemute=1,
					
					--关闭语音系统
					enable=0,
					
					OnClick=function()
						Win_ToggleWidget("UI.gameui.voicesetdlg",1);
						end;
				};
				
			};
		};
		
		ministatusbar=
		{
			type="WIDGET",
			rect={0,0,100,40},
			clientrect={22,12,45,45},			
			bkimage="res/uires/statusbar/ministatusbarbk.gsa",	
			visible=0,
			
			children=
			{
				nameicon=
				{
					type="LABEL",
					rect={12,6,84,12},
					textsize=12,
					drawcolor={249,203,43,255},
				};
					
				progbarHP=
				{
					type="PROGRESSBAR",
					rect={5,23,99,8},
					progresscover="res/uires/statusbar/minihp.gsa",
					progresslayer="res/uires/statusbar/minihplayer.gsa",
					progressaimer="res/uires/common/aimer.gsa",
					style=wgtstyle_clipself;
					framescheme={{0},{1},{2}},
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					updatemute=1,
				};
				
				progbarMP=
				{
					type="PROGRESSBAR",
					rect={5,33,99,8},
					progresscover="res/uires/statusbar/minimp.gsa",
					progresslayer="res/uires/statusbar/minimplayer.gsa",
					progressaimer="res/uires/common/aimer.gsa",
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					style=wgtstyle_clipself;
					updatemute=1,
				};
				
				--幻神按钮
				godbar=
				{
					type="WIDGET",
					rect={20,63,100,38},		
					bkimage="res/uires/statusbar/minipetbar.gsa",
					updatemute=1,
					enable=1,
					
					children=
					{
						--名称显示
						godnameicon=
						{
							type="LABEL",
							rect={14,5,72,12},
							enable=1,		
							textsize=12,
							drawcolor={249,203,43,255},
						};
						
						godbarHP=
						{
							type="PROGRESSBAR",
							rect={4,18,87,5},
							progresscover="res/uires/statusbar/minipethp.gsa",
							framescheme={{0},{1},{2}},
							enable=1,
						};
									
						godbarMP=
						{
							type="PROGRESSBAR",
							rect={4,25,87,5},
							progresscover="res/uires/statusbar/minipetmp.gsa",
							enable=1,
						};
					};
				};
			};
		};
		
		statusbar=
		{
			type="WIDGET",
			rect={0,0,171,81},
			clientrect={10,12,45,45},			
			patchupleft="res/uires/statusbar/statusbarbk.gsa",	
			initlayer=0;
			pluslayer=0;
			style=wgtstyle_alphawin+wgtstyle_renderbuffer,
			custombuffer=custom_buffer_head,
			customtype=0,	

			DisablePkmodeicon=function()
				Win_EnableWidget("UI.gameui.statusbar.pkmodeicon",false);
			end;
			
			EnablePkmodeicon=function()
				Win_EnableWidget("UI.gameui.statusbar.pkmodeicon",true);
			end;
			
			children=
			{	
				--耐力显示
				staminaicon=
				{
					type="WIDGET",
					rect={20,10,56,56},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_stamina,
					winshape={{ shape_type_circle,1,0,0,56,56},{ shape_type_circle,0,5,5,46,46},{ shape_type_triangle,0,0,0,56,56,0,56}},					
					updatemute=1,
					visible=0,
				};

				--念力显示
				manaicon=
				{
					type="WIDGET",
					rect={20,10,56,56},
					winshape={{ shape_type_circle,1,0,0,56,56},{ shape_type_circle,0,5,5,46,46},{ shape_type_triangle,0,0,0,56,0,56,56}},
					updatemute=1,
					visible=0,
				};

				--疲劳度
				tireicon=
				{
					type="WIDGET",
					rect={20,10,56,56},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_stamina,
					winshape={{ shape_type_circle,1,0,0,56,56},{ shape_type_circle,0,5,5,46,46}},
					updatemute=1,
					visible=0,
					enable=0,
				};
				
				lhlevel=
				{
					type="LABEL",
					rect={87,0,26,26},
					captionrect={0,3,24,12},
					drawcolor={249,203,43,255},
					bkimage="res/uires/gameui/mylhlvlbk.gsa",
					textsize=12,
					caption="0";
					tiptext="轮回等级",
				};
				
				--等级显示
				levelicon=
				{
					type="LABEL",
					rect={-2,0,20,16},
					caption="0",
					captionrect={0,2,20,12},
					textsize=12,
					drawcolor={249,203,43,255},
					tiptext="等级",
					updatemute=1,
				};
				

				--状态显示
				statusicon=
				{
					type="WIDGET",
					rect={18,62,16,16},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_charstate,
					enable=0,		
					updatemute=1,
				};
				
				--头像显示
				headicon=
				{
					type="WIDGET",
					rect={12,15,45,45},
					updatemute=1,
					
					OnMouseIn=function()
						local pinginfo=GetPingInfo();
						Win_SetText("UI.gameui.statusbar.headicon",pinginfo,value_channel_tiptext);
						end;
					
					OnClick=function()
						local iRet = ReturnViewport();
						if iRet == 1 then
							return;
						end;
						local ret = CheckUIRight();
						if ret == 0 then
							return;
						end;
						
						if not CheckUseSkillOnOneself() then
						Win_ToggleWidget("UI.gameui.equipdlg",1);
						Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",false);
						Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",false);
						--UI.children.gameui.UpdateAwakeEquipDlg();
						--OpenAchieveDlg(0);
						end;
						end;	
					
					OnRClick=function()
						SelectPlayerByName(g_PlayerInfo.name);
						--UI.children.gameui.OnOpenMainPlayerMenu();
						end;
				};	
				--高光显示圈
				headlgithicon=
				{
					type="WIDGET",
					rect={7,-5,57,70},
					bkimage="res/uires/statusbar/headlight.gsa",
					enable=0,		
					updatemute=1,
					initlayer=1;
					visible=1;
				};
				--名称显示
				nameicon=
				{
					type="LABEL",
					rect={84,23,84,12},
					textsize=12,
					drawcolor={249,203,43,255},
					updatemute=1,
					
					OnRClick=function()
						UI.children.gameui.OnOpenMainPlayerMenu();
					end;
					
					BeginEffect=function(effectid)
						if effectid == 0 then
						Win_SetText("UI.gameui.statusbar.nameicon","res/uires/statusbar/namelabeleffectgray.gsa",value_channel_effectpic);
						else
						Win_SetText("UI.gameui.statusbar.nameicon","res/uires/statusbar/namelabeleffect.gsa",value_channel_effectpic);
						end;
						
						Win_SetValue("UI.gameui.statusbar.nameicon",-4,value_channel_effectpicpos,0);
						Win_SetValue("UI.gameui.statusbar.nameicon",-4,value_channel_effectpicpos,1);
						Win_SetValue("UI.gameui.statusbar.nameicon",0.1,value_channel_framespeed);
						Win_SetValue("UI.gameui.statusbar.nameicon",effectid+1,value_channel_customtype);
						end;
					
					EndEffect=function()
						Win_SetText("UI.gameui.statusbar.nameicon","",value_channel_effectpic);
						Win_SetValue("UI.gameui.statusbar.nameicon",0,value_channel_customtype);
						end;
				};
				

				--神医降临按钮
				probeicon=
				{	
					type="BUTTON",
					rect={18,66,32,32},
					bkimage="res/uires/gameui/probeicon.gsa",
					clientrect={0,0,32,32},
					tiptext="神医降临(无奖励)",
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_probeicon,
					winshape={{ shape_type_circle,1,0,0,32,32}},
					updatemute=1,
					
					OnClick=function()
 							RequestAuth();
						end;
				};
				
				--pk模式切换按钮
				pkmodeicon=
				{	
					type="BUTTON",
					rect={43,46,32,32},
					bkimage="",
					clientrect={0,0,32,32},
					tiptext="pk模式切换",
					winshape={{ shape_type_circle,1,0,0,32,32}},
					updatemute=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.pkmodedlg", true);
					end;
				};
				
				stoplevelbtn=
				{
					type="BUTTON",
					rect={147,3,18,15};
					bkimage="res/uires/sketchmap/stoplevel.gsa",
					tiptext="点击可以开启停级功能，需要满足VIP3和35级",
					updatemute=1,
							
					OnClick=function()
						Win_ShowMsgBox("您是否确定停级?","提示",ui_msgid_yesno,"UI.gameui.statusbar.stoplevelbtn");
					end;
					
					OnMsgBoxOk=function()
						StopLevel();
					end;
				};
				
				startlevelbtn=
				{
					type="BUTTON",
					rect={121,3,18,15};
					bkimage="res/uires/sketchmap/startlevel.gsa",
					tiptext="点击可以关闭停级功能，关闭停级延迟生效",
					updatemute=1,
							
					OnClick=function()
						Win_ShowMsgBox("您是否确定解除停级?","提示",ui_msgid_yesno,"UI.gameui.statusbar.startlevelbtn");
					end;
					
					OnMsgBoxOk=function()
						StartLevel();
					end;
				};
				
				levelstatus=
				{
					type="LABEL",
					rect={169,5,84,12},
					textsize=12,
					drawcolor={255,0,0,255},
					updatemute=1,
					visible=0,
				};
				
				--阵营显示[joeyxiong 03/10/2011]
				campicon=
				{	
					type="WIDGET",
					rect={0,44,32,32},
					tiptext="阵营",
					bkimage="res/uires/statusbar/campbk.gsa",
					framescheme={{0},{1},{2}},
					enable=1,		
					updatemute=1,
					visible=1;
					
					OnTimer=function()
						Win_SetText("UI.gameui.statusbar.campicon", "", value_channel_effectpic);
						Win_SetValue("UI.gameui.statusbar.campicon", 0.0, value_channel_timerspace);
					end;
				};

				--宠物按钮
				godbar=
				{
					type="WIDGET",
					rect={48,61,137,48},		
					bkimage="res/uires/petdlg/petbar.gsa",
					style=wgtstyle_static,
					updatemute=1,
					
					children=
					{
						godbtn=
						{	
							type="BUTTON",
							rect={7,12,28,28},
							style=wgtstyle_renderbuffer,
							custombuffer=custom_buffer_godhead,
							tiptext="查看幻神信息",
							
							OnClick=function()
								UI.children.gameui.OnAccel_GodDlg();
								end;
						};
						
						--名称显示
						godnameicon=
						{
							type="LABEL",
							rect={53,13,72,12},
							enable=1,		
							textsize=12,
							drawcolor={249,203,43,255},
						};
						
						godbarHP=
						{
							type="PROGRESSBAR",
							rect={48,27,81,5},
							progresscover="res/uires/petdlg/pethp.gsa",
							framescheme={{0},{1},{2}},
							enable=1,
						};
									
						godbarMP=
						{
							type="PROGRESSBAR",
							rect={46,34,80,5},
							progresscover="res/uires/petdlg/petmp.gsa",
							enable=1,
						};
						
						godlabellist=
						{
							type="WIDGETLIST",
							rect={34, 45, 102,15},
							style=wgtstyle_alphawin,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/selfgodlabel.lua"};
							children={},
						};
						
						awakebtn=
						{	
							type="BUTTON",
							rect={137,9,21,20},
							bkimage="res/uires/statusbar/revivegodbtn.gsa",
							tiptext="唤醒最近沉睡的幻神",
							visible=0,
							
							OnClick=function()
								Win_ShowMsgBox("您是否确定唤醒最近沉睡的幻神?","提示",ui_msgid_yesno,"UI.gameui.statusbar.godbar.awakebtn");
							end;
							
							OnMsgBoxOk=function()
								AwakeGod();
							end;
						};
					};
				};
				
				fetchphonebtn=
				{
					type = "BUTTON",
					rect={13,57,26,26};
					bkimage="res/uires/gameui/fetchphonebtn.gsa",
					framescheme={{0,0,1,1,1,1,0,0},{0,0,0,1,0,1,0,0}},
					querytype=ui_query_type_voice,
					tiptext="抢话筒 快捷键:Insert",
					updatemute=1,
					
					--关闭语音系统
					enable=0,
					visible=0,
					OnClick=function()
						RequireMic();
						end;
					
				};
				
				progbarHP=
				{
					type="PROGRESSBAR",
					rect={80,38, 91,8},
					progresscover="res/uires/statusbar/hpbar.gsa",
					progresslayer="res/uires/statusbar/hplayer.gsa",
					progressaimer="res/uires/common/aimer.gsa",
					style=wgtstyle_clipself;
					framescheme={{0},{1},{2}},
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					updatemute=1,
				};
				
				progbarMP=
				{
					type="PROGRESSBAR",
					rect={68,48,100,8},
					progresscover="res/uires/statusbar/mpbar.gsa",
					progresslayer="res/uires/statusbar/mplayer.gsa",
					progressaimer="res/uires/common/aimer.gsa",
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					style=wgtstyle_clipself;
					updatemute=1,
				};
			};--children
		};--statusbar
		
		--pk模式
		pkmodedlg=
		{
			type="DIALOG",
			rect = {69,63,98,108},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_popup+wgtstyle_topmost,
			
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/newcommon/patchupleft.gsa",
			patchupright="res/uires/newcommon/patchupright.gsa",
			patchdownleft="res/uires/newcommon/patchdownleft.gsa",
			patchdownright="res/uires/newcommon/patchdownright.gsa",
			
			patchmiddle="res/uires/newcommon/patchmiddle.gsa",
			
			patchupmiddle="res/uires/newcommon/patchupmiddle.gsa",
			patchdownmiddle="res/uires/newcommon/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/newcommon/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/newcommon/patchrightmiddle.gsa",
			
			OnSelfShow=function()
				local pkmode = GetPkMode();
				if pkmode == 0 then
					Win_SelectSelf("UI.gameui.pkmodedlg.NoPKcheck");
				elseif pkmode == 2 then
					Win_SelectSelf("UI.gameui.pkmodedlg.TeamPKcheck");
				elseif pkmode == 3 then
					Win_SelectSelf("UI.gameui.pkmodedlg.FamilyPKcheck");
				elseif pkmode == 4 then
					Win_SelectSelf("UI.gameui.pkmodedlg.ColorPKcheck");
				elseif pkmode == 5 then
					Win_SelectSelf("UI.gameui.pkmodedlg.JunTuanPKcheck");
				elseif pkmode == 6 then
					Win_SelectSelf("UI.gameui.pkmodedlg.FieldPKcheck");
				end;
			end;
					
			children=
			{
				NoPKcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="和平模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
					
					OnClick=function()
						SetPkMode(0);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
						      
				};
				
				TeamPKcheck=
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="队伍模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						SetPkMode(2);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
				};
				
				FamilyPKcheck= 
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="家族模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						SetPkMode(3);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
				};
				
				ColorPKcheck= 
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,68,90,16};
					captionrect={24,2,54,12},
					caption="黑白模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=3,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						SetPkMode(4);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
				};
				
				JunTuanPKcheck= 
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,88,90,16};
					captionrect={24,2,54,12},
					caption="军团模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=4,
					extendstyle=ui_btn_style_radio,		
					updatemute=1,
						
					OnClick=function()
						SetPkMode(5);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
				};
				
				FieldPKcheck= 
				{
					type="CHECK";
					bkimage="res/uires/newcommon/radiobtn.gsa";
					bkimagepos={4,0},
					rect={4,108,90,16};
					captionrect={24,2,54,12},
					caption="领地模式",
					drawcolor={229,183,83,255},
					textsize=12,
					groupid=0,
					groupstop=5,
					extendstyle=ui_btn_style_none,		
					updatemute=1,
					enable=0,
					visible=0,
						
					OnClick=function()
						SetPkMode(6);
						Win_ShowWidget("UI.gameui.pkmodedlg", false);
					end;
				};
			};
		};
		
		petchangebtn=
		{
			type="BUTTON",
			rect={5,94,20,20},
			bkimage="res/uires/petdlg/petchange.gsa",	
			style=wgtstyle_alphawin,
			visible = true;
			
			OnClick=function()
				PetChangeSprite();
			end;
			
			children=
			{
			},
		};
		
		taozhuangchangebtn=
		{
			type="BUTTON",
			rect={0,0,20,20},
			bkimage="res/uires/petdlg/petchange.gsa",	
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_left_in+alignstyle_top_in,	
			marginv = 250;
			visible = 0;
			
			OnClick=function()
				TaoZhuangChange();
			end;			
		};
		
		petstatusbar=
		{
			type="WIDGET",
			rect={16,96,44,48},
			clientrect={0,2,45,45},			
			patchupleft="res/uires/goddlg/minipetbk.gsa",	
			initlayer=0;
			pluslayer=0;
			style=wgtstyle_renderbuffer,
			custombuffer=custom_buffer_pethead,
			customtype=0,			
			effectpicpos={5,7},
			
			OnClick=function()
				--测试入口
				--UI.children.gameui.OnShowTreasureChestDlg();	
				--UI.children.gameui.OnUpdateForgeDlg(1, 1, 100, 1, 500, 1, 1);
				--UI.children.gameui.OnShowBlessDlg();
				
				UI.children.gameui.OnAccel_PetDlg();
				Win_SetText("UI.gameui.petstatusbar.peteffect","",value_channel_effectpic);
				Win_SetValue("UI.gameui.petstatusbar.peteffect",-1,value_channel_timerspace);
			end;
				
				
			children=
			{	
				peteffect=
				{
					type="WIDGET",
					rect={0,0,44,48},
					initlayer=5;
					effectpicpos={5,7},
					enable=0;
					
					OnShowEffect=function()
						Win_SetText("UI.gameui.petstatusbar.peteffect","res/uires/petdlg/petbtneffect.gsa",value_channel_effectpic);
						Win_SetValue("UI.gameui.petstatusbar.peteffect",newtask_showtime,value_channel_timerspace);
						end;
						
					OnCloseEffect=function()
						Win_SetText("UI.gameui.petstatusbar.peteffect","",value_channel_effectpic);
						Win_SetValue("UI.gameui.petstatusbar.peteffect",-1,value_channel_timerspace);
						end;
		
					OnTimer=function()
						Win_SetText("UI.gameui.petstatusbar.peteffect","",value_channel_effectpic);
						Win_SetValue("UI.gameui.petstatusbar.peteffect",-1,value_channel_timerspace);
						end;
				};
				
				petbarHP=
				{
					type="PROGRESSBAR",
					rect={22,5,19,38},
					progresscover="res/uires/goddlg/minipethp.gsa",
					framescheme={{0},{1},{2}},
					initlayer=0;
					enable=0,
				};
							
				petbarMP=
				{
					type="PROGRESSBAR",
					rect={3,5,19,38},
					progresscover="res/uires/goddlg/minipetmp.gsa",
					initlayer=0;
					enable=0,
				};
				
				petcurskill=
				{
					type="WIDGET",
					rect={44,29,15,15},
					groupid=0,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_petcurskill,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
				};				
			};
		};
		
		targetbar=
		{
			type="WIDGET",
			rect={193,18,134,33},
			bkimage="res/uires/gameui/targetbar.gsa",	
			pluslayer=0;
			style=wgtstyle_alphawin,
			alphaspeed=0.02,
			alphafactor=0.0,
			visible=0,
			framescheme={{0},{1}},
			updatemute=1,
			
			OnSelfShow=function()
				GoalExceptInit();
			end;
			OnSelfHide=function()
				GoalExceptDeInit();
			end;
			
			children=
			{
				targetlabellist=
				{
					type="WIDGETLIST",
					rect={29, 34, 102,15},
					style=wgtstyle_none,
					itemmarginv=0,
					itemmarginh=1,
					updatemute=1,
					initlayer=0,
					pluslayer=0,
			
					template={"res/uires/targetlabel.lua"};
					children={},
				}; --list
		
				SysInputTip=
				{
					type = "LABEL",
					rect={124,-10,24,33},
					coverpic="res/uires/gameui/ballarrow.gsa",
					coverpicpos={-13,10},
					drawcolor={0,0,0,255},
					visible=0,			
					maxwidth=200,
					minheight=12,
					sizeable=1,								
					marginh=12,
					marginv=6,
					textsize=12,
					alphaspeed=0.1,	
					richmode=ui_richmode_all,
					initlayer=systooltip_layer,
					edgecheck=edge_check_show+edge_check_auto,
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/gameui/ballupleft.gsa",
					patchupright="res/uires/gameui/ballupright.gsa",
					patchdownleft="res/uires/gameui/balldownleft.gsa",
					patchdownright="res/uires/gameui/balldownright.gsa",
					
					patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
					patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
					patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
					patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
					
					patchmiddle="res/uires/gameui/ballmiddle.gsa",
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.targetbar.SysInputTip",false);
						end;
					
					OnSelfShow=function()
						Win_SetValue("UI.gameui.targetbar.SysInputTip",-1,value_channel_timerspace);
						end;	
						
					OnClick=function()
						Win_ShowWidget("UI.gameui.targetbar.SysInputTip",false);
						end;
				};
				
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_petcapturelevel,
						offsetx=0,
						offsety=0,
					},
				};
				
				--名称显示
				nameicon=
				{
					type="LABEL",
					rect={33,6,94,12},
					textsize=12,
					drawcolor={255,255,0,255},
					linkcolor={255,255,0,255},
					bkcolor={255,0,0,255},
					richmode=ui_richmode_all,
					style=wgtstyle_clipself,
				};
				
				lhlevel=
				{
					type="LABEL",
					rect={133,3,26,26},
					captionrect={0,6,24,12},
					drawcolor={249,203,43,255},
					bkimage="res/uires/gameui/lhlvlbk.gsa",
					textsize=12,
					caption="0";
					tiptext="轮回等级",
				};
				
				viplevel=
				{
					type="WIDGET",
					rect={159,18,15,15},
					groupid=0,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_viplevel,
					style=wgtstyle_renderitem,	
				};
				
				--等级显示
				levelicon=
				{
					type="LABEL",
					rect={3,9,20,20},
					caption="0",
					captionrect={0,4,20,12},
					textsize=12,
					drawcolor={249,203,43,255},
					tiptext="等级",
				};
				
				progbarHP=
				{
					type="PROGRESSBAR",
					rect={31,21,97,8},
					progresscover="res/uires/gameui/targethp.gsa",
					progresslayer="res/uires/statusbar/targetlayer.gsa",
					progressaimer="res/uires/common/aimer.gsa",
					style=wgtstyle_clipself;
					framescheme={{0},{1},{2}},
					range={0,100},
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					enable=1,
				};

				petbar=
				{
					type="WIDGET",
					rect={23,50,135,36},
					bkimage="res/uires/goddlg/targetpetbk.gsa",	
					pluslayer=0;
					style=wgtstyle_alphawin,
					visible=1,
					framescheme={{1},{0}},
					updatemute=1,
					enable=1;
					
					children=
					{
						--名称显示
						nameicon=
						{
							type="LABEL",
							rect={32,10,94,12},
							textsize=12,
							drawcolor={98,176,195,255},
							style=wgtstyle_clipself,
						};
						
						--等级显示
						levelicon=
						{
							type="LABEL",
							rect={3,13,20,20},
							caption="0",
							captionrect={0,4,20,12},
							textsize=12,
							drawcolor={98,176,195,255},
							tiptext="等级",
						};

						petcurskill=
						{
							type="WIDGET",
							rect={133,18,15,15},
							groupid=0,
							groupstop=0,
							dragindex=0,
							dragtype=ui_drag_type_otherpetcurskill,
							style=wgtstyle_renderitem,
							tipwidget="UI.gameui.ScrnTooltip",
						};
					};
				};		

				godbar=
				{
					type="WIDGET",
					rect={23,50,135,36},
					bkimage="res/uires/goddlg/targetgodbk.gsa",	
					pluslayer=0;
					style=wgtstyle_alphawin,
					visible=1,
					framescheme={{1},{0}},
					updatemute=1,
					enable=1;
					
					children=
					{
						--名称显示
						nameicon=
						{
							type="LABEL",
							rect={33,9,94,12},
							textsize=12,
							drawcolor={98,176,195,255},
							style=wgtstyle_clipself,
						};
						
						--等级显示
						levelicon=
						{
							type="LABEL",
							rect={2,13,20,20},
							caption="0",
							captionrect={0,4,20,12},
							textsize=12,
							drawcolor={98,176,195,255},
							tiptext="幻神等级",
						};

						godbarHP=
						{
							type="PROGRESSBAR",
							rect={30,24,100,8},
							progresscover="res/uires/gameui/targethp.gsa",
							framescheme={{0},{1},{2}},
							enable=1,
						};						

						godlabellist=
						{
							type="WIDGETLIST",
							rect={29, 35, 102,15},
							style=wgtstyle_alphawin,
							itemmarginv=0,
							itemmarginh=1,
							updatemute=1,
							initlayer=0,
							pluslayer=0,
					
							template={"res/uires/targetgodlabel.lua"};
							children={},
						};
						
						peticon=
						{
							type="WIDGET",
							rect={135,7,26,28},
							bkimage="res/uires/goddlg/peticon.gsa",	
							initlayer=0,
							pluslayer=0,
						};
						--等级显示
						petlevelicon=
						{
							type="LABEL",
							rect={138,11,20,20},
							caption="0",
							captionrect={0,4,20,12},
							textsize=12,
							drawcolor={98,176,195,255},
							tiptext="宠物等级",
							initlayer=1,
						};						
					};
				};				
			};
		};
		
		ctrlbar=
		{
			
			type="DIALOG",
			rect={0,0,1,1},
			style=wgtstyle_alphawin,	

			OnInitUpdate=function()
				Win_AlignWidget("UI.gameui.ctrlbar","UI.gameui.accelbar_main",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,0,0);	
			end;
			
			children=
			{
				statusbtn=
				{
					type="BUTTON",
					rect={-1,-3,50,50},
					bkimage="res/uires/ctrlbar/statusbtn.gsa",
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					--tiptext="角色:Alt+C",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.statusbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.statusbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.statusbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.statusbtn",-1,value_channel_timerspace);
						end;
					
					OnClick=function()
							--UI.children.gameui.OnAccel_EquipDlg();
							
						if Win_IsVisible("UI.gameui.ctrlbar.statusbtn.avatorbar") then
							Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", false);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", true);
						end;
							--OpenAchieveDlg(0);
					end;					
					
					OnMouseIn=function()
						--Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", true);
					end;
					
					OnMouseOut=function()
						local spath = Win_GetNextMouseWgtPath() ;
						if spath=="UI.gameui.ctrlbar.statusbtn.avatorbar" or spath=="UI.gameui.ctrlbar.statusbtn.avatorbar.status1btn" or spath=="UI.gameui.ctrlbar.statusbtn.avatorbar.achievebtn" then
							Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", true);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", false);
						end;
					end;
					
					children=
					{
						avatorbar=
						{
							type="WIDGET",
							rect={-20,-40,100,50},
							visible=0;

							OnMouseOut=function()
								UI.children.gameui.children.ctrlbar.children.statusbtn.OnMouseOut();
							end;
							
							children=
							{
								status1btn=
								{
									type="BUTTON",
									rect={4,8,50,50},
									bkimage="res/uires/ctrlbar/statusbtn1.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									style=wgtstyle_alphawin,	
									tiptext="角色:Alt+C",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnAccel_EquipDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", false);
									end;		
										
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.statusbtn.OnMouseOut();
									end;
								};
								
								achievebtn=
								{
									type="BUTTON",
									rect={47,8,50,50},
									bkimage="res/uires/ctrlbar/achievebtn.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									style=wgtstyle_alphawin,	
									tiptext="成就:Alt+Y",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnAccel_AchieveDlg();
										--OpenAchieveDlg(0);
										Win_ShowWidget("UI.gameui.ctrlbar.statusbtn.avatorbar", false);
									end;
									
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.statusbtn.OnMouseOut();
									end;
								};
								
							};
						};
					};

					
				};
				
				warebtn=
				{
					type="BUTTON",
					rect={39,-3,50,50},
					bkimage="res/uires/ctrlbar/warebtn.gsa",					
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					tiptext="物品:Alt+I",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.warebtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.warebtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.warebtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.warebtn",-1,value_channel_timerspace);
						end;
					
					OnClick=function()
						UI.children.gameui.OnAccel_WareDlg();
						end;		
				};
				
				petbtn=
				{
					type="BUTTON",
					rect={82,-3,50,50},
					bkimage="res/uires/ctrlbar/petgodbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					--style=wgtstyle_alphawin,	
					--tiptext="宠物:Alt+P",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.petbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.petbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.petbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.petbtn",-1,value_channel_timerspace);
						end;
						
					OnClick=function()
						    if Win_IsVisible("UI.gameui.ctrlbar.petbtn.petbar") then
							Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", false);
							else
							Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", true);
							end;
						    end;
					
					OnMouseIn=function()
						--Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", true);
					end;
					
					OnMouseOut=function()
						local spath = Win_GetNextMouseWgtPath() ;
						if spath=="UI.gameui.ctrlbar.petbtn.petbar" or spath=="UI.gameui.ctrlbar.petbtn.petbar.petbtn" or spath=="UI.gameui.ctrlbar.petbtn.petbar.godbtn" then
							Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", true);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", false);
						end;
					end;
					
					children=
					{
						petbar=
						{
							type="WIDGET",
							rect={-20,-40,100,50},
							visible=0;

							OnMouseOut=function()
								UI.children.gameui.children.ctrlbar.children.petbtn.OnMouseOut();
							end;
							
							children=
							{
								petbtn=
								{
									type="BUTTON",
									rect={0,0,50,50},
									bkimage="res/uires/ctrlbar/petbtn.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									style=wgtstyle_alphawin,	
									tiptext="宠物:Alt+P",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnAccel_PetDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", false);
									end;		
										
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.petbtn.OnMouseOut();
									end;
								};
								
								godbtn=
								{
									type="BUTTON",
									rect={40,0,50,50},
									bkimage="res/uires/ctrlbar/godbtn.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									style=wgtstyle_alphawin,	
									tiptext="幻神:Alt+K",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnAccel_GodDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.petbtn.petbar", false);
									end;
									
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.petbtn.OnMouseOut();
									end;
								};
							};
						};
					};
				};
				
				skillbtn=
				{
					type="BUTTON",
					rect={125,-3,50,50},
					bkimage="res/uires/ctrlbar/skillbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					tiptext="技能:Alt+T",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.skillbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.skillbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.skillbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.skillbtn",-1,value_channel_timerspace);
						end;
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.ctrlbar.skillbtn.skillbar") then
							Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", false);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", true);
						end;
						end;
       
					OnMouseOut=function()
						local spath = Win_GetNextMouseWgtPath();
						if spath=="UI.gameui.ctrlbar.skillbtn.skillbar" or spath=="UI.gameui.ctrlbar.skillbtn.skillbar.skillbtn" or spath=="UI.gameui.ctrlbar.skillbtn.skillbar.petfzbtn" then
							Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", true);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", false);
						end;
						end;											
										
					children=
					{
						  skillbar=
						  {
							   type="WIDGET",
							   rect={-12,-38,100,50},
							   visible=0;

							   OnMouseOut=function()
								UI.children.gameui.children.ctrlbar.children.skillbtn.OnMouseOut();
							   end;
							   
							   children=
							   {
									skillbtn=
									{
									 type="BUTTON",
									 rect={2,4,40,50},
									 bkimage="res/uires/ctrlbar/skillzibtn.gsa", 
									 effectpic="res/uires/common/paopao.gsa",
									 effectpicpos={-30,-30},
									 drawflag=drawflag_focus_effect,
									 style=wgtstyle_alphawin,	
									 tiptext="技能:Alt+T",
									 framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									 
									 OnClick=function()
									  UI.children.gameui.OnAccel_SkillDlg();
									  Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", false);
									 end;  
									  
									 OnMouseOut=function()
									  UI.children.gameui.children.ctrlbar.children.skillbtn.OnMouseOut();
									 end;
									};
								
									petfzbtn=
									{
									 type="BUTTON",
									 rect={38,4,40,50},
									 bkimage="res/uires/ctrlbar/petfzbtn.gsa", 
									 effectpic="res/uires/common/paopao.gsa",
									 effectpicpos={-30,-30},
									 drawflag=drawflag_focus_effect,
									 style=wgtstyle_alphawin, 									 
									 framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									 
									 OnClick=function()
										UI.children.gameui.OnOpenPetCircleDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.skillbtn.skillbar", false);
									 end;
								
									 OnMouseOut=function()
									  UI.children.gameui.children.ctrlbar.children.skillbtn.OnMouseOut();
									 end;
									};
							   };
						  };		
					 };					
				};
				
				taskbtn=
				{
					type="BUTTON",
					rect={167,-3,50,50},
					bkimage="res/uires/ctrlbar/taskbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					--style=wgtstyle_alphawin,	
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.taskbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.taskbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.taskbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.taskbtn",-1,value_channel_timerspace);
						end;
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.ctrlbar.taskbtn.taskbar") then
							Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", false);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", true);
						end;
					end;
							
					OnMouseOut=function()
						local spath = Win_GetNextMouseWgtPath() ;
						if spath=="UI.gameui.ctrlbar.taskbtn.taskbar" or spath=="UI.gameui.ctrlbar.taskbtn.taskbar.taskbtn" or spath=="UI.gameui.ctrlbar.taskbtn.taskbar.cardbtn" then
							Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", true);
						else
							Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", false);
						end;
					end;
					
					children=
					{
						taskbar=
						{
							type="WIDGET",
							rect={-20,-40,100,50},
							visible=0;

							OnMouseOut=function()
								UI.children.gameui.children.ctrlbar.children.taskbtn.OnMouseOut();
							end;
							
							children=
							{
								taskbtn=
								{
									type="BUTTON",
									rect={2,0,50,50},
									bkimage="res/uires/ctrlbar/taskzibtn.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									--style=wgtstyle_alphawin,	
									tiptext="任务:Alt+N",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnAccel_TaskDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", false);
									end;		
										
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.taskbtn.OnMouseOut();
									end;
								};
								
								cardbtn=
								{
									type="BUTTON",
									rect={38,0,50,50},
									bkimage="res/uires/ctrlbar/cardzibtn.gsa",	
									effectpic="res/uires/common/paopao.gsa",
									effectpicpos={-30,-30},
									drawflag=drawflag_focus_effect,
									--style=wgtstyle_alphawin,	
									tiptext="典籍:Alt+E",
									framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
									
									OnClick=function()
										UI.children.gameui.OnOpenAncientCardDlg();
										Win_ShowWidget("UI.gameui.ctrlbar.taskbtn.taskbar", false);
									end;
									
									OnMouseOut=function()
										UI.children.gameui.children.ctrlbar.children.taskbtn.OnMouseOut();
									end;
								};
							};
						};
					};
				};

				teambtn=
				{
					type="BUTTON",
					rect={207,-3,50,50},
					bkimage="res/uires/ctrlbar/teambtn.gsa",
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,						
					tiptext="社交:Alt+Q",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.teambtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.teambtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.teambtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.teambtn",-1,value_channel_timerspace);
						end;
					
					
					
					OnClick=function()						    	
						UI.children.gameui.OnAccel_TeamDlg();
						end;					
				};				
				
				familybtn=
				{
					type="BUTTON",
					rect={251,-2,50,50},
					bkimage="res/uires/ctrlbar/familybtn.gsa",
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					tiptext="家族:Alt+F",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.familybtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.familybtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.familybtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.familybtn",-1,value_channel_timerspace);
						end;
					
					
					OnClick=function()
						UI.children.gameui.OnAccel_FamilyDlg();						
						end;					
				};
				

				
				-- email 暂时取消菜单按钮
				emailbtn=
				{
					type="BUTTON",
					rect={251,-2,50,50},
					bkimage="res/uires/ctrlbar/emailbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					tiptext="信件:Alt+L",
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					visible=0;
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.emailbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.emailbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.emailbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.emailbtn",-1,value_channel_timerspace);
						end;
						
					OnClick=function()
						    UI.children.gameui.OnAccel_EMailDlg();
						    end;
				};
				
				msgbtn=
				{
					type="BUTTON",
					rect={300,-26,42,55},
					bkimage="res/uires/ctrlbar/msgbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,
					enable=0,	
					visible=0,
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.msgbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.msgbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.msgbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.msgbtn",-1,value_channel_timerspace);
						end;
						
					OnClick=function()
						PopQQMsg();	
						end;
				};
				
				rackbtn=
				{
					type="BUTTON",
					rect={292,-2,50,50},
					bkimage="res/uires/ctrlbar/rackbtn.gsa",	
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					tiptext="货架:Alt+G",
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.rackbtn",value_channel_framescheme);
						if curframe == 1 then
							--Win_SetValue("UI.gameui.ctrlbar.rackbtn",1,value_channel_customindex);
							Win_SetValue("UI.gameui.ctrlbar.rackbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						--local idx = Win_GetValue("UI.gameui.ctrlbar.rackbtn",value_channel_customindex);
						Win_SetValue("UI.gameui.ctrlbar.rackbtn",-1,value_channel_timerspace);
						
						--if idx == 1 then
							Win_SetValue("UI.gameui.ctrlbar.rackbtn",0,value_channel_framescheme);
						--elseif idx == 2 then
						--	Win_SetValue("UI.gameui.ctrlbar.rackbtn",0,value_channel_customtype);
						--end;
						end;
						
					OnClick=function()
						UI.children.gameui.OnAccel_RackDlg();
						
						end;
				};
				
				optionbtn=
				{
					type="BUTTON",
					rect={335,-0,50,50},
					bkimage="res/uires/ctrlbar/optionbtn.gsa",
					effectpic="res/uires/common/paopao.gsa",
					effectpicpos={-30,-30},
					drawflag=drawflag_focus_effect,
					style=wgtstyle_alphawin,	
					framescheme={{0,0,1,1,2,2,2,2},{0,2,0,2,0,2,2,2}},
					tiptext="设置:Alt+O",
					
					mornitor={value_channel_framescheme};
					
					OnUpdate=function()
						local curframe = Win_GetValue("UI.gameui.ctrlbar.optionbtn",value_channel_framescheme);
						if curframe == 1 then
							Win_SetValue("UI.gameui.ctrlbar.optionbtn",newtask_showtime,value_channel_timerspace);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.ctrlbar.optionbtn",0,value_channel_framescheme);
						Win_SetValue("UI.gameui.ctrlbar.optionbtn",-1,value_channel_timerspace);
						end;
					
					OnClick=function()
						UI.children.gameui.OnAccel_OptionDlg();
						end;
				};

			};--children
			
		};--ctrlbar
		
		helpbtn=
		{
			type="BUTTON",
			rect={604,0,44,22};
			bkimage="res/uires/gameui/helpbtn.gsa",
			visible=0,
			updatemute=1,
			
			OnClick=function()
				Win_ToggleWidget("UI.gameui.helpwindlg",1);
				end;
		};

		sketchbar=
		{
			type = "DIALOG",
			rect = { 0,0,151,20 },
			captionrect = { 30,5,72,12 },
			drawcolor={255,207,16,255},
			bkimage="res/uires/sketchmap/sketchbar.gsa",
			textsize=12,
			initlayer=0;
		        pluslayer=0;	
			autoadjust = autoadjust_top+autoadjust_right,

			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,			
			

			children=
			{
			
				closebtn=
				{
					type="CHECK",
					rect={131,0,20,19};
					bkimage="res/uires/common/minize_updown_btn.gsa",
					framescheme={{0,0,1,1,2,2,3,3},{4,4,5,5,6,6,7,7},},
					updatemute=1,
					
					OnClick=function()
						    Win_ToggleWidget("UI.gameui.sketchbar.sketchmap");
						    end;
				};
				
				sketchmap=
				{
					type = "WIDGET",
					rect = { -28,15,176,153 },
					clientrect = { 16,8,143,139 },
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_sketchmap,		
					dragtype=ui_drag_type_sketchmap,
					dragindex=0,
					idletime=-1.0,
					tipflag=1,
					tipwidget="UI.gameui.ScrnTooltip",
					winshape={{ shape_type_circle,1,22,16,132,130 }},
					
					OnSelfShow=function()
						SetGlobalQuery(GlobalQuery_SketchMap,1);
						end;
						
					OnSelfHide=function()
						SetGlobalQuery(GlobalQuery_SketchMap,0);
						end;
					
					OnClick=function()
						ToggleMapDiagram();
						end;
						
					OnRClick=function()
						local winRect=Win_GetRect("UI.gameui.sketchbar.sketchmap", value_channel_winrect);
						local clientRect=Win_GetRect("UI.gameui.sketchbar.sketchmap", value_channel_clientrect);

						GMMoveToPos(winRect.x+clientRect.x, winRect.y+clientRect.y);
						end;
						
					OnTimer=function()
						label = Win_GetValue("UI.gameui.sketchbar.sketchmap",value_channel_customindex);
						if label == 1 then
							Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel1btneffct",false);	
						elseif label == 2 then
							Win_ShowWidget("UI.gameui.sketchbar.sketchmap.maplabel2btneffct",false);	
						end;
					end;
					
					
						
					children=
					{
						levellable=
						{
							type = "LABEL",
							rect={45,110,96,24},
							textsize=12,
							rowspace=3,
							drawcolor={255,255,0,255},
							richmode=ui_richmode_color+ui_richmode_font,
							enable=0,	
							updatemute=1,
							initlayer=1,
						};
						
						worldbtn=
						{
							type="BUTTON",
							rect={139,16,26,26};
							bkimage="res/uires/sketchmap/worldbtn.gsa",
							tiptext="世界地图",
							updatemute=1,
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.worldbar",true);								
								end;
						};
						
						plusbtn=
						{
							type="BUTTON",
							rect={157,64,24,24};
							bkimage="res/uires/sketchmap/plusbtn.gsa",
							updatemute=1,
							visible=0,
							tiptext="放大",
							
							OnClick=function()
								UI.children.gameui.OnAccelPlus();
								end;
						};
						
						minusbtn=
						{
							type="BUTTON",
							rect={157,64,24,24};
							bkimage="res/uires/sketchmap/minusbtn.gsa",
							updatemute=1,
							tiptext="缩小",
							
							OnClick=function()
								UI.children.gameui.OnAccelMinus();
								end;
						};	
						
						performbtn=
						{
							type="CHECK",
							rect={153,89,24,24};
							bkimage="res/uires/sketchmap/performbtn.gsa",
							framescheme={{6,6,7,7,8,8,8,8},{6,6,7,7,8,8,8,8},{0,0,1,1,2,2,2,2},{8}};
							extendstyle=ui_btn_style_none,
							effectpicpos={-8,-10},
							
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn","点击按钮解决卡机问题！",value_channel_tiptext);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",1,value_channel_framescheme);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",10.0,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn","",value_channel_effectpic);
								
								--[[
								local curperform=GetGameVar("perform");
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",curperform,value_channel_framescheme);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",0.0,value_channel_timerspace);
								]]
								local tipperform="点击按钮解决卡机问题！";
								--[[
								if curperform==0 then
								tipperform="当前不限制播放技能特效！";
								elseif curperform==1 then
								tipperform="当前限制播放技能特效！";
								else
								tipperform="当前已关闭技能特效播放！";								
								end;
								]]
								
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn",tipperform,value_channel_tiptext);
				
								if Win_IsVisible("UI.SysTooltip") then
								local wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
								if (wgtpath=="UI.gameui.sketchbar.sketchmap.performbtn") then
								Win_SetText("UI.SysTooltip",tipperform,value_channel_caption);
								end;
								end;
							end;
							
							OnClick=function()
								--add by joeyxiong[2011-01-01]
								if  Win_IsChecked("UI.gameui.sketchbar.sketchmap.performbtn")  then
									Win_ShowWidget("UI.gameui.effectfilterdlg",true);
									Win_ActiveSelf("UI.gameui.effectfilterdlg");
								else 
									Win_ShowWidget("UI.gameui.effectfilterdlg",false);
								end;					
								--							
							--[[
								local curperform=GetGameVar("perform");
								local tipperform="点击按钮解决卡机问题！";
								
								if curperform==0 then
								curperform=1;
								tipperform="当前限制播放技能特效！";
								elseif curperform==1 then
								curperform=2;
								tipperform="当前已关闭技能特效播放！";
								else
								curperform=0;
								tipperform="当前不限制播放技能特效！";								
								end;
								
								
								SetGameVar("perform",curperform);
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn",tipperform,value_channel_tiptext);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",curperform,value_channel_framescheme);
								
								Win_SetText("UI.SysTooltip",tipperform,value_channel_caption);
								Win_ShowWidget("UI.SysTooltip",true);
								
								Win_SetText("UI.gameui.sketchbar.sketchmap.performbtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.performbtn",-1,value_channel_timerspace);
							]]
							end;
						};	
						
						playerstatusbtn=
						{
							type="BUTTON",
							rect={143,113,24,24};
							bkimage="res/uires/sketchmap/instatus.gsa",
							visible = 1,
							OnFlash=function()
								local status = GetOnlineStatus();
								if status == 0 then
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "res/uires/sketchmap/instatus.gsa",value_channel_backpic);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "点击切换到离开状态", value_channel_tiptext);
								else
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "res/uires/sketchmap/leavestatus.gsa",value_channel_backpic);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "点击切换到在线状态", value_channel_tiptext);
								end;
							end;
							
							OnClick=function()
								local status = GetOnlineStatus();
								if status == 0 then
									SetOnlineStatus(1);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "res/uires/sketchmap/leavestatus.gsa",value_channel_backpic);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "点击切换到在线状态", value_channel_tiptext);
								else
									SetOnlineStatus(0);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "res/uires/sketchmap/instatus.gsa",value_channel_backpic);
									Win_SetText("UI.gameui.sketchbar.sketchmap.playerstatusbtn", "点击切换到离开状态", value_channel_tiptext);
								end;
							end;
						},
						
						filterbtn = 
						{
							type = "CHECK",
							rect={152,39,26,26};
							bkimage="res/uires/sketchmap/mapfilterbtn.gsa",
							framescheme={{0, 1, 2, 1},{0, 0, 0, 0}};
							extendstyle=ui_btn_style_none,
							tiptext="开启/关闭玩家及怪物显示",
							effectpicpos={-8,-10},
								
							OnClick=function()								    
								local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
								if nameflag=="mapfilter" then
								Win_ShowWidget("UI.gameui.ScrnTutortip",false);
								end;
								
								if  Win_IsChecked("UI.gameui.sketchbar.sketchmap.filterbtn")  then
								Win_ShowWidget("UI.gameui.mapfilterdlg",true);
								Win_ActiveSelf("UI.gameui.mapfilterdlg");
								else 
								Win_ShowWidget("UI.gameui.mapfilterdlg",false);
								end;						     
								end;
								
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.filterbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.filterbtn",10.0,value_channel_timerspace);
								end;
								
							CloseEffect=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.filterbtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.filterbtn",-1,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.filterbtn","",value_channel_effectpic);
								end;
						};
						
						maplabel1btneffct=
						{
							type="BUTTON",
							rect={38,128,26,26},
							style=wgtstyle_alphawin,
							bkimage="res/uires/gameui/btneffct.gsa",
							framescheme={{0,13,0,13,0,13,0,13}};
							framespeed=0.01;
							visible=0;
							senable=0;
							updatemute=1,
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.sketchbar.sketchmap",0.56,value_channel_timerspace);
								Win_SetValue("UI.gameui.sketchbar.sketchmap",1,value_channel_customindex);
								end;
						};
						
						maplabel1btn=
						{
							type="BUTTON",
							rect={38,128,26,26};
							bkimage="res/uires/gameui/maplabelbtn.gsa",
							tiptext="",
							visible=0,
							
							OnDBClick=function()
								UseMapSign(1);
								end;
								
							OnMouseIn=function()
								text = GetMapLabelTip(1);
								Win_SetText("UI.SysTooltip",text);
								Win_SetText("UI.gameui.sketchbar.sketchmap.maplabel1btn", text, value_channel_tiptext);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel1btn",0.5,value_channel_timerspace);
								end;
								
							OnTimer=function()
								if Win_IsVisible("UI.SysTooltip") then
									wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
									if (wgtpath=="UI.gameui.sketchbar.sketchmap.maplabel1btn") then
										text = GetMapLabelTip(1);
										Win_SetText("UI.SysTooltip",text);
										Win_SetText("UI.gameui.sketchbar.sketchmap.maplabel1btn", text, value_channel_tiptext);
										Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel1btn",0.5,value_channel_timerspace);
										end;
									else
									Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel1btn",0,value_channel_timerspace);
									end;
								end;
						};
						
						maplabel2btneffct=
						{
							type="BUTTON",
							rect={109,128,26,26},
							style=wgtstyle_alphawin,
							bkimage="res/uires/gameui/btneffct.gsa",
							framescheme={{0,13,0,13,0,13,0,13}};
							framespeed=0.01;
							visible=0;
							senable=0;
							updatemute=1,
							
							OnSelfShow=function()
								Win_SetValue("UI.gameui.sketchbar.sketchmap",0.56,value_channel_timerspace);
								Win_SetValue("UI.gameui.sketchbar.sketchmap",2,value_channel_customindex);
								end;
						};
						
						maplabel2btn=
						{
							type="BUTTON",
							rect={109,128,26,26};
							bkimage="res/uires/gameui/maplabelbtn.gsa",
							tiptext="",
							visible=0,
							
							OnDBClick=function()
								UseMapSign(2);
								end;
								
							OnMouseIn=function()
								text = GetMapLabelTip(2);
								Win_SetText("UI.SysTooltip",text);
								Win_SetText("UI.gameui.sketchbar.sketchmap.maplabel2btn", text, value_channel_tiptext);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel2btn",0.5,value_channel_timerspace);
								end;
								
							OnTimer=function()
								if Win_IsVisible("UI.SysTooltip") then
									wgtpath=Win_GetText("UI.SysTooltip",value_channel_host);
									if (wgtpath=="UI.gameui.sketchbar.sketchmap.maplabel2btn") then
										text = GetMapLabelTip(2);
										Win_SetText("UI.SysTooltip",text);
										Win_SetText("UI.gameui.sketchbar.sketchmap.maplabel2btn", text, value_channel_tiptext);
										Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel2btn",0.5,value_channel_timerspace);
										end;
									else
									Win_SetValue("UI.gameui.sketchbar.sketchmap.maplabel2btn",0,value_channel_timerspace);
									end;
								end;
						};
						
						--非家族战场管理按钮
						fieldmgrbtn=
						{
							type="BUTTON",
							rect={122,127,30,30};
							bkimage="res/uires/sketchmap/fieldmgrbtn.gsa",
							visible = 0,
							updatemute=1,
							dragtype=ui_drag_type_fieldinfo,
							dragindex=0,
							tipwidget="UI.gameui.ScrnTooltip",
							enable=0,
							
							OnClick=function()
								if Win_IsVisible("UI.gameui.battlemgrdlg") then
									Win_ShowWidget("UI.gameui.battlemgrdlg",false);
								else
									Win_ShowWidget("UI.gameui.battlemgrdlg",true);
								end;
							end;
						},
						
						pkbtn=
						{
							type="BUTTON",
							rect={43,139,24,24};
							bkimage="res/uires/sketchmap/pkbtn.gsa",
							visible = 0,
							tiptext="PK模式",
							extendstyle=ui_btn_style_none,
							enable=0;
							
							OnClick=function()
								Win_ToggleWidget("UI.gameui.qqradiodlg");
							end;
						},
						
						--自动寻路
						autosearchbtn=
						{
							type="CHECK",
							rect={93,145,24,24};
							bkimage="res/uires/sketchmap/autosearchbtn.gsa",
							framescheme={{0, 1, 2, 1},{0, 0, 0, 0}};
							visible=1,
							tiptext="自动寻路",
							extendstyle=ui_btn_style_none,
							effectpicpos={-8,-10},
							
							OnClick=function()
								GetCurMapNpcHintList();
								local nameflag=Win_GetText("UI.gameui.ScrnTutortip",value_channel_customname);
								if nameflag=="autosearch" then
									Win_ShowWidget("UI.gameui.ScrnTutortip",false);
								end;
								
								if  Win_IsChecked("UI.gameui.sketchbar.sketchmap.autosearchbtn")  then
									Win_ShowWidget("UI.gameui.autosearchmgrdlg",true);
									Win_ActiveSelf("UI.gameui.autosearchmgrdlg");
								else 
									Win_ShowWidget("UI.gameui.autosearchmgrdlg",false);
								end;						     
								end;
							
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.autosearchbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.autosearchbtn",10.0,value_channel_timerspace);
								end;
								
							CloseEffect=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.autosearchbtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.autosearchbtn",-1,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.autosearchbtn","",value_channel_effectpic);
								end;
						};
						
						emailbtn=
						{
							type="BUTTON",
							rect={121,133,26,26},
							bkimage="res/uires/sketchmap/emailbtn.gsa",
							visible = 1,
							tiptext="邮件窗口",
							extendstyle=ui_btn_style_none,
							effectpicpos={-8,-10},
							
							OnClick=function()
								UI.children.gameui.OnAccel_EMailDlg();
							end;
							
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.emailbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.emailbtn",10.0,value_channel_timerspace);
								end;
								
							CloseEffect=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.emailbtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.emailbtn",-1,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.emailbtn","",value_channel_effectpic);
								end;
						},

						--[[
						qqbroadcastbtn=
						{
							type="BUTTON",
							rect={123,132,24,24};
							bkimage="res/uires/sketchmap/qqbroadcastbtn.gsa",
							visible = 1,
							tiptext="QQ电台",
							extendstyle=ui_btn_style_none,
							
							OnClick=function()
								Win_ToggleWidget("UI.gameui.qqradiodlg");
							end;
						},
						--]]
						
						--增加自动补给设置接口
						autosupplybtn=
						{
							type="BUTTON",
							rect={64,143,24,24};
							bkimage="res/uires/sketchmap/autosupportbtn.gsa",
							tiptext="自动补给",
							updatemute=1,
							
							OnClick=function()
								Win_ToggleWidget("UI.gameui.sysconfigdlg");
								Win_SetCheck("UI.gameui.sysconfigdlg.gamesettab",false);
								Win_SetCheck("UI.gameui.sysconfigdlg.displaysettab",false);
								Win_SetCheck("UI.gameui.sysconfigdlg.musicsettab",false);
								Win_SetCheck("UI.gameui.sysconfigdlg.autoreplytab",false);
								Win_SetCheck("UI.gameui.sysconfigdlg.autosupplytab",true);
								Win_SetCheck("UI.gameui.sysconfigdlg.extendskilltab",false);
							end;
						};
						
						--[[
						--每日玩法和每日活动
						dailyplaybtn=
						{
							type="BUTTON",
							rect={19,124, 26, 26},
							bkimage="res/uires/sketchmap/dailyplaybtn.gsa",
							tiptext="今日玩法和今日活动",
							updatemute=1,
							effectpicpos={-8,-10},
							
							OnClick=function()
								Win_ToggleWidget("UI.gameui.dailytaskinfodlg");
							end;
							
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.dailyplaybtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.dailyplaybtn",10.0,value_channel_timerspace);
								end;
								
							CloseEffect=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.dailyplaybtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.dailyplaybtn",-1,value_channel_timerspace);
								end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.dailyplaybtn","",value_channel_effectpic);
								end;
						};
						--]]
						
						--vip显示按钮
						vipbtn=
						{
							type="BUTTON",
							rect={13,119,26,26},
							bkimage="res/uires/sketchmap/vip.gsa",
							updatemute=1,
							effectpicpos={-8,-10},
							
							OnClick=function()
								local vipInfo = GetVipInfo();
								if vipInfo.RealVip == 0 then
									Win_SetText("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip", "在神奇货架购买幻想VIP卡，就可开通VIP服务，享受随身商店、随身仓库、打怪经验加成、VIP独有标志和特效称号，更有两大超级特权：VIP彩玉翻倍理财计划让你彩玉翻倍月月领取红利；每月10日幸运VIP抽奖让你有机会赢取10万彩玉大奖。");
									
									local x, y = Win_GetPos("UI.gameui.sketchbar.sketchmap.vipbtn");
									Win_SetText("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
									local w = Win_GetValue("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",value_channel_winrect,2);
									Win_SetValue("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",w-9,value_channel_coverpicpos,0);
									Win_SetValue("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",22,value_channel_coverpicpos,1);
									
									Win_AlignWidget("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip", "UI.gameui.sketchbar.sketchmap.vipbtn", aligntype_winrect+aligntype_clientrect, alignstyle_left_out+alignstyle_top_out, -8, 65);
									Win_ShowWidget("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",true);
									
									Win_SetValue("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",10, value_channel_timerspace);									
								else
									CallStashNpc();
								end;
							end;
							
							OnMouseIn=function()
								local vipInfo = GetVipInfo();
								Win_SetText("UI.gameui.sketchbar.sketchmap.vipbtn", vipInfo.vipTip, value_channel_tiptext);
							end;
							
							children=
							{
								SysInputTip=
								{
									type = "LABEL",
									rect={61,-60,24,33},
									coverpic="res/uires/gameui/ballarrow.gsa",
									coverpicpos={-13,35},
									drawcolor={0,0,0,255},
									visible=0,			
									maxwidth=200,
									minheight=41,
									sizeable=1,								
									marginh=12,
									marginv=6,
									textsize=12,
									alphaspeed=0.1,	
									richmode=ui_richmode_all,
									initlayer=systooltip_layer,
									edgecheck=edge_check_show+edge_check_auto,
									
									patchupleft="res/uires/gameui/ballupleft.gsa",
									patchupright="res/uires/gameui/ballupright.gsa",
									patchdownleft="res/uires/gameui/balldownleft.gsa",
									patchdownright="res/uires/gameui/balldownright.gsa",
									
									patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
									patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
									patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
									patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
									
									patchmiddle="res/uires/gameui/ballmiddle.gsa",
									
									OnTimer=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",false);
									end;
									
									OnSelfShow=function()
										Win_SetValue("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",-1,value_channel_timerspace);
									end;	
										
									OnClick=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.vipbtn.SysInputTip",false);
									end;
								};
							};							
						};
						
						--帮助精灵
						helpshowbtn=
						{
							type="BUTTON",
							rect={38,136,26,26};
							bkimage="res/uires/sketchmap/smallhelpbtn.gsa",
							visible=1,
							tiptext="帮助",
							extendstyle=ui_btn_style_none,
							effectpicpos={-8,-10},
							
							RandomTip=function()
								local info, size = GetRandomTip();
								
								if size == 0 then
									Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn", -1, value_channel_timerspace);
									return;
								end;	
								
								Win_SetText("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip", info);
								
								local x, y = Win_GetPos("UI.gameui.sketchbar.sketchmap.helpshowbtn");
								Win_SetText("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip","res/uires/gameui/ballarrowright.gsa",value_channel_coverpic);
								local w = Win_GetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",value_channel_winrect,2);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",w-9,value_channel_coverpicpos,0);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",22,value_channel_coverpicpos,1);
								
								Win_AlignWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip", "UI.gameui.sketchbar.sketchmap.helpshowbtn", aligntype_winrect+aligntype_clientrect, alignstyle_left_out+alignstyle_top_out, -8, 18);
								Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",true);
								
								Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",10, value_channel_timerspace);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn", 600, value_channel_timerspace);
							end;
							
							OnSelfShow=function()
								--Win_SetText("UI.gameui.sketchbar.sketchmap.helpshowbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								--Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn",3.0,value_channel_timerspace);
								local iShowHelpSprite, iDailyHelp, iLockPos = GetHelpVar();
								
								if iDailyHelp > 0 then
									UI.children.gameui.children.sketchbar.children.sketchmap.children.helpshowbtn.RandomTip();
								end;
							end;
							
							OnTimer=function()
								--Win_SetText("UI.gameui.sketchbar.sketchmap.helpshowbtn","",value_channel_effectpic);
								--Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn",0.0,value_channel_timerspace);
								
								UI.children.gameui.children.sketchbar.children.sketchmap.children.helpshowbtn.RandomTip();
							end;
							
							OnClick=function()
								Win_ShowWidget("UI.gameui.ExtendSkillMenu2.movebtn", true);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu2.lockbtn", true);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu2", true);
								Win_SetFocus("UI.gameui.ExtendSkillMenu2");
								--UI.children.gameui.OnOpenHelpMenu(false);
							end;
							
							OnRClick=function()
								--UI.children.gameui.OnOpenHelpMenu(false);
							end;
							
							children=
							{
								SysInputTip=
								{
									type = "LABEL",
									rect={61,-60,24,33},
									coverpic="res/uires/gameui/ballarrow.gsa",
									coverpicpos={-13,35},
									drawcolor={0,0,0,255},
									visible=0,			
									maxwidth=200,
									minheight=41,
									sizeable=1,								
									marginh=12,
									marginv=6,
									textsize=12,
									alphaspeed=0.1,	
									richmode=ui_richmode_all,
									initlayer=systooltip_layer,
									edgecheck=edge_check_show+edge_check_auto,
									
									patchupleft="res/uires/gameui/ballupleft.gsa",
									patchupright="res/uires/gameui/ballupright.gsa",
									patchdownleft="res/uires/gameui/balldownleft.gsa",
									patchdownright="res/uires/gameui/balldownright.gsa",
									
									patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
									patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
									patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
									patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
									
									patchmiddle="res/uires/gameui/ballmiddle.gsa",
									
									OnTimer=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",false);
									end;
									
									OnSelfShow=function()
										Win_SetValue("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",-1,value_channel_timerspace);
									end;	
										
									OnClick=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.helpshowbtn.SysInputTip",false);
									end;
								};
							};
						};
						
						--[[
						--离线经验
						offlineexpbtn=
						{
							type="BUTTON",
							rect={2,100,26,26};
							bkimage="res/uires/offlineexpdlg/offlinebtn.gsa",
							visible=1,
							tiptext="离线经验兑换",
							updatemute=1,
							effectpicpos={-8,-10},
							
							PerformInit=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.offlineexpbtn","res/uires/sketchmap/performeffect.gsa",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.offlineexpbtn",10.0,value_channel_timerspace);
								end;
								
							CloseEffect=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.offlineexpbtn","",value_channel_effectpic);
								Win_SetValue("UI.gameui.sketchbar.sketchmap.offlineexpbtn",-1,value_channel_timerspace);
								end;
								
							OnClick=function()
								UI.children.gameui.OnOpenExpExchangeDlg(1);
							end;
							
							OnTimer=function()
								Win_SetText("UI.gameui.sketchbar.sketchmap.offlineexpbtn","",value_channel_effectpic);
								end;
						};
						--]]
						
						--海盗岛
						searoverislandbtn=
						{
							type="BUTTON",
							rect={-2,96,26,26};
							bkimage="res/uires/sketchmap/searoverislandbtn.gsa",
							tiptext="传送进入海盗乐园",
							visible=1,
								
							OnClick=function()
								Win_ShowMsgBox("您将被传送进入海盗乐园地图，是否确认传送?","系统消息",ui_msgid_yesno,"UI.gameui.sketchbar.sketchmap.searoverislandbtn");
							end;
					
							OnMsgBoxOk=function()
								EnterSeaearoverisland();
							end;
						};
						
						--时空传送
						transmissionbtn=
						{
							type="BUTTON",
							rect={-6,70,26,26};
							bkimage="res/uires/sketchmap/transmissionbtn.gsa",
							tiptext="时空传送",
							visible=1,
								
							OnClick=function()
								Win_ShowWidget("UI.gameui.transmissiondlg", true);
							end;
						};
						
						teamplatbtn=
						{
							type="BUTTON",
							rect={-1,42,26,26};
							bkimage="res/uires/sketchmap/teamplatbtn.gsa",
							tiptext="组队平台",
							visible=1,
								
							OnClick=function()
								local playerinfo = GetMainPlayerInfo();
								if playerinfo.profname=="初行者" then
									GameUILogInfo("对不起，此功能对初行者暂不开放");
									return;   
								end;
								local ts = GetPlayerTeamStatus();
								if ts==0 then
									Win_ShowWidget("UI.gameui.teamplatdlg",true);
									Win_SetCheck("UI.gameui.teamplatdlg.findteamtab",true);
									Win_SetCheck("UI.gameui.teamplatdlg.findplayertab",false);
									Win_EnableWidget("UI.gameui.teamplatdlg.findplayertab",false);		
									Win_EnableWidget("UI.gameui.teamplatdlg.findteamtab",true);	
								elseif ts==1 then
									Win_ShowWidget("UI.gameui.teamplatdlg",false);
									GameUILogInfo("对不起，你已经处于队伍中了");
								elseif ts==2 then
									Win_ShowWidget("UI.gameui.teamplatdlg",true);
									Win_SetCheck("UI.gameui.teamplatdlg.findteamtab",false);
									Win_SetCheck("UI.gameui.teamplatdlg.findplayertab",true);
									Win_EnableWidget("UI.gameui.teamplatdlg.findteamtab",false);	
									Win_EnableWidget("UI.gameui.teamplatdlg.findplayertab",true);									
								end;
							end;
						};
						
						extendskillbtn=
						{
							type="BUTTON",
							rect={10,16,26,26};
							bkimage="res/uires/sketchmap/kuo_yellow.gsa",
							tiptext="扩展技能栏",
							visible=1,
								
							OnClick=function()
								Win_ShowWidget("UI.gameui.ExtendSkillMenu.movebtn", true);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu.lockbtn", true);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu.setupbtn", true);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu.closebtn", false);
								Win_ShowWidget("UI.gameui.ExtendSkillMenu", true);
								Win_SetFocus("UI.gameui.ExtendSkillMenu");
							end;
							
							children=
							{
								SysInputTip=
								{
									type = "LABEL",
									rect={61,-60,24,33},
									coverpic="res/uires/gameui/ballarrow.gsa",
									coverpicpos={-13,35},
									drawcolor={0,0,0,255},
									visible=0,			
									maxwidth=200,
									minheight=41,
									sizeable=1,								
									marginh=12,
									marginv=6,
									textsize=12,
									alphaspeed=0.1,	
									richmode=ui_richmode_all,
									initlayer=systooltip_layer,
									edgecheck=edge_check_show+edge_check_auto,
									
									patchupleft="res/uires/gameui/ballupleft.gsa",
									patchupright="res/uires/gameui/ballupright.gsa",
									patchdownleft="res/uires/gameui/balldownleft.gsa",
									patchdownright="res/uires/gameui/balldownright.gsa",
									
									patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
									patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
									patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
									patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
									
									patchmiddle="res/uires/gameui/ballmiddle.gsa",
									
									OnTimer=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",false);
									end;
									
									OnSelfShow=function()
										Win_SetValue("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",-1,value_channel_timerspace);
									end;	
										
									OnClick=function()
										Win_ShowWidget("UI.gameui.sketchbar.sketchmap.extendskillbtn.SysInputTip",false);
									end;
								};
							};
						};
					};
				};
			};	
		};
		
		autosearchmgrdlg=
		{
			type="DIALOG",
			rect = {0,0,98,72},	
			visible=0,
			textsize=12,
			textfont=1,
			textstyle=dt_center,
			style=wgtstyle_popup+wgtstyle_topmost,
			
			bkcolor={16,16,16,196},					
			patchrect={3,3,3,2},
			patchdrawtype=patch_draw_type_scale,			
	
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
			
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			itemselback="res/uires/family/detailitemsel.gsa",
			mornitor={value_channel_visible},
			soundid={-1,-1,-1,-1,1004,1004},
					
			OnUpdate=function()
				if not Win_IsVisible("UI.gameui.autosearchmgrdlg")  then
					if Win_IsChecked("UI.gameui.sketchbar.sketchmap.autosearchbtn")  then
					Win_SetCheck("UI.gameui.sketchbar.sketchmap.autosearchbtn",false);									
					end;
				end;
				end;
			
			OnSelfShow=function()
				
				local tgt1,num1=GetAutoSearchNpcInfo(1);
				local tgt2,num2=GetAutoSearchNpcInfo(2);
				local tgt3,num3=GetAutoSearchNpcInfo(3);
				Win_EnableWidget("UI.gameui.autosearchmgrdlg.check1",num1 > 0);
				Win_EnableWidget("UI.gameui.autosearchmgrdlg.check2",num2 > 0);
				Win_EnableWidget("UI.gameui.autosearchmgrdlg.check3",num3 > 0);
				
				local color0 = GetColorIndex(128,128,128);	
				local color1 = GetColorIndex(255,255,255);	
				
				if (num1 > 0) then
					Win_SetValue("UI.gameui.autosearchmgrdlg.check1",color1,value_channel_color_draw);
				else
					Win_SetValue("UI.gameui.autosearchmgrdlg.check1",color0,value_channel_color_draw);
				end;
				
				if (num2 > 0) then
					Win_SetValue("UI.gameui.autosearchmgrdlg.check2",color1,value_channel_color_draw);
				else
					Win_SetValue("UI.gameui.autosearchmgrdlg.check2",color0,value_channel_color_draw);
				end;
				
				if (num3 > 0) then
					Win_SetValue("UI.gameui.autosearchmgrdlg.check3",color1,value_channel_color_draw);
				else
					Win_SetValue("UI.gameui.autosearchmgrdlg.check3",color0,value_channel_color_draw);
				end;
				
				Win_AlignWidget("UI.gameui.autosearchmgrdlg","UI.gameui.sketchbar.sketchmap.autosearchbtn",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,0,0);
				end;
				
			OnSelfHide=function(bshow)
				end;
					
			children=
			{
				check1=
				{
					type="CHECK";
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,8,90,16};
					captionrect={24,2,54,12},
					caption="关键NPC",
					textsize=12,
					itemselback="res/uires/family/detailitemsel.gsa",
					groupid = 0,
					groupstop = 0,
					extendstyle=ui_btn_style_radio,
					soundid={1005,1003},
					
					OnClick=function()
						Win_SetSelect("UI.gameui.autosearchmgrdlg",0,0);
						Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg1",true);
						end;
				};
				
				check2=
				{
					type="CHECK";
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,48,90,16};
					captionrect={24,2,54,12},
					caption="地图",
					textsize=12,
					itemselback="res/uires/family/detailitemsel.gsa",
					groupid = 0,
					groupstop = 1,
					extendstyle=ui_btn_style_radio,
					soundid={1005,1003},
					
					OnClick=function()
						Win_SetSelect("UI.gameui.autosearchmgrdlg",0,1);
						Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg2",true);
						end;
				};
				
				check3=
				{
					type="CHECK";
					adornpic={"res/uires/equipdlg/titleline.gsa"},
					adornpicpos={{0,16}},
					rect={4,28,90,16};
					captionrect={24,2,54,12},
					caption="普通NPC",
					textsize=12,
					itemselback="res/uires/family/detailitemsel.gsa",
					groupid = 0,
					groupstop = 2,
					extendstyle=ui_btn_style_radio,
					soundid={1005,1003},
					
					OnClick=function()
						Win_SetSelect("UI.gameui.autosearchmgrdlg",0,2);
						Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg3",true);
						end;
				};							
				
				listdlg1=
				{
					type="DIALOG",
					rect={0,0,264,205},
					style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_clipself,
					edgecheck=edge_check_show+edge_check_auto,
					visible=0,
					initlayer=msgbox_layer;
					soundid={-1,-1,-1,-1,1004,1004},
					
					bkcolor= { 26, 27, 22, 196 },
					patchrect={3,3,3,2},
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					sizeable=1,
								
					AlignWinRect=function(num,width)
						local itemnum = 10;
						if num < itemnum then itemnum = num; end;
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1.list",itemnum*20,value_channel_winrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1",itemnum*20+5,value_channel_winrect,3);
						
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1.list",itemnum*20,value_channel_clientrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1",itemnum*20+5,value_channel_clientrect,3);
			
						local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg1",value_channel_winrect,3);
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg1.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg1.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
						
						if num <= 10 then
							Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg1.list.vscroll",false);
						end;
						
						end;
		
					OnSelfShow=function()
						local maxlen = 8;
						local tgt,num=GetAutoSearchNpcInfo(1);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1.list",num,value_channel_item_num);
						for i=1,num do									  
						Win_SetText("UI.gameui.autosearchmgrdlg.listdlg1.list",tgt[i],value_channel_itemtext,i-1);
						
						local len = string.len(tgt[i]);
						if len > maxlen then
							maxlen = len;
						end;
						
						end;				
						
						UI.children.gameui.children.autosearchmgrdlg.children.listdlg1.AlignWinRect(num,maxlen*12+25);
						
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg1","UI.gameui.autosearchmgrdlg.check1",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,-3,-3);
						Win_SetFocus("UI.gameui.autosearchmgrdlg.listdlg1.list");
						
						end;		
		
					OnSelfHide=function()
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg1.list",0,value_channel_item_num);
						if Win_IsVisible("UI.gameui.autosearchmgrdlg") then
							Win_SetFocus("UI.gameui.autosearchmgrdlg");
						end;
						
						end;
						
					children=
					{
						list=
						{
							type="LISTBOX",
							rect={0,3,264,200},
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
							richmode=ui_richmode_color,
							dragtype=ui_drag_type_npchintlist1,
							textsize=12,
							sizeable=1,
							
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							itemfocusback="res/uires/cdkeydlg/itemsel.gsa",
							itemfocuspos={10,-9,0,0},
							
							updatemute=1,
							
							OnClick=function(sel)
								MoveToNpc(1,sel);
								
								Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg1",false);
								Win_ShowWidget("UI.gameui.autosearchmgrdlg",false);
								
								end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={0,53,12,160},
									clientrect={0,0,12,160},
									captionrect={0,0,12,160},
									dragrect={0,0,12,160},
									style=wgtstyle_vertical,					
									bkcolor={0,0,0,255},
									edgecolor={128,128,128,255},						
									pagesize=10,
									marginh=3,
									marginv=0,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									extendstyle=scrollbar_auto_hide,
									drawflag=drawflag_win_fill,
									updatemute=1,
									visible=0,
									
									OnSelfShow=function()
										local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg1",value_channel_winrect,3);
										Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg1.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg1.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
									end;
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,15,20},
											bkimage="res/uires/common/slidebtn.gsa",
											bkimagepos={2,0},
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
							
								};--scroll
							};
							
						};--list	
						
						
					};
				};
				
				listdlg2=
				{
					type="DIALOG",
					rect={0,0,264,205},
					style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_clipself,
					edgecheck=edge_check_show+edge_check_auto,
					visible=0,
					initlayer=msgbox_layer;
					soundid={-1,-1,-1,-1,1004,1004},
					
					bkcolor= { 26, 27, 22, 196 },
					patchrect={3,3,3,2},
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					sizeable=1,
								
					AlignWinRect=function(num,width)
						local itemnum = 10;
						if num < itemnum then itemnum = num; end;
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2.list",itemnum*20,value_channel_winrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2",itemnum*20+5,value_channel_winrect,3);
						
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2.list",itemnum*20,value_channel_clientrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2",itemnum*20+5,value_channel_clientrect,3);
			
						local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg2",value_channel_winrect,3);
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg2.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg2.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
						
						if num <= 10 then
							Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg2.list.vscroll",false);
						end;
						
						end;
		
					OnSelfShow=function()
						local maxlen = 8;
						local tgt,num=GetAutoSearchNpcInfo(2);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2.list",num,value_channel_item_num);
						for i=1,num do									  
						Win_SetText("UI.gameui.autosearchmgrdlg.listdlg2.list",tgt[i],value_channel_itemtext,i-1);
						
						local len = string.len(tgt[i]);
						if len > maxlen then
							maxlen = len;
						end;
						
						end;				
						
						UI.children.gameui.children.autosearchmgrdlg.children.listdlg2.AlignWinRect(num,maxlen*12+25);
						
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg2","UI.gameui.autosearchmgrdlg.check2",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,-3,-3);
						Win_SetFocus("UI.gameui.autosearchmgrdlg.listdlg2.list");
						
						end;		
		
					OnSelfHide=function()
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg2.list",0,value_channel_item_num);
						if Win_IsVisible("UI.gameui.autosearchmgrdlg") then
							Win_SetFocus("UI.gameui.autosearchmgrdlg");
						end;
						
						end;
						
					children=
					{
						list=
						{
							type="LISTBOX",
							rect={0,3,264,200},
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
							richmode=ui_richmode_color,
							textsize=12,
							sizeable=1,
							
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							itemfocusback="res/uires/cdkeydlg/itemsel.gsa",
							itemfocuspos={10,-9,0,0},
							
							updatemute=1,
							
							OnClick=function(sel)
								MoveToNpc(2,sel);
								
								Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg2",false);
								Win_ShowWidget("UI.gameui.autosearchmgrdlg",false);
								
								end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={0,53,12,160},
									clientrect={0,0,12,160},
									captionrect={0,0,12,160},
									dragrect={0,0,12,160},
									style=wgtstyle_vertical,					
									bkcolor={0,0,0,255},
									edgecolor={128,128,128,255},						
									pagesize=10,
									marginh=3,
									marginv=0,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									extendstyle=scrollbar_auto_hide,
									drawflag=drawflag_win_fill,
									updatemute=1,
									visible=0,
									
									OnSelfShow=function()
										local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg2",value_channel_winrect,3);
										Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg2.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg2.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
									end;
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,15,20},
											bkimage="res/uires/common/slidebtn.gsa",
											bkimagepos={2,0},
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
							
								};--scroll
							};
							
						};--list	
						
						
					};
				};
				
				listdlg3=
				{
					type="DIALOG",
					rect={0,0,264,205},
					style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_clipself,
					edgecheck=edge_check_show+edge_check_auto,
					visible=0,
					initlayer=msgbox_layer;
					
					bkcolor= { 26, 27, 22, 196 },
					patchrect={3,3,3,2},
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					sizeable=1,
								
					AlignWinRect=function(num,width)
						local itemnum = 10;
						if num < itemnum then itemnum = num; end;
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3.list",itemnum*20,value_channel_winrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3",itemnum*20+5,value_channel_winrect,3);
						
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3.list",itemnum*20,value_channel_clientrect,3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3",itemnum*20+5,value_channel_clientrect,3);
			
						local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg3",value_channel_winrect,3);
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg3.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg3.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
						
						if num <= 10 then
							Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg3.list.vscroll",false);
						end;
						
						end;
		
					OnSelfShow=function()
						local maxlen = 8;
						local tgt,num=GetAutoSearchNpcInfo(3);
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3.list",num,value_channel_item_num);
						for i=1,num do									  
						Win_SetText("UI.gameui.autosearchmgrdlg.listdlg3.list",tgt[i],value_channel_itemtext,i-1);
						
						local len = string.len(tgt[i]);
						if len > maxlen then
							maxlen = len;
						end;
						
						end;				
						
						UI.children.gameui.children.autosearchmgrdlg.children.listdlg3.AlignWinRect(num,maxlen*12+25);
						
						Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg3","UI.gameui.autosearchmgrdlg.check3",aligntype_winrect,alignstyle_left_out+alignstyle_top_in,-3,-3);
						Win_SetFocus("UI.gameui.autosearchmgrdlg.listdlg3.list");
						
						end;		
		
					OnSelfHide=function()
						Win_SetValue("UI.gameui.autosearchmgrdlg.listdlg3.list",0,value_channel_item_num);
						if Win_IsVisible("UI.gameui.autosearchmgrdlg") then
							Win_SetFocus("UI.gameui.autosearchmgrdlg");
						end;
						
						end;
						
					children=
					{
						list=
						{
							type="LISTBOX",
							rect={0,3,264,200},
							style=wgtstyle_vertical+wgtstyle_clipself,
							extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
							richmode=ui_richmode_color,
							dragtype=ui_drag_type_npchintlist2,
							textsize=12,
							sizeable=1,
							
							itemheight=20,
							itemmarginv=0,
							itemmarginh=0,
									
							itemfocusback="res/uires/cdkeydlg/itemsel.gsa",
							itemfocuspos={10,-9,0,0},
							
							updatemute=1,
							
							OnClick=function(sel)
								MoveToNpc(3,sel);
								
								Win_ShowWidget("UI.gameui.autosearchmgrdlg.listdlg3",false);
								Win_ShowWidget("UI.gameui.autosearchmgrdlg",false);
								
								end;
							
							children=
							{
								vscroll=
								{
							
									type="SCROLLBAR",
									rect={0,53,12,160},
									clientrect={0,0,12,160},
									captionrect={0,0,12,160},
									dragrect={0,0,12,160},
									style=wgtstyle_vertical,					
									bkcolor={0,0,0,255},
									edgecolor={128,128,128,255},						
									pagesize=10,
									marginh=3,
									marginv=0,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_right_out+alignstyle_vcenter,	
									extendstyle=scrollbar_auto_hide,
									drawflag=drawflag_win_fill,
									updatemute=1,
									visible=0,
									
									OnSelfShow=function()
										local h = Win_GetValue("UI.gameui.autosearchmgrdlg.listdlg3",value_channel_winrect,3);
										Win_AlignWidget("UI.gameui.autosearchmgrdlg.listdlg3.list.vscroll","UI.gameui.autosearchmgrdlg.listdlg3.list",aligntype_winrect,alignstyle_right_out+alignstyle_top_in,-18,20);
									end;
									
									children=
									{
										blockbtn=
										{
											type="BUTTON",
											rect={0,0,15,20},
											bkimage="res/uires/common/slidebtn.gsa",
											bkimagepos={2,0},
											moveable=1,
											aligntype=aligntype_father+aligntype_clientrect,
											alignstyle=alignstyle_top_in+alignstyle_hcenter,	
											
										};--blockbtn
										
					
										spinup=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/upbtn.gsa",
											style=wgtstyle_primary,
											textstyle=1,		
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_top_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,							
											
										};--spinup
										
										spindown=
										{
											type="SPIN",
											rect={0,0,22,21},
											bkimage="res/uires/common/downbtn.gsa",	
											aligntype=aligntype_father+aligntype_winrect,
											alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
											marginh=0,
											marginv=0,
										};--spindown
										
									};--children
							
								};--scroll
							};
							
						};--list	
						
						
					};
				};
			};
		};
		
		battlemgrdlg=
		{
			type="DIALOG",
			rect={-66,22,74,92},
			visible=0,
			style=wgtstyle_popup+wgtstyle_topmost+wgtstyle_alphawin,
			initlayer=msgbox_layer-1,
			pluslayer=0,
			
			patchrect={3,3,3,2},
			bkcolor={16,16,16,196},
			patchdrawtype=patch_draw_type_scale,
			
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
	
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
			
			OnSelfShow=function()
				Win_AlignWidget("UI.gameui.battlemgrdlg","UI.gameui.sketchbar.sketchmap.fieldmgrbtn",aligntype_winrect,alignstyle_left_out+alignstyle_bottom_out,8,-8);
			
				UI.children.gameui.children.battlemgrdlg.OnUpdateStatus();
				Win_SetFocus("UI.gameui.battlemgrdlg");
				end;
			
			OnUpdateStatus=function()
				local status = GetBattleStatus();
				Win_EnableWidget("UI.gameui.battlemgrdlg.exitbtn",(status<=2 and status >= 0));
				Win_EnableWidget("UI.gameui.battlemgrdlg.enterbtn",(status==2));
				Win_EnableWidget("UI.gameui.battlemgrdlg.escapebtn",(status==4));
				Win_EnableWidget("UI.gameui.battlemgrdlg.infobtn",(status==4));
				end;

			children=
			{									
				exitbtn=
				{
					type="BUTTON",
					rect={2,2,70,22},
					bkimage="res/uires/sketchmap/leavearraybtn.gsa",
					
					OnClick=function()
						Win_ShowMsgBox("您确认要离开排队吗？","系统消息",ui_msgid_yesno,"UI.gameui.battlemgrdlg.exitbtn");
						end;
					
					OnMsgBoxOk=function()
						LeaveQue();
						Win_ShowWidget("UI.gameui.battlemgrdlg",false);
						end;
				};
				
				enterbtn=
				{
					type="BUTTON",
					rect={2,24,70,22},
					bkimage="res/uires/sketchmap/enterfieldbtn.gsa",
					
					OnClick=function()
						EnterBattle();
						Win_ShowWidget("UI.gameui.battlemgrdlg",false);
						end;
				};
				
				escapebtn=
				{
					type="BUTTON",
					rect={2,46,70,22},
					bkimage="res/uires/sketchmap/battleescapebtn.gsa",
					
					OnClick=function()
						EscapeBattle();
						Win_ShowWidget("UI.gameui.battlemgrdlg",false);
						end;
				};
				
				infobtn=
				{
					type="BUTTON",
					rect={2,68,70,22},
					bkimage="res/uires/sketchmap/battleinfobtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.battlemgrdlg",false);
						ViewFieldInfo();
						end;
				};
			};
		};
		
		worldbar=
		{
			type = "DIALOG",
			rect = { 0,0,800,600},						
			
			style=wgtstyle_topmost,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			
			alphaspeed=0.05,
			alphafactor=0.0,	
			updatemute=1,
			initlayer=msgbox_layer - 1,
					
			OnSelfShow=function()
				ToggleMapDiagram(false);
				
				Win_SetFocus("UI.gameui.worldbar");
				Win_SetCapture("UI.gameui.worldbar");
								
				local nLandId=-1;
				
				if GameUI_OnShowMapSwtich(1,15)==true then
				nLandId=1;
				end;
				
				if GameUI_OnShowMapSwtich(2,14)==true then
				nLandId=2;
				end;
				
				if GameUI_OnShowMapSwtich(3,37)==true then
				nLandId=3;
				end;
				
				if GameUI_OnShowMapSwtich(4,17)==true then
				nLandId=4;
				end;
				
				if GameUI_OnShowMapSwtich(5,19)==true then
				nLandId=5;
				end;
				
				if GameUI_OnShowMapSwtich(6,21)==true then
				nLandId=6;
				end;
				
				if GameUI_OnShowMapSwtich(7,7)==true then
				nLandId=7;
				end;				
				
				local openrain = GetOpenRainbow();
				
				local btnwgt="UI.gameui.worldbar.mapswitch.switch0";
				if nLandId ~= 5 then
					if nLandId>0 then				
						Win_SetText(btnwgt,"res/uires/gameui/playericon.gsa",value_channel_coverpic);
				
						local btnrect=Win_GetRect(btnwgt..".mapview"..nLandId,value_channel_winrect);
				
						local bworldbarrect = Win_GetRect("UI.gameui.worldbar", value_channel_winrect);
						local px=btnrect.x+btnrect.w*0.5-22-bworldbarrect.x;
						local py=btnrect.y+btnrect.h*0.5-27-bworldbarrect.y;
						Win_SetValue(btnwgt,px,value_channel_coverpicpos,0);								
						Win_SetValue(btnwgt,py,value_channel_coverpicpos,1);
					else
						Win_SetText(btnwgt,"",value_channel_coverpic);
					end;
				end;
			end;
			
			OnCaptureRelay=function()
				Win_ShowWidget("UI.gameui.worldbar",false);
				end;
				
							
			children=
			{
				MapInfoTip=
				{
					type = "LABEL",
					rect={100,100,24,33},
					coverpic="res/uires/gameui/ballarrow.gsa",
					coverpicpos={-13,35},
					drawcolor={0,0,0,255},
					visible=0,			
					maxwidth=200,
					minheight=41,
					sizeable=1,								
					marginh=12,
					marginv=6,
					textsize=12,
					alphas=0.1,	
					richmode=ui_richmode_all,
					initlayer=systooltip_layer,
					edgecheck=edge_check_show+edge_check_auto,	
					
					patchdrawtype=patch_draw_type_scale,			
					
					patchupleft="res/uires/gameui/ballupleft.gsa",
					patchupright="res/uires/gameui/ballupright.gsa",
					patchdownleft="res/uires/gameui/balldownleft.gsa",
					patchdownright="res/uires/gameui/balldownright.gsa",
					
					patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
					patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
					patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
					patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
					
					patchmiddle="res/uires/gameui/ballmiddle.gsa",
					updatemute=1,
					
					OnRClick=function()
						Win_ShowWidget("UI.gameui.worldbar.MapInfoTip",false);
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.worldbar.MapInfoTip",false);
						end;
						
					OnParseTooltip=function(drgtyp,drgidx,hsttype,hstidx,rx,ry)
						local result=0;
						if (drgtyp>=0) and (drgidx>=0) then
							local info=GetTooltip(drgtyp,drgidx,hsttype,hstidx,rx,ry);
							if info.desc~="" then
								Win_SetText("UI.gameui.worldbar.MapInfoTip",info.desc);
								Win_ShowWidget("UI.gameui.worldbar.MapInfoTip", true);
								result=1;
							end;
						end;
						return result;
					end;
				};	
				
				mapswitch = 
				{
					type = "SWITCHER",
					rect = { 0,0,800,600 },
					switchto=0,
					
					children=
					{
						switch0=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbarglobal.gsa";		
							bkimagepos={0,-47},
							groupid=0,							
							updatemute=1,
							
							OnSelfShow=function()								
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch0");
								end;
				
							children=
							{								
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,2,-1,-1};
									enable=0,
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,2,-1,-1};
									enable=0,
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,2,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								
								mapview1=
								{
									type="BUTTON";
									rect={37,134,-1,-1};
									bkimage="res/uires/sketchmap/mapview1.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",1,value_channel_switch);
										end;
								};
								
								mapview2=
								{
									type="BUTTON";
									rect={261,23,-1,-1};
									bkimage="res/uires/sketchmap/mapview2.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",2,value_channel_switch);										
										end;
								};
								
								
								mapview3=
								{
									type="BUTTON";
									rect={233,348,-1,-1};
									bkimage="res/uires/sketchmap/mapview3.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",3,value_channel_switch);										
										end;
								};
								
								
								mapview4=
								{
									type="BUTTON";
									rect={112,64,-1,-1};
									bkimage="res/uires/sketchmap/mapview4.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",4,value_channel_switch);										
										end;
								};
								
						--[[		mapview5=
								{
									type="BUTTON";
									rect={73,261,-1,-1};
									bkimage="res/uires/sketchmap/mapview5.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",5,value_channel_switch);
										end;
								};
						--]]		
								mapview6=
								{
									type="BUTTON";
									rect={389,149,-1,-1};
									bkimage="res/uires/sketchmap/mapview6.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",6,value_channel_switch);
										end;
								};
								
								mapview7=
								{
									type="BUTTON";
									rect = {-6,155,-1,-1};
									bkimage="res/uires/sketchmap/mapview7.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",7,value_channel_switch);
										end;
								};
								
								mapview8=
								{
									type="BUTTON";
									rect={-1,-1,-1,-1};
									bkimage="res/uires/sketchmap/mapview8.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",8,value_channel_switch);
										end;
								};
								
								mapview10=
								{
									type="BUTTON";
									rect={449,37,181,144};
									bkimage="res/uires/sketchmap/mapview9.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",10,value_channel_switch);
										end;
								};
								
								mapview11=
								{
									type="BUTTON";
									rect={548,108,181,190};
									bkimage="res/uires/sketchmap/mapview11.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=1,
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",11,value_channel_switch);
									end;
								};
								
								mapbg=
								{
									type = "WIDGET",
									rect = { 182,83,1,1 },
									bkimage="res/uires/sketchmap/mapliantiao.gsa";
									initlayer=2,
									--style=wgtstyle_static,
								};
							
								mapview12=
								{
									type="BUTTON";
									rect={252,133,181,190};
									bkimage="res/uires/sketchmap/mapview12.gsa",
									framescheme={{0,0,1,1}},
									style=wgtstyle_autoactive,
									style=wgtstyle_alphawin,
									initlayer=3,
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",12,value_channel_switch);
									end;
								};
				 			};
								
								
						};
						
						switch1=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext1.gsa";
							checkcoverpos={128,159},
							adornpic={"res/uires/sketchmap/worldlabel1.gsa"},
							adornpicpos={{300,70}},
							groupid=1,		
							updatemute=1,							
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
									
									
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",1,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch1");
								end;
							
							OnCheck=function(bcheck)
								for i=0,15 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch1.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch1") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch1",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch1",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={446,248,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn50.gsa",
									tabstop=50,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=0,
									tipwidget="UI.gameui.worldbar.MapInfoTip",
									tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",50,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn1=
								{
									type="BUTTON";
									rect={267,220,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn51.gsa",
									tabstop=51,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=1,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",51,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn2=
								{
									type="BUTTON";
									rect={328,254,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn52.gsa",
									tabstop=52,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=2,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",52,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn3=
								{
									type="BUTTON";
									rect={391,309,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn53.gsa",
									tabstop=53,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=3,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",53,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn4=
								{
									type="BUTTON";
									rect={199,259,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn54.gsa",
									tabstop=54,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=4,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",54,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn5=
								{
									type="BUTTON";
									rect={241,292,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn55.gsa",
									tabstop=55,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=5,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",55,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn6=
								{
									type="BUTTON";
									rect={291,346,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn56.gsa",
									tabstop=56,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=6,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",56,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn7=
								{
									type="BUTTON";
									rect={172,340,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn57.gsa",
									tabstop=57,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=7,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",57,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn8=
								{
									type="BUTTON";
									rect={178,164,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn58.gsa",
									tabstop=58,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=8,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",58,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn9=
								{
									type="BUTTON";
									rect={415,216,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn79.gsa",
									tabstop=79,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=9,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",79,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn10=
								{
									type="BUTTON";
									rect={462,169,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn80.gsa",
									tabstop=80,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=10,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",80,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn11=
								{
									type="BUTTON";
									rect={340,182,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn81.gsa",
									tabstop=81,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=11,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",81,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn12=
								{
									type="BUTTON";
									rect={558,242,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn84.gsa",
									tabstop=84,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=12,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",84,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn13=
								{
									type="BUTTON";
									rect={504,279,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn85.gsa",
									tabstop=85,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=13,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",85,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn14=
								{
									type="BUTTON";
									rect={110,120,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn919.gsa",
									tabstop=919,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=14,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",919,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn15=
								{
									type="BUTTON";
									rect={529,344,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn927.gsa",
									tabstop=927,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=15,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",927,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
							};
						};
						
						switch2=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext2.gsa";
							checkcoverpos={183,172},
							adornpic={"res/uires/sketchmap/worldlabel2.gsa"},
							adornpicpos={{100,70}},							
							groupid=2,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",2,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch2");
								end;
								
							OnCheck=function(bcheck)
								for i=0,14 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch2.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch2") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch2",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch2",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={461,238,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn12.gsa",
									tabstop=12,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=16,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",12,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn1=
								{
									type="BUTTON";
									rect={175,119,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn32.gsa",
									tabstop=32,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=17,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",32,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn2=
								{
									type="BUTTON";
									rect={390,194,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn33.gsa",
									tabstop=33,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=18,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",33,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn3=
								{
									type="BUTTON";
									rect={264,185,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn34.gsa",
									tabstop=34,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=19,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",34,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn4=
								{
									type="BUTTON";
									rect={315,232,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn35.gsa",
									tabstop=35,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=20,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",35,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn5=
								{
									type="BUTTON";
									rect={258,267,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn36.gsa",
									tabstop=36,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=21,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",36,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn6=
								{
									type="BUTTON";
									rect={529,289,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn73.gsa",
									tabstop=73,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=22,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",73,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn7=
								{
									type="BUTTON";
									rect={538,208,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn74.gsa",
									tabstop=74,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=23,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",74,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn8=
								{
									type="BUTTON";
									rect={385,282,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn75.gsa",
									tabstop=75,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=24,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",75,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn9=
								{
									type="BUTTON";
									rect={323,155,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn76.gsa",
									tabstop=76,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=25,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",76,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn10=
								{
									type="BUTTON";
									rect={220,213,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn77.gsa",
									tabstop=77,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=26,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",77,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn11=
								{
									type="BUTTON";
									rect={249,319,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn78.gsa",
									tabstop=78,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=27,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",78,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn12=
								{
									type="BUTTON";
									rect={462,145,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn82.gsa",
									tabstop=82,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=28,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",82,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn13=
								{
									type="BUTTON";
									rect={373,362,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn83.gsa",
									tabstop=83,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=29,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",83,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn14=
								{
									type="BUTTON";
									rect={126,238,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn915.gsa",
									tabstop=915,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=30,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",915,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								
							};
						};
						
						switch3=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext3.gsa";
							checkcoverpos={0,0},							
							adornpic={"res/uires/sketchmap/worldlabel3.gsa"},
							adornpicpos={{100,70}},
							groupid=3,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",3,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch3");
								end;
								
							OnCheck=function(bcheck)
								for i=0,37 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch3.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch3") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch3",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch3",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={378,185,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn2.gsa",
									tabstop=2,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=31,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",2,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn1=
								{
									type="BUTTON";
									rect={374,205,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn3.gsa",
									tabstop=3,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=32,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",3,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn2=
								{
									type="BUTTON";
									rect={479,272,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn4.gsa",
									tabstop=4,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=33,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",4,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};								
								
								mapbtn3=
								{
									type="BUTTON";
									rect={270,214,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn6.gsa",
									tabstop=6,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=34,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",6,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn4=
								{
									type="BUTTON";
									rect={321,219,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn7.gsa",
									tabstop=7,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=35,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",7,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn5=
								{
									type="BUTTON";
									rect={369,273,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn8.gsa",
									tabstop=8,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=36,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",8,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn6=
								{
									type="BUTTON";
									rect={250,241,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn13.gsa",
									tabstop=13,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=37,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",13,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn7=
								{
									type="BUTTON";
									rect={286,283,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn14.gsa",
									tabstop=14,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=38,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",14,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn8=
								{
									type="BUTTON";
									rect={184,246,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn20.gsa",
									tabstop=20,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=39,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",20,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn9=
								{
									type="BUTTON";
									rect={202,281,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn21.gsa",
									tabstop=21,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=40,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",21,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn10=
								{
									type="BUTTON";
									rect={242,314,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn22.gsa",
									tabstop=22,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=41,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",22,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn11=
								{
									type="BUTTON";
									rect={320,310,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn27.gsa",
									tabstop=27,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=42,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",27,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn12=
								{
									type="BUTTON";
									rect={546,268,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn28.gsa",
									tabstop=28,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=43,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",28,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn13=
								{
									type="BUTTON";
									rect={590,293,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn29.gsa",
									tabstop=29,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=44,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",29,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};								
								
								mapbtn14=
								{
									type="BUTTON";
									rect={349,373,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn30.gsa",
									tabstop=30,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=45,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",30,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn15=
								{
									type="BUTTON";
									rect={290,345,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn31.gsa",
									tabstop=31,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=46,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",31,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn16=
								{
									type="BUTTON";
									rect={364,121,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn37.gsa",
									tabstop=37,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=47,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",37,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn17=
								{
									type="BUTTON";
									rect={184,347,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn38.gsa",
									tabstop=38,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=48,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",38,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn18=
								{
									type="BUTTON";
									rect={322,137,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn40.gsa",
									tabstop=40,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=49,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",40,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};								
								
								mapbtn19=
								{
									type="BUTTON";
									rect={450,208,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn41.gsa",
									tabstop=41,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=50,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",41,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn20=
								{
									type="BUTTON";
									rect={315,186,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn42.gsa",
									tabstop=42,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=51,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",42,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn21=
								{
									type="BUTTON";
									rect={416,240,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn43.gsa",
									tabstop=43,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=52,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",43,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn22=
								{
									type="BUTTON";
									rect={240,197,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn44.gsa",
									tabstop=44,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=53,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",44,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn23=
								{
									type="BUTTON";
									rect={423,306,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn45.gsa",
									tabstop=45,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=54,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",45,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn24=
								{
									type="BUTTON";
									rect={179,217,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn46.gsa",
									tabstop=46,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=55,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",46,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn25=
								{
									type="BUTTON";
									rect={397,338,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn47.gsa",
									tabstop=47,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=56,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",47,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn26=
								{
									type="BUTTON";
									rect={399,97,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn48.gsa",
									tabstop=48,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=57,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",48,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn27=
								{
									type="BUTTON";
									rect={460,121,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn49.gsa",
									tabstop=49,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=58,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",49,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn28=
								{
									type="BUTTON";
									rect={433,144,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn61.gsa",
									tabstop=61,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=59,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									visible=0,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",61,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn29=
								{
									type="BUTTON";
									rect={276,383,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn62.gsa",
									tabstop=62,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=60,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									visible=0,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",62,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn30=
								{
									type="BUTTON";
									rect={499,154,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn63.gsa",
									tabstop=63,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=61,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",63,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn31=
								{
									type="BUTTON";
									rect={126,370,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn64.gsa",
									tabstop=64,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=62,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",64,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn32=
								{
									type="BUTTON";
									rect={192,408,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn65.gsa",
									tabstop=65,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=63,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",65,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn33=
								{
									type="BUTTON";
									rect={245,443,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn66.gsa",
									tabstop=66,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=64,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",66,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn34=
								{
									type="BUTTON";
									rect={612,282,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn901.gsa",
									tabstop=901,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=65,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",901,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn35=
								{
									type="BUTTON";
									rect={89,265,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn910.gsa",
									tabstop=910,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=66,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",910,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn36=
								{
									type="BUTTON";
									rect={271,109,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn924.gsa",
									tabstop=924,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=67,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",924,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn37=
								{
									type="BUTTON";
									rect={368,413,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn925.gsa",
									tabstop=925,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=68,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",925,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
							};
						};
						
						switch4=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext4.gsa";
							checkcoverpos={117,154},
							adornpic={"res/uires/sketchmap/worldlabel4.gsa"},
							adornpicpos={{100,70}},
							groupid=4,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",4,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch4");
								end;
								
							OnCheck=function(bcheck)
								for i=0,17 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch4.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch4") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch4",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch4",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={291,155,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn9.gsa",
									tabstop=9,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=69,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",9,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn1=
								{
									type="BUTTON";
									rect={481,281,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn10.gsa",
									tabstop=10,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=70,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",10,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn2=
								{
									type="BUTTON";
									rect={574,325,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn11.gsa",
									tabstop=11,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=71,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",11,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn3=
								{
									type="BUTTON";
									rect={226,205,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn15.gsa",
									tabstop=15,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=72,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",15,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn4=
								{
									type="BUTTON";
									rect={313,252,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn16.gsa",
									tabstop=16,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=73,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",16,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn5=
								{
									type="BUTTON";
									rect={362,282,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn17.gsa",
									tabstop=17,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=74,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",17,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn6=
								{
									type="BUTTON";
									rect={400,318,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn18.gsa",
									tabstop=18,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=75,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",18,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn7=
								{
									type="BUTTON";
									rect={500,350,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn19.gsa",
									tabstop=19,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=76,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",19,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn8=
								{
									type="BUTTON";
									rect={247,271,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn23.gsa",
									tabstop=23,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=77,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",23,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn9=
								{
									type="BUTTON";
									rect={291,311,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn24.gsa",
									tabstop=24,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=78,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",24,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn10=
								{
									type="BUTTON";
									rect={567,255,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn67.gsa",
									tabstop=67,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=79,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",67,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn11=
								{
									type="BUTTON";
									rect={449,251,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn68.gsa",
									tabstop=68,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=80,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",68,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn12=
								{
									type="BUTTON";
									rect={158,179,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn69.gsa",
									tabstop=69,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=81,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",69,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn13=
								{
									type="BUTTON";
									rect={158,252,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn70.gsa",
									tabstop=70,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=82,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",70,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn14=
								{
									type="BUTTON";
									rect={170,319,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn71.gsa",
									tabstop=71,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=83,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",71,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn15=
								{
									type="BUTTON";
									rect={103,198,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn72.gsa",
									tabstop=72,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=84,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",72,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn16=
								{
									type="BUTTON";
									rect={361,122,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn906.gsa",
									tabstop=906,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=85,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",906,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn17=
								{
									type="BUTTON";
									rect={100,278,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn926.gsa",
									tabstop=926,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=86,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",926,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
							};
						};
						
						switch5=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext5.gsa";
							checkcoverpos={10,-32},
							adornpic={"res/uires/sketchmap/worldlabel5.gsa"},
							adornpicpos={{400,64}},
							groupid=5,		
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",5,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch5");
								end;
								
							OnCheck=function(bcheck)
								for i=0,19 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch5.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch5") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch5",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch5",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={115,167,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn86.gsa",
									tabstop=86,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=87,
									initlayer=1,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",86,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn1=
								{
									type="BUTTON";
									rect={182,130,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn88.gsa",
									tabstop=88,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=88,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",88,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn2=
								{
									type="BUTTON";
									rect={308,168,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn110.gsa",
									tabstop=110,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=89,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",110,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn3=
								{
									type="BUTTON";
									rect={348,188,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn111.gsa",
									tabstop=111,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=90,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",111,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn4=
								{
									type="BUTTON";
									rect={409,214,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn112.gsa",
									tabstop=112,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=91,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",112,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn5=
								{
									type="BUTTON";
									rect={204,224,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn87.gsa",
									tabstop=87,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=92,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",87,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn6=
								{
									type="BUTTON";
									rect={260,203,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn89.gsa",
									tabstop=89,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=93,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",89,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn7=
								{
									type="BUTTON";
									rect={465,214,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn91.gsa",
									tabstop=91,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=94,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",91,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn8=
								{
									type="BUTTON";
									rect={257,284,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn92.gsa",
									tabstop=92,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=95,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",92,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn9=
								{
									type="BUTTON";
									rect={296,259,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn107.gsa",
									tabstop=107,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=96,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",107,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn10=
								{
									type="BUTTON";
									rect={358,247,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn108.gsa",
									tabstop=108,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=97,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",108,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn11=
								{
									type="BUTTON";
									rect={472,265,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn929.gsa",
									tabstop=929,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=98,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",929,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn12=
								{
									type="BUTTON";
									rect={511,282,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn930.gsa",
									tabstop=930,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=99,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",930,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn13=
								{
									type="BUTTON";
									rect={198,335,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn93.gsa",
									tabstop=93,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=100,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",93,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn14=
								{
									type="BUTTON";
									rect={312,312,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn928.gsa",
									tabstop=928,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=101,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",928,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn15=
								{
									type="BUTTON";
									rect={367,278,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn109.gsa",
									tabstop=109,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=102,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",109,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn16=
								{
									type="BUTTON";
									rect={383,337,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn90.gsa",
									tabstop=90,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=103,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",90,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn17=
								{
									type="BUTTON";
									rect={490,345,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn931.gsa",
									tabstop=931,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=104,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",931,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn18=
								{
									type="BUTTON";
									rect={316,391,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn94.gsa",
									tabstop=94,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=105,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",94,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								mapbtn19=
								{
									type="BUTTON";
									rect={541,361,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn932.gsa",
									tabstop=932,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=106,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",932,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
							
							
							};
						};
						
						switch6=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext6.gsa";
							checkcoverpos={133,201},
							adornpic={"res/uires/sketchmap/worldlabel6.gsa"},
							adornpicpos={{97,72}},
							groupid=6,		
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",6,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch6");
								end;
								
							OnCheck=function(bcheck)
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch6") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch6",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch6",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								mapbtn0=
								{
									type="BUTTON";
									rect={189,153,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn154.gsa",
									tabstop=154,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=107,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",154,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn1=
								{
									type="BUTTON";
									rect={258,212,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn155.gsa",
									tabstop=155,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=108,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",155,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn2=
								{
									type="BUTTON";
									rect={203,264,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn156.gsa",
									tabstop=156,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=109,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",156,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn3=
								{
									type="BUTTON";
									rect={128,263,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn157.gsa",
									tabstop=157,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=110,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",157,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn4=
								{
									type="BUTTON";
									rect={262,309,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn158.gsa",
									tabstop=158,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=111,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",158,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn5=
								{
									type="BUTTON";
									rect={449,323,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn159.gsa",
									tabstop=159,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=112,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",159,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn6=
								{
									type="BUTTON";
									rect={318,262,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn160.gsa",
									tabstop=160,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=113,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",160,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn7=
								{
									type="BUTTON";
									rect={364,312,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn161.gsa",
									tabstop=161,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=114,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",161,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn8=
								{
									type="BUTTON";
									rect={432,274,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn162.gsa",
									tabstop=162,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=115,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",162,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn9=
								{
									type="BUTTON";
									rect={412,204,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn163.gsa",
									tabstop=163,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=116,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",163,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn10=
								{
									type="BUTTON";
									rect={485,236,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn164.gsa",
									tabstop=164,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=117,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",164,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn11=
								{
									type="BUTTON";
									rect={107,167,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn165.gsa",
									tabstop=165,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=118,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",165,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn12=
								{
									type="BUTTON";
									rect={217,129,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn166.gsa",
									tabstop=166,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=119,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",166,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn13=
								{
									type="BUTTON";
									rect={361,159,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn167.gsa",
									tabstop=167,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=120,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",167,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn14=
								{
									type="BUTTON";
									rect={508,334,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn168.gsa",
									tabstop=168,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=121,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",168,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn15=
								{
									type="BUTTON";
									rect={290,140,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn169.gsa",
									tabstop=169,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=122,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",169,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn16=
								{
									type="BUTTON";
									rect={161,212,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn170.gsa",
									tabstop=170,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=123,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",170,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn17=
								{
									type="BUTTON";
									rect={364,125,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn171.gsa",
									tabstop=171,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=124,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",171,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn18=
								{
									type="BUTTON";
									rect={420,148,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn172.gsa",
									tabstop=172,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=125,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",172,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn19=
								{
									type="BUTTON";
									rect={175,348,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn942.gsa",
									tabstop=942,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=126,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",942,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn20=
								{
									type="BUTTON";
									rect={496,386,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn945.gsa",
									tabstop=945,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=127,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",945,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								mapbtn21=
								{
									type="BUTTON";
									rect={326,189,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn947.gsa",
									tabstop=947,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=128,
									initlayer=1000;
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",947,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
							};
						};
						
						
						switch7=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext7.gsa";
							checkcoverpos={14,-33},
							adornpic={"res/uires/sketchmap/worldlabel7.gsa"},
							adornpicpos={{50,-60}},
							groupid=7,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",7,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch7");
								end;
								
							OnCheck=function(bcheck)
								for i=0,7 do
								Win_EnableWidget("UI.gameui.worldbar.mapswitch.switch7.mapbtn"..i,(bcheck==0));
								end;
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch7") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch7",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch7",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								-- 大洞天
								mapbtn0=
								{
									type="BUTTON";
									rect={505,252,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn183.gsa",
									tabstop=183,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=134,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",183,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 东海之滨
								mapbtn1=
								{
									type="BUTTON";
									rect={556,236,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn184.gsa",	--122
									tabstop=184,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=135,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",184,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 幻海秘境
								mapbtn2=
								{
									type="BUTTON";
									rect={369,215,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn178.gsa",
									tabstop=178,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=129,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",178,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 幻海平原
								mapbtn3=
								{
									type="BUTTON";
									rect = {429,293,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn179.gsa",
									tabstop=179,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=130,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",179,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 深蓝迷域
								mapbtn4=
								{
									type="BUTTON";
									rect={448,209,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn180.gsa",
									tabstop=180,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=131,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",180,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--水灵洞一层
								mapbtn5=
								{
									type="BUTTON";
									rect={550,293,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn949.gsa", --126
									tabstop=949,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=136,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",949,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 小洞天
								mapbtn6=
								{
									type="BUTTON";
									rect={513,201,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn182.gsa", -- 127
									tabstop=182,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=133,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",182,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 幽蓝之境
								mapbtn7=
								{
									type="BUTTON";
									rect={488,322,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn181.gsa", --128
									tabstop=181,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=132,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",181,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 水晶宫
								mapbtn8=
								{
									type="BUTTON";
									rect={318,252,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn191.gsa",
									tabstop=191,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=137,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",191,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 仙贝沙滩
								mapbtn9=
								{
									type="BUTTON";
									rect={407,190,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn199.gsa",
									tabstop=199,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=139,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",199,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 海澜平原
								mapbtn10=
								{
									type="BUTTON";
									rect={393,141,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn198.gsa",
									tabstop=198,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=140,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",198,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 梦龙回廊
								mapbtn11=
								{
									type="BUTTON";
									rect={206,124,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn196.gsa",
									tabstop=196,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=143,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",196,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 深海遗迹
								mapbtn12=
								{
									type="BUTTON";
									rect={122,207,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn197.gsa",
									tabstop=197,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=148,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",197,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 蓝月海坡
								mapbtn13=
								{
									type="BUTTON";
									rect={350,102,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn201.gsa",
									tabstop=201,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=142,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",201,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 人鱼之乡
								mapbtn14=
								{
									type="BUTTON";
									rect={302,191,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn193.gsa",
									tabstop=192,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=138,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",192,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								-- 沉船之地
								mapbtn15=
								{
									type="BUTTON";
									rect={305,143,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn194.gsa",
									tabstop=194,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=141,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",194,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 珊瑚丘陵
								mapbtn16=
								{
									type="BUTTON";
									rect={228,185,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn195.gsa",
									tabstop=195,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=144,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",195,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 碧龙海谷
								mapbtn17=
								{
									type="BUTTON";
									rect={250,218,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn192.gsa",
									tabstop=193,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=145,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",193,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 琉璃径
								mapbtn18=
								{
									type="BUTTON";
									rect={91,256,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn200.gsa",
									tabstop=200,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=147,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",200,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

								-- 幽灵洞
								mapbtn19=
								{
									type="BUTTON";
									rect={158,298,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn953.gsa",
									tabstop=953,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=146,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",953,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};								
							};
						};
						
						switch8=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext8.gsa";
							checkcoverpos={117,154},
							adornpic={"res/uires/sketchmap/worldlabel8.gsa"},
							adornpicpos={{100,70}},
							groupid=8,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",8,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch8");
								end;
								
							OnCheck=function(bcheck)
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch8") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch8",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch8",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
							};
						};
						
						switch9=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							clientrect = { 96,70,616,474 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							groupid=9,
							style=wgtstyle_renderbuffer,
							custombuffer=custom_buffer_diagram,
							updatemute=1,
							
							OnClick=function()
							end;
							
							OnRClick=function()
								--local preswitch=Win_GetValue("UI.gameui.worldbar.mapswitch.switch9",value_channel_customtype);
								--Win_SetValue("UI.gameui.worldbar.mapswitch",preswitch,value_channel_switch);
								local mapid=Win_GetValue("UI.gameui.worldbar.mapswitch.switch9",value_channel_customid);
								WorldMapWalk(mapid);
							end;						
									
							OnSelfShow=function()
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch9");
								local mapid=Win_GetValue("UI.gameui.worldbar.mapswitch.switch9",value_channel_customid);
								local bufinfo=Win_GetCustomBuffer("UI.gameui.worldbar.mapswitch.switch9");
								bufinfo.mapid=mapid;
								Win_SetCustomBuffer("UI.gameui.worldbar.mapswitch.switch9",bufinfo);
								end;					
							
							
							children=
							{								
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										local preswitch=Win_GetValue("UI.gameui.worldbar.mapswitch.switch9",value_channel_customtype);
										Win_SetValue("UI.gameui.worldbar.mapswitch",preswitch,value_channel_switch);
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									enable=0,
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								infolabel=
								{
									type="LABEL";
									rect={564,79,200,22};
									caption="鼠标右键点击后自动寻路";
									textsize=14,
									textfont=1;
									textstyle=dt_left+dt_vcenter,
									drawcolor={0,0,0,255},
									enable=0,
								};
							};
								
						};
						switch10=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext10.gsa";
							checkcoverpos={160,274},
							adornpic={"res/uires/sketchmap/worldlabel10.gsa"},
							adornpicpos={{99,73}},
							groupid=10,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",10,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch10");
								end;
								
							OnCheck=function(bcheck)
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch10") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch10",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch10",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								

								
								--暗之风语谷
								mapbtn0=
								{
									type="BUTTON";
									rect={395,295,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn261.gsa",
									tabstop=261,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=159,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",261,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--暗之入云境
								mapbtn1=
								{
									type="BUTTON";
									rect={497,264,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn259.gsa",
									tabstop=259,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=157,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",259,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--暗之乔木原
								mapbtn2=
								{
									type="BUTTON";
									rect={463,267,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn263.gsa",
									tabstop=263,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=161,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",263,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--暗之逸仙谷
								mapbtn3=
								{
									type="BUTTON";
									rect={525,189,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn264.gsa",
									tabstop=264,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=160,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",264,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--暗之永夜溪
								mapbtn4=
								{
									type="BUTTON";
									rect={423,340,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn262.gsa",
									tabstop=262,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=158,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",262,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--暗之坠星谷
								mapbtn5=
								{
									type="BUTTON";
									rect={467,368,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn260.gsa",
									tabstop=260,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=156,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",260,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--猫猫城
								mapbtn6=
								{
									type="BUTTON";
									rect={340,340,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn247.gsa",
									tabstop=247,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=165,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",247,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--魔涯深渊
								mapbtn7=
								{
									type="BUTTON";
									rect={439,408,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn266.gsa",
									tabstop=266,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=166,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",266,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--圣之足迹
								mapbtn8=
								{
									type="BUTTON";
									rect={260,404,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn258.gsa",
									tabstop=258,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=167,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",258,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之风雨谷
								mapbtn9=
								{
									type="BUTTON";
									rect={105,188,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn253.gsa",
									tabstop=253,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=153,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",253,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之乔木原
								mapbtn10=
								{
									type="BUTTON";
									rect={184,296,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn255.gsa",
									tabstop=255,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=155,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",255,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之入云境
								mapbtn11=
								{
									type="BUTTON";
									rect={260,336,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn251.gsa",
									tabstop=251,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=151,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",251,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之逸仙谷
								mapbtn12=
								{
									type="BUTTON";
									rect={308,289,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn256.gsa",
									tabstop=256,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=154,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",256,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之永夜溪
								mapbtn13=
								{
									type="BUTTON";
									rect={114,267,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn254.gsa",
									tabstop=254,
									framescheme={{1,1,0,0}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=152,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",254,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--天之坠星谷
								mapbtn14=
								{
									type="BUTTON";
									rect={212,346,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn252.gsa",
									tabstop=252,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=150,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",252,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--忘川
								mapbtn15=
								{
									type="BUTTON";
									rect={304,300,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn257.gsa",
									tabstop=257,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=163,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",257,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--忘川2
								mapbtn16=
								{
									type="BUTTON";
									rect={488,288,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn2572.gsa",
									tabstop=257,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=168,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",257,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

							};
						};
						switch11=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar.gsa";
							checkcover="res/uires/sketchmap/worldtext11.gsa";
							checkcoverpos={0,0},
							adornpic={"res/uires/sketchmap/worldlabel11.gsa"},
							adornpicpos={{99,73}},
							groupid=11,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
								end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",11,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch11");
								
										local openrain = GetOpenRainbow();
										--openrain = 1;
										if openrain == 1 then
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn0", "res/uires/sketchmap/mapbtn1000.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn1", "res/uires/sketchmap/mapbtn1001.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn2", "res/uires/sketchmap/mapbtn1002.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn3", "res/uires/sketchmap/mapbtn1003.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn4", "res/uires/sketchmap/mapbtn1004.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn5", "res/uires/sketchmap/mapbtn1005.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn6", "res/uires/sketchmap/mapbtn1006.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn7", "res/uires/sketchmap/mapbtn1007.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn8", "res/uires/sketchmap/mapbtn1008.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn9", "res/uires/sketchmap/mapbtn1009.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn10", "res/uires/sketchmap/mapbtn1010.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn11", "res/uires/sketchmap/mapbtn1011.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn12", "res/uires/sketchmap/mapbtn1012.gsa");
											Win_ShowWidget("UI.gameui.worldbar.mapswitch.switch11.bg", true);
										else
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn0", "res/uires/sketchmap/mapbtn277.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn1", "res/uires/sketchmap/mapbtn273.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn2", "res/uires/sketchmap/mapbtn274.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn3", "res/uires/sketchmap/mapbtn275.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn4", "res/uires/sketchmap/mapbtn276.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn5", "res/uires/sketchmap/mapbtn279.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn6", "res/uires/sketchmap/mapbtn281.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn7", "res/uires/sketchmap/mapbtn280.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn8", "res/uires/sketchmap/mapbtn961.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn9", "res/uires/sketchmap/mapbtn962.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn10", "res/uires/sketchmap/mapbtn963.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn11", "res/uires/sketchmap/mapbtn964.gsa");
											Win_SetBackPic("UI.gameui.worldbar.mapswitch.switch11.mapbtn12", "res/uires/sketchmap/mapbtn1013.gsa");
											Win_ShowWidget("UI.gameui.worldbar.mapswitch.switch11.bg", false);
										end;
								end;
								
							OnCheck=function(bcheck)
								end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
										end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch11") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch11",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch11",true);
										end;
										end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
										end;
								};
								
								
								bg = 
								{
									type="WIDGET";
									bkimage="res/uires/sketchmap/map1008.gsa";
									rect={63,121,-1,-1};
								};
								

								
								--葬花城
								mapbtn0=
								{
									type="BUTTON";
									rect={376,153,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn277.gsa",
									tabstop=277,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=169,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",277,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--伏魔村
								mapbtn1=
								{
									type="BUTTON";
									rect={190,427,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn273.gsa",
									tabstop=273,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=170,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",273,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--清幽小径下
								mapbtn2=
								{
									type="BUTTON";
									rect={149,321,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn274.gsa",
									tabstop=274,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=171,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",274,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--清幽小径上
								mapbtn3=
								{
									type="BUTTON";
									rect={263,359,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn275.gsa",
									tabstop=275,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=172,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",275,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--断肠崖
								mapbtn4=
								{
									type="BUTTON";
									rect={287,266,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn276.gsa",
									tabstop=276,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=173,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",276,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--无间洞
								mapbtn5=
								{
									type="BUTTON";
									rect={468,177,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn279.gsa",
									tabstop=279,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=174,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",279,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--葬花城东街
								mapbtn6=
								{
									type="BUTTON";
									rect={468,235,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn281.gsa",
									tabstop=281,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=175,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",281,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--愁别巷
								mapbtn7=
								{
									type="BUTTON";
									rect={409,299,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn280.gsa",
									tabstop=280,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=176,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",280,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--炼狱【冰】
								mapbtn8=
								{
									type="BUTTON";
									rect={289,119,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn961.gsa",
									tabstop=961,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=177,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",961,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--炼狱【火】
								mapbtn9=
								{
									type="BUTTON";
									rect={471,135,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn962.gsa",
									tabstop=962,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=178,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",962,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--炼狱【暗】
								mapbtn10=
								{
									type="BUTTON";
									rect={348,278,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn963.gsa",
									tabstop=963,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=179,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",963,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--炼狱【雷】
								mapbtn11=
								{
									type="BUTTON";
									rect={368,350,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn964.gsa",
									tabstop=964,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=180,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",964,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--虹村
								mapbtn12=
								{
									type="BUTTON";
									rect={104,221,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn1013.gsa",
									tabstop=1012,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=181,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",965,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};

							};
						};
						switch12=
						{
							type = "WIDGET",
							rect = { 0,0,800,600 },
							bkimage="res/uires/sketchmap/worldbar2.gsa";
							--checkcover="res/uires/sketchmap/worldtext11.gsa";
							--checkcoverpos={0,0},
							--adornpic={"res/uires/sketchmap/worldlabel11.gsa"},
							--adornpicpos={{99,73}},
							groupid=12,	
							updatemute=1,
							
							OnRClick=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
							end;
								
							OnSelfShow=function()
								Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",12,value_channel_customtype);
								Win_SetFocus("UI.gameui.worldbar.mapswitch.switch12");	
							end;
								
							OnCheck=function(bcheck)
							end;
								
							children=
							{
								homebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/homebtn.gsa";
									rect={392,20,-1,-1};
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);										
									end;
								};
								
								textbtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/textbtn.gsa";
									rect={494,20,-1,-1};
									
									OnClick=function()
										if Win_IsChecked("UI.gameui.worldbar.mapswitch.switch12") then
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch12",false);
										else
										Win_SetCheck("UI.gameui.worldbar.mapswitch.switch12",true);
										end;
									end;
								};
								
								closebtn=
								{
									type="BUTTON";
									bkimage="res/uires/sketchmap/closebtn.gsa";
									rect={592,20,-1,-1};
									
									OnClick=function()
										Win_ShowWidget("UI.gameui.worldbar",false);
									end;
								};
											
								--神州城
								mapbtn0=
								{
									type="BUTTON";
									rect={170,240,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn313.gsa",
									tabstop=313,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=183,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
									end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",313,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
									end;
								};
								
								--瀛洲城
								mapbtn1=
								{
									type="BUTTON";
									rect={123,182,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn314.gsa",
									tabstop=314,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=184,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
									end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",314,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
									end;
								};
								
								--蓬莱城
								mapbtn2=
								{
									type="BUTTON";
									rect={317,339,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn315.gsa",
									tabstop=315,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=185,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
									end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",315,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
									end;
								};
								
								--火焰城
								mapbtn3=
								{
									type="BUTTON";
									rect={229,295,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn316.gsa",
									tabstop=316,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=186,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
									end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",316,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
									end;
								};
								
								--幻翼城
								mapbtn4=
								{
									type="BUTTON";
									rect={412,253,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn317.gsa",
									tabstop=317,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=187,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",317,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--神迹城
								mapbtn5=
								{
									type="BUTTON";
									rect={334,221,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn318.gsa",
									tabstop=318,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=188,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",318,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--圣魔城
								mapbtn6=
								{
									type="BUTTON";
									rect={297,155,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn319.gsa",
									tabstop=319,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=189,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",319,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--妖域
								mapbtn7=
								{
									type="BUTTON";
									rect={423,242,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn320.gsa",
									tabstop=320,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=190,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",320,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
								
								--无泪圣殿
								mapbtn8=
								{
									type="BUTTON";
									rect={279,209,-1,-1},
									bkimage="res/uires/sketchmap/mapbtn321.gsa",
									tabstop=321,
									framescheme={{0,0,1,1}},
									style=wgtstyle_alphawin+wgtstyle_autoactive+wgtstyle_renderitem,
									dragtype=ui_drag_type_worldbar,
									dragindex=191,
									tipwidget="UI.gameui.worldbar.MapInfoTip",tipflag=1,
									updatemute=1,
									initlayer=msgbox_layer-1,
									
									OnRClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch",0,value_channel_switch);
										end;								
									
									OnClick=function()
										Win_SetValue("UI.gameui.worldbar.mapswitch.switch9",86,value_channel_customid);
										Win_SetValue("UI.gameui.worldbar.mapswitch",9,value_channel_switch);
										end;
								};
							};
						};
					
					};
				};	
				
			};
			
			
		};
		
		
		cdkeyinquiredlg=
		{
			type="DIALOG";
			rect={0,0,267,355};
			bkimage="res/uires/cdkeydlg/cdkeydlgbk.gsa";
			textsize=12;
			textfont=1;
			style=wgtstyle_topmost;
			moveable=1;
			visible=0;
			updatemute=1,
			
			OnSelfShow=function()
				local num=GetValidActNum();
				Win_SetValue("UI.gameui.cdkeyinquiredlg.activitylist",num,value_channel_item_num);
				if num>0 then
					Win_SetValue("UI.gameui.cdkeyinquiredlg.activitylist",0,value_channel_sel);
					Win_SetValue("UI.gameui.cdkeyinquiredlg.activitylist",0,value_channel_customid);
					local actid = GetActIDByIndex(0);
					SetSelActID(actid);
					local cdkeynum = GetCDKEYNumByID(actid);
					Win_SetValue("UI.gameui.cdkeyinquiredlg.cdkeylist",cdkeynum,value_channel_item_num);
					
					if cdkeynum>0 then
						Win_SetValue("UI.gameui.cdkeyinquiredlg.cdkeylist",0,value_channel_sel);
						end;
					
					end;
				
				Win_AlignWidget("UI.gameui.cdkeyinquiredlg","UI.gameui.lefttoplocalizer",aligntype_winrect,alignstyle_left_in+alignstyle_top_in);
				end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={241,6,20,19};
					defaultcancel=1,					
				};
				
				helpbtn=
				{
					type="BUTTON",
					rect={221,6,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("CDKEY查询");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				activitylist=
				{
					type="LISTBOX",
					rect={24,74,209,137},							
					style=wgtstyle_systemdraw+wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_activitylist,
					textsize=12,

					itemheight=20;
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -11,205,16};
					
					primaryscroll="UI.gameui.cdkeyinquiredlg.activitylistscroll",
					
					OnClick=function()
						local num=Win_GetValue("UI.gameui.cdkeyinquiredlg.activitylist",value_channel_item_num);
						if (num>0) then
							local sel=Win_GetValue("UI.gameui.cdkeyinquiredlg.activitylist",value_channel_sel);
							local actid = GetActIDByIndex(sel);
							SetSelActID(actid);
							
							local oldsel=Win_GetValue("UI.gameui.cdkeyinquiredlg.activitylist",value_channel_customid);
							if oldsel ~= sel then
								Win_SetValue("UI.gameui.cdkeyinquiredlg.activitylist",sel,value_channel_customid);
								local cdkeynum = GetCDKEYNumByID(actid);
								Win_SetValue("UI.gameui.cdkeyinquiredlg.cdkeylist",cdkeynum,value_channel_item_num);
								if cdkeynum>0 then
									Win_SetValue("UI.gameui.cdkeyinquiredlg.cdkeylist",0,value_channel_sel);
									end;
								end;
							end;
						end;

				};
				
				cdkeylist=
				{
					type="LISTBOX",
					rect={24,249,209,88},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_cdkeylist,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -11,205,16};
					
					primaryscroll="UI.gameui.cdkeyinquiredlg.cdkeylistscroll",
					
					OnDBClick=function(idx,wparam,lparam)
						if idx>=0 then
							local nflag=GetBitAnd(wparam,32);
							if nflag~=0 then
								local sel=Win_GetValue("UI.gameui.cdkeyinquiredlg.activitylist",value_channel_sel);
								local actid = GetActIDByIndex(sel);
								CopyCDKEY(actid,idx);
								end;
							end;
						end;
					
				};
				
				activitylistscroll=
				{
			
					type="SCROLLBAR",
					rect={233,92,15,102},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.cdkeyinquiredlg.activitylist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll	
				
				cdkeylistscroll=
				{
			
					type="SCROLLBAR",
					rect={233,267,15,52},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.cdkeyinquiredlg.cdkeylist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll	
				
			};
		};
		
		shopdlg= 
		{
			type = "DIALOG",
			rect = { 0, 0, 804, 464 },
			bkimage="res/uires/rackdlg/shopdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,			
			moveable=1,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			soundid={-1, -1, -1, -1, 1006, 1001},
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.shopdlg",false);
				end;
				
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;
			
			OnCancel=function()
				       Win_ShowWidget("UI.gameui.shopdlg",false);
				       end;
				       
			OnSelfShow=function()
				SetGlobalQuery(GlobalQuery_MagicRackDlg,1);
				
				local money=GetMyJude();			 
				local packweight=GetRackPackWeight();
				local afterweight=GetWeightAfterRackShop();
				
				Win_SetText("UI.gameui.shopdlg.needjudelabel",0);
				Win_SetText("UI.gameui.shopdlg.goodsweigthlabel",0);
				Win_SetText("UI.gameui.shopdlg.myjudelabel",money);
				Win_SetText("UI.gameui.shopdlg.myweightlabel",afterweight-packweight);
				
				Win_ShowWidget("UI.gameui.shopdlg.preview",false);
				
				CancelRackPreviewStatus();
				
				SetRackIndex(0,0);
				SetRackIndex(1,0);
				SetRackIndex(2,0);
				
				for i=2, 8 do
					Win_SetCheck("UI.gameui.shopdlg.tab"..i,false);
					Win_SetValue("UI.gameui.shopdlg.tab"..i..".itemlist",0,value_channel_item_num);
				end;
				
				if Win_IsChecked("UI.gameui.shopdlg.tab1") then
					Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab1",value_channel_customname);
					UpdateRackInfo();
					Win_SetFocus("UI.gameui.shopdlg.tab1");
				else
					Win_SetCheck("UI.gameui.shopdlg.tab1",true);
					Win_SetFocus("UI.gameui.shopdlg.tab1");
				end;
				
				local carnum = GetShopCarItemNum();
				Win_SetValue("UI.gameui.shopdlg.buylist",carnum,value_channel_item_num);
				
				Win_SetText("UI.gameui.shopdlg.searchkeyword", "请输入关键字.");
				Win_SetValue("UI.gameui.shopdlg.searchkeyword",GetColorIndex(96,96,96),value_channel_color_draw); 
				Win_SetValue("UI.gameui.shopdlg.searchkeyword", 0, value_channel_customindex);
				
				RequestNewbieHelp(help_shopdlg);
				SetGlobalQuery(GlobalQuery_ShopDlg, 1);
				g_number_input_callback = nil;	--天降魔珠BUG
				end;
				
			OnSelfHide=function()
				SetGlobalQuery(GlobalQuery_MagicRackDlg,0);
				Win_SetValue("UI.gameui.shopdlg.buylist",0,value_channel_item_num);
				CancelRackPreviewStatus();
				
				RequestNewbieHelp(help_shopdlg,0);
				
				end;
				
			OnCancel=function()
				ClearRack();
				Win_SetValue("UI.gameui.shopdlg.buylist",0,value_channel_item_num);
				Win_ShowWidget("UI.gameui.shopdlg",false);
				end;
			
			OnEscape=function()
				local status = GetRackPreviewStatus();
				if status ~= 0 then
					CancelRackPreviewStatus();
				elseif Win_IsVisible("UI.gameui.shopdlg.preview") then
					Win_ShowWidget("UI.gameui.shopdlg.preview",false);
				else
					ClearRack();
					Win_SetValue("UI.gameui.shopdlg.buylist",0,value_channel_item_num);
					Win_ShowWidget("UI.gameui.shopdlg",false);
				end;
					SetGlobalQuery(GlobalQuery_ShopDlg, 0);
				end;

			children = 
			{				
				searchkeyword=
				{
					type="EDIT",
					--bkcolor = { 255,255, 255, 0 },
					focuscolor = { 0, 0, 0, 255 },
					rect={37,435,429,12},
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					teststyle=dt_left+dt_vcenter,
					
					OnEnter=function()
						UI.children.gameui.children.shopdlg.children.searchbtn.OnClick();
					end;
					
					OnGainFocus=function()
						local n = Win_GetValue("UI.gameui.shopdlg.searchkeyword", value_channel_customindex);
						if n==0 then
							Win_SetText("UI.gameui.shopdlg.searchkeyword", "");
							Win_SetValue("UI.gameui.shopdlg.searchkeyword",GetColorIndex(255,255,255),value_channel_color_draw); 
							Win_SetValue("UI.gameui.shopdlg.searchkeyword", 1, value_channel_customindex);
						end;
					end;
					
					OnLostFocus=function()
						local ctext= Win_GetText("UI.gameui.shopdlg.searchkeyword");
						if ctext=="" then
							Win_SetText("UI.gameui.shopdlg.searchkeyword", "请输入关键字.");
							Win_SetValue("UI.gameui.shopdlg.searchkeyword",GetColorIndex(96,96,96),value_channel_color_draw); 
							Win_SetValue("UI.gameui.shopdlg.searchkeyword", 0, value_channel_customindex);
						end;
					end;
				};
				
				searchbtn=
				{
					type="BUTTON",
					rect={476,425,90,28},
					bkimage="res/uires/rackdlg/searchbtn.gsa",
					
					OnClick=function()
						local keyword=Win_GetText("UI.gameui.shopdlg.searchkeyword");
						local n = Win_GetValue("UI.gameui.shopdlg.searchkeyword", value_channel_customindex);
                                                if n==0 then
                                                     keyword = "";
						end;

                                                if keyword=="" then
							Win_ShowMsgBox("请输入关键字！", "系统消息", ui_msgid_affirm, "UI.gameui.shopdlg.searchbtn");
						else
							local num = SearchGoods(keyword);
							if num == 0 then
								Win_ShowMsgBox("没找到与 "..keyword.." 相关的结果！", "系统消息", ui_msgid_affirm, "UI.gameui.shopdlg.searchbtn");
							else
								Win_SetValue("UI.gameui.shopdlg.tab8",0,value_channel_customtype);
								Win_SetValue("UI.gameui.shopdlg.tab8",0,value_channel_customindex);
								Win_SelectSelf("UI.gameui.shopdlg.tab8");
							end;			
						end;
					end;
				};
				
				newbiecustom=
				{
					type="WIDGET",
					rect={0,0,1,1},
					style=wgtstyle_renderbuffer,
					initlayer=msgbox_layer-1,
					custombuffer=custom_buffer_newbiehelp,
					buffervalue =
					{
						drawtype=help_shopdlg,
						offsetx=192,
						offsety=-17,
					},
					
				};
				
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 775,18,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					
					OnClick=function()
						SetGlobalQuery(GlobalQuery_ShopDlg, 0);
					end;
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 753,18,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						RequestNewbieHelp(help_shopdlg,-1);
						--[[
						local helpid=GetHelpID("物品栏");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						]]
						end;
				};

				preview=
				{
					type="WIDGET",
					rect={242,126,117,143},
					bkimage="res/uires/rackdlg/previewbk.gsa",
					style=wgtstyle_renderbuffer+wgtstyle_clipself,
					custombuffer=custom_buffer_rackpreview,
					initlayer=msgbox_layer-1,
					--tiptext="鼠标右键点击将关闭预览界面",
					visible=0,
					
					OnSelfShow=function()
						Win_SetCapture("UI.gameui.shopdlg.preview");
						end;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.shopdlg.preview",false);
						end;
						
					OnRClick=function()
						Win_ShowWidget("UI.gameui.shopdlg.preview",false);
						end;
				};
				
				tab1=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={1,0,51,28},
					tabcover="res/uires/rackdlg/tab1.gsa",
					tabwintype=tabwin_type_up,							
					groupid=0,
					groupstop=0,
					tabstop=0,
					soundid={1003},
					--checked=1,
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab1.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab1.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
						
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab1",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab1",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab1",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab1",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,0);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab1",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab1",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab1",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab1",0,value_channel_customindex);
						end;
						end;
						
					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab1.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab1.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab1.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab1.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab1.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab1.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab1.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab2=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={53,0,51,28},
					tabcover="res/uires/rackdlg/tab2.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=1,
					tabstop=1,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab2.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab2.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
						
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab2",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab2",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab2",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab2",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,1);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab2",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab2",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab2",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab2",0,value_channel_customindex);
						end;
						end;
						
					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab2.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab2.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab2.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab2.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab2.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab2.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab2.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab3=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={104,0,51,28},
					tabcover="res/uires/rackdlg/tab3.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=2,
					tabstop=2,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab3.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab3.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
						
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab3",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab3",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab3",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab3",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,2);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab3",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab3",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab3",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab3",0,value_channel_customindex);
						end;
						end;

					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab3.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab3.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab3.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab3.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab3.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab3.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab3.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab4=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={155,0,51,28},
					tabcover="res/uires/rackdlg/tab4.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=3,
					tabstop=3,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab4.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab4.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab4",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab4",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab4",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab4",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,3);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab4",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab4",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab4",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab4",0,value_channel_customindex);
						end;
						end;

					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab4.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab4.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab4.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab4.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab4.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab4.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab4.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab5=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={206,0,51,28},
					tabcover="res/uires/rackdlg/tab5.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=4,
					tabstop=4,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab5.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab5.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab5",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab5",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab5",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab5",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,4);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab5",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab5",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab5",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab5",0,value_channel_customindex);
						end;
						end;

					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab5.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab5.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab5.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab5.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab5.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab5.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab5.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};

				
				tab6=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={257,0,51,28},
					tabcover="res/uires/rackdlg/tab6.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=5,
					tabstop=5,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab6.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab6.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
						
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab6",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab6",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab6",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab6",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,5);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab6",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab6",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab6",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab6",0,value_channel_customindex);
						end;
						end;

					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab6.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab6.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab6.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab6.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab6.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab6.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab6.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab7=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={308,0,51,28},
					tabcover="res/uires/rackdlg/tab7.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=6,
					tabstop=6,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab7.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
							Win_SetText("UI.gameui.shopdlg.tab7.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab7",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab7",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab7",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab7",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,6);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab7",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab7",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab7",1,value_channel_timerspace);
								end;
							end;
							
						else
							Win_SetValue("UI.gameui.shopdlg.tab7",0,value_channel_customindex);
						end;
						end;
	
					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab7.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab7.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab7.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab7.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab7.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab7.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab7.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
				
				tab8=
				{
					type="TABWIN",
					rect={155,73,415,348},									
					tabrect={359,0,51,28},
					tabcover="res/uires/rackdlg/tab8.gsa",
					tabwintype=tabwin_type_up,					
					groupid=0,
					groupstop=7,
					tabstop=7,
					soundid={1003},
					
					dragindex=-1,
					dragtype=ui_drag_type_ware_medicine,
					itemdragflag=-1,
					
					OnAddMenu=function(num, namelist)
						Win_SetValue("UI.gameui.shopdlg.tab8.menulist",num,value_channel_item_num);
						for i=0,num-1 do					  
						Win_SetText("UI.gameui.shopdlg.tab8.menulist.shoptabmenu"..i,namelist[i+1]);
						end;
						end;
					
					OnTimer=function()
						Win_SetValue("UI.gameui.shopdlg.tab8",0,value_channel_customtype);
						Win_SetValue("UI.gameui.shopdlg.tab8",0,value_channel_timerspace);
						end;
						
					OnCheck=function(bcheck)
						if bcheck~=0 then
							Win_SetText("UI.gameui.shopdlg","UI.gameui.shopdlg.tab8",value_channel_customname);
							local blstchk = Win_GetValue("UI.gameui.shopdlg.tab8",value_channel_customindex);
							if blstchk == 0 then
								SetRackIndex(0,7);
								SetRackIndex(1,0);
								Win_SetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0,0);
								local cantupdate = Win_GetValue("UI.gameui.shopdlg.tab8",value_channel_customtype);
								if cantupdate == 0 then
									UpdateRackInfo();
									Win_SetValue("UI.gameui.shopdlg.tab8",1,value_channel_customtype);
									Win_SetValue("UI.gameui.shopdlg.tab8",1,value_channel_timerspace);
								end;
							end;
						else
							Win_SetValue("UI.gameui.shopdlg.tab8",0,value_channel_customindex);
						end;
					end;
	
					children=
					{
						menulist=
						{
							type="WIDGETLIST",
							rect={2, 406, 356, 24},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							template={"res/uires/shoptabmenu.lua"};
							children={},
							mornitor={value_channel_sel},
							visible=0;
							
							OnUpdate=function()
								local num = Win_GetValue("UI.gameui.shopdlg.tab8.menulist",value_channel_item_num);
								local sel = Win_GetSelect("UI.gameui.shopdlg.tab8.menulist",0);
								
								if num > 0 and sel >= 0  and sel <= num-1 then
									SetRackIndex(1,sel);
									local num = GetPageNum(GetRackIndex(0),sel);
									UI.children.gameui.children.shopdlg.children.tab8.children.pagectrl.OnAddPage(num);
								end;
								end;
						},
							
						itemlist=
						{
							type="WIDGETLIST",
							rect={-13,2,422,316},
							--style=wgtstyle_clipchild_window,	
							style=wgtstyle_none,
							dragtype=ui_drag_type_racksellist,
							dragindex=-1,
							itemmarginh=16,
							itemmarginv=1,
							itemnum=12,
							
							tipwidget="UI.gameui.ScrnTooltip",
							template={"res/uires/shopitem.lua"};
							
							children={},
						},
						
						pagectrl=
						{
							type="CONTAINER",
							rect={24, 316, 356, 28},
							style=wgtstyle_none,
							itemmarginh=2,
							itemmarginv=2,
							
							OnAddPage=function(num)
								Win_SetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",num,value_channel_item_num);
								
								if num > 0 then
									local ox=Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl",value_channel_winrect,0);
									local ow=Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl",value_channel_winrect,2);
									local itemw=Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist.shopmenupage0",value_channel_winrect,2);
									local startx = ox + (ow-(itemw+8)*num)/2;
									Win_SetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",(itemw+8)*num,value_channel_winrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",(itemw+8)*num,value_channel_clientrect,2);
									Win_SetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",startx,value_channel_winrect,0);
									Win_SetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0,0);
									
									for i=0, num-1 do
										Win_SetText("UI.gameui.shopdlg.tab8.pagectrl.pagelist.shopmenupage"..i, i+1);
									end;
								end;
								end;
							
							children=
							{
								pageupbtn=
								{
									type="BUTTON",
									rect={1,1,71,26},
									bkimage="res/uires/rackdlg/pageup.gsa",
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0);
										if num > 1 and sel > 0 then
											Win_SetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0,sel-1);
										end;
										end;
								},
								
								pagednbtn=
								{
									type="BUTTON",
									rect={285,1,71,26},
									bkimage="res/uires/rackdlg/pagedn.gsa",					
									
									OnClick=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0);
										if num > 1 and sel < num-1 then
											Win_SetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0,sel+1);
										end;
										end;
								},
								
								pagelist=
								{
									type="WIDGETLIST",
									rect={75, 3, 50, 22},
									style=wgtstyle_none,
									itemmarginh=4,
									itemmarginv=0,
									template={"res/uires/shopmenupage.lua"};
									children={},
									
									mornitor={{value_channel_item_num}, {value_channel_sel}},
					
									OnUpdate=function()
										local num = Win_GetValue("UI.gameui.shopdlg.tab8.pagectrl.pagelist",value_channel_item_num);
										local sel = Win_GetSelect("UI.gameui.shopdlg.tab8.pagectrl.pagelist",0);
										if num > 1 then
											if sel == 0 then
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pageupbtn",false);
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pagednbtn",true);
											elseif sel == num - 1 then
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pagednbtn",false);
											else
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pageupbtn",true);
												Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pagednbtn",true);
											end;
										else
											Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pageupbtn",false);
											Win_EnableWidget("UI.gameui.shopdlg.tab8.pagectrl.pagednbtn",false);
										end;
										end;
								},
							},
						};
					},
				};
					
				hotgoods=
				{
					type="CONTAINER",
					rect={37,73,109,348},
					
					SetHotGoods=function(num)
						for i=0, 3 do
							if i < num then
								local name, info = GetHotGoodsInfo(i);
								Win_ShowWidget("UI.gameui.shopdlg.hotgoods.goods"..(i+1),true);
								Win_SetText("UI.gameui.shopdlg.hotgoods.goods"..(i+1)..".goodsname",name);
								Win_SetText("UI.gameui.shopdlg.hotgoods.goods"..(i+1)..".info",info);
							else
								Win_ShowWidget("UI.gameui.shopdlg.hotgoods.goods"..(i+1),false);
								Win_SetText("UI.gameui.shopdlg.hotgoods.goods"..(i+1)..".goodsname","");
								Win_SetText("UI.gameui.shopdlg.hotgoods.goods"..(i+1)..".info","");
							end;
						end;
						end;
					
					children=
					{
						goods1=
						{
							type="CONTAINER",
							rect={2,3,104,75},
							bkimage="res/uires/rackdlg/hotgoodsbk.gsa";
							
							children=
							{
								item=
								{
									type="WIDGET",
									rect={17,3,36,37},
									style=wgtstyle_renderitem,
									dragtype=ui_drag_type_hot_goods,
									dragindex=0,
									tipwidget="UI.gameui.ScrnTooltip",
									
									OnClick=function()
										local status = GetRackPreviewStatus();
										if status ~= 0 and GetHotGoodsNum() >= 1 then
										
											local info = GetRackItemInfo(-1,0,0,0);
											RackPreviewItem(info.ID);
											UI.children.gameui.OnShowRackPreviewDlg(1);
										--elseif GetHotGoodsNum() >= 1 then
										--	Win_ShowMsgBox("您确定要购买该商品吗？","系统消息",ui_msgid_yesno,"UI.gameui.shopdlg.hotgoods.goods1.item");
										end;
										end;
										
									OnMsgBoxOk=function()
											BuyOneHotGoods(0);
										end;
								};
								
								buybtn=
								{
									type="BUTTON",
									rect={78,9,24,24},
									bkimage="res/uires/rackdlg/carbtn.gsa",
									tiptext="加入购物车",
									
									OnClick=function()
										AddGoodsToCar(0,0);
										end;
								};
								
								goodsname=
								{
									type="LABEL",
									rect={0,43,112,13},
									textsize=12,
									textstyle=dt_center+dt_vcenter,
									drawcolor={178,155,110,255},
									editable=0,
									enable=0,
								};
								
								info=
								{
									type="LABEL",
									rect={35,61,44,13},
									textsize=12,
									editable=0,
									enable=0,
								};
							};
						};
						
						goods2=
						{
							type="CONTAINER",
							rect={2,79,104,75},
							bkimage="res/uires/rackdlg/hotgoodsbk.gsa";
							
							children=
							{
								item=
								{
									type="WIDGET",
									rect={17,3,36,37},
									style=wgtstyle_renderitem,
									dragtype=ui_drag_type_hot_goods,
									dragindex=1,
									tipwidget="UI.gameui.ScrnTooltip",
									
									OnClick=function()
										local status = GetRackPreviewStatus();
										if status ~= 0 and GetHotGoodsNum() >= 2 then
											local info = GetRackItemInfo(-1,0,0,1);
											RackPreviewItem(info.ID);
											UI.children.gameui.OnShowRackPreviewDlg(1);
										--elseif GetHotGoodsNum() >= 2 then
										--	Win_ShowMsgBox("您确定要购买该商品吗？","系统消息",ui_msgid_yesno,"UI.gameui.shopdlg.hotgoods.goods2.item");
										end;
										end;
										
									OnMsgBoxOk=function()
											BuyOneHotGoods(1);
										end;
								};
								
								buybtn=
								{
									type="BUTTON",
									rect={78,9,24,24},
									bkimage="res/uires/rackdlg/carbtn.gsa",
									tiptext="加入购物车",
									
									OnClick=function()
										AddGoodsToCar(0,1);
										end;
								};
								
								goodsname=
								{
									type="LABEL",
									rect={0,43,112,13},
									textsize=12,
									textstyle=dt_center+dt_vcenter,
									drawcolor={178,155,110,255},
									editable=0,
									enable=0,
								};
								
								info=
								{
									type="LABEL",
									rect={35,61,44,13},
									textsize=12,
									editable=0,
									enable=0,
								};
							};
						};
						
						goods3=
						{
							type="CONTAINER",
							rect={2,190,106,72},
							bkimage="res/uires/rackdlg/hotgoodsbk.gsa";
							
							children=
							{
								item=
								{
									type="WIDGET",
									rect={17,3,36,37},
									style=wgtstyle_renderitem,
									dragtype=ui_drag_type_hot_goods,
									dragindex=2,
									tipwidget="UI.gameui.ScrnTooltip",
									
									OnClick=function()
										local status = GetRackPreviewStatus();
										if status ~= 0 and GetHotGoodsNum() >= 3 then
											local info = GetRackItemInfo(-1,0,0,2);
											RackPreviewItem(info.ID);
											UI.children.gameui.OnShowRackPreviewDlg(1);
										--elseif GetHotGoodsNum() >= 3 then
										--	Win_ShowMsgBox("您确定要购买该商品吗？","系统消息",ui_msgid_yesno,"UI.gameui.shopdlg.hotgoods.goods3.item");
										end;
										end;
										
									OnMsgBoxOk=function()
											BuyOneHotGoods(2);
										end;
								};
								
								buybtn=
								{
									type="BUTTON",
									rect={76,6,24,24},
									bkimage="res/uires/rackdlg/carbtn.gsa",
									tiptext="加入购物车",
									
									OnClick=function()
										AddGoodsToCar(0,2);
										end;
								};
								
								goodsname=
								{
									type="LABEL",
									rect={4,43,100,13},
									textsize=12,
									textstyle=dt_left+dt_vcenter,
									drawcolor={178,155,110,255},
									editable=0,
									enable=0,
								};
								
								info=
								{
									type="LABEL",
									rect={35,61,44,13},
									textsize=12,
									editable=0,
									enable=0,
								};
							};
						};
						
						goods4=
						{
							type="CONTAINER",
							rect={2,270,106,72},
							bkimage="res/uires/rackdlg/hotgoodsbk.gsa";
							
							children=
							{
								item=
								{
									type="WIDGET",
									rect={17,3,36,37},
									style=wgtstyle_renderitem,
									dragtype=ui_drag_type_hot_goods,
									dragindex=3,
									tipwidget="UI.gameui.ScrnTooltip",
									
									OnClick=function()
										local status = GetRackPreviewStatus();
										if status ~= 0 and GetHotGoodsNum() >= 4 then
											local info = GetRackItemInfo(-1,0,0,3);
											RackPreviewItem(info.ID);
											UI.children.gameui.OnShowRackPreviewDlg(1);
										--elseif GetHotGoodsNum() >= 4 then
										--	Win_ShowMsgBox("您确定要购买该商品吗？","系统消息",ui_msgid_yesno,"UI.gameui.shopdlg.hotgoods.goods4.item");
										end;
										end;
										
									OnMsgBoxOk=function()
											BuyOneHotGoods(3);
										end;
								};
								
								buybtn=
								{
									type="BUTTON",
									rect={76,6,24,24},
									bkimage="res/uires/rackdlg/carbtn.gsa",
									tiptext="加入购物车",
									
									OnClick=function()
										AddGoodsToCar(0,3);
										end;
								};
								
								goodsname=
								{
									type="LABEL",
									rect={4,43,100,13},
									textsize=12,
									textstyle=dt_left+dt_vcenter,
									drawcolor={178,155,110,255},
									editable=0,
									enable=0,
								};
								
								info=
								{
									type="LABEL",
									rect={35,61,44,13},
									textsize=12,
									editable=0,
									enable=0,
								};
							};
						};
						
					};
				};
				
				buylist=
				{
					type="WIDGETLIST";
					rect={581,74,190,223};
					style=wgtstyle_clipchild_window+wgtstyle_vertical,	
					dragtype=ui_drag_type_rackbuylist,
					dragindex=-1,
					primaryscroll="UI.gameui.shopdlg.buyscroll",
					itemmarginh=2,
					itemmarginv=2,
					
					template={"res/uires/shopbuyitem.lua"};
					
					children={},
					
				},--list
				
				buyscroll=
				{
			
					type="SCROLLBAR",
					rect={770,92,20,186},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.shopdlg.buylist",
					
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll

				needjudelabel=
				{
					type="LABEL";
					rect={640,307,46,13};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};

				goodsweigthlabel=
				{
					type="LABEL";
					rect={748,307,46,13};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};

				myjudelabel=
				{
					type="LABEL";
					rect={640,329,46,13};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};

				myweightlabel=
				{
					type="LABEL";
					rect={748,329,46,13};
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};

				buybtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/shopbuybtn.gsa";
					rect={593,348,83,43};
					
					OnClick=function()
						local bowlder = GetMyJude();
						local price=GetTotalJude();
						if bowlder >= price then
							RackBuy();
						else
							Win_ShowMsgBox("您的彩玉不够！", "系统消息", ui_msgid_affirm, "UI.gameui.shopdlg.buybtn");
						end;
					end;
				};
				
				exchangebtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/shopexchangebtn.gsa";
					rect={696,348,85,45};
					enable=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.shopdlg",false);
						Win_ShowWidget("UI.gameui.chongzhidlg",true);
						RequireExchgBowlder();
						end;
				};

				presentbtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/presentbtn.gsa";
					rect={589,392,90,28};
					enable=0,
				};

				previewbtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/previewbtn.gsa";
					rect={693,392,90,28};
					
					OnClick=function()
						RackPreview();
						end;
				};
				
				clearbtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/clearbtn.gsa";
					rect={589,421,90,28};
					
					OnClick=function()
						RackBuyGoodsClear();
						end;
				};

				exitbtn=
				{
					type="BUTTON";
					bkimage="res/uires/rackdlg/exitbtn.gsa";
					rect={693,421,90,28};
					defaultcancel=1,
					
					OnClick=function()
						SetGlobalQuery(GlobalQuery_ShopDlg, 0);
					end;
				};
			},
			
		};
		
		--炼器
		pvprefinedlg=
		{
			type="DIALOG",
			rect={0,0,350,300},
			bkimage="res/uires/refinedlg/refineequipdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.waredlg",true);
				SetGlobalQuery(GlobalQuery_PVPRefineDlg,1);
				end;
				
			OnSelfHide=function()
				ClearPVPRefineState();
				SetGlobalQuery(GlobalQuery_PVPRefineDlg,0);
				end;
			
			OnOk=function()
				Win_ShowWidget("UI.gameui.pvprefinedlg",false);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.pvprefinedlg",false);
				end;
			
			children=
			{
				leftequip=
				{
					type="WIDGET",
					rect={93,59,36,36},
					clientrect={0,3,36,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvprefine_items,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				rightequip=
				{
					type="WIDGET",
					rect={220,59,36,36},
					clientrect={0,3,36,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvprefine_items,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				material=
				{
					type="WIDGET",
					rect={149,96,51,42},
					clientrect={6,5,36,33},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvprefine_items,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				equiplabel=
				{
					type="LABEL",
					rect={59,188,289,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				materiallabel=
				{
					type="LABEL",
					rect={82,205,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				destequiplabel=
				{
					type="LABEL",
					rect={82,223,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				costlabel=
				{
					type="LABEL",
					rect={82,240,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				refinebtn=
				{
					type="BUTTON",
					rect={53,268,70,22},
					bkimage="res/uires/refinedlg/refineequipbtn.gsa",
					
					OnClick=function()
						if IsPRMaterialFit()==false then
							Win_ShowMsgBox("               材质协同提示\n    该名器之魂和装备的协同材质为普通/次级，炼化的效果将降低二级/三级，您确定要炼器吗？","系统消息",ui_msgid_yesno,"UI.gameui.pvprefinedlg.refinebtn");
						elseif IsPREquipHasEffect()==true then
							Win_ShowMsgBox("               二次炼器提示\n    您选择的装备上已经携带有名器之魂的效果，再次炼器将使新的名器之魂取代旧的名器之魂的效果，您确定要炼器吗？","系统消息",ui_msgid_yesno,"UI.gameui.pvprefinedlg.quitbtn");
						else
							PVPRefine();
						end;
						end;
						
					OnMsgBoxOk=function()
						if IsPREquipHasEffect()==true then
							Win_ShowMsgBox("               二次炼器提示\n    您选择的装备上已经携带有名器之魂的效果，再次炼器将使新的名器之魂取代旧的名器之魂的效果，您确定要炼器吗？","系统消息",ui_msgid_yesno,"UI.gameui.pvprefinedlg.quitbtn");
						else
							PVPRefine();
						end;
						end;
				};
				
				quitbtn=
				{
					type="BUTTON",
					rect={234,268,70,22},
					bkimage="res/uires/refinedlg/quitbtn.gsa",
					defaultcancel=1,
					
					OnMsgBoxOk=function()
						PVPRefine();
						end;
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={323,18,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={303,18,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("炼器");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};				
			};
		};
		
		--祭炼
		pvpexrefinedlg=
		{
			type="DIALOG",
			rect={0,0,350,300},
			bkimage="res/uires/refinedlg/superrefineequipdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.waredlg",true);
				SetGlobalQuery(GlobalQuery_PVPExRefineDlg,1);
				end;
				
			OnSelfHide=function()
				ClearPVPExRefineState();
				SetGlobalQuery(GlobalQuery_PVPExRefineDlg,0);
				end;
			
			OnOk=function()
				Win_ShowWidget("UI.gameui.pvpexrefinedlg",false);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.pvpexrefinedlg",false);
				end;
			
			children=
			{
				leftequip=
				{
					type="WIDGET",
					rect={93,59,36,36},
					clientrect={0,3,36,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpexrefine_items,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				rightequip=
				{
					type="WIDGET",
					rect={220,59,36,36},
					clientrect={0,3,36,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpexrefine_items,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				material=
				{
					type="WIDGET",
					rect={149,96,51,42},
					clientrect={6,5,36,33},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpexrefine_items,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				equiplabel=
				{
					type="LABEL",
					rect={59,188,289,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				materiallabel=
				{
					type="LABEL",
					rect={82,205,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				destequiplabel=
				{
					type="LABEL",
					rect={82,223,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				costlabel=
				{
					type="LABEL",
					rect={82,240,266,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				exrefinebtn=
				{
					type="BUTTON",
					rect={53,268,70,22},
					bkimage="res/uires/refinedlg/superrefineequipbtn.gsa",
					
					OnClick=function()
						if IsPEMaterialFit()==false then
							Win_ShowMsgBox("               祭炼材料提示\n    你所选择的需要祭炼的装备和祭炼材料类型不同，请您选择类型匹配的装备和材料进行祭炼","系统消息",ui_msgid_default,"UI.gameui.pvpexrefinedlg.exrefinebtn");
						elseif GetPELavelCompare()==-1 then
							Win_ShowMsgBox("               祭炼材料提示\n    你所选择的需要祭炼的装备星级低于祭炼材料星级，您可以选择祭炼，但是也可以用较低星级的祭炼材料进行祭炼，您确定要祭炼吗？","系统消息",ui_msgid_yesno,"UI.gameui.pvpexrefinedlg.exrefinebtn");
						elseif GetPELavelCompare()==1 then
							Win_ShowMsgBox("               祭炼材料提示\n    你所选择的需要祭炼的装备星级高于祭炼材料星级，无法进行祭炼，请您选择星级匹配的装备和材料进行祭炼","系统消息",ui_msgid_default,"UI.gameui.pvpexrefinedlg.exrefinebtn");
						else
							PVPExRefine();
						end;
						end;
						
					OnMsgBoxOk=function()
						PVPExRefine();
						end;
						
					OnMsgBoxCancel=function()
						Win_ShowWidget("UI.gameui.pvpexrefinedlg",false);
						end;
				};
				
				quitbtn=
				{
					type="BUTTON",
					rect={234,268,70,22},
					bkimage="res/uires/refinedlg/quitbtn.gsa",
					defaultcancel=1,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={323,18,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={303,18,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("祭炼");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};				
			};
		};
		
		--added by qjb 防沉迷提示优化
		aanoticedlg=
		{
			type="WIDGET",
			rect={501,252,222,150},
			initlayer=msgbox_layer-1,
			bkcolor={16,16,16,196},
			style=wgtstyle_cleanwin;
			
			OnSelfShow=function()
				Win_SetPos("UI.gameui.aanoticedlg", 575, 300);
			end;
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.aanoticedlg", false);
			end;
			
			children=
			{
				tiplabel=
				{
					type="LABEL",
					rect={0,0,222,136},
					drawcolor = { 255, 255, 255, 255 },	
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					sizeable=1,						
					marginh=12,
					marginv=6,
					maxwidth=200,
					minwidth=200,
					maxheight=125,
					minheight=125,
					textsize=12,
					textfont=0,
					rowspace=4,
					richmode=ui_richmode_all,
					patchrect={3,3,3,2},
					enable=0,
					patchdrawtype=patch_draw_type_scale,
					
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
			
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					

				};
				
				gotobtn= 
				{
					type = "BUTTON",
					rect = {131,133,92,29},
					bkimage="res/uires/aanoticedlg/gotobtn.gsa",
					style=wgtstyle_alphawin,
					updatemute=1,
					
					OnClick=function()
						OpenIE("http://jkyx.qq.com")
					end;
				};
			};
		};
		
		--融合
		pvpfusedlg=
		{
			type="DIALOG",
			rect={0,0,249,300},
			bkimage="res/uires/refinedlg/fusedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=1,
			updatemute=1,
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.waredlg",true);
				SetGlobalQuery(GlobalQuery_PVPFuseDlg,1);
				end;
			
			OnSelfHide=function()
				ClearPVPFuseState();
				SetGlobalQuery(GlobalQuery_PVPFuseDlg,0);
				end;
			
			OnOk=function()
				
				Win_ShowWidget("UI.gameui.pvpfusedlg",false);
				end;
				
			OnCancel=function()
				
				Win_ShowWidget("UI.gameui.pvpfusedlg",false);
				end;
			
			children=
			{
				item1=
				{
					type="WIDGET",
					rect={59,62,30,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpfuse_items,
					dragindex=0,
					tipwidget="UI.gameui.ScrnTooltip",
				},
				
				item2=
				{
					type="WIDGET",
					rect={115,62,30,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpfuse_items,
					dragindex=1,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				item3=
				{
					type="WIDGET",
					rect={171,62,30,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpfuse_items,
					dragindex=2,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				lmaterial=
				{
					type="WIDGET",
					rect={71,102,50,48},
					clientrect={10,10,30,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpfuse_items,
					dragindex=3,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				rmaterial=
				{
					type="WIDGET",
					rect={138,101,51,50},
					clientrect={11,11,30,30},
					style=wgtstyle_renderitem,
					dragtype=ui_drag_type_pvpfuse_items,
					dragindex=4,
					tipwidget="UI.gameui.ScrnTooltip",
				};
				
				label1=
				{
					type="LABEL",
					rect={85,190,142,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				label2=
				{
					type="LABEL",
					rect={85,207,143,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				label3=
				{
					type="LABEL",
					rect={95,225,133,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				label4=
				{
					type="LABEL",
					rect={75,243,153,14},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				fusebtn=
				{
					type="BUTTON",
					rect={33,268,70,22},
					bkimage="res/uires/refinedlg/fusebtn.gsa",
					defaultok=1,
					
					OnClick=function()
						PVPFuse();
						end;
				};
				
				quitbtn=
				{
					type="BUTTON",
					rect={151,268,70,22},
					bkimage="res/uires/refinedlg/quitbtn.gsa",
					defaultcancel=1,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={223,18,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
					
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={203,18,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("融合");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};				
			};
		};
		
		
		--放出物品进度条
		showitembar=
		{
			type = "WIDGET",
			rect={408,475,140,34},
			style=wgtstyle_cleanwin + wgtstyle_alphawin+wgtstyle_effect;
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter,
			initlayer=0;
			updatemute=1,
			visible=0,
			
			children=
			{
				progbar=
				{
					type="WIDGET",
					rect={12,14,116,13},
					style=wgtstyle_renderbuffer,
					moveable=0,
					custombuffer=custom_buffer_showitembar,
					enable=1;
				}
			};
		};
		
		--放出幻神进度条
		showgodbar=
		{
			type = "WIDGET",
			rect={408,475,140,34},
			style=wgtstyle_cleanwin + wgtstyle_alphawin+wgtstyle_effect;
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter,
			initlayer=0;
			updatemute=1,
			visible=0,
			
			children=
			{
				progbar=
				{
					type="WIDGET",
					rect={12,14,116,13},
					style=wgtstyle_renderbuffer,
					moveable=0,
					custombuffer=custom_buffer_showgodbar,
					enable=1;
				}
			};
		};
		
		--pipo 吟唱时间条
		intonatebar=
		{
			type = "WIDGET",
			rect={408,475,140,34},
			--bkimage="res/uires/common/timebarbk.gsa",
			style=wgtstyle_cleanwin + wgtstyle_alphawin+wgtstyle_effect;
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter,
			initlayer=0;
			updatemute=1,
			visible=0,
			
			children=
			{
				progbar=
				{
					type="WIDGET",
					rect={12,14,116,13},
					style=wgtstyle_renderbuffer,
					moveable=0,
					custombuffer=custom_buffer_singbar,
					enable=1;
				}
			};
		};
		
		timebar=
		{
			type = "WIDGET",
			rect={98,121,125,30},
			bkimage="res/uires/common/timebarbk.gsa",
			style=wgtstyle_cleanwin + wgtstyle_alphawin;
			initlayer=0;
			updatemute=1,
			
			children=
			{
				effect=
				{
					type = "WIDGET",
					rect={0,0,125,30},
					effectpic="res/uires/statusbar/timebareffect.gsa",
					visible=0,
					initlayer=1;
					enable=0;
				};
				progbar=
				{
					type="PROGRESSBAR",
					rect={20,10,85,10},
					progresscover="res/uires/statusbar/timebar.gsa",
					framescheme={{0},{1}},
					delaytime=0.3,
					slowtime=0.0,
					step=2,
					initlayer=2;
					enable=0;
				}
			};
		};
		--left top  children window定位点
		lefttoplocalizer=
		{
			type="WIDGET",
			rect={220,85,5,5},
			visible=0,
			initlayer=0;
		};	
		
		--right top children window定位点
		righttoplocalizer=
		{
			type="WIDGET",
			rect={0,0,5,5},
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,
			marginh=0,
			marginv=56,
			visible=0,
			initlayer=0;
		};
		
		-- right bottom  children window定位点
		rightbottomlocalizer=
		{
			type="WIDGET",
			rect={0,0,5,5},
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_bottom_in,
			marginh=0,
			marginv=-76,
			initlayer=0;
		};	
		
		mapinfotextlabel=
		{
			type="LABEL",
			rect={0,0,309,48},
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_top_in+alignstyle_hcenter,
			alphaspeed=0.1,	
			marginh=0,
			marginv=200,
			initlayer=0;
			visible=0;
			enable=0;
			
			OnTimer=function()
				Win_ShowWidget("UI.gameui.mapinfotextlabel",false);
				end;
				
			OnSelfShow=function()
				Win_SetValue("UI.gameui.mapinfotextlabel",5,value_channel_timerspace);
				end;			
		};

		reqjoinuniondlg=
		{
			type="DIALOG",
			rect={0,0,287,328},
			bkimage="res/uires/manor/reqjoinunionbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.reqjoinuniondlg");	
			end;
				
			OnSelfHide=function()

			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.reqjoinuniondlg",false);
				FamilyLandNoticeRes(false);
			end;

			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={261,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="拒绝",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={240, 10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
							Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
							local helpid=GetHelpID("家族领地");
							Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
							Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				agreebtn=
				{
					type="BUTTON",
					rect={46,280, 67, 26},
					bkimage="res/uires/manor/agreebtn.gsa",
					tiptext="同意",
					OnClick=function()
						FamilyLandNoticeRes(true);
						Win_ShowWidget("UI.gameui.reqjoinuniondlg",false);
					end;
				};
				
				refusebtn=
				{
					type="BUTTON",
					rect={177,280, 67, 26},
					bkimage="res/uires/manor/refusebtn.gsa",
					tiptext="拒绝",
					defaultcancel=1,
					OnClick=function()
					end;
				};
				
				namelabel=
				{
					type="LABEL",
					rect={116, 75, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				leaderlabel=
				{
					type="LABEL",
					rect={116, 111, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				levellabel=
				{
					type="LABEL",
					rect={116, 147, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				onlinelabel=
				{
					type="LABEL",
					rect={116, 184, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				totallabel=
				{
					type="LABEL",
					rect={114, 219, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
			};
		};
		
		-- 设定工资
		setwageratedlg=
		{
			type="DIALOG",
			rect={0, 0,666,369},				
			bkimage="res/uires/manor/setwageratedlgbk.gsa",
			captionrect={250,13,156,12},
			textsize=12,
			textfont=1,			
			caption="发放家族成员工资",
			style=wgtstyle_topmost+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.setwageratedlg", false);
			end;
			
			children=
			{
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 641,11,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="Escape关闭",			
				},
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 621,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						local helpid=GetHelpID("设置工资界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				revenuegoldlabel=
				{
					type="LABEL",
					rect={35,65,60,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				revenuesliverlabel=
				{
					type="LABEL",
					rect={109,65,36,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				revenuecopperlabel=
				{
					type="LABEL",
					rect={159,65,36,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				goldimglabel=
				{
					type="LABEL",
					rect={96,66, 12, 12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},	
					updatemute=1,					
				},
				silverimglabel=
				{
					type="LABEL",
					rect={146, 67, 12, 12},
					bkimage="res/uires/common/silver.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					updatemute=1,
				},
				copperimglabel=
				{
					type="LABEL",
					rect={196, 67,12, 12},
					bkimage="res/uires/common/copper.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					updatemute=1,
				},
				
				wagegoldimglabel=
				{
					type="LABEL",
					rect={127,118,12, 12},
					bkimage="res/uires/common/gold.gsa",
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=1,		
					updatemute=1,					
				},
				wagelabel=
				{
					type="LABEL",
					rect={62,117,60,15},
					textstyle=dt_right+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				rateedit=
				{			
					type="EDIT",
					rect={184, 153, 36, 15},
					textsize=12,	
					enable=1,		
					caption="0";
					textstyle=dt_left+dt_vcenter,
					editmethod=ui_editmethod_number+ui_editmethod_value,	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					maxchar=5,
					minvalue=0,
					maxvalue=100,
					mornitor={value_channel_value},
					
					OnUpdate=function()
						local rate = Win_GetText("UI.gameui.setwageratedlg.rateedit");
						Win_SetValue("UI.gameui.setwageratedlg.wageslider", rate);
						
						SetFMLandPlayerWage(-1, rate);
					
						local iAll = Win_GetText("UI.gameui.setwageratedlg.revenuegoldlabel");
						local iWage = iAll * rate / 100;
						iWage = math.floor(iWage);
						Win_SetText("UI.gameui.setwageratedlg.wagelabel", iWage);
						
						local iAllRate = FamilyLandGetAllWage();
						local iSurplus = iWage - iAllRate;
						Win_SetText("UI.gameui.setwageratedlg.surpluslabel", iSurplus);
						if iSurplus >= 0then
							local color=GetColorIndex(255,255,255);			
							Win_SetValue("UI.gameui.setwageratedlg.surpluslabel", color, value_channel_color_draw);
							if iWage > 0 then
								local iSurplusPercent = math.floor(iSurplus*100/iWage);
								Win_SetText("UI.gameui.setwageratedlg.surpluspercentlabel", iSurplusPercent.."%");
							else
								Win_SetText("UI.gameui.setwageratedlg.surpluspercentlabel", "0%");
							end;
						else
							local color=GetColorIndex(255,0,0);
							Win_SetValue("UI.gameui.setwageratedlg.surpluslabel", color, value_channel_color_draw);							
							Win_SetText("UI.gameui.setwageratedlg.surpluspercentlabel", "0%");
						end;
					end;
				};
				
				surpluslabel=
				{
					type="LABEL",
					rect={476,291, 160,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				surpluspercentlabel=
				{
					type="LABEL",
					rect={346,291,60,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
					caption="0%",
				};
				
				wageslider=
				{
					type="SCROLLBAR",
					rect={31,183,210,14};									
					range={1,100},
					pos=1,
					pagesize=20,
					visible=1,	
					updatemute=1,
					
					OnValueChange=function(pos)
						local rate = Win_GetValue("UI.gameui.setwageratedlg.wageslider",value_channel_pos);
						Win_SetText("UI.gameui.setwageratedlg.rateedit", rate);
					end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,31,16},	
							bkimage="res/uires/sysoption/blockbtn.gsa",
							bkimagepos={0,2},
							framescheme={{0,0,0,1},{0,0,0,1}};
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
						};--blockbtn
					};--children
				};--scroll	
				
				reqwagebtn=
				{
					type="BUTTON",
					rect={319, 325,  90, 22},
					bkimage="res/uires/manor/reqwagebtn.gsa",
					OnClick=function()
						local iSurplus = Win_GetText("UI.gameui.setwageratedlg.surpluslabel");
						iSurplus = iSurplus + 0;
						if iSurplus >= 0 then
							FamilyLandSalaryReq();
						else
							Win_ShowMsgBox("当前工资总额不足, 请重新分配");
						end;
					end;
				};
				
				list=
				{
					type="WIDGETLIST",
					rect={266,52, 353, 215},	
					style=wgtstyle_vertical+wgtstyle_clipchild_window,	
					primaryscroll="UI.gameui.setwageratedlg.scroll",
					itemmarginv=2,
					itemmarginh=0,
					
					template={"res/uires/wageitem.lua"};
					children={},
				},--list
				
				scroll=
				{
			
					type="SCROLLBAR",
					rect={627,63,15,205},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.setwageratedlg.list",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,															
						};--blockbtn
						
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,		
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
				
		--家族领地-2007.07.30
		Manor_NpcBaiHuXingJunDlg=
		{
			type="DIALOG",
			rect={0,0,480,223},
			bkimage="res/uires/manor/baihuxingjundlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				end;
				
			OnSelfHide=function()
				LockPlayer(0);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",false);
				end;
			
			children=
			{
				warhistorybtn= 
				{
					type = "BUTTON",
					rect = { 57,137,108,26 },
					bkimage="res/uires/manor/warhistorybtn.gsa",
					updatemute=1,
					
					OnClick=function()
						FamilyLandHistListReq();
						Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",false);
					end;
				};
				
				startupwarbtn=
				{
					type="BUTTON",
					rect={204,137,91,26},
					bkimage="res/uires/manor/launchwarbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",false);
						Win_ShowWidget("UI.gameui.Manor_StartWarDlg",true);
						end;
				};
				
				joinwarbtn=
				{
					type="BUTTON",
					rect={334, 137,91,26},
					bkimage="res/uires/manor/joinwarbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",false);
						Win_ShowWidget("UI.gameui.fmlandjoinviewdlg",true);
						end;
				};
				
				quitbtn=
				{
					type="BUTTON",
					rect={214,171,67,26},
					bkimage="res/uires/manor/exitbtn.gsa",
					defaultcancel=1,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={453,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={430,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
							Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
							local helpid=GetHelpID("家族领地");
							Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
							Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};	
			};
		};
		
		--发起战争
		Manor_StartWarDlg=
		{
			type="DIALOG",
			rect={0,0,309, 209},
			bkimage="res/uires/manor/startwardlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local num = GetLandWarInfoNum();
				for i=0, num-1 do
					local info = GetLandWarInfo(i);
					if i == 1 then
						Win_SetText("UI.gameui.Manor_StartWarDlg.yeliufengchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_StartWarDlg.yeliufengchengbtn",info.status ~= 0);
					elseif i == 0 then
						Win_SetText("UI.gameui.Manor_StartWarDlg.tianpoyunchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_StartWarDlg.tianpoyunchengbtn",info.status ~= 0);
					end;
				end;
				end;
				
			OnSelfHide=function()
				LockPlayer(0);
				
				Win_SetText("UI.gameui.Manor_StartWarDlg.yeliufengchenglabel","");
				Win_SetText("UI.gameui.Manor_StartWarDlg.tianpoyunchenglabel","");
				Win_EnableWidget("UI.gameui.Manor_StartWarDlg.yeliufengchengbtn",false);
				Win_EnableWidget("UI.gameui.Manor_StartWarDlg.tianpoyunchengbtn",false);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Manor_StartWarDlg",false);
				Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",true);
				end;
				
			children=
			{
				yeliufengchengbtn=
				{
					type="BUTTON",
					rect={45,133,86,24},
					bkimage="res/uires/manor/yeliufengchengbtn.gsa",
					enable=1,
					
					OnClick=function()
						Win_SetValue("UI.gameui.Manor_ViewFamilyInfoDlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.Manor_ViewFamilyInfoDlg",true);
						Win_ShowWidget("UI.gameui.Manor_StartWarDlg",false);
					end;
				};
				
				yeliufengchenglabel=
				{
					type="LABEL",
					rect={147,140,130,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				tianpoyunchengbtn=
				{
					type="BUTTON",
					rect={45,170,86,24},
					bkimage="res/uires/manor/tianpoyunchengbtn.gsa",
					enable=1,
					
					OnClick=function()
						Win_SetValue("UI.gameui.Manor_ViewFamilyInfoDlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.Manor_ViewFamilyInfoDlg",true);
						Win_ShowWidget("UI.gameui.Manor_StartWarDlg",false);
						end;
				};
				
				tianpoyunchenglabel=
				{
					type="LABEL",
					rect={147,177,130,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
			
				closebtn=
				{
					type="BUTTON",
					rect={282,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={259,20,22,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};	
			};
		};
		
		--查看领主的详细信息
		Manor_ViewFamilyInfoDlg=
		{
			type="DIALOG",
			rect={0,0,287,333},
			bkimage="res/uires/manor/viewfamilyinfo.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local opentype = Win_GetValue("UI.gameui.Manor_ViewFamilyInfoDlg",value_channel_customtype);
				local info = GetLandWarInfo(opentype);
				
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.familyname","");
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.cityname","");
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.level","");
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.leader","");
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.nemnum","");
				
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.familyname",info.fmname);
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.cityname",info.city2);
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.level",info.fmlevel);
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.leader",info.leader);
				Win_SetText("UI.gameui.Manor_ViewFamilyInfoDlg.nemnum",info.memonline.."/"..info.memtotal);
			end;
				
			OnSelfHide=function()
				LockPlayer(0);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Manor_ViewFamilyInfoDlg",false);
				Win_ShowWidget("UI.gameui.Manor_StartWarDlg",true);
			end;
				
			children=
			{
				familyname=
				{
					type="LABEL",
					rect={60,75,130,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				cityname=
				{
					type="LABEL",
					rect={60, 110,98,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				level=
				{
					type="LABEL",
					rect={115, 146, 106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				leader=
				{
					type="LABEL",
					rect={116,182,106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				nemnum=
				{
					type="LABEL",
					rect={116, 218,106,12},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				
				quitbtn=
				{
					type="BUTTON",
					rect={167,282, 67, 26},
					bkimage="res/uires/manor/quitbtn.gsa",
					defaultcancel=1,
				};
				
				challengebtn=
				{
					type="BUTTON",
					rect={58, 281, 67, 26},
					bkimage="res/uires/manor/challengebtn.gsa",
					OnClick=function()
						Win_ShowMsgBox("您确认要挑战该领主家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.Manor_ViewFamilyInfoDlg.challengebtn");
					end;
						
					OnMsgBoxOk=function()
						--挑战
						local opentype = Win_GetValue("UI.gameui.Manor_ViewFamilyInfoDlg",value_channel_customtype);
						StartLandWar(opentype);
						Win_ShowWidget("UI.gameui.Manor_ViewFamilyInfoDlg", false);
					end;
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={260,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={239,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
			};
		};
		
		--参与战争
		fmlandjoinviewdlg=
		{
			type="DIALOG",
			rect={0,0,309, 209},
			bkimage="res/uires/manor/fmlandjoinviewbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local num = GetLandWarInfoNum();
				for i=0, num-1 do
					local info = GetLandWarInfo(i);
					if i == 1 then
						Win_SetText("UI.gameui.fmlandjoinviewdlg.yeliufengchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.fmlandjoinviewdlg.yeliufengchengbtn",info.status ~= 0);
					elseif i == 0 then
						Win_SetText("UI.gameui.fmlandjoinviewdlg.tianpoyunchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.fmlandjoinviewdlg.tianpoyunchengbtn",info.status ~= 0);

					end;
				end;
				end;
				
			OnSelfHide=function()
				LockPlayer(0);
				
				Win_SetText("UI.gameui.fmlandjoinviewdlg.yeliufengchenglabel","");
				Win_SetText("UI.gameui.fmlandjoinviewdlg.tianpoyunchenglabel","");
				--Win_EnableWidget("UI.gameui.fmlandjoinviewdlg.yeliufengchengbtn",false);
				--Win_EnableWidget("UI.gameui.fmlandjoinviewdlg.tianpoyunchengbtn",false);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmlandjoinviewdlg",false);
				Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",true);
			end;
				
			children=
			{
				yeliufengchengbtn=
				{
					type="BUTTON",
					rect={45,133,86,24},
					bkimage="res/uires/manor/yeliufengchengbtn.gsa",
					enable=1,
					
					OnClick=function()
						Win_SetValue("UI.gameui.fmlandjoinviewdlg",1,value_channel_customtype);
						Win_ShowWidget("UI.gameui.fmlandjoinviewdlg",false);
						LandWarMenuJoinRes(1);
					end;
				};
				
				yeliufengchenglabel=
				{
					type="LABEL",
					rect={147,140,130,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				tianpoyunchengbtn=
				{
					type="BUTTON",
					rect={45,170,86,24},
					bkimage="res/uires/manor/tianpoyunchengbtn.gsa",
					enable=1,
					
					OnClick=function()
						Win_SetValue("UI.gameui.fmlandjoinviewdlg",0,value_channel_customtype);
						Win_ShowWidget("UI.gameui.fmlandjoinviewdlg",false);
						LandWarMenuJoinRes(0);
						end;
				};
				
				tianpoyunchenglabel=
				{
					type="LABEL",
					rect={147,177,130,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={282,20,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={259,20,22,23};
					bkimage="res/uires/newcommon/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};	
			};
		};
		
		--查看参与列表家族
		fmlandfmviewdlg=
		{
			type="DIALOG",
			rect = { 0, 0,554, 376},	
			bkimage="res/uires/manor/fmlandfmviewbk.gsa",	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				local iAtkCount, iDefCount = GetLandFamilyCount();
				Win_SetValue("UI.gameui.fmlandfmviewdlg.list1", iAtkCount, value_channel_item_num);
				Win_SetValue("UI.gameui.fmlandfmviewdlg.list2", iDefCount, value_channel_item_num);	
				
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmlandfmviewdlg", false);
				Win_ShowWidget("UI.gameui.fmlandjoinviewdlg", true);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={525,11,20,19};
					defaultcancel=1,		
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 503,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("领地战场界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				attackerunionbtn=
				{
					type="WIDGET",
					rect = { 100, 54, 91, 26 },
					bkimage="res/uires/manor/atkeruntionbtn.gsa",	
				};
				
				defenderunionbtn=
				{
					type="WIDGET",
					rect = { 366, 54, 91, 26 },
					bkimage="res/uires/manor/defenderunionbtn.gsa",	
				};
				
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 251, 320, 67,26 },
					bkimage="res/uires/manor/exitbtn.gsa",
					updatemute=1,
					defaultcancel=1,	
				};
				
				list1=
				{
					type="LISTBOX",
					rect={51, 108,185, 180},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_fmview1,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -8,205,16};
					
					primaryscroll="UI.gameui.fmlandfmviewdlg.listscroll1",
					
					OnDBClick=function(idx,wparam,lparam)
						Win_SetValue("UI.gameui.fmlandfmdetaildlg", 0, value_channel_customtype);
						Win_SetValue("UI.gameui.fmlandfmdetaildlg", idx, value_channel_customindex);
						FamilyLandMenuFMReq(0, idx);
					end;
				};
				
				listscroll1=
				{
			
					type="SCROLLBAR",
					rect={245, 118, 15, 155},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=0,
					updatemute=1,
					
					buddywidget="UI.gameui.fmlandfmviewdlg.list1",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
				
				list2=
				{
					type="LISTBOX",
					rect={307, 108, 185, 180},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_fmview2,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -8,205,16};
					
					primaryscroll="UI.gameui.fmlandfmviewdlg.listscroll2",
					
					OnDBClick=function(idx,wparam,lparam)
						Win_SetValue("UI.gameui.fmlandfmdetaildlg", 1, value_channel_customtype);
						Win_SetValue("UI.gameui.fmlandfmdetaildlg", idx, value_channel_customindex);
						FamilyLandMenuFMReq(1, idx);
					end;
				};
				
				listscroll2=
				{
			
					type="SCROLLBAR",
					rect={500, 118, 15, 155},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=0,
					updatemute=1,
					
					buddywidget="UI.gameui.fmlandfmviewdlg.list2",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		--查看参与某单个家族
		fmlandfmdetaildlg=
		{
			type="DIALOG",
			rect = { 0, 0,416, 292},	
			bkimage="res/uires/manor/fmlandfmdetailbk.gsa",	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				Win_ShowWidget("UI.gameui.fmlandfmviewdlg", false);
				local info = GetFMLandFamily();
				Win_SetText("UI.gameui.fmlandfmdetaildlg.namelabel", info.fmname);
				Win_SetText("UI.gameui.fmlandfmdetaildlg.levellabel", info.fmlevel);
				Win_SetText("UI.gameui.fmlandfmdetaildlg.leaderlabel", info.leader);
				Win_SetText("UI.gameui.fmlandfmdetaildlg.countlabel", info.online.."/"..info.total);
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmlandfmdetaildlg", false);
				Win_ShowWidget("UI.gameui.fmlandfmviewdlg", true);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={389,11,20,19};
					defaultcancel=1,		
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 366,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("领地战场界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 178, 244, 67,26 },
					bkimage="res/uires/manor/exitbtn.gsa",
					updatemute=1,
					defaultcancel=1,	
				};
				
				namelabel=
				{
					type="LABEL",
					rect={129, 74, 150, 16},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				levellabel=
				{
					type="LABEL",
					rect={129,  110, 150, 16},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				leaderlabel=
				{
					type="LABEL",
					rect={129, 144, 150, 16},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
				countlabel=
				{
					type="LABEL",
					rect={129,  180, 150, 16},
					textsize=12,
					textstyle=dt_center+dt_vcenter,
				};
			};
		};
		--战争资料馆
		fmlandhistorydlg=
		{
			type="DIALOG",
			rect = { 0, 0, 476, 435},		
			bkimage="res/uires/manor/fmlandhistorybk.gsa",	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmlandhistorydlg", false);
			--	Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg", true);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={448,11,20,19};
					defaultcancel=1,		
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 425,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("领地战场界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 212, 394,67,26 },
					bkimage="res/uires/manor/exitbtn.gsa",
					updatemute=1,
					defaultcancel=1,	
				};
				
				list=
				{
					type="LISTBOX",
					rect={47, 70, 380, 305},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_fmlandhistory,
					textsize=12,
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -12, 205,16};
					
					primaryscroll="UI.gameui.fmlandhistorydlg.listscroll",
					
					OnDBClick=function(idx,wparam,lparam)
						FamilyLandHistDetailReq(idx);
					end;
				};
				
				listscroll=
				{
			
					type="SCROLLBAR",
					rect={427, 81, 15, 280},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=0,
					updatemute=1,
					
					buddywidget="UI.gameui.fmlandhistorydlg.list",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		--历史战争资料
		fmlandhistoryinfodlg=
		{
			type="DIALOG",
			rect = { 0, 0, 277, 384},		
			bkimage="res/uires/manor/historyinfobk.gsa",	
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				local info = GetFMLandHistDetail();
				Win_SetText("UI.gameui.fmlandhistoryinfodlg.contentedit", info);
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.fmlandhistoryinfodlg", false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={250,11,20,19};
					defaultcancel=1,		
					updatemute=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 229,11,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					updatemute=1,
					
					OnClick=function()
						local helpid=GetHelpID("领地战场界面");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
					end;
				};
				
				exitbtn= 
				{
					type = "BUTTON",
					rect = { 102,338,67,26 },
					bkimage="res/uires/manor/exitbtn.gsa",
					updatemute=1,
					defaultcancel=1,	
				};
				
				contentedit=
				{
					type="MULTIEDIT",
					rect={44, 70, 172, 238},	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					textsize=12,
					rowspace=4,
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=5120,		
					editable=0,
					richflag=1,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={181,10,15,215},
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
								
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};
				};--contentedit
			};
		};
		
	
		
		Manor_JoinWarDlg=
		{
			type="DIALOG",
			rect={0,0,300,241},
			bkimage="res/uires/manor/joinwardlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				local num = GetLandWarInfoNum();
				for i=0, num-1 do
					local info = GetLandWarInfo(i);
					if i == 0 then
						Win_SetText("UI.gameui.Manor_JoinWarDlg.yeliufengchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.yeliufengchengbtn",info.status ~= 0);
					elseif i == 1 then
						Win_SetText("UI.gameui.Manor_JoinWarDlg.tianpoyunchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.tianpoyunchengbtn",info.status ~= 0);
					elseif i == 2 then
						Win_SetText("UI.gameui.Manor_JoinWarDlg.fenglanyuechenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.fenglanyuechengbtn",info.status ~= 0);
					elseif i == 3 then
						Win_SetText("UI.gameui.Manor_JoinWarDlg.ziyunxingchenglabel",info.fmname);
						Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.ziyunxingchengbtn",info.status ~= 0);
					end;
				end;
				end;
				
			OnSelfHide=function()
				LockPlayer(0);
				
				Win_SetText("UI.gameui.Manor_JoinWarDlg.yeliufengchenglabel","");
				Win_SetText("UI.gameui.Manor_JoinWarDlg.tianpoyunchenglabel","");
				Win_SetText("UI.gameui.Manor_JoinWarDlg.fenglanyuechenglabel","");
				Win_SetText("UI.gameui.Manor_JoinWarDlg.ziyunxingchenglabel","");
				Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.yeliufengchengbtn",false);
				Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.tianpoyunchengbtn",false);
				Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.fenglanyuechengbtn",false);
				Win_EnableWidget("UI.gameui.Manor_JoinWarDlg.ziyunxingchengbtn",false);
				
				Win_ShowWidget("UI.gameui.Manor_NpcBaiHuXingJunDlg",true);
				
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",false);
				end;
				
			children=
			{
				yeliufengchengbtn=
				{
					type="BUTTON",
					rect={34,127,90,22},
					bkimage="res/uires/manor/yeliufengchengbtn.gsa",
					enable=0;
					
					OnClick=function()
						Win_ShowMsgBox("您确认要挑战该领主家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.Manor_JoinWarDlg.yeliufengchengbtn");
						end;
						
					OnMsgBoxOk=function()
						JoinLandWar(0);
						Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",false);
						end;
				};
				
				yeliufengchenglabel=
				{
					type="LABEL",
					rect={151,131,113,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=0,
				};
				
				tianpoyunchengbtn=
				{
					type="BUTTON",
					rect={34,155,90,22},
					bkimage="res/uires/manor/tianpoyunchengbtn.gsa",
					enable=0,
					
					OnClick=function()
						Win_ShowMsgBox("您确认要挑战该领主家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.Manor_JoinWarDlg.tianpoyunchengbtn");
						end;
						
					OnMsgBoxOk=function()
						JoinLandWar(1);
						Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",false);
						end;
				};
				
				tianpoyunchenglabel=
				{
					type="LABEL",
					rect={151,159,113,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=0,
				};
				
				fenglanyuechengbtn=
				{
					type="BUTTON",
					rect={34,183,90,22},
					bkimage="res/uires/manor/fenglanyuechengbtn.gsa",
					enable=0,
					
					OnClick=function()
						Win_ShowMsgBox("您确认要挑战该领主家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.Manor_JoinWarDlg.fenglanyuechengbtn");
						end;
						
					OnMsgBoxOk=function()
						JoinLandWar(2);
						Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",false);
						end;
				};
				
				fenglanyuechenglabel=
				{
					type="LABEL",
					rect={151,187,113,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=0,
				};
				
				ziyunxingchengbtn=
				{
					type="BUTTON",
					rect={34,209,90,22},
					bkimage="res/uires/manor/ziyunxingchengbtn.gsa",
					enable=0,
					
					OnClick=function()
						Win_ShowMsgBox("您确认要挑战该领主家族吗?","系统消息",ui_msgid_yesno,"UI.gameui.Manor_JoinWarDlg.ziyunxingchengbtn");
						end;
						
					OnMsgBoxOk=function()
						JoinLandWar(3);
						Win_ShowWidget("UI.gameui.Manor_JoinWarDlg",false);
						end;
				};
				
				ziyunxingchenglabel=
				{
					type="LABEL",
					rect={151,213,113,15},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=0,
				};
			
				closebtn=
				{
					type="BUTTON",
					rect={275,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={255,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};	
			};
		};
		
		
		Revenue_ShuiWuGuanDlg=
		{
			type="DIALOG",
			rect={0,0,439,213},
			bkimage="res/uires/manor/shuiwuguandlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			captionrect={51,14,111,13},
			textstyle=dt_center+dt_vcenter,
			textsize=12,
			textfont=1,
			
			OnSelfShow=function()
				--Win_SetText("UI.gameui.Revenue_ShuiWuGuanDlg.cityname","");
				LockPlayer(1);
				
				local mapname=GetCurMapName();
				Win_SetText("UI.gameui.Revenue_ShuiWuGuanDlg",mapname);
				
				end;
				
			OnSelfHide=function()
				LockPlayer(0);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",false);
				end;
				
			children=
			{
				cityname=
				{
					type="LABEL",
					rect={137, 68, 121,16},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=0,
				};
				
				changetaxratebtn=
				{
					type="BUTTON",
					rect={60, 156,90,22},
					bkimage="res/uires/manor/chgtaxratebtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",false);
						Win_ShowWidget("UI.gameui.Revenue_ChangeTaxRateDlg",true);
						
						local info = GetRevenueValue();
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.currate",info.taxrate.."%");
						
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.gold1", info.termtaxgold);
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.silver1", info.termtaxsilver);
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.copper1", info.termtaxcopper);
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.gold2", info.totaltaxgold);
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.silver2", info.totaltaxsilver);
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.copper2", info.totaltaxcopper);
						
						Win_SetValue("UI.gameui.Revenue_ChangeTaxRateDlg.rateslider",info.maxtaxrate,value_channel_maxvalue);
						Win_SetValue("UI.gameui.Revenue_ChangeTaxRateDlg.rateslider",info.mintaxrate,value_channel_minvalue);
						Win_SetValue("UI.gameui.Revenue_ChangeTaxRateDlg.rateslider",info.taxrate,value_channel_pos);
						end;
				};
				
				viewtatalincomebtn=
				{
					type="BUTTON",
					rect={176,156, 90,22},
					bkimage="res/uires/manor/viewtatalincomebtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",false);
						Win_ShowWidget("UI.gameui.Manor_TotalFamilyTaxIncomeDlg",true);
						end;
				};
				
				gettaxbtn=
				{
					type="BUTTON",
					rect={294, 156,90,22},
					bkimage="res/uires/manor/gettaxbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",false);
						Win_ShowWidget("UI.gameui.Revenue_MoneyMgrDlg",true);
						end;
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={411,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={390,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
			};
		};
		
		Revenue_ChangeTaxRateDlg=
		{
			type="DIALOG",
			rect={0,0, 451, 173},
			bkimage="res/uires/manor/changetaxratedlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			captionrect={51,14,111,13},
			textstyle=dt_center+dt_vcenter,
			textsize=12,
			textfont=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local mapname=GetCurMapName();
				Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg",mapname);
			end;
				
			OnSelfHide=function()				
				LockPlayer(0);
				Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",true);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Revenue_ChangeTaxRateDlg",false);
			end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={424,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={400,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
							Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
							local helpid=GetHelpID("家族领地");
							Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
							Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				gold1=
				{
					type="LABEL",
					rect={275, 63, 50,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver1=
				{
					type="LABEL",
					rect={345, 63, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper1=
				{
					type="LABEL",
					rect={384, 63, 20, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				gold2=
				{
					type="LABEL",
					rect={275, 90, 50, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver2=
				{
					type="LABEL",
					rect={345, 90, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper2=
				{
					type="LABEL",
					rect={384, 90, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				currate=
				{
					type="LABEL",
					rect={46, 85,87,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				rateslider=
				{
					type="SCROLLBAR",
					rect={34, 128,287,14},
					range={1,100},		
					enable=1,
				
					OnValueChange=function(pos)
						Win_SetText("UI.gameui.Revenue_ChangeTaxRateDlg.currate",pos.."%");
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,19,14},	
							bkimage="res/uires/qqradio/voiceblock.gsa",
							bkimagepos={0,0},
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
						};
					};
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={326, 124, 44,22},
					bkimage="res/uires/equipdlg/affirmbtn.gsa",	
					enable=1,
					
					OnClick=function()
						local rate = Win_GetValue("UI.gameui.Revenue_ChangeTaxRateDlg.rateslider",value_channel_pos);
						RevenueSetRate(rate);
						Win_ShowWidget("UI.gameui.Revenue_ChangeTaxRateDlg", false);
					end;
					
				};
			};
		};
		
		Revenue_MoneyMgrDlg=
		{
			type="DIALOG",
			rect={0,0,483, 186},
			bkimage="res/uires/manor/moneymgrdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			captionrect={51,14,111,13},
			textstyle=dt_center+dt_vcenter,
			textsize=12,
			textfont=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local right = GetRevenueValue();
				local info = GetRevenueValue();
				
				if (right.playertype == 2) or (right.playertype == 3) then
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.gold1", info.daytaxgold);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.silver1", info.daytaxsilver);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.copper1", info.daytaxcopper);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.gold2", info.taxinhandgold);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.silver2", info.taxinhandsilver);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.copper2", info.taxinhandcopper);
				else
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.putinbtn",false);
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.getoutbtn",false);
				end;
				
				if right.playertype == 3 then
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.gold3", info.fmprivatemoneygold);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.silver3", info.fmprivatemoneysilver);
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.copper3", info.fmprivatemoneycopper);
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.putinbtn",true);
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.getoutbtn",true);
				elseif right.playertype == 2 then
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.gold3", "-");
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.silver3", "-");
					Win_SetText("UI.gameui.Revenue_MoneyMgrDlg.copper3", "-");
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.putinbtn",true);
					Win_EnableWidget("UI.gameui.Revenue_MoneyMgrDlg.getoutbtn",false);
				end;
				
				local mapname=GetCurMapName();
				Win_SetText("UI.gameui.Revenue_MoneyMgrDlg",mapname);
			end;
				
			OnSelfHide=function()
				LockPlayer(0);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Revenue_MoneyMgrDlg",false);
				Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",true);
				Win_SetFocus("UI.gameui.Revenue_ShuiWuGuanDlg");
			end;
				
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={454,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				helpbtn=
				{
					type="BUTTON",
					rect={431,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
					end;
				};
				
				gold1=
				{
					type="LABEL",
					rect={126, 63, 50,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver1=
				{
					type="LABEL",
					rect={197, 63, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper1=
				{
					type="LABEL",
					rect={235, 63, 20, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				gold2=
				{
					type="LABEL",
					rect={126, 92, 50,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver2=
				{
					type="LABEL",
					rect={197, 92, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper2=
				{
					type="LABEL",
					rect={235, 92, 20, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				gold3=
				{
					type="LABEL",
					rect={313, 92, 50,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver3=
				{
					type="LABEL",
					rect={382, 92, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper3=
				{
					type="LABEL",
					rect={421, 92, 20, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				putinbtn=
				{
					type="BUTTON",
					rect={103, 136, 90,22},
					bkimage="res/uires/manor/putinbtn.gsa",
					
					OnClick=function()
						RevenuePutTax(0);
					end;
				};
				
				getoutbtn=
				{
					type="BUTTON",
					rect={312, 136, 90,22},
					bkimage="res/uires/manor/getoutbtn.gsa",
					
					OnClick=function()
						local info = GetRevenueValue();
						Win_ShowWidget("UI.gameui.revenueinputdlg",true);
						Win_SetValue("UI.gameui.revenueinputdlg",1,value_channel_customtype);
						info.fmprivatemoney = info.fmprivatemoney + 0;
						if info.fmprivatemoney > 300000000 then
							info.fmprivatemoney = 300000000
						end;
						
						Win_SetValue("UI.gameui.revenueinputdlg.numslider",info.fmprivatemoney,value_channel_maxvalue);
						Win_SetValue("UI.gameui.revenueinputdlg.numedit",info.fmprivatemoney,value_channel_maxvalue);
						Win_SetValue("UI.gameui.revenueinputdlg.numslider",1);
						Win_SetValue("UI.gameui.revenueinputdlg.numedit",1);						   
						end;
				};
			};
		};
		
		
		Manor_TotalFamilyTaxIncomeDlg=
		{
			type="DIALOG",
			rect={0,0,353, 175},
			bkimage="res/uires/manor/totalfamilytaxdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=0,
			updatemute=1,
			captionrect={51,13,111,15},
			textstyle=dt_center+dt_vcenter,
			textsize=12,
			textfont=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				
				local info = GetRevenueValue();
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.gold1", info.termtaxgold);
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.silver1", info.termtaxsilver);
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.copper1", info.termtaxcopper);
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.gold2", info.totaltaxgold);
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.silver2", info.totaltaxsilver);
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg.copper2", info.totaltaxcopper);
				
				local mapname=GetCurMapName();
				Win_SetText("UI.gameui.Manor_TotalFamilyTaxIncomeDlg",mapname);
			end;
				
			OnSelfHide=function()
				LockPlayer(0);
				
				Win_ShowWidget("UI.gameui.Revenue_ShuiWuGuanDlg",true);
				end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.Manor_TotalFamilyTaxIncomeDlg",false);
				end;
				
			children=
			{
				quitbtn=
				{
					type="BUTTON",
					rect={148, 131, 70,22},
					bkimage="res/uires/manor/quitbtn.gsa",
					defaultcancel=1,
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={326,10,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext="取消",
				},	
				
				helpbtn=
				{
					type="BUTTON",
					rect={305,10,20,19};
					bkimage="res/uires/gameui/helpicon.gsa",
					tiptext="帮助界面",
					
					OnClick=function()
						if Win_IsVisible("UI.gameui.helpwindlg") then
						Win_ShowWidget("UI.gameui.helpwindlg",false);
						else
						local helpid=GetHelpID("家族领地");
						Win_SetValue("UI.gameui.helpwindlg.treelist",helpid,value_channel_sel);
						Win_ShowWidget("UI.gameui.helpwindlg",true);
						end;
						end;
				};
				
				gold1=
				{
					type="LABEL",
					rect={168, 64, 50,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver1=
				{
					type="LABEL",
					rect={238, 64, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper1=
				{
					type="LABEL",
					rect={276, 64, 20, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				
				gold2=
				{
					type="LABEL",
					rect={168, 93, 50, 14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				silver2=
				{
					type="LABEL",
					rect={238, 93, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
				copper2=
				{
					type="LABEL",
					rect={276, 93, 20,14},
					textstyle=dt_center+dt_vcenter,
					textsize=12,
					enable=1,
				};
			};
			
		};
		
		
		revenueinputdlg=
		{
			type="DIALOG",
			rect={0,0,147,41},
			dragrect={0,0,147,41},			
			moveable=1,
			style=wgtstyle_popup+wgtstyle_topmost,
			bkimage="res/uires/gameui/numinput.gsa",
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()					   
				cursorinfo=Win_GetCursorInfo();					   
				Win_SetPos("UI.gameui.revenueinputdlg",cursorinfo.x-131,cursorinfo.y-37);					   
				Win_SetValue("UI.gameui.revenueinputdlg.numedit",0,value_channel_range_begin);
				Win_SetValue("UI.gameui.revenueinputdlg.numedit",999999,value_channel_range_end);	
				Win_SetFocus("UI.gameui.revenueinputdlg.numedit");					   
			end;
						
			OnOk=function()	
				 local num = Win_GetValue("UI.gameui.revenueinputdlg.numedit");
				 local opentype = Win_GetValue("UI.gameui.revenueinputdlg",value_channel_customtype);
				 
				 if opentype == 0 then
					RevenuePutTax(num);
				 elseif opentype == 1 then
					RevenueGetTax(num);
				 end;
				 
				Win_ShowWidget("UI.gameui.Revenue_MoneyMgrDlg", false);
			end;
			
			
			OnEnter=function()
				     Win_EndWidget("UI.gameui.revenueinputdlg",true);				     
				     end;
				     
			children=
			{					
				numedit=
				{
					type="EDIT",
					rect={24,7,54,12},
					editmethod=ui_editmethod_number+ui_editmethod_value,	
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					maxchar=10,
					drawcolor={255,255,255,255},
					textsize=12,
					minvalue=1,
					
					mornitor={value_channel_value},
					
					OnUpdate=function()
						local editpos=Win_GetValue("UI.gameui.revenueinputdlg.numedit");
						local sliderpos=Win_GetValue("UI.gameui.revenueinputdlg.numslider");
						if editpos~=sliderpos then
						Win_SetValue("UI.gameui.revenueinputdlg.numslider",editpos);
						end;
						end;
						
					children=
					{
						spinleft=
						{
							type="SPIN",
							rect={-22,-4,15,20},
							bkimage="res/uires/gameui/spinleft.gsa",
							updatemute=1,
						},
						
						spinright=
						{
							type="SPIN",
							rect={59,-4,15,20},
							bkimage="res/uires/gameui/spinright.gsa",
						        style=wgtstyle_primary,
							updatemute=1,
						},
						
					},		
				},
				
				affirmbtn=
				{
					type="BUTTON",
					rect={100,2,44,22},
					bkimage="res/uires/gameui/inputbtn.gsa",
					defaultok=1,
					updatemute=1,
				},
				
				minbtn=
				{
					type="BUTTON",
					rect={2,26,18,10},
					bkimage="res/uires/common/minbtn.gsa",
					updatemute=1,
					
					OnClick=function()						
						Win_SetValue("UI.gameui.revenueinputdlg.numedit",1);						
						end;
					
				},
				
				maxbtn=
				{
					type="BUTTON",
					rect={124,28,18,10},
					bkimage="res/uires/common/maxbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						local maxnum=Win_GetValue("UI.gameui.revenueinputdlg.numedit",value_channel_maxvalue);
						Win_SetValue("UI.gameui.revenueinputdlg.numedit",maxnum);						
						end;		
						
				},
				
				numslider=
				{
			
					type="SCROLLBAR",
					rect={21,27,104,14};									
					range={1,100},					
					pagesize=2,	
					updatemute=1,					
					
					OnValueChange=function(pos)
						Win_SetValue("UI.gameui.revenueinputdlg.numedit",pos);
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,24,14},	
							bkimage="res/uires/gameui/smallslide.gsa",
							bkimagepos={0,0},
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_left_in+alignstyle_vcenter,	
							
						};--blockbtn
										
						
					};--children
					
				};--scroll		
				
			},
			
		};
			
		--求婚申请
		proposemarriagedlg=
		{
			type = "DIALOG",
			rect ={0,0,357,338},
			bkimage="res/uires/marriagesys/proposedlgbk.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnRClick=function()
				Win_ShowWidget("UI.gameui.proposemarriagedlg",false);
			end;
				
			OnSelfShow=function()	
				LockPlayer(1);
				Win_SetText("UI.gameui.proposemarriagedlg.lovername", "");
				Win_SetText("UI.gameui.proposemarriagedlg.marriagetype", "");
				Win_SetText("UI.gameui.proposemarriagedlg.cost", "");
				Win_SetText("UI.gameui.lovewordsdlg.lovewordsedit", "");
				Win_SetText("UI.gameui.proposemarriagedlg.effectintro", "");
				Win_EnableWidget("UI.gameui.proposemarriagedlg.affirmbtn", false);
			end;
				
			OnSelfHide=function()
				LockPlayer(0);
				if Win_IsVisible("UI.gameui.lovewordsdlg") then
					Win_ShowWidget("UI.gameui.lovewordsdlg", false);
				end;
			end;
				
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 330,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 311,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
						end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={71,294,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					soundid={1005},			
					
					OnClick=function()
						local buddyName = Win_GetText("UI.gameui.proposemarriagedlg.lovername");
						local marriageType = Win_GetText("UI.gameui.proposemarriagedlg.marriagetype");
						if buddyName == "" then
							MarriageLogInfo("请输入求婚对象的名字!");
						elseif not IsGMBuddy(buddyName) then
							MarriageLogInfo("只能向自己的好友求婚!");
						elseif marriageType == "" then
							MarriageLogInfo("请选择求婚方式!");
						else
							local lovewords = Win_GetText("UI.gameui.lovewordsdlg.lovewordsedit");
							ProposeMarriage(g_PlayerInfo.name, buddyName, marriageType, lovewords);
							Win_ShowWidget("UI.gameui.proposemarriagedlg", false);
						end;
					end;
				},
		
				cancelbtn=
				{
					type="BUTTON",
					rect={228,294,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
				};
				
				--对象名字
				lovername=
				{
					type="EDIT",
					rect={34,69,118,15},
					focuscolor = { 0, 0, 0, 255 },
					textsize=12,
					editmethod = ui_editmethod_english+ui_editmethod_chinese+ui_editmethod_number+ui_editmethod_symbol,	
					maxchar=16,
					editable=1,
				};
				--好友列表按钮
				friendslistbtn=
				{
					type = "CHECK",
					rect = {151,68,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnCheck=function(bChecked)
						if bChecked==1 then
							local info, friendsnum = GetFriendsList(); -- 符合条件的好友数目
							if friendsnum > 0 then
								Win_SetValue("UI.gameui.listdlg",501,value_channel_customtype);
								Win_ShowWidget("UI.gameui.listdlg",true);
							end;
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				--写下真情告白
				lovewordsbtn=
				{
					type="BUTTON",
					rect={195,68,74,16},
					bkimage="res/uires/marriagesys/lovewordsbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.lovewordsdlg", true);
						Win_SetFocus("UI.gameui.lovewordsdlg");
					end;
				};
				
				--求婚方式
				marriagetype=
				{
					type = "LABEL",
					rect={34,117,118,15},
					--focuscolor = { 0, 0, 0, 255 },
					textsize=12,
				};
				
				--求婚方式列表
				marriagetypelistbtn=
				{
					type = "CHECK",
					rect = {151,117,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnCheck=function(bChecked)
						if bChecked==1 then
							Win_SetValue("UI.gameui.listdlg",502,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				
				--花费
				cost=
				{
					type = "LABEL",
					rect={198,118,135,12},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
				};
				
				--特效说明
				effectintro=
				{
					type="LABEL",
					rect={38,176,288,98},
					textsize=12,
				};
			};
		};

		--真情告白
		lovewordsdlg=
		{
			type="DIALOG",
			rect={0,0,357,257},
			bkimage="res/uires/marriagesys/lovewordsdlgbk.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 330,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
					OnClick = function()
						Win_SetText("UI.gameui.lovewordsdlg.lovewordsedit", "");
					end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 311,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={39,216,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},			
				},
		
				cancelbtn=
				{
					type="BUTTON",
					rect={255,216,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",	
					defaultcancel=1,
					soundid={1007},
					
					OnClick = function()
						Win_SetText("UI.gameui.lovewordsdlg.lovewordsedit", "");
					end;
				};
				
				lovewordsedit=
				{
					type="MULTIEDIT",
					rect={37,70,265,123},
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,
					rowspace=4,
					maxchar=240,
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={275,14,15,94},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
			};
		};
		
		--接收求婚申请
		acceptproposedlg=
		{
			type="DIALOG",
			rect={0,0,357,257},
			captionrect={31,10,278,17},
			bkimage="res/uires/marriagesys/acceptproposedlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			moveable=1,
			textsize=12,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 330,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.acceptproposedlg", false);
					end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 311,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				proposerlabel=
				{
					type="LABEL",
					rect={31,44,278,17},
					textsize=12,
					textstyle=dt_left+dt_bottom,
				};
				
				lovewordsedit=
				{
					type="MULTIEDIT",
					rect={38,70,265,123},
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,
					rowspace=4,
					maxchar=262,--"他(她)想对你说的话："多了这几个字符
					editable = 0,
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={275,13,15,94},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				--[[lovewordslist=
				{
					type="WIDGETLIST",
					rect={38,70,265,123},
					
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static,
					updatemute=1,
					
					primaryscroll="UI.gameui.acceptproposedlg.vscroll",
										
					children=
					{
						--说明
						infolabel=
						{
							
							type="LABEL",
							rect={0,0,265,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
						
						
					},-- children
					
				},--]]
				--[[lovewordslabel=
				{
					type="LABEL",
					rect={38,70,265,123},
					textsize=12,
					textstyle=dt_left+dt_top,
					rowspace=4,
					maxchar=240,	

					primaryscroll="UI.gameui.acceptproposedlg.vscroll"
				};--]]
				
				--[[vscroll=
				{
					type="SCROLLBAR",
					rect={312,83,15,94},
					style=wgtstyle_vertical,					
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					
					buddywidget="UI.gameui.acceptproposedlg.lovewordslist",
														
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
	
						spinup=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,22,21},
							bkimage="res/uires/common/downbtn.gsa",												
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
						};--spindown
						
					};--children
					
				};--scroll--]]
				
				idobtn=
				{
					type="BUTTON",
					rect={79,213,70,22},
					bkimage="res/uires/marriagesys/idobtn.gsa",
					defaultok=1,
					
					OnClick=function()
						local marriageid = Win_GetValue("UI.gameui.acceptproposedlg", value_channel_customid);
						local proposer = Win_GetText("UI.gameui.acceptproposedlg", value_channel_customname);
						AcceptProposeMarriage(0, marriageid, proposer);
						Win_ShowWidget("UI.gameui.acceptproposedlg", false);
					end;
				};
				
				idonotbtn=
				{
					type="BUTTON",
					rect={216,214,70,22},
					bkimage="res/uires/marriagesys/idonotbtn.gsa",
					defaultcancel=1,
					
					OnClick=function()
						local marriageid = Win_GetValue("UI.gameui.acceptproposedlg", value_channel_customid);
						local proposer = Win_GetText("UI.gameui.acceptproposedlg", value_channel_customname);
						AcceptProposeMarriage(1, marriageid, proposer);
						Win_ShowWidget("UI.gameui.acceptproposedlg", false);
					end;
				};
			};
		};	

		
		--婚礼进行对话框
		weddingdlg=
		{
			type="DIALOG",
			rect={0,0,503,257},
			bkimage="res/uires/marriagesys/weddingdlgbk.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			
			OnSelfShow=function()
				LockPlayer(1);
				--Win_SetText("UI.gameui.weddingdlg.acceptbtn",  "res/uires/marriagesys/felldownbtn.gsa", value_channel_backpic);
				--Win_SetText("UI.gameui.weddingdlg.refusebtn",  "res/uires/marriagesys/refusebtn.gsa", value_channel_backpic);
				local txtleft, txtright = GetMarriageWords();
				Win_SetText("UI.gameui.weddingdlg.leftlabel", txtleft);
				Win_SetText("UI.gameui.weddingdlg.rightlabel", txtright);
				Win_EnableWidget("UI.gameui.weddingdlg.acceptbtn", true);
				Win_EnableWidget("UI.gameui.weddingdlg.refusebtn", true);
				
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;	
			
			children=
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 476,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					
					OnClick=function()
						RefuseMarriage(2);
						Win_ShowWidget("UI.gameui.weddingdlg", false);
					end;
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 457,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				leftlabel=
				{
					type="LABEL",
					rect={37,55,183,140},
					textstyle=dt_left+dt_top,
					textsize=12,
					rowspace=4,
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={191,13,15,109},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll				
					};
		
				};
				
				rightlabel=
				{
					type="LABEL",
					rect={268,55,183,140},
					textstyle=dt_left+dt_top,
					textsize=12,
					rowspace=4,

					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={191,13,15,109},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
			
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll					
					};

				};
				
				acceptbtn=
				{
					type="BUTTON",
					rect={280,212,70,22},
					bkimage="res/uires/marriagesys/felldownbtn.gsa",
					enable=1;
					
					OnClick=function()
						DoneMarriage();
						Win_EnableWidget("UI.gameui.weddingdlg.acceptbtn", false);
						Win_EnableWidget("UI.gameui.weddingdlg.refusebtn", false);
					end;
				};
				
				refusebtn=
				{
					type="BUTTON",
					rect={400,212,70,22},
					bkimage="res/uires/marriagesys/refusebtn.gsa",
					enable=1;
					defaultcancel = 1;
					
					OnClick=function()
						RefuseMarriage(1);
						Win_ShowWidget("UI.gameui.weddingdlg", false);
					end;
				};
			};
		};
		
		
		--受邀婚礼列表
		invitationlistdlg=
		{
			type="DIALOG",
			rect={0,0,357,257},
			bkimage="res/uires/marriagesys/invitationdlgbk.gsa",
			style=wgtstyle_topmost,
			moveable=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			
			OnSelfShow=function()
				LockPlayer(1);
				local info, num = GetBeInvitedlist();
				if num == 0 then
					Win_SetValue("UI.gameui.invitationlistdlg.invitationlist", 1 ,value_channel_item_num);
					Win_SetText("UI.gameui.invitationlistdlg.invitationlist","你当前没有受邀参加的婚礼在进行中",value_channel_itemtext,0);
					Win_ShowWidget("UI.gameui.invitationlistdlg.attendweddingbtn", false);
				else
					Win_SetValue("UI.gameui.invitationlistdlg.invitationlist", num ,value_channel_item_num);
					for i = 1, num do
						Win_SetText("UI.gameui.invitationlistdlg.invitationlist",info[i],value_channel_itemtext,i-1);
					end;
					Win_SetValue("UI.gameui.invitationlistdlg.invitationlist",-1,value_channel_sel);
					Win_ShowWidget("UI.gameui.invitationlistdlg.attendweddingbtn", true);
					Win_EnableWidget("UI.gameui.invitationlistdlg.attendweddingbtn", false);
				end;
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			children=
			{
				invitationlist=
				{
					type="LISTBOX",
					rect={37,56,266,136},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter;
					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					
					OnClick=function()
						Win_EnableWidget("UI.gameui.invitationlistdlg.attendweddingbtn", true);
					end;
					
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={275,13,15,109},
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,15,36},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
								};--blockbtn
		
								spinup=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,22,21},
									bkimage="res/uires/common/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
								};--spindown
							};--children
						};--scroll				
					};
				};
			
				miniclosebtn = 
				{
					type = "BUTTON",
					rect = { 330,10,20,19 },
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 311,10,20,19 },
					bkimage="res/uires/gameui/helpicon.gsa",
					
					OnClick=function()
					end;
				};
				
				attendweddingbtn=
				{
					type="BUTTON",
					rect={42,211,90,22},
					bkimage="res/uires/marriagesys/attendweddingbtn.gsa",
					visible = 0;
					
					OnClick = function()
						local sel = Win_GetValue("UI.gameui.invitationlistdlg.invitationlist",value_channel_sel);
						if sel ~= -1 then
							EnterMrgMap(sel);
							Win_ShowWidget("UI.gameui.invitationlistdlg", false);
						end;
					end;
				};
				
				closebtn=
				{
					type="BUTTON",
					rect={241,211,70,22},
					bkimage="res/uires/marriagesys/closebtn.gsa",
					defaultcancel = 1;
					
					OnClick = function()
						Win_ShowWidget("UI.gameui.invitationlistdlg", false);
					end;
				};
				
			};
		};

		--婚礼准备1
		marriagePreparedlg_One=
		{
			type = "DIALOG",
			rect = {0, 0, 369, 378},
			bkimage = "res/uires/marriagesys/prepare_1.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			OnSelfShow=function()
				LockPlayer(1);
				temp = GetCurTime();
				text = "请选择一周内的时间!当前时间是:"..temp;
				Win_SetText("UI.gameui.marriagePreparedlg_One.date_lbl", "");
				Win_SetText("UI.gameui.marriagePreparedlg_One.hour_lbl", "");
				Win_SetValue("UI.gameui.marriagePreparedlg_One.confirmtm_btn",-1,value_channel_timerspace);
				Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",true);
				--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.ex_chk", false);
				--Win_SetCheck("UI.gameui.marriagePreparedlg_One.ex_chk", false);

				Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "0");
				--if GetMarriageState() == 13 then
					-- 如果还没设置过婚期
					--Win_SetText("UI.gameui.marriagePreparedlg_One.next_btn",  "res/uires/marriagesys/next.gsa", value_channel_backpic);
				--elseif GetMarriageState() == 14 then
					--Win_SetText("UI.gameui.marriagePreparedlg_One.next_btn",  "res/uires/marriagesys/done.gsa", value_channel_backpic);
				--end;
				--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
				
				

				Win_SetText("UI.gameui.marriagePreparedlg_One.map_lbl", "");
				Win_SetCheck("UI.gameui.marriagePreparedlg_One.noinvitation_chk", true);
				Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", 0);
				Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", 0);
				Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", 0);
				local jew = Win_GetText("UI.gameui.marriagePreparedlg_One.jewlabel");
				--if jew == "5200" and GetMyJude() < 5200 then
					-- 彩玉不足
					--Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "/C205200");
				--else
					--Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", jew);
				--end;
				Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
				
				
				Win_SetCheck("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk", false);
				Win_SetCheck("UI.gameui.marriagePreparedlg_One.canzhuo_chk", false);
				Win_SetCheck("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk", false);
				Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.marriagePreparedlg_One",false);
			end;
			
			OnSelfHide=function()
				LockPlayer(0);
			end;
				
			children =
			{

				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 341,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
				},
				--日期
				date_lbl=
				{
					type="LABEL",
					rect={44,119,97,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--日期　按钮
				date_btn=
				{
					type = "CHECK",
					rect = {138,116,20,19 },
					bkimage = "res/uires/newcommon/downbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.date_btn") then
							Win_SetValue("UI.gameui.listdlg",503,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				--时刻
				hour_lbl=
				{
					type="LABEL",
					rect={192,117,29,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--时刻按钮
				hour_btn=
				{
					type = "CHECK",
					rect = {219,115,20,19 },
					bkimage = "res/uires/newcommon/downbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hour_btn") then
							Win_SetValue("UI.gameui.listdlg",504,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				--确定时间
				confirmtm_btn=
				{
					type = "BUTTON",
					rect = {268,113,90,30},
					bkimage="res/uires/marriagesys/confirmtm.gsa",
					tiptext = "确定婚礼日期",
					
					--[[OnMouseIn=function()
						Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl","更改婚礼时间!点击后5秒方可再次更改...");
					end;	
					
					OnMouseOut=function()
						temp = GetCurTime();
						text = "请选择一周内的时间!当前时间是:"..temp;
						Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl",text);
					end;--]]
						
					OnClick = function()
						local dat = Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl");
						local hour = Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl");
						if dat ~=""  and hour ~= "" then
							Win_SetValue("UI.gameui.marriagePreparedlg_One.confirmtm_btn",3,value_channel_timerspace);
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",false);
							ConfirmMarriageTime(dat, hour);
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", true);
						else 
							
							temp = GetCurTime();
							text = "请选择一周内的时间!当前时间是:"..temp;
							GameUILogInfo(text);
							--Win_SetText("UI.gameui.marriagePreparedlg_One.tip_lbl",text);
						end;
					end;		
					
					OnTimer=function()
						--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.confirmtm_btn",true);
					end;
				};
				--提示信息
				--tip_lbl=
				--{
					--type = "LABEL";
					--rect={38,93,200,55},
					--textsize=12,
					--richmode=ui_richmode_color+ui_richmode_font,
					--visible=1,
				--};
				--是否独占时段
				
				--[[
				ex_chk= 
				{
					type = "CHECK",
					rect={39,159,66,16};
					textsize=12,
					drawcolor={206,178,140,255},
					bkimage = "res/uires/common/checkbox.gsa",
					
					OnCheck=function(bchecked)
						if bchecked == 1 then
							if GetMyJude() < 5200 then
								-- 彩玉不足以独占
								Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "/C205200彩玉");
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", false);
							else
								Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "5200彩玉");
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", true);
							end;
						else 
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "0彩玉");
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.next_btn", true);
						end;
					end;											
				};
				--]]
				--[[goldlabel=
				{
					type="LABEL",
					rect={86,189,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					--enable=0,					
				},
				silverlabel=
				{
					type="LABEL",
					rect={134,189,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					--enable=0,
				},
				copperlabel=
				{
					type="LABEL",
					rect={182,189,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					--enable=0,
				},--]]
				jewlabel=
				{
					type="LABEL",
					rect={95,310,48,12},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--下一步
				
				--[[
				next_btn=
				{
					type = "BUTTON",
					rect = {27,218,70,22},
					visible=1,
					
					OnClick=function()
						local dat = Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl");
						local hour = Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl");
						local IsEx;
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.ex_chk") then
							IsEx = 1;
						else 
							IsEx = 0;
						end;
						if GetMarriageState() == 13 then
							-- 如果还没设置过婚期
							Win_ShowWidget("UI.gameui.marriagePreparedlg_One", false);
							Win_ShowWidget("UI.gameui.marriagePreparedlg_Two", true);
						elseif GetMarriageState() == 14 then
							if dat ~= ""  and hour ~= "" and IsEx == 1 then
								Win_ShowMsgBox("你选择/C20独占/C00"..dat..hour.."作为婚礼日期，需要扣除5200彩玉，是否确定进入下一步设置?确定后即使你中止婚礼设置,没有完成婚礼准备,或者以后取消婚礼,费用都不会返还!请注意!","系统消息",ui_msgid_yesno, "UI.gameui.marriagePreparedlg_One.next_btn");
							elseif dat ~= ""  and hour ~= "" and IsEx == 0 then 
								DoneMarriagePreOne(dat, hour, IsEx);
							end;
						end;
					end;
					
					OnMsgBoxOk = function()
						local dat = Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl");
						local hour = Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl");
						local IsEx;
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.ex_chk") then
							IsEx = 1;
						else 
							IsEx = 0;
						end;
						if dat ~= ""  and hour ~= "" then
							DoneMarriagePreOne(dat, hour, IsEx);
						end;
					end;
				};
				]]--
				--取消
				cancel_btn=
				{
					type = "BUTTON",
					rect = {245,342,69,24},
					bkimage="res/uires/sysdlg/cancelbtn.gsa",
					defaultcancel = 1;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.marriagePreparedlg_One",false);
					end;
				};
				
				
				--婚礼地图
				map_lbl=
				{
					type="LABEL",
					rect={51,70,280,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--婚礼地图 按钮
				map_btn=
				{
					type = "CHECK",
					rect = {333,68,20,19},
					bkimage = "res/uires/newcommon/downbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.map_btn") then
							Win_SetValue("UI.gameui.listdlg",506,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				
				--不需要请柬
				noinvitation_chk= 
				{
					type = "CHECK",
					rect={50,261,66,16};
					textsize=12,
					drawcolor={229,183,83,255},
					bkimage = "res/uires/newcommon/checkbox.gsa",
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							Win_SetCheck("UI.gameui.marriagePreparedlg_One.common_chk", false);
							Win_SetText("UI.gameui.marriagePreparedlg_One.common_edt", "");
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.common_edt", false);
						end;
					end;											
				};
				
				--选择普通请柬
				common_chk= 
				{
					type = "CHECK",
					rect={50,238,66,16};
					textsize=12,
					drawcolor={229,183,83,255},
					bkimage = "res/uires/newcommon/checkbox.gsa",
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.common_edt", true);
							Win_SetCheck("UI.gameui.marriagePreparedlg_One.noinvitation_chk", false);
						else 
							Win_SetText("UI.gameui.marriagePreparedlg_One.common_edt", "0");
							Win_EnableWidget("UI.gameui.marriagePreparedlg_One.common_edt", false);
							local totalmoney = GetMarriageMoney("婚礼地图", Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl"));
							local gold=math.floor(totalmoney/1000000);
							local silver=math.floor((totalmoney-gold*1000000)/1000);
							local copper=math.floor(totalmoney-gold*1000000-silver*1000);
							if totalmoney > GetMoney() then
								Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", "/C20"..tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", "/C20"..tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", "/C20"..tostring(copper));
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
							else
								Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", tostring(copper));
								--if Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl") ~= "" then
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", true);
								--else
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
								--end;
							end;
						end;
					end;											
				};

				common_edt=
				{	
					type = "EDIT";
					rect={127,239,119,14},
					editmethod = ui_editmethod_number+ui_editmethod_value,						
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					minvalue=0,
					maxvalue=999,
					mornitor={value_channel_value},
					
					OnValueChange=function()
						local maxnum = Win_GetValue("UI.gameui.marriagePreparedlg_One.common_edt", value_channel_maxvalue);
						local num = Win_GetValue("UI.gameui.marriagePreparedlg_One.common_edt");
						if maxnum >= num then
							local mapmoney = GetMarriageMoney("婚礼地图", Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl"));
							local commoney = num * GetMarriageMoney("请帖", "普通请帖");
							local totalmoney = mapmoney + commoney;
							local gold=math.floor(totalmoney/1000000);
							local silver=math.floor((totalmoney-gold*1000000)/1000);
							local copper=math.floor(totalmoney-gold*1000000-silver*1000);
							if totalmoney > GetMoney() then
								Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", "/C20"..tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", "/C20"..tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", "/C20"..tostring(copper));
								Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
							else
								Win_SetText("UI.gameui.marriagePreparedlg_One.goldlabel", tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_One.silverlabel", tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_One.copperlabel", tostring(copper));
								--if Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl") ~= "" then
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", true);
								--else-
									--Win_EnableWidget("UI.gameui.marriagePreparedlg_One.done_btn", false);
								--end;
							end;
						end;
					end;
				};
				
				
				done_btn=
				{
					type = "BUTTON",
					rect = {79,342,69,24},
					bkimage="res/uires/sysdlg/affirmbtn.gsa",
					defaultok = 1;
					
					OnClick=function()
						local IsEx = 0;
						local dat = Win_GetText("UI.gameui.marriagePreparedlg_One.date_lbl");
						local hour = Win_GetText("UI.gameui.marriagePreparedlg_One.hour_lbl");
						local map = Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl");
						local num = Win_GetValue("UI.gameui.marriagePreparedlg_One.common_edt");
						local money = tonumber(Win_GetText("UI.gameui.marriagePreparedlg_One.copperlabel"))
								+ 1000*tonumber(Win_GetText("UI.gameui.marriagePreparedlg_One.silverlabel"))
								+ 1000*1000*tonumber(Win_GetText("UI.gameui.marriagePreparedlg_One.goldlabel"));
						local jewel = Win_GetText("UI.gameui.marriagePreparedlg_One.jewlabel");
						--if jewel == "5200彩玉" then
							--jewel = 5200;
						--else
							--jewel = 0;
						--end;
						
						local jiuzhuo,canzhuo,hongbaozhuo;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk") then
							jiuzhuo = 1;
						else
							jiuzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.canzhuo_chk") then
							canzhuo = 1;
						else
							canzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk") then
							hongbaozhuo = 1;
						else
							hongbaozhuo = 0;
						end;
						
						if map == "" then
							GameUILogInfo("地图不得为空");
							return;
						end;
						
						if GetMarriageTime() == 0 then
							GameUILogInfo("请先设置婚期");
							return;
						end;
						
						
						
						if string.find(jewel,"/C20") ~= nil then
							GameUILogInfo("您的彩玉不足!");
							return;
						end;
						
						--jiuzhuo = Win_GetCheck("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk");
						--canzhuo = Win_GetCheck("UI.gameui.marriagePreparedlg_One.canzhuo_chk");
						--hongbaozhuo = Win_GetCheck("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk");
						
						SetMarriageInfo(IsEx, map, num, money, jewel,jiuzhuo,canzhuo,hongbaozhuo);
						
						if GetMarriageState() == 13 then
							-- 如果还没设置过婚期
							Win_ShowWidget("UI.gameui.marriagePreparedlg_One", true);
						elseif GetMarriageState() == 14 then
							DoneMarriagePreOne(dat, hour, IsEx);
						end;
						
						Win_ShowWidget("UI.gameui.marriagePreparedlg_One", false);
						Win_ShowWidget("UI.gameui.marriageInfodlg_One", true);
					end;
				};
				
				
				goldlabel=
				{
					type="LABEL",
					rect={101,284,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,					
				},
				silverlabel=
				{
					type="LABEL",
					rect={150,284,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,
				},
				copperlabel=
				{
					type="LABEL",
					rect={200,284,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,
				};
				
				--酒桌
				jiuzhuo_chk= 
				{
					type = "CHECK",
					rect={50,168,40,16};
					textsize=12,
					drawcolor={229,183,83,255},
					bkimage = "res/uires/newcommon/checkbox.gsa",
					
					OnCheck=function(bChecked)
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk") then
							jiuzhuo = 1;
						else
							jiuzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.canzhuo_chk") then
							canzhuo = 1;
						else
							canzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk") then
							hongbaozhuo = 1;
						else
							hongbaozhuo = 0;
						end;
						
						local map = Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl");
						
						local ibowlder2 = MapMoney(map);
						
						local ibowlder = ComputeMoney(jiuzhuo,canzhuo,hongbaozhuo);
						
						ibowlder = ibowlder + ibowlder2;
						
						if GetMyJude() < ibowlder then
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel","/C20"..ibowlder);
						else
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel",ibowlder);
						end;
						
							
					end;
				},
				
				--餐桌
				canzhuo_chk= 
				{
					type = "CHECK",
					rect={122,168,40,16};
					textsize=12,
					drawcolor={229,183,83,255},
					bkimage = "res/uires/newcommon/checkbox.gsa",
					
					OnCheck=function(bChecked)
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk") then
							jiuzhuo = 1;
						else
							jiuzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.canzhuo_chk") then
							canzhuo = 1;
						else
							canzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk") then
							hongbaozhuo = 1;
						else
							hongbaozhuo = 0;
						end;
						
						local map = Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl");
						
						local ibowlder2 = MapMoney(map);
						
						local ibowlder = ComputeMoney(jiuzhuo,canzhuo,hongbaozhuo);
						
						ibowlder = ibowlder + ibowlder2;
						
						if GetMyJude() < ibowlder then
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel","/C20"..ibowlder);
						else
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel",ibowlder);
						end;
					end;
				},
				
				
				--红包桌
				hongbaozhuo_chk= 
				{
					type = "CHECK",
					rect={194,168,40,16};
					textsize=12,
					drawcolor={229,183,83,255},
					bkimage = "res/uires/newcommon/checkbox.gsa",
					
					
					OnCheck=function(bChecked)
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.jiuzhuo_chk") then
							jiuzhuo = 1;
						else
							jiuzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.canzhuo_chk") then
							canzhuo = 1;
						else
							canzhuo = 0;
						end;
						
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.hongbaozhuo_chk") then
							hongbaozhuo = 1;
						else
							hongbaozhuo = 0;
						end;
						
						local map = Win_GetText("UI.gameui.marriagePreparedlg_One.map_lbl");
						
						local ibowlder2 = MapMoney(map);
						
						local ibowlder = ComputeMoney(jiuzhuo,canzhuo,hongbaozhuo);
						
						ibowlder = ibowlder + ibowlder2;
						
						if GetMyJude() < ibowlder then
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel","/C20"..ibowlder);
						else
							Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel",ibowlder);
						end;
					end;
				},
			};
		};

		--婚礼准备２
		marriagePreparedlg_Two= 
		{
			type = "DIALOG",
			rect = {0, 0, 357, 226},
			bkimage = "res/uires/marriagesys/prepare_2.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			OnSelfShow = function()
				LockPlayer(1);
				--Win_SetText("UI.gameui.marriagePreparedlg_Two.style_lbl", "请选择");
				Win_SetText("UI.gameui.marriagePreparedlg_Two.map_lbl", "");
				--Win_SetText("UI.gameui.marriagePreparedlg_Two.fulldress_lbl", "请选择");
				--Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.next_btn", false);
				Win_SetCheck("UI.gameui.marriagePreparedlg_Two.noinvitation_chk", true);
				Win_SetText("UI.gameui.marriagePreparedlg_Two.goldlabel", 0);
				Win_SetText("UI.gameui.marriagePreparedlg_Two.silverlabel", 0);
				Win_SetText("UI.gameui.marriagePreparedlg_Two.copperlabel", 0);
				local jew = Win_GetText("UI.gameui.marriagePreparedlg_One.jewlabel");
				if jew == "5200彩玉" and GetMyJude() < 5200 then
					-- 彩玉不足
					Win_SetText("UI.gameui.marriagePreparedlg_One.jewlabel", "/C205200彩玉");
				else
					Win_SetText("UI.gameui.marriagePreparedlg_Two.jewlabel", jew);
				end;
				Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", false);
			end;
			
			OnCancel = function()
				Win_ShowWidget("UI.gameui.marriagePreparedlg_Two", false);
			end;
			
			OnSelfHide = function()
				LockPlayer(0);
			end;
			
			OnCancel = function()
				Win_ShowWidget("UI.gameui.marriagePreparedlg_Two", false);
			end;
			
			children =
			{
				--[[helpbtn =
				{
					type = "BUTTON",
					rect = {251,10,20,19};
					bkimage = "res/uires/gameui/helpicon.gsa",
					tiptext = "帮助界面",
				};--]]
				closebtn =
				{
					type = "BUTTON",
					rect = {238,6,20,19},
					bkimage="res/uires/common/miniclose.gsa",
					defaultcancel=1,
					tiptext = "取消",
				};
				--迎亲方式
				--[[style_lbl=
				{
					type="LABEL",
					rect={36,66,163,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1
				};
				--迎亲方式 按钮
				style_btn=
				{
					type = "CHECK",
					rect = {191,65,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_Two.style_btn") then
							Win_SetValue("UI.gameui.listdlg",505,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};--]]
				--婚礼地图
				map_lbl=
				{
					type="LABEL",
					rect={25,56,195,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--婚礼地图 按钮
				map_btn=
				{
					type = "CHECK",
					rect = {223,57,16,16},
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_Two.map_btn") then
							Win_SetValue("UI.gameui.listdlg",506,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};
				--选择普通请柬
				common_chk= 
				{
					type = "CHECK",
					rect={21,105,66,16};
					textsize=12,
					drawcolor={206,178,140,255},
					bkimage = "res/uires/common/checkbox.gsa",
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.common_edt", true);
							Win_SetCheck("UI.gameui.marriagePreparedlg_Two.noinvitation_chk", false);
						else 
							Win_SetText("UI.gameui.marriagePreparedlg_Two.common_edt", "0");
							Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.common_edt", false);
							local totalmoney = GetMarriageMoney("婚礼地图", Win_GetText("UI.gameui.marriagePreparedlg_Two.map_lbl"));
							local gold=math.floor(totalmoney/1000000);
							local silver=math.floor((totalmoney-gold*1000000)/1000);
							local copper=math.floor(totalmoney-gold*1000000-silver*1000);
							if totalmoney > GetMoney() then
								Win_SetText("UI.gameui.marriagePreparedlg_Two.goldlabel", "/C20"..tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.silverlabel", "/C20"..tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.copperlabel", "/C20"..tostring(copper));
								Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", false);
							else
								Win_SetText("UI.gameui.marriagePreparedlg_Two.goldlabel", tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.silverlabel", tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.copperlabel", tostring(copper));
								if Win_GetText("UI.gameui.marriagePreparedlg_Two.map_lbl") ~= "" then
									Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", true);
								else
									Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", false);
								end;
							end;
						end;
					end;											
				};
				--普通请柬数量
				common_edt=
				{	
					type = "EDIT";
					rect={106,104,119,14},
					editmethod = ui_editmethod_number+ui_editmethod_value,						
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					textsize=12,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
					minvalue=0,
					maxvalue=999,
					mornitor={value_channel_value},
					
					OnValueChange=function()
						local maxnum = Win_GetValue("UI.gameui.marriagePreparedlg_Two.common_edt", value_channel_maxvalue);
						local num = Win_GetValue("UI.gameui.marriagePreparedlg_Two.common_edt");
						if maxnum >= num then
							local mapmoney = GetMarriageMoney("婚礼地图", Win_GetText("UI.gameui.marriagePreparedlg_Two.map_lbl"));
							local commoney = num * GetMarriageMoney("请帖", "普通请帖");
							local totalmoney = mapmoney + commoney;
							local gold=math.floor(totalmoney/1000000);
							local silver=math.floor((totalmoney-gold*1000000)/1000);
							local copper=math.floor(totalmoney-gold*1000000-silver*1000);
							if totalmoney > GetMoney() then
								Win_SetText("UI.gameui.marriagePreparedlg_Two.goldlabel", "/C20"..tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.silverlabel", "/C20"..tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.copperlabel", "/C20"..tostring(copper));
								Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", false);
							else
								Win_SetText("UI.gameui.marriagePreparedlg_Two.goldlabel", tostring(gold));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.silverlabel", tostring(silver));
								Win_SetText("UI.gameui.marriagePreparedlg_Two.copperlabel", tostring(copper));
								if Win_GetText("UI.gameui.marriagePreparedlg_Two.map_lbl") ~= "" then
									Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", true);
								else
									Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.done_btn", false);
								end;
							end;
						end;
					end;
				};
				--不需要请柬
				noinvitation_chk= 
				{
					type = "CHECK",
					rect={21,129,66,16};
					textsize=12,
					drawcolor={206,178,140,255},
					bkimage = "res/uires/common/checkbox.gsa",
					
					OnCheck=function(bcheck)
						if bcheck == 1 then
							Win_SetCheck("UI.gameui.marriagePreparedlg_Two.common_chk", false);
							Win_SetText("UI.gameui.marriagePreparedlg_Two.common_edt", "");
							Win_EnableWidget("UI.gameui.marriagePreparedlg_Two.common_edt", false);
						end;
					end;											
				};
				--[[--礼服
				fulldress_lbl=
				{
					type="LABEL",
					rect={36,180,163,15},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1
				};
				-- 礼服 按钮
				fulldress_btn=
				{
					type = "CHECK",
					rect = {191,180,16,16 },
					bkimage = "res/uires/common/dropbtn.gsa",	
					bkimagepos={1,2},
					extendstyle=ui_btn_style_none,
					
					OnClick=function()
						if Win_IsChecked("UI.gameui.marriagePreparedlg_Two.fulldress_btn") then
							Win_SetValue("UI.gameui.listdlg",507,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",true);
						else
							Win_SetValue("UI.gameui.listdlg",0,value_channel_customtype);
							Win_ShowWidget("UI.gameui.listdlg",false);
						end;
					end;
				};--]]
				goldlabel=
				{
					type="LABEL",
					rect={65,154,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,					
				},
				silverlabel=
				{
					type="LABEL",
					rect={113,154,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,
				},
				copperlabel=
				{
					type="LABEL",
					rect={161,154,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					richmode=ui_richmode_color+ui_richmode_font,
					bkcolor={0,0,0,0},
					--enable=0,
				};
				jewlabel=
				{
					type="LABEL",
					rect={66,178,48,12},
					textsize=12,
					richmode=ui_richmode_color+ui_richmode_font,
					visible=1,
				};
				--[[--下一步
				next_btn=
				{
					type = "BUTTON",
					rect = {28,261,70,22},
					bkimage="res/uires/marriagesys/next.gsa",
					
					OnClick=function()
						local param = 3;
						Win_ShowWidget("UI.gameui.marriagePreparedlg_Two", false);
						UI.children.gameui.OnOpenMarriagePreparedlg(param)
					end;
				};--]]
				--完成
				done_btn=
				{
					type = "BUTTON",
					rect = {28,200,70,22},
					bkimage="res/uires/marriagesys/done.gsa",
					defaultok = 1;
					
					OnClick=function()
						local IsEx;
						if Win_IsChecked("UI.gameui.marriagePreparedlg_One.ex_chk") then
							IsEx = 1;
						else 
							IsEx = 0;
						end;
						local map = Win_GetText("UI.gameui.marriagePreparedlg_Two.map_lbl");
						local num = Win_GetValue("UI.gameui.marriagePreparedlg_Two.common_edt");
						local money = tonumber(Win_GetText("UI.gameui.marriagePreparedlg_Two.copperlabel"))
								+ 1000*tonumber(Win_GetText("UI.gameui.marriagePreparedlg_Two.silverlabel"))
								+ 1000*1000*tonumber(Win_GetText("UI.gameui.marriagePreparedlg_Two.goldlabel"));
						local jewel = Win_GetText("UI.gameui.marriagePreparedlg_Two.jewlabel");
						if jewel == "5200彩玉" then
							jewel = 5200;
						else
							jewel = 0;
						end;
						SetMarriageInfo(IsEx, map, num, money, jewel);
						Win_ShowWidget("UI.gameui.marriagePreparedlg_Two", false);
						Win_ShowWidget("UI.gameui.marriageInfodlg_One", true);
					end;
				};
				--取消
				cancel_btn=
				{
					type = "BUTTON",
					rect = {169,200,70,22},
					bkimage="res/uires/marriagesys/cancel.gsa",
					defaultcancel = 1;
				};
			};
		};
		
		
		--婚礼信息1
		marriageInfodlg_One = 
		{
			type = "DIALOG",
			rect = {0, 0, 357, 257},
			bkimage = "res/uires/marriagesys/infomessage.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			OnSelfShow = function()
				LockPlayer(1);
				local info = GetMarriageInfoOne();
				Win_SetText("UI.gameui.marriageInfodlg_One.infolist.infolabel", info);
			end;
			
			OnSelfHide = function()
				LockPlayer(0);
			end;
			
			OnCancel = function()
				Win_ShowWidget("UI.gameui.marriageInfodlg_One", false);
			end;
			
			children = 
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={333,10,20,19};
					defaultcancel=1,
					updatemute=1,
				};
				
				-- 确认
				confrim_btn = 
				{
					type="BUTTON";
					bkimage="res/uires/marriagesys/confirm.gsa";
					rect={28,217,70,22};
					defaultok = 1;
					
					OnClick = function()
						DoneMarriagePreTwo();
						Win_ShowWidget("UI.gameui.marriageInfodlg_One", false);
					end;
				};
				
				--取消
				cancel_btn=
				{
					type = "BUTTON",
					rect = {263,217,70,22},
					bkimage="res/uires/marriagesys/cancel.gsa",
					defaultcancel = 1;

				};
				
				infolist=
				{
					type="WIDGETLIST",
					rect={32,50,275,148},
					
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static,
					updatemute=1,
					
					primaryscroll="UI.gameui.marriageInfodlg_One.vscroll",
										
					children=
					{
						--说明
						infolabel=
						{
							
							type="LABEL",
							rect={0,0,275,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
						
						
					},-- children
					
				},
				
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={313,71,15,104},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
					
					buddywidget="UI.gameui.marriageInfodlg_One.infolist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={114,-93,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",									
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
														
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={110,-114,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={111,13,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		
		--婚礼信息2
		marriageInfodlg_Two = 
		{
			type = "DIALOG",
			rect = {0, 0, 357, 257},
			bkimage = "res/uires/marriagesys/infomessage.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			OnSelfShow = function()
				LockPlayer(1);
				local info = GetMarriageInfoTwo();
				local guestnum = GetGuestNum();
				if guestnum == 0 then
					Win_EnableWidget("UI.gameui.marriageInfodlg_Two.lookover_btn", false);
				else
					Win_EnableWidget("UI.gameui.marriageInfodlg_Two.lookover_btn", true);
				end;
				Win_SetText("UI.gameui.marriageInfodlg_Two.infolist.infolabel", info);
			end;
			
			OnSelfHide = function()
				LockPlayer(0);
			end;
			
			children = 
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={333,10,20,19};
					defaultcancel=1,
					updatemute=1,
					
					OnClick = function()
						Win_ShowWidget("UI.gameui.marriageInfodlg_Two", false);
					end;
				};
				
				--取消婚礼
				cancel_btn = 
				{
					type="BUTTON";
					bkimage="res/uires/marriagesys/cancelwedding.gsa";
					rect={28,217,90,22};
					
					OnClick=function()
						Win_ShowMsgBox("您确定要取消婚礼吗？婚礼准备费用将不会返还！","系统消息",ui_msgid_yesno, "UI.gameui.marriageInfodlg_Two.cancel_btn");
					end;
					
					OnMsgBoxOk = function()
						Win_ShowWidget("UI.gameui.marriageInfodlg_Two", false);
						CancelMarriage();
					end;
				};
				
				--关闭
				shutdown_btn=
				{
					type = "BUTTON",
					rect = {263,217,70,22},
					bkimage="res/uires/marriagesys/shutdown.gsa",
					defaultcancel = 1;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.marriageInfodlg_Two", false);
					end;
				};
				
				infolist=
				{
					type="WIDGETLIST",
					rect={32,50,275,148},
					
					itemmarginh=0,
					itemmarginv=0,	
					style=wgtstyle_clipchild_window+wgtstyle_static,
					updatemute=1,
					
					primaryscroll="UI.gameui.marriageInfodlg_Two.vscroll",
										
					children=
					{
						--说明
						infolabel=
						{
							
							type="LABEL",
							rect={0,0,275,1},
							ysizeable=1,
							textsize=12,
							rowspace=6,
							textstyle=dt_left,
							style=wgtstyle_static,
							marginh=6,
							marginv=6,
							richmode=ui_richmode_all,
							
							bkcolor={0,0,0,0},
							drawcolor={255,255,255,255},
						},
						
					},-- children
					
				},
				
				--察看嘉宾名单
				lookover_btn = 
				{
					type="BUTTON";
					bkimage="res/uires/marriagesys/lookguest.gsa";
					rect={144,217,90,22};
					
					OnClick = function()
						Win_ShowWidget("UI.gameui.marriageInfodlg_Two", false);
						Win_ShowWidget("UI.gameui.guestlist_dlg", true);
					end;
				};
				
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={313,71,15,104},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
					
					buddywidget="UI.gameui.marriageInfodlg_Two.infolist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={114,-93,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",									
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
														
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={110,-114,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={111,13,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
			};
		};
		
		--嘉宾名单
		guestlist_dlg = 
		{
			type = "DIALOG",
			rect = {0, 0, 357, 257},
			bkimage = "res/uires/marriagesys/guestlist.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			--[[UpdateList = function()
				local info, num = GetInvitedGuestlist();
					Win_SetValue("UI.gameui.guestlist_dlg.list",num,value_channel_item_num);
				for i = 1, num do
					Win_SetText("UI.gameui.guestlist_dlg.list",info[i],value_channel_itemtext,i-1);
				end;
				Win_SetValue("UI.gameui.guestlist_dlg.list",-1,value_channel_sel);
			end;--]]
			
			OnSelfShow = function()
				LockPlayer(1);
				UI.children.gameui.OnUpdateGuestlist();
				Win_EnableWidget("UI.gameui.guestlist_dlg.delguest_btn", false);
			end;
			
			OnSelfHide = function()
				LockPlayer(0);
			end;
			
			children = 
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={333,10,20,19};
					defaultcancel=1,
					updatemute=1,
					
					OnClick = function()
						Win_ShowWidget("UI.gameui.guestlist_dlg", false);
					end;
				};
				
				--删除嘉宾
				delguest_btn = 
				{
					type="BUTTON";
					bkimage="res/uires/marriagesys/delguest.gsa";
					rect={28,217,90,22};
					
					OnClick = function()
						local sel = Win_GetValue("UI.gameui.guestlist_dlg.list",value_channel_sel);
						RemoveGuest(sel);
					end;
				};
				
				--关闭
				shutdown_btn=
				{
					type = "BUTTON",
					rect = {263,217,70,22},
					bkimage="res/uires/marriagesys/shutdown.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.guestlist_dlg", false);
					end;
				};
				
				list = 
				{
					type="LISTBOX",
					rect={35,49,274,145},
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
					richmode=ui_richmode_color,
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter;
					sizeable=1,
					
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -8,205,16};
					
					primaryscroll="UI.gameui.guestlist_dlg.vscroll",
					
					updatemute=1,
					
					OnClick=function()
						local mt, ct = GetMarriageAndCurtime();
						if mt > ct then
						--婚礼没到期
							Win_EnableWidget("UI.gameui.guestlist_dlg.delguest_btn", true);
						end;
					end;
				};
				
				vscroll=
				{
			
					type="SCROLLBAR",
					rect={313,71,15,104},					
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
					
					buddywidget="UI.gameui.guestlist_dlg.list",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={114,-93,15,36},
							patchupleft="res/uires/patch/blockup.gsa",
							patchleftmiddle="res/uires/patch/blockmid.gsa",
							patchdownleft="res/uires/patch/blockdn.gsa",									
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
														
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={110,-114,22,21},
							bkimage="res/uires/common/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
		
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={111,13,22,21},
							bkimage="res/uires/common/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
		
					};--children
					
				};--scroll
			};
		};
	
		--邀请嘉宾
		inviteguest_dlg = 
		{
			type = "DIALOG",
			rect = {0, 0, 206, 377},
			bkimage = "res/uires/marriagesys/inviteguest.gsa",
			style = wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype = aligntype_father+aligntype_winrect,
			alignstyle = alignstyle_hcenter+alignstyle_vcenter,
			visible = 0,
			moveable = 1,
			updatemute = 1,
			textstyle = dt_center+dt_vcenter,
			textsize = 12,
			textfont = 1,
			
			OnSelfShow = function()
				LockPlayer(1);
				local friendnum = GetNoInvitedFriendNum();
				Win_SetValue("UI.gameui.inviteguest_dlg.friends_tab.friendslist",friendnum,value_channel_item_num);
				local familynum = GetNoInvitedFamilyNum();
				Win_SetValue("UI.gameui.inviteguest_dlg.family_tab.familylist",familynum,value_channel_item_num);
				Win_SetCheck("UI.gameui.inviteguest_dlg.friends_tab", true);
				Win_SetCheck("UI.gameui.inviteguest_dlg.family_tab", false);
				if GetCommInviNum() ~= 0 and GetLexInviNum() ~= 0 then
					Win_EnableWidget("UI.gameui.inviteguest_dlg.com_chk", true);
					Win_EnableWidget("UI.gameui.inviteguest_dlg.lex_chk", true);
					Win_SetCheck("UI.gameui.inviteguest_dlg.com_chk", true);
					Win_SetCheck("UI.gameui.inviteguest_dlg.lex_chk", false);
				elseif GetCommInviNum() == 0 and GetLexInviNum() ~= 0 then
					Win_EnableWidget("UI.gameui.inviteguest_dlg.com_chk", false);
					Win_EnableWidget("UI.gameui.inviteguest_dlg.lex_chk", true);
					Win_SetCheck("UI.gameui.inviteguest_dlg.com_chk", false);
					Win_SetCheck("UI.gameui.inviteguest_dlg.lex_chk", true);
				elseif GetCommInviNum() ~= 0 and GetLexInviNum() == 0 then
					Win_EnableWidget("UI.gameui.inviteguest_dlg.com_chk", true);
					Win_EnableWidget("UI.gameui.inviteguest_dlg.lex_chk", false);
					Win_SetCheck("UI.gameui.inviteguest_dlg.com_chk", true);
					Win_SetCheck("UI.gameui.inviteguest_dlg.lex_chk", false);
				else 
					Win_EnableWidget("UI.gameui.inviteguest_dlg.com_chk", false);
					Win_EnableWidget("UI.gameui.inviteguest_dlg.lex_chk", false);
					Win_SetCheck("UI.gameui.inviteguest_dlg.com_chk", false);
					Win_SetCheck("UI.gameui.inviteguest_dlg.lex_chk", false);	
				end;
				Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", false);
			end;
			
			OnSelfHide = function()
				LockPlayer(0);
			end;
			
			children = 
			{
				close_btn=
				{
					type="BUTTON";
					bkimage="res/uires/common/miniclose.gsa";
					rect={180,16,20,19};
					defaultcancel=1,
					updatemute=1,
		
					OnClick = function()
						Win_ShowWidget("UI.gameui.inviteguest_dlg", false);
					end;
				};
		
				friends_tab = 
				{
					type="TABWIN",		
					rect={13,64,166,220},						
					tabrect={0,-1,50,23},
					tabcover="res/uires/marriagesys/friends.gsa",
					tabwintype=tabwin_type_up,							
					groupid=0,
					groupstop=0,
					tabstop=0,
					
					OnCheck = function(bcheck)
						if bcheck == 1 then
							local friendnum = GetNoInvitedFriendNum();
							for i = 0, friendnum-1 do
								local info = GetNoInvitedFriend(i);
								Win_EnableWidget("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i, true);
								Win_SetText("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".name_lbl", info.name);
								Win_SetCheck("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk", info.isInvited);
							end;
						end;
					end;
					
					children = 
					{										
						friendslist=
						{
							type="WIDGETLIST";
							rect={3,2,166,220};
							style=wgtstyle_clipchild_window+wgtstyle_vertical,	
							dragtype=ui_drag_type_rackbuylist,
							dragindex=-1,
							primaryscroll="UI.gameui.inviteguest_dlg.friends_tab.friendsscroll",
							itemmarginh=2,
							itemmarginv=2,
							
							template={"res/uires/marriageguestfriends.lua"};
							
							children={},
							
						},--list
						
						friendsscroll=
						{			
							type="SCROLLBAR",
							rect={172,20,15,183},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.inviteguest_dlg.friends_tab.friendslist",
		
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={-518,0,15,99},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,																
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={-4,-25,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={-4,177,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,													
								};--spindown
				
							};--children
							
						};--scroll
					};
				};
				
				family_tab = 
				{
					type="TABWIN",	
					rect={15,64,166,220},						
					tabrect={47,-1,50,23},
					tabcover="res/uires/marriagesys/family.gsa",
					tabwintype=tabwin_type_up,							
					groupid=0,
					groupstop=1,
					tabstop=1,
					
					OnCheck = function(bcheck)
						if bcheck == 1 then
							local familynum = GetNoInvitedFamilyNum();
							for i = 0, familynum-1 do
								local info = GetNoInvitedFamily(i);
								Win_EnableWidget("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i, true);
								Win_SetText("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".name_lbl", info.name);
								Win_SetCheck("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk", info.isInvited);
							end;
						end;
					end;
					
					children = 
					{
						familylist=
						{
							type="WIDGETLIST";
							rect={1,2,166,220};
							style=wgtstyle_clipchild_window+wgtstyle_vertical,	
							dragtype=ui_drag_type_rackbuylist,
							dragindex=-1,
							primaryscroll="UI.gameui.inviteguest_dlg.family_tab.familyscroll",
							itemmarginh=2,
							itemmarginv=2,
							
							template={"res/uires/marriageguestfamily.lua"};
							
							children={},
							
						},--list
						
						familyscroll=
						{
					
							type="SCROLLBAR",
							rect={171,20,15,183},					
							style=wgtstyle_vertical,
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,
							updatemute=1,
							
							buddywidget="UI.gameui.inviteguest_dlg.family_tab.familylist",
		
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={-518,0,15,99},
									patchupleft="res/uires/patch/blockup.gsa",
									patchleftmiddle="res/uires/patch/blockmid.gsa",
									patchdownleft="res/uires/patch/blockdn.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,																
				
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={-4,-25,22,21},
									bkimage="res/uires/common/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
				
								spindown=
								{
									type="SPIN",
									rect={-4,177,22,21},
									bkimage="res/uires/common/downbtn.gsa",	
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,													
								};--spindown
								
							};--children
							
						};--scroll
					};
				};
				
				--使用普通请柬
				com_chk = 
				{
					type = "CHECK",
					rect={16,302,66,16};
					textsize=12,
					drawcolor={206,178,140,255},
					bkimage = "res/uires/common/checkbox.gsa",
					
					OnCheck=function(bchecked)
						local friendnum = GetNoInvitedFriendNum();
						local familynum = GetNoInvitedFamilyNum();
						if bchecked == 1 then
							Win_SetCheck("UI.gameui.inviteguest_dlg.lex_chk", false);
							for i = 0, friendnum-1 do
								Win_EnableWidget("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk", true);
							end;
							for i = 0, familynum-1 do
								Win_EnableWidget("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk", true);
							end;
							--已勾选的数目
							local selednum = GetSeledGuestNum();
							if selednum >= GetCommInviNum() then
								--已到达上限
								MarriageLogInfo("普通请帖数量已达到最大");
								--剩下的不可再钩选
								for i=0,friendnum-1 do
									if not Win_IsChecked("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk") then
										Win_EnableWidget("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk", false);
									end;
								end;
								for i=0,familynum-1 do
									if not Win_IsChecked("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk") then
										Win_EnableWidget("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk", false);
									end;
								end;
							end;
							if selednum ~= 0 then
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", true);
							else
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", false);
							end;
						else 
							if not Win_IsChecked("UI.gameui.inviteguest_dlg.lex_chk") then
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", false);
							end;
						end;						
					end;
				};
				
				--使用豪华请柬
				lex_chk = 
				{
					type = "CHECK",
					rect={16,325,66,16};
					textsize=12,
					drawcolor={206,178,140,255},
					bkimage = "res/uires/common/checkbox.gsa",
					
					OnCheck=function(bchecked)
						local friendnum = GetNoInvitedFriendNum();
						local familynum = GetNoInvitedFamilyNum();
						if bchecked == 1 then
							Win_SetCheck("UI.gameui.inviteguest_dlg.com_chk", false);
							for i = 0, friendnum-1 do
								Win_EnableWidget("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk", true);
							end;
							for i = 0, familynum-1 do
								Win_EnableWidget("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk", true);
							end;
							--已勾选的数目
							local selednum = GetSeledGuestNum();
							if selednum >= GetLexInviNum() then
								--已到达上限
								MarriageLogInfo("豪华请帖数量已达到最大");
								--剩下的不可再钩选
								for i=0,friendnum-1 do
									if not Win_IsChecked("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk") then
										Win_EnableWidget("UI.gameui.inviteguest_dlg.friends_tab.friendslist.marriageguestfriends"..i..".sel_chk", false);
									end;
								end;
								for i=0,familynum-1 do
									if not Win_IsChecked("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk") then
										Win_EnableWidget("UI.gameui.inviteguest_dlg.family_tab.familylist.marriageguestfamily"..i..".sel_chk", false);
									end;
								end;
							end;
							if selednum ~= 0 then
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", true);
							else
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", false);
							end;
						else 
							if not Win_IsChecked("UI.gameui.inviteguest_dlg.com_chk") then
								Win_EnableWidget("UI.gameui.inviteguest_dlg.confrim_btn", false);
							end;
						end;	
					end;
				};
				
				--确定
				confrim_btn = 
				{
					type="BUTTON";
					bkimage="res/uires/marriagesys/confirm.gsa";
					rect={14,349,70,22};
					
					OnClick = function()
						local tp = nil;
						if Win_IsChecked("UI.gameui.inviteguest_dlg.com_chk") then
							tp = 0;
						else
							tp = 1;
						end;
						local num = GetSeledGuestNum();
						if num == 0 then
							MarriageLogInfo("没有邀请嘉宾！");
						else
							ConfirmGuestlist(tp);
							Win_ShowWidget("UI.gameui.inviteguest_dlg", false);
						end;
					end;
				};
		
				--取消
				cancel_btn=
				{
					type = "BUTTON",
					rect = {127,349,70,22},
					bkimage="res/uires/marriagesys/cancel.gsa",
					defaultcancel = 1;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.inviteguest_dlg", false);
					end;
				};
			};
		};		

		-- 战斗时长计时器， 默认小地图左边，buf下面，玩家可以任意拖动位置， toplever
		fighttimerbar=
		{
			type="WIDGET",
			rect = {0,0,90,24},
			style = wgtstyle_clipchild_window,
			moveable=1,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,	
			marginh=-180,
			marginv=125,
			
			bkcolor={16,16,16,196},
			edgecolor = { 0, 0, 0, 128 },
			patchrect={3,3,3,2},		
	
			patchdrawtype=patch_draw_type_scale,
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
	
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",

			children=
			{
				fighttimercustom=
				{
					type="WIDGET",
					rect = {0,0,90,24},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_fighttimebar,
					enable=0,
				};
			};
		};
		
		-- 雪地大生存积分器， 默认小地图左边，buf下面，玩家可以任意拖动位置， toplever
		snowscorebar=
		{
			type="WIDGET",
			rect = {0,0,162,44},
			style = wgtstyle_clipchild_window;
			moveable=1,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_right_in+alignstyle_top_in,	
			marginh=-180,
			marginv=125,
			
			bkcolor={16,16,16,196},
			edgecolor = { 0, 0, 0, 128 },
			patchrect={3,3,3,2},		
	
			patchdrawtype=patch_draw_type_scale,
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
	
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",

			OnSnowScoreUpdate=function(score)
				Win_SetText("UI.gameui.snowscorebar.score", "雪地大考验积分："..score);
			end;
			
			children=
			{
				tm=
				{
					type="LABEL",
					rect = {6,2,162,24},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_snowscore,
					enable=0,
				};
				score=
				{
					type="LABEL",
					caption="雪地大考验积分：0";
					rect = {7,20,162,24},
					drawcolor={255,255,0,255},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					enable=0,
				};
			};
		};
		
		--防守型副本 排行榜
		defenserankingdlg=
		{
			type="DIALOG",
			rect={0,0,585,426},
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			bkimage="res/uires/defensedlg/rankingdlg.gsa",
			
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			visible=0,
			moveable=1,
			
			OnOk=function()

			end;
				
			OnCancel=function()
				Win_ShowWidget("UI.gameui.defenserankingdlg",false);
			end;
				
			OnEscape=function()
				Win_EndWidget("UI.gameui.defenserankingdlg",false);
			end;
			
			OnSelfShow=function()
				LockPlayer(1);
				Win_SetFocus("UI.gameui.defenserankingdlg");
				Win_SetValue("UI.gameui.defenserankingdlg.containscroll",100,value_channel_maxvalue);
				Win_SetValue("UI.gameui.defenserankingdlg.containscroll",0,value_channel_pos);
				Win_SetValue("UI.gameui.defenserankingdlg.detailcontain.listcontain.detaillist", 0, value_channel_item_num);
				
				Win_ShowWidget("UI.gameui.defenserankingdlg.detailscroll", true);
			end;
				
			OnSelfHide=function()
				LockPlayer(0);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={556,19,20,19},
					bkimage="res/uires/newcommon/miniclose.gsa",
					style=wgtstyle_alphawin;
					defaultcancel=1,
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 534,19,20,19 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					style=wgtstyle_alphawin;
				};
				
				
				
				tree=
				{
					type="TREECTRL",
					rect={37,49,150,363},	
					style=wgtstyle_clipself,
					dragtype=ui_drag_type_pworldtree,
					mousedelta=30,
					soundid={-1,-1,-1,-1,-1,-1,-1,1002,1003},
					
					tipwidget="UI.gameui.ScrnTooltip",
					
					OnSelfShow=function()
						Win_SetFocus("UI.gameui.defenserankingdlg.tree");
					end;
					
					OnDBClick=function(idx)

					end;

					OnValueChange=function(sel, oldsel)
						if sel ~= oldsel then								
							SendDetailRankingReq(sel);
						end;
					end;
					
					children=
					{
						vscroll=
						{
					
							type="SCROLLBAR",
							rect={119,19,20,325},					
							style=wgtstyle_vertical,					
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=36,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
												
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
							
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
																		
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",												
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					
					};
					
				};
				
				containscroll=
				{
					type="SCROLLBAR",
					rect={200,397,350,20},	
					patchupleft="res/uires/newcommon/hscroll_bk.gsa",
					patchupmiddle="res/uires/newcommon/hscroll_bk.gsa",
					patchupright="res/uires/newcommon/hscroll_bk.gsa",	
					extendstyle=scrollbar_blockbtn_auto_size,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					OnValueChange=function(pos)
						local x = Win_GetValue("UI.gameui.defenserankingdlg.detailcontain",value_channel_winrect,0);
						local w1 = Win_GetValue("UI.gameui.defenserankingdlg.detailcontain",value_channel_winrect,2);
						local w2 = Win_GetValue("UI.gameui.defenserankingdlg.detailcontain.listcontain",value_channel_winrect,2);
						local offset = (w2-w1)*pos/100;
						Win_SetValue("UI.gameui.defenserankingdlg.detailcontain.listcontain",x-offset,value_channel_winrect,0);
						end;
						
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,80,20},
							patchupleft="res/uires/newcommon/hblockleft.gsa",
							patchupmiddle="res/uires/newcommon/hblockmid.gsa",
							patchupright="res/uires/newcommon/hblockright.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_vcenter,	
						};--blockbtn
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/rightbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_right_out+alignstyle_vcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/leftbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_left_out+alignstyle_vcenter,	
							marginh=0,
							marginv=0,
						};--spindown
						
					};--children
					
				};--scroll
				
				detailscroll=
				{
					type="SCROLLBAR",
					rect={550,68,20,310},	
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					style=wgtstyle_vertical,
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,
					updatemute=1,
					
					buddywidget="UI.gameui.defenserankingdlg.detailcontain.listcontain.detaillist",

					OnSelfShow=function()
						UI.children.gameui.children.defenserankingdlg.children.detailcontain.UpdateScroll();
					end;
					OnSelfHide=function()
						UI.children.gameui.children.defenserankingdlg.children.detailcontain.UpdateScroll();
					end;

					OnValueChange=function(pos)
					end;					

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,
						};--blockbtn
						
						spinup=
						{
							type="SPIN",
							rect={0,0,20,20},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,20},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
						};--spindown
					};--children
				};--scroll
				
				detailcontain=
				{
					type="CONTAINER",
					rect={181,50,370,350},
					style=wgtstyle_clipchild_window;
					initlayer=msgbox_layer-1,
					pluslayer=0,		
					
					UpdateScroll=function()
						local panelrect = Win_GetRect("UI.gameui.defenserankingdlg.detailcontain", value_channel_winrect);
						local scrollrect = Win_GetRect("UI.gameui.defenserankingdlg.containscroll", value_channel_winrect);
						
						--if Win_IsVisible("UI.gameui.defenserankingdlg.detailscroll") then
						--	Win_ExtendEdge("UI.gameui.defenserankingdlg.detailcontain",341-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
						--else
						--	Win_ExtendEdge("UI.gameui.defenserankingdlg.detailcontain",358-panelrect.w,edge_flag_right,rect_flag_window+rect_flag_client);
						--end;
					end;

					children=
					{
						listcontain=
						{
							type="CONTAINER",
							rect={0,-3,543,350},
							style=wgtstyle_clipchild_window;
							
							children=
							{
								titlepic=
								{
									type="LABEL",
									rect={0,0,543,21},
									bkimage="res/uires/defensedlg/titlepic.gsa",
									initlayer=0;
									enable=0;
								};
								
								detaillist=
								{
									type="LISTBOX",
									rect={0,22,543,329},	
									style=wgtstyle_clipself,		
									extendstyle=listbox_style_wheel+listbox_style_enum_item+listbox_style_itemheight_fix+listbox_style_rightbtnsel,
									dragtype=ui_drag_type_defenseranking,
									itemdrawback="res/uires/family/detailitembk.gsa",
									itemdrawpos={0,20, 0, 0};
									itemselback="res/uires/family/detailitemsel.gsa",
									itemselpos={10, 0, 560, 26},
									itemwidth=449,
									itemheight=30,
									itemmarginh=0,
									itemmarginv=0,	
									textsize=12,				
									updatemute=1,
									tipwidget="UI.gameui.ScrnTooltip",
									
									primaryscroll="UI.gameui.defenserankingdlg.detailscroll",
									
									OnSelfShow=function()
										UI.children.gameui.children.familydetaildlg.children.detailcontain.UpdateScroll();
									end;

									OnRClick=function(idx)

									end;
	
								},--list
								
								memberbtn=
								{
									type="BUTTON",
									rect={0,0,263,21},
									bkimage="res/uires/defensedlg/memberbtn.gsa",
									initlayer=msgbox_layer-1,
									pluslayer=0,
								};
								
								appraisebtn=
								{
									type="BUTTON",
									rect={263,0,49,21},
									bkimage="res/uires/defensedlg/appraisebtn.gsa",
									initlayer=msgbox_layer-1,
									pluslayer=0,
								};
								
								scorebtn=
								{
									type="BUTTON",
									rect={312,0,52,21},
									bkimage="res/uires/defensedlg/scorebtn.gsa",
									initlayer=msgbox_layer-1,
									pluslayer=0,
								};
								
								timebtn=
								{
									type="BUTTON",
									rect={364,0,52,21},
									bkimage="res/uires/defensedlg/timebtn.gsa",
									initlayer=msgbox_layer-1,
									pluslayer=0,
								};
								
								teamlevelbtn=
								{
									type="BUTTON",
									rect={416,0,75,21},
									bkimage="res/uires/defensedlg/teamlevelbtn.gsa",
									initlayer=msgbox_layer-1,
									pluslayer=0,
								};
								
								datebtn=
								{
									type="BUTTON",
									bkimage="res/uires/defensedlg/datebtn.gsa",
									rect={491,0,52,21},
									initlayer=msgbox_layer-1,
									pluslayer=0,
									
								};
							};					
						};
					};
				};
			};
		};
		
		reviveclosedlg=
		{
			type="DIALOG",
			rect={662,474,138,32},
			drawcolor={255,255,255,255},
			textsize=12,
			textfont=1,
			initlayer=0;
			pluslayer=0;	
			bkimage="res/uires/defensedlg/reviveclosedlg.gsa",
			
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
			
			OnOk=function()

			end;
			
			children=
			{
				openbtn=
				{
					type="BUTTON",
					rect={111,5,22,23},
					bkimage="res/uires/defensedlg/openbtn.gsa",
					style=wgtstyle_alphawin;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.reviveclosedlg", false);
						Win_ShowWidget("UI.gameui.reviveopendlg", true);
					end;
				},	
				
			};
		};
		
		createfightteamdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 221, 134 },
			bkimage="res/uires/pkskilldlg/createfightteam.gsa",
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.createfightteamdlg",false);
				end;

			OnSelfShow=function()
				LockPlayer(1);
			end;

			OnSelfHide=function()
				LockPlayer(0);
			end;			
				
			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 191,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.createfightteamdlg", false);
					end;
					
				};
				
				okbtn = 
				{
					type = "BUTTON",
					rect = { 31,104,86,24 },
					bkimage="res/uires/gatherdlg/okbtn.gsa",
					OnClick=function()
						local teamname=Win_GetText("UI.gameui.createfightteamdlg.nameedit");
						if pto=="" then
							Win_ShowMsgBox("请输入战队名称！");
						else
							SendCreateFtTeam(teamname); 
							Win_ShowWidget("UI.gameui.createfightteamdlg", false);			
						end;
											
					end;
				};
				
				cancelbtn= 
				{
					type = "BUTTON",
					rect = { 123,104,86,24 },
					bkimage="res/uires/gatherdlg/cancelbtn.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.createfightteamdlg", false);
					end;
				};
				
				nameedit=
				{
					type="EDIT",
					rect={43,77,160,12},	
					textsize=12,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},
					maxchar=16,
				};
				
			};
		};
		
		--消孔道具窗口
		nirvanadlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 260, 312 },
			bkimage="res/uires/gameui/nirvanadlgbk.gsa",
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.nirvanadlg",false);
			end;
			
			OnSelfShow=function()
				
			end;
			
			children = 
			{
				closebtn = 
				{
					type = "BUTTON",
					rect = { 231,19,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.nirvanadlg", false);
					end;	
				};
				
				okbtn = 
				{
					type = "BUTTON",
					rect = { 56,275,86,24 },
					bkimage="res/uires/gatherdlg/okbtn.gsa",
					OnClick=function()
						local chknum = 0;
						for i=1, 7 do
							if Win_IsChecked("UI.gameui.nirvanadlg.armattrchk"..i) then
								chknum = chknum+1;
							end;
						end;
						
						if chknum ~= 2 then
							Win_ShowMsgBox("您只能选择2个属性进行消孔操作，请检查。","系统消息",ui_msgid_default,"UI.gameui.nirvanadlg");
						else
							Win_ShowMsgBox("您选择了2个属性进行消孔操作，确定吗？","系统消息",ui_msgid_yesno,"UI.gameui.nirvanadlg.okbtn");
						end;
					end;
					
					OnMsgBoxOk=function()
						local chk1 = 0;
						local chk2 = 0;
						for i=1, 7 do
							if Win_IsChecked("UI.gameui.nirvanadlg.armattrchk"..i) then
								
								if chk1 == 0 then
									chk1 = i;
								else
									chk2 = i;
								end;
							end;
						end;
						NirvanaArm(chk1, chk2);
						Win_ShowWidget("UI.gameui.nirvanadlg", false);	
					end;
				};
				
				cancelbtn= 
				{
					type = "BUTTON",
					rect = { 160,275,86,24 },
					bkimage="res/uires/gatherdlg/cancelbtn.gsa",
					OnClick=function()

						Win_ShowWidget("UI.gameui.nirvanadlg", false);
					end;
				};
				
				holedesc=
				{
					type="LABEL",
					rect={65,121,188,142},
					ysizeable=1,
					textsize=12,
					rowspace=6,
					textstyle=dt_left,
					style=wgtstyle_static,
					marginh=6,
					marginv=6,
					richmode=ui_richmode_all,
					
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},						
				};
				
				armattrchk1=
				{
					type = "CHECK",
					rect={44,122,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk2=
				{
					type = "CHECK",
					rect={44,141,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk3=
				{
					type = "CHECK",
					rect={44,159,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk4=
				{
					type = "CHECK",
					rect={44,177,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk5=
				{
					type = "CHECK",
					rect={44,195,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk6=
				{
					type = "CHECK",
					rect={44,213,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
				armattrchk7=
				{
					type = "CHECK",
					rect={44,231,214,17};
					bkimage = "res/uires/newcommon/checkbox.gsa",	
					visible=0;
					updatemute=1,				
				};
			};
		};
		
		lastipdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 279, 148 },
			bkimage="res/uires/gatherdlg/lastipdlgbk.gsa",
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
			end;		
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.lastipdlg",false);
			end;
			
			OnSelfShow=function()
				
			end;
			
			OnSelfHide=function()
			end;
			
			children = 
			{
				lastip=
				{
					type="LABEL",
					rect={90,30,160,17},
					textsize=12,
					textstyle=dt_left,
					style=wgtstyle_static,
					richmode=ui_richmode_color,
					
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				};
				lasttime=
				{
					type="LABEL",
					rect={90,58,160,17},
					textsize=12,
					textstyle=dt_left,
					style=wgtstyle_static,

					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				};
				nowip=
				{
					type="LABEL",
					rect={90,89,160,17},
					textsize=12,
					textstyle=dt_left,
					style=wgtstyle_static,

					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				};
				okbtn = 
				{
					type = "BUTTON",
					rect = { 102,118,86,24 },
					bkimage="res/uires/gatherdlg/okbtn.gsa",
					OnClick=function()
						Win_ShowWidget("UI.gameui.lastipdlg", false);						
					end;
				};
			};
		};
		
		gatherdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 289, 246 },
			bkimage="res/uires/gatherdlg/gatherdlgbk.gsa",
			moveable=1,					
			visible=0,
			textsize=12,
			textfont=1,
			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			
			OnOk=function()
				UI.children.gameui.OnAccel_AccelSend();
				end;		
			
			OnCancel=function()
				ClrGatherPack();
				CloseGatherDlg();
				Win_ShowWidget("UI.gameui.gatherdlg",false);
				end;

			OnSelfShow=function()
				LockPlayer(1);
				Win_EnableWidget("UI.gameui.gatherdlg.okbtn", false);
				local NpcName, NpcContent = GetNPCContent();
				Win_SetText("UI.gameui.gatherdlg.gathernpcname", NpcName.."：");
				Win_SetText("UI.gameui.gatherdlg.gatherinfo", NpcContent);
				Win_ShowWidget("UI.gameui.waredlg",true);
				local GatherType = GetGatherType();
				if GatherType == 2 then
					Win_SetCheck("UI.gameui.waredlg.medicinetab",false);
					Win_SetCheck("UI.gameui.waredlg.waretab",true);
					Win_SetCheck("UI.gameui.waredlg.equiptab",false);
				elseif GatherType == 3 then
					Win_SetCheck("UI.gameui.waredlg.medicinetab",false);
					Win_SetCheck("UI.gameui.waredlg.waretab",false);
					Win_SetCheck("UI.gameui.waredlg.equiptab",true);
				else 
					Win_SetCheck("UI.gameui.waredlg.medicinetab",true);
					Win_SetCheck("UI.gameui.waredlg.waretab",false);
					Win_SetCheck("UI.gameui.waredlg.equiptab",false);				
				end;				
				SetGlobalQuery(GlobalQuery_GatherDlg, 1);
			end;

			OnSelfHide=function()
				LockPlayer(0);
				CloseGatherDlg();
				ClrGatherPack();
				SetGlobalQuery(GlobalQuery_GatherDlg, 0);
			end;			
				
			children = 
			{	
				--关闭按钮
				closebtn = 
				{
					type = "BUTTON",
					rect = { 260,19,22,23 },
					bkimage="res/uires/newcommon/miniclose.gsa",
					OnClick=function()
						CloseGatherDlg();
						ClrGatherPack();
						Win_ShowWidget("UI.gameui.gatherdlg", false);
					end;
					
				};
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 238,19,22,23 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					
					OnClick=function()
						end;
				};
				
				okbtn = 
				{
					type = "BUTTON",
					rect = { 63,211,86,24 },
					bkimage="res/uires/gatherdlg/okbtn.gsa",
					OnClick=function()
						SendFinishGatherPkg();
						CloseGatherDlg();
						ClrGatherPack();
						Win_ShowWidget("UI.gameui.gatherdlg", false);						
					end;
				};
				
				cancelbtn= 
				{
					type = "BUTTON",
					rect = { 160,211,86,24 },
					bkimage="res/uires/gatherdlg/cancelbtn.gsa",
					OnClick=function()
						ClrGatherPack();
						CloseGatherDlg();
						Win_ShowWidget("UI.gameui.gatherdlg", false);
					end;
				};
				
				gatherlist=
				{
					type="LISTBOX",
					rect={37,160,235,36},
					style=wgtstyle_systemdraw,
					extendstyle=listbox_style_itemheight_fix,
					itemwidth=37,
					itemheight=36,
					itemmarginh=5,
					itemmarginv=0,
					itemnum=5,	
					dragtype=ui_drag_type_dailygather,
					
					tipwidget="UI.gameui.ScrnTooltip",
					updatemute=1,
				};
				
				gathernpcname=
				{
					type="LABEL",
					rect={39,50,240,20},
					ysizeable=1,
					textsize=12,
					rowspace=6,
					textstyle=dt_left,
					style=wgtstyle_static,
					marginh=6,
					marginv=6,
					richmode=ui_richmode_all,
					
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				};				
				
				gatherinfo=
				{
					type="LABEL",
					rect={39,70,240,70},
					ysizeable=1,
					textsize=12,
					rowspace=6,
					textstyle=dt_left,
					style=wgtstyle_static,
					marginh=6,
					marginv=6,
					richmode=ui_richmode_all,
					
					bkcolor={0,0,0,0},
					drawcolor={255,255,255,255},					
				};
			};
		};
		reviveopendlg=
		{
			type="DIALOG",
			rect={627,338,173,167},
			drawcolor={255,255,255,255},
			initlayer=0;
			pluslayer=0;	
			textsize=12,
			textfont=1,
			bkimage="res/uires/defensedlg/reviveopendlg.gsa",
			
			aligntype=aligntype_father+aligntype_winrect,
			visible=0,
			moveable=1,
	
			
			OnOk=function()

			end;
			
			OnCancel=function()
			
			end;
			
			OnSelfShow=function()
				 Win_SetValue("UI.gameui.reviveopendlg.list", 5, value_channel_item_num);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={147,5,22,23},
					bkimage="res/uires/defensedlg/closebtn.gsa",
					style=wgtstyle_alphawin;
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.reviveopendlg", false);
						Win_ShowWidget("UI.gameui.reviveclosedlg", true);
					end;
				},
				
				list=
				{
					type="LISTBOX",
					rect={15, 54, 142,100},			
					style=wgtstyle_vertical+wgtstyle_clipself,	
					extendstyle=listbox_style_itemheight_fix,	
					dragtype=ui_drag_type_reviveopenlist,
					textsize=12,
					itemtextstyle=dt_center+dt_vcenter;
					tipwidget="UI.gameui.ScrnTooltip",

					itemheight=20,
					itemmarginh=0,
					itemmarginv=0,

					bkcolor={0,0,0,0},
					edgecolor={0,0,0,0},
					focuscolor={0,0,0,0},	
					itembkcolor={0,0,0,0},					
					itemedgecolor={0,0,0,0},	
					itemfocuscolor={0,0,0,0},	
					
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -8,205,16};
				};
			};
		};
		
		--游戏QQSHOW
		qqshowcutdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 193, 266 },
			bkimage="res/uires/gameui/qqshowcutdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			
			OnOk=function()
				QQShowSwitchState("preview");
			end;
			
			OnCancel=function()
				QQShowSwitchState("normal");
			end;
			
			OnEscape=function()
				QQShowSwitchState("normal");
			end;
			
			OnSelfShow=function()
				Win_SetCapture("UI.gameui.qqshowcutdlg");
				Win_SetFocus("UI.gameui.qqshowcutdlg");
			end;
			
			children=
			{
				affirmbtn=
				{
					type="BUTTON",
					rect={144, 212,22, 19},
					bkimage="res/uires/newcommon/affirmminibtn.gsa",
					soundid={1005},	
					defaultok=1,
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={123, 212,22,19},
					bkimage="res/uires/newcommon/cancelminibtn.gsa",	
					soundid={1007},
					defaultcancel=1,
				},
			};
		};
		
		qqshowpreviewdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 499, 280 },
			bkimage="res/uires/gameui/qqshowpreviewdlg.gsa",
			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,			
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=0,
			visible=0,
		
			OnOk=function()
				QQShowSwitchState("send");
			end;
			
			OnCancel=function()
				QQShowSwitchState("cut");
			end;
			
			OnEscape=function()
				QQShowSwitchState("cut");
			end;
			
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.qqshowpreviewdlg");
			end;
			
			children=
			{
				affirmbtn=
				{
					type="BUTTON",
					rect={222, 239, 86, 24},
					bkimage="res/uires/newcommon/affirmsmallbtn.gsa",
					soundid={1005},	
					defaultok=1,
				},
		
				cancelbtn=
				{
					
					type="BUTTON",
					rect={370, 239, 86, 24},
					bkimage="res/uires/newcommon/cancelsmallbtn.gsa",	
					soundid={1007},
					defaultcancel=1,
				},
				
				bigpicwgt=
				{						
					type="WIDGET",
					rect={27, 27, 140, 226},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_qqshow_bigpic,	
				};
				
				smallpicwgt=
				{						
					type="WIDGET",
					rect={200, 31, 84, 124},
					style=wgtstyle_renderbuffer,
					custombuffer=custom_buffer_qqshow_smallpic,
				};
			};
		};
		
		--每日玩法， 每日活动信息dlg
		dailytaskinfodlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 456, 328 },
			bkimage="res/uires/gameui/dailytaskinfodlg.gsa",

			style=wgtstyle_topmost+wgtstyle_alphawin;--wgtstyle_customclose +
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,

			visible=0,
			moveable=1,		
			
			-- 通过show， hide 子窗口驱动其执行自己的onselfshow函数
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.dailytaskinfodlg");
				
				local num = DailyTaskInfo_GetActItemNum();
				Win_SetValue("UI.gameui.dailytaskinfodlg.actlist",num,value_channel_item_num);
				
				for i = 0, num-1 do
					Win_ShowWidget("UI.gameui.dailytaskinfodlg.actlist.actitem"..i, true);
				end;
				
				num = DailyTaskInfo_GetPlayItemNum();
				Win_SetValue("UI.gameui.dailytaskinfodlg.playlist",num,value_channel_item_num);
				for i = 0, num-1 do
					Win_ShowWidget("UI.gameui.dailytaskinfodlg.playlist.playitem"..i, true);
				end;
			end;
			
			OnSelfHide=function()
				local num = Win_GetValue("UI.gameui.dailytaskinfodlg.actlist",value_channel_item_num);
				for i = 0, num-1 do
					Win_ShowWidget("UI.gameui.dailytaskinfodlg.actlist.actitem"..i, false);
				end;
			
				num = Win_GetValue("UI.gameui.dailytaskinfodlg.playlist",value_channel_item_num);
				for i = 0, num-1 do
					Win_ShowWidget("UI.gameui.dailytaskinfodlg.playlist.playitem"..i, false);
				end;
			end;

			children=
			{
				tooltip=
				{
					type = "LABEL",
					rect={-100,-100,24,12},		
					drawcolor = { 255, 255, 255, 255 },		
					bkcolor={16,16,16,196},
					edgecolor = { 0, 0, 0, 128 },
					maxwidth=200,
					sizeable=1,	
					visible=0,
					marginh=12,
					marginv=6,
					textsize=12,
					textfont=0,
					rowspace=4,
					initlayer=systooltip_layer,
					style=wgtstyle_vertical+wgtstyle_clipself,		
					richmode=ui_richmode_color,
					alphaspeed=0.1,		
					edgecheck=edge_check_show+edge_check_auto,
					
					patchrect={3,3,3,2},	
					patchdrawtype=patch_draw_type_scale,					
						
					patchupleft="res/uires/patch/patchupleft.gsa",
					patchupright="res/uires/patch/patchupright.gsa",
					patchdownleft="res/uires/patch/patchdownleft.gsa",
					patchdownright="res/uires/patch/patchdownright.gsa",
					
					patchupmiddle="res/uires/patch/patchupmiddle.gsa",
					patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
					patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
					patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",
					
				};	
						
				closebtn=
				{
					type="BUTTON",
					rect={427,7,22,23},
					bkimage="res/uires/newcommon/miniclose.gsa",
					style=wgtstyle_alphawin;
					defaultcancel=1,
				},	
	
				playlist=
				{
					type="WIDGETLIST",
					rect={14,56,413,98};
					style=wgtstyle_clipchild_window+wgtstyle_vertical,		
					extendstyle=wgtlist_style_wheel,
					
					itemmarginh=0,
					itemmarginv=0,

					tipwidget="UI.gameui.ScrnTooltip",
					primaryscroll="UI.gameui.dailytaskinfodlg.playvscroll",
					template={"res/uires/dailyplayitem.lua"};
					updatemute=1,
					
					children=
					{
					};
				};
				
				playvscroll=
				{
			
					type="SCROLLBAR",
					rect={425,74,20,62},					
					style=wgtstyle_vertical+wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;	
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
														
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					buddywidget="UI.gameui.dailytaskinfodlg.playlist",

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary+wgtstyle_alignfollow,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							style=wgtstyle_alignfollow,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
					
				};--scroll
						
				actlist=
				{
					type="WIDGETLIST",
					rect={14,217,413,98};
					style=wgtstyle_clipchild_window+wgtstyle_vertical,		
					extendstyle=wgtlist_style_wheel,
					
					itemmarginv=0,
					itemmarginh=0,
					
					tipwidget="UI.gameui.ScrnTooltip",
					primaryscroll="UI.gameui.dailytaskinfodlg.actvscroll",
					template={"res/uires/dailyactitem.lua"};
					updatemute=1,
					
					children=
					{
					};
				};
				
				actvscroll=
				{
			
					type="SCROLLBAR",
					rect={425,235,20,62},					
					style=wgtstyle_vertical+wgtstyle_ajustfollow,
					ajustflag=rect_flag_window+rect_flag_client;	
					extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
					minbtnsize=18,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
														
					patchupleft="res/uires/newcommon/vscroll_bk.gsa",
					patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
					patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
					
					buddywidget="UI.gameui.dailytaskinfodlg.actlist",

					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,0,20,26},
							patchupleft="res/uires/newcommon/vblocktop.gsa",
							patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
							patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
							
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/upbtn.gsa",
							style=wgtstyle_primary+wgtstyle_alignfollow,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,0,20,19},
							bkimage="res/uires/newcommon/downbtn.gsa",	
							style=wgtstyle_alignfollow,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
				};--scroll
			};
		};
		
		--自动买金机器人
		AutoBuyMoneyRobutDlg=
		{
			type="WIDGET",
			rect={0,0,446,257},
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			style=wgtstyle_topmost+wgtstyle_customclose,
			bkimage="res/uires/transmission/transmissiondlgbk.gsa",
			visiable=0,
			moveable=1,
						
			OnSelfShow=function()
				Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.allMoneyedit","30000");
				Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.priceedit","27");
				Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.buyintervaledit","1");
				Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.goldintervaledit","1");
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.AutoBuyMoneyRobutDlg",false);
			end;
			
			OnShow=function()
				Win_ShowWidget("UI.gameui.AutoBuyMoneyRobutDlg",true);
			end;
			
			children=
			{
				miniclosebtn= 
				{		
					type = "BUTTON",
					rect = { 418,12,27,27 },
					bkimage="res/uires/goddlg/closebtn.gsa",
					defaultcancel=1,
				};

				applybtn=
				{
					type="BUTTON",
					rect={70,225,90,28};
					bkimage="res/uires/newcommon/applybtn.gsa",					
					updatemute=1,
					
					OnClick=function()
						local allmoney,price,intervalTime,addmoneyIntervaltime;
						allmoney = Win_GetText("UI.gameui.AutoBuyMoneyRobutDlg.allMoneyedit");
						price = Win_GetText("UI.gameui.AutoBuyMoneyRobutDlg.priceedit");
						intervalTime = Win_GetText("UI.gameui.AutoBuyMoneyRobutDlg.buyintervaledit");
						addmoneyIntervaltime = Win_GetText("UI.gameui.AutoBuyMoneyRobutDlg.goldintervaledit");
						StartHandle(allmoney,price,intervalTime,addmoneyIntervaltime);
						Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.startlabel","启动中");
					end;
				},
				
				cancelbtn=
				{
					type="BUTTON",
					rect={294,225,90,28};
					bkimage="res/uires/newcommon/cancelbtn.gsa",
					updatemute=1,
					
					OnClick=function()
						StopHandle();
						Win_SetText("UI.gameui.AutoBuyMoneyRobutDlg.startlabel","未启动");
					end;
				},
				
				allMoney=
				{
					type="LABEL",
					rect={120,71,24,12},	
					textsize=12,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
					caption="总量";
				};
						
				
				
				allMoneyedit=
				{
					type="EDIT",
					rect={42,71,66,12},	
					textsize=12,
					maxvalue=320000,
					minvalue=1,					
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod=ui_editmethod_number+ui_editmethod_value,					
				};
				
				price=
				{
					type="LABEL",
					rect={120,100,24,12},	
					textsize=12,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
					caption="单价";
				};
						
				
				
				priceedit=
				{
					type="EDIT",
					rect={42,100,66,12},	
					textsize=12,
					maxvalue=320000,
					minvalue=1,					
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod=ui_editmethod_number+ui_editmethod_value,					
				};
				
				buyinterval=
				{
					type="LABEL",
					rect={120,129,96,12},	
					textsize=12,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
					caption="购买间隔(分钟)";
				};
						
				
				
				buyintervaledit=
				{
					type="EDIT",
					rect={42,129,66,12},	
					textsize=12,
					maxvalue=320000,
					minvalue=1,					
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod=ui_editmethod_number+ui_editmethod_value,					
				};
				
				goldinterval=
				{
					type="LABEL",
					rect={120,158,96,12},	
					textsize=12,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
					caption="加金间隔(分钟)";
				};
						
				
				
				goldintervaledit=
				{
					type="EDIT",
					rect={42,158,66,12},	
					textsize=12,
					maxvalue=320000,
					minvalue=1,					
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,	
					editmethod=ui_editmethod_number+ui_editmethod_value,					
				};
				
				startlabel=
				{
					type="LABEL",
					rect={294,130,96,24},	
					textsize=24,
					textstyle=dt_left+dt_vcenter,		
					enable=0;
					caption="未启动";
				}
				
			};
			
		};
		
		--宠物变装界面
		petavtchgdlg=
		{
			type = "DIALOG",
			rect = { 0, 0, 755, 521 },
			bkimage="res/uires/petavtchgdlg/petavtchgdlg.gsa",

			style=wgtstyle_topmost+wgtstyle_alphawin+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,

			visible=0,
			moveable=1,
			
			OnSelfShow=function()
				Win_EnableWidget("UI.gameui.petavtchgdlg.changebtn", false);
				Win_SetValue("UI.gameui.petavtchgdlg.petlist",0,value_channel_item_num);
				Win_SetText("UI.gameui.petavtchgdlg.petname", "");
				Win_SetText("UI.gameui.petavtchgdlg.changestate", "");
				Win_SetText("UI.gameui.petavtchgdlg.changedesc", "");
				Win_SetText("UI.gameui.petavtchgdlg.goldedit",0);
				Win_SetText("UI.gameui.petavtchgdlg.silveredit",0);
				Win_SetText("UI.gameui.petavtchgdlg.copperedit",0);
				LockPlayer(1);
			end;
			
			OnSelfHide=function()
				Win_ShowWidget("UI.gameui.petavtchgdlg.effect", false);
				CancelPetAvtChange();
				LockPlayer(0);
			end;
			
			OnOK=function()
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.petavtchgdlg", false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON",
					rect={596,52,29,28},
					bkimage="res/uires/petavtchgdlg/close.gsa",
					style=wgtstyle_alphawin;
					defaultcancel=1,
				};
				
				--宠物变装装备栏
				arm=
				{
					type="WIDGET",
					rect={144,226,36,36},
					groupid=0,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_petavtchgarm,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",
																		
				};
				
				--宠物变装道具栏
				prop=
				{
					type="WIDGET",
					rect={225,226,36,36},
					groupid=0,
					groupstop=0,
					dragindex=0,
					dragtype=ui_drag_type_petavtchgprop,
					style=wgtstyle_renderitem,
					tipwidget="UI.gameui.ScrnTooltip",																		
				};
				
				goldedit=
				{
					type="LABEL",
					rect={143,301,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/gold.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,					
				},
				
				silveredit=
				{
					type="LABEL",
					rect={191,301,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/silver.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				copperedit=
				{
					type="LABEL",
					rect={239,301,48,12},
					captionrect={12,0,36,12},
					bkimage="res/uires/common/copper.gsa",
					bkimagepos={2,0},
					textsize=12,	
					bkcolor={0,0,0,0},
					enable=0,
				},
				
				--"刻印"按钮
				changebtn=
				{
					type="BUTTON",
					rect={79,317,64,64},
					bkimage="res/uires/petavtchgdlg/change.gsa",
					style=wgtstyle_alphawin;
					
					OnClick=function()
						local MyMoney = GetMoney();
						local NeedMoney = GetPetAvtChgMoney()*1000000;
						if MyMoney < NeedMoney then
							Win_ShowMsgBox("您没有足够的金钱来进行神兽装刻印！","系统消息",ui_msgid_default,"UI.gameui.petavtchgdlg");
						else
							Win_ShowMsgBox("现在要对放入的神兽装进行觉醒属性刻印，确认吗？","系统消息",ui_msgid_yesno,"UI.gameui.petavtchgdlg.changebtn");
						end;
					end;
					
					OnMsgBoxOk=function()
						local sel = Win_GetValue("UI.gameui.petavtchgdlg.petlist", value_channel_sel);
						StartPetAvtChange(sel);
					end;
				};
				
				--"取消"按钮
				cancelbtn=
				{
					type="BUTTON",
					rect={182,317,64,64},
					bkimage="res/uires/petavtchgdlg/cancel.gsa",
					style=wgtstyle_alphawin;
					
					OnClick=function()
						CancelPetAvtChange();
					end;
				};
				
				--特效
				effect= 
				{
					type = "WIDGET",
					rect={188,200,1,1};
					effect={{name="TFX9149.eff", x=0, y=0, loop=0, delay=0}},					
					visible=0;
				};
				
				petlist=
				{					
					type="LISTBOX",
					rect={301,109,120,224};
					style=wgtstyle_vertical+wgtstyle_clipself,
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel+listbox_style_richtext,
					richmode=ui_richmode_color,
					textsize=12,
					itemtextstyle=dt_left+dt_vcenter;
					sizeable=1,
					
					itemheight=20,
					itemmarginv=0,
					itemmarginh=0,
							
					itemdrawback="res/uires/cdkeydlg/itembk.gsa",
					itemselback="res/uires/cdkeydlg/itemsel.gsa",
					itemdrawpos={-11,9,205,16},
					itemselpos={-19, -8,205,16};
					
					primaryscroll="UI.gameui.petavtchgdlg.scroll",
					
					updatemute=1,
					
					OnValueChange=function()
						sel=Win_GetValue("UI.gameui.petavtchgdlg.petlist",value_channel_sel);
						local name, state, desc = GetPetDescInfo(sel);
						Win_SetText("UI.gameui.petavtchgdlg.petname", name);
						Win_SetText("UI.gameui.petavtchgdlg.changestate", state);
						Win_SetText("UI.gameui.petavtchgdlg.changedesc", desc);
					end;
				};
				
				scroll=
				{			
					type="SCROLLBAR",
					rect={422,114,10,212},
					style=wgtstyle_vertical,
					extendstyle=scrollbar_auto_hide,
					minbtnsize=36,
					pagesize=8,
					marginh=0,
					marginv=0,	
					visible=1,	
					updatemute=1,
									
					
					buddywidget="UI.gameui.petavtchgdlg.petlist",
					
					children=
					{
						blockbtn=
						{
							type="BUTTON",
							rect={0,2,10,16},
							bkimage="res/uires/chatbar/minislidebtn.gsa",
							bkimagepos={0,0},
							moveable=1,
							aligntype=aligntype_father+aligntype_clientrect,
							alignstyle=alignstyle_top_in+alignstyle_hcenter,	
						};--blockbtn
						
	
						spinup=
						{
							type="SPIN",
							rect={0,-6,10,6},
							bkimage="res/uires/chatbar/miniupbtn.gsa",
							style=wgtstyle_primary+wgtstyle_alignfollow,
							textstyle=1,		
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_top_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,							
						};--spinup
						
						spindown=
						{
							type="SPIN",
							rect={0,213,10,6},
							bkimage="res/uires/chatbar/minidnbtn.gsa",	
							style=wgtstyle_alignfollow,
							aligntype=aligntype_father+aligntype_winrect,
							alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
							marginh=0,
							marginv=0,
													
						};--spindown
						
					};--children
			
				};--scroll
				
				
				--宠物名字
				petname = 
				{	
					type = "LABEL";
					rect = {430,76,120,16},
					drawcolor = {255,0,0,255},
					visible = 1,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				--觉醒形态
				changestate = 
				{	
					type = "LABEL";
					rect = {505,279,114,16},
					drawcolor = {255,0,0,255},
					visible = 1,
					textsize=12,
					textstyle=dt_left+dt_vcenter,
				};
				
				--觉醒描述
				changedesc = 
				{	
					type = "LABEL";
					rect = {505,303,114,40},
					drawcolor = {255,0,0,255},
					visible = 1,
					textsize=12,
					textstyle=dt_left+dt_top,
				};
				
				--宠物图鉴区
				peticon = 
				{
					type = "WIDGET",
					rect = {452,115,153,131},
					edgecolor={0,0,0,0},		
					style=wgtstyle_static+wgtstyle_renderbuffer,
					custombuffer=custom_buffer_petavtchg,
					visible = 1;
				};
			};
		};
		
		--当玩家是低级玩家的时候，提示玩家选择认证级别
		newselseculeveldlg=
		{
			type="DIALOG",
			rect={0,0,353,334},
			bkimage="res/uires/secu/selseculeveldlg.gsa",
			style=wgtstyle_topmost+wgtstyle_customclose,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			initlayer=msgbox_layer-1,
			moveable=0,
			visible=0,
			defaultendok=0,

			OnSelfShow=function()
				local info = GetSecuInfo();
				CmdGetSecukeyMap();
				
				Win_SetCapture("UI.gameui.newselseculeveldlg");
				
				Win_SetText("UI.gameui.newselseculeveldlg.oldpassedit","");
				
				Win_SetSelect("UI.gameui.newselseculeveldlg",0, info.level);
				
				EnableKeyCrypt(1);
				
				local iValue = GetKeyCryptEnable();
				if iValue ~= 0 then
					Win_SetText("UI.gameui.newselseculeveldlg.keycryptlabel1", "res/uires/titleui/keycryptenable.gsa", value_channel_backpic);
				else
					Win_SetText("UI.gameui.newselseculeveldlg.keycryptlabel1", "res/uires/titleui/keycryptdisable.gsa", value_channel_backpic);
				end;
				
			end;
			
			OnSelfHide=function()
				EnableKeyCrypt(0);
			end;
			
			OnMsgBoxOk=function()
				Win_SetCapture("UI.gameui.newselseculeveldlg");
				Win_SetFocus("UI.gameui.newselseculeveldlg");
				Win_SetFocus("UI.gameui.newselseculeveldlg.oldpassedit");
				end;
			
			OnEscape=function()
				Win_ShowWidget("UI.gameui.newselseculeveldlg",false);
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.newselseculeveldlg",false);
			end;
				
			OnOk=function()
				--密码
				local edit0len = Win_GetValue("UI.gameui.newselseculeveldlg.oldpassedit",value_channel_captionsize);
				
				if edit0len <= 5 then
					Win_ShowMsgBox("请输入正确的财产安全锁密码","系统消息",ui_msgid_default,"UI.gameui.newselseculeveldlg");
					Win_SetText("UI.gameui.newselseculeveldlg.oldpassedit","");
					--Win_SetFocus("UI.newresetsecudlg.oldpassedit");
				else
					local info = GetSecuInfo();
					local sel = Win_GetSelect("UI.gameui.newselseculeveldlg",0);
					
					if sel ~= 2 and sel ~= 1 then
						Win_ShowMsgBox("请选择认证级别。","系统消息",ui_msgid_default,"UI.gameui.newselseculeveldlg");
					elseif sel ~= info.level then
						ResetSecuLevel("UI.gameui.newselseculeveldlg.oldpassedit",sel);
						Win_ShowWidget("UI.gameui.newselseculeveldlg",false);
					end;
				end;
				
				end;
				
			OnEnter=function()
				Win_EndWidget("UI.gameui.newselseculeveldlg",true);
				end;			
			
			children=
			{
				desc0=
				{
					type = "LABEL",
					rect = {25, 27, 300, 60},
					caption="    亲爱的用户，您当前的财产安全锁等级为低级，为了更好的保障您的帐号安全，我们强烈建议您选择以下安全级别更高的认证措施。";
					textsize=12,
					drawcolor={229,184,83, 255},
					rowspace=4,
					visible=1;
					enable=1;
				};
							
				level1= 
				{
					type = "CHECK",
					rect={17,119,93,18};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
				};
				
				level2= 
				{
					type = "CHECK",
					rect={17,175,93,18};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
				};
				
				desc1=
				{
					type = "LABEL",
					rect = {120, 104, 211, 46},
					caption="在进行游戏消费、物品绑定等游戏内关键操作前，需要进行财产安全验证。该验证完成后，在本次登出前有效。";
					textsize=12,
					drawcolor={229,184,83, 255},
					rowspace=2,
					visible=1;
					enable=0;
				};
				
				desc2=
				{
					type = "LABEL",
					rect = {120, 162, 211, 46},
					caption="在选择角色进入游戏前，需要进行财产安全验证。该验证完成后，在本次登出前有效。";
					textsize=12,
					drawcolor={229,184,83, 255},
					rowspace=2,
					visible=1;
					enable=0;
				};	
				
				oldpassedit=
				{
					type="EDIT",
					rect={86,255,182,13},		
					textstyle=dt_left+dt_vcenter,
					editmethod = ui_editmethod_english+ui_editmethod_number+ui_editmethod_coder,	
					textsize=12,
					drawcolor={255,255,255,255},
					bkcolor={0,0,0,0},
					maxchar=12,
					updatemute=1,
					editable=0,
					tiptext="请点击右边小键盘使用软键盘输入密码",
					
					OnClick=function()
						Win_SetText("UI.gameui.newselseculeveldlg.SysInputTip","为了您的财产安全，必须使用软键盘输入密码。");
						Win_AlignWidget("UI.gameui.newselseculeveldlg.SysInputTip","UI.gameui.newselseculeveldlg.oldpassedit",aligntype_winrect,alignstyle_left_in+alignstyle_top_out, 100, 17);
						Win_ShowWidget("UI.gameui.newselseculeveldlg.SysInputTip",true);
						Win_SetValue("UI.gameui.newselseculeveldlg.SysInputTip",2,value_channel_timerspace);

						Win_SelectSelf("UI.gameui.newselseculeveldlg.keyboardbtn1");
						UI.children.gameui.children.newselseculeveldlg.children.keyboardbtn1.OnClick();
					end;
				},

				
				keycryptlabel1=
				{
					type = "LABEL",
					rect = {51, 252, 11, 12},
					textsize=12,
					enable=0;
				};
				
				keyboardbtn1 = 
				{
					type = "CHECK",
					rect = { 284,249,22,20 },
					bkimage = "res/uires/titleui/keyboardbtn.gsa",
					extendstyle=ui_btn_style_none,
					soundid={1006},
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.newselseculeveldlg.keyboardbtn1")  then
						
						Win_SetText("UI.keyboarddlg","UI.gameui.newselseculeveldlg.keyboardbtn1",value_channel_customtext);
						Win_SetText("UI.keyboarddlg","UI.gameui.newselseculeveldlg.oldpassedit",value_channel_customname);
						Win_SetText("UI.keyboarddlg","UI.gameui.newselseculeveldlg",value_channel_customstring);
						Win_ShowWidget("UI.keyboarddlg",true);
						Win_SetFocus("UI.keyboarddlg");
						Win_SetCapture("UI.keyboarddlg");
						else 
						Win_ShowWidget("UI.keyboarddlg",false);
						end;						     
						end;	
				};
				
				
				SysInputTip=
				{
					type = "LABEL",
					rect={100,100,24,33},
					coverpic="res/uires/gameui/ballarrow.gsa",
					coverpicpos={-13,35},
					drawcolor={0,0,0,255},
					visible=0,			
					maxwidth=200,
					minheight=41,
					sizeable=1,								
					marginh=12,
					marginv=6,
					textsize=12,
					alphaspeed=0.1,	
					richmode=ui_richmode_all,
					initlayer=systooltip_layer,
					edgecheck=edge_check_show+edge_check_auto,
					
					patchupleft="res/uires/gameui/ballupleft.gsa",
					patchupright="res/uires/gameui/ballupright.gsa",
					patchdownleft="res/uires/gameui/balldownleft.gsa",
					patchdownright="res/uires/gameui/balldownright.gsa",
					
					patchupmiddle="res/uires/gameui/ballupmiddle.gsa",
					patchdownmiddle="res/uires/gameui/balldownmiddle.gsa",
					patchleftmiddle="res/uires/gameui/ballleftmiddle.gsa",
					patchrightmiddle="res/uires/gameui/ballrightmiddle.gsa",
					
					patchmiddle="res/uires/gameui/ballmiddle.gsa",
					
					OnTimer=function()
						Win_ShowWidget("UI.gameui.newselseculeveldlg.SysInputTip",false);
						end;
					
					OnSelfShow=function()
						Win_SetValue("UI.gameui.newselseculeveldlg.SysInputTip",-1,value_channel_timerspace);
						end;	
						
					OnClick=function()
						Win_ShowWidget("UI.gameui.newselseculeveldlg.SysInputTip",false);
						end;
				};
				
				
				completebtn=
				{
					type="BUTTON",
					rect={58,288,86,24},
					bkimage="res/uires/secu/completemodifybtn.gsa",
					defaultok=1,
					
					OnMsgBoxCancel=function()
						Win_SetText("UI.gameui.newselseculeveldlg.oldpassedit","");
						Win_ShowWidget("UI.gameui.newselseculeveldlg",false);
						end;
						
					OnMsgBoxOk=function()
						Win_SetText("UI.gameui.newselseculeveldlg.oldpassedit","");
						Win_ShowWidget("UI.gameui.newselseculeveldlg",false);
						end;
						
					OnTimer=function()
						Win_EnableWidget("UI.gameui.newselseculeveldlg.completebtn",true);
						Win_SetValue("UI.gameui.newselseculeveldlg.completebtn",-1,value_channel_timerspace);
						end;
				};
				
				cancelbtn=
				{
					
					type="BUTTON",
					rect={206,288,86,24},
					bkimage="res/uires/secu/cancelmodify.gsa",	
					defaultcancel=1,
					soundid={1007},					
				},
				
			};
		};

		fmlandcounter=
		{
			type="WIDGET",
			rect = {800,140,50,30},
			style = wgtstyle_clipchild_window;
			moveable=1,
			visible=0,
			
			bkcolor={16,16,16,196},
			edgecolor = { 0, 0, 0, 128 },
			patchrect={3,3,3,2},		
	
			patchdrawtype=patch_draw_type_scale,
			patchupleft="res/uires/patch/patchupleft.gsa",
			patchupright="res/uires/patch/patchupright.gsa",
			patchdownleft="res/uires/patch/patchdownleft.gsa",
			patchdownright="res/uires/patch/patchdownright.gsa",
	
			patchupmiddle="res/uires/patch/patchupmiddle.gsa",
			patchdownmiddle="res/uires/patch/patchdownmiddle.gsa",
			patchleftmiddle="res/uires/patch/patchleftmiddle.gsa",
			patchrightmiddle="res/uires/patch/patchrightmiddle.gsa",

			
			__tm = 0;
			__acc = 0;
			updatecounter=function()
				local ct = UI.children.gameui.children.fmlandcounter;
				local tm = ct.__tm - (os.time()-ct.__acc);
				if tm<=0 then ct.__tm=0; end;
				local minutes = math.floor(tm/60);
				local seconds = tm-minutes*60;
				local tt=string.format("%02d:%02d",minutes,seconds);
				Win_SetText("UI.gameui.fmlandcounter.tm",tt);
			end;
			
			OnStartCounter=function(tm)
				local ct = UI.children.gameui.children.fmlandcounter;
				ct.__tm = tm;
				ct.__acc = os.time();
				ct.updatecounter();
				Win_ShowWidget("UI.gameui.fmlandcounter",true);
				Win_SetValue("UI.gameui.fmlandcounter",0.5,value_channel_timerspace);
			end;
			
			OnTimer=function()
				local ct = UI.children.gameui.children.fmlandcounter;
				if ct.__tm==0 then
					Win_ShowWidget("UI.gameui.fmlandcounter",false);
				else
					ct.updatecounter();
					Win_SetValue("UI.gameui.fmlandcounter",0.3,value_channel_timerspace);
				end;
			end;
			
			children=
			{
				tm=
				{
					type="LABEL",
					rect = {0,2,50,28},
				};
			};
		};
		
		suomadlg=
		{
			type="DIALOG";
			bkimage="res/uires/laba/laba.gsa";
			rect={0,0,486,316};
			style=wgtstyle_topmost+wgtstyle_customclose+wgtstyle_alphawin,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,
			moveable=1,
			visible=0,
			updatemute=1,
			dialogtype=0,
			
			OnSelfShow=function()
				Win_SetText("UI.gameui.suomadlg.contentedit","");
			end;
			
			OnOk=function()
				local txt=Win_GetText("UI.gameui.suomadlg.contentedit");
				
				if string.find(txt,"\n") ~= nil then
					Win_ShowMsgBox("您输入的文字中包含回车，请重新编辑后发送！");
					return;
				end;
				local goal= "修罗";
				if dialogtype == 1 then
					goal = "修罗";
				elseif dialogtype == 2 then
					goal = "黄金龙";
				elseif dialogtype == 3 then
					goal = "黄金凤";
				elseif dialogtype == 4 then
					goal = "恶魔王子";
				elseif dialogtype == 5 then
					goal = "精灵仙子";
				elseif dialogtype == 6 then
					goal = "财源广进";
				elseif dialogtype == 7 then
					goal = "年年有余";
				elseif dialogtype == 8 then
					goal = "张灯结彩";
				elseif dialogtype == 9 then
					goal = "招财进宝";
				elseif dialogtype == 10 then
					goal = "白富美";
				elseif dialogtype == 11 then
					goal = "高富帅";
				end;
				if txt ~= "" then
				Chat(goal,txt);
				Win_SetText("UI.gameui.suomadlg.contentedit","");
				Win_ShowWidget("UI.gameui.suomadlg",false);
				elseif txt == "" then
				Win_ShowMsgBox("您还没有输入哟!");
				end;
			end;
			
			OnCancel=function()
				Win_ShowWidget("UI.gameui.suomadlg",false);
			end;
			
			OnShowDlg=function(type)
				dialogtype = type;
				local goal = "";
				if dialogtype == 1 then
					goal = "修罗大喇叭";
				elseif dialogtype == 2 then
					goal = "黄金大喇叭";
				elseif dialogtype == 3 then
					goal = "黄金大喇叭";
				elseif dialogtype == 4 then
					goal = "恶魔王子喇叭";
				elseif dialogtype == 5 then
					goal = "精灵仙子喇叭";
				elseif dialogtype == 6 then
					goal = "财源广进喇叭";
				elseif dialogtype == 7 then
					goal = "年年有余喇叭";
				elseif dialogtype == 8 then
					goal = "张灯结彩喇叭";
				elseif dialogtype == 9 then
					goal = "招财进宝喇叭";
				elseif dialogtype == 10 then
					goal = "白富美喇叭";
				elseif dialogtype == 11 then
					goal = "高富帅喇叭";
				end;
				Win_SetText("UI.gameui.suomadlg.titletext",goal);
				Win_ShowWidget("UI.gameui.suomadlg",true);
			end;
			
			children=
			{	
				contentedit=
				{
					type="MULTIEDIT",
					rect={33,48,195,106},
					textsize=12,
					textstyle=dt_left+dt_vcenter,
					richmode=ui_richmode_font+ui_richmode_color,							
					drawflag=drawflag_focuscaption,
					extendstyle=edit_style_smartcursor+edit_style_flashcursor+edit_style_keepsel,
					maxchar=120,
					returnflag=4,
					
					OnEnter=function()
					end;
				};
				
				facebtn = 
				{
					type = "CHECK",
					rect={231,47,15,14},
					bkimage="res/uires/maildlg/facebtn.gsa",
					extendstyle=ui_btn_style_none,
					framescheme={{1,1,1,1,1,1,2,2},{0,0,0,0,0,0,2,2}},
					tiptext="Alt+B",
					
					OnClick=function()
						if  Win_IsChecked("UI.gameui.suomadlg.facebtn")  then
						Win_SetText("UI.gameui.facedlg","UI.gameui.suomadlg",value_channel_customname);
						Win_AlignWidget("UI.gameui.facedlg","UI.gameui.suomadlg.facebtn",aligntype_winrect,alignstyle_bottom_out+alignstyle_left_in);
						Win_ShowWidget("UI.gameui.facedlg",true);
						Win_SetFocus("UI.gameui.facedlg.facelist");
						end;						     
						end;				
					
				};
				
				okbtn=
				{
					type="BUTTON",
					rect={47,157,70,22},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},	
				};
			
				cancelbtn=
				{
					type="BUTTON",
					rect={169,157,70,22},
					bkimage="res/uires/common/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},				
				};
				
				closebtn=
				{
					
					type="BUTTON",
					rect={235,20,22,24},
					bkimage="res/uires/newcommon/miniclose.gsa",	
					defaultcancel=1,
					soundid={1007},					
				},
				
				titletext=
				{
					type="LABEL",
					rect={79, 19 ,111, 23},
					textsize=12,
					textfont=1,
					drawcolor={204,153,51, 255},
				},
				
			};
			
		};
		
		--Cross验证码输入
		qqcrossauth = 
		{
			type = "LABEL",
			rect = { 637,112,153,137 },
			clientrect = {10,23,133,56},
			bkimage = "res/uires/titleui/qqauth.gsa",
			style=wgtstyle_renderbuffer,
			custombuffer=custom_buffer_qqauth,
			alphaspeed=0.05,
			alphafactor=0.0,
			visible=0,
			autoadjust = autoadjust_center,
			
			OnEnter=function()
				UI.children.gameui.children.qqcrossauth.children.affirmbtn.OnClick();
				end;
			
						
			OnSelfShow=function()
				Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",5,value_channel_timerspace);
				Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",1,value_channel_framescheme);
				Win_SetText("UI.gameui.qqcrossauth.authedit","");
				Win_SetCapture("UI.gameui.qqcrossauth");
				Win_SetFocus("UI.gameui.qqcrossauth.authedit");
				end;
			
			OnSelfHide=function()
				Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",-1,value_channel_timerspace);
				Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",0,value_channel_framescheme);
				end;
			
			OnClick=function()
				Win_SetFocus("UI.gameui.qqcrossauth.authedit");
				end;
			
			
			children=
			{
				authedit = 
				{
					type = "EDIT",
					rect = { 8,107,88,18 },
					editmethod = ui_editmethod_english+ui_editmethod_number,	
					drawcolor = { 255, 255, 255, 255 },		
					bkcolor = { 0, 0, 0, 0 },	
					focuscolor = { 0, 0, 0, 0 },
					textsize=12,
					maxchar=16,
					textstyle=dt_left+dt_vcenter,
					updatemute=1,					
				};
				
				affirmbtn=
				{
					type="BUTTON",
					rect={103,104,44,24};
					bkimage="res/uires/titleui/inputbtn.gsa",					
					framescheme={{0,0,1,1,2,2,3,3},{1,2,1,2,1,2,1,2}},
					framespeed=0.2,
					soundid={1007},
					
					OnTimer=function()
						Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",0,value_channel_framescheme);
						end;
					
					OnClick=function()
						Win_SetValue("UI.gameui.qqcrossauth.affirmbtn",0,value_channel_framescheme);
						local authtxt=Win_GetText("UI.gameui.qqcrossauth.authedit");
						QQAuthReturn(authtxt);
						Win_ShowWidget("UI.gameui.qqcrossauth",false);
						end;		
					
				};
			};
		};
		
		--复仇
		revengedlg=
		{
			type="DIALOG",
			rect={0,0,248,342},
			bkimage="res/uires/revenge/revengebk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,				
			visible=0,
			initlayer=msgbox_layer,
			moveable=1,
			updatemute=1,
									
			OnCancel=function()
				Win_ShowWidget("UI.gameui.revengedlg",false);
			end;
							
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={68,22,114,20},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
				},
				
				closebtn=
				{
					type="BUTTON",
					rect={220,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					visible=1;
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 199,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					visible=1;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={150,310,69,24},
					bkimage="res/uires/sysdlg/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				okbtn=
				{
					type="BUTTON",
					rect={45,310,69,24},
					bkimage="res/uires/sysdlg/affirmbtn.gsa",
					defaultok=1,
					soundid={1005},
					
					OnClick=function()
						local revengetype = Win_GetValue("UI.gameui.revengedlg", value_channel_customtype);
						local haverevenge = Win_GetValue("UI.gameui.revengedlg", value_channel_customid);
						local idx = Win_GetValue("UI.gameui.revengedlg.enemylist" , value_channel_sel);	

						if haverevenge == 1 then
							local strmsg = "已有复仇关系，是否切换到新的复仇关系？";
							Win_ShowMsgBox(strmsg, "系统消息", ui_msgid_yesno, "UI.gameui.revengedlg.okbtn");				
						else
							Revenge(revengetype, idx);
							Win_ShowWidget("UI.gameui.revengedlg",false);				
						end;				
					end;
							
					OnMsgBoxOk=function()
						local revengetype = Win_GetValue("UI.gameui.revengedlg", value_channel_customtype);
						local idx = Win_GetValue("UI.gameui.revengedlg.enemylist" , value_channel_sel);	
						
						Revenge(revengetype, idx);
						Win_ShowWidget("UI.gameui.revengedlg",false);	
					end;					
				},
			
				enemylist=
				{
					type="LISTBOX",
					rect={35,68,177,238},
					dragtype=ui_drag_type_revengelist,
					itemnum=0,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					itemdragflag=-1,

					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					
					itemdrawback="res/uires/teamdlg/itembk.gsa",	
					itemdrawpos={0,22,0,0},
					itemselback="res/uires/transportdlg/excheckcover.gsa",	
					itemselpos={5,2,0,0},	
					
					updatemute=1,							
											   
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={179,19,20,195},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};--children
				};--memberlist
			},	
		};--end for revengedlg
		
		revengesharedlg=
		{
			type="DIALOG",
			rect={0,0,248,342},
			bkimage="res/uires/revenge/revengebk.gsa",
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,				
			visible=0,
			initlayer=msgbox_layer,
			moveable=1,
			updatemute=1,
									
			OnCancel=function()
				Win_ShowWidget("UI.gameui.revengesharedlg",false);
			end;
							
			OnMsgBoxOk=function()
				local playerId = Win_GetValue("UI.gameui.revengesharedlg", value_channel_customid);
				local idx = Win_GetValue("UI.gameui.revengesharedlg.enemylist" , value_channel_sel);	
				
				AddEnemyFromShareList(playerId, idx);
				
				Win_ShowWidget("UI.gameui.revengesharedlg",false);	
			end;
			
			children=
			{
				titlelabel=
				{
					type="LABEL",
					rect={68,22,114,20},			
					textsize=16,
					textfont=1,
					drawcolor={230,190,61,255},
					textstyle=dt_center+dt_vcenter,				
					richmode=ui_richmode_all,
					enable=1,		
					updatemute=1,
					caption="仇人列表";
				},
				
				closebtn=
				{
					type="BUTTON",
					rect={220,19,23,22},
					bkimage="res/uires/newcommon/miniclose.gsa",
					defaultcancel=1,
					visible=1;
				},	
				
				helplink= 
				{
					type = "BUTTON",
					rect = { 199,19,23,22 },
					bkimage="res/uires/newcommon/helpicon.gsa",
					visible=1;
				};
				
				cancelbtn=
				{
					type="BUTTON",
					rect={150,310,69,24},
					bkimage="res/uires/sysdlg/cancelbtn.gsa",
					defaultcancel=1,
					soundid={1007},
				},
				
				okbtn=
				{
					type="BUTTON",
					rect={45,310,69,24},
					bkimage="res/uires/revenge/shareenemybtn.gsa",
					--defaultok=1,
					soundid={1005},
					
					OnClick=function()
						local playerId = Win_GetValue("UI.gameui.revengesharedlg", value_channel_customid);
						local idx = Win_GetValue("UI.gameui.revengesharedlg.enemylist" , value_channel_sel);	
						
						CanShareEnemy(playerId, idx);			
					end;					
				},
			
				enemylist=
				{
					type="LISTBOX",
					rect={35,68,177,238},
					dragtype=ui_drag_type_revengesharelist,
					itemnum=0,
					style=wgtstyle_vertical+wgtstyle_systemdraw+wgtstyle_clipself+wgtstyle_ajustfollow,							
					ajustflag=rect_flag_window+rect_flag_client;							
					extendstyle=listbox_style_itemheight_fix+listbox_style_wheel,
					itemdragflag=-1,

					itemheight=24,
					itemmarginv=0,
					itemmarginh=0,
					
					itemdrawback="res/uires/teamdlg/itembk.gsa",	
					itemdrawpos={0,22,0,0},
					itemselback="res/uires/transportdlg/excheckcover.gsa",	
					itemselpos={5,2,0,0},	
					
					updatemute=1,							
											   
					children=
					{
						vscroll=
						{
							type="SCROLLBAR",
							rect={179,19,20,195},					
							style=wgtstyle_vertical+wgtstyle_ajustfollow,
							ajustflag=rect_flag_window+rect_flag_client;	
							extendstyle=scrollbar_blockbtn_auto_size+scrollbar_auto_hide,
							minbtnsize=18,
							pagesize=8,
							marginh=0,
							marginv=0,	
							visible=1,	
							updatemute=1,
							
							patchupleft="res/uires/newcommon/vscroll_bk.gsa",
							patchleftmiddle="res/uires/newcommon/vscroll_bk.gsa",
							patchdownleft="res/uires/newcommon/vscroll_bk.gsa",	
																
							children=
							{
								blockbtn=
								{
									type="BUTTON",
									rect={0,0,20,26},
									patchupleft="res/uires/newcommon/vblocktop.gsa",
									patchleftmiddle="res/uires/newcommon/vblockmid.gsa",
									patchdownleft="res/uires/newcommon/vblockbottom.gsa",	
									moveable=1,
									aligntype=aligntype_father+aligntype_clientrect,
									alignstyle=alignstyle_top_in+alignstyle_hcenter,	
									
								};--blockbtn
								
			
								spinup=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/upbtn.gsa",
									style=wgtstyle_primary+wgtstyle_alignfollow,
									textstyle=1,		
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_top_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,							
									
								};--spinup
								
								spindown=
								{
									type="SPIN",
									rect={0,0,20,19},
									bkimage="res/uires/newcommon/downbtn.gsa",	
									style=wgtstyle_alignfollow,
									aligntype=aligntype_father+aligntype_winrect,
									alignstyle=alignstyle_bottom_out+alignstyle_hcenter,	
									marginh=0,
									marginv=0,
															
								};--spindown
								
							};--children
							
						};--scroll
					};--children
				};--memberlist
			},	
		};--end for revengedlg
		-- 设置安全保护方式
		selectprotecttypedlg=
		{
			type = "DIALOG",	
			rect={0,0,221,268},
			bkimage="res/uires/waredlg/selectprotecttypebk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.selectprotecttypedlg");
				Win_SetCheck("UI.gameui.selectprotecttypedlg.radio1", false);
				Win_SetCheck("UI.gameui.selectprotecttypedlg.radio2", true);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={194,7,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				radio1= 
				{
					type = "CHECK",
					rect={77,44,70,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				radio2= 
				{
					type = "CHECK",
					rect={77,67,70,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},			
							
				affirmbtn=
				{
					type="BUTTON",
					rect={73,240,75,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					

						local protecttype = 1;
						if Win_IsChecked("UI.gameui.selectprotecttypedlg.radio1") then
							protecttype = 0;
						end;
						
						Win_SetValue("UI.gameui.setprotecttimedlg", protecttype, value_channel_customtype);
						
						Win_ShowWidget("UI.gameui.setprotecttimedlg", true);
						Win_ShowWidget("UI.gameui.selectprotecttypedlg", false);
					end;			
				},					
			};
		}; -- selectprotecttypedlg
		
		-- 设置安全保护时间
		setprotecttimedlg=
		{
			type = "DIALOG",	
			rect={0,0,222,268},
			bkimage="res/uires/waredlg/setprotecttimebk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.setprotecttimedlg");
				Win_SetCheck("UI.gameui.setprotecttimedlg.radio1", true);
				Win_SetCheck("UI.gameui.setprotecttimedlg.radio2", false);
				Win_SetCheck("UI.gameui.setprotecttimedlg.radio3", false);
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={194,7,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				radio1= 
				{
					type = "CHECK",
					rect={49,42,125,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				radio2= 
				{
					type = "CHECK",
					rect={49,63,125,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				radio3= 
				{
					type = "CHECK",
					rect={49,85,125,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=2,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},				
							
				affirmbtn=
				{
					type="BUTTON",
					rect={73,238,75,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					

						local timetype = 0;
						if Win_IsChecked("UI.gameui.setprotecttimedlg.radio1") then
							timetype = 0;
						elseif Win_IsChecked("UI.gameui.setprotecttimedlg.radio2") then
							timetype = 1;
						elseif Win_IsChecked("UI.gameui.setprotecttimedlg.radio3") then
							timetype = 2;
						end;
						
						local protecttype = Win_GetValue("UI.gameui.setprotecttimedlg", value_channel_customtype);
						
						TurnOnLoginProtect(protecttype, timetype);
						
						Win_ShowWidget("UI.gameui.setprotecttimedlg", false);
					end;			
				},					
			};
		}; -- setprotecttimedlg	
		
		-- 安全保护设置
		protectsetupdlg=
		{
			type = "DIALOG",	
			rect={0,0,150,150},
			bkimage="res/uires/waredlg/protectsetupbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				local delayEnable = false;
				local reduceEnable = false;
				local cancelEnable = true;
				local protectInfo = GetLoginProtectInfo();
				
				if protectInfo.protecttime ~= 7200 then
					delayEnable = true;
				end;
				
				if protectInfo.protecttime ~= 1800 then
					reduceEnable = true;
				end;		
				
				-- 当前在取消或缩短生效期内
				if protectInfo.modifytype >= 1 and protectInfo.modifytype <= 3 then
					delayEnable = false;
					reduceEnable = false;
					cancelEnable = false;					
				end;
				
				Win_EnableWidget("UI.gameui.protectsetupdlg.delayprotectbtn", delayEnable);
				Win_EnableWidget("UI.gameui.protectsetupdlg.reduceprotectbtn", reduceEnable);
				Win_EnableWidget("UI.gameui.protectsetupdlg.cancelprotectbtn", cancelEnable);
				
				Win_SetFocus("UI.gameui.protectsetupdlg");
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={124,8,20,19};
					defaultcancel=1,
					updatemute=1,
				},
						
				delayprotectbtn= 
				{
					type = "BUTTON",
					rect = { 20,40,113,30 },
					bkimage="res/uires/waredlg/delayprotectbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.delayprotectdlg", true);
						Win_ShowWidget("UI.gameui.protectsetupdlg", false);
					end;
				};
				
				reduceprotectbtn= 
				{
					type = "BUTTON",
					rect = { 20,75,113,30 },
					bkimage="res/uires/waredlg/reduceprotectbtn.gsa",
					
					OnClick=function()
						Win_ShowWidget("UI.gameui.reduceprotectdlg", true);
						Win_ShowWidget("UI.gameui.protectsetupdlg", false);
					end;
				};

				cancelprotectbtn= 
				{
					type = "BUTTON",
					rect = { 20,110,113,30 },
					bkimage="res/uires/waredlg/cancelprotectbtn.gsa",
					
					OnClick=function()
						CancelLoginProtect();
						Win_ShowWidget("UI.gameui.protectsetupdlg", false);
					end;
				};				
			};
		}; -- protectsetupdlg
		
		-- 延长保护时间
		delayprotectdlg=
		{
			type = "DIALOG",	
			rect={0,0,222,194},
			bkimage="res/uires/waredlg/delayprotectbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.delayprotectdlg");
				Win_EnableWidget("UI.gameui.delayprotectdlg.radio1", true);
				Win_SetCheck("UI.gameui.delayprotectdlg.radio1", true);
				Win_SetCheck("UI.gameui.delayprotectdlg.radio2", false);
			
				local protectInfo = GetLoginProtectInfo();
				
				if protectInfo.protecttime >= 3600 then
					Win_EnableWidget("UI.gameui.delayprotectdlg.radio1", false);
					Win_SetCheck("UI.gameui.delayprotectdlg.radio1", false);
					Win_SetCheck("UI.gameui.delayprotectdlg.radio2", true);				
				end;
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={194,7,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				radio1= 
				{
					type = "CHECK",
					rect={42,43,153,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				radio2= 
				{
					type = "CHECK",
					rect={42,64,153,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},			
							
				affirmbtn=
				{
					type="BUTTON",
					rect={79,160,75,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					

						local timetype = 0;
						if Win_IsChecked("UI.gameui.delayprotectdlg.radio1") then
							timetype = 0;
						elseif Win_IsChecked("UI.gameui.delayprotectdlg.radio2") then
							timetype = 1;
						end;
						
						ModifyLoginProtectTime(0, timetype);
						Win_ShowWidget("UI.gameui.delayprotectdlg", false);
					end;			
				},					
			};
		}; -- delayprotectdlg
		
		-- 缩短保护时间
		reduceprotectdlg=
		{
			type = "DIALOG",	
			rect={0,0,222,207},
			bkimage="res/uires/waredlg/reduceprotectbk.gsa",	
			drawcolor={255,255,255,255},
			style=wgtstyle_topmost,
			initlayer=msgbox_layer,
			visible=0,
			aligntype=aligntype_father+aligntype_winrect,
			alignstyle=alignstyle_hcenter+alignstyle_vcenter,	
			textsize=12,
			textstyle=dt_center,
			updatemute=1,
			
			OnSelfShow=function()
				Win_SetFocus("UI.gameui.reduceprotectdlg");
				Win_EnableWidget("UI.gameui.reduceprotectdlg.radio1", true);
				Win_SetCheck("UI.gameui.reduceprotectdlg.radio1", true);
				Win_SetCheck("UI.gameui.reduceprotectdlg.radio2", false);
			
				local protectInfo = GetLoginProtectInfo();
				
				if protectInfo.protecttime <= 3600 then
					Win_EnableWidget("UI.gameui.reduceprotectdlg.radio1", false);
					Win_SetCheck("UI.gameui.reduceprotectdlg.radio1", false);
					Win_SetCheck("UI.gameui.reduceprotectdlg.radio2", true);				
				end;
			end;
			
			children=
			{
				closebtn=
				{
					type="BUTTON";
					bkimage="res/uires/newcommon/miniclose.gsa";
					rect={194,7,20,19};
					defaultcancel=1,
					updatemute=1,
				},
				
				radio1= 
				{
					type = "CHECK",
					rect={43,43,150,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=0,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},
				
				radio2= 
				{
					type = "CHECK",
					rect={43,65,150,16};
					bkimage = "res/uires/newcommon/radiobtn.gsa",	
					bkimagepos={0,-2};
					groupid=0,
					groupstop=1,
					extendstyle=ui_btn_style_radio,
					updatemute=1,
				},			
							
				affirmbtn=
				{
					type="BUTTON",
					rect={79,173,75,24},
					bkimage="res/uires/common/affirmbtn.gsa",
					defaultok=1,
					
					OnClick=function()					

						local timetype = 0;
						if Win_IsChecked("UI.gameui.reduceprotectdlg.radio1") then
							timetype = 0;
						elseif Win_IsChecked("UI.gameui.reduceprotectdlg.radio2") then
							timetype = 1;
						end;
						
						ModifyLoginProtectTime(1, timetype);
						Win_ShowWidget("UI.gameui.reduceprotectdlg", false);
					end;			
				},					
			};
		}; -- reduceprotectdlg
					
	};--gameui children
};--gameui


UI.children.gameui.UpdateAwakeEquipDlg = function()
	if Win_IsVisible("UI.gameui.equipdlg.equiptab") == true then
		--头盔
		if (TheEquipIsAwake(cs_pos_head) == true) then 			
			--特效
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemheadEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemheadEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemheadEffect",false);
		end;
									
		--手套
		if(TheEquipIsAwake(cs_pos_hand) == true) then				
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemhandEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemhandEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemhandEffect",false);
		end;				

		--服饰
		if(TheEquipIsAwake(cs_pos_dress) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemdressEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemdressEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemdressEffect",false);
		end;

		--足饰
		if(TheEquipIsAwake(cs_pos_foot) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemfootEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemfootEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemfootEffect",false);
		end;

		--武器
		if(TheEquipIsAwake(cs_pos_weapon) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemweaponEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemweaponEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemweaponEffect",false);
		end;

		--面饰
		if(TheEquipIsAwake(cs_pos_face) == true) then				
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemfaceEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemfaceEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemfaceEffect",false);
		end;

		--项链	
		if(TheEquipIsAwake(cs_pos_jewery) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemjeweryEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemjeweryEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemjeweryEffect",false);
		end;

		--背包
		if(TheEquipIsAwake(cs_pos_pack) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itempackEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itempackEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itempackEffect",false);			
		end;

		--戒指
		if(TheEquipIsAwake(cs_pos_ring) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.equiptab.itemringEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemringEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.equiptab.itemringEffect",false);	
		end;

		--法宝
		if(TheEquipIsAwake(cs_pos_honor) == true) then
			if Win_IsVisible("UI.gameui.equipdlg.talismanswitchdlg.itemtalismanEffect") == false then
				Win_ShowWidget("UI.gameui.equipdlg.talismanswitchdlg.itemtalismanEffect",true);
			end;
		else
			Win_ShowWidget("UI.gameui.equipdlg.talismanswitchdlg.itemtalismanEffect",false);
		end;	
	end;
	
		
	if Win_IsVisible("UI.gameui.equipdlg") == false then
		Win_ShowWidget("UI.gameui.equipdlg",true);
	end;
	
	Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListLeft",true);	
	Win_ShowWidget("UI.gameui.equipdlg.AwakeEquipListRight",true);
end;

UI.children.gameui.ShowWaitCrossServeDlg=function()
	 GotoUIScreen("WaitCrossServe");
end;

UI.children.gameui.UpdateCrossServeInfo = function()	
	if (IsInCrossServer() == true) then 
		Win_ShowWidget("UI.gameui.godaccelbar.CrossServeBtn",true);
		
		if Win_IsChecked("UI.gameui.godaccelbar.CrossServeBtn") then
			local paiming,time1 = GetCrossServerInfo();
			Win_SetText("UI.gameui.godaccelbar.CrossServeBtn","隐藏跨服等待信息",value_channel_tiptext);
			Win_ShowWidget("UI.gameui.accelbar.CrossServeInfo",true);
			Win_SetText("UI.gameui.accelbar.CrossServeInfo.infotext1","/C17跨服已满，您需要等待进入");
			Win_SetText("UI.gameui.accelbar.CrossServeInfo.infotext2","/C17当前位置: ".."/C20   " .. paiming);
			
			Win_SetValue("UI.gameui.accelbar.CrossServeInfo",time1,value_channel_timerspace);
			Win_SetText("UI.gameui.accelbar.CrossServeInfo.timetext12",time1);
			Win_SetValue("UI.gameui.accelbar.CrossServeInfo.infotext3",1,value_channel_timerspace);	
			Win_ShowWidget("UI.gameui.accelbar.CrossServeInfo",true);
		else
			Win_SetText("UI.gameui.godaccelbar.CrossServeBtn","显示跨服等待信息",value_channel_tiptext);
		end;
					
	elseif(IsInCrossServer() == false) then
		Win_ShowWidget("UI.gameui.godaccelbar.CrossServeBtn",false);
		Win_ShowWidget("UI.gameui.accelbar.CrossServeInfo",false);
	end;
end;